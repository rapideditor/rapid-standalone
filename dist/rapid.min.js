(()=>{var Ej=Object.create;var cv=Object.defineProperty;var Tj=Object.getOwnPropertyDescriptor;var kj=Object.getOwnPropertyNames;var Ij=Object.getPrototypeOf,Pj=Object.prototype.hasOwnProperty;var $=(n,e)=>()=>(n&&(e=n(n=0)),e);var ut=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),X1=(n,e)=>{for(var t in e)cv(n,t,{get:e[t],enumerable:!0})},Dj=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of kj(e))!Pj.call(n,i)&&i!==t&&cv(n,i,{get:()=>e[i],enumerable:!(r=Tj(e,i))||r.enumerable});return n};var Ot=(n,e,t)=>(t=n!=null?Ej(Ij(n)):{},Dj(e||!n||!n.__esModule?cv(t,"default",{value:n,enumerable:!0}):t,n));var GD=ut((uv,UD)=>{(function(n){"use strict";function e(F){return parseInt(F)===F}function t(F){if(!e(F.length))return!1;for(var B=0;B<F.length;B++)if(!e(F[B])||F[B]<0||F[B]>255)return!1;return!0}function r(F,B){if(F.buffer&&F.name==="Uint8Array")return B&&(F.slice?F=F.slice():F=Array.prototype.slice.call(F)),F;if(Array.isArray(F)){if(!t(F))throw new Error("Array contains invalid value: "+F);return new Uint8Array(F)}if(e(F.length)&&t(F))return new Uint8Array(F);throw new Error("unsupported array-like object")}function i(F){return new Uint8Array(F)}function s(F,B,O,G,U){(G!=null||U!=null)&&(F.slice?F=F.slice(G,U):F=Array.prototype.slice.call(F,G,U)),B.set(F,O)}var o=function(){function F(O){var G=[],U=0;for(O=encodeURI(O);U<O.length;){var W=O.charCodeAt(U++);W===37?(G.push(parseInt(O.substr(U,2),16)),U+=2):G.push(W)}return r(G)}function B(O){for(var G=[],U=0;U<O.length;){var W=O[U];W<128?(G.push(String.fromCharCode(W)),U++):W>191&&W<224?(G.push(String.fromCharCode((W&31)<<6|O[U+1]&63)),U+=2):(G.push(String.fromCharCode((W&15)<<12|(O[U+1]&63)<<6|O[U+2]&63)),U+=3)}return G.join("")}return{toBytes:F,fromBytes:B}}(),a=function(){function F(G){for(var U=[],W=0;W<G.length;W+=2)U.push(parseInt(G.substr(W,2),16));return U}var B="0123456789abcdef";function O(G){for(var U=[],W=0;W<G.length;W++){var V=G[W];U.push(B[(V&240)>>4]+B[V&15])}return U.join("")}return{toBytes:F,fromBytes:O}}(),l={16:10,24:12,32:14},c=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],u=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],d=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],f=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],h=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],p=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],m=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],g=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],y=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],x=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],b=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],_=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],S=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],C=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],k=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function v(F){for(var B=[],O=0;O<F.length;O+=4)B.push(F[O]<<24|F[O+1]<<16|F[O+2]<<8|F[O+3]);return B}var w=function(F){if(!(this instanceof w))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:r(F,!0)}),this._prepare()};w.prototype._prepare=function(){var F=l[this.key.length];if(F==null)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var B=0;B<=F;B++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);for(var O=(F+1)*4,G=this.key.length/4,U=v(this.key),W,B=0;B<G;B++)W=B>>2,this._Ke[W][B%4]=U[B],this._Kd[F-W][B%4]=U[B];for(var V=0,j=G,Z;j<O;){if(Z=U[G-1],U[0]^=u[Z>>16&255]<<24^u[Z>>8&255]<<16^u[Z&255]<<8^u[Z>>24&255]^c[V]<<24,V+=1,G!=8)for(var B=1;B<G;B++)U[B]^=U[B-1];else{for(var B=1;B<G/2;B++)U[B]^=U[B-1];Z=U[G/2-1],U[G/2]^=u[Z&255]^u[Z>>8&255]<<8^u[Z>>16&255]<<16^u[Z>>24&255]<<24;for(var B=G/2+1;B<G;B++)U[B]^=U[B-1]}for(var B=0,Y,K;B<G&&j<O;)Y=j>>2,K=j%4,this._Ke[Y][K]=U[B],this._Kd[F-Y][K]=U[B++],j++}for(var Y=1;Y<F;Y++)for(var K=0;K<4;K++)Z=this._Kd[Y][K],this._Kd[Y][K]=_[Z>>24&255]^S[Z>>16&255]^C[Z>>8&255]^k[Z&255]},w.prototype.encrypt=function(F){if(F.length!=16)throw new Error("invalid plaintext size (must be 16 bytes)");for(var B=this._Ke.length-1,O=[0,0,0,0],G=v(F),U=0;U<4;U++)G[U]^=this._Ke[0][U];for(var W=1;W<B;W++){for(var U=0;U<4;U++)O[U]=f[G[U]>>24&255]^h[G[(U+1)%4]>>16&255]^p[G[(U+2)%4]>>8&255]^m[G[(U+3)%4]&255]^this._Ke[W][U];G=O.slice()}for(var V=i(16),j,U=0;U<4;U++)j=this._Ke[B][U],V[4*U]=(u[G[U]>>24&255]^j>>24)&255,V[4*U+1]=(u[G[(U+1)%4]>>16&255]^j>>16)&255,V[4*U+2]=(u[G[(U+2)%4]>>8&255]^j>>8)&255,V[4*U+3]=(u[G[(U+3)%4]&255]^j)&255;return V},w.prototype.decrypt=function(F){if(F.length!=16)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var B=this._Kd.length-1,O=[0,0,0,0],G=v(F),U=0;U<4;U++)G[U]^=this._Kd[0][U];for(var W=1;W<B;W++){for(var U=0;U<4;U++)O[U]=g[G[U]>>24&255]^y[G[(U+3)%4]>>16&255]^x[G[(U+2)%4]>>8&255]^b[G[(U+1)%4]&255]^this._Kd[W][U];G=O.slice()}for(var V=i(16),j,U=0;U<4;U++)j=this._Kd[B][U],V[4*U]=(d[G[U]>>24&255]^j>>24)&255,V[4*U+1]=(d[G[(U+3)%4]>>16&255]^j>>16)&255,V[4*U+2]=(d[G[(U+2)%4]>>8&255]^j>>8)&255,V[4*U+3]=(d[G[(U+1)%4]&255]^j)&255;return V};var A=function(F){if(!(this instanceof A))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new w(F)};A.prototype.encrypt=function(F){if(F=r(F),F.length%16!==0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var B=i(F.length),O=i(16),G=0;G<F.length;G+=16)s(F,O,0,G,G+16),O=this._aes.encrypt(O),s(O,B,G);return B},A.prototype.decrypt=function(F){if(F=r(F),F.length%16!==0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var B=i(F.length),O=i(16),G=0;G<F.length;G+=16)s(F,O,0,G,G+16),O=this._aes.decrypt(O),s(O,B,G);return B};var E=function(F,B){if(!(this instanceof E))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",!B)B=i(16);else if(B.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastCipherblock=r(B,!0),this._aes=new w(F)};E.prototype.encrypt=function(F){if(F=r(F),F.length%16!==0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var B=i(F.length),O=i(16),G=0;G<F.length;G+=16){s(F,O,0,G,G+16);for(var U=0;U<16;U++)O[U]^=this._lastCipherblock[U];this._lastCipherblock=this._aes.encrypt(O),s(this._lastCipherblock,B,G)}return B},E.prototype.decrypt=function(F){if(F=r(F),F.length%16!==0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var B=i(F.length),O=i(16),G=0;G<F.length;G+=16){s(F,O,0,G,G+16),O=this._aes.decrypt(O);for(var U=0;U<16;U++)B[G+U]=O[U]^this._lastCipherblock[U];s(F,this._lastCipherblock,0,G,G+16)}return B};var I=function(F,B,O){if(!(this instanceof I))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",!B)B=i(16);else if(B.length!=16)throw new Error("invalid initialation vector size (must be 16 size)");O||(O=1),this.segmentSize=O,this._shiftRegister=r(B,!0),this._aes=new w(F)};I.prototype.encrypt=function(F){if(F.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var B=r(F,!0),O,G=0;G<B.length;G+=this.segmentSize){O=this._aes.encrypt(this._shiftRegister);for(var U=0;U<this.segmentSize;U++)B[G+U]^=O[U];s(this._shiftRegister,this._shiftRegister,0,this.segmentSize),s(B,this._shiftRegister,16-this.segmentSize,G,G+this.segmentSize)}return B},I.prototype.decrypt=function(F){if(F.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var B=r(F,!0),O,G=0;G<B.length;G+=this.segmentSize){O=this._aes.encrypt(this._shiftRegister);for(var U=0;U<this.segmentSize;U++)B[G+U]^=O[U];s(this._shiftRegister,this._shiftRegister,0,this.segmentSize),s(F,this._shiftRegister,16-this.segmentSize,G,G+this.segmentSize)}return B};var M=function(F,B){if(!(this instanceof M))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",!B)B=i(16);else if(B.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastPrecipher=r(B,!0),this._lastPrecipherIndex=16,this._aes=new w(F)};M.prototype.encrypt=function(F){for(var B=r(F,!0),O=0;O<B.length;O++)this._lastPrecipherIndex===16&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),B[O]^=this._lastPrecipher[this._lastPrecipherIndex++];return B},M.prototype.decrypt=M.prototype.encrypt;var T=function(F){if(!(this instanceof T))throw Error("Counter must be instanitated with `new`");F!==0&&!F&&(F=1),typeof F=="number"?(this._counter=i(16),this.setValue(F)):this.setBytes(F)};T.prototype.setValue=function(F){if(typeof F!="number"||parseInt(F)!=F)throw new Error("invalid counter value (must be an integer)");if(F>Number.MAX_SAFE_INTEGER)throw new Error("integer value out of safe range");for(var B=15;B>=0;--B)this._counter[B]=F%256,F=parseInt(F/256)},T.prototype.setBytes=function(F){if(F=r(F,!0),F.length!=16)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=F},T.prototype.increment=function(){for(var F=15;F>=0;F--)if(this._counter[F]===255)this._counter[F]=0;else{this._counter[F]++;break}};var R=function(F,B){if(!(this instanceof R))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",B instanceof T||(B=new T(B)),this._counter=B,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new w(F)};R.prototype.encrypt=function(F){for(var B=r(F,!0),O=0;O<B.length;O++)this._remainingCounterIndex===16&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),B[O]^=this._remainingCounter[this._remainingCounterIndex++];return B},R.prototype.decrypt=R.prototype.encrypt;function P(F){F=r(F,!0);var B=16-F.length%16,O=i(F.length+B);s(F,O);for(var G=F.length;G<O.length;G++)O[G]=B;return O}function D(F){if(F=r(F,!0),F.length<16)throw new Error("PKCS#7 invalid length");var B=F[F.length-1];if(B>16)throw new Error("PKCS#7 padding byte out of range");for(var O=F.length-B,G=0;G<B;G++)if(F[O+G]!==B)throw new Error("PKCS#7 invalid padding byte");var U=i(O);return s(F,U,0,0,O),U}var N={AES:w,Counter:T,ModeOfOperation:{ecb:A,cbc:E,cfb:I,ofb:M,ctr:R},utils:{hex:a,utf8:o},padding:{pkcs7:{pad:P,strip:D}},_arrayTest:{coerceArray:r,createArray:i,copyArray:s}};typeof uv<"u"?UD.exports=N:typeof define=="function"&&define.amd?define([],function(){return N}):(n.aesjs&&(N._aesjs=n.aesjs),n.aesjs=N)})(uv)});var v6=ut(_6=>{_6.remove=Mj;var b6=[{base:" ",chars:"\xA0"},{base:"0",chars:"\u07C0"},{base:"A",chars:"\u24B6\uFF21\xC0\xC1\xC2\u1EA6\u1EA4\u1EAA\u1EA8\xC3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\xC4\u01DE\u1EA2\xC5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F"},{base:"AA",chars:"\uA732"},{base:"AE",chars:"\xC6\u01FC\u01E2"},{base:"AO",chars:"\uA734"},{base:"AU",chars:"\uA736"},{base:"AV",chars:"\uA738\uA73A"},{base:"AY",chars:"\uA73C"},{base:"B",chars:"\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0181"},{base:"C",chars:"\u24B8\uFF23\uA73E\u1E08\u0106C\u0108\u010A\u010C\xC7\u0187\u023B"},{base:"D",chars:"\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018A\u0189\u1D05\uA779"},{base:"Dh",chars:"\xD0"},{base:"DZ",chars:"\u01F1\u01C4"},{base:"Dz",chars:"\u01F2\u01C5"},{base:"E",chars:"\u025B\u24BA\uFF25\xC8\xC9\xCA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\xCB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E\u1D07"},{base:"F",chars:"\uA77C\u24BB\uFF26\u1E1E\u0191\uA77B"},{base:"G",chars:"\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E\u0262"},{base:"H",chars:"\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D"},{base:"I",chars:"\u24BE\uFF29\xCC\xCD\xCE\u0128\u012A\u012C\u0130\xCF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197"},{base:"J",chars:"\u24BF\uFF2A\u0134\u0248\u0237"},{base:"K",chars:"\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2"},{base:"L",chars:"\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780"},{base:"LJ",chars:"\u01C7"},{base:"Lj",chars:"\u01C8"},{base:"M",chars:"\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C\u03FB"},{base:"N",chars:"\uA7A4\u0220\u24C3\uFF2E\u01F8\u0143\xD1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u019D\uA790\u1D0E"},{base:"NJ",chars:"\u01CA"},{base:"Nj",chars:"\u01CB"},{base:"O",chars:"\u24C4\uFF2F\xD2\xD3\xD4\u1ED2\u1ED0\u1ED6\u1ED4\xD5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\xD6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\xD8\u01FE\u0186\u019F\uA74A\uA74C"},{base:"OE",chars:"\u0152"},{base:"OI",chars:"\u01A2"},{base:"OO",chars:"\uA74E"},{base:"OU",chars:"\u0222"},{base:"P",chars:"\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754"},{base:"Q",chars:"\u24C6\uFF31\uA756\uA758\u024A"},{base:"R",chars:"\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782"},{base:"S",chars:"\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784"},{base:"T",chars:"\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786"},{base:"Th",chars:"\xDE"},{base:"TZ",chars:"\uA728"},{base:"U",chars:"\u24CA\uFF35\xD9\xDA\xDB\u0168\u1E78\u016A\u1E7A\u016C\xDC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244"},{base:"V",chars:"\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245"},{base:"VY",chars:"\uA760"},{base:"W",chars:"\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72"},{base:"X",chars:"\u24CD\uFF38\u1E8A\u1E8C"},{base:"Y",chars:"\u24CE\uFF39\u1EF2\xDD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE"},{base:"Z",chars:"\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762"},{base:"a",chars:"\u24D0\uFF41\u1E9A\xE0\xE1\xE2\u1EA7\u1EA5\u1EAB\u1EA9\xE3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\xE4\u01DF\u1EA3\xE5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250\u0251"},{base:"aa",chars:"\uA733"},{base:"ae",chars:"\xE6\u01FD\u01E3"},{base:"ao",chars:"\uA735"},{base:"au",chars:"\uA737"},{base:"av",chars:"\uA739\uA73B"},{base:"ay",chars:"\uA73D"},{base:"b",chars:"\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253\u0182"},{base:"c",chars:"\uFF43\u24D2\u0107\u0109\u010B\u010D\xE7\u1E09\u0188\u023C\uA73F\u2184"},{base:"d",chars:"\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\u018B\u13E7\u0501\uA7AA"},{base:"dh",chars:"\xF0"},{base:"dz",chars:"\u01F3\u01C6"},{base:"e",chars:"\u24D4\uFF45\xE8\xE9\xEA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\xEB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u01DD"},{base:"f",chars:"\u24D5\uFF46\u1E1F\u0192"},{base:"ff",chars:"\uFB00"},{base:"fi",chars:"\uFB01"},{base:"fl",chars:"\uFB02"},{base:"ffi",chars:"\uFB03"},{base:"ffl",chars:"\uFB04"},{base:"g",chars:"\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\uA77F\u1D79"},{base:"h",chars:"\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265"},{base:"hv",chars:"\u0195"},{base:"i",chars:"\u24D8\uFF49\xEC\xED\xEE\u0129\u012B\u012D\xEF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131"},{base:"j",chars:"\u24D9\uFF4A\u0135\u01F0\u0249"},{base:"k",chars:"\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3"},{base:"l",chars:"\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747\u026D"},{base:"lj",chars:"\u01C9"},{base:"m",chars:"\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F"},{base:"n",chars:"\u24DD\uFF4E\u01F9\u0144\xF1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5\u043B\u0509"},{base:"nj",chars:"\u01CC"},{base:"o",chars:"\u24DE\uFF4F\xF2\xF3\xF4\u1ED3\u1ED1\u1ED7\u1ED5\xF5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\xF6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\xF8\u01FF\uA74B\uA74D\u0275\u0254\u1D11"},{base:"oe",chars:"\u0153"},{base:"oi",chars:"\u01A3"},{base:"oo",chars:"\uA74F"},{base:"ou",chars:"\u0223"},{base:"p",chars:"\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755\u03C1"},{base:"q",chars:"\u24E0\uFF51\u024B\uA757\uA759"},{base:"r",chars:"\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783"},{base:"s",chars:"\u24E2\uFF53\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B\u0282"},{base:"ss",chars:"\xDF"},{base:"t",chars:"\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787"},{base:"th",chars:"\xFE"},{base:"tz",chars:"\uA729"},{base:"u",chars:"\u24E4\uFF55\xF9\xFA\xFB\u0169\u1E79\u016B\u1E7B\u016D\xFC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289"},{base:"v",chars:"\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C"},{base:"vy",chars:"\uA761"},{base:"w",chars:"\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73"},{base:"x",chars:"\u24E7\uFF58\u1E8B\u1E8D"},{base:"y",chars:"\u24E8\uFF59\u1EF3\xFD\u0177\u1EF9\u0233\u1E8F\xFF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF"},{base:"z",chars:"\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763"}],fv={};for(lh=0;lh<b6.length;lh+=1)for(dv=b6[lh].chars,x6=0;x6<dv.length;x6+=1)fv[dv[x6]]=b6[lh].base;var dv,x6,lh;function Mj(n){return n.replace(/[^\u0000-\u007e]/g,function(e){return fv[e]||e})}_6.replacementList=b6;_6.diacriticsMap=fv});var _2=ut((vde,SR)=>{"use strict";SR.exports=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,i,s;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(i=r;i--!==0;)if(!n(e[i],t[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(s=Object.keys(e),r=s.length,r!==Object.keys(t).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[i]))return!1;for(i=r;i--!==0;){var o=s[i];if(!n(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}});var _m=ut(sl=>{"use strict";Object.defineProperty(sl,"__esModule",{value:!0});sl.getWaybackConfigFileURL=sl.getWaybackServiceBaseURL=sl.setDefaultWaybackOptions=void 0;var pq="https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer",mq="https://waybackdev.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer",gq="https://s3-us-west-2.amazonaws.com/config.maptiles.arcgis.com/waybackconfig.json",yq="https://s3-us-west-2.amazonaws.com/config.maptiles.arcgis.com/dev/waybackconfig.json",qv=!1,xq=n=>{qv=n.useDevServices||!1};sl.setDefaultWaybackOptions=xq;var bq=()=>qv?mq:pq;sl.getWaybackServiceBaseURL=bq;var _q=()=>qv?yq:gq;sl.getWaybackConfigFileURL=_q});var Yv=ut(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0});So.tile2lat=So.tile2Long=So.lat2tile=So.long2tile=void 0;var vq=(n,e)=>Math.floor((n+180)/360*Math.pow(2,e));So.long2tile=vq;var wq=(n,e)=>Math.floor((1-Math.log(Math.tan(n*Math.PI/180)+1/Math.cos(n*Math.PI/180))/Math.PI)/2*Math.pow(2,e));So.lat2tile=wq;var Sq=(n,e)=>n/Math.pow(2,e)*360-180;So.tile2Long=Sq;var Cq=(n,e)=>{let t=Math.PI-2*Math.PI*n/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(t)-Math.exp(-t)))};So.tile2lat=Cq});var CR=ut(vm=>{"use strict";Object.defineProperty(vm,"__esModule",{value:!0});vm.areUint8ArraysEqual=void 0;var Aq=(n,e)=>{if(n.length!==e.length)return!1;for(let t=n.length-1;t>=0;t--)if(n[t]!==e[t])return!1;return!0};vm.areUint8ArraysEqual=Aq});var AR=ut(wm=>{"use strict";Object.defineProperty(wm,"__esModule",{value:!0});wm.extractDateFromWaybackItemTitle=void 0;var Eq=(n="")=>{let e=n.split("-"),t=+e[0],r=+e[1]-1,i=+e[2];return new Date(t,r,i)},Tq=(n="")=>{let e=/\d{4}-\d{2}-\d{2}/g,t=n.match(e),r=t.length?t[0]:n,i=Eq(r);return{releaseDateLabel:r,releaseDatetime:i.getTime()}};wm.extractDateFromWaybackItemTitle=Tq});var Cm=ut(_i=>{"use strict";var Kv=_i&&_i.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(_i,"__esModule",{value:!0});_i.getWaybackItemByReleaseNumber=_i.getWaybackItems=_i.getWaybackConfigData=_i.setWaybackConfigData=void 0;var kq=_m(),Iq=AR(),Dc=null,v2=null,Sm=null,Pq=n=>{Dc=n};_i.setWaybackConfigData=Pq;var Dq=()=>Kv(void 0,void 0,void 0,function*(){if(Dc)return Dc;let n=(0,kq.getWaybackConfigFileURL)(),e=yield fetch(n);if(!e.ok)throw new Error("failed to fetch wayback config file");return Dc=yield e.json(),Dc});_i.getWaybackConfigData=Dq;var Mq=()=>Kv(void 0,void 0,void 0,function*(){if(v2)return v2;let n=yield(0,_i.getWaybackConfigData)();return v2=Object.keys(n).map(e=>{let t=+e,r=Dc[t];if(!Dc[t])return null;let{itemTitle:i}=r,{releaseDateLabel:s,releaseDatetime:o}=(0,Iq.extractDateFromWaybackItemTitle)(i)||{};return Object.assign({releaseNum:t,releaseDateLabel:s,releaseDatetime:o},r)}),v2=v2.filter(e=>e!==null).sort((e,t)=>t.releaseDatetime-e.releaseDatetime),v2});_i.getWaybackItems=Mq;var Rq=n=>Kv(void 0,void 0,void 0,function*(){if(!Sm){let e=yield(0,_i.getWaybackItems)();Sm=new Map;for(let t of e)Sm.set(t.releaseNum,t)}return Sm.get(n)});_i.getWaybackItemByReleaseNumber=Rq});var TR=ut(S2=>{"use strict";var w2=S2&&S2.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(S2,"__esModule",{value:!0});S2.getWaybackItemsWithLocalChanges=void 0;var Fq=_m(),ER=Yv(),Bq=CR(),Em=Cm(),Am=null,Nq=(n,e,t)=>w2(void 0,void 0,void 0,function*(){let{longitude:r,latitude:i}=n,s=+e.toFixed(0),o=(0,ER.long2tile)(r,s),a=(0,ER.lat2tile)(i,s),l=yield Uq({column:o,row:a,level:s}),c=[];for(let f of l){let{itemURL:h}=yield(0,Em.getWaybackItemByReleaseNumber)(f),p={releaseNumber:f,url:Oq(h,{column:o,row:a,level:s})};c.push(p)}let u=yield Gq(c),d=[];for(let f of u){let h=yield(0,Em.getWaybackItemByReleaseNumber)(f);d.push(h)}return new Promise((f,h)=>{if(t&&t?.signal.aborted){h("Task aborterd: getWaybackItemsWithLocalChanges has been aborterd by the user.");return}f(d)})});S2.getWaybackItemsWithLocalChanges=Nq;var Oq=(n,{column:e=null,row:t=null,level:r=null})=>n.replace("{level}",r.toString()).replace("{row}",t.toString()).replace("{col}",e.toString()),Lq=n=>w2(void 0,void 0,void 0,function*(){let e=yield(0,Em.getWaybackItems)();Am||(Am=new Map,e.forEach((i,s)=>{Am.set(i.releaseNum,s)}));let t=Am.get(n),r=e[t+1]?e[t+1]:null;return r?.releaseNum||null}),Uq=({column:n=null,row:e=null,level:t=null})=>w2(void 0,void 0,void 0,function*(){let r=yield(0,Em.getWaybackItems)();return new Promise((i,s)=>{let o=[],a=r[0].releaseNum,l=(0,Fq.getWaybackServiceBaseURL)(),c=u=>w2(void 0,void 0,void 0,function*(){try{let d=`${l}/tilemap/${u}/${t}/${e}/${n}`,h=yield(yield fetch(d)).json(),p=h.select&&h.select[0]?+h.select[0]:u;h.data[0]&&o.push(p);let m=h.data[0]?yield Lq(p):null;m?c(m):i(o)}catch(d){console.error(d),s(null)}});c(a)})}),Gq=n=>w2(void 0,void 0,void 0,function*(){if(!n.length)return[];let e=n.reverse().map(r=>$q(r.url,r.releaseNumber)),t=[];try{let r=yield Promise.all(e);for(let i of r){let s=t[t.length-1];s&&(0,Bq.areUint8ArraysEqual)(s.data,i.data)||t.push(i)}}catch(r){console.error("failed to fetch all image data uri",r)}return t.map(r=>r.releaseNumber)}),$q=(n,e)=>w2(void 0,void 0,void 0,function*(){return new Promise((t,r)=>{let i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer",i.onload=function(){if(this.status==200){let s=new Uint8Array(this.response);t({releaseNumber:e,data:s})}else r()},i.send()})})});var kR=ut(Tm=>{"use strict";Object.defineProperty(Tm,"__esModule",{value:!0});Tm.METADATA_FIELD_NAMES=void 0;Tm.METADATA_FIELD_NAMES={SOURCE_DATE:"SRC_DATE2",SOURCE_PROVIDER:"NICE_DESC",SOURCE_NAME:"SRC_DESC",RESOLUTION:"SAMP_RES",ACCURACY:"SRC_ACC"}});var NR=ut(C2=>{"use strict";var BR=C2&&C2.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};Object.defineProperty(C2,"__esModule",{value:!0});C2.getMetadata=void 0;var zq=Cm(),Hq=kR(),IR=23,Wq=10,{SOURCE_DATE:PR,SOURCE_PROVIDER:DR,SOURCE_NAME:MR,RESOLUTION:RR,ACCURACY:FR}=Hq.METADATA_FIELD_NAMES,Vq=(n,e,t)=>BR(void 0,void 0,void 0,function*(){if(!n||!e||!t)throw new Error("Failed to query metadata because the required parameters are missing");let{longitude:r,latitude:i}=n,s=new URLSearchParams({f:"json",where:"1=1",outFields:[PR,DR,MR,RR,FR].join(","),geometry:JSON.stringify({spatialReference:{wkid:4326},x:r,y:i}),returnGeometry:"false",geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelIntersects"}),o=yield jq(t,e),a=yield fetch(`${o}?${s.toString()}`);if(!a.ok)throw new Error("failed to query metadata for "+t+" release of world imagery wayback");let l=yield a.json();if(l.error)throw l.error;let c=l.features&&l.features.length?l.features[0]:null;if(!c)return null;let{attributes:u}=c,d=u[PR],f=u[DR],h=u[MR],p=u[RR],m=u[FR];return{date:d,provider:f,source:h,resolution:p,accuracy:m}});C2.getMetadata=Vq;var jq=(n,e)=>BR(void 0,void 0,void 0,function*(){let t=yield(0,zq.getWaybackItemByReleaseNumber)(n);if(!t)throw new Error(`failed to find wayback item that with release number of ${n}`);let{metadataLayerUrl:r}=t,i=Xq(e);return`${r}/${i}/query`}),Xq=n=>{let e=IR-n,t=IR-Wq;return e>t?t:e}});var OR=ut(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.tile2lat=gr.tile2Long=gr.lat2tile=gr.long2tile=gr.setDefaultWaybackOptions=gr.getMetadata=gr.getWaybackItemByReleaseNumber=gr.getWaybackItems=gr.getWaybackItemsWithLocalChanges=gr.setWaybackConfigData=gr.getWaybackConfigData=void 0;var qq=TR();Object.defineProperty(gr,"getWaybackItemsWithLocalChanges",{enumerable:!0,get:function(){return qq.getWaybackItemsWithLocalChanges}});var Yq=NR();Object.defineProperty(gr,"getMetadata",{enumerable:!0,get:function(){return Yq.getMetadata}});var km=Cm();Object.defineProperty(gr,"getWaybackConfigData",{enumerable:!0,get:function(){return km.getWaybackConfigData}});Object.defineProperty(gr,"setWaybackConfigData",{enumerable:!0,get:function(){return km.setWaybackConfigData}});Object.defineProperty(gr,"getWaybackItems",{enumerable:!0,get:function(){return km.getWaybackItems}});Object.defineProperty(gr,"getWaybackItemByReleaseNumber",{enumerable:!0,get:function(){return km.getWaybackItemByReleaseNumber}});var Kq=_m();Object.defineProperty(gr,"setDefaultWaybackOptions",{enumerable:!0,get:function(){return Kq.setDefaultWaybackOptions}});var Im=Yv();Object.defineProperty(gr,"long2tile",{enumerable:!0,get:function(){return Im.long2tile}});Object.defineProperty(gr,"lat2tile",{enumerable:!0,get:function(){return Im.lat2tile}});Object.defineProperty(gr,"tile2Long",{enumerable:!0,get:function(){return Im.tile2Long}});Object.defineProperty(gr,"tile2lat",{enumerable:!0,get:function(){return Im.tile2lat}})});var z,ew,B2,ke,ee=$(()=>{"use strict";z=(n=>(n.Application="application",n.WebGLPipes="webgl-pipes",n.WebGLPipesAdaptor="webgl-pipes-adaptor",n.WebGLSystem="webgl-system",n.WebGPUPipes="webgpu-pipes",n.WebGPUPipesAdaptor="webgpu-pipes-adaptor",n.WebGPUSystem="webgpu-system",n.CanvasSystem="canvas-system",n.CanvasPipesAdaptor="canvas-pipes-adaptor",n.CanvasPipes="canvas-pipes",n.Asset="asset",n.LoadParser="load-parser",n.ResolveParser="resolve-parser",n.CacheParser="cache-parser",n.DetectionParser="detection-parser",n.MaskEffect="mask-effect",n.BlendMode="blend-mode",n.TextureSource="texture-source",n.Environment="environment",n.ShapeBuilder="shape-builder",n.Batcher="batcher",n))(z||{}),ew=n=>{if(typeof n=="function"||typeof n=="object"&&n.extension){if(!n.extension)throw new Error("Extension class must have an extension object");n={...typeof n.extension!="object"?{type:n.extension}:n.extension,ref:n}}if(typeof n=="object")n={...n};else throw new Error("Invalid extension type");return typeof n.type=="string"&&(n.type=[n.type]),n},B2=(n,e)=>ew(n).priority??e,ke={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...n){return n.map(ew).forEach(e=>{e.type.forEach(t=>this._removeHandlers[t]?.(e))}),this},add(...n){return n.map(ew).forEach(e=>{e.type.forEach(t=>{let r=this._addHandlers,i=this._queue;r[t]?r[t]?.(e):(i[t]=i[t]||[],i[t]?.push(e))})}),this},handle(n,e,t){let r=this._addHandlers,i=this._removeHandlers;if(r[n]||i[n])throw new Error(`Extension type ${n} already has a handler`);r[n]=e,i[n]=t;let s=this._queue;return s[n]&&(s[n]?.forEach(o=>e(o)),delete s[n]),this},handleByMap(n,e){return this.handle(n,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByNamedList(n,e,t=-1){return this.handle(n,r=>{e.findIndex(s=>s.name===r.name)>=0||(e.push({name:r.name,value:r.ref}),e.sort((s,o)=>B2(o.value,t)-B2(s.value,t)))},r=>{let i=e.findIndex(s=>s.name===r.name);i!==-1&&e.splice(i,1)})},handleByList(n,e,t=-1){return this.handle(n,r=>{e.includes(r.ref)||(e.push(r.ref),e.sort((i,s)=>B2(s,t)-B2(i,t)))},r=>{let i=e.indexOf(r.ref);i!==-1&&e.splice(i,1)})}}});var KR=ut((F4e,tw)=>{"use strict";var aY=Object.prototype.hasOwnProperty,ni="~";function Rh(){}Object.create&&(Rh.prototype=Object.create(null),new Rh().__proto__||(ni=!1));function lY(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function YR(n,e,t,r,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new lY(t,r||n,i),o=ni?ni+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],s]:n._events[o].push(s):(n._events[o]=s,n._eventsCount++),n}function Wm(n,e){--n._eventsCount===0?n._events=new Rh:delete n._events[e]}function Bn(){this._events=new Rh,this._eventsCount=0}Bn.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)aY.call(t,r)&&e.push(ni?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Bn.prototype.listeners=function(e){var t=ni?ni+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o};Bn.prototype.listenerCount=function(e){var t=ni?ni+e:e,r=this._events[t];return r?r.fn?1:r.length:0};Bn.prototype.emit=function(e,t,r,i,s,o){var a=ni?ni+e:e;if(!this._events[a])return!1;var l=this._events[a],c=arguments.length,u,d;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,s),!0;case 6:return l.fn.call(l.context,t,r,i,s,o),!0}for(d=1,u=new Array(c-1);d<c;d++)u[d-1]=arguments[d];l.fn.apply(l.context,u)}else{var f=l.length,h;for(d=0;d<f;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),c){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,r);break;case 4:l[d].fn.call(l[d].context,t,r,i);break;default:if(!u)for(h=1,u=new Array(c-1);h<c;h++)u[h-1]=arguments[h];l[d].fn.apply(l[d].context,u)}}return!0};Bn.prototype.on=function(e,t,r){return YR(this,e,t,r,!1)};Bn.prototype.once=function(e,t,r){return YR(this,e,t,r,!0)};Bn.prototype.removeListener=function(e,t,r,i){var s=ni?ni+e:e;if(!this._events[s])return this;if(!t)return Wm(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!r||o.context===r)&&Wm(this,s);else{for(var a=0,l=[],c=o.length;a<c;a++)(o[a].fn!==t||i&&!o[a].once||r&&o[a].context!==r)&&l.push(o[a]);l.length?this._events[s]=l.length===1?l[0]:l:Wm(this,s)}return this};Bn.prototype.removeAllListeners=function(e){var t;return e?(t=ni?ni+e:e,this._events[t]&&Wm(this,t)):(this._events=new Rh,this._eventsCount=0),this};Bn.prototype.off=Bn.prototype.removeListener;Bn.prototype.addListener=Bn.prototype.on;Bn.prefixed=ni;Bn.EventEmitter=Bn;typeof tw<"u"&&(tw.exports=Bn)});var QR,st,Nn=$(()=>{QR=Ot(KR(),1),st=QR.default});var cY,ya,ln,us,sF,ZR,rw,uY,Vm,oF,aF,JR,eF,tF,Fh,dY,fY,hY,pY,sw,rF,mY,nw,iw,nF,ow,zs,iF,lF,cF=$(()=>{cY={grad:.9,turn:360,rad:360/(2*Math.PI)},ya=function(n){return typeof n=="string"?n.length>0:typeof n=="number"},ln=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*n)/t+0},us=function(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),n>t?t:n>e?n:e},sF=function(n){return(n=isFinite(n)?n%360:0)>0?n:n+360},ZR=function(n){return{r:us(n.r,0,255),g:us(n.g,0,255),b:us(n.b,0,255),a:us(n.a)}},rw=function(n){return{r:ln(n.r),g:ln(n.g),b:ln(n.b),a:ln(n.a,3)}},uY=/^#([0-9a-f]{3,8})$/i,Vm=function(n){var e=n.toString(16);return e.length<2?"0"+e:e},oF=function(n){var e=n.r,t=n.g,r=n.b,i=n.a,s=Math.max(e,t,r),o=s-Math.min(e,t,r),a=o?s===e?(t-r)/o:s===t?2+(r-e)/o:4+(e-t)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:i}},aF=function(n){var e=n.h,t=n.s,r=n.v,i=n.a;e=e/360*6,t/=100,r/=100;var s=Math.floor(e),o=r*(1-t),a=r*(1-(e-s)*t),l=r*(1-(1-e+s)*t),c=s%6;return{r:255*[r,a,o,o,l,r][c],g:255*[l,r,r,a,o,o][c],b:255*[o,o,l,r,r,a][c],a:i}},JR=function(n){return{h:sF(n.h),s:us(n.s,0,100),l:us(n.l,0,100),a:us(n.a)}},eF=function(n){return{h:ln(n.h),s:ln(n.s),l:ln(n.l),a:ln(n.a,3)}},tF=function(n){return aF((t=(e=n).s,{h:e.h,s:(t*=((r=e.l)<50?r:100-r)/100)>0?2*t/(r+t)*100:0,v:r+t,a:e.a}));var e,t,r},Fh=function(n){return{h:(e=oF(n)).h,s:(i=(200-(t=e.s))*(r=e.v)/100)>0&&i<200?t*r/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,t,r,i},dY=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,fY=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,hY=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,pY=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,sw={string:[[function(n){var e=uY.exec(n);return e?(n=e[1]).length<=4?{r:parseInt(n[0]+n[0],16),g:parseInt(n[1]+n[1],16),b:parseInt(n[2]+n[2],16),a:n.length===4?ln(parseInt(n[3]+n[3],16)/255,2):1}:n.length===6||n.length===8?{r:parseInt(n.substr(0,2),16),g:parseInt(n.substr(2,2),16),b:parseInt(n.substr(4,2),16),a:n.length===8?ln(parseInt(n.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(n){var e=hY.exec(n)||pY.exec(n);return e?e[2]!==e[4]||e[4]!==e[6]?null:ZR({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(n){var e=dY.exec(n)||fY.exec(n);if(!e)return null;var t,r,i=JR({h:(t=e[1],r=e[2],r===void 0&&(r="deg"),Number(t)*(cY[r]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return tF(i)},"hsl"]],object:[[function(n){var e=n.r,t=n.g,r=n.b,i=n.a,s=i===void 0?1:i;return ya(e)&&ya(t)&&ya(r)?ZR({r:Number(e),g:Number(t),b:Number(r),a:Number(s)}):null},"rgb"],[function(n){var e=n.h,t=n.s,r=n.l,i=n.a,s=i===void 0?1:i;if(!ya(e)||!ya(t)||!ya(r))return null;var o=JR({h:Number(e),s:Number(t),l:Number(r),a:Number(s)});return tF(o)},"hsl"],[function(n){var e=n.h,t=n.s,r=n.v,i=n.a,s=i===void 0?1:i;if(!ya(e)||!ya(t)||!ya(r))return null;var o=function(a){return{h:sF(a.h),s:us(a.s,0,100),v:us(a.v,0,100),a:us(a.a)}}({h:Number(e),s:Number(t),v:Number(r),a:Number(s)});return aF(o)},"hsv"]]},rF=function(n,e){for(var t=0;t<e.length;t++){var r=e[t][0](n);if(r)return[r,e[t][1]]}return[null,void 0]},mY=function(n){return typeof n=="string"?rF(n.trim(),sw.string):typeof n=="object"&&n!==null?rF(n,sw.object):[null,void 0]},nw=function(n,e){var t=Fh(n);return{h:t.h,s:us(t.s+100*e,0,100),l:t.l,a:t.a}},iw=function(n){return(299*n.r+587*n.g+114*n.b)/1e3/255},nF=function(n,e){var t=Fh(n);return{h:t.h,s:t.s,l:us(t.l+100*e,0,100),a:t.a}},ow=function(){function n(e){this.parsed=mY(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return n.prototype.isValid=function(){return this.parsed!==null},n.prototype.brightness=function(){return ln(iw(this.rgba),2)},n.prototype.isDark=function(){return iw(this.rgba)<.5},n.prototype.isLight=function(){return iw(this.rgba)>=.5},n.prototype.toHex=function(){return e=rw(this.rgba),t=e.r,r=e.g,i=e.b,o=(s=e.a)<1?Vm(ln(255*s)):"","#"+Vm(t)+Vm(r)+Vm(i)+o;var e,t,r,i,s,o},n.prototype.toRgb=function(){return rw(this.rgba)},n.prototype.toRgbString=function(){return e=rw(this.rgba),t=e.r,r=e.g,i=e.b,(s=e.a)<1?"rgba("+t+", "+r+", "+i+", "+s+")":"rgb("+t+", "+r+", "+i+")";var e,t,r,i,s},n.prototype.toHsl=function(){return eF(Fh(this.rgba))},n.prototype.toHslString=function(){return e=eF(Fh(this.rgba)),t=e.h,r=e.s,i=e.l,(s=e.a)<1?"hsla("+t+", "+r+"%, "+i+"%, "+s+")":"hsl("+t+", "+r+"%, "+i+"%)";var e,t,r,i,s},n.prototype.toHsv=function(){return e=oF(this.rgba),{h:ln(e.h),s:ln(e.s),v:ln(e.v),a:ln(e.a,3)};var e},n.prototype.invert=function(){return zs({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},n.prototype.saturate=function(e){return e===void 0&&(e=.1),zs(nw(this.rgba,e))},n.prototype.desaturate=function(e){return e===void 0&&(e=.1),zs(nw(this.rgba,-e))},n.prototype.grayscale=function(){return zs(nw(this.rgba,-1))},n.prototype.lighten=function(e){return e===void 0&&(e=.1),zs(nF(this.rgba,e))},n.prototype.darken=function(e){return e===void 0&&(e=.1),zs(nF(this.rgba,-e))},n.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},n.prototype.alpha=function(e){return typeof e=="number"?zs({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):ln(this.rgba.a,3);var t},n.prototype.hue=function(e){var t=Fh(this.rgba);return typeof e=="number"?zs({h:e,s:t.s,l:t.l,a:t.a}):ln(t.h)},n.prototype.isEqual=function(e){return this.toHex()===zs(e).toHex()},n}(),zs=function(n){return n instanceof ow?n:new ow(n)},iF=[],lF=function(n){n.forEach(function(e){iF.indexOf(e)<0&&(e(ow,sw),iF.push(e))})}});function uF(n,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var i in t)r[t[i]]=i;var s={};n.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=r[this.toHex()];if(c)return c;if(o?.closest){var u=this.toRgb(),d=1/0,f="black";if(!s.length)for(var h in t)s[h]=new n(t[h]).toRgb();for(var p in t){var m=(a=u,l=s[p],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));m<d&&(d=m,f=p)}return f}},e.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":t[a];return l?new n(l).toRgb():null},"name"])}var dF=$(()=>{});var N2,ce,nn=$(()=>{cF();dF();lF([uF]);N2=class Bh{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Bh)this._value=this._cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,e))&&(this._value=this._cloneSource(e),this._normalize(this._value))}}get value(){return this._value}_cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}_isSourceEqual(e,t){let r=typeof e;if(r!==typeof t)return!1;if(r==="number"||r==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((s,o)=>s===t[o]);if(e!==null&&t!==null){let s=Object.keys(e),o=Object.keys(t);return s.length!==o.length?!1:s.every(a=>e[a]===t[a])}return e===t}toRgba(){let[e,t,r,i]=this._components;return{r:e,g:t,b:r,a:i}}toRgb(){let[e,t,r]=this._components;return{r:e,g:t,b:r}}toRgbaString(){let[e,t,r]=this.toUint8RgbArray();return`rgba(${e},${t},${r},${this.alpha})`}toUint8RgbArray(e){let[t,r,i]=this._components;return this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb),e[0]=Math.round(t*255),e[1]=Math.round(r*255),e[2]=Math.round(i*255),e}toArray(e){this._arrayRgba||(this._arrayRgba=[]),e||(e=this._arrayRgba);let[t,r,i,s]=this._components;return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}toRgbArray(e){this._arrayRgb||(this._arrayRgb=[]),e||(e=this._arrayRgb);let[t,r,i]=this._components;return e[0]=t,e[1]=r,e[2]=i,e}toNumber(){return this._int}toBgrNumber(){let[e,t,r]=this.toUint8RgbArray();return(r<<16)+(t<<8)+e}toLittleEndianNumber(){let e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){let[t,r,i,s]=Bh._temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=r,this._components[2]*=i,this._components[3]*=s,this._refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this._refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let r=this._int>>16&255,i=this._int>>8&255,s=this._int&255;return t&&(r=r*e+.5|0,i=i*e+.5|0,s=s*e+.5|0),(e*255<<24)+(r<<16)+(i<<8)+s}toHex(){let e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){let t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(e){return this._components[3]=this._clamp(e),this}_normalize(e){let t,r,i,s;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){let o=e;t=(o>>16&255)/255,r=(o>>8&255)/255,i=(o&255)/255,s=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,r,i,s=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,r,i,s=255]=e,t/=255,r/=255,i/=255,s/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){let a=Bh.HEX_PATTERN.exec(e);a&&(e=`#${a[2]}`)}let o=zs(e);o.isValid()&&({r:t,g:r,b:i,a:s}=o.rgba,t/=255,r/=255,i/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=r,this._components[2]=i,this._components[3]=s,this._refreshInt();else throw new Error(`Unable to convert color ${e}`)}_refreshInt(){this._clamp(this._components);let[e,t,r]=this._components;this._int=(e*255<<16)+(t*255<<8)+(r*255|0)}_clamp(e,t=0,r=1){return typeof e=="number"?Math.min(Math.max(e,t),r):(e.forEach((i,s)=>{e[s]=Math.min(Math.max(i,t),r)}),e)}static isColorLike(e){return typeof e=="number"||typeof e=="string"||e instanceof Number||e instanceof Bh||Array.isArray(e)||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e.r!==void 0&&e.g!==void 0&&e.b!==void 0||e.r!==void 0&&e.g!==void 0&&e.b!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0||e.h!==void 0&&e.s!==void 0&&e.l!==void 0&&e.a!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0||e.h!==void 0&&e.s!==void 0&&e.v!==void 0&&e.a!==void 0}};N2.shared=new N2;N2._temp=new N2;N2.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;ce=N2});var jm,aw=$(()=>{"use strict";jm={cullArea:null,cullable:!1,cullableChildren:!0}});var Xm,qm,ds,Ym=$(()=>{"use strict";Xm=Math.PI*2,qm=180/Math.PI,ds=Math.PI/180});var Ve,lw,vi=$(()=>{"use strict";Ve=class n{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new n(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return lw.x=0,lw.y=0,lw}},lw=new Ve});var ue,gY,yY,Ct=$(()=>{Ym();vi();ue=class n{constructor(e=1,t=0,r=0,i=1,s=0,o=0){this.array=null,this.a=e,this.b=t,this.c=r,this.d=i,this.tx=s,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,r,i,s,o){return this.a=e,this.b=t,this.c=r,this.d=i,this.tx=s,this.ty=o,this}toArray(e,t){this.array||(this.array=new Float32Array(9));let r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,t){t=t||new Ve;let r=e.x,i=e.y;return t.x=this.a*r+this.c*i+this.tx,t.y=this.b*r+this.d*i+this.ty,t}applyInverse(e,t){t=t||new Ve;let r=this.a,i=this.b,s=this.c,o=this.d,a=this.tx,l=this.ty,c=1/(r*o+s*-i),u=e.x,d=e.y;return t.x=o*c*u+-s*c*d+(l*s-a*o)*c,t.y=r*c*d+-i*c*u+(-l*r+a*i)*c,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){let t=Math.cos(e),r=Math.sin(e),i=this.a,s=this.c,o=this.tx;return this.a=i*t-this.b*r,this.b=i*r+this.b*t,this.c=s*t-this.d*r,this.d=s*r+this.d*t,this.tx=o*t-this.ty*r,this.ty=o*r+this.ty*t,this}append(e){let t=this.a,r=this.b,i=this.c,s=this.d;return this.a=e.a*t+e.b*i,this.b=e.a*r+e.b*s,this.c=e.c*t+e.d*i,this.d=e.c*r+e.d*s,this.tx=e.tx*t+e.ty*i+this.tx,this.ty=e.tx*r+e.ty*s+this.ty,this}appendFrom(e,t){let r=e.a,i=e.b,s=e.c,o=e.d,a=e.tx,l=e.ty,c=t.a,u=t.b,d=t.c,f=t.d;return this.a=r*c+i*d,this.b=r*u+i*f,this.c=s*c+o*d,this.d=s*u+o*f,this.tx=a*c+l*d+t.tx,this.ty=a*u+l*f+t.ty,this}setTransform(e,t,r,i,s,o,a,l,c){return this.a=Math.cos(a+c)*s,this.b=Math.sin(a+c)*s,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(r*this.a+i*this.c),this.ty=t-(r*this.b+i*this.d),this}prepend(e){let t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){let r=this.a,i=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){let t=this.a,r=this.b,i=this.c,s=this.d,o=e.pivot,a=-Math.atan2(-i,s),l=Math.atan2(r,t),c=Math.abs(a+l);return c<1e-5||Math.abs(Xm-c)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(i*i+s*s),e.position.x=this.tx+(o.x*t+o.y*i),e.position.y=this.ty+(o.x*r+o.y*s),e}invert(){let e=this.a,t=this.b,r=this.c,i=this.d,s=this.tx,o=e*i-t*r;return this.a=i/o,this.b=-t/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-i*s)/o,this.ty=-(e*this.ty-t*s)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let e=new n;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}equals(e){return e.a===this.a&&e.b===this.b&&e.c===this.c&&e.d===this.d&&e.tx===this.tx&&e.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return yY.identity()}static get shared(){return gY.identity()}},gY=new ue,yY=new ue});var Zt,Bc=$(()=>{"use strict";Zt=class n{constructor(e,t,r){this._x=t||0,this._y=r||0,this._observer=e}clone(e){return new n(e??this._observer,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this._observer._onUpdate(this)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this._observer._onUpdate(this)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=0 y=0 scope=${this._observer}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this._observer._onUpdate(this))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this._observer._onUpdate(this))}}});function gt(n="default"){return Nh[n]===void 0&&(Nh[n]=-1),++Nh[n]}function fF(){for(let n in Nh)delete Nh[n]}var Nh,_n=$(()=>{"use strict";Nh={default:-1}});function oe(n,e,t=3){if(hF[e])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${n}`):(r=r.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${n}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${n}`),console.warn(r))),hF[e]=!0}var hF,Ie,Km,zt=$(()=>{"use strict";hF={},Ie="8.0.0",Km="8.3.4"});var xa,Qm=$(()=>{"use strict";xa=class{constructor(e,t){this._pool=[],this._count=0,this._index=0,this._classType=e,t&&this.prepopulate(t)}prepopulate(e){for(let t=0;t<e;t++)this._pool[this._index++]=new this._classType;this._count+=e}get(e){let t;return this._index>0?t=this._pool[--this._index]:t=new this._classType,t.init?.(e),t}return(e){e.reset?.(),this._pool[this._index++]=e}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){this._pool.length=0,this._index=0}}});var Oh,Ze,On=$(()=>{Qm();Oh=class{constructor(){this._poolsByClass=new Map}prepopulate(e,t){this.getPool(e).prepopulate(t)}get(e,t){return this.getPool(e).get(t)}return(e){this.getPool(e.constructor).return(e)}getPool(e){return this._poolsByClass.has(e)||this._poolsByClass.set(e,new xa(e)),this._poolsByClass.get(e)}stats(){let e={};return this._poolsByClass.forEach(t=>{let r=e[t._classType.name]?t._classType.name+t._classType.ID:t._classType.name;e[r]={free:t.totalFree,used:t.totalUsed,size:t.totalSize}}),e}},Ze=new Oh});var Zm,cw=$(()=>{zt();Zm={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(n){typeof n=="boolean"&&n===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(n===!0?{}:n))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(n){oe("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(n)}}});function O2(n,e,t){let r=n.length,i;if(e>=r||t===0)return;t=e+t>r?r-e:t;let s=r-t;for(i=e;i<s;++i)n[i]=n[i+t];n.length=s}var Jm=$(()=>{"use strict"});var e7,uw=$(()=>{Jm();zt();e7={allowChildren:!0,removeChildren(n=0,e){let t=e??this.children.length,r=t-n,i=[];if(r>0&&r<=t){for(let o=t-1;o>=n;o--){let a=this.children[o];a&&(i.push(a),a.parent=null)}O2(this.children,n,t);let s=this.renderGroup||this.parentRenderGroup;s&&s.removeChildren(i);for(let o=0;o<i.length;++o)this.emit("childRemoved",i[o],this,o),i[o].emit("removed",this);return i}else if(r===0&&this.children.length===0)return i;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(n){let e=this.getChildAt(n);return this.removeChild(e)},getChildAt(n){if(n<0||n>=this.children.length)throw new Error(`getChildAt: Index (${n}) does not exist.`);return this.children[n]},setChildIndex(n,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);this.getChildIndex(n),this.addChildAt(n,e)},getChildIndex(n){let e=this.children.indexOf(n);if(e===-1)throw new Error("The supplied Container must be a child of the caller");return e},addChildAt(n,e){this.allowChildren||oe(Ie,"addChildAt: Only Containers will be allowed to add children in v8.0.0");let{children:t}=this;if(e<0||e>t.length)throw new Error(`${n}addChildAt: The index ${e} supplied is out of bounds ${t.length}`);if(n.parent){let i=n.parent.children.indexOf(n);if(n.parent===this&&i===e)return n;i!==-1&&n.parent.children.splice(i,1)}e===t.length?t.push(n):t.splice(e,0,n),n.parent=this,n.didChange=!0,n._updateFlags=15;let r=this.renderGroup||this.parentRenderGroup;return r&&r.addChild(n),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",n,this,e),n.emit("added",this),n},swapChildren(n,e){if(n===e)return;let t=this.getChildIndex(n),r=this.getChildIndex(e);this.children[t]=e,this.children[r]=n;let i=this.renderGroup||this.parentRenderGroup;i&&(i.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...n){return n.length===1?this.reparentChildAt(n[0],this.children.length):(n.forEach(e=>this.reparentChildAt(e,this.children.length)),n[0])},reparentChildAt(n,e){if(n.parent===this)return this.setChildIndex(n,e),n;let t=n.worldTransform.clone();n.removeFromParent(),this.addChildAt(n,e);let r=this.worldTransform.clone();return r.invert(),t.prepend(r),n.setFromMatrix(t),n}}});var Hs,Lh=$(()=>{"use strict";Hs=class{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let e=0;e<this.filters.length;e++)this.filters[e].destroy();this.filters=null,this.filterArea=null}}});var Uh,L2,dw=$(()=>{ee();On();Uh=class{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(e=>{this.add({test:e.test,maskClass:e})}))}add(e){this._tests.push(e)}getMaskEffect(e){this._initialized||this.init();for(let t=0;t<this._tests.length;t++){let r=this._tests[t];if(r.test(e))return Ze.get(r.maskClass,e)}return e}returnMaskEffect(e){Ze.return(e)}},L2=new Uh;ke.handleByList(z.MaskEffect,L2._effectClasses)});var t7,fw=$(()=>{Lh();dw();t7={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){let n=this.renderGroup||this.parentRenderGroup;n&&(n.structureDidChange=!0)},addEffect(n){this.effects.indexOf(n)===-1&&(this.effects.push(n),this.effects.sort((t,r)=>t.priority-r.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(n){let e=this.effects.indexOf(n);e!==-1&&(this.effects.splice(e,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(n){let e=this._maskEffect;e?.mask!==n&&(e&&(this.removeEffect(e),L2.returnMaskEffect(e),this._maskEffect=null),n!=null&&(this._maskEffect=L2.getMaskEffect(n),this.addEffect(this._maskEffect)))},setMask(n){this._maskOptions={...this._maskOptions,...n},n.mask&&(this.mask=n.mask),this._markStructureAsChanged()},get mask(){return this._maskEffect?.mask},set filters(n){!Array.isArray(n)&&n&&(n=[n]);let e=this._filterEffect||(this._filterEffect=new Hs);n=n;let t=n?.length>0,r=e.filters?.length>0,i=t!==r;n=Array.isArray(n)?n.slice(0):n,e.filters=Object.freeze(n),i&&(t?this.addEffect(e):(this.removeEffect(e),e.filters=n??null))},get filters(){return this._filterEffect?.filters},set filterArea(n){this._filterEffect||(this._filterEffect=new Hs),this._filterEffect.filterArea=n},get filterArea(){return this._filterEffect?.filterArea}}});var r7,hw=$(()=>{zt();r7={label:null,get name(){return oe(Ie,"Container.name property has been removed, use Container.label instead"),this.label},set name(n){oe(Ie,"Container.name property has been removed, use Container.label instead"),this.label=n},getChildByName(n,e=!1){return this.getChildByLabel(n,e)},getChildByLabel(n,e=!1){let t=this.children;for(let r=0;r<t.length;r++){let i=t[r];if(i.label===n||n instanceof RegExp&&n.test(i.label))return i}if(e)for(let r=0;r<t.length;r++){let s=t[r].getChildByLabel(n,!0);if(s)return s}return null},getChildrenByLabel(n,e=!1,t=[]){let r=this.children;for(let i=0;i<r.length;i++){let s=r[i];(s.label===n||n instanceof RegExp&&n.test(s.label))&&t.push(s)}if(e)for(let i=0;i<r.length;i++)r[i].getChildrenByLabel(n,!0,t);return t}}});var n7,$e,Qr=$(()=>{vi();n7=[new Ve,new Ve,new Ve,new Ve],$e=class n{constructor(e=0,t=0,r=0,i=0){this.type="rectangle",this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(i)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new n(0,0,0,0)}clone(){return new n(this.x,this.y,this.width,this.height)}copyFromBounds(e){return this.x=e.minX,this.y=e.minY,this.width=e.maxX-e.minX,this.height=e.maxY-e.minY,this}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}strokeContains(e,t,r,i=.5){let{width:s,height:o}=this;if(s<=0||o<=0)return!1;let a=this.x,l=this.y,c=r*(1-i),u=r-c,d=a-c,f=a+s+c,h=l-c,p=l+o+c,m=a+u,g=a+s-u,y=l+u,x=l+o-u;return e>=d&&e<=f&&t>=h&&t<=p&&!(e>m&&e<g&&t>y&&t<x)}intersects(e,t){if(!t){let v=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=v)return!1;let A=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>A}let r=this.left,i=this.right,s=this.top,o=this.bottom;if(i<=r||o<=s)return!1;let a=n7[0].set(e.left,e.top),l=n7[1].set(e.left,e.bottom),c=n7[2].set(e.right,e.top),u=n7[3].set(e.right,e.bottom);if(c.x<=a.x||l.y<=a.y)return!1;let d=Math.sign(t.a*t.d-t.b*t.c);if(d===0||(t.apply(a,a),t.apply(l,l),t.apply(c,c),t.apply(u,u),Math.max(a.x,l.x,c.x,u.x)<=r||Math.min(a.x,l.x,c.x,u.x)>=i||Math.max(a.y,l.y,c.y,u.y)<=s||Math.min(a.y,l.y,c.y,u.y)>=o))return!1;let f=d*(l.y-a.y),h=d*(a.x-l.x),p=f*r+h*s,m=f*i+h*s,g=f*r+h*o,y=f*i+h*o;if(Math.max(p,m,g,y)<=f*a.x+h*a.y||Math.min(p,m,g,y)>=f*u.x+h*u.y)return!1;let x=d*(a.y-c.y),b=d*(c.x-a.x),_=x*r+b*s,S=x*i+b*s,C=x*r+b*o,k=x*i+b*o;return!(Math.max(_,S,C,k)<=x*a.x+b*a.y||Math.min(_,S,C,k)>=x*u.x+b*u.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){let t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),i=Math.max(this.y,e.y),s=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=i,this.height=Math.max(s-i,0),this}ceil(e=1,t=.001){let r=Math.ceil((this.x+this.width-t)*e)/e,i=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=i-this.y,this}enlarge(e){let t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),i=Math.min(this.y,e.y),s=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=i,this.height=s-i,this}getBounds(e){return e||(e=new n),e.copyFrom(this),e}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}});var pF,Nt,Ln=$(()=>{Ct();Qr();pF=new ue,Nt=class n{constructor(e=1/0,t=1/0,r=-1/0,i=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=pF,this.minX=e,this.minY=t,this.maxX=r,this.maxY=i}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new $e);let e=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(e.x=0,e.y=0,e.width=0,e.height=0):e.copyFromBounds(this),e}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=pF,this}set(e,t,r,i){this.minX=e,this.minY=t,this.maxX=r,this.maxY=i}addFrame(e,t,r,i,s){s||(s=this.matrix);let o=s.a,a=s.b,l=s.c,c=s.d,u=s.tx,d=s.ty,f=this.minX,h=this.minY,p=this.maxX,m=this.maxY,g=o*e+l*t+u,y=a*e+c*t+d;g<f&&(f=g),y<h&&(h=y),g>p&&(p=g),y>m&&(m=y),g=o*r+l*t+u,y=a*r+c*t+d,g<f&&(f=g),y<h&&(h=y),g>p&&(p=g),y>m&&(m=y),g=o*e+l*i+u,y=a*e+c*i+d,g<f&&(f=g),y<h&&(h=y),g>p&&(p=g),y>m&&(m=y),g=o*r+l*i+u,y=a*r+c*i+d,g<f&&(f=g),y<h&&(h=y),g>p&&(p=g),y>m&&(m=y),this.minX=f,this.minY=h,this.maxX=p,this.maxY=m}addRect(e,t){this.addFrame(e.x,e.y,e.x+e.width,e.y+e.height,t)}addBounds(e,t){this.addFrame(e.minX,e.minY,e.maxX,e.maxY,t)}addBoundsMask(e){this.minX=this.minX>e.minX?this.minX:e.minX,this.minY=this.minY>e.minY?this.minY:e.minY,this.maxX=this.maxX<e.maxX?this.maxX:e.maxX,this.maxY=this.maxY<e.maxY?this.maxY:e.maxY}applyMatrix(e){let t=this.minX,r=this.minY,i=this.maxX,s=this.maxY,{a:o,b:a,c:l,d:c,tx:u,ty:d}=e,f=o*t+l*r+u,h=a*t+c*r+d;this.minX=f,this.minY=h,this.maxX=f,this.maxY=h,f=o*i+l*r+u,h=a*i+c*r+d,this.minX=f<this.minX?f:this.minX,this.minY=h<this.minY?h:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=h>this.maxY?h:this.maxY,f=o*t+l*s+u,h=a*t+c*s+d,this.minX=f<this.minX?f:this.minX,this.minY=h<this.minY?h:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=h>this.maxY?h:this.maxY,f=o*i+l*s+u,h=a*i+c*s+d,this.minX=f<this.minX?f:this.minX,this.minY=h<this.minY?h:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=h>this.maxY?h:this.maxY}fit(e){return this.minX<e.left&&(this.minX=e.left),this.maxX>e.right&&(this.maxX=e.right),this.minY<e.top&&(this.minY=e.top),this.maxY>e.bottom&&(this.maxY=e.bottom),this}fitBounds(e,t,r,i){return this.minX<e&&(this.minX=e),this.maxX>t&&(this.maxX=t),this.minY<r&&(this.minY=r),this.maxY>i&&(this.maxY=i),this}pad(e,t=e){return this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new n(this.minX,this.minY,this.maxX,this.maxY)}scale(e,t=e){return this.minX*=e,this.minY*=t,this.maxX*=e,this.maxY*=t,this}get x(){return this.minX}set x(e){let t=this.maxX-this.minX;this.minX=e,this.maxX=e+t}get y(){return this.minY}set y(e){let t=this.maxY-this.minY;this.minY=e,this.maxY=e+t}get width(){return this.maxX-this.minX}set width(e){this.maxX=this.minX+e}get height(){return this.maxY-this.minY}set height(e){this.maxY=this.minY+e}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(e,t,r,i){let s=this.minX,o=this.minY,a=this.maxX,l=this.maxY;i||(i=this.matrix);let c=i.a,u=i.b,d=i.c,f=i.d,h=i.tx,p=i.ty;for(let m=t;m<r;m+=2){let g=e[m],y=e[m+1],x=c*g+d*y+h,b=u*g+f*y+p;s=x<s?x:s,o=b<o?b:o,a=x>a?x:a,l=b>l?b:l}this.minX=s,this.minY=o,this.maxX=a,this.maxY=l}containsPoint(e,t){return this.minX<=e&&this.minY<=t&&this.maxX>=e&&this.maxY>=t}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this}}});var Br,ii,ll=$(()=>{Ct();Qm();Ln();Br=new xa(ue),ii=new xa(Nt)});function Eo(n,e,t){t.clear();let r,i;return n.parent?e?r=n.parent.worldTransform:(i=Br.get().identity(),r=U2(n,i)):r=ue.IDENTITY,i7(n,t,r,e),i&&Br.return(i),t.isValid||t.set(0,0,0,0),t}function i7(n,e,t,r){if(!n.visible||!n.measurable)return;let i;r?i=n.worldTransform:(n.updateLocalTransform(),i=Br.get(),i.appendFrom(n.localTransform,t));let s=e,o=!!n.effects.length;if(o&&(e=ii.get().clear()),n.boundsArea)e.addRect(n.boundsArea,i);else{n.bounds&&(e.matrix=i,e.addBounds(n.bounds));for(let a=0;a<n.children.length;a++)i7(n.children[a],e,i,r)}if(o){for(let a=0;a<n.effects.length;a++)n.effects[a].addBounds?.(e);s.addBounds(e,ue.IDENTITY),ii.return(e)}r||Br.return(i)}function U2(n,e){let t=n.parent;return t&&(U2(t,e),t.updateLocalTransform(),e.append(t.localTransform)),e}var Nc=$(()=>{Ct();ll()});function G2(n,e){if(n===16777215||!e)return e;if(e===16777215||!n)return n;let t=n>>16&255,r=n>>8&255,i=n&255,s=e>>16&255,o=e>>8&255,a=e&255,l=t*s/255|0,c=r*o/255|0,u=i*a/255|0;return(l<<16)+(c<<8)+u}var s7=$(()=>{"use strict"});function cl(n,e){return n===mF?e:e===mF?n:G2(n,e)}var mF,o7=$(()=>{s7();mF=16777215});function ba(n){return((n&255)<<16)+(n&65280)+(n>>16&255)}var a7,l7=$(()=>{Nc();ll();o7();a7={getGlobalAlpha(n){if(n)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let e=this.alpha,t=this.parent;for(;t;)e*=t.alpha,t=t.parent;return e},getGlobalTransform(n,e){if(e)return n.copyFrom(this.worldTransform);this.updateLocalTransform();let t=U2(this,Br.get().identity());return n.appendFrom(this.localTransform,t),Br.return(t),n},getGlobalTint(n){if(n)return this.renderGroup?ba(this.renderGroup.worldColor):this.parentRenderGroup?ba(cl(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let e=this.localColor,t=this.parent;for(;t;)e=cl(e,t.localColor),t=t.parent;return ba(e)}}});function ve(...n){pw!==gF&&(pw++,pw===gF?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...n))}var pw,gF,Gt=$(()=>{"use strict";pw=0,gF=500});function ul(n,e,t){return e.clear(),t||(t=ue.IDENTITY),yF(n,e,t,n,!0),e.isValid||e.set(0,0,0,0),e}function yF(n,e,t,r,i){let s;if(i)s=Br.get(),s=t.copyTo(s);else{if(!n.visible||!n.measurable)return;n.updateLocalTransform();let l=n.localTransform;s=Br.get(),s.appendFrom(l,t)}let o=e,a=!!n.effects.length;if(a&&(e=ii.get().clear()),n.boundsArea)e.addRect(n.boundsArea,s);else{n.renderPipeId&&(e.matrix=s,e.addBounds(n.bounds));let l=n.children;for(let c=0;c<l.length;c++)yF(l[c],e,s,r,!1)}if(a){for(let l=0;l<n.effects.length;l++)n.effects[l].addLocalBounds?.(e,r);o.addBounds(e,ue.IDENTITY),ii.return(e)}Br.return(s)}function mw(n,e,t){let r=n.parent;if(!r){ve("Item is not inside the root container");return}r!==e&&(mw(r,e,t),r.updateLocalTransform(),t.append(r.localTransform))}var Gh=$(()=>{Ct();Gt();ll()});function $h(n,e){let t=n.children;for(let r=0;r<t.length;r++){let i=t[r],s=i.uid,o=(i._didViewChangeTick&65535)<<16|i._didContainerChangeTick&65535,a=e.index;(e.data[a]!==s||e.data[a+1]!==o)&&(e.data[e.index]=s,e.data[e.index+1]=o,e.didChange=!0),e.index=a+2,i.children.length&&$h(i,e)}return e.didChange}var gw=$(()=>{"use strict"});var xY,c7,yw=$(()=>{Ct();Ln();Nc();Gh();gw();xY=new ue,c7={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(n,e){let t=Math.sign(this.scale.x)||1;e!==0?this.scale.x=n/e*t:this.scale.x=t},_setHeight(n,e){let t=Math.sign(this.scale.y)||1;e!==0?this.scale.y=n/e*t:this.scale.y=t},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new Nt});let n=this._localBoundsCacheData;return n.index=1,n.didChange=!1,n.data[0]!==this._didViewChangeTick&&(n.didChange=!0,n.data[0]=this._didViewChangeTick),$h(this,n),n.didChange&&ul(this,n.localBounds,xY),n.localBounds},getBounds(n,e){return Eo(this,n,e||new Nt)}}});var u7,xw=$(()=>{"use strict";u7={_onRender:null,set onRender(n){let e=this.renderGroup||this.parentRenderGroup;if(!n){this._onRender&&e?.removeOnRender(this),this._onRender=null;return}this._onRender||e?.addOnRender(this),this._onRender=n},get onRender(){return this._onRender}}});function bY(n,e){return n._zIndex-e._zIndex}var d7,bw=$(()=>{"use strict";d7={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(n){this._zIndex!==n&&(this._zIndex=n,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(bY))}}});var f7,_w=$(()=>{vi();ll();f7={getGlobalPosition(n=new Ve,e=!1){return this.parent?this.parent.toGlobal(this._position,n,e):(n.x=this._position.x,n.y=this._position.y),n},toGlobal(n,e,t=!1){let r=this.getGlobalTransform(Br.get(),t);return e=r.apply(n,e),Br.return(r),e},toLocal(n,e,t,r){e&&(n=e.toGlobal(n,t,r));let i=this.getGlobalTransform(Br.get(),r);return t=i.applyInverse(n,t),Br.return(i),t}}});var dl,h7=$(()=>{_n();dl=class{constructor(){this.uid=gt("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}add(e){this.instructions[this.instructionSize++]=e}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}});function wi(n){return n+=n===0?1:0,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n+1}function zh(n){return!(n&n-1)&&!!n}function xF(n){let e=(n>65535?1:0)<<4;n>>>=e;let t=(n>255?1:0)<<3;return n>>>=t,e|=t,t=(n>15?1:0)<<2,n>>>=t,e|=t,t=(n>3?1:0)<<1,n>>>=t,e|=t,e|n>>1}var $2=$(()=>{"use strict"});function Un(n){let e={};for(let t in n)n[t]!==void 0&&(e[t]=n[t]);return e}var Oc=$(()=>{"use strict"});function _Y(n){let e=bF[n];return e===void 0&&(bF[n]=gt("resource")),e}var bF,_F,z2,p7=$(()=>{Nn();_n();zt();bF=Object.create(null);_F=class vF extends st{constructor(e={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,e={...vF.defaultOptions,...e},this.addressMode=e.addressMode,this.addressModeU=e.addressModeU??this.addressModeU,this.addressModeV=e.addressModeV??this.addressModeV,this.addressModeW=e.addressModeW??this.addressModeW,this.scaleMode=e.scaleMode,this.magFilter=e.magFilter??this.magFilter,this.minFilter=e.minFilter??this.minFilter,this.mipmapFilter=e.mipmapFilter??this.mipmapFilter,this.lodMinClamp=e.lodMinClamp,this.lodMaxClamp=e.lodMaxClamp,this.compare=e.compare,this.maxAnisotropy=e.maxAnisotropy??1}set addressMode(e){this.addressModeU=e,this.addressModeV=e,this.addressModeW=e}get addressMode(){return this.addressModeU}set wrapMode(e){oe(Ie,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=e}get wrapMode(){return this.addressMode}set scaleMode(e){this.magFilter=e,this.minFilter=e,this.mipmapFilter=e}get scaleMode(){return this.magFilter}set maxAnisotropy(e){this._maxAnisotropy=Math.min(e,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){let e=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=_Y(e),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};_F.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};z2=_F});var wF,ot,cn=$(()=>{Nn();$2();Oc();_n();p7();wF=class SF extends st{constructor(e={}){super(),this.options=e,this.uid=gt("textureSource"),this._resourceType="textureSource",this._resourceId=gt("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,e={...SF.defaultOptions,...e},this.label=e.label??"",this.resource=e.resource,this.autoGarbageCollect=e.autoGarbageCollect,this._resolution=e.resolution,e.width?this.pixelWidth=e.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,e.height?this.pixelHeight=e.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=e.format,this.dimension=e.dimensions,this.mipLevelCount=e.mipLevelCount,this.autoGenerateMipmaps=e.autoGenerateMipmaps,this.sampleCount=e.sampleCount,this.antialias=e.antialias,this.alphaMode=e.alphaMode,this.style=new z2(Un(e)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(e){this.style!==e&&(this._style?.off("change",this._onStyleChange,this),this._style=e,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}get addressMode(){return this._style.addressMode}set addressMode(e){this._style.addressMode=e}get repeatMode(){return this._style.addressMode}set repeatMode(e){this._style.addressMode=e}get magFilter(){return this._style.magFilter}set magFilter(e){this._style.magFilter=e}get minFilter(){return this._style.minFilter}set minFilter(e){this._style.minFilter=e}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(e){this._style.mipmapFilter=e}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(e){this._style.lodMinClamp=e}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(e){this._style.lodMaxClamp=e}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){let e=this._resolution;if(this.resize(this.resourceWidth/e,this.resourceHeight/e))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=gt("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){let{resource:e}=this;return e.naturalWidth||e.videoWidth||e.displayWidth||e.width}get resourceHeight(){let{resource:e}=this;return e.naturalHeight||e.videoHeight||e.displayHeight||e.height}get resolution(){return this._resolution}set resolution(e){this._resolution!==e&&(this._resolution=e,this.width=this.pixelWidth/e,this.height=this.pixelHeight/e)}resize(e,t,r){r||(r=this._resolution),e||(e=this.width),t||(t=this.height);let i=Math.round(e*r),s=Math.round(t*r);return this.width=i/r,this.height=s/r,this._resolution=r,this.pixelWidth===i&&this.pixelHeight===s?!1:(this._refreshPOT(),this.pixelWidth=i,this.pixelHeight=s,this.emit("resize",this),this._resourceId=gt("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(e){this._style.wrapMode=e}get wrapMode(){return this._style.wrapMode}set scaleMode(e){this._style.scaleMode=e}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=zh(this.pixelWidth)&&zh(this.pixelHeight)}static test(e){throw new Error("Unimplemented")}};wF.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};ot=wF});function vY(){for(let n=0;n<16;n++){let e=[];vw.push(e);for(let t=0;t<16;t++){let r=m7(Lc[n]*Lc[t]+Gc[n]*Uc[t]),i=m7(Uc[n]*Lc[t]+$c[n]*Uc[t]),s=m7(Lc[n]*Gc[t]+Gc[n]*$c[t]),o=m7(Uc[n]*Gc[t]+$c[n]*$c[t]);for(let a=0;a<16;a++)if(Lc[a]===r&&Uc[a]===i&&Gc[a]===s&&$c[a]===o){e.push(a);break}}}for(let n=0;n<16;n++){let e=new ue;e.set(Lc[n],Uc[n],Gc[n],$c[n],0,0),CF.push(e)}}var Lc,Uc,Gc,$c,vw,CF,m7,yt,g7=$(()=>{Ct();Lc=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Uc=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Gc=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],$c=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],vw=[],CF=[],m7=Math.sign;vY();yt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:n=>Lc[n],uY:n=>Uc[n],vX:n=>Gc[n],vY:n=>$c[n],inv:n=>n&8?n&15:-n&7,add:(n,e)=>vw[n][e],sub:(n,e)=>vw[n][yt.inv(e)],rotate180:n=>n^4,isVertical:n=>(n&3)===2,byDirection:(n,e)=>Math.abs(n)*2<=Math.abs(e)?e>=0?yt.S:yt.N:Math.abs(e)*2<=Math.abs(n)?n>0?yt.E:yt.W:e>0?n>0?yt.SE:yt.SW:n>0?yt.NE:yt.NW,matrixAppendRotationInv:(n,e,t=0,r=0)=>{let i=CF[yt.inv(e)];i.tx=t,i.ty=r,n.append(i)}}});var Hh,ww=$(()=>{"use strict";Hh=()=>{}});var _a,y7=$(()=>{ee();cn();_a=class extends ot{constructor(e){let t=e.resource||new Float32Array(e.width*e.height*4),r=e.format;r||(t instanceof Float32Array?r="rgba32float":t instanceof Int32Array||t instanceof Uint32Array?r="rgba32uint":t instanceof Int16Array||t instanceof Uint16Array?r="rgba16uint":(t instanceof Int8Array,r="bgra8unorm")),super({...e,resource:t,format:r}),this.uploadMethodId="buffer"}static test(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}};_a.extension=z.TextureSource});var AF,fl,x7=$(()=>{Ct();AF=new ue,fl=class{constructor(e,t){this.mapCoord=new ue,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof t>"u"?this.clampMargin=e.width<10?0:.5:this.clampMargin=t,this.isSimple=!1,this.texture=e}get texture(){return this._texture}set texture(e){this.texture!==e&&(this._texture?.removeListener("update",this.update,this),this._texture=e,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(e,t){t===void 0&&(t=e);let r=this.mapCoord;for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];t[i]=s*r.a+o*r.c+r.tx,t[i+1]=s*r.b+o*r.d+r.ty}return t}update(){let e=this._texture;this._updateID++;let t=e.uvs;this.mapCoord.set(t.x1-t.x0,t.y1-t.y0,t.x3-t.x0,t.y3-t.y0,t.x0,t.y0);let r=e.orig,i=e.trim;i&&(AF.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(AF));let s=e.source,o=this.uClampFrame,a=this.clampMargin/s._resolution,l=this.clampOffset/s._resolution;return o[0]=(e.frame.x+a+l)/s.width,o[1]=(e.frame.y+a+l)/s.height,o[2]=(e.frame.x+e.frame.width-a+l)/s.width,o[3]=(e.frame.y+e.frame.height-a+l)/s.height,this.uClampOffset[0]=this.clampOffset/s.pixelWidth,this.uClampOffset[1]=this.clampOffset/s.pixelHeight,this.isSimple=e.frame.width===s.width&&e.frame.height===s.height&&e.rotate===0,!0}}});var re,_t=$(()=>{Nn();g7();Qr();_n();zt();ww();y7();cn();x7();re=class extends st{constructor({source:e,label:t,frame:r,orig:i,trim:s,defaultAnchor:o,defaultBorders:a,rotate:l,dynamic:c}={}){if(super(),this.uid=gt("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new $e,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=t,this.source=e?.source??new ot,this.noFrame=!r,r)this.frame.copyFrom(r);else{let{width:u,height:d}=this._source;this.frame.width=u,this.frame.height=d}this.orig=i||this.frame,this.trim=s,this.rotate=l??0,this.defaultAnchor=o,this.defaultBorders=a,this.destroyed=!1,this.dynamic=c||!1,this.updateUvs()}set source(e){this._source&&this._source.off("resize",this.update,this),this._source=e,e.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new fl(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){let{uvs:e,frame:t}=this,{width:r,height:i}=this._source,s=t.x/r,o=t.y/i,a=t.width/r,l=t.height/i,c=this.rotate;if(c){let u=a/2,d=l/2,f=s+u,h=o+d;c=yt.add(c,yt.NW),e.x0=f+u*yt.uX(c),e.y0=h+d*yt.uY(c),c=yt.add(c,2),e.x1=f+u*yt.uX(c),e.y1=h+d*yt.uY(c),c=yt.add(c,2),e.x2=f+u*yt.uX(c),e.y2=h+d*yt.uY(c),c=yt.add(c,2),e.x3=f+u*yt.uX(c),e.y3=h+d*yt.uY(c)}else e.x0=s,e.y0=o,e.x1=s+a,e.y1=o,e.x2=s+a,e.y2=o+l,e.x3=s,e.y3=o+l}destroy(e=!1){this._source&&e&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return oe(Ie,"Texture.baseTexture is now Texture.source"),this._source}};re.EMPTY=new re({label:"EMPTY",source:new ot({label:"EMPTY"})});re.EMPTY.destroy=Hh;re.WHITE=new re({source:new _a({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});re.WHITE.destroy=Hh});var wY,Wh,rt,Ws=$(()=>{$2();cn();_t();wY=0,Wh=class{constructor(e){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1}createTexture(e,t,r){let i=new ot({...this.textureOptions,width:e,height:t,resolution:1,antialias:r,autoGarbageCollect:!0});return new re({source:i,label:`texturePool_${wY++}`})}getOptimalTexture(e,t,r=1,i){let s=Math.ceil(e*r-1e-6),o=Math.ceil(t*r-1e-6);s=wi(s),o=wi(o);let a=(s<<17)+(o<<1)+(i?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let l=this._texturePool[a].pop();return l||(l=this.createTexture(s,o,i)),l.source._resolution=r,l.source.width=s/r,l.source.height=o/r,l.source.pixelWidth=s,l.source.pixelHeight=o,l.frame.x=0,l.frame.y=0,l.frame.width=e,l.frame.height=t,l.updateUvs(),this._poolKeyHash[l.uid]=a,l}getSameSizeTexture(e,t=!1){let r=e.source;return this.getOptimalTexture(e.width,e.height,r._resolution,t)}returnTexture(e){let t=this._poolKeyHash[e.uid];this._texturePool[t].push(e)}clear(e){if(e=e!==!1,e)for(let t in this._texturePool){let r=this._texturePool[t];if(r)for(let i=0;i<r.length;i++)r[i].destroy(!0)}this._texturePool={}}},rt=new Wh});var H2,Sw=$(()=>{Ct();h7();Ws();H2=class{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new ue,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new dl,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(e){this.root=e,e._onRender&&this.addOnRender(e),e.didChange=!0;let t=e.children;for(let r=0;r<t.length;r++){let i=t[r];i._updateFlags=15,this.addChild(i)}}enableCacheAsTexture(e={}){this.textureOptions=e,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(rt.returnTexture(this.texture),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0}reset(){this.renderGroupChildren.length=0;for(let e in this.childrenToUpdate){let t=this.childrenToUpdate[e];t.list.fill(null),t.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(e){e.renderGroupParent&&e.renderGroupParent._removeRenderGroupChild(e),e.renderGroupParent=this,this.renderGroupChildren.push(e)}_removeRenderGroupChild(e){let t=this.renderGroupChildren.indexOf(e);t>-1&&this.renderGroupChildren.splice(t,1),e.renderGroupParent=null}addChild(e){if(this.structureDidChange=!0,e.parentRenderGroup=this,e.updateTick=-1,e.parent===this.root?e.relativeRenderGroupDepth=1:e.relativeRenderGroupDepth=e.parent.relativeRenderGroupDepth+1,e.didChange=!0,this.onChildUpdate(e),e.renderGroup){this.addRenderGroupChild(e.renderGroup);return}e._onRender&&this.addOnRender(e);let t=e.children;for(let r=0;r<t.length;r++)this.addChild(t[r])}removeChild(e){if(this.structureDidChange=!0,e._onRender&&(e.renderGroup||this.removeOnRender(e)),e.parentRenderGroup=null,e.renderGroup){this._removeRenderGroupChild(e.renderGroup);return}let t=e.children;for(let r=0;r<t.length;r++)this.removeChild(t[r])}removeChildren(e){for(let t=0;t<e.length;t++)this.removeChild(e[t])}onChildUpdate(e){let t=this.childrenToUpdate[e.relativeRenderGroupDepth];t||(t=this.childrenToUpdate[e.relativeRenderGroupDepth]={index:0,list:[]}),t.list[t.index++]=e}updateRenderable(e){e.globalDisplayStatus<7||(this.instructionSet.renderPipes[e.renderPipeId].updateRenderable(e),e.didViewUpdate=!1)}onChildViewUpdate(e){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=e}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(e){this._onRenderContainers.push(e)}removeOnRender(e){this._onRenderContainers.splice(this._onRenderContainers.indexOf(e),1)}runOnRender(){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender()}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(e=[]){let t=this.root.children;for(let r=0;r<t.length;r++)this._getChildren(t[r],e);return e}_getChildren(e,t=[]){if(t.push(e),e.renderGroup)return t;let r=e.children;for(let i=0;i<r.length;i++)this._getChildren(r[i],t);return t}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return this._matrixDirty&1?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new ue),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return this._matrixDirty&2?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new ue),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(this._matrixDirty&4))return this._inverseParentTextureTransform;this._matrixDirty&=-5;let e=this._parentCacheAsTextureRenderGroup;return e?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new ue),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(e.inverseWorldTransform).translate(-e._textureBounds.x,-e._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}});function zc(n,e,t={}){for(let r in e)!t[r]&&e[r]!==void 0&&(n[r]=e[r])}var b7=$(()=>{"use strict"});var Cw,Aw,Ew,Hc,W2,hl,EF,we,Vi=$(()=>{Nn();nn();aw();Ct();Ym();Bc();_n();zt();On();cw();uw();fw();hw();l7();yw();xw();bw();_w();Sw();b7();Cw=new Zt(null),Aw=new Zt(null),Ew=new Zt(null,1,1),Hc=1,W2=2,hl=4,EF=8,we=class n extends st{constructor(e={}){super(),this.uid=gt("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new ue,this.relativeGroupTransform=new ue,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new Zt(this,0,0),this._scale=Ew,this._pivot=Aw,this._skew=Cw,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],zc(this,e,{children:!0,parent:!0,effects:!0}),e.children?.forEach(t=>this.addChild(t)),e.parent?.addChild(this)}static mixin(e){Object.defineProperties(n.prototype,Object.getOwnPropertyDescriptors(e))}set _didChangeId(e){this._didViewChangeTick=e>>12&4095,this._didContainerChangeTick=e&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...e){if(this.allowChildren||oe(Ie,"addChild: Only Containers will be allowed to add children in v8.0.0"),e.length>1){for(let i=0;i<e.length;i++)this.addChild(e[i]);return e[0]}let t=e[0],r=this.renderGroup||this.parentRenderGroup;return t.parent===this?(this.children.splice(this.children.indexOf(t),1),this.children.push(t),r&&(r.structureDidChange=!0),t):(t.parent&&t.parent.removeChild(t),this.children.push(t),this.sortableChildren&&(this.sortDirty=!0),t.parent=this,t.didChange=!0,t._updateFlags=15,r&&r.addChild(t),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this),this._didViewChangeTick++,t._zIndex!==0&&t.depthOfChildModified(),t)}removeChild(...e){if(e.length>1){for(let i=0;i<e.length;i++)this.removeChild(e[i]);return e[0]}let t=e[0],r=this.children.indexOf(t);return r>-1&&(this._didViewChangeTick++,this.children.splice(r,1),this.renderGroup?this.renderGroup.removeChild(t):this.parentRenderGroup&&this.parentRenderGroup.removeChild(t),t.parent=null,this.emit("childRemoved",t,this,r),t.emit("removed",this)),t}_onUpdate(e){e&&e===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(e){!!this.renderGroup!==e&&(e?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;let e=this.parentRenderGroup;e?.removeChild(this),this.renderGroup=Ze.get(H2,this),this.groupTransform=ue.IDENTITY,e?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;let e=this.parentRenderGroup;e?.removeChild(this),Ze.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,e?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new ue),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(e){this._position.x=e}get y(){return this._position.y}set y(e){this._position.y=e}get position(){return this._position}set position(e){this._position.copyFrom(e)}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this._skew))}get angle(){return this.rotation*qm}set angle(e){this.rotation=e*ds}get pivot(){return this._pivot===Aw&&(this._pivot=new Zt(this,0,0)),this._pivot}set pivot(e){this._pivot===Aw&&(this._pivot=new Zt(this,0,0)),typeof e=="number"?this._pivot.set(e):this._pivot.copyFrom(e)}get skew(){return this._skew===Cw&&(this._skew=new Zt(this,0,0)),this._skew}set skew(e){this._skew===Cw&&(this._skew=new Zt(this,0,0)),this._skew.copyFrom(e)}get scale(){return this._scale===Ew&&(this._scale=new Zt(this,1,1)),this._scale}set scale(e){this._scale===Ew&&(this._scale=new Zt(this,0,0)),typeof e=="number"?this._scale.set(e):this._scale.copyFrom(e)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(e){let t=this.getLocalBounds().width;this._setWidth(e,t)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(e){let t=this.getLocalBounds().height;this._setHeight(e,t)}getSize(e){e||(e={});let t=this.getLocalBounds();return e.width=Math.abs(this.scale.x*t.width),e.height=Math.abs(this.scale.y*t.height),e}setSize(e,t){let r=this.getLocalBounds();typeof e=="object"?(t=e.height??e.width,e=e.width):t??(t=e),e!==void 0&&this._setWidth(e,r.width),t!==void 0&&this._setHeight(t,r.height)}_updateSkew(){let e=this._rotation,t=this._skew;this._cx=Math.cos(e+t._y),this._sx=Math.sin(e+t._y),this._cy=-Math.sin(e-t._x),this._sy=Math.cos(e-t._x)}updateTransform(e){return this.position.set(typeof e.x=="number"?e.x:this.position.x,typeof e.y=="number"?e.y:this.position.y),this.scale.set(typeof e.scaleX=="number"?e.scaleX||1:this.scale.x,typeof e.scaleY=="number"?e.scaleY||1:this.scale.y),this.rotation=typeof e.rotation=="number"?e.rotation:this.rotation,this.skew.set(typeof e.skewX=="number"?e.skewX:this.skew.x,typeof e.skewY=="number"?e.skewY:this.skew.y),this.pivot.set(typeof e.pivotX=="number"?e.pivotX:this.pivot.x,typeof e.pivotY=="number"?e.pivotY:this.pivot.y),this}setFromMatrix(e){e.decompose(this)}updateLocalTransform(){let e=this._didContainerChangeTick;if(this._didLocalTransformChangeId===e)return;this._didLocalTransformChangeId=e;let t=this.localTransform,r=this._scale,i=this._pivot,s=this._position,o=r._x,a=r._y,l=i._x,c=i._y;t.a=this._cx*o,t.b=this._sx*o,t.c=this._cy*a,t.d=this._sy*a,t.tx=s._x-(l*t.a+c*t.c),t.ty=s._y-(l*t.b+c*t.d)}set alpha(e){e!==this.localAlpha&&(this.localAlpha=e,this._updateFlags|=Hc,this._onUpdate())}get alpha(){return this.localAlpha}set tint(e){let r=ce.shared.setValue(e??16777215).toBgrNumber();r!==this.localColor&&(this.localColor=r,this._updateFlags|=Hc,this._onUpdate())}get tint(){return ba(this.localColor)}set blendMode(e){this.localBlendMode!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=W2,this.localBlendMode=e,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(e){let t=e?2:0;(this.localDisplayStatus&2)!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=hl,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(e){let t=e?0:4;(this.localDisplayStatus&4)!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=hl,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(e){let t=e?1:0;(this.localDisplayStatus&1)!==t&&(this._updateFlags|=hl,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(e=!1){if(this.destroyed)return;this.destroyed=!0;let t;if(this.children.length&&(t=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof e=="boolean"?e:e?.children)&&t)for(let i=0;i<t.length;++i)t[i].destroy(e);this.renderGroup?.destroy(),this.renderGroup=null}};we.mixin(e7);we.mixin(f7);we.mixin(u7);we.mixin(c7);we.mixin(t7);we.mixin(r7);we.mixin(d7);we.mixin(jm);we.mixin(Zm);we.mixin(a7)});var To,Vh=$(()=>{vi();To=class n{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=n.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ve,this.page=new Ve,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,r,i,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}});function SY(n){return function(e){return e.test(n)}}function jh(n){var e={userAgent:"",platform:"",maxTouchPoints:0};!n&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof n=="string"?e.userAgent=n:n&&n.userAgent&&(e={userAgent:n.userAgent,platform:n.platform,maxTouchPoints:n.maxTouchPoints||0});var t=e.userAgent,r=t.split("[FBAN");typeof r[1]<"u"&&(t=r[0]),r=t.split("Twitter"),typeof r[1]<"u"&&(t=r[0]);var i=SY(t),s={apple:{phone:i(Tw)&&!i(va),ipod:i(TF),tablet:!i(Tw)&&(i(kF)||OF(e))&&!i(va),universal:i(IF),device:(i(Tw)||i(TF)||i(kF)||i(IF)||OF(e))&&!i(va)},amazon:{phone:i(V2),tablet:!i(V2)&&i(_7),device:i(V2)||i(_7)},android:{phone:!i(va)&&i(V2)||!i(va)&&i(kw),tablet:!i(va)&&!i(V2)&&!i(kw)&&(i(_7)||i(PF)),device:!i(va)&&(i(V2)||i(_7)||i(kw)||i(PF))||i(/\bokhttp\b/i)},windows:{phone:i(va),tablet:i(DF),device:i(va)||i(DF)},other:{blackberry:i(MF),blackberry10:i(RF),opera:i(FF),firefox:i(NF),chrome:i(BF),device:i(MF)||i(RF)||i(FF)||i(NF)||i(BF)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}var Tw,TF,kF,IF,kw,PF,V2,_7,va,DF,MF,RF,FF,BF,NF,OF,Iw=$(()=>{Tw=/iPhone/i,TF=/iPod/i,kF=/iPad/i,IF=/\biOS-universal(?:.+)Mac\b/i,kw=/\bAndroid(?:.+)Mobile\b/i,PF=/Android/i,V2=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,_7=/Silk/i,va=/Windows Phone/i,DF=/\bWindows(?:.+)ARM\b/i,MF=/BlackBerry/i,RF=/BB10/i,FF=/Opera Mini/i,BF=/\b(CriOS|Chrome)(?:.+)Mobile/i,NF=/Mobile(?:.+)Firefox\b/i,OF=function(n){return typeof n<"u"&&n.platform==="MacIntel"&&typeof n.maxTouchPoints=="number"&&n.maxTouchPoints>1&&typeof MSStream>"u"}});var LF=$(()=>{Iw();Iw()});var CY,v7,Pw=$(()=>{LF();CY=jh.default??jh,v7=CY(globalThis.navigator)});var AY,w7,EY,TY,UF,GF,kY,IY,PY,Wc,Dw=$(()=>{Vh();ee();Pw();Jm();AY=9,w7=100,EY=0,TY=0,UF=2,GF=1,kY=-1e3,IY=-1e3,PY=2,Wc=class{constructor(e,t=v7){this._mobileInfo=t,this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this._pool=[],this._renderId=0,this._children=[],this._androidUpdateCount=0,this._androidUpdateFrequency=500,this._hookDiv=null,(t.tablet||t.phone)&&this._createTouchHook();let r=document.createElement("div");r.style.width=`${w7}px`,r.style.height=`${w7}px`,r.style.position="absolute",r.style.top=`${EY}px`,r.style.left=`${TY}px`,r.style.zIndex=UF.toString(),this._div=r,this._renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}get hookDiv(){return this._hookDiv}_createTouchHook(){let e=document.createElement("button");e.style.width=`${GF}px`,e.style.height=`${GF}px`,e.style.position="absolute",e.style.top=`${kY}px`,e.style.left=`${IY}px`,e.style.zIndex=PY.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this._activate(),this._destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}_destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}_activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.add(this),this._renderer.view.canvas.parentNode?.appendChild(this._div))}_deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.remove(this),this._div.parentNode?.removeChild(this._div))}_updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this._addChild(e),e._renderId=this._renderId);let t=e.children;if(t)for(let r=0;r<t.length;r++)this._updateAccessibleObjects(t[r])}init(e){this.debug=e?.debug??this.debug,this._renderer.runners.postrender.remove(this)}postrender(){let e=performance.now();if(this._mobileInfo.android.device&&e<this._androidUpdateCount||(this._androidUpdateCount=e+this._androidUpdateFrequency,!this._renderer.renderingToScreen||!this._renderer.view.canvas))return;this._renderer.lastObjectRendered&&this._updateAccessibleObjects(this._renderer.lastObjectRendered);let{x:t,y:r,width:i,height:s}=this._renderer.view.canvas.getBoundingClientRect(),{width:o,height:a,resolution:l}=this._renderer,c=i/o*l,u=s/a*l,d=this._div;d.style.left=`${t}px`,d.style.top=`${r}px`,d.style.width=`${o}px`,d.style.height=`${a}px`;for(let f=0;f<this._children.length;f++){let h=this._children[f];if(h._renderId!==this._renderId)h._accessibleActive=!1,O2(this._children,f,1),this._div.removeChild(h._accessibleDiv),this._pool.push(h._accessibleDiv),h._accessibleDiv=null,f--;else{d=h._accessibleDiv;let p=h.hitArea,m=h.worldTransform;h.hitArea?(d.style.left=`${(m.tx+p.x*m.a)*c}px`,d.style.top=`${(m.ty+p.y*m.d)*u}px`,d.style.width=`${p.width*m.a*c}px`,d.style.height=`${p.height*m.d*u}px`):(p=h.getBounds().rectangle,this._capHitArea(p),d.style.left=`${p.x*c}px`,d.style.top=`${p.y*u}px`,d.style.width=`${p.width*c}px`,d.style.height=`${p.height*u}px`,d.title!==h.accessibleTitle&&h.accessibleTitle!==null&&(d.title=h.accessibleTitle||""),d.getAttribute("aria-label")!==h.accessibleHint&&h.accessibleHint!==null&&d.setAttribute("aria-label",h.accessibleHint||"")),(h.accessibleTitle!==d.title||h.tabIndex!==d.tabIndex)&&(d.title=h.accessibleTitle||"",d.tabIndex=h.tabIndex,this.debug&&this._updateDebugHTML(d))}}this._renderId++}_updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}_capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);let{width:t,height:r}=this._renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>r&&(e.height=r-e.y)}_addChild(e){let t=this._pool.pop();t||(t=document.createElement("button"),t.style.width=`${w7}px`,t.style.height=`${w7}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=UF.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`container ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this._updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.container=e,this._children.push(e),this._div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){let{container:r}=e.target,i=this._renderer.events.rootBoundary,s=Object.assign(new To(i),{target:r});i.rootTarget=this._renderer.lastObjectRendered,t.forEach(o=>i.dispatchEvent(s,o))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===AY&&this._activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this._deactivate()}destroy(){this._destroyTouchHook(),this._div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this._pool=null,this._children=null,this._renderer=null}};Wc.extension={type:[z.WebGLSystem,z.WebGPUSystem],name:"accessibility"}});var S7,Mw=$(()=>{"use strict";S7={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,_renderId:-1}});var $F=$(()=>{ee();Vi();Dw();Mw();ke.add(Wc);we.mixin(S7)});var Vc,Rw=$(()=>{ee();Vc=class{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this._cancelResize();let t,r;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,r=globalThis.innerHeight;else{let{clientWidth:i,clientHeight:s}=this._resizeTo;t=i,r=s}this.renderer.resize(t,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}};Vc.extension=z.Application});var si,jc=$(()=>{"use strict";si=(n=>(n[n.INTERACTION=50]="INTERACTION",n[n.HIGH=25]="HIGH",n[n.NORMAL=0]="NORMAL",n[n.LOW=-25]="LOW",n[n.UTILITY=-50]="UTILITY",n))(si||{})});var pl,Fw=$(()=>{"use strict";pl=class{constructor(e,t=null,r=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=e,this._context=t,this.priority=r,this._once=i}match(e,t=null){return this._fn===e&&this._context===t}emit(e){this._fn&&(this._context?this._fn.call(this._context,e):this._fn(e));let t=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let t=this.next;return this.next=e?null:t,this.previous=null,t}}});var zF,yr,ml=$(()=>{jc();Fw();zF=class ji{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new pl(null,null,1/0),this.deltaMS=1/ji.targetFPMS,this.elapsedMS=1/ji.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=si.NORMAL){return this._addListener(new pl(e,t,r))}addOnce(e,t,r=si.NORMAL){return this._addListener(new pl(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){let s=e-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=e-s%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*ji.targetFPMS;let r=this._head,i=r.next;for(;i;)i=i.emit(this);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){let t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,ji.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{let t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!ji._shared){let e=ji._shared=new ji;e.autoStart=!0,e._protected=!0}return ji._shared}static get system(){if(!ji._system){let e=ji._system=new ji;e.autoStart=!0,e._protected=!0}return ji._system}};zF.targetFPMS=.06;yr=zF});var Xc,Bw=$(()=>{ee();jc();ml();Xc=class{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,si.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?yr.shared:new yr,e.autoStart&&this.start()}static destroy(){if(this._ticker){let e=this._ticker;this.ticker=null,e.destroy()}}};Xc.extension=z.Application});var Nw=$(()=>{ee();Rw();Bw();ke.add(Vc);ke.add(Xc)});var Ow,fs,C7=$(()=>{jc();ml();Ow=class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this._tickerAdded||!this.domElement||(yr.system.add(this._tickerUpdate,this,si.INTERACTION),this._tickerAdded=!0)}removeTickerListener(){this._tickerAdded&&(yr.system.remove(this._tickerUpdate,this),this._tickerAdded=!1)}pointerMoved(){this._didMove=!0}_update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}let e=this.events._rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY,pointerType:e.pointerType,pointerId:e.pointerId}))}_tickerUpdate(e){this._deltaTime+=e.deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this._update())}},fs=new Ow});var Vs,Xh=$(()=>{vi();Vh();Vs=class extends To{constructor(){super(...arguments),this.client=new Ve,this.movement=new Ve,this.offset=new Ve,this.global=new Ve,this.screen=new Ve}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,r){return e.worldTransform.applyInverse(r||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,r,i,s,o,a,l,c,u,d,f,h,p,m){throw new Error("Method not implemented.")}}});var vn,A7=$(()=>{Xh();vn=class extends Vs{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}});var hs,E7=$(()=>{Xh();hs=class extends Vs{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}};hs.DOM_DELTA_PIXEL=0;hs.DOM_DELTA_LINE=1;hs.DOM_DELTA_PAGE=2});var DY,MY,qh,j2,Lw=$(()=>{Nn();vi();Gt();C7();Xh();A7();E7();DY=2048,MY=new Ve,qh=new Ve,j2=class{constructor(e){this.dispatch=new st,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((r,i)=>r.priority-i.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;let t=this.mappingTable[e.type];if(t)for(let r=0,i=t.length;r<i;r++)t[r].fn(e);else ve(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){fs.pauseUpdate=!0;let i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[i](this.rootTarget,this.rootTarget.eventMode,MY.set(e,t),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(e,t){if(!e.target)return;let r=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let i=0,s=r.length-1;i<s;i++)if(e.currentTarget=r[i],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let i=r.length-2;i>=0;i--)if(e.currentTarget=r[i],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,r=this._allInteractiveElements){if(r.length===0)return;e.eventPhase=e.BUBBLING_PHASE;let i=Array.isArray(t)?t:[t];for(let s=r.length-1;s>=0;s--)i.forEach(o=>{e.currentTarget=r[s],this.notifyTarget(e,o)})}propagationPath(e){let t=[e];for(let r=0;r<DY&&e!==this.rootTarget&&e.parent;r++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,r,i,s,o=!1){let a=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(fs.pauseUpdate=!1),e.interactiveChildren&&e.children){let u=e.children;for(let d=u.length-1;d>=0;d--){let f=u[d],h=this.hitTestMoveRecursive(f,this._isInteractive(t)?t:f.eventMode,r,i,s,o||s(e,r));if(h){if(h.length>0&&!h[h.length-1].parent)continue;let p=e.isInteractive();(h.length>0||p)&&(p&&this._allInteractiveElements.push(e),h.push(e)),this._hitElements.length===0&&(this._hitElements=h),a=!0}}}let l=this._isInteractive(t),c=e.isInteractive();return c&&c&&this._allInteractiveElements.push(e),o||this._hitElements.length>0?null:a?this._hitElements:l&&!s(e,r)&&i(e,r)?c?[e]:[]:null}hitTestRecursive(e,t,r,i,s){if(this._interactivePrune(e)||s(e,r))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(fs.pauseUpdate=!1),e.interactiveChildren&&e.children){let l=e.children,c=r;for(let u=l.length-1;u>=0;u--){let d=l[u],f=this.hitTestRecursive(d,this._isInteractive(t)?t:d.eventMode,c,i,s);if(f){if(f.length>0&&!f[f.length-1].parent)continue;let h=e.isInteractive();return(f.length>0||h)&&f.push(e),f}}}let o=this._isInteractive(t),a=e.isInteractive();return o&&i(e,r)?a?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!e||!e.visible||!e.renderable||!e.measurable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren}hitPruneFn(e,t){if(e.hitArea&&(e.worldTransform.applyInverse(t,qh),!e.hitArea.contains(qh.x,qh.y)))return!0;if(e.effects&&e.effects.length)for(let r=0;r<e.effects.length;r++){let i=e.effects[r];if(i.containsPoint&&!i.containsPoint(t,this.hitTestFn))return!0}return!1}hitTestFn(e,t){return e.hitArea?!0:e?.containsPoint?(e.worldTransform.applyInverse(t,qh),e.containsPoint(qh)):!1}notifyTarget(e,t){if(!e.currentTarget.isInteractive())return;t??(t=e.type);let r=`on${t}`;e.currentTarget[r]?.(e);let i=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this._notifyListeners(e,i),e.eventPhase===e.AT_TARGET&&this._notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof vn)){ve("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){let i=t.button===2;this.dispatchEvent(t,i?"rightdown":"mousedown")}let r=this.trackingData(e.pointerId);r.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){if(!(e instanceof vn)){ve("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;let t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;let r=t.pointerType==="mouse"||t.pointerType==="pen",i=this.trackingData(e.pointerId),s=this.findMountedTarget(i.overTargets);if(i.overTargets?.length>0&&s!==t.target){let l=e.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(e,l,s);if(this.dispatchEvent(c,"pointerout"),r&&this.dispatchEvent(c,"mouseout"),!t.composedPath().includes(s)){let u=this.createPointerEvent(e,"pointerleave",s);for(u.eventPhase=u.AT_TARGET;u.target&&!t.composedPath().includes(u.target);)u.currentTarget=u.target,this.notifyTarget(u),r&&this.notifyTarget(u,"mouseleave"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(c)}if(s!==t.target){let l=e.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(t,l);this.dispatchEvent(c,"pointerover"),r&&this.dispatchEvent(c,"mouseover");let u=s?.parent;for(;u&&u!==this.rootTarget.parent&&u!==t.target;)u=u.parent;if(!u||u===this.rootTarget.parent){let f=this.clonePointerEvent(t,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==s&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),r&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(c)}let o=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?o.push("pointermove"):this.dispatchEvent(t,"pointermove"),a&&o.push("globalpointermove"),t.pointerType==="touch"&&(this.moveOnAll?o.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),a&&o.push("globaltouchmove")),r&&(this.moveOnAll?o.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),a&&o.push("globalmousemove"),this.cursor=t.target?.cursor),o.length>0&&this.all(t,o),this._allInteractiveElements.length=0,this._hitElements.length=0,i.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){if(!(e instanceof vn)){ve("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.trackingData(e.pointerId),r=this.createPointerEvent(e),i=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),i&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=r.target?.cursor);let s=this.clonePointerEvent(r,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),i&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;t.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(s)}mapPointerOut(e){if(!(e instanceof vn)){ve("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.trackingData(e.pointerId);if(t.overTargets){let r=e.pointerType==="mouse"||e.pointerType==="pen",i=this.findMountedTarget(t.overTargets),s=this.createPointerEvent(e,"pointerout",i);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");let o=this.createPointerEvent(e,"pointerleave",i);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;t.overTargets=null,this.freeEvent(s),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof vn)){ve("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=performance.now(),r=this.createPointerEvent(e);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){let a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}let i=this.trackingData(e.pointerId),s=this.findMountedTarget(i.pressTargetsByButton[e.button]),o=s;if(s&&!r.composedPath().includes(s)){let a=s;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){let l=r.button===2;this.notifyTarget(r,l?"rightupoutside":"mouseupoutside")}a=a.parent}delete i.pressTargetsByButton[e.button],o=a}if(o){let a=this.clonePointerEvent(r,"click");a.target=o,a.path=null,i.clicksByButton[e.button]||(i.clicksByButton[e.button]={clickCount:0,target:a.target,timeStamp:t});let l=i.clicksByButton[e.button];if(l.target===a.target&&t-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=t,a.detail=l.clickCount,a.pointerType==="mouse"){let c=a.button===2;this.dispatchEvent(a,c?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(e){if(!(e instanceof vn)){ve("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.trackingData(e.pointerId),r=this.findMountedTarget(t.pressTargetsByButton[e.button]),i=this.createPointerEvent(e);if(r){let s=r;for(;s;)i.currentTarget=s,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch"?this.notifyTarget(i,"touchendoutside"):(i.pointerType==="mouse"||i.pointerType==="pen")&&this.notifyTarget(i,i.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(i)}mapWheel(e){if(!(e instanceof hs)){ve("EventBoundary cannot map a non-wheel event as a wheel event");return}let t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let r=1;r<e.length&&e[r].parent===t;r++)t=e[r];return t}createPointerEvent(e,t,r){let i=this.allocateEvent(vn);return this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.nativeEvent=e.nativeEvent,i.originalEvent=e,i.target=r??this.hitTest(i.global.x,i.global.y)??this._hitElements[0],typeof t=="string"&&(i.type=t),i}createWheelEvent(e){let t=this.allocateEvent(hs);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){let r=this.allocateEvent(vn);return r.nativeEvent=e.nativeEvent,r.originalEvent=e.originalEvent,this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.target=e.target,r.path=e.composedPath().slice(),r.type=t??r.type,r}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof vn&&t instanceof vn&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof Vs&&t instanceof Vs&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);let t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.defaultPrevented=!1,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");let t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}_notifyListeners(e,t){let r=e.currentTarget._events[t];if(r)if("fn"in r)r.once&&e.currentTarget.removeListener(t,r.fn,void 0,!0),r.fn.call(r.context,e);else for(let i=0,s=r.length;i<s&&!e.propagationImmediatelyStopped;i++)r[i].once&&e.currentTarget.removeListener(t,r[i].fn,void 0,!0),r[i].fn.call(r[i].context,e)}}});var RY,FY,Gw,X2,T7=$(()=>{ee();Lw();C7();A7();E7();RY=1,FY={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Gw=class Uw{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new j2(null),fs.init(this),this.autoPreventDefault=!0,this._eventsAdded=!1,this._rootPointerEvent=new vn(null),this._rootWheelEvent=new hs(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Uw.defaultEventFeatures},{set:(t,r,i)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=i),t[r]=i,!0)}),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerUp=this._onPointerUp.bind(this),this._onPointerOverOut=this._onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){let{canvas:t,resolution:r}=this.renderer;this.setTargetElement(t),this.resolution=r,Uw._defaultEventMode=e.eventMode??"passive",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null,this._currentCursor=null}setCursor(e){e||(e="default");let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this._currentCursor===e)return;this._currentCursor=e;let r=this.cursorStyles[e];if(r)switch(typeof r){case"string":t&&(this.domElement.style.cursor=r);break;case"function":r(e);break;case"object":t&&Object.assign(this.domElement.style,r);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this._rootPointerEvent}_onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=this._normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let r=0,i=t.length;r<i;r++){let s=t[r],o=this._bootstrapEvent(this._rootPointerEvent,s);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}_onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,fs.pointerMoved();let t=this._normalizeToPointerData(e);for(let r=0,i=t.length;r<i;r++){let s=this._bootstrapEvent(this._rootPointerEvent,t[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}_onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);let r=t!==this.domElement?"outside":"",i=this._normalizeToPointerData(e);for(let s=0,o=i.length;s<o;s++){let a=this._bootstrapEvent(this._rootPointerEvent,i[s]);a.type+=r,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}_onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=this._normalizeToPointerData(e);for(let r=0,i=t.length;r<i;r++){let s=this._bootstrapEvent(this._rootPointerEvent,t[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;let t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this._removeEvents(),this.domElement=e,fs.domElement=e,this._addEvents()}_addEvents(){if(this._eventsAdded||!this.domElement)return;fs.addTickerListener();let e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._onPointerMove,!0),this.domElement.addEventListener("pointerdown",this._onPointerDown,!0),this.domElement.addEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this._onPointerOverOut,!0),globalThis.addEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this._onPointerMove,!0),this.domElement.addEventListener("mousedown",this._onPointerDown,!0),this.domElement.addEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this._onPointerOverOut,!0),globalThis.addEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this._onPointerDown,!0),this.domElement.addEventListener("touchend",this._onPointerUp,!0),this.domElement.addEventListener("touchmove",this._onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this._eventsAdded=!0}_removeEvents(){if(!this._eventsAdded||!this.domElement)return;fs.removeTickerListener();let e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction="")),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this._onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this._onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this._onPointerMove,!0),this.domElement.removeEventListener("mousedown",this._onPointerDown,!0),this.domElement.removeEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this._onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this._onPointerDown,!0),this.domElement.removeEventListener("touchend",this._onPointerUp,!0),this.domElement.removeEventListener("touchmove",this._onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this._eventsAdded=!1}mapPositionToPoint(e,t,r){let i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;e.x=(t-i.left)*(this.domElement.width/i.width)*s,e.y=(r-i.top)*(this.domElement.height/i.height)*s}_normalizeToPointerData(e){let t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let r=0,i=e.changedTouches.length;r<i;r++){let s=e.changedTouches[r];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=e.type,t.push(s)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){let r=e;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=RY),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,t.push(r)}else t.push(e);return t}normalizeWheelEvent(e){let t=this._rootWheelEvent;return this._transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}_bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this._transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=FY[e.type]||e.type),e}_transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};Gw.extension={name:"events",type:[z.WebGLSystem,z.CanvasSystem,z.WebGPUSystem],priority:-1};Gw.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};X2=Gw});var k7,$w=$(()=>{T7();Vh();k7={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return this.eventMode==="dynamic"||this.eventMode==="static"},set interactive(n){this.eventMode=n?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??X2.defaultEventMode},set eventMode(n){this._internalEventMode=n},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(n,e,t){let r=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,i=typeof t=="object"?t.signal:void 0,s=typeof t=="object"?t.once===!0:!1,o=typeof e=="function"?void 0:e;n=r?`${n}capture`:n;let a=typeof e=="function"?e:e.handleEvent,l=this;i&&i.addEventListener("abort",()=>{l.off(n,a,o)}),s?l.once(n,a,o):l.on(n,a,o)},removeEventListener(n,e,t){let r=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,i=typeof e=="function"?void 0:e;n=r?`${n}capture`:n,e=typeof e=="function"?e:e.handleEvent,this.off(n,e,i)},dispatchEvent(n){if(!(n instanceof To))throw new Error("Container cannot propagate events outside of the Federated Events API");return n.defaultPrevented=!1,n.path=null,n.target=this,n.manager.dispatchEvent(n),!n.defaultPrevented}}});var HF=$(()=>{ee();Vi();T7();$w();ke.add(X2);we.mixin(k7)});var cr,Xi=$(()=>{"use strict";cr=(n=>(n[n.Low=0]="Low",n[n.Normal=1]="Normal",n[n.High=2]="High",n))(cr||{})});var I7,zw=$(()=>{"use strict";I7={createCanvas:(n,e)=>{let t=document.createElement("canvas");return t.width=n,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(n,e)=>fetch(n,e),parseXML:n=>new DOMParser().parseFromString(n,"text/xml")}});var WF,Fe,Vt=$(()=>{zw();WF=I7,Fe={get(){return WF},set(n){WF=n}}});function js(n){if(typeof n!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(n)}`)}function Yh(n){return n.split("?")[0].split("#")[0]}function BY(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function NY(n,e,t){return n.replace(new RegExp(BY(e),"g"),t)}function OY(n,e){let t="",r=0,i=-1,s=0,o=-1;for(let a=0;a<=n.length;++a){if(a<n.length)o=n.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){let l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),i=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,i=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+=`/${n.slice(i+1,a)}`:t=n.slice(i+1,a),r=a-i-1;i=a,s=0}else o===46&&s!==-1?++s:s=-1}return t}var zr,gl=$(()=>{Vt();zr={toPosix(n){return NY(n,"\\","/")},isUrl(n){return/^https?:/.test(this.toPosix(n))},isDataUrl(n){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(n)},isBlobUrl(n){return n.startsWith("blob:")},hasProtocol(n){return/^[^/:]+:/.test(this.toPosix(n))},getProtocol(n){js(n),n=this.toPosix(n);let e=/^file:\/\/\//.exec(n);if(e)return e[0];let t=/^[^/:]+:\/{0,2}/.exec(n);return t?t[0]:""},toAbsolute(n,e,t){if(js(n),this.isDataUrl(n)||this.isBlobUrl(n))return n;let r=Yh(this.toPosix(e??Fe.get().getBaseUrl())),i=Yh(this.toPosix(t??this.rootname(r)));return n=this.toPosix(n),n.startsWith("/")?zr.join(i,n.slice(1)):this.isAbsolute(n)?n:this.join(r,n)},normalize(n){if(js(n),n.length===0)return".";if(this.isDataUrl(n)||this.isBlobUrl(n))return n;n=this.toPosix(n);let e="",t=n.startsWith("/");this.hasProtocol(n)&&(e=this.rootname(n),n=n.slice(e.length));let r=n.endsWith("/");return n=OY(n,!1),n.length>0&&r&&(n+="/"),t?`/${n}`:e+n},isAbsolute(n){return js(n),n=this.toPosix(n),this.hasProtocol(n)?!0:n.startsWith("/")},join(...n){if(n.length===0)return".";let e;for(let t=0;t<n.length;++t){let r=n[t];if(js(r),r.length>0)if(e===void 0)e=r;else{let i=n[t-1]??"";this.joinExtensions.includes(this.extname(i).toLowerCase())?e+=`/../${r}`:e+=`/${r}`}}return e===void 0?".":this.normalize(e)},dirname(n){if(js(n),n.length===0)return".";n=this.toPosix(n);let e=n.charCodeAt(0),t=e===47,r=-1,i=!0,s=this.getProtocol(n),o=n;n=n.slice(s.length);for(let a=n.length-1;a>=1;--a)if(e=n.charCodeAt(a),e===47){if(!i){r=a;break}}else i=!1;return r===-1?t?"/":this.isUrl(o)?s+n:s:t&&r===1?"//":s+n.slice(0,r)},rootname(n){js(n),n=this.toPosix(n);let e="";if(n.startsWith("/")?e="/":e=this.getProtocol(n),this.isUrl(n)){let t=n.indexOf("/",e.length);t!==-1?e=n.slice(0,t):e=n,e.endsWith("/")||(e+="/")}return e},basename(n,e){js(n),e&&js(e),n=Yh(this.toPosix(n));let t=0,r=-1,i=!0,s;if(e!==void 0&&e.length>0&&e.length<=n.length){if(e.length===n.length&&e===n)return"";let o=e.length-1,a=-1;for(s=n.length-1;s>=0;--s){let l=n.charCodeAt(s);if(l===47){if(!i){t=s+1;break}}else a===-1&&(i=!1,a=s+1),o>=0&&(l===e.charCodeAt(o)?--o===-1&&(r=s):(o=-1,r=a))}return t===r?r=a:r===-1&&(r=n.length),n.slice(t,r)}for(s=n.length-1;s>=0;--s)if(n.charCodeAt(s)===47){if(!i){t=s+1;break}}else r===-1&&(i=!1,r=s+1);return r===-1?"":n.slice(t,r)},extname(n){js(n),n=Yh(this.toPosix(n));let e=-1,t=0,r=-1,i=!0,s=0;for(let o=n.length-1;o>=0;--o){let a=n.charCodeAt(o);if(a===47){if(!i){t=o+1;break}continue}r===-1&&(i=!1,r=o+1),a===46?e===-1?e=o:s!==1&&(s=1):e!==-1&&(s=-1)}return e===-1||r===-1||s===0||s===1&&e===r-1&&e===t+1?"":n.slice(e,r)},parse(n){js(n);let e={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return e;n=Yh(this.toPosix(n));let t=n.charCodeAt(0),r=this.isAbsolute(n),i,s="";e.root=this.rootname(n),r||this.hasProtocol(n)?i=1:i=0;let o=-1,a=0,l=-1,c=!0,u=n.length-1,d=0;for(;u>=i;--u){if(t=n.charCodeAt(u),t===47){if(!c){a=u+1;break}continue}l===-1&&(c=!1,l=u+1),t===46?o===-1?o=u:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||l===-1||d===0||d===1&&o===l-1&&o===a+1?l!==-1&&(a===0&&r?e.base=e.name=n.slice(1,l):e.base=e.name=n.slice(a,l)):(a===0&&r?(e.name=n.slice(1,o),e.base=n.slice(1,l)):(e.name=n.slice(a,o),e.base=n.slice(a,l)),e.ext=n.slice(o,l)),e.dir=this.dirname(n),s&&(e.dir=s+e.dir),e},sep:"/",delimiter:":",joinExtensions:[".html"]}});var wn,q2=$(()=>{"use strict";wn=(n,e,t=!1)=>(Array.isArray(n)||(n=[n]),e?n.map(r=>typeof r=="string"||t?e(r):r):n)});function VF(n,e,t,r,i){let s=e[t];for(let o=0;o<s.length;o++){let a=s[o];t<e.length-1?VF(n.replace(r[t],a),e,t+1,r,i):i.push(n.replace(r[t],a))}}function P7(n){let e=/\{(.*?)\}/g,t=n.match(e),r=[];if(t){let i=[];t.forEach(s=>{let o=s.substring(1,s.length-1).split(",");i.push(o)}),VF(n,i,0,t,r)}else r.push(n);return r}var Hw=$(()=>{"use strict"});var wa,Kh=$(()=>{"use strict";wa=n=>!Array.isArray(n)});function Ww(n){return n.split(".").pop().split("?").shift().split("#").shift()}var Sn,yl=$(()=>{Gt();gl();q2();Hw();Kh();Sn=class{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{let t=e;this._defaultSearchParams=Object.keys(t).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(t[r])}`).join("&")}}getAlias(e){let{alias:t,src:r}=e;return wn(t||r,s=>typeof s=="string"?s:Array.isArray(s)?s.map(o=>o?.src??o):s?.src?s.src:s,!0)}addManifest(e){this._manifest&&ve("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){let r=[],i=t;Array.isArray(t)||(i=Object.entries(t).map(([s,o])=>typeof o=="string"||Array.isArray(o)?{alias:s,src:o}:{alias:s,...o})),i.forEach(s=>{let o=s.src,a=s.alias,l;if(typeof a=="string"){let c=this._createBundleAssetId(e,a);r.push(c),l=[a,c]}else{let c=a.map(u=>this._createBundleAssetId(e,u));r.push(...c),l=[...a,...c]}this.add({...s,alias:l,src:o})}),this._bundles[e]=r}add(e){let t=[];Array.isArray(e)?t.push(...e):t.push(e);let r;r=s=>{this.hasKey(s)&&ve(`[Resolver] already has key: ${s} overwriting`)},wn(t).forEach(s=>{let{src:o}=s,{data:a,format:l,loadParser:c}=s,u=wn(o).map(h=>typeof h=="string"?P7(h):Array.isArray(h)?h:[h]),d=this.getAlias(s);Array.isArray(d)?d.forEach(r):r(d);let f=[];u.forEach(h=>{h.forEach(p=>{let m={};if(typeof p!="object"){m.src=p;for(let g=0;g<this._parsers.length;g++){let y=this._parsers[g];if(y.test(p)){m=y.parse(p);break}}}else a=p.data??a,l=p.format??l,c=p.loadParser??c,m={...m,...p};if(!d)throw new Error(`[Resolver] alias is undefined for this asset: ${m.src}`);m=this._buildResolvedAsset(m,{aliases:d,data:a,format:l,loadParser:c}),f.push(m)})}),d.forEach(h=>{this._assetMap[h]=f})})}resolveBundle(e){let t=wa(e);e=wn(e);let r={};return e.forEach(i=>{let s=this._bundles[i];if(s){let o=this.resolve(s),a={};for(let l in o){let c=o[l];a[this._extractAssetIdFromBundle(i,l)]=c}r[i]=a}}),t?r[e[0]]:r}resolveUrl(e){let t=this.resolve(e);if(typeof e!="string"){let r={};for(let i in t)r[i]=t[i].src;return r}return t.src}resolve(e){let t=wa(e);e=wn(e);let r={};return e.forEach(i=>{if(!this._resolverHash[i])if(this._assetMap[i]){let s=this._assetMap[i],o=this._getPreferredOrder(s);o?.priority.forEach(a=>{o.params[a].forEach(l=>{let c=s.filter(u=>u[a]?u[a]===l:!1);c.length&&(s=c)})}),this._resolverHash[i]=s[0]}else this._resolverHash[i]=this._buildResolvedAsset({alias:[i],src:i},{});r[i]=this._resolverHash[i]}),t?r[e[0]]:r}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){let r=e[0],i=this._preferredOrder.find(s=>s.params.format.includes(r.format));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;let t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}_buildResolvedAsset(e,t){let{aliases:r,data:i,loadParser:s,format:o}=t;return(this._basePath||this._rootPath)&&(e.src=zr.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=r??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...i||{},...e.data},e.loadParser=s??e.loadParser,e.format=o??e.format??Ww(e.src),e}};Sn.RETINA_PREFIX=/@([0-9\.]+)x/});var qc,D7=$(()=>{"use strict";qc=(n,e)=>{let t=e.split("?")[1];return t&&(n+=`?${t}`),n}});var jF,Zh,Vw=$(()=>{Qr();_t();jF=class Qh{constructor(e,t){this.linkedSheets=[],this._texture=e instanceof re?e:null,this.textureSource=e.source,this.textures={},this.animations={},this.data=t;let r=parseFloat(t.meta.scale);r?(this.resolution=r,e.source.resolution=this.resolution):this.resolution=e.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Qh.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e,r=Qh.BATCH_SIZE;for(;t-e<r&&t<this._frameKeys.length;){let i=this._frameKeys[t],s=this._frames[i],o=s.frame;if(o){let a=null,l=null,c=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,u=new $e(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);s.rotated?a=new $e(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new $e(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(l=new $e(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[i]=new re({source:this.textureSource,frame:a,orig:u,trim:l,rotate:s.rotated?2:0,defaultAnchor:s.anchor,defaultBorders:s.borders,label:i.toString()})}t++}}_processAnimations(){let e=this.data.animations||{};for(let t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){let i=e[t][r];this.animations[t].push(this.textures[i])}}}_parseComplete(){let e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Qh.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Qh.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(let t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};jF.BATCH_SIZE=1e3;Zh=jF});function XF(n,e,t){let r={};if(n.forEach(i=>{r[i]=e}),Object.keys(e.textures).forEach(i=>{r[i]=e.textures[i]}),!t){let i=zr.dirname(n[0]);e.linkedSheets.forEach((s,o)=>{let a=XF([`${i}/${e.data.meta.related_multi_packs[o]}`],s,!0);Object.assign(r,a)})}return r}var LY,M7,jw=$(()=>{Xi();yl();D7();ee();_t();gl();Vw();LY=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];M7={extension:z.Asset,cache:{test:n=>n instanceof Zh,getCacheableAssets:(n,e)=>XF(n,e,!1)},resolver:{extension:{type:z.ResolveParser,name:"resolveSpritesheet"},test:n=>{let t=n.split("?")[0].split("."),r=t.pop(),i=t.pop();return r==="json"&&LY.includes(i)},parse:n=>{let e=n.split(".");return{resolution:parseFloat(Sn.RETINA_PREFIX.exec(n)?.[1]??"1"),format:e[e.length-2],src:n}}},loader:{name:"spritesheetLoader",extension:{type:z.LoadParser,priority:cr.Normal,name:"spritesheetLoader"},async testParse(n,e){return zr.extname(e.src).toLowerCase()===".json"&&!!n.frames},async parse(n,e,t){let{texture:r,imageFilename:i}=e?.data??{},s=zr.dirname(e.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");let o;if(r instanceof re)o=r;else{let c=qc(s+(i??n.meta.image),e.src);o=(await t.load([c]))[c]}let a=new Zh(o.source,n);await a.parse();let l=n?.meta?.related_multi_packs;if(Array.isArray(l)){let c=[];for(let d of l){if(typeof d!="string")continue;let f=s+d;e.data?.ignoreMultiPack||(f=qc(f,e.src),c.push(t.load({src:f,data:{ignoreMultiPack:!0}})))}let u=await Promise.all(c);a.linkedSheets=u,u.forEach(d=>{d.linkedSheets=[a].concat(a.linkedSheets.filter(f=>f!==d))})}return a},async unload(n,e,t){await t.unload(n.textureSource._sourceOrigin),n.destroy(!1)}}}});var R7=$(()=>{ee();jw();ke.add(M7)});function Sa(n,e,t,r){let{width:i,height:s}=t.orig,o=t.trim;if(o){let a=o.width,l=o.height;n.minX=o.x-e._x*i-r,n.maxX=n.minX+a,n.minY=o.y-e._y*s-r,n.maxY=n.minY+l}else n.minX=-e._x*i-r,n.maxX=n.minX+i,n.minY=-e._y*s-r,n.maxY=n.minY+s}var Jh=$(()=>{"use strict"});var Zr,ko=$(()=>{Ln();Vi();Zr=class extends we{constructor(){super(...arguments),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._bounds=new Nt(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(e){this._roundPixels=e?1:0}containsPoint(e){let t=this.bounds,{x:r,y:i}=e;return r>=t.minX&&r<=t.maxX&&i>=t.minY&&i<=t.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;let e=this.renderGroup||this.parentRenderGroup;e&&e.onChildViewUpdate(this)}destroy(e){super.destroy(e),this._bounds=null}}});var At,xl=$(()=>{Bc();_t();Jh();zt();ko();At=class n extends Zr{constructor(e=re.EMPTY){e instanceof re&&(e={texture:e});let{texture:t=re.EMPTY,anchor:r,roundPixels:i,width:s,height:o,...a}=e;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new Zt({_onUpdate:()=>{this.onViewUpdate()}}),r?this.anchor=r:t.defaultAnchor&&(this.anchor=t.defaultAnchor),this.texture=t,this.allowChildren=!1,this.roundPixels=i??!1,s!==void 0&&(this.width=s),o!==void 0&&(this.height=o)}static from(e,t=!1){return e instanceof re?new n(e):new n(re.from(e,t))}set texture(e){e||(e=re.EMPTY);let t=this._texture;t!==e&&(t&&t.dynamic&&t.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return Sa(this._visualBounds,this._anchor,this._texture,0),this._visualBounds}get sourceBounds(){return oe("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){let e=this._anchor,t=this._texture,r=this._bounds,{width:i,height:s}=t.orig;r.minX=-e._x*i,r.maxX=r.minX+i,r.minY=-e._y*s,r.maxY=r.minY+s}destroy(e=!1){if(super.destroy(e),typeof e=="boolean"?e:e?.texture){let r=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(r)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this._setWidth(e,this._texture.orig.width),this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this._setHeight(e,this._texture.orig.height),this._height=e}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this._texture.orig.width,e.height=Math.abs(this.scale.y)*this._texture.orig.height,e}setSize(e,t){typeof e=="object"?(t=e.height??e.width,e=e.width):t??(t=e),e!==void 0&&this._setWidth(e,this._texture.orig.width),t!==void 0&&this._setHeight(t,this._texture.orig.height)}}});function bl(n,e,t){let r=UY;n.measurable=!0,Eo(n,t,r),e.addBoundsMask(r),n.measurable=!1}var UY,e4=$(()=>{Ln();Nc();UY=new Nt});function _l(n,e,t){let r=ii.get();n.measurable=!0;let i=Br.get().identity(),s=F7(n,t,i);ul(n,r,s),n.measurable=!1,e.addBoundsMask(r),Br.return(i),ii.return(r)}function F7(n,e,t){return n?(n!==e&&(F7(n.parent,e,t),n.updateLocalTransform(),t.append(n.localTransform)),t):(ve("Mask bounds, renderable is not inside the root container"),t)}var t4=$(()=>{Gh();ll();Gt()});var Yc,Xw=$(()=>{ee();xl();e4();t4();Yc=class{constructor(e){this.priority=0,this.inverse=!1,this.pipe="alphaMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.renderMaskToTexture=!(e instanceof At),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(e,t){this.inverse||bl(this.mask,e,t)}addLocalBounds(e,t){_l(this.mask,e,t)}containsPoint(e,t){let r=this.mask;return t(r,e)}destroy(){this.reset()}static test(e){return e instanceof At}};Yc.extension=z.MaskEffect});var Kc,qw=$(()=>{ee();Kc=class{constructor(e){this.priority=0,this.pipe="colorMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e}destroy(){}static test(e){return typeof e=="number"}};Kc.extension=z.MaskEffect});var Qc,Yw=$(()=>{ee();Vi();e4();t4();Qc=class{constructor(e){this.priority=0,this.pipe="stencilMask",e?.mask&&this.init(e.mask)}init(e){this.mask=e,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(e,t){bl(this.mask,e,t)}addLocalBounds(e,t){_l(this.mask,e,t)}containsPoint(e,t){let r=this.mask;return t(r,e)}destroy(){this.reset()}static test(e){return e instanceof we}};Qc.extension=z.MaskEffect});var Cn,Zc=$(()=>{Vt();ee();cn();Cn=class extends ot{constructor(e){e.resource||(e.resource=Fe.get().createCanvas()),e.width||(e.width=e.resource.width,e.autoDensity||(e.width/=e.resolution)),e.height||(e.height=e.resource.height,e.autoDensity||(e.height/=e.resolution)),super(e),this.uploadMethodId="image",this.autoDensity=e.autoDensity,this.resizeCanvas(),this.transparent=!!e.transparent}resizeCanvas(){this.autoDensity&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(e=this.width,t=this.height,r=this._resolution){let i=super.resize(e,t,r);return i&&this.resizeCanvas(),i}static test(e){return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&e instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}};Cn.extension=z.TextureSource});var An,Jc=$(()=>{Vt();ee();Gt();cn();An=class extends ot{constructor(e){if(e.resource&&globalThis.HTMLImageElement&&e.resource instanceof HTMLImageElement){let t=Fe.get().createCanvas(e.resource.width,e.resource.height);t.getContext("2d").drawImage(e.resource,0,0,e.resource.width,e.resource.height),e.resource=t,ve("ImageSource: Image element passed, converting to canvas. Use CanvasSource instead.")}super(e),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(e){return globalThis.HTMLImageElement&&e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||globalThis.VideoFrame&&e instanceof VideoFrame}};An.extension=z.TextureSource});async function Y2(){return Kw??(Kw=(async()=>{let e=document.createElement("canvas").getContext("webgl");if(!e)return"premultiply-alpha-on-upload";let t=await new Promise(o=>{let a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!t)return"premultiply-alpha-on-upload";let r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);let i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);let s=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,s),e.deleteFramebuffer(i),e.deleteTexture(r),e.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Kw}var Kw,B7=$(()=>{"use strict"});var N7,vl,O7=$(()=>{ee();ml();B7();cn();N7=class qF extends ot{constructor(e){super(e),this.isReady=!1,this.uploadMethodId="video",e={...qF.defaultOptions,...e},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this.alphaMode=e.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){let e=yr.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;let e=this.resource,t=this.options;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(t.preload||e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlayThrough),e.addEventListener("error",this._onError,!0)),this.alphaMode=await Y2(),this._load=new Promise((r,i)=>{this.isValid?r(this):(this._resolve=r,this._reject=i,t.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${t.preloadTimeoutMs}ms`))})),e.load())}),this._load}_onError(e){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){let e=this.resource;return!e.paused&&!e.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){let e=this.resource;this.isValid&&(this.isReady=!0,this.resize(e.videoWidth,e.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();let e=this.resource;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlayThrough),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(yr.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(yr.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(yr.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement}};N7.extension=z.TextureSource;N7.defaultOptions={...ot.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};N7.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};vl=N7});var Qw,kt,Io=$(()=>{Gt();q2();Qw=class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){let t=this._cache.get(e);return t||ve(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){let r=wn(e),i;for(let l=0;l<this.parsers.length;l++){let c=this.parsers[l];if(c.test(t)){i=c.getCacheableAssets(r,t);break}}let s=new Map(Object.entries(i||{}));i||r.forEach(l=>{s.set(l,t)});let o=[...s.keys()],a={cacheKeys:o,keys:r};r.forEach(l=>{this._cacheMap.set(l,a)}),o.forEach(l=>{let c=i?i[l]:t;this._cache.has(l)&&this._cache.get(l)!==c&&ve("[Cache] already has key:",l),this._cache.set(l,s.get(l))})}remove(e){if(!this._cacheMap.has(e)){ve(`[Assets] Asset id ${e} was not found in the Cache`);return}let t=this._cacheMap.get(e);t.cacheKeys.forEach(i=>{this._cache.delete(i)}),t.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}},kt=new Qw});function YF(n={}){return Jw(n)}function Jw(n={}){let e=n&&n.resource,t=e?n.resource:n,r=e?n:{resource:n};for(let i=0;i<Zw.length;i++){let s=Zw[i];if(s.test(t))return new s(r)}throw new Error(`Could not find a source type for resource: ${r.resource}`)}function eS(n={},e=!1){let t=n&&n.resource,r=t?n.resource:n,i=t?n:{resource:n};if(!e&&kt.has(r))return kt.get(r);let s=new re({source:Jw(i)});return s.on("destroy",()=>{kt.has(r)&&kt.remove(r)}),e||kt.set(r,s),s}function tS(n,e=!1){return typeof n=="string"?kt.get(n):n instanceof ot?new re({source:n}):eS(n,e)}var Zw,rS=$(()=>{Io();ee();cn();_t();Zw=[];ke.handleByList(z.TextureSource,Zw);re.from=tS;ot.from=Jw});var L7=$(()=>{ee();Xw();qw();Yw();y7();Zc();Jc();O7();rS();ke.add(Yc,Kc,Qc,vl,An,Cn,_a)});var Jr,Ca=$(()=>{"use strict";Jr=class{constructor(e){this.resources=Object.create(null),this._dirty=!0;let t=0;for(let r in e){let i=e[r];this.setResource(i,t++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;let e=[],t=0;for(let r in this.resources)e[t++]=this.resources[r]._resourceId;this._key=e.join("|")}setResource(e,t){let r=this.resources[t];e!==r&&(r&&e.off?.("change",this.onResourceChange,this),e.on?.("change",this.onResourceChange,this),this.resources[t]=e,this._dirty=!0)}getResource(e){return this.resources[e]}_touch(e){let t=this.resources;for(let r in t)t[r]._touched=e}destroy(){let e=this.resources;for(let t in e)e[t].off?.("change",this.onResourceChange,this);this.resources=null}onResourceChange(e){if(this._dirty=!0,e.destroyed){let t=this.resources;for(let r in t)t[r]===e&&(t[r]=null)}else this._updateKey()}}});function K2(){return(!U7||U7?.isContextLost())&&(U7=Fe.get().createCanvas().getContext("webgl",{})),U7}var U7,G7=$(()=>{Vt()});function $Y(n){let e="";for(let t=0;t<n;++t)t>0&&(e+=`
else `),t<n-1&&(e+=`if(test == ${t}.0){}`);return e}function $7(n,e){if(n===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let t=e.createShader(e.FRAGMENT_SHADER);try{for(;;){let r=GY.replace(/%forloop%/gi,$Y(n));if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))n=n/2|0;else break}}finally{e.deleteShader(t)}return n}var GY,nS=$(()=>{"use strict";GY=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`)});function Si(){if(Q2)return Q2;let n=K2();return Q2=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),Q2=$7(Q2,n),n.getExtension("WEBGL_lose_context")?.loseContext(),Q2}var Q2,wl=$(()=>{G7();nS();Q2=null});function Sl(n,e){let t=2166136261;for(let r=0;r<e;r++)t^=n[r].uid,t=Math.imul(t,16777619),t>>>=0;return KF[t]||zY(n,e,t)}function zY(n,e,t){let r={},i=0;iS||(iS=Si());for(let o=0;o<iS;o++){let a=o<e?n[o]:re.EMPTY.source;r[i++]=a.source,r[i++]=a.style}let s=new Jr(r);return KF[t]=s,s}var KF,iS,r4=$(()=>{Ca();_t();wl();KF={};iS=0});var ps,z7=$(()=>{"use strict";ps=class{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}});function eu(n,e){let t=n.byteLength/8|0,r=new Float64Array(n,0,t);new Float64Array(e,0,t).set(r);let s=n.byteLength-t*8;if(s>0){let o=new Uint8Array(n,t*8,s);new Uint8Array(e,t*8,s).set(o)}}var H7=$(()=>{"use strict"});var W7,Jt,Cl=$(()=>{"use strict";W7={normal:"normal-npm",add:"add-npm",screen:"screen-npm"},Jt=(n=>(n[n.DISABLED=0]="DISABLED",n[n.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",n[n.MASK_ACTIVE=2]="MASK_ACTIVE",n[n.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",n[n.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",n[n.NONE=5]="NONE",n))(Jt||{})});function Xs(n,e){return e.alphaMode==="no-premultiply-alpha"&&W7[n]||n}var Z2=$(()=>{Cl()});var J2,sS=$(()=>{"use strict";J2=class{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let e=0;e<this.count;e++){let t=this.textures[e];this.textures[e]=null,this.ids[t.uid]=null}this.count=0}}});function QF(){return oS>0?JF[--oS]:new i4}function ZF(n){JF[oS++]=n}var i4,JF,oS,n4,eB,j7,aS=$(()=>{_n();z7();H7();Z2();wl();sS();i4=class{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new J2,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}},JF=[],oS=0;n4=0,eB=class V7{constructor(e={}){this.uid=gt("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],V7.defaultOptions.maxTextures=V7.defaultOptions.maxTextures??Si(),e={...V7.defaultOptions,...e};let{maxTextures:t,attributesInitialSize:r,indicesInitialSize:i}=e;this.attributeBuffer=new ps(r*4),this.indexBuffer=new Uint16Array(i),this.maxTextures=t}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let e=0;e<this.batchIndex;e++)ZF(this.batches[e]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(e){this._elements[this.elementSize++]=e,e._indexStart=this.indexSize,e._attributeStart=this.attributeSize,e._batcher=this,this.indexSize+=e.indexSize,this.attributeSize+=e.attributeSize*this.vertexSize}checkAndUpdateTexture(e,t){let r=e._batch.textures.ids[t._source.uid];return!r&&r!==0?!1:(e._textureId=r,e.texture=t,!0)}updateElement(e){this.dirty=!0;let t=this.attributeBuffer;e.packAsQuad?this.packQuadAttributes(e,t.float32View,t.uint32View,e._attributeStart,e._textureId):this.packAttributes(e,t.float32View,t.uint32View,e._attributeStart,e._textureId)}break(e){let t=this._elements;if(!t[this.elementStart])return;let r=QF(),i=r.textures;i.clear();let s=t[this.elementStart],o=Xs(s.blendMode,s.texture._source),a=s.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);let l=this.attributeBuffer.float32View,c=this.attributeBuffer.uint32View,u=this.indexBuffer,d=this._batchIndexSize,f=this._batchIndexStart,h="startBatch",p=this.maxTextures;for(let m=this.elementStart;m<this.elementSize;++m){let g=t[m];t[m]=null;let x=g.texture._source,b=Xs(g.blendMode,x),_=o!==b||a!==g.topology;if(x._batchTick===n4&&!_){g._textureId=x._textureBindLocation,d+=g.indexSize,g.packAsQuad?(this.packQuadAttributes(g,l,c,g._attributeStart,g._textureId),this.packQuadIndex(u,g._indexStart,g._attributeStart/this.vertexSize)):(this.packAttributes(g,l,c,g._attributeStart,g._textureId),this.packIndex(g,u,g._indexStart,g._attributeStart/this.vertexSize)),g._batch=r;continue}x._batchTick=n4,(i.count>=p||_)&&(this._finishBatch(r,f,d-f,i,o,a,e,h),h="renderBatch",f=d,o=b,a=g.topology,r=QF(),i=r.textures,i.clear(),++n4),g._textureId=x._textureBindLocation=i.count,i.ids[x.uid]=i.count,i.textures[i.count++]=x,g._batch=r,d+=g.indexSize,g.packAsQuad?(this.packQuadAttributes(g,l,c,g._attributeStart,g._textureId),this.packQuadIndex(u,g._indexStart,g._attributeStart/this.vertexSize)):(this.packAttributes(g,l,c,g._attributeStart,g._textureId),this.packIndex(g,u,g._indexStart,g._attributeStart/this.vertexSize))}i.count>0&&(this._finishBatch(r,f,d-f,i,o,a,e,h),f=d,++n4),this.elementStart=this.elementSize,this._batchIndexStart=f,this._batchIndexSize=d}_finishBatch(e,t,r,i,s,o,a,l){e.gpuBindGroup=null,e.bindGroup=null,e.action=l,e.batcher=this,e.textures=i,e.blendMode=s,e.topology=o,e.start=t,e.size=r,++n4,this.batches[this.batchIndex++]=e,a.add(e)}finish(e){this.break(e)}ensureAttributeBuffer(e){e*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(e*4)}ensureIndexBuffer(e){e<=this.indexBuffer.length||this._resizeIndexBuffer(e)}_resizeAttributeBuffer(e){let t=Math.max(e,this.attributeBuffer.size*2),r=new ps(t);eu(this.attributeBuffer.rawBinaryData,r.rawBinaryData),this.attributeBuffer=r}_resizeIndexBuffer(e){let t=this.indexBuffer,r=Math.max(e,t.length*1.5);r+=r%2;let i=r>65535?new Uint32Array(r):new Uint16Array(r);if(i.BYTES_PER_ELEMENT!==t.BYTES_PER_ELEMENT)for(let s=0;s<t.length;s++)i[s]=t[s];else eu(t.buffer,i.buffer);this.indexBuffer=i}packQuadIndex(e,t,r){e[t]=r+0,e[t+1]=r+1,e[t+2]=r+2,e[t+3]=r+0,e[t+4]=r+2,e[t+5]=r+3}packIndex(e,t,r,i){let s=e.indices,o=e.indexSize,a=e.indexOffset,l=e.attributeOffset;for(let c=0;c<o;c++)t[r++]=i+s[c+a]-l}destroy(){for(let e=0;e<this.batches.length;e++)ZF(this.batches[e]);this.batches=null;for(let e=0;e<this._elements.length;e++)this._elements[e]._batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};eB.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};j7=eB});var nt,qs=$(()=>{"use strict";nt=(n=>(n[n.MAP_READ=1]="MAP_READ",n[n.MAP_WRITE=2]="MAP_WRITE",n[n.COPY_SRC=4]="COPY_SRC",n[n.COPY_DST=8]="COPY_DST",n[n.INDEX=16]="INDEX",n[n.VERTEX=32]="VERTEX",n[n.UNIFORM=64]="UNIFORM",n[n.STORAGE=128]="STORAGE",n[n.INDIRECT=256]="INDIRECT",n[n.QUERY_RESOLVE=512]="QUERY_RESOLVE",n[n.STATIC=1024]="STATIC",n))(nt||{})});var ar,Po=$(()=>{Nn();_n();qs();ar=class extends st{constructor(e){let{data:t,size:r}=e,{usage:i,label:s,shrinkToFit:o}=e;super(),this.uid=gt("buffer"),this._resourceType="buffer",this._resourceId=gt("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,t instanceof Array&&(t=new Float32Array(t)),this._data=t,r??(r=t?.byteLength);let a=!!t;this.descriptor={size:r,usage:i,mappedAtCreation:a,label:s},this.shrinkToFit=o??!0}get data(){return this._data}set data(e){this.setDataWithSize(e,e.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&nt.STATIC)}set static(e){e?this.descriptor.usage|=nt.STATIC:this.descriptor.usage&=~nt.STATIC}setDataWithSize(e,t,r){if(this._updateID++,this._updateSize=t*e.BYTES_PER_ELEMENT,this._data===e){r&&this.emit("update",this);return}let i=this._data;if(this._data=e,this._dataInt32=null,!i||i.length!==e.length){!this.shrinkToFit&&i&&e.byteLength<i.byteLength?r&&this.emit("update",this):(this.descriptor.size=e.byteLength,this._resourceId=gt("resource"),this.emit("change",this));return}r&&this.emit("update",this)}update(e){this._updateSize=e??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}});function s4(n,e){if(!(n instanceof ar)){let t=e?nt.INDEX:nt.VERTEX;n instanceof Array&&(e?(n=new Uint32Array(n),t=nt.INDEX|nt.COPY_DST):(n=new Float32Array(n),t=nt.VERTEX|nt.COPY_DST)),n=new ar({data:n,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:t})}return n}var lS=$(()=>{Po();qs()});function X7(n,e,t){let r=n.getAttribute(e);if(!r)return t.minX=0,t.minY=0,t.maxX=0,t.maxY=0,t;let i=r.buffer.data,s=1/0,o=1/0,a=-1/0,l=-1/0,c=i.BYTES_PER_ELEMENT,u=(r.offset||0)/c,d=(r.stride||2*4)/c;for(let f=u;f<i.length;f+=d){let h=i[f],p=i[f+1];h>a&&(a=h),p>l&&(l=p),h<s&&(s=h),p<o&&(o=p)}return t.minX=s,t.minY=o,t.maxX=a,t.maxY=l,t}var cS=$(()=>{"use strict"});function HY(n){return(n instanceof ar||Array.isArray(n)||n.BYTES_PER_ELEMENT)&&(n={buffer:n}),n.buffer=s4(n.buffer,!1),n}var Gn,Al=$(()=>{Nn();Ln();_n();Po();lS();cS();Gn=class extends st{constructor(e={}){super(),this.uid=gt("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new Nt,this._boundsDirty=!0;let{attributes:t,indexBuffer:r,topology:i}=e;if(this.buffers=[],this.attributes={},t)for(let s in t)this.addAttribute(s,t[s]);this.instanceCount=e.instanceCount??1,r&&this.addIndex(r),this.topology=i||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(e){return this.attributes[e]}getIndex(){return this.indexBuffer}getBuffer(e){return this.getAttribute(e).buffer}getSize(){for(let e in this.attributes){let t=this.attributes[e];return t.buffer.data.length/(t.stride/4||t.size)}return 0}addAttribute(e,t){let r=HY(t);this.buffers.indexOf(r.buffer)===-1&&(this.buffers.push(r.buffer),r.buffer.on("update",this.onBufferUpdate,this),r.buffer.on("change",this.onBufferUpdate,this)),this.attributes[e]=r}addIndex(e){this.indexBuffer=s4(e,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,X7(this,"aPosition",this._bounds)):this._bounds}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners(),e&&this.buffers.forEach(t=>t.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}});var WY,VY,e0,uS=$(()=>{Po();qs();Al();WY=new Float32Array(1),VY=new Uint32Array(1),e0=class extends Gn{constructor(){let t=new ar({data:WY,label:"attribute-batch-buffer",usage:nt.VERTEX|nt.COPY_DST,shrinkToFit:!1}),r=new ar({data:VY,label:"index-batch-buffer",usage:nt.INDEX|nt.COPY_DST,shrinkToFit:!1}),i=6*4;super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:i,offset:0},aUV:{buffer:t,format:"float32x2",stride:i,offset:2*4},aColor:{buffer:t,format:"unorm8x4",stride:i,offset:4*4},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:i,offset:5*4}},indexBuffer:r})}}});function Ys(n,e){let t=tB[n];return t===void 0&&(dS[e]===void 0&&(dS[e]=1),tB[n]=t=dS[e]++),t}var dS,tB,t0=$(()=>{"use strict";dS=Object.create(null),tB=Object.create(null)});function Y7(){if(!q7){q7="mediump";let n=K2();n&&n.getShaderPrecisionFormat&&(q7=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision?"highp":"mediump")}return q7}var q7,fS=$(()=>{G7()});function K7(n,e,t){return e?n:t?(n=n.replace("out vec4 finalColor;",""),`
        
        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${n}
        `):`
        
        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${n}
        `}var hS=$(()=>{"use strict"});function Q7(n,e,t){let r=t?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if(n.substring(0,9)!=="precision"){let i=t?e.requestedFragmentPrecision:e.requestedVertexPrecision;return i==="highp"&&r!=="highp"&&(i="mediump"),`precision ${i} float;
${n}`}else if(r!=="highp"&&n.substring(0,15)==="precision highp")return n.replace("precision highp","precision mediump");return n}var pS=$(()=>{"use strict"});function Z7(n,e){return e?`#version 300 es
${n}`:n}var mS=$(()=>{"use strict"});function J7(n,{name:e="pixi-program"},t=!0){e=e.replace(/\s+/g,"-"),e+=t?"-fragment":"-vertex";let r=t?jY:XY;return r[e]?(r[e]++,e+=`-${r[e]}`):r[e]=1,n.indexOf("#define SHADER_NAME")!==-1?n:`${`#define SHADER_NAME ${e}`}
${n}`}var jY,XY,gS=$(()=>{"use strict";jY={},XY={}});function e9(n,e){return e?n.replace("#version 300 es",""):n}var yS=$(()=>{"use strict"});var xS,bS,rB,he,Ci=$(()=>{t0();fS();hS();pS();mS();gS();yS();xS={stripVersion:e9,ensurePrecision:Q7,addProgramDefines:K7,setProgramName:J7,insertVersion:Z7},bS=Object.create(null),rB=class _S{constructor(e){e={..._S.defaultOptions,...e};let t=e.fragment.indexOf("#version 300 es")!==-1,r={stripVersion:t,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:Y7()},setProgramName:{name:e.name},addProgramDefines:t,insertVersion:t},i=e.fragment,s=e.vertex;Object.keys(xS).forEach(o=>{let a=r[o];i=xS[o](i,a,!0),s=xS[o](s,a,!1)}),this.fragment=i,this.vertex=s,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=Ys(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(e){let t=`${e.vertex}:${e.fragment}`;return bS[t]||(bS[t]=new _S(e)),bS[t]}};rB.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};he=rB});function $n(n){return nB[n]??nB.float32}var nB,El=$(()=>{"use strict";nB={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}}});function t9({source:n,entryPoint:e}){let t={},r=n.indexOf(`fn ${e}`);if(r!==-1){let i=n.indexOf("->",r);if(i!==-1){let s=n.substring(r,i),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g,a;for(;(a=o.exec(s))!==null;){let l=qY[a[3]]??"float32";t[a[2]]={location:parseInt(a[1],10),format:l,stride:$n(l).stride,offset:0,instance:!1,start:0}}}}return t}var qY,vS=$(()=>{El();qY={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"}});function r0(n){let e=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,t=/@group\((\d+)\)/,r=/@binding\((\d+)\)/,i=/var(<[^>]+>)? (\w+)/,s=/:\s*(\w+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,a=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,c=n.match(e)?.map(d=>({group:parseInt(d.match(t)[1],10),binding:parseInt(d.match(r)[1],10),name:d.match(i)[2],isUniform:d.match(i)[1]==="<uniform>",type:d.match(s)[1]}));if(!c)return{groups:[],structs:[]};let u=n.match(o)?.map(d=>{let f=d.match(l)[1],h=d.match(a).reduce((p,m)=>{let[g,y]=m.split(":");return p[g.trim()]=y.trim(),p},{});return h?{name:f,members:h}:null}).filter(({name:d})=>c.some(f=>f.type===d))??[];return{groups:c,structs:u}}var wS=$(()=>{"use strict"});var Tl,SS=$(()=>{"use strict";Tl=(n=>(n[n.VERTEX=1]="VERTEX",n[n.FRAGMENT=2]="FRAGMENT",n[n.COMPUTE=4]="COMPUTE",n))(Tl||{})});function r9({groups:n}){let e=[];for(let t=0;t<n.length;t++){let r=n[t];e[r.group]||(e[r.group]=[]),r.isUniform?e[r.group].push({binding:r.binding,visibility:Tl.VERTEX|Tl.FRAGMENT,buffer:{type:"uniform"}}):r.type==="sampler"?e[r.group].push({binding:r.binding,visibility:Tl.FRAGMENT,sampler:{type:"filtering"}}):r.type==="texture_2d"&&e[r.group].push({binding:r.binding,visibility:Tl.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}var CS=$(()=>{SS()});function n9({groups:n}){let e=[];for(let t=0;t<n.length;t++){let r=n[t];e[r.group]||(e[r.group]={}),e[r.group][r.name]=r.binding}return e}var AS=$(()=>{"use strict"});function i9(n,e){let t=new Set,r=new Set,i=[...n.structs,...e.structs].filter(o=>t.has(o.name)?!1:(t.add(o.name),!0)),s=[...n.groups,...e.groups].filter(o=>{let a=`${o.name}-${o.binding}`;return r.has(a)?!1:(r.add(a),!0)});return{structs:i,groups:s}}var ES=$(()=>{"use strict"});var TS,pe,qi=$(()=>{t0();vS();wS();CS();AS();ES();TS=Object.create(null),pe=class n{constructor(e){this._layoutKey=0,this._attributeLocationsKey=0;let{fragment:t,vertex:r,layout:i,gpuLayout:s,name:o}=e;if(this.name=o,this.fragment=t,this.vertex=r,t.source===r.source){let a=r0(t.source);this.structsAndGroups=a}else{let a=r0(r.source),l=r0(t.source);this.structsAndGroups=i9(a,l)}this.layout=i??n9(this.structsAndGroups),this.gpuLayout=s??r9(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){let{vertex:e,fragment:t}=this,r=e.source+t.source+e.entryPoint+t.entryPoint;this._layoutKey=Ys(r,"program")}get attributeData(){return this._attributeData??(this._attributeData=t9(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(e){let t=`${e.vertex.source}:${e.fragment.source}:${e.fragment.entryPoint}:${e.vertex.entryPoint}`;return TS[t]||(TS[t]=new n(e)),TS[t]}}});function o4(n,e,t){if(n)for(let r in n){let i=r.toLocaleLowerCase(),s=e[i];if(s){let o=n[r];r==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),t&&s.push(`//----${t}----//`),s.push(o)}else ve(`${r} placement hook does not exist in shader`)}}var kS=$(()=>{Gt()});function a4(n){let e={};return(n.match(IS)?.map(r=>r.replace(/[{()}]/g,""))??[]).forEach(r=>{e[r]=[]}),e}var IS,PS=$(()=>{"use strict";IS=/\{\{(.*?)\}\}/g});function iB(n,e){let t,r=/@in\s+([^;]+);/g;for(;(t=r.exec(n))!==null;)e.push(t[1])}function l4(n,e,t=!1){let r=[];iB(e,r),n.forEach(a=>{a.header&&iB(a.header,r)});let i=r;t&&i.sort();let s=i.map((a,l)=>`       @location(${l}) ${a},`).join(`
`),o=e.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${s}
`),o}var DS=$(()=>{"use strict"});function sB(n,e){let t,r=/@out\s+([^;]+);/g;for(;(t=r.exec(n))!==null;)e.push(t[1])}function YY(n){let t=/\b(\w+)\s*:/g.exec(n);return t?t[1]:""}function KY(n){let e=/@.*?\s+/g;return n.replace(e,"")}function s9(n,e){let t=[];sB(e,t),n.forEach(l=>{l.header&&sB(l.header,t)});let r=0,i=t.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${r++}) ${l}`).join(`,
`),s=t.sort().map(l=>`       var ${KY(l)};`).join(`
`),o=`return VSOutput(
            ${t.sort().map(l=>` ${YY(l)}`).join(`,
`)});`,a=e.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${i}
`),a=a.replace("{{start}}",`
${s}
`),a=a.replace("{{return}}",`
${o}
`),a}var MS=$(()=>{"use strict"});function c4(n,e){let t=n;for(let r in e){let i=e[r];i.join(`
`).length?t=t.replace(`{{${r}}}`,`//-----${r} START-----//
${i.join(`
`)}
//----${r} FINISH----//`):t=t.replace(`{{${r}}}`,"")}return t}var RS=$(()=>{"use strict"});function o9({template:n,bits:e}){let t=oB(n,e);if(kl[t])return kl[t];let{vertex:r,fragment:i}=ZY(n,e);return kl[t]=aB(r,i,e),kl[t]}function a9({template:n,bits:e}){let t=oB(n,e);return kl[t]||(kl[t]=aB(n.vertex,n.fragment,e)),kl[t]}function ZY(n,e){let t=e.map(o=>o.vertex).filter(o=>!!o),r=e.map(o=>o.fragment).filter(o=>!!o),i=l4(t,n.vertex,!0);i=s9(t,i);let s=l4(r,n.fragment,!0);return{vertex:i,fragment:s}}function oB(n,e){return e.map(t=>(FS.has(t)||FS.set(t,QY++),FS.get(t))).sort((t,r)=>t-r).join("-")+n.vertex+n.fragment}function aB(n,e,t){let r=a4(n),i=a4(e);return t.forEach(s=>{o4(s.vertex,r,s.name),o4(s.fragment,i,s.name)}),{vertex:c4(n,r),fragment:c4(e,i)}}var kl,FS,QY,BS=$(()=>{kS();PS();DS();MS();RS();kl=Object.create(null),FS=new Map,QY=0});var l9,c9,u9,d9,NS=$(()=>{"use strict";l9=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}
        
        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);
       
        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,c9=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;
   
    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {
        
        {{start}}

        var outColor:vec4<f32>;
      
        {{main}}
        
        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,u9=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;
        
        {{start}}
        
        vColor = vec4(1.);
        
        {{main}}
        
        vUV = uv;
        
        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,d9=`
   
    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {
        
        {{start}}

        vec4 outColor;
      
        {{main}}
        
        finalColor = outColor * vColor;
        
        {{end}}
    }
`});var f9,lB,h9,OS=$(()=>{"use strict";f9={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},lB={name:"global-uniforms-ubo-bit",vertex:{header:`
          uniform globalUniforms {
            mat3 uProjectionMatrix;
            mat3 uWorldTransformMatrix;
            vec4 uWorldColorAlpha;
            vec2 uResolution;
          };
        `}},h9={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}}});function ms({bits:n,name:e}){let t=o9({template:{fragment:c9,vertex:l9},bits:[f9,...n]});return pe.from({name:e,vertex:{source:t.vertex,entryPoint:"main"},fragment:{source:t.fragment,entryPoint:"main"}})}function gs({bits:n,name:e}){return new he({name:e,...a9({template:{vertex:u9,fragment:d9},bits:[h9,...n]})})}var Aa=$(()=>{Ci();qi();BS();NS();OS()});var Il,Pl,n0=$(()=>{"use strict";Il={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Pl={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}}});function JY(n){let e=[];if(n===1)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let t=0;for(let r=0;r<n;r++)e.push(`@group(1) @binding(${t++}) var textureSource${r+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${t++}) var textureSampler${r+1}: sampler;`)}return e.join(`
`)}function eK(n){let e=[];if(n===1)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let t=0;t<n;t++)t===n-1?e.push("  default:{"):e.push(`  case ${t}:{`),e.push(`      outColor = textureSampleGrad(textureSource${t+1}, textureSampler${t+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join(`
`)}function Dl(n){return LS[n]||(LS[n]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${JY(n)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${eK(n)}
            `}}),LS[n]}function tK(n){let e=[];for(let t=0;t<n;t++)t>0&&e.push("else"),t<n-1&&e.push(`if(vTextureId < ${t}.5)`),e.push("{"),e.push(`	outColor = texture(uTextures[${t}], vUV);`),e.push("}");return e.join(`
`)}function Ml(n){return US[n]||(US[n]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${n}];

            `,main:`

                ${tK(n)}
            `}}),US[n]}var LS,US,i0=$(()=>{"use strict";LS={};US={}});var ys,xs,Ea=$(()=>{"use strict";ys={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32> 
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},xs={name:"round-pixels-bit",vertex:{header:`   
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {       
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}}});var u4,p9,GS=$(()=>{"use strict";u4=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],p9=u4.reduce((n,e)=>(n[e]=!0,n),{})});function m9(n,e){switch(n){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var $S=$(()=>{"use strict"});var cB,pt,Hr=$(()=>{_n();t0();GS();$S();cB=class uB{constructor(e,t){this._touched=0,this.uid=gt("uniform"),this._resourceType="uniformGroup",this._resourceId=gt("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,t={...uB.defaultOptions,...t},this.uniformStructures=e;let r={};for(let i in e){let s=e[i];if(s.name=i,s.size=s.size??1,!p9[s.type])throw new Error(`Uniform type ${s.type} is not supported. Supported uniform types are: ${u4.join(", ")}`);s.value??(s.value=m9(s.type,s.size)),r[i]=s.value}this.uniforms=r,this._dirtyId=1,this.ubo=t.ubo,this.isStatic=t.isStatic,this._signature=Ys(Object.keys(r).map(i=>`${i}-${e[i].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};cB.defaultOptions={ubo:!1,isStatic:!1};pt=cB});function Rl(n){let e=dB[n];if(e)return e;let t=new Int32Array(n);for(let r=0;r<n;r++)t[r]=r;return e=dB[n]=new pt({uTextures:{value:t,type:"i32",size:n}},{isStatic:!0}),e}var dB,d4=$(()=>{Hr();dB={}});var Bt,Yi=$(()=>{"use strict";Bt=(n=>(n[n.WEBGL=1]="WEBGL",n[n.WEBGPU=2]="WEBGPU",n[n.BOTH=3]="BOTH",n))(Bt||{})});var xr,bs=$(()=>{Nn();Ci();Ca();qi();Yi();Hr();xr=class n extends st{constructor(e){super(),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:t,glProgram:r,groups:i,resources:s,compatibleRenderers:o,groupMap:a}=e;this.gpuProgram=t,this.glProgram=r,o===void 0&&(o=0,t&&(o|=Bt.WEBGPU),r&&(o|=Bt.WEBGL)),this.compatibleRenderers=o;let l={};if(!s&&!i&&(s={}),s&&i)throw new Error("[Shader] Cannot have both resources and groups");if(!t&&i&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!t&&i&&a)for(let c in a)for(let u in a[c]){let d=a[c][u];l[d]={group:c,binding:u,name:d}}else if(t&&i&&!a){let c=t.structsAndGroups.groups;a={},c.forEach(u=>{a[u.group]=a[u.group]||{},a[u.group][u.binding]=u.name,l[u.name]=u})}else if(s){i={},a={},t&&t.structsAndGroups.groups.forEach(d=>{a[d.group]=a[d.group]||{},a[d.group][d.binding]=d.name,l[d.name]=d});let c=0;for(let u in s)l[u]||(i[99]||(i[99]=new Jr,this._ownedBindGroups.push(i[99])),l[u]={group:99,binding:c,name:u},a[99]=a[99]||{},a[99][c]=u,c++);for(let u in s){let d=u,f=s[u];!f.source&&!f._resourceType&&(f=new pt(f));let h=l[d];h&&(i[h.group]||(i[h.group]=new Jr,this._ownedBindGroups.push(i[h.group])),i[h.group].setResource(f,h.binding))}}this.groups=i,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(i,l)}addResource(e,t,r){var i,s;(i=this._uniformBindMap)[t]||(i[t]={}),(s=this._uniformBindMap[t])[r]||(s[r]=e),this.groups[t]||(this.groups[t]=new Jr,this._ownedBindGroups.push(this.groups[t]))}_buildResourceAccessor(e,t){let r={};for(let i in t){let s=t[i];Object.defineProperty(r,s.name,{get(){return e[s.group].getResource(s.binding)},set(o){e[s.group].setResource(o,s.binding)}})}return r}destroy(e=!1){this.emit("destroy",this),e&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(t=>{t.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(e){let{gpu:t,gl:r,...i}=e,s,o;return t&&(s=pe.from(t)),r&&(o=he.from(r)),new n({gpuProgram:s,glProgram:o,...i})}}});var s0,zS=$(()=>{Aa();n0();i0();Ea();d4();bs();s0=class extends xr{constructor(e){let t=gs({name:"batch",bits:[Pl,Ml(e),xs]}),r=ms({name:"batch",bits:[Il,Dl(e),ys]});super({glProgram:t,gpuProgram:r,resources:{batchSamplers:Rl(e)}})}}});var fB,hB,tu,g9=$(()=>{ee();aS();uS();zS();fB=null,hB=class pB extends j7{constructor(){super(...arguments),this.geometry=new e0,this.shader=fB||(fB=new s0(this.maxTextures)),this.name=pB.extension.name,this.vertexSize=6}packAttributes(e,t,r,i,s){let o=s<<16|e.roundPixels&65535,a=e.transform,l=a.a,c=a.b,u=a.c,d=a.d,f=a.tx,h=a.ty,{positions:p,uvs:m}=e,g=e.color,y=e.attributeOffset,x=y+e.attributeSize;for(let b=y;b<x;b++){let _=b*2,S=p[_],C=p[_+1];t[i++]=l*S+u*C+f,t[i++]=d*C+c*S+h,t[i++]=m[_],t[i++]=m[_+1],r[i++]=g,r[i++]=o}}packQuadAttributes(e,t,r,i,s){let o=e.texture,a=e.transform,l=a.a,c=a.b,u=a.c,d=a.d,f=a.tx,h=a.ty,p=e.bounds,m=p.maxX,g=p.minX,y=p.maxY,x=p.minY,b=o.uvs,_=e.color,S=s<<16|e.roundPixels&65535;t[i+0]=l*g+u*x+f,t[i+1]=d*x+c*g+h,t[i+2]=b.x0,t[i+3]=b.y0,r[i+4]=_,r[i+5]=S,t[i+6]=l*m+u*x+f,t[i+7]=d*x+c*m+h,t[i+8]=b.x1,t[i+9]=b.y1,r[i+10]=_,r[i+11]=S,t[i+12]=l*m+u*y+f,t[i+13]=d*y+c*m+h,t[i+14]=b.x2,t[i+15]=b.y2,r[i+16]=_,r[i+17]=S,t[i+18]=l*g+u*y+f,t[i+19]=d*y+c*g+h,t[i+20]=b.x3,t[i+21]=b.y3,r[i+22]=_,r[i+23]=S}};hB.extension={type:[z.Batcher],name:"default"};tu=hB});function o0(n,e,t,r,i,s,o,a=null){let l=0;t*=e,i*=s;let c=a.a,u=a.b,d=a.c,f=a.d,h=a.tx,p=a.ty;for(;l<o;){let m=n[t],g=n[t+1];r[i]=c*m+d*g+h,r[i+1]=u*m+f*g+p,i+=s,t+=e,l++}}function a0(n,e,t,r){let i=0;for(e*=t;i<r;)n[e]=0,n[e+1]=0,e+=t,i++}var y9=$(()=>{"use strict"});function ru(n,e,t,r,i){let s=e.a,o=e.b,a=e.c,l=e.d,c=e.tx,u=e.ty;t||(t=0),r||(r=2),i||(i=n.length/r-t);let d=t*r;for(let f=0;f<i;f++){let h=n[d],p=n[d+1];n[d]=s*h+a*p+c,n[d+1]=o*h+l*p+u,d+=r}}var x9=$(()=>{"use strict"});var rK,Ta,b9=$(()=>{Ct();s7();rK=new ue,Ta=class{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){let e=this.baseColor,t=e>>16|e&65280|(e&255)<<16,r=this.renderable;return r?G2(t,r.groupColor)+(this.alpha*r.groupAlpha*255<<24):t+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||rK}copyTo(e){e.indexOffset=this.indexOffset,e.indexSize=this.indexSize,e.attributeOffset=this.attributeOffset,e.attributeSize=this.attributeSize,e.baseColor=this.baseColor,e.alpha=this.alpha,e.texture=this.texture,e.geometryData=this.geometryData,e.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}});var _s,_9,v9,w9=$(()=>{ee();_s={extension:{type:z.ShapeBuilder,name:"circle"},build(n,e){let t,r,i,s,o,a;if(n.type==="circle"){let _=n;t=_.x,r=_.y,o=a=_.radius,i=s=0}else if(n.type==="ellipse"){let _=n;t=_.x,r=_.y,o=_.halfWidth,a=_.halfHeight,i=s=0}else{let _=n,S=_.width/2,C=_.height/2;t=_.x+S,r=_.y+C,o=a=Math.max(0,Math.min(_.radius,Math.min(S,C))),i=S-o,s=C-a}if(!(o>=0&&a>=0&&i>=0&&s>=0))return e;let l=Math.ceil(2.3*Math.sqrt(o+a)),c=l*8+(i?4:0)+(s?4:0);if(c===0)return e;if(l===0)return e[0]=e[6]=t+i,e[1]=e[3]=r+s,e[2]=e[4]=t-i,e[5]=e[7]=r-s,e;let u=0,d=l*4+(i?2:0)+2,f=d,h=c,p=i+o,m=s,g=t+p,y=t-p,x=r+m;if(e[u++]=g,e[u++]=x,e[--d]=x,e[--d]=y,s){let _=r-m;e[f++]=y,e[f++]=_,e[--h]=_,e[--h]=g}for(let _=1;_<l;_++){let S=Math.PI/2*(_/l),C=i+Math.cos(S)*o,k=s+Math.sin(S)*a,v=t+C,w=t-C,A=r+k,E=r-k;e[u++]=v,e[u++]=A,e[--d]=A,e[--d]=w,e[f++]=w,e[f++]=E,e[--h]=E,e[--h]=v}p=i,m=s+a,g=t+p,y=t-p,x=r+m;let b=r-m;return e[u++]=g,e[u++]=x,e[--h]=b,e[--h]=g,i&&(e[u++]=y,e[u++]=x,e[--h]=b,e[--h]=y),e},triangulate(n,e,t,r,i,s){if(n.length===0)return;let o=0,a=0;for(let u=0;u<n.length;u+=2)o+=n[u],a+=n[u+1];o/=n.length/2,a/=n.length/2;let l=r;e[l*t]=o,e[l*t+1]=a;let c=l++;for(let u=0;u<n.length;u+=2)e[l*t]=n[u],e[l*t+1]=n[u+1],u>0&&(i[s++]=l,i[s++]=c,i[s++]=l-1),l++;i[s++]=c+1,i[s++]=c,i[s++]=l-1}},_9={..._s,extension:{..._s.extension,name:"ellipse"}},v9={..._s,extension:{..._s.extension,name:"roundedRectangle"}}});var S9,C9,mB=$(()=>{"use strict";S9=1e-4,C9=1e-4});function A9(n){let e=n.length;if(e<6)return 1;let t=0;for(let r=0,i=n[e-2],s=n[e-1];r<e;r+=2){let o=n[r],a=n[r+1];t+=(o-i)*(a+s),i=o,s=a}return t<0?-1:1}var HS=$(()=>{"use strict"});function gB(n,e,t,r,i,s,o,a){let l=n-t*i,c=e-r*i,u=n+t*s,d=e+r*s,f,h;o?(f=r,h=-t):(f=-r,h=t);let p=l+f,m=c+h,g=u+f,y=d+h;return a.push(p,m),a.push(g,y),2}function nu(n,e,t,r,i,s,o,a){let l=t-n,c=r-e,u=Math.atan2(l,c),d=Math.atan2(i-n,s-e);a&&u<d?u+=Math.PI*2:!a&&u>d&&(d+=Math.PI*2);let f=u,h=d-u,p=Math.abs(h),m=Math.sqrt(l*l+c*c),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,y=h/g;if(f+=y,a){o.push(n,e),o.push(t,r);for(let x=1,b=f;x<g;x++,b+=y)o.push(n,e),o.push(n+Math.sin(b)*m,e+Math.cos(b)*m);o.push(n,e),o.push(i,s)}else{o.push(t,r),o.push(n,e);for(let x=1,b=f;x<g;x++,b+=y)o.push(n+Math.sin(b)*m,e+Math.cos(b)*m),o.push(n,e);o.push(i,s),o.push(n,e)}return g*2}function l0(n,e,t,r,i,s){let o=1e-4;if(n.length===0)return;let a=e,l=a.alignment;if(e.alignment!==.5){let F=A9(n);t&&(F*=-1),l=(l-.5)*F+.5}let c=new Ve(n[0],n[1]),u=new Ve(n[n.length-2],n[n.length-1]),d=r,f=Math.abs(c.x-u.x)<o&&Math.abs(c.y-u.y)<o;if(d){n=n.slice(),f&&(n.pop(),n.pop(),u.set(n[n.length-2],n[n.length-1]));let F=(c.x+u.x)*.5,B=(u.y+c.y)*.5;n.unshift(F,B),n.push(F,B)}let h=i,p=n.length/2,m=n.length,g=h.length/2,y=a.width/2,x=y*y,b=a.miterLimit*a.miterLimit,_=n[0],S=n[1],C=n[2],k=n[3],v=0,w=0,A=-(S-k),E=_-C,I=0,M=0,T=Math.sqrt(A*A+E*E);A/=T,E/=T,A*=y,E*=y;let R=l,P=(1-R)*2,D=R*2;d||(a.cap==="round"?m+=nu(_-A*(P-D)*.5,S-E*(P-D)*.5,_-A*P,S-E*P,_+A*D,S+E*D,h,!0)+2:a.cap==="square"&&(m+=gB(_,S,A,E,P,D,!0,h))),h.push(_-A*P,S-E*P),h.push(_+A*D,S+E*D);for(let F=1;F<p-1;++F){_=n[(F-1)*2],S=n[(F-1)*2+1],C=n[F*2],k=n[F*2+1],v=n[(F+1)*2],w=n[(F+1)*2+1],A=-(S-k),E=_-C,T=Math.sqrt(A*A+E*E),A/=T,E/=T,A*=y,E*=y,I=-(k-w),M=C-v,T=Math.sqrt(I*I+M*M),I/=T,M/=T,I*=y,M*=y;let B=C-_,O=S-k,G=C-v,U=w-k,W=B*G+O*U,V=O*G-U*B,j=V<0;if(Math.abs(V)<.001*Math.abs(W)){h.push(C-A*P,k-E*P),h.push(C+A*D,k+E*D),W>=0&&(a.join==="round"?m+=nu(C,k,C-A*P,k-E*P,C-I*P,k-M*P,h,!1)+4:m+=2,h.push(C-I*D,k-M*D),h.push(C+I*P,k+M*P));continue}let Z=(-A+_)*(-E+k)-(-A+C)*(-E+S),Y=(-I+v)*(-M+k)-(-I+C)*(-M+w),K=(B*Y-G*Z)/V,ne=(U*Z-O*Y)/V,ie=(K-C)*(K-C)+(ne-k)*(ne-k),q=C+(K-C)*P,se=k+(ne-k)*P,te=C-(K-C)*D,Q=k-(ne-k)*D,_e=Math.min(B*B+O*O,G*G+U*U),je=j?P:D,Dt=_e+je*je*x;ie<=Dt?a.join==="bevel"||ie/x>b?(j?(h.push(q,se),h.push(C+A*D,k+E*D),h.push(q,se),h.push(C+I*D,k+M*D)):(h.push(C-A*P,k-E*P),h.push(te,Q),h.push(C-I*P,k-M*P),h.push(te,Q)),m+=2):a.join==="round"?j?(h.push(q,se),h.push(C+A*D,k+E*D),m+=nu(C,k,C+A*D,k+E*D,C+I*D,k+M*D,h,!0)+4,h.push(q,se),h.push(C+I*D,k+M*D)):(h.push(C-A*P,k-E*P),h.push(te,Q),m+=nu(C,k,C-A*P,k-E*P,C-I*P,k-M*P,h,!1)+4,h.push(C-I*P,k-M*P),h.push(te,Q)):(h.push(q,se),h.push(te,Q)):(h.push(C-A*P,k-E*P),h.push(C+A*D,k+E*D),a.join==="round"?j?m+=nu(C,k,C+A*D,k+E*D,C+I*D,k+M*D,h,!0)+2:m+=nu(C,k,C-A*P,k-E*P,C-I*P,k-M*P,h,!1)+2:a.join==="miter"&&ie/x<=b&&(j?(h.push(te,Q),h.push(te,Q)):(h.push(q,se),h.push(q,se)),m+=2),h.push(C-I*P,k-M*P),h.push(C+I*D,k+M*D),m+=2)}_=n[(p-2)*2],S=n[(p-2)*2+1],C=n[(p-1)*2],k=n[(p-1)*2+1],A=-(S-k),E=_-C,T=Math.sqrt(A*A+E*E),A/=T,E/=T,A*=y,E*=y,h.push(C-A*P,k-E*P),h.push(C+A*D,k+E*D),d||(a.cap==="round"?m+=nu(C-A*(P-D)*.5,k-E*(P-D)*.5,C-A*P,k-E*P,C+A*D,k+E*D,h,!1)+2:a.cap==="square"&&(m+=gB(C,k,A,E,P,D,!1,h)));let N=1e-4*1e-4;for(let F=g;F<m+g-2;++F)_=h[F*2],S=h[F*2+1],C=h[(F+1)*2],k=h[(F+1)*2+1],v=h[(F+2)*2],w=h[(F+2)*2+1],!(Math.abs(_*(k-w)+C*(w-S)+v*(S-k))<N)&&s.push(F,F+1,F+2)}var WS=$(()=>{vi();HS()});function E9(n,e,t,r){let i=1e-4;if(n.length===0)return;let s=n[0],o=n[1],a=n[n.length-2],l=n[n.length-1],c=e||Math.abs(s-a)<i&&Math.abs(o-l)<i,u=t,d=n.length/2,f=u.length/2;for(let h=0;h<d;h++)u.push(n[h*2]),u.push(n[h*2+1]);for(let h=0;h<d-1;h++)r.push(f+h,f+h+1);c&&r.push(f+d-1,f)}var VS=$(()=>{});var KS=ut((k8e,YS)=>{"use strict";YS.exports=I9;YS.exports.default=I9;function I9(n,e,t){t=t||2;var r=e&&e.length,i=r?e[0]*t:n.length,s=xB(n,0,i,t,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,d,f,h;if(r&&(s=aK(n,e,s,t)),n.length>80*t){a=c=n[0],l=u=n[1];for(var p=t;p<i;p+=t)d=n[p],f=n[p+1],d<a&&(a=d),f<l&&(l=f),d>c&&(c=d),f>u&&(u=f);h=Math.max(c-a,u-l),h=h!==0?32767/h:0}return f4(s,o,t,a,l,h,0),o}function xB(n,e,t,r,i){var s,o;if(i===qS(n,e,t,r)>0)for(s=e;s<t;s+=r)o=yB(s,n[s],n[s+1],o);else for(s=t-r;s>=e;s-=r)o=yB(s,n[s],n[s+1],o);return o&&P9(o,o.next)&&(p4(o),o=o.next),o}function iu(n,e){if(!n)return n;e||(e=n);var t=n,r;do if(r=!1,!t.steiner&&(P9(t,t.next)||Er(t.prev,t,t.next)===0)){if(p4(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function f4(n,e,t,r,i,s,o){if(n){!o&&s&&fK(n,r,i,s);for(var a=n,l,c;n.prev!==n.next;){if(l=n.prev,c=n.next,s?iK(n,r,i,s):nK(n)){e.push(l.i/t|0),e.push(n.i/t|0),e.push(c.i/t|0),p4(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=sK(iu(n),e,t),f4(n,e,t,r,i,s,2)):o===2&&oK(n,e,t,r,i,s):f4(iu(n),e,t,r,i,s,1);break}}}}function nK(n){var e=n.prev,t=n,r=n.next;if(Er(e,t,r)>=0)return!1;for(var i=e.x,s=t.x,o=r.x,a=e.y,l=t.y,c=r.y,u=i<s?i<o?i:o:s<o?s:o,d=a<l?a<c?a:c:l<c?l:c,f=i>s?i>o?i:o:s>o?s:o,h=a>l?a>c?a:c:l>c?l:c,p=r.next;p!==e;){if(p.x>=u&&p.x<=f&&p.y>=d&&p.y<=h&&c0(i,a,s,l,o,c,p.x,p.y)&&Er(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function iK(n,e,t,r){var i=n.prev,s=n,o=n.next;if(Er(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,c=o.x,u=i.y,d=s.y,f=o.y,h=a<l?a<c?a:c:l<c?l:c,p=u<d?u<f?u:f:d<f?d:f,m=a>l?a>c?a:c:l>c?l:c,g=u>d?u>f?u:f:d>f?d:f,y=jS(h,p,e,t,r),x=jS(m,g,e,t,r),b=n.prevZ,_=n.nextZ;b&&b.z>=y&&_&&_.z<=x;){if(b.x>=h&&b.x<=m&&b.y>=p&&b.y<=g&&b!==i&&b!==o&&c0(a,u,l,d,c,f,b.x,b.y)&&Er(b.prev,b,b.next)>=0||(b=b.prevZ,_.x>=h&&_.x<=m&&_.y>=p&&_.y<=g&&_!==i&&_!==o&&c0(a,u,l,d,c,f,_.x,_.y)&&Er(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;b&&b.z>=y;){if(b.x>=h&&b.x<=m&&b.y>=p&&b.y<=g&&b!==i&&b!==o&&c0(a,u,l,d,c,f,b.x,b.y)&&Er(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=x;){if(_.x>=h&&_.x<=m&&_.y>=p&&_.y<=g&&_!==i&&_!==o&&c0(a,u,l,d,c,f,_.x,_.y)&&Er(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function sK(n,e,t){var r=n;do{var i=r.prev,s=r.next.next;!P9(i,s)&&bB(i,r,r.next,s)&&h4(i,s)&&h4(s,i)&&(e.push(i.i/t|0),e.push(r.i/t|0),e.push(s.i/t|0),p4(r),p4(r.next),r=n=s),r=r.next}while(r!==n);return iu(r)}function oK(n,e,t,r,i,s){var o=n;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&mK(o,a)){var l=_B(o,a);o=iu(o,o.next),l=iu(l,l.next),f4(o,e,t,r,i,s,0),f4(l,e,t,r,i,s,0);return}a=a.next}o=o.next}while(o!==n)}function aK(n,e,t,r){var i=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:n.length,c=xB(n,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(pK(c));for(i.sort(lK),s=0;s<i.length;s++)t=cK(i[s],t);return t}function lK(n,e){return n.x-e.x}function cK(n,e){var t=uK(n,e);if(!t)return e;var r=_B(t,n);return iu(r,r.next),iu(t,t.next)}function uK(n,e){var t=e,r=n.x,i=n.y,s=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var a=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=r&&a>s&&(s=a,o=t.x<t.next.x?t:t.next,a===r))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,c=o.x,u=o.y,d=1/0,f;t=o;do r>=t.x&&t.x>=c&&r!==t.x&&c0(i<u?r:s,i,c,u,i<u?s:r,i,t.x,t.y)&&(f=Math.abs(i-t.y)/(r-t.x),h4(t,n)&&(f<d||f===d&&(t.x>o.x||t.x===o.x&&dK(o,t)))&&(o=t,d=f)),t=t.next;while(t!==l);return o}function dK(n,e){return Er(n.prev,n,e.prev)<0&&Er(e.next,n,n.next)<0}function fK(n,e,t,r){var i=n;do i.z===0&&(i.z=jS(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,hK(i)}function hK(n){var e,t,r,i,s,o,a,l,c=1;do{for(t=n,n=null,s=null,o=0;t;){for(o++,r=t,a=0,e=0;e<c&&(a++,r=r.nextZ,!!r);e++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||t.z<=r.z)?(i=t,t=t.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;t=r}s.nextZ=null,c*=2}while(o>1);return n}function jS(n,e,t,r,i){return n=(n-t)*i|0,e=(e-r)*i|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function pK(n){var e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function c0(n,e,t,r,i,s,o,a){return(i-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(r-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(i-o)*(r-a)}function mK(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!gK(n,e)&&(h4(n,e)&&h4(e,n)&&yK(n,e)&&(Er(n.prev,n,e.prev)||Er(n,e.prev,e))||P9(n,e)&&Er(n.prev,n,n.next)>0&&Er(e.prev,e,e.next)>0)}function Er(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function P9(n,e){return n.x===e.x&&n.y===e.y}function bB(n,e,t,r){var i=k9(Er(n,e,t)),s=k9(Er(n,e,r)),o=k9(Er(t,r,n)),a=k9(Er(t,r,e));return!!(i!==s&&o!==a||i===0&&T9(n,t,e)||s===0&&T9(n,r,e)||o===0&&T9(t,n,r)||a===0&&T9(t,e,r))}function T9(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function k9(n){return n>0?1:n<0?-1:0}function gK(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&bB(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function h4(n,e){return Er(n.prev,n,n.next)<0?Er(n,e,n.next)>=0&&Er(n,n.prev,e)>=0:Er(n,e,n.prev)<0||Er(n,n.next,e)<0}function yK(n,e){var t=n,r=!1,i=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function _B(n,e){var t=new XS(n.i,n.x,n.y),r=new XS(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function yB(n,e,t,r){var i=new XS(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function p4(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function XS(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}I9.deviation=function(n,e,t,r){var i=e&&e.length,s=i?e[0]*t:n.length,o=Math.abs(qS(n,0,s,t));if(i)for(var a=0,l=e.length;a<l;a++){var c=e[a]*t,u=a<l-1?e[a+1]*t:n.length;o-=Math.abs(qS(n,c,u,t))}var d=0;for(a=0;a<r.length;a+=3){var f=r[a]*t,h=r[a+1]*t,p=r[a+2]*t;d+=Math.abs((n[f]-n[p])*(n[h+1]-n[f+1])-(n[f]-n[h])*(n[p+1]-n[f+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)};function qS(n,e,t,r){for(var i=0,s=e,o=t-r;s<t;s+=r)i+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return i}I9.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},r=0,i=0;i<n.length;i++){for(var s=0;s<n[i].length;s++)for(var o=0;o<e;o++)t.vertices.push(n[i][s][o]);i>0&&(r+=n[i-1].length,t.holes.push(r))}return t}});function u0(n,e,t,r,i,s,o){let a=(0,vB.default)(n,e,2);if(!a)return;for(let c=0;c<a.length;c+=3)s[o++]=a[c]+i,s[o++]=a[c+1]+i,s[o++]=a[c+2]+i;let l=i*r;for(let c=0;c<n.length;c+=2)t[l]=n[c],t[l+1]=n[c+1],l+=r}var vB,D9=$(()=>{vB=Ot(KS(),1)});var xK,d0,M9=$(()=>{ee();D9();xK=[],d0={extension:{type:z.ShapeBuilder,name:"polygon"},build(n,e){for(let t=0;t<n.points.length;t++)e[t]=n.points[t];return e},triangulate(n,e,t,r,i,s){u0(n,xK,e,t,r,i,s)}}});var f0,R9=$(()=>{ee();f0={extension:{type:z.ShapeBuilder,name:"rectangle"},build(n,e){let t=n,r=t.x,i=t.y,s=t.width,o=t.height;return s>=0&&o>=0&&(e[0]=r,e[1]=i,e[2]=r+s,e[3]=i,e[4]=r+s,e[5]=i+o,e[6]=r,e[7]=i+o),e},triangulate(n,e,t,r,i,s){let o=0;r*=t,e[r+o]=n[0],e[r+o+1]=n[1],o+=t,e[r+o]=n[2],e[r+o+1]=n[3],o+=t,e[r+o]=n[6],e[r+o+1]=n[7],o+=t,e[r+o]=n[4],e[r+o+1]=n[5],o+=t;let a=r/t;i[s++]=a,i[s++]=a+1,i[s++]=a+2,i[s++]=a+1,i[s++]=a+3,i[s++]=a+2}}});var h0,F9=$(()=>{ee();h0={extension:{type:z.ShapeBuilder,name:"triangle"},build(n,e){return e[0]=n.x,e[1]=n.y,e[2]=n.x2,e[3]=n.y2,e[4]=n.x3,e[5]=n.y3,e},triangulate(n,e,t,r,i,s){let o=0;r*=t,e[r+o]=n[0],e[r+o+1]=n[1],o+=t,e[r+o]=n[2],e[r+o+1]=n[3],o+=t,e[r+o]=n[4],e[r+o+1]=n[5];let a=r/t;i[s++]=a,i[s++]=a+1,i[s++]=a+2}}});function m0(n,e){let{geometryData:t,batches:r}=e;r.length=0,t.indices.length=0,t.vertices.length=0,t.uvs.length=0;for(let i=0;i<n.instructions.length;i++){let s=n.instructions[i];if(s.action==="texture")_K(s.data,r,t);else if(s.action==="fill"||s.action==="stroke"){let o=s.action==="stroke",a=s.data.path.shapePath,l=s.data.style,c=s.data.hole;o&&c&&wB(c.shapePath,l,null,!0,r,t),wB(a,l,c,o,r,t)}}}function _K(n,e,t){let{vertices:r,uvs:i,indices:s}=t,o=s.length,a=r.length/2,l=[],c=p0.rectangle,u=bK,d=n.image;u.x=n.dx,u.y=n.dy,u.width=n.dw,u.height=n.dh;let f=n.transform;c.build(u,l),f&&ru(l,f),c.triangulate(l,r,2,a,s,o);let h=d.uvs;i.push(h.x0,h.y0,h.x1,h.y1,h.x3,h.y3,h.x2,h.y2);let p=Ze.get(Ta);p.indexOffset=o,p.indexSize=s.length-o,p.attributeOffset=a,p.attributeSize=r.length/2-a,p.baseColor=n.style,p.alpha=n.alpha,p.texture=d,p.geometryData=t,e.push(p)}function wB(n,e,t,r,i,s){let{vertices:o,uvs:a,indices:l}=s,c=n.shapePrimitives.length-1;n.shapePrimitives.forEach(({shape:u,transform:d},f)=>{let h=l.length,p=o.length/2,m=[],g=p0[u.type],y="triangle-list";if(g.build(u,m),d&&ru(m,d),r){let S=u.closePath??!0,C=e;C.pixelLine?(E9(m,S,o,l),y="line-list"):l0(m,C,!1,S,o,l)}else if(t&&c===f){c!==0&&console.warn("[Pixi Graphics] only the last shape have be cut out");let S=[],C=m.slice();vK(t.shapePath).forEach(v=>{S.push(C.length/2),C.push(...v)}),u0(C,S,o,2,p,l,h)}else g.triangulate(m,o,2,p,l,h);let x=a.length/2,b=e.texture;if(b!==re.WHITE){let S=e.matrix;S&&(d&&S.append(d.clone().invert()),o0(o,2,p,a,x,2,o.length/2-p,S))}else a0(a,x,2,o.length/2-p);let _=Ze.get(Ta);_.indexOffset=h,_.indexSize=l.length-h,_.attributeOffset=p,_.attributeSize=o.length/2-p,_.baseColor=e.color,_.alpha=e.alpha,_.texture=b,_.geometryData=s,_.topology=y,i.push(_)})}function vK(n){if(!n)return[];let e=n.shapePrimitives,t=[];for(let r=0;r<e.length;r++){let i=e[r].shape,s=[];p0[i.type].build(i,s),t.push(s)}return t}var p0,bK,QS=$(()=>{ee();Qr();y9();x9();_t();On();b9();w9();WS();VS();M9();R9();F9();D9();p0={};ke.handleByMap(z.ShapeBuilder,p0);ke.add(f0,d0,h0,_s,_9,v9);bK=new $e});var su,m4,JS,Fl,g4=$(()=>{ee();r4();g9();h7();zt();On();QS();su=class{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}},m4=class{constructor(){this.batcher=new tu,this.instructions=new dl}init(){this.instructions.reset()}get geometry(){return oe(Km,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}},JS=class ZS{constructor(e){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),e.renderableGC.addManagedHash(this,"_gpuContextHash"),e.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){ZS.defaultOptions.bezierSmoothness=e?.bezierSmoothness??ZS.defaultOptions.bezierSmoothness}getContextRenderData(e){return this._graphicsDataContextHash[e.uid]||this._initContextRenderData(e)}updateGpuContext(e){let t=this._gpuContextHash[e.uid]||this._initContext(e);if(e.dirty){t?this._cleanGraphicsContextData(e):t=this._initContext(e),m0(e,t);let r=e.batchMode;e.customShader||r==="no-batch"?t.isBatchable=!1:r==="auto"&&(t.isBatchable=t.geometryData.vertices.length<400),e.dirty=!1}return t}getGpuContext(e){return this._gpuContextHash[e.uid]||this._initContext(e)}_initContextRenderData(e){let t=Ze.get(m4),{batches:r,geometryData:i}=this._gpuContextHash[e.uid],s=i.vertices.length,o=i.indices.length;for(let u=0;u<r.length;u++)r[u].applyTransform=!1;let a=t.batcher;a.ensureAttributeBuffer(s),a.ensureIndexBuffer(o),a.begin();for(let u=0;u<r.length;u++){let d=r[u];a.add(d)}a.finish(t.instructions);let l=a.geometry;l.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),l.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);let c=a.batches;for(let u=0;u<c.length;u++){let d=c[u];d.bindGroup=Sl(d.textures.textures,d.textures.count)}return this._graphicsDataContextHash[e.uid]=t,t}_initContext(e){let t=new su;return t.context=e,this._gpuContextHash[e.uid]=t,e.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]}onGraphicsContextDestroy(e){this._cleanGraphicsContextData(e),e.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]=null}_cleanGraphicsContextData(e){let t=this._gpuContextHash[e.uid];t.isBatchable||this._graphicsDataContextHash[e.uid]&&(Ze.return(this.getContextRenderData(e)),this._graphicsDataContextHash[e.uid]=null),t.batches&&t.batches.forEach(r=>{Ze.return(r)})}destroy(){for(let e in this._gpuContextHash)this._gpuContextHash[e]&&this.onGraphicsContextDestroy(this._gpuContextHash[e].context)}};JS.extension={type:[z.WebGLSystem,z.WebGPUSystem,z.CanvasSystem],name:"graphicsContext"};JS.defaultOptions={bezierSmoothness:.5};Fl=JS});var wK,eC,tC,rC,nC,iC,sC,oC,ur,Ki=$(()=>{"use strict";wK={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},eC=0,tC=1,rC=2,nC=3,iC=4,sC=5,oC=class SB{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<eC)}set blend(e){!!(this.data&1<<eC)!==e&&(this.data^=1<<eC)}get offsets(){return!!(this.data&1<<tC)}set offsets(e){!!(this.data&1<<tC)!==e&&(this.data^=1<<tC)}set cullMode(e){if(e==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=e==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<rC)}set culling(e){!!(this.data&1<<rC)!==e&&(this.data^=1<<rC)}get depthTest(){return!!(this.data&1<<nC)}set depthTest(e){!!(this.data&1<<nC)!==e&&(this.data^=1<<nC)}get depthMask(){return!!(this.data&1<<sC)}set depthMask(e){!!(this.data&1<<sC)!==e&&(this.data^=1<<sC)}get clockwiseFrontFace(){return!!(this.data&1<<iC)}set clockwiseFrontFace(e){!!(this.data&1<<iC)!==e&&(this.data^=1<<iC)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!=="none",this._blendMode=e,this._blendModeId=wK[e]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){let e=new SB;return e.depthTest=!1,e.blend=!0,e}};oC.default2d=oC.for2d();ur=oC});function CB(n,e,t,r){t[r++]=(n>>16&255)/255,t[r++]=(n>>8&255)/255,t[r++]=(n&255)/255,t[r++]=e}function vs(n,e,t){let r=(n>>24&255)/255;e[t++]=(n&255)/255*r,e[t++]=(n>>8&255)/255*r,e[t++]=(n>>16&255)/255*r,e[t++]=r}var ou=$(()=>{"use strict"});var au,aC=$(()=>{ee();Ki();On();ou();b9();au=class{constructor(e,t){this.state=ur.for2d(),this._graphicsBatchesHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.renderer=e,this._adaptor=t,this._adaptor.init(),this.renderer.renderableGC.addManagedHash(this,"_graphicsBatchesHash")}validateRenderable(e){let t=e.context,r=!!this._graphicsBatchesHash[e.uid],i=this.renderer.graphicsContext.updateGpuContext(t);return!!(i.isBatchable||r!==i.isBatchable)}addRenderable(e,t){let r=this.renderer.graphicsContext.updateGpuContext(e.context);e.didViewUpdate&&this._rebuild(e),r.isBatchable?this._addToBatcher(e,t):(this.renderer.renderPipes.batch.break(t),t.add(e))}updateRenderable(e){let t=this._graphicsBatchesHash[e.uid];if(t)for(let r=0;r<t.length;r++){let i=t[r];i._batcher.updateElement(i)}}destroyRenderable(e){this._graphicsBatchesHash[e.uid]&&this._removeBatchForRenderable(e.uid),e.off("destroyed",this._destroyRenderableBound)}execute(e){if(!e.isRenderable)return;let t=this.renderer,r=e.context;if(!t.graphicsContext.getGpuContext(r).batches.length)return;let s=r.customShader||this._adaptor.shader;this.state.blendMode=e.groupBlendMode;let o=s.resources.localUniforms.uniforms;o.uTransformMatrix=e.groupTransform,o.uRound=t._roundPixels|e._roundPixels,vs(e.groupColorAlpha,o.uColor,0),this._adaptor.execute(this,e)}_rebuild(e){let t=!!this._graphicsBatchesHash[e.uid],r=this.renderer.graphicsContext.updateGpuContext(e.context);t&&this._removeBatchForRenderable(e.uid),r.isBatchable&&this._initBatchesForRenderable(e),e.batched=r.isBatchable}_addToBatcher(e,t){let r=this.renderer.renderPipes.batch,i=this._getBatchesForRenderable(e);for(let s=0;s<i.length;s++){let o=i[s];r.addToBatch(o,t)}}_getBatchesForRenderable(e){return this._graphicsBatchesHash[e.uid]||this._initBatchesForRenderable(e)}_initBatchesForRenderable(e){let t=e.context,r=this.renderer.graphicsContext.getGpuContext(t),i=this.renderer._roundPixels|e._roundPixels,s=r.batches.map(o=>{let a=Ze.get(Ta);return o.copyTo(a),a.renderable=e,a.roundPixels=i,a});return this._graphicsBatchesHash[e.uid]===void 0&&e.on("destroyed",this._destroyRenderableBound),this._graphicsBatchesHash[e.uid]=s,s}_removeBatchForRenderable(e){this._graphicsBatchesHash[e].forEach(t=>{Ze.return(t)}),this._graphicsBatchesHash[e]=null}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null;for(let e in this._graphicsBatchesHash)this._removeBatchForRenderable(e);this._graphicsBatchesHash=null}};au.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"graphics"}});var lC=$(()=>{ee();g4();aC();ke.add(au);ke.add(Fl)});var Do,y4=$(()=>{"use strict";Do=class{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(e){this._topology=e}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}get uvs(){let t=this.geometry.getBuffer("aUV"),r=t.data,i=r,s=this.texture.textureMatrix;return s.isSimple||(i=this._transformedUvs,(this._textureMatrixUpdateId!==s._updateID||this._uvUpdateId!==t._updateID)&&((!i||i.length<r.length)&&(i=this._transformedUvs=new Float32Array(r.length)),this._textureMatrixUpdateId=s._updateID,this._uvUpdateId=t._updateID,s.multiplyUvs(r,i))),i}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}});var lu,cC=$(()=>{ee();Ct();Ca();Hr();Z2();On();ou();y4();lu=class{constructor(e,t){this.localUniforms=new pt({uTransformMatrix:{value:new ue,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new Jr({0:this.localUniforms}),this._meshDataHash=Object.create(null),this._gpuBatchableMeshHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.renderer=e,this._adaptor=t,this._adaptor.init(),e.renderableGC.addManagedHash(this,"_gpuBatchableMeshHash"),e.renderableGC.addManagedHash(this,"_meshDataHash")}validateRenderable(e){let t=this._getMeshData(e),r=t.batched,i=e.batched;if(t.batched=i,r!==i)return!0;if(i){let s=e._geometry;if(s.indices.length!==t.indexSize||s.positions.length!==t.vertexSize)return t.indexSize=s.indices.length,t.vertexSize=s.positions.length,!0;let o=this._getBatchableMesh(e);return!o._batcher.checkAndUpdateTexture(o,e.texture)}return!1}addRenderable(e,t){let r=this.renderer.renderPipes.batch,{batched:i}=this._getMeshData(e);if(i){let s=this._getBatchableMesh(e);s.texture=e._texture,s.geometry=e._geometry,r.addToBatch(s,t)}else r.break(t),t.add(e)}updateRenderable(e){if(e.batched){let t=this._gpuBatchableMeshHash[e.uid];t.texture=e._texture,t.geometry=e._geometry,t._batcher.updateElement(t)}}destroyRenderable(e){this._meshDataHash[e.uid]=null;let t=this._gpuBatchableMeshHash[e.uid];t&&(Ze.return(t),this._gpuBatchableMeshHash[e.uid]=null),e.off("destroyed",this._destroyRenderableBound)}execute(e){if(!e.isRenderable)return;e.state.blendMode=Xs(e.groupBlendMode,e.texture._source);let t=this.localUniforms;t.uniforms.uTransformMatrix=e.groupTransform,t.uniforms.uRound=this.renderer._roundPixels|e._roundPixels,t.update(),vs(e.groupColorAlpha,t.uniforms.uColor,0),this._adaptor.execute(this,e)}_getMeshData(e){return this._meshDataHash[e.uid]||this._initMeshData(e)}_initMeshData(e){return this._meshDataHash[e.uid]={batched:e.batched,indexSize:e._geometry.indices?.length,vertexSize:e._geometry.positions?.length},e.on("destroyed",this._destroyRenderableBound),this._meshDataHash[e.uid]}_getBatchableMesh(e){return this._gpuBatchableMeshHash[e.uid]||this._initBatchableMesh(e)}_initBatchableMesh(e){let t=Ze.get(Do);return t.renderable=e,t.texture=e._texture,t.transform=e.groupTransform,t.roundPixels=this.renderer._roundPixels|e._roundPixels,this._gpuBatchableMeshHash[e.uid]=t,t}destroy(){for(let e in this._gpuBatchableMeshHash)this._gpuBatchableMeshHash[e]&&Ze.return(this._gpuBatchableMeshHash[e]);this._gpuBatchableMeshHash=null,this._meshDataHash=null,this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}};lu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"mesh"}});var uC=$(()=>{ee();cC();ke.add(lu)});var g0,dC=$(()=>{"use strict";g0=class{execute(e,t){let r=e.state,i=e.renderer,s=t.shader||e.defaultShader;s.resources.uTexture=t.texture._source,s.resources.uniforms=e.localUniforms;let o=i.gl,a=e.getBuffers(t);i.shader.bind(s),i.state.set(r),i.geometry.bind(a.geometry,s.glProgram);let c=a.geometry.indexBuffer.data.BYTES_PER_ELEMENT===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;o.drawElements(o.TRIANGLES,t.particleChildren.length*6,c,0)}}});function x4(n,e=null){let t=n*6;if(t>65535?e||(e=new Uint32Array(t)):e||(e=new Uint16Array(t)),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let r=0,i=0;r<t;r+=6,i+=4)e[r+0]=i+0,e[r+1]=i+1,e[r+2]=i+2,e[r+3]=i+0,e[r+4]=i+2,e[r+5]=i+3;return e}var fC=$(()=>{"use strict"});function B9(n){return{dynamicUpdate:AB(n,!0),staticUpdate:AB(n,!1)}}function AB(n,e){let t=[];t.push(`
      
        var index = 0;

        for (let i = 0; i < ps.length; ++i)
        {
            const p = ps[i];

            `);let r=0;for(let s in n){let o=n[s];if(e!==o.dynamic)continue;t.push(`offset = index + ${r}`),t.push(o.code);let a=$n(o.format);r+=a.stride/4}t.push(`
            index += stride * 4;
        }
    `),t.unshift(`
        var stride = ${r};
    `);let i=t.join(`
`);return new Function("ps","f32v","u32v",i)}var hC=$(()=>{El()});function SK(n){let e=[];for(let t in n){let r=n[t];e.push(t,r.code,r.dynamic?"d":"s")}return e.join("_")}var y0,pC=$(()=>{Po();qs();Al();El();z7();fC();hC();y0=class{constructor(e){this._size=0,this._generateParticleUpdateCache={};let t=this._size=e.size??1e3,r=e.properties,i=0,s=0;for(let u in r){let d=r[u],f=$n(d.format);d.dynamic?s+=f.stride:i+=f.stride}this._dynamicStride=s/4,this._staticStride=i/4,this.staticAttributeBuffer=new ps(t*4*i),this.dynamicAttributeBuffer=new ps(t*4*s),this.indexBuffer=x4(t);let o=new Gn,a=0,l=0;this._staticBuffer=new ar({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:nt.VERTEX|nt.COPY_DST}),this._dynamicBuffer=new ar({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:nt.VERTEX|nt.COPY_DST});for(let u in r){let d=r[u],f=$n(d.format);d.dynamic?(o.addAttribute(d.attributeName,{buffer:this._dynamicBuffer,stride:this._dynamicStride*4,offset:a*4,format:d.format}),a+=f.size):(o.addAttribute(d.attributeName,{buffer:this._staticBuffer,stride:this._staticStride*4,offset:l*4,format:d.format}),l+=f.size)}o.addIndex(this.indexBuffer);let c=this.getParticleUpdate(r);this._dynamicUpload=c.dynamicUpdate,this._staticUpload=c.staticUpdate,this.geometry=o}getParticleUpdate(e){let t=SK(e);return this._generateParticleUpdateCache[t]?this._generateParticleUpdateCache[t]:(this._generateParticleUpdateCache[t]=this.generateParticleUpdate(e),this._generateParticleUpdateCache[t])}generateParticleUpdate(e){return B9(e)}update(e,t){e.length>this._size&&(t=!0,this._size=Math.max(e.length,this._size*1.5|0),this.staticAttributeBuffer=new ps(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new ps(this._size*this._dynamicStride*4*4),this.indexBuffer=x4(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));let r=this.dynamicAttributeBuffer;if(this._dynamicUpload(e,r.float32View,r.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,e.length*this._dynamicStride*4,!0),t){let i=this.staticAttributeBuffer;this._staticUpload(e,i.float32View,i.uint32View),this._staticBuffer.setDataWithSize(i.float32View,e.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}});var N9,mC=$(()=>{N9=`varying vec2 vUV;
varying vec4 vColor;

uniform sampler2D uTexture;

void main(void){
    vec4 color = texture2D(uTexture, vUV) * vColor;
    gl_FragColor = color;
}`});var O9,gC=$(()=>{O9=`attribute vec2 aVertex;
attribute vec2 aUV;
attribute vec4 aColor;

attribute vec2 aPosition;
attribute float aRotation;

uniform mat3 uTranslationMatrix;
uniform float uRound;
uniform vec2 uResolution;
uniform vec4 uColor;

varying vec2 vUV;
varying vec4 vColor;

vec2 roundPixels(vec2 position, vec2 targetSize)
{       
    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
}

void main(void){
    float cosRotation = cos(aRotation);
    float sinRotation = sin(aRotation);
    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;
    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;

    vec2 v = vec2(x, y);
    v = v + aPosition;

    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    if(uRound == 1.0)
    {
        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
    }

    vUV = aUV;
    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;
}
`});var b4,yC=$(()=>{b4=`
struct ParticleUniforms {
  uProjectionMatrix:mat3x3<f32>,
  uColor:vec4<f32>,
  uResolution:vec2<f32>,
  uRoundPixels:f32,
};

@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;

@group(1) @binding(0) var uTexture: texture_2d<f32>;
@group(1) @binding(1) var uSampler : sampler;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) color : vec4<f32>,
  };
@vertex
fn mainVertex(
  @location(0) aVertex: vec2<f32>,
  @location(1) aPosition: vec2<f32>,
  @location(2) aUV: vec2<f32>,
  @location(3) aColor: vec4<f32>,
  @location(4) aRotation: f32,
) -> VSOutput {
  
   let v = vec2(
       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),
       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)
   ) + aPosition;

   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;

  return VSOutput(
   position,
   aUV,
   vColor,
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) color: vec4<f32>,
  @builtin(position) position: vec4<f32>,
) -> @location(0) vec4<f32> {

    var sample = textureSample(uTexture, uSampler, uv) * color;
   
    return sample;
}`});var x0,xC=$(()=>{nn();Ct();Ci();qi();bs();_t();p7();mC();gC();yC();x0=class extends xr{constructor(){let e=he.from({vertex:O9,fragment:N9}),t=pe.from({fragment:{source:b4,entryPoint:"mainFragment"},vertex:{source:b4,entryPoint:"mainVertex"}});super({glProgram:e,gpuProgram:t,resources:{uTexture:re.WHITE.source,uSampler:new z2({}),uniforms:{uTranslationMatrix:{value:new ue,type:"mat3x3<f32>"},uColor:{value:new ce(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}});var Bl,L9=$(()=>{Ct();Hr();Z2();Ki();ou();pC();xC();Bl=class{constructor(e,t){this.state=ur.for2d(),this._gpuBufferHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.localUniforms=new pt({uTranslationMatrix:{value:new ue,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=e,this.adaptor=t,this.defaultShader=new x0,this.state=ur.for2d()}validateRenderable(e){return!1}addRenderable(e,t){this.renderer.renderPipes.batch.break(t),t.add(e)}getBuffers(e){return this._gpuBufferHash[e.uid]||this._initBuffer(e)}_initBuffer(e){return this._gpuBufferHash[e.uid]=new y0({size:e.particleChildren.length,properties:e._properties}),e.on("destroyed",this._destroyRenderableBound),this._gpuBufferHash[e.uid]}updateRenderable(e){}destroyRenderable(e){this._gpuBufferHash[e.uid].destroy(),this._gpuBufferHash[e.uid]=null,e.off("destroyed",this._destroyRenderableBound)}execute(e){let t=e.particleChildren;if(t.length===0)return;let r=this.renderer,i=this.getBuffers(e);e.texture||(e.texture=t[0].texture);let s=this.state;i.update(t,e._childrenDirty),e._childrenDirty=!1,s.blendMode=Xs(e.blendMode,e.texture._source);let o=this.localUniforms.uniforms,a=o.uTranslationMatrix;e.worldTransform.copyTo(a),a.prepend(r.globalUniforms.globalUniformData.projectionMatrix),o.uResolution=r.globalUniforms.globalUniformData.resolution,o.uRound=r._roundPixels|e._roundPixels,vs(e.groupColorAlpha,o.uColor,0),this.adaptor.execute(this,e)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}});var cu,bC=$(()=>{ee();dC();L9();cu=class extends Bl{constructor(e){super(e,new g0)}};cu.extension={type:[z.WebGLPipes],name:"particle"}});var b0,_C=$(()=>{"use strict";b0=class{execute(e,t){let r=e.renderer,i=t.shader||e.defaultShader;i.groups[0]=r.renderPipes.uniformBatch.getUniformBindGroup(e.localUniforms,!0),i.groups[1]=r.texture.getTextureBindGroup(t.texture);let s=e.state,o=e.getBuffers(t);r.encoder.draw({geometry:o.geometry,shader:t.shader||e.defaultShader,state:s,size:t.particleChildren.length*6})}}});var uu,vC=$(()=>{ee();_C();L9();uu=class extends Bl{constructor(e){super(e,new b0)}};uu.extension={type:[z.WebGPUPipes],name:"particle"}});var wC=$(()=>{ee();bC();vC();ke.add(cu);ke.add(uu)});var ws,_0=$(()=>{"use strict";ws=class{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}}});var du,SC=$(()=>{ee();Jh();On();_0();du=class{constructor(e){this._gpuText=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.runners.resolutionChange.add(this),this._renderer.renderableGC.addManagedHash(this,"_gpuText")}resolutionChange(){for(let e in this._gpuText){let t=this._gpuText[e];if(!t)continue;let r=t.batchableSprite.renderable;r._autoResolution&&(r._resolution=this._renderer.resolution,r.onViewUpdate())}}validateRenderable(e){let t=this._getGpuText(e),r=e._getKey();return t.currentKey!==r}addRenderable(e,t){let i=this._getGpuText(e).batchableSprite;e._didTextUpdate&&this._updateText(e),this._renderer.renderPipes.batch.addToBatch(i,t)}updateRenderable(e){let r=this._getGpuText(e).batchableSprite;e._didTextUpdate&&this._updateText(e),r._batcher.updateElement(r)}destroyRenderable(e){e.off("destroyed",this._destroyRenderableBound),this._destroyRenderableById(e.uid)}_destroyRenderableById(e){let t=this._gpuText[e];this._renderer.canvasText.decreaseReferenceCount(t.currentKey),Ze.return(t.batchableSprite),this._gpuText[e]=null}_updateText(e){let t=e._getKey(),r=this._getGpuText(e),i=r.batchableSprite;r.currentKey!==t&&this._updateGpuText(e),e._didTextUpdate=!1;let s=e._style.padding;Sa(i.bounds,e._anchor,i.texture,s)}_updateGpuText(e){let t=this._getGpuText(e),r=t.batchableSprite;t.texture&&this._renderer.canvasText.decreaseReferenceCount(t.currentKey),t.texture=r.texture=this._renderer.canvasText.getManagedTexture(e),t.currentKey=e._getKey(),r.texture=t.texture}_getGpuText(e){return this._gpuText[e.uid]||this.initGpuText(e)}initGpuText(e){let t={texture:null,currentKey:"--",batchableSprite:Ze.get(ws)};return t.batchableSprite.renderable=e,t.batchableSprite.transform=e.groupTransform,t.batchableSprite.bounds={minX:0,maxX:1,minY:0,maxY:0},t.batchableSprite.roundPixels=this._renderer._roundPixels|e._roundPixels,this._gpuText[e.uid]=t,e._resolution=e._autoResolution?this._renderer.resolution:e.resolution,this._updateText(e),e.on("destroyed",this._destroyRenderableBound),t}destroy(){for(let e in this._gpuText)this._destroyRenderableById(e);this._gpuText=null,this._renderer=null}};du.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"text"}});var _4,zn,fu=$(()=>{Vt();$2();_4=class{constructor(e){this._canvasPool=Object.create(null),this.canvasOptions=e||{},this.enableFullScreen=!1}_createCanvasAndContext(e,t){let r=Fe.get().createCanvas();r.width=e,r.height=t;let i=r.getContext("2d");return{canvas:r,context:i}}getOptimalCanvasAndContext(e,t,r=1){e=Math.ceil(e*r-1e-6),t=Math.ceil(t*r-1e-6),e=wi(e),t=wi(t);let i=(e<<17)+(t<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let s=this._canvasPool[i].pop();return s||(s=this._createCanvasAndContext(e,t)),s}returnCanvasAndContext(e){let t=e.canvas,{width:r,height:i}=t,s=(r<<17)+(i<<1);e.context.clearRect(0,0,r,i),this._canvasPool[s].push(e)}clear(){this._canvasPool={}}},zn=new _4});function EB(n,e,t){for(let r=0,i=4*t*e;r<e;++r,i+=4)if(n[i+3]!==0)return!1;return!0}function TB(n,e,t,r,i){let s=4*e;for(let o=r,a=r*s+4*t;o<=i;++o,a+=s)if(n[a+3]!==0)return!1;return!0}function U9(n,e=1){let{width:t,height:r}=n,i=n.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");let o=i.getImageData(0,0,t,r).data,a=0,l=0,c=t-1,u=r-1;for(;l<r&&EB(o,t,l);)++l;if(l===r)return $e.EMPTY;for(;EB(o,t,u);)--u;for(;TB(o,t,a,l,u);)++a;for(;TB(o,t,c,l,u);)--c;return++c,++u,new $e(a/e,l/e,(c-a)/e,(u-l)/e)}var CC=$(()=>{Qr()});var kB,Mo,v4=$(()=>{nn();Vt();Ct();Jc();_t();_n();kB=class AC{constructor(e,t,r,i){this.uid=gt("fillGradient"),this.type="linear",this.gradientStops=[],this._styleKey=null,this.x0=e,this.y0=t,this.x1=r,this.y1=i}addColorStop(e,t){return this.gradientStops.push({offset:e,color:ce.shared.setValue(t).toHexa()}),this._styleKey=null,this}buildLinearGradient(){if(this.texture)return;let e=AC.defaultTextureSize,{gradientStops:t}=this,r=Fe.get().createCanvas();r.width=e,r.height=e;let i=r.getContext("2d"),s=i.createLinearGradient(0,0,AC.defaultTextureSize,1);for(let m=0;m<t.length;m++){let g=t[m];s.addColorStop(g.offset,g.color)}i.fillStyle=s,i.fillRect(0,0,e,e),this.texture=new re({source:new An({resource:r,addressModeU:"clamp-to-edge",addressModeV:"repeat"})});let{x0:o,y0:a,x1:l,y1:c}=this,u=new ue,d=l-o,f=c-a,h=Math.sqrt(d*d+f*f),p=Math.atan2(f,d);u.translate(-o,-a),u.scale(1/e,1/e),u.rotate(-p),u.scale(256/h,1),this.transform=u,this._styleKey=null}get styleKey(){if(this._styleKey)return this._styleKey;let e=this.gradientStops.map(i=>`${i.offset}-${i.color}`).join("-"),t=this.texture.uid,r=this.transform.toArray().join("-");return`fill-gradient-${this.uid}-${e}-${t}-${r}-${this.x0}-${this.y0}-${this.x1}-${this.y1}`}};kB.defaultTextureSize=256;Mo=kB});var IB,Ks,w4=$(()=>{Ct();_n();IB={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},Ks=class{constructor(e,t){this.uid=gt("fillPattern"),this.transform=new ue,this._styleKey=null,this.texture=e,this.transform.scale(1/e.frame.width,1/e.frame.height),t&&(e.source.style.addressModeU=IB[t].addressModeU,e.source.style.addressModeV=IB[t].addressModeV)}setTransform(e){let t=this.texture;this.transform.copyFrom(e),this.transform.invert(),this.transform.scale(1/t.frame.width,1/t.frame.height),this._styleKey=null}get styleKey(){return this._styleKey?this._styleKey:(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`,this._styleKey)}}});var DB=ut((zye,PB)=>{PB.exports=AK;var EC={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},CK=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function AK(n){var e=[];return n.replace(CK,function(t,r,i){var s=r.toLowerCase();for(i=TK(i),s=="m"&&i.length>2&&(e.push([r].concat(i.splice(0,2))),s="l",r=r=="m"?"l":"L");;){if(i.length==EC[s])return i.unshift(r),e.push(i);if(i.length<EC[s])throw new Error("malformed path data");e.push([r].concat(i.splice(0,EC[s])))}}),e}var EK=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function TK(n){var e=n.match(EK);return e?e.map(Number):[]}});function G9(n,e){let t=(0,MB.default)(n),r=[],i=null,s=0,o=0;for(let a=0;a<t.length;a++){let l=t[a],c=l[0],u=l;switch(c){case"M":s=u[1],o=u[2],e.moveTo(s,o);break;case"m":s+=u[1],o+=u[2],e.moveTo(s,o);break;case"H":s=u[1],e.lineTo(s,o);break;case"h":s+=u[1],e.lineTo(s,o);break;case"V":o=u[1],e.lineTo(s,o);break;case"v":o+=u[1],e.lineTo(s,o);break;case"L":s=u[1],o=u[2],e.lineTo(s,o);break;case"l":s+=u[1],o+=u[2],e.lineTo(s,o);break;case"C":s=u[5],o=u[6],e.bezierCurveTo(u[1],u[2],u[3],u[4],s,o);break;case"c":e.bezierCurveTo(s+u[1],o+u[2],s+u[3],o+u[4],s+u[5],o+u[6]),s+=u[5],o+=u[6];break;case"S":s=u[3],o=u[4],e.bezierCurveToShort(u[1],u[2],s,o);break;case"s":e.bezierCurveToShort(s+u[1],o+u[2],s+u[3],o+u[4]),s+=u[3],o+=u[4];break;case"Q":s=u[3],o=u[4],e.quadraticCurveTo(u[1],u[2],s,o);break;case"q":e.quadraticCurveTo(s+u[1],o+u[2],s+u[3],o+u[4]),s+=u[3],o+=u[4];break;case"T":s=u[1],o=u[2],e.quadraticCurveToShort(s,o);break;case"t":s+=u[1],o+=u[2],e.quadraticCurveToShort(s,o);break;case"A":s=u[6],o=u[7],e.arcToSvg(u[1],u[2],u[3],u[4],u[5],s,o);break;case"a":s+=u[6],o+=u[7],e.arcToSvg(u[1],u[2],u[3],u[4],u[5],s,o);break;case"Z":case"z":e.closePath(),r.length>0&&(i=r.pop(),i?(s=i.startX,o=i.startY):(s=0,o=0)),i=null;break;default:ve(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&i===null&&(i={startX:s,startY:o},r.push(i))}return e}var MB,TC=$(()=>{MB=Ot(DB(),1);Gt()});var ka,kC=$(()=>{Qr();ka=class n{constructor(e=0,t=0,r=0){this.type="circle",this.x=e,this.y=t,this.radius=r}clone(){return new n(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;let r=this.radius*this.radius,i=this.x-e,s=this.y-t;return i*=i,s*=s,i+s<=r}strokeContains(e,t,r,i=.5){if(this.radius===0)return!1;let s=this.x-e,o=this.y-t,a=this.radius,l=(1-i)*r,c=Math.sqrt(s*s+o*o);return c<=a+l&&c>a-(r-l)}getBounds(e){return e||(e=new $e),e.x=this.x-this.radius,e.y=this.y-this.radius,e.width=this.radius*2,e.height=this.radius*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.radius=e.radius,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}});var v0,IC=$(()=>{Qr();v0=class n{constructor(e=0,t=0,r=0,i=0){this.type="ellipse",this.x=e,this.y=t,this.halfWidth=r,this.halfHeight=i}clone(){return new n(this.x,this.y,this.halfWidth,this.halfHeight)}contains(e,t){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let r=(e-this.x)/this.halfWidth,i=(t-this.y)/this.halfHeight;return r*=r,i*=i,r+i<=1}strokeContains(e,t,r,i=.5){let{halfWidth:s,halfHeight:o}=this;if(s<=0||o<=0)return!1;let a=r*(1-i),l=r-a,c=s-l,u=o-l,d=s+a,f=o+a,h=e-this.x,p=t-this.y,m=h*h/(c*c)+p*p/(u*u),g=h*h/(d*d)+p*p/(f*f);return m>1&&g<=1}getBounds(e){return e||(e=new $e),e.x=this.x-this.halfWidth,e.y=this.y-this.halfHeight,e.width=this.halfWidth*2,e.height=this.halfHeight*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.halfWidth=e.halfWidth,this.halfHeight=e.halfHeight,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}});function Nl(n,e,t,r,i,s){let o=n-t,a=e-r,l=i-t,c=s-r,u=o*l+a*c,d=l*l+c*c,f=-1;d!==0&&(f=u/d);let h,p;f<0?(h=t,p=r):f>1?(h=i,p=s):(h=t+f*l,p=r+f*c);let m=n-h,g=e-p;return m*m+g*g}var $9=$(()=>{"use strict"});var Ai,PC=$(()=>{$9();Qr();Ai=class n{constructor(...e){this.type="polygon";let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){let r=[];for(let i=0,s=t.length;i<s;i++)r.push(t[i].x,t[i].y);t=r}this.points=t,this.closePath=!0}clone(){let e=this.points.slice(),t=new n(e);return t.closePath=this.closePath,t}contains(e,t){let r=!1,i=this.points.length/2;for(let s=0,o=i-1;s<i;o=s++){let a=this.points[s*2],l=this.points[s*2+1],c=this.points[o*2],u=this.points[o*2+1];l>t!=u>t&&e<(c-a)*((t-l)/(u-l))+a&&(r=!r)}return r}strokeContains(e,t,r,i=.5){let s=r*r,o=s*(1-i),a=s-o,{points:l}=this,c=l.length-(this.closePath?0:2);for(let u=0;u<c;u+=2){let d=l[u],f=l[u+1],h=l[(u+2)%l.length],p=l[(u+3)%l.length],m=Nl(e,t,d,f,h,p),g=Math.sign((h-d)*(t-f)-(p-f)*(e-d));if(m<=(g<0?a:o))return!0}return!1}getBounds(e){e||(e=new $e);let t=this.points,r=1/0,i=-1/0,s=1/0,o=-1/0;for(let a=0,l=t.length;a<l;a+=2){let c=t[a],u=t[a+1];r=c<r?c:r,i=c>i?c:i,s=u<s?u:s,o=u>o?u:o}return e.x=r,e.width=i-r,e.y=s,e.height=o-s,e}copyFrom(e){return this.points=e.points.slice(),this.closePath=e.closePath,this}copyTo(e){return e.copyFrom(this),e}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((e,t)=>`${e}, ${t}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}});var z9,w0,DC=$(()=>{Qr();z9=(n,e,t,r,i,s,o)=>{let a=n-t,l=e-r,c=Math.sqrt(a*a+l*l);return c>=i-s&&c<=i+o},w0=class n{constructor(e=0,t=0,r=0,i=0,s=20){this.type="roundedRectangle",this.x=e,this.y=t,this.width=r,this.height=i,this.radius=s}getBounds(e){return e||(e=new $e),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}clone(){return new n(this.x,this.y,this.width,this.height,this.radius)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){let r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+r&&t<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;let i=e-(this.x+r),s=t-(this.y+r),o=r*r;if(i*i+s*s<=o||(i=e-(this.x+this.width-r),i*i+s*s<=o)||(s=t-(this.y+this.height-r),i*i+s*s<=o)||(i=e-(this.x+r),i*i+s*s<=o))return!0}return!1}strokeContains(e,t,r,i=.5){let{x:s,y:o,width:a,height:l,radius:c}=this,u=r*(1-i),d=r-u,f=s+c,h=o+c,p=a-c*2,m=l-c*2,g=s+a,y=o+l;return(e>=s-u&&e<=s+d||e>=g-d&&e<=g+u)&&t>=h&&t<=h+m||(t>=o-u&&t<=o+d||t>=y-d&&t<=y+u)&&e>=f&&e<=f+p?!0:e<f&&t<h&&z9(e,t,f,h,c,d,u)||e>g-c&&t<h&&z9(e,t,g-c,h,c,d,u)||e>g-c&&t>y-c&&z9(e,t,g-c,y-c,c,d,u)||e<f&&t>y-c&&z9(e,t,f,y-c,c,d,u)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}});function C0(n,e,t,r,i,s,o,a,l,c){let d=Math.min(.99,Math.max(0,c??Fl.defaultOptions.bezierSmoothness)),f=(IK-d)/1;return f*=f,PK(e,t,r,i,s,o,a,l,n,f),n}function PK(n,e,t,r,i,s,o,a,l,c){RC(n,e,t,r,i,s,o,a,l,c,0),l.push(o,a)}function RC(n,e,t,r,i,s,o,a,l,c,u){if(u>kK)return;let d=Math.PI,f=(n+t)/2,h=(e+r)/2,p=(t+i)/2,m=(r+s)/2,g=(i+o)/2,y=(s+a)/2,x=(f+p)/2,b=(h+m)/2,_=(p+g)/2,S=(m+y)/2,C=(x+_)/2,k=(b+S)/2;if(u>0){let v=o-n,w=a-e,A=Math.abs((t-o)*w-(r-a)*v),E=Math.abs((i-o)*w-(s-a)*v),I,M;if(A>H9&&E>H9){if((A+E)*(A+E)<=c*(v*v+w*w)){if(S0<MC){l.push(C,k);return}let T=Math.atan2(s-r,i-t);if(I=Math.abs(T-Math.atan2(r-e,t-n)),M=Math.abs(Math.atan2(a-s,o-i)-T),I>=d&&(I=2*d-I),M>=d&&(M=2*d-M),I+M<S0){l.push(C,k);return}if(hu!==0){if(I>hu){l.push(t,r);return}if(M>hu){l.push(i,s);return}}}}else if(A>H9){if(A*A<=c*(v*v+w*w)){if(S0<MC){l.push(C,k);return}if(I=Math.abs(Math.atan2(s-r,i-t)-Math.atan2(r-e,t-n)),I>=d&&(I=2*d-I),I<S0){l.push(t,r),l.push(i,s);return}if(hu!==0&&I>hu){l.push(t,r);return}}}else if(E>H9){if(E*E<=c*(v*v+w*w)){if(S0<MC){l.push(C,k);return}if(I=Math.abs(Math.atan2(a-s,o-i)-Math.atan2(s-r,i-t)),I>=d&&(I=2*d-I),I<S0){l.push(t,r),l.push(i,s);return}if(hu!==0&&I>hu){l.push(i,s);return}}}else if(v=C-(n+o)/2,w=k-(e+a)/2,v*v+w*w<=c){l.push(C,k);return}}RC(n,e,f,h,x,b,C,k,l,c,u+1),RC(C,k,_,S,g,y,o,a,l,c,u+1)}var kK,H9,IK,MC,S0,hu,W9=$(()=>{g4();kK=8,H9=11920929e-14,IK=1,MC=.01,S0=0,hu=0});function V9(n,e,t,r,i,s,o,a){let c=Math.min(.99,Math.max(0,a??Fl.defaultOptions.bezierSmoothness)),u=(RK-c)/1;return u*=u,BK(e,t,r,i,s,o,n,u),n}function BK(n,e,t,r,i,s,o,a){FC(o,n,e,t,r,i,s,a,0),o.push(i,s)}function FC(n,e,t,r,i,s,o,a,l){if(l>DK)return;let c=Math.PI,u=(e+r)/2,d=(t+i)/2,f=(r+s)/2,h=(i+o)/2,p=(u+f)/2,m=(d+h)/2,g=s-e,y=o-t,x=Math.abs((r-s)*y-(i-o)*g);if(x>MK){if(x*x<=a*(g*g+y*y)){if(RB<FK){n.push(p,m);return}let b=Math.abs(Math.atan2(o-i,s-r)-Math.atan2(i-t,r-e));if(b>=c&&(b=2*c-b),b<RB){n.push(p,m);return}}}else if(g=p-(e+s)/2,y=m-(t+o)/2,g*g+y*y<=a){n.push(p,m);return}FC(n,e,t,u,d,p,m,a,l+1),FC(n,p,m,f,h,s,o,a,l+1)}var DK,MK,RK,FK,RB,BC=$(()=>{g4();DK=8,MK=11920929e-14,RK=1,FK=.01,RB=0});function A0(n,e,t,r,i,s,o,a){let l=Math.abs(i-s);(!o&&i>s||o&&s>i)&&(l=2*Math.PI-l),a||(a=Math.max(6,Math.floor(6*Math.pow(r,1/3)*(l/Math.PI)))),a=Math.max(a,3);let c=l/a,u=i;c*=o?-1:1;for(let d=0;d<a+1;d++){let f=Math.cos(u),h=Math.sin(u),p=e+f*r,m=t+h*r;n.push(p,m),u+=c}}var j9=$(()=>{"use strict"});function X9(n,e,t,r,i,s){let o=n[n.length-2],l=n[n.length-1]-t,c=o-e,u=i-t,d=r-e,f=Math.abs(l*d-c*u);if(f<1e-8||s===0){(n[n.length-2]!==e||n[n.length-1]!==t)&&n.push(e,t);return}let h=l*l+c*c,p=u*u+d*d,m=l*u+c*d,g=s*Math.sqrt(h)/f,y=s*Math.sqrt(p)/f,x=g*m/h,b=y*m/p,_=g*d+y*c,S=g*u+y*l,C=c*(y+x),k=l*(y+x),v=d*(g+b),w=u*(g+b),A=Math.atan2(k-S,C-_),E=Math.atan2(w-S,v-_);A0(n,_+e,S+t,s,A,E,c*u>d*l)}var NC=$(()=>{j9()});function NK(n,e){let t=e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),r=e===1.5707963267948966?.551915024494:t,i=Math.cos(n),s=Math.sin(n),o=Math.cos(n+e),a=Math.sin(n+e);return[{x:i-s*r,y:s+i*r},{x:o+a*r,y:a-o*r},{x:o,y:a}]}function q9(n,e,t,r,i,s,o,a=0,l=0,c=0){if(s===0||o===0)return;let u=Math.sin(a*S4/360),d=Math.cos(a*S4/360),f=d*(e-r)/2+u*(t-i)/2,h=-u*(e-r)/2+d*(t-i)/2;if(f===0&&h===0)return;s=Math.abs(s),o=Math.abs(o);let p=Math.pow(f,2)/Math.pow(s,2)+Math.pow(h,2)/Math.pow(o,2);p>1&&(s*=Math.sqrt(p),o*=Math.sqrt(p)),OK(e,t,r,i,s,o,l,c,u,d,f,h,OC);let{ang1:m,ang2:g}=OC,{centerX:y,centerY:x}=OC,b=Math.abs(g)/(S4/4);Math.abs(1-b)<1e-7&&(b=1);let _=Math.max(Math.ceil(b),1);g/=_;let S=n[n.length-2],C=n[n.length-1],k={x:0,y:0};for(let v=0;v<_;v++){let w=NK(m,g),{x:A,y:E}=LC(w[0],s,o,d,u,y,x,k),{x:I,y:M}=LC(w[1],s,o,d,u,y,x,k),{x:T,y:R}=LC(w[2],s,o,d,u,y,x,k);C0(n,S,C,A,E,I,M,T,R),S=T,C=R,m+=g}}var S4,OC,LC,FB,OK,UC=$(()=>{W9();S4=Math.PI*2,OC={centerX:0,centerY:0,ang1:0,ang2:0},LC=({x:n,y:e},t,r,i,s,o,a,l)=>{n*=t,e*=r;let c=i*n-s*e,u=s*n+i*e;return l.x=c+o,l.y=u+a,l};FB=(n,e,t,r)=>{let i=n*r-e*t<0?-1:1,s=n*t+e*r;return s>1&&(s=1),s<-1&&(s=-1),i*Math.acos(s)},OK=(n,e,t,r,i,s,o,a,l,c,u,d,f)=>{let h=Math.pow(i,2),p=Math.pow(s,2),m=Math.pow(u,2),g=Math.pow(d,2),y=h*p-h*g-p*m;y<0&&(y=0),y/=h*g+p*m,y=Math.sqrt(y)*(o===a?-1:1);let x=y*i/s*d,b=y*-s/i*u,_=c*x-l*b+(n+t)/2,S=l*x+c*b+(e+r)/2,C=(u-x)/i,k=(d-b)/s,v=(-u-x)/i,w=(-d-b)/s,A=FB(1,0,C,k),E=FB(C,k,v,w);a===0&&E>0&&(E-=S4),a===1&&E<0&&(E+=S4),f.centerX=_,f.centerY=S,f.ang1=A,f.ang2=E}});function Y9(n,e,t){let r=(o,a)=>{let l=a.x-o.x,c=a.y-o.y,u=Math.sqrt(l*l+c*c),d=l/u,f=c/u;return{len:u,nx:d,ny:f}},i=(o,a)=>{o===0?n.moveTo(a.x,a.y):n.lineTo(a.x,a.y)},s=e[e.length-1];for(let o=0;o<e.length;o++){let a=e[o%e.length],l=a.radius??t;if(l<=0){i(o,a),s=a;continue}let c=e[(o+1)%e.length],u=r(a,s),d=r(a,c);if(u.len<1e-4||d.len<1e-4){i(o,a),s=a;continue}let f=Math.asin(u.nx*d.ny-u.ny*d.nx),h=1,p=!1;u.nx*d.nx-u.ny*-d.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,h=-1,p=!0):f>0&&(h=-1,p=!0);let m=f/2,g,y=Math.abs(Math.cos(m)*l/Math.sin(m));y>Math.min(u.len/2,d.len/2)?(y=Math.min(u.len/2,d.len/2),g=Math.abs(y*Math.sin(m)/Math.cos(m))):g=l;let x=a.x+d.nx*y+-d.ny*g*h,b=a.y+d.ny*y+d.nx*g*h,_=Math.atan2(u.ny,u.nx)+Math.PI/2*h,S=Math.atan2(d.ny,d.nx)-Math.PI/2*h;o===0&&n.moveTo(x+Math.cos(_)*g,b+Math.sin(_)*g),n.arc(x,b,g,_,S,p),s=a}}function K9(n,e,t,r){let i=(a,l)=>Math.sqrt((a.x-l.x)**2+(a.y-l.y)**2),s=(a,l,c)=>({x:a.x+(l.x-a.x)*c,y:a.y+(l.y-a.y)*c}),o=e.length;for(let a=0;a<o;a++){let l=e[(a+1)%o],c=l.radius??t;if(c<=0){a===0?n.moveTo(l.x,l.y):n.lineTo(l.x,l.y);continue}let u=e[a],d=e[(a+2)%o],f=i(u,l),h;if(f<1e-4)h=l;else{let g=Math.min(f/2,c);h=s(l,u,g/f)}let p=i(d,l),m;if(p<1e-4)m=l;else{let g=Math.min(p/2,c);m=s(l,d,g/p)}a===0?n.moveTo(h.x,h.y):n.lineTo(h.x,h.y),n.quadraticCurveTo(l.x,l.y,m.x,m.y,r)}}var GC=$(()=>{"use strict"});var LK,E0,$C=$(()=>{kC();IC();PC();Qr();DC();Ln();W9();BC();j9();NC();UC();GC();LK=new $e,E0=class{constructor(e){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new Nt,this._graphicsPath2D=e}moveTo(e,t){return this.startPoly(e,t),this}lineTo(e,t){this._ensurePoly();let r=this._currentPoly.points,i=r[r.length-2],s=r[r.length-1];return(i!==e||s!==t)&&r.push(e,t),this}arc(e,t,r,i,s,o){this._ensurePoly(!1);let a=this._currentPoly.points;return A0(a,e,t,r,i,s,o),this}arcTo(e,t,r,i,s){this._ensurePoly();let o=this._currentPoly.points;return X9(o,e,t,r,i,s),this}arcToSvg(e,t,r,i,s,o,a){let l=this._currentPoly.points;return q9(l,this._currentPoly.lastX,this._currentPoly.lastY,o,a,e,t,r,i,s),this}bezierCurveTo(e,t,r,i,s,o,a){this._ensurePoly();let l=this._currentPoly;return C0(this._currentPoly.points,l.lastX,l.lastY,e,t,r,i,s,o,a),this}quadraticCurveTo(e,t,r,i,s){this._ensurePoly();let o=this._currentPoly;return V9(this._currentPoly.points,o.lastX,o.lastY,e,t,r,i,s),this}closePath(){return this.endPoly(!0),this}addPath(e,t){this.endPoly(),t&&!t.isIdentity()&&(e=e.clone(!0),e.transform(t));for(let r=0;r<e.instructions.length;r++){let i=e.instructions[r];this[i.action](...i.data)}return this}finish(e=!1){this.endPoly(e)}rect(e,t,r,i,s){return this.drawShape(new $e(e,t,r,i),s),this}circle(e,t,r,i){return this.drawShape(new ka(e,t,r),i),this}poly(e,t,r){let i=new Ai(e);return i.closePath=t,this.drawShape(i,r),this}regularPoly(e,t,r,i,s=0,o){i=Math.max(i|0,3);let a=-1*Math.PI/2+s,l=Math.PI*2/i,c=[];for(let u=0;u<i;u++){let d=a-u*l;c.push(e+r*Math.cos(d),t+r*Math.sin(d))}return this.poly(c,!0,o),this}roundPoly(e,t,r,i,s,o=0,a){if(i=Math.max(i|0,3),s<=0)return this.regularPoly(e,t,r,i,o);let l=r*Math.sin(Math.PI/i)-.001;s=Math.min(s,l);let c=-1*Math.PI/2+o,u=Math.PI*2/i,d=(i-2)*Math.PI/i/2;for(let f=0;f<i;f++){let h=f*u+c,p=e+r*Math.cos(h),m=t+r*Math.sin(h),g=h+Math.PI+d,y=h-Math.PI-d,x=p+s*Math.cos(g),b=m+s*Math.sin(g),_=p+s*Math.cos(y),S=m+s*Math.sin(y);f===0?this.moveTo(x,b):this.lineTo(x,b),this.quadraticCurveTo(p,m,_,S,a)}return this.closePath()}roundShape(e,t,r=!1,i){return e.length<3?this:(r?K9(this,e,t,i):Y9(this,e,t),this.closePath())}filletRect(e,t,r,i,s){if(s===0)return this.rect(e,t,r,i);let o=Math.min(r,i)/2,a=Math.min(o,Math.max(-o,s)),l=e+r,c=t+i,u=a<0?-a:0,d=Math.abs(a);return this.moveTo(e,t+d).arcTo(e+u,t+u,e+d,t,d).lineTo(l-d,t).arcTo(l-u,t+u,l,t+d,d).lineTo(l,c-d).arcTo(l-u,c-u,e+r-d,c,d).lineTo(e+d,c).arcTo(e+u,c-u,e,c-d,d).closePath()}chamferRect(e,t,r,i,s,o){if(s<=0)return this.rect(e,t,r,i);let a=Math.min(s,Math.min(r,i)/2),l=e+r,c=t+i,u=[e+a,t,l-a,t,l,t+a,l,c-a,l-a,c,e+a,c,e,c-a,e,t+a];for(let d=u.length-1;d>=2;d-=2)u[d]===u[d-2]&&u[d-1]===u[d-3]&&u.splice(d-1,2);return this.poly(u,!0,o)}ellipse(e,t,r,i,s){return this.drawShape(new v0(e,t,r,i),s),this}roundRect(e,t,r,i,s,o){return this.drawShape(new w0(e,t,r,i,s),o),this}drawShape(e,t){return this.endPoly(),this.shapePrimitives.push({shape:e,transform:t}),this}startPoly(e,t){let r=this._currentPoly;return r&&this.endPoly(),r=new Ai,r.points.push(e,t),this._currentPoly=r,this}endPoly(e=!1){let t=this._currentPoly;return t&&t.points.length>2&&(t.closePath=e,this.shapePrimitives.push({shape:t})),this._currentPoly=null,this}_ensurePoly(e=!0){if(!this._currentPoly&&(this._currentPoly=new Ai,e)){let t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let r=t.shape.x,i=t.shape.y;if(t.transform&&!t.transform.isIdentity()){let s=t.transform,o=r;r=s.a*r+s.c*i+s.tx,i=s.b*o+s.d*i+s.ty}this._currentPoly.points.push(r,i)}else this._currentPoly.points.push(0,0)}}buildPath(){let e=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let t=0;t<e.instructions.length;t++){let r=e.instructions[t];this[r.action](...r.data)}this.finish()}get bounds(){let e=this._bounds;e.clear();let t=this.shapePrimitives;for(let r=0;r<t.length;r++){let i=t[r],s=i.shape.getBounds(LK);i.transform?e.addRect(s,i.transform):e.addRect(s)}return e}}});function C4(n,e){return n?n.prepend(e):e.clone()}var Ss,A4=$(()=>{vi();_n();Gt();TC();$C();Ss=class n{constructor(e){this.instructions=[],this.uid=gt("graphicsPath"),this._dirty=!0,typeof e=="string"?G9(e,this):this.instructions=e?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new E0(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(e,t){return e=e.clone(),this.instructions.push({action:"addPath",data:[e,t]}),this._dirty=!0,this}arc(...e){return this.instructions.push({action:"arc",data:e}),this._dirty=!0,this}arcTo(...e){return this.instructions.push({action:"arcTo",data:e}),this._dirty=!0,this}arcToSvg(...e){return this.instructions.push({action:"arcToSvg",data:e}),this._dirty=!0,this}bezierCurveTo(...e){return this.instructions.push({action:"bezierCurveTo",data:e}),this._dirty=!0,this}bezierCurveToShort(e,t,r,i,s){let o=this.instructions[this.instructions.length-1],a=this.getLastPoint(Ve.shared),l=0,c=0;if(!o||o.action!=="bezierCurveTo")l=a.x,c=a.y;else{l=o.data[2],c=o.data[3];let u=a.x,d=a.y;l=u+(u-l),c=d+(d-c)}return this.instructions.push({action:"bezierCurveTo",data:[l,c,e,t,r,i,s]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...e){return this.instructions.push({action:"ellipse",data:e}),this._dirty=!0,this}lineTo(...e){return this.instructions.push({action:"lineTo",data:e}),this._dirty=!0,this}moveTo(...e){return this.instructions.push({action:"moveTo",data:e}),this}quadraticCurveTo(...e){return this.instructions.push({action:"quadraticCurveTo",data:e}),this._dirty=!0,this}quadraticCurveToShort(e,t,r){let i=this.instructions[this.instructions.length-1],s=this.getLastPoint(Ve.shared),o=0,a=0;if(!i||i.action!=="quadraticCurveTo")o=s.x,a=s.y;else{o=i.data[0],a=i.data[1];let l=s.x,c=s.y;o=l+(l-o),a=c+(c-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,e,t,r]}),this._dirty=!0,this}rect(e,t,r,i,s){return this.instructions.push({action:"rect",data:[e,t,r,i,s]}),this._dirty=!0,this}circle(e,t,r,i){return this.instructions.push({action:"circle",data:[e,t,r,i]}),this._dirty=!0,this}roundRect(...e){return this.instructions.push({action:"roundRect",data:e}),this._dirty=!0,this}poly(...e){return this.instructions.push({action:"poly",data:e}),this._dirty=!0,this}regularPoly(...e){return this.instructions.push({action:"regularPoly",data:e}),this._dirty=!0,this}roundPoly(...e){return this.instructions.push({action:"roundPoly",data:e}),this._dirty=!0,this}roundShape(...e){return this.instructions.push({action:"roundShape",data:e}),this._dirty=!0,this}filletRect(...e){return this.instructions.push({action:"filletRect",data:e}),this._dirty=!0,this}chamferRect(...e){return this.instructions.push({action:"chamferRect",data:e}),this._dirty=!0,this}star(e,t,r,i,s,o,a){s||(s=i/2);let l=-1*Math.PI/2+o,c=r*2,u=Math.PI*2/c,d=[];for(let f=0;f<c;f++){let h=f%2?s:i,p=f*u+l;d.push(e+h*Math.cos(p),t+h*Math.sin(p))}return this.poly(d,!0,a),this}clone(e=!1){let t=new n;if(!e)t.instructions=this.instructions.slice();else for(let r=0;r<this.instructions.length;r++){let i=this.instructions[r];t.instructions.push({action:i.action,data:i.data.slice()})}return t}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(e){if(e.isIdentity())return this;let t=e.a,r=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,l=0,c=0,u=0,d=0,f=0,h=0,p=0,m=0;for(let g=0;g<this.instructions.length;g++){let y=this.instructions[g],x=y.data;switch(y.action){case"moveTo":case"lineTo":l=x[0],c=x[1],x[0]=t*l+i*c+o,x[1]=r*l+s*c+a;break;case"bezierCurveTo":u=x[0],d=x[1],f=x[2],h=x[3],l=x[4],c=x[5],x[0]=t*u+i*d+o,x[1]=r*u+s*d+a,x[2]=t*f+i*h+o,x[3]=r*f+s*h+a,x[4]=t*l+i*c+o,x[5]=r*l+s*c+a;break;case"quadraticCurveTo":u=x[0],d=x[1],l=x[2],c=x[3],x[0]=t*u+i*d+o,x[1]=r*u+s*d+a,x[2]=t*l+i*c+o,x[3]=r*l+s*c+a;break;case"arcToSvg":l=x[5],c=x[6],p=x[0],m=x[1],x[0]=t*p+i*m,x[1]=r*p+s*m,x[5]=t*l+i*c+o,x[6]=r*l+s*c+a;break;case"circle":x[4]=C4(x[3],e);break;case"rect":x[4]=C4(x[4],e);break;case"ellipse":x[8]=C4(x[8],e);break;case"roundRect":x[5]=C4(x[5],e);break;case"addPath":x[0].transform(e);break;case"poly":x[2]=C4(x[2],e);break;default:ve("unknown transform action",y.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(e){let t=this.instructions.length-1,r=this.instructions[t];if(!r)return e.x=0,e.y=0,e;for(;r.action==="closePath";){if(t--,t<0)return e.x=0,e.y=0,e;r=this.instructions[t]}switch(r.action){case"moveTo":case"lineTo":e.x=r.data[0],e.y=r.data[1];break;case"quadraticCurveTo":e.x=r.data[2],e.y=r.data[3];break;case"bezierCurveTo":e.x=r.data[4],e.y=r.data[5];break;case"arc":case"arcToSvg":e.x=r.data[5],e.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(e);break}return e}}});function Q9(n,e){if(typeof n=="string"){let r=document.createElement("div");r.innerHTML=n.trim(),n=r.querySelector("svg")}let t={context:e,path:new Ss};return BB(n,t,null,null),e}function BB(n,e,t,r){let i=n.children,{fillStyle:s,strokeStyle:o}=UK(n);s&&t?t={...t,...s}:s&&(t=s),o&&r?r={...r,...o}:o&&(r=o),e.context.fillStyle=t,e.context.strokeStyle=r;let a,l,c,u,d,f,h,p,m,g,y,x,b,_,S,C,k;switch(n.nodeName.toLowerCase()){case"path":_=n.getAttribute("d"),S=new Ss(_),e.context.path(S),t&&e.context.fill(),r&&e.context.stroke();break;case"circle":h=un(n,"cx",0),p=un(n,"cy",0),m=un(n,"r",0),e.context.ellipse(h,p,m,m),t&&e.context.fill(),r&&e.context.stroke();break;case"rect":a=un(n,"x",0),l=un(n,"y",0),C=un(n,"width",0),k=un(n,"height",0),g=un(n,"rx",0),y=un(n,"ry",0),g||y?e.context.roundRect(a,l,C,k,g||y):e.context.rect(a,l,C,k),t&&e.context.fill(),r&&e.context.stroke();break;case"ellipse":h=un(n,"cx",0),p=un(n,"cy",0),g=un(n,"rx",0),y=un(n,"ry",0),e.context.beginPath(),e.context.ellipse(h,p,g,y),t&&e.context.fill(),r&&e.context.stroke();break;case"line":c=un(n,"x1",0),u=un(n,"y1",0),d=un(n,"x2",0),f=un(n,"y2",0),e.context.beginPath(),e.context.moveTo(c,u),e.context.lineTo(d,f),r&&e.context.stroke();break;case"polygon":b=n.getAttribute("points"),x=b.match(/\d+/g).map(v=>parseInt(v,10)),e.context.poly(x,!0),t&&e.context.fill(),r&&e.context.stroke();break;case"polyline":b=n.getAttribute("points"),x=b.match(/\d+/g).map(v=>parseInt(v,10)),e.context.poly(x,!1),r&&e.context.stroke();break;case"g":case"svg":break;default:{console.info(`[SVG parser] <${n.nodeName}> elements unsupported`);break}}for(let v=0;v<i.length;v++)BB(i[v],e,t,r)}function un(n,e,t){let r=n.getAttribute(e);return r?Number(r):t}function UK(n){let e=n.getAttribute("style"),t={},r={},i=!1,s=!1;if(e){let o=e.split(";");for(let a=0;a<o.length;a++){let l=o[a],[c,u]=l.split(":");switch(c){case"stroke":u!=="none"&&(t.color=ce.shared.setValue(u).toNumber(),s=!0);break;case"stroke-width":t.width=Number(u);break;case"fill":u!=="none"&&(i=!0,r.color=ce.shared.setValue(u).toNumber());break;case"fill-opacity":r.alpha=Number(u);break;case"stroke-opacity":t.alpha=Number(u);break;case"opacity":r.alpha=Number(u),t.alpha=Number(u);break}}}else{let o=n.getAttribute("stroke");o&&o!=="none"&&(s=!0,t.color=ce.shared.setValue(o).toNumber(),t.width=un(n,"stroke-width",1));let a=n.getAttribute("fill");a&&a!=="none"&&(i=!0,r.color=ce.shared.setValue(a).toNumber())}return{strokeStyle:s?t:null,fillStyle:i?r:null}}var zC=$(()=>{nn();A4()});function GK(n){return ce.isColorLike(n)}function NB(n){return n instanceof Ks}function OB(n){return n instanceof Mo}function $K(n,e,t){let r=ce.shared.setValue(e??0);return n.color=r.toNumber(),n.alpha=r.alpha===1?t.alpha:r.alpha,n.texture=re.WHITE,{...t,...n}}function LB(n,e,t){return n.fill=e,n.color=16777215,n.texture=e.texture,n.matrix=e.transform,{...t,...n}}function UB(n,e,t){return e.buildLinearGradient(),n.fill=e,n.color=16777215,n.texture=e.texture,n.matrix=e.transform,{...t,...n}}function zK(n,e){let t={...e,...n};if(t.texture){if(t.texture!==re.WHITE){let s=t.matrix?.clone().invert()||new ue;s.translate(t.texture.frame.x,t.texture.frame.y),s.scale(1/t.texture.source.width,1/t.texture.source.height),t.matrix=s}let i=t.texture.source.style;i.addressMode==="clamp-to-edge"&&(i.addressMode="repeat",i.update())}let r=ce.shared.setValue(t.color);return t.alpha*=r.alpha,t.color=r.toNumber(),t.matrix=t.matrix?t.matrix.clone():null,t}function Qs(n,e){if(n==null)return null;let t={},r=n;return GK(n)?$K(t,n,e):NB(n)?LB(t,n,e):OB(n)?UB(t,n,e):r.fill&&NB(r.fill)?LB(r,r.fill,e):r.fill&&OB(r.fill)?UB(r,r.fill,e):zK(r,e)}function Ol(n,e){let{width:t,alignment:r,miterLimit:i,cap:s,join:o,pixelLine:a,...l}=e,c=Qs(n,l);return c?{width:t,alignment:r,miterLimit:i,cap:s,join:o,pixelLine:a,...c}:null}var Z9=$(()=>{nn();Ct();_t();v4();w4()});var HK,GB,HC,Wr,pu=$(()=>{Nn();nn();Ct();vi();_t();_n();zt();Ln();A4();zC();Z9();HK=new Ve,GB=new ue,HC=class Ro extends st{constructor(){super(...arguments),this.uid=gt("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new Ss,this._transform=new ue,this._fillStyle={...Ro.defaultFillStyle},this._strokeStyle={...Ro.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new Nt,this._boundsDirty=!0}clone(){let e=new Ro;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=Qs(e,Ro.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=Ol(e,Ro.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=Qs(e,Ro.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=Qs(e,Ro.defaultStrokeStyle),this}texture(e,t,r,i,s,o){return this.instructions.push({action:"texture",data:{image:e,dx:r||0,dy:i||0,dw:s||e.frame.width,dh:o||e.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:t?ce.shared.setValue(t).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new Ss,this}fill(e,t){let r,i=this.instructions[this.instructions.length-1];return this._tick===0&&i&&i.action==="stroke"?r=i.data.path:r=this._activePath.clone(),r?(e!=null&&(t!==void 0&&typeof e=="number"&&(oe(Ie,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:t}),this._fillStyle=Qs(e,Ro.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){let{x:e,y:t}=this._activePath.getLastPoint(Ve.shared);this._activePath.clear(),this._activePath.moveTo(e,t)}stroke(e){let t,r=this.instructions[this.instructions.length-1];return this._tick===0&&r&&r.action==="fill"?t=r.data.path:t=this._activePath.clone(),t?(e!=null&&(this._strokeStyle=Ol(e,Ro.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:t}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let e=0;e<2;e++){let t=this.instructions[this.instructions.length-1-e],r=this._activePath.clone();if(t&&(t.action==="stroke"||t.action==="fill"))if(t.data.hole)t.data.hole.addPath(r);else{t.data.hole=r;break}}return this._initNextPathLocation(),this}arc(e,t,r,i,s,o){this._tick++;let a=this._transform;return this._activePath.arc(a.a*e+a.c*t+a.tx,a.b*e+a.d*t+a.ty,r,i,s,o),this}arcTo(e,t,r,i,s){this._tick++;let o=this._transform;return this._activePath.arcTo(o.a*e+o.c*t+o.tx,o.b*e+o.d*t+o.ty,o.a*r+o.c*i+o.tx,o.b*r+o.d*i+o.ty,s),this}arcToSvg(e,t,r,i,s,o,a){this._tick++;let l=this._transform;return this._activePath.arcToSvg(e,t,r,i,s,l.a*o+l.c*a+l.tx,l.b*o+l.d*a+l.ty),this}bezierCurveTo(e,t,r,i,s,o,a){this._tick++;let l=this._transform;return this._activePath.bezierCurveTo(l.a*e+l.c*t+l.tx,l.b*e+l.d*t+l.ty,l.a*r+l.c*i+l.tx,l.b*r+l.d*i+l.ty,l.a*s+l.c*o+l.tx,l.b*s+l.d*o+l.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(e,t,r,i){return this._tick++,this._activePath.ellipse(e,t,r,i,this._transform.clone()),this}circle(e,t,r){return this._tick++,this._activePath.circle(e,t,r,this._transform.clone()),this}path(e){return this._tick++,this._activePath.addPath(e,this._transform.clone()),this}lineTo(e,t){this._tick++;let r=this._transform;return this._activePath.lineTo(r.a*e+r.c*t+r.tx,r.b*e+r.d*t+r.ty),this}moveTo(e,t){this._tick++;let r=this._transform,i=this._activePath.instructions,s=r.a*e+r.c*t+r.tx,o=r.b*e+r.d*t+r.ty;return i.length===1&&i[0].action==="moveTo"?(i[0].data[0]=s,i[0].data[1]=o,this):(this._activePath.moveTo(s,o),this)}quadraticCurveTo(e,t,r,i,s){this._tick++;let o=this._transform;return this._activePath.quadraticCurveTo(o.a*e+o.c*t+o.tx,o.b*e+o.d*t+o.ty,o.a*r+o.c*i+o.tx,o.b*r+o.d*i+o.ty,s),this}rect(e,t,r,i){return this._tick++,this._activePath.rect(e,t,r,i,this._transform.clone()),this}roundRect(e,t,r,i,s){return this._tick++,this._activePath.roundRect(e,t,r,i,s,this._transform.clone()),this}poly(e,t){return this._tick++,this._activePath.poly(e,t,this._transform.clone()),this}regularPoly(e,t,r,i,s=0,o){return this._tick++,this._activePath.regularPoly(e,t,r,i,s,o),this}roundPoly(e,t,r,i,s,o){return this._tick++,this._activePath.roundPoly(e,t,r,i,s,o),this}roundShape(e,t,r,i){return this._tick++,this._activePath.roundShape(e,t,r,i),this}filletRect(e,t,r,i,s){return this._tick++,this._activePath.filletRect(e,t,r,i,s),this}chamferRect(e,t,r,i,s,o){return this._tick++,this._activePath.chamferRect(e,t,r,i,s,o),this}star(e,t,r,i,s=0,o=0){return this._tick++,this._activePath.star(e,t,r,i,s,o,this._transform.clone()),this}svg(e){return this._tick++,Q9(e,this),this}restore(){let e=this._stateStack.pop();return e&&(this._transform=e.transform,this._fillStyle=e.fillStyle,this._strokeStyle=e.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(e){return this._transform.rotate(e),this}scale(e,t=e){return this._transform.scale(e,t),this}setTransform(e,t,r,i,s,o){return e instanceof ue?(this._transform.set(e.a,e.b,e.c,e.d,e.tx,e.ty),this):(this._transform.set(e,t,r,i,s,o),this)}transform(e,t,r,i,s,o){return e instanceof ue?(this._transform.append(e),this):(GB.set(e,t,r,i,s,o),this._transform.append(GB),this)}translate(e,t=e){return this._transform.translate(e,t),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;let e=this._bounds;e.clear();for(let t=0;t<this.instructions.length;t++){let r=this.instructions[t],i=r.action;if(i==="fill"){let s=r.data;e.addBounds(s.path.bounds)}else if(i==="texture"){let s=r.data;e.addFrame(s.dx,s.dy,s.dx+s.dw,s.dy+s.dh,s.transform)}if(i==="stroke"){let s=r.data,o=s.style.alignment,a=s.style.width*(1-o),l=s.path.bounds;e.addFrame(l.minX-a,l.minY-a,l.maxX+a,l.maxY+a)}}return e}containsPoint(e){if(!this.bounds.containsPoint(e.x,e.y))return!1;let t=this.instructions,r=!1;for(let i=0;i<t.length;i++){let s=t[i],o=s.data,a=o.path;if(!s.action||!a)continue;let l=o.style,c=a.shapePath.shapePrimitives;for(let u=0;u<c.length;u++){let d=c[u].shape;if(!l||!d)continue;let f=c[u].transform,h=f?f.applyInverse(e,HK):e;if(s.action==="fill")r=d.contains(h.x,h.y);else{let m=l;r=d.strokeContains(h.x,h.y,m.width,m.alignment)}let p=o.hole;if(p){let m=p.shapePath?.shapePrimitives;if(m)for(let g=0;g<m.length;g++)m[g].shape.contains(h.x,h.y)&&(r=!1)}if(r)return!0}}return r}destroy(e=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof e=="boolean"?e:e?.texture){let r=typeof e=="boolean"?e:e?.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(r),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(r)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};HC.defaultFillStyle={color:16777215,alpha:1,texture:re.WHITE,matrix:null,fill:null};HC.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:re.WHITE,matrix:null,fill:null,pixelLine:!1};Wr=HC});function T0(n){let e=[],t=0;for(let r=0;r<$B.length;r++){let i=`_${$B[r]}`;e[t++]=n[i]}return t=zB(n._fill,e,t),t=WK(n._stroke,e,t),t=VK(n.dropShadow,e,t),e.join("-")}function zB(n,e,t){return n&&(e[t++]=n.color,e[t++]=n.alpha,e[t++]=n.fill?.styleKey),t}function WK(n,e,t){return n&&(t=zB(n,e,t),e[t++]=n.width,e[t++]=n.alignment,e[t++]=n.cap,e[t++]=n.join,e[t++]=n.miterLimit),t}function VK(n,e,t){return n&&(e[t++]=n.alpha,e[t++]=n.angle,e[t++]=n.blur,e[t++]=n.distance,e[t++]=ce.shared.setValue(n.color).toNumber()),t}var $B,J9=$(()=>{nn();$B=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"]});function jK(n){let e=n;if(typeof e.dropShadow=="boolean"&&e.dropShadow){let t=dr.defaultDropShadow;n.dropShadow={alpha:e.dropShadowAlpha??t.alpha,angle:e.dropShadowAngle??t.angle,blur:e.dropShadowBlur??t.blur,color:e.dropShadowColor??t.color,distance:e.dropShadowDistance??t.distance}}if(e.strokeThickness!==void 0){oe(Ie,"strokeThickness is now a part of stroke");let t=e.stroke,r={};if(ce.isColorLike(t))r.color=t;else if(t instanceof Mo||t instanceof Ks)r.fill=t;else if(Object.hasOwnProperty.call(t,"color")||Object.hasOwnProperty.call(t,"fill"))r=t;else throw new Error("Invalid stroke value.");n.stroke={...r,width:e.strokeThickness}}if(Array.isArray(e.fillGradientStops)){oe(Ie,"gradient fill is now a fill pattern: `new FillGradient(...)`");let t;n.fontSize==null?n.fontSize=dr.defaultTextStyle.fontSize:typeof n.fontSize=="string"?t=parseInt(n.fontSize,10):t=n.fontSize;let r=new Mo(0,0,0,t*1.7),i=e.fillGradientStops.map(s=>ce.shared.setValue(s).toNumber());i.forEach((s,o)=>{let a=o/(i.length-1);r.addColorStop(a,s)}),n.fill={fill:r}}}var WC,dr,Ia=$(()=>{Nn();nn();zt();v4();w4();pu();Z9();J9();WC=class k0 extends st{constructor(e={}){super(),jK(e);let t={...k0.defaultTextStyle,...e};for(let r in t){let i=r;this[i]=t[r]}this.update()}get align(){return this._align}set align(e){this._align=e,this.update()}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords=e,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){e!==null&&typeof e=="object"?this._dropShadow=this._createProxy({...k0.defaultDropShadow,...e}):this._dropShadow=e?this._createProxy({...k0.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(e){this._fontFamily=e,this.update()}get fontSize(){return this._fontSize}set fontSize(e){typeof e=="string"?this._fontSize=parseInt(e,10):this._fontSize=e,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle=e.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant=e,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight=e,this.update()}get leading(){return this._leading}set leading(e){this._leading=e,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing=e,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight=e,this.update()}get padding(){return this._padding}set padding(e){this._padding=e,this.update()}get trim(){return this._trim}set trim(e){this._trim=e,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline=e,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace=e,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap=e,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth=e,this.update()}get fill(){return this._originalFill}set fill(e){e!==this._originalFill&&(this._originalFill=e,this._isFillStyle(e)&&(this._originalFill=this._createProxy({...Wr.defaultFillStyle,...e},()=>{this._fill=Qs({...this._originalFill},Wr.defaultFillStyle)})),this._fill=Qs(e===0?"black":e,Wr.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(e){e!==this._originalStroke&&(this._originalStroke=e,this._isFillStyle(e)&&(this._originalStroke=this._createProxy({...Wr.defaultStrokeStyle,...e},()=>{this._stroke=Ol({...this._originalStroke},Wr.defaultStrokeStyle)})),this._stroke=Ol(e,Wr.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=T0(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){let e=k0.defaultTextStyle;for(let t in e)this[t]=e[t]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new k0({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(e=!1){if(this.removeAllListeners(),typeof e=="boolean"?e:e?.texture){let r=typeof e=="boolean"?e:e?.textureSource;this._fill?.texture&&this._fill.texture.destroy(r),this._originalFill?.texture&&this._originalFill.texture.destroy(r),this._stroke?.texture&&this._stroke.texture.destroy(r),this._originalStroke?.texture&&this._originalStroke.texture.destroy(r)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(e,t){return new Proxy(e,{set:(r,i,s)=>(r[i]=s,t?.(i,s),this.update(),!0)})}_isFillStyle(e){return(e??null)!==null&&!(ce.isColorLike(e)||e instanceof Mo||e instanceof Ks)}};WC.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};WC.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};dr=WC});function I0(n,e,t,r){let i=XK;i.minX=0,i.minY=0,i.maxX=n.width/r|0,i.maxY=n.height/r|0;let s=rt.getOptimalTexture(i.width,i.height,r,!1);return s.source.uploadMethodId="image",s.source.resource=n,s.source.alphaMode="premultiply-alpha-on-upload",s.frame.width=e/r,s.frame.height=t/r,s.source.emit("update",s.source),s.updateUvs(),s}var XK,e8=$(()=>{Ws();Ln();XK=new Nt});function Pa(n){let e=typeof n.fontSize=="number"?`${n.fontSize}px`:n.fontSize,t=n.fontFamily;Array.isArray(n.fontFamily)||(t=n.fontFamily.split(","));for(let r=t.length-1;r>=0;r--){let i=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!qK.includes(i)&&(i=`"${i}"`),t[r]=i}return`${n.fontStyle} ${n.fontVariant} ${n.fontWeight} ${e} ${t.join(",")}`}var qK,E4=$(()=>{"use strict";qK=["serif","sans-serif","monospace","cursive","fantasy","system-ui"]});var VC,Zs,Ei,T4=$(()=>{Vt();E4();VC={willReadFrequently:!0},Zs=class We{static get experimentalLetterSpacingSupported(){let e=We._experimentalLetterSpacingSupported;if(e!==void 0){let t=Fe.get().getCanvasRenderingContext2D().prototype;e=We._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,r,i,s,o,a,l,c){this.text=e,this.style=t,this.width=r,this.height=i,this.lines=s,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=c}static measureText(e=" ",t,r=We._canvas,i=t.wordWrap){let s=`${e}:${t.styleKey}`;if(We._measurementCache[s])return We._measurementCache[s];let o=Pa(t),a=We.measureFont(o);a.fontSize===0&&(a.fontSize=t.fontSize,a.ascent=t.fontSize);let l=We.__context;l.font=o;let u=(i?We._wordWrap(e,t,r):e).split(/(?:\r\n|\r|\n)/),d=new Array(u.length),f=0;for(let x=0;x<u.length;x++){let b=We._measureText(u[x],t.letterSpacing,l);d[x]=b,f=Math.max(f,b)}let h=t._stroke?.width||0,p=f+h;t.dropShadow&&(p+=t.dropShadow.distance);let m=t.lineHeight||a.fontSize,g=Math.max(m,a.fontSize+h)+(u.length-1)*(m+t.leading);return t.dropShadow&&(g+=t.dropShadow.distance),new We(e,t,p,g,u,d,m+t.leading,f,a)}static _measureText(e,t,r){let i=!1;We.experimentalLetterSpacingSupported&&(We.experimentalLetterSpacing?(r.letterSpacing=`${t}px`,r.textLetterSpacing=`${t}px`,i=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let s=r.measureText(e),o=s.width,a=-s.actualBoundingBoxLeft,c=s.actualBoundingBoxRight-a;if(o>0)if(i)o-=t,c-=t;else{let u=(We.graphemeSegmenter(e).length-1)*t;o+=u,c+=u}return Math.max(o,c)}static _wordWrap(e,t,r=We._canvas){let i=r.getContext("2d",VC),s=0,o="",a="",l=Object.create(null),{letterSpacing:c,whiteSpace:u}=t,d=We._collapseSpaces(u),f=We._collapseNewlines(u),h=!d,p=t.wordWrapWidth+c,m=We._tokenize(e);for(let g=0;g<m.length;g++){let y=m[g];if(We._isNewline(y)){if(!f){a+=We._addLine(o),h=!d,o="",s=0;continue}y=" "}if(d){let b=We.isBreakingSpace(y),_=We.isBreakingSpace(o[o.length-1]);if(b&&_)continue}let x=We._getFromCache(y,c,l,i);if(x>p)if(o!==""&&(a+=We._addLine(o),o="",s=0),We.canBreakWords(y,t.breakWords)){let b=We.wordWrapSplit(y);for(let _=0;_<b.length;_++){let S=b[_],C=S,k=1;for(;b[_+k];){let w=b[_+k];if(!We.canBreakChars(C,w,y,_,t.breakWords))S+=w;else break;C=w,k++}_+=k-1;let v=We._getFromCache(S,c,l,i);v+s>p&&(a+=We._addLine(o),h=!1,o="",s=0),o+=S,s+=v}}else{o.length>0&&(a+=We._addLine(o),o="",s=0);let b=g===m.length-1;a+=We._addLine(y,!b),h=!1,o="",s=0}else x+s>p&&(h=!1,a+=We._addLine(o),o="",s=0),(o.length>0||!We.isBreakingSpace(y)||h)&&(o+=y,s+=x)}return a+=We._addLine(o,!1),a}static _addLine(e,t=!0){return e=We._trimRight(e),e=t?`${e}
`:e,e}static _getFromCache(e,t,r,i){let s=r[e];return typeof s!="number"&&(s=We._measureText(e,t,i)+t,r[e]=s),s}static _collapseSpaces(e){return e==="normal"||e==="pre-line"}static _collapseNewlines(e){return e==="normal"}static _trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){let r=e[t];if(!We.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static _isNewline(e){return typeof e!="string"?!1:We._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:We._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){let t=[],r="";if(typeof e!="string")return t;for(let i=0;i<e.length;i++){let s=e[i],o=e[i+1];if(We.isBreakingSpace(s,o)||We._isNewline(s)){r!==""&&(t.push(r),r=""),t.push(s);continue}r+=s}return r!==""&&t.push(r),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,i,s){return!0}static wordWrapSplit(e){return We.graphemeSegmenter(e)}static measureFont(e){if(We._fonts[e])return We._fonts[e];let t=We._context;t.font=e;let r=t.measureText(We.METRICS_STRING+We.BASELINE_SYMBOL),i={ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,fontSize:r.actualBoundingBoxAscent+r.actualBoundingBoxDescent};return We._fonts[e]=i,i}static clearMetrics(e=""){e?delete We._fonts[e]:We._fonts={}}static get _canvas(){if(!We.__canvas){let e;try{let t=new OffscreenCanvas(0,0);if(t.getContext("2d",VC)?.measureText)return We.__canvas=t,t;e=Fe.get().createCanvas()}catch{e=Fe.get().createCanvas()}e.width=e.height=10,We.__canvas=e}return We.__canvas}static get _context(){return We.__context||(We.__context=We._canvas.getContext("2d",VC)),We.__context}};Zs.METRICS_STRING="|\xC9q\xC5";Zs.BASELINE_SYMBOL="M";Zs.BASELINE_MULTIPLIER=1.4;Zs.HEIGHT_MULTIPLIER=2;Zs.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){let n=new Intl.Segmenter;return e=>[...n.segment(e)].map(t=>t.segment)}return n=>[...n]})();Zs.experimentalLetterSpacing=!1;Zs._fonts={};Zs._newlines=[10,13];Zs._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];Zs._measurementCache={};Ei=Zs});function Ll(n,e){if(n.texture===re.WHITE&&!n.fill)return ce.shared.setValue(n.color).setAlpha(n.alpha??1).toHexa();if(n.fill){if(n.fill instanceof Ks){let t=n.fill,r=e.createPattern(t.texture.source.resource,"repeat"),i=t.transform.copyTo(ue.shared);return i.scale(t.texture.frame.width,t.texture.frame.height),r.setTransform(i),r}else if(n.fill instanceof Mo){let t=n.fill;if(t.type==="linear"){let r=e.createLinearGradient(t.x0,t.y0,t.x1,t.y1);return t.gradientStops.forEach(i=>{r.addColorStop(i.offset,ce.shared.setValue(i.color).toHex())}),r}}}else{let t=e.createPattern(n.texture.source.resource,"repeat"),r=n.matrix.copyTo(ue.shared);return r.scale(n.texture.frame.width,n.texture.frame.height),t.setTransform(r),t}return ve("FillStyle not recognised",n),"red"}var t8=$(()=>{nn();Ct();_t();Gt();v4();w4()});var mu,jC=$(()=>{nn();ee();$2();fu();Ws();CC();zt();Ia();e8();T4();E4();t8();mu=class{constructor(e){this._activeTextures={},this._renderer=e}getTextureSize(e,t,r){let i=Ei.measureText(e||" ",r),s=Math.ceil(Math.ceil(Math.max(1,i.width)+r.padding*2)*t),o=Math.ceil(Math.ceil(Math.max(1,i.height)+r.padding*2)*t);return s=Math.ceil(s-1e-6),o=Math.ceil(o-1e-6),s=wi(s),o=wi(o),{width:s,height:o}}getTexture(e,t,r,i){typeof e=="string"&&(oe("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),e={text:e,style:r,resolution:t}),e.style instanceof dr||(e.style=new dr(e.style));let{texture:s,canvasAndContext:o}=this.createTextureAndCanvas(e);return this._renderer.texture.initSource(s._source),zn.returnCanvasAndContext(o),s}createTextureAndCanvas(e){let{text:t,style:r}=e,i=e.resolution??this._renderer.resolution,s=Ei.measureText(t||" ",r),o=Math.ceil(Math.ceil(Math.max(1,s.width)+r.padding*2)*i),a=Math.ceil(Math.ceil(Math.max(1,s.height)+r.padding*2)*i),l=zn.getOptimalCanvasAndContext(o,a),{canvas:c}=l;this.renderTextToCanvas(t,r,i,l);let u=I0(c,o,a,i);if(r.trim){let d=U9(c,i);u.frame.copyFrom(d),u.updateUvs()}return{texture:u,canvasAndContext:l}}getManagedTexture(e){e._resolution=e._autoResolution?this._renderer.resolution:e.resolution;let t=e._getKey();if(this._activeTextures[t])return this._increaseReferenceCount(t),this._activeTextures[t].texture;let{texture:r,canvasAndContext:i}=this.createTextureAndCanvas(e);return this._activeTextures[t]={canvasAndContext:i,texture:r,usageCount:1},r}_increaseReferenceCount(e){this._activeTextures[e].usageCount++}decreaseReferenceCount(e){let t=this._activeTextures[e];if(t.usageCount--,t.usageCount===0){zn.returnCanvasAndContext(t.canvasAndContext),rt.returnTexture(t.texture);let r=t.texture.source;r.resource=null,r.uploadMethodId="unknown",r.alphaMode="no-premultiply-alpha",this._activeTextures[e]=null}}getReferenceCount(e){return this._activeTextures[e].usageCount}renderTextToCanvas(e,t,r,i){let{canvas:s,context:o}=i,a=Pa(t),l=Ei.measureText(e||" ",t),c=l.lines,u=l.lineHeight,d=l.lineWidths,f=l.maxLineWidth,h=l.fontProperties,p=s.height;if(o.resetTransform(),o.scale(r,r),o.textBaseline=t.textBaseline,t._stroke?.width){let x=t._stroke;o.lineWidth=x.width,o.miterLimit=x.miterLimit,o.lineJoin=x.join,o.lineCap=x.cap}o.font=a;let m,g,y=t.dropShadow?2:1;for(let x=0;x<y;++x){let b=t.dropShadow&&x===0,_=b?Math.ceil(Math.max(1,p)+t.padding*2):0,S=_*r;if(b){o.fillStyle="black",o.strokeStyle="black";let v=t.dropShadow,w=v.color,A=v.alpha;o.shadowColor=ce.shared.setValue(w).setAlpha(A).toRgbaString();let E=v.blur*r,I=v.distance*r;o.shadowBlur=E,o.shadowOffsetX=Math.cos(v.angle)*I,o.shadowOffsetY=Math.sin(v.angle)*I+S}else o.fillStyle=t._fill?Ll(t._fill,o):null,t._stroke?.width&&(o.strokeStyle=Ll(t._stroke,o)),o.shadowColor="black";let C=(u-h.fontSize)/2;u-h.fontSize<0&&(C=0);let k=t._stroke?.width??0;for(let v=0;v<c.length;v++)m=k/2,g=k/2+v*u+h.ascent+C,t.align==="right"?m+=f-d[v]:t.align==="center"&&(m+=(f-d[v])/2),t._stroke?.width&&this._drawLetterSpacing(c[v],t,i,m+t.padding,g+t.padding-_,!0),t._fill!==void 0&&this._drawLetterSpacing(c[v],t,i,m+t.padding,g+t.padding-_)}}_drawLetterSpacing(e,t,r,i,s,o=!1){let{context:a}=r,l=t.letterSpacing,c=!1;if(Ei.experimentalLetterSpacingSupported&&(Ei.experimentalLetterSpacing?(a.letterSpacing=`${l}px`,a.textLetterSpacing=`${l}px`,c=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),l===0||c){o?a.strokeText(e,i,s):a.fillText(e,i,s);return}let u=i,d=Ei.graphemeSegmenter(e),f=a.measureText(e).width,h=0;for(let p=0;p<d.length;++p){let m=d[p];o?a.strokeText(m,u,s):a.fillText(m,u,s);let g="";for(let y=p+1;y<d.length;++y)g+=d[y];h=a.measureText(g).width,u+=f-h+l,f=h}}destroy(){this._activeTextures=null}};mu.extension={type:[z.WebGLSystem,z.WebGPUSystem,z.CanvasSystem],name:"canvasText"}});var XC=$(()=>{ee();SC();jC();ke.add(mu);ke.add(du)});var ze,r8=$(()=>{zt();ko();pu();ze=class n extends Zr{constructor(e){e instanceof Wr&&(e={context:e});let{context:t,roundPixels:r,...i}=e||{};super({label:"Graphics",...i}),this.renderPipeId="graphics",t?this._context=t:this._context=this._ownedContext=new Wr,this._context.on("update",this.onViewUpdate,this),this.allowChildren=!1,this.roundPixels=r??!1}set context(e){e!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=e,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(e){return this._context.containsPoint(e)}destroy(e){this._ownedContext&&!e?this._ownedContext.destroy(e):(e===!0||e?.context===!0)&&this._context.destroy(e),this._ownedContext=null,this._context=null,super.destroy(e)}_callContextMethod(e,t){return this.context[e](...t),this}setFillStyle(...e){return this._callContextMethod("setFillStyle",e)}setStrokeStyle(...e){return this._callContextMethod("setStrokeStyle",e)}fill(...e){return this._callContextMethod("fill",e)}stroke(...e){return this._callContextMethod("stroke",e)}texture(...e){return this._callContextMethod("texture",e)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...e){return this._callContextMethod("arc",e)}arcTo(...e){return this._callContextMethod("arcTo",e)}arcToSvg(...e){return this._callContextMethod("arcToSvg",e)}bezierCurveTo(...e){return this._callContextMethod("bezierCurveTo",e)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...e){return this._callContextMethod("ellipse",e)}circle(...e){return this._callContextMethod("circle",e)}path(...e){return this._callContextMethod("path",e)}lineTo(...e){return this._callContextMethod("lineTo",e)}moveTo(...e){return this._callContextMethod("moveTo",e)}quadraticCurveTo(...e){return this._callContextMethod("quadraticCurveTo",e)}rect(...e){return this._callContextMethod("rect",e)}roundRect(...e){return this._callContextMethod("roundRect",e)}poly(...e){return this._callContextMethod("poly",e)}regularPoly(...e){return this._callContextMethod("regularPoly",e)}roundPoly(...e){return this._callContextMethod("roundPoly",e)}roundShape(...e){return this._callContextMethod("roundShape",e)}filletRect(...e){return this._callContextMethod("filletRect",e)}chamferRect(...e){return this._callContextMethod("chamferRect",e)}star(...e){return this._callContextMethod("star",e)}svg(...e){return this._callContextMethod("svg",e)}restore(...e){return this._callContextMethod("restore",e)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...e){return this._callContextMethod("rotate",e)}scaleTransform(...e){return this._callContextMethod("scale",e)}setTransform(...e){return this._callContextMethod("setTransform",e)}transform(...e){return this._callContextMethod("transform",e)}translateTransform(...e){return this._callContextMethod("translate",e)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(e){this._context.fillStyle=e}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(e){this._context.strokeStyle=e}clone(e=!1){return e?new n(this._context.clone()):(this._ownedContext=null,new n(this._context))}lineStyle(e,t,r){oe(Ie,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");let i={};return e&&(i.width=e),t&&(i.color=t),r&&(i.alpha=r),this.context.strokeStyle=i,this}beginFill(e,t){oe(Ie,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");let r={};return e!==void 0&&(r.color=e),t!==void 0&&(r.alpha=t),this.context.fillStyle=r,this}endFill(){oe(Ie,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();let e=this.context.strokeStyle;return(e.width!==Wr.defaultStrokeStyle.width||e.color!==Wr.defaultStrokeStyle.color||e.alpha!==Wr.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...e){return oe(Ie,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",e)}drawEllipse(...e){return oe(Ie,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",e)}drawPolygon(...e){return oe(Ie,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",e)}drawRect(...e){return oe(Ie,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",e)}drawRoundedRect(...e){return oe(Ie,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",e)}drawStar(...e){return oe(Ie,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",e)}}});var n8,i8,qC=$(()=>{"use strict";n8={name:"local-uniform-msdf-bit",vertex:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32,
                uRound:f32,
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `},fragment:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
         `,main:` 
            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));
        `}},i8={name:"local-uniform-msdf-bit",vertex:{header:`
            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix *= uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `},fragment:{header:`
            uniform float uDistance;
         `,main:` 
            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));
        `}}});var s8,o8,YC=$(()=>{"use strict";s8={name:"msdf-bit",fragment:{header:`
            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {
                
                // MSDF
                var median = msdfColor.r + msdfColor.g + msdfColor.b -
                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));
            
                // SDF
                median = min(median, msdfColor.a);

                var screenPxDistance = distance * (median - 0.5);
                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));
                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);
                var coverage: f32 = pow(shapeColor.a * alpha, gamma);

                return coverage;
             
            }
        `}},o8={name:"msdf-bit",fragment:{header:`
            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {
                
                // MSDF
                float median = msdfColor.r + msdfColor.g + msdfColor.b -
                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));
               
                // SDF
                median = min(median, msdfColor.a);
            
                float screenPxDistance = distance * (median - 0.5);
                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
           
                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));
                float gamma = mix(1.0, 1.0 / 2.2, luma);
                float coverage = pow(shapeColor.a * alpha, gamma);  
              
                return coverage;
            }
        `}}});var KC,QC,P0,ZC=$(()=>{Ct();wl();Aa();n0();i0();Ea();d4();bs();Hr();qC();YC();P0=class extends xr{constructor(){let e=new pt({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new ue,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}}),t=Si();KC??(KC=ms({name:"sdf-shader",bits:[Il,Dl(t),n8,s8,ys]})),QC??(QC=gs({name:"sdf-shader",bits:[Pl,Ml(t),i8,o8,xs]})),super({glProgram:QC,gpuProgram:KC,resources:{localUniforms:e,batchSamplers:Rl(t)}})}}});var Ul,a8=$(()=>{Nn();zt();Ul=class extends st{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return oe(Ie,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return oe(Ie,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return oe(Ie,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return oe(Ie,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return oe(Ie,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners();for(let t in this.chars)this.chars[t].texture?.destroy();this.chars=null,e&&(this.pages.forEach(t=>t.texture.destroy(!0)),this.pages=null)}}});function D0(n){if(n==="")return[];typeof n=="string"&&(n=[n]);let e=[];for(let t=0,r=n.length;t<r;t++){let i=n[t];if(Array.isArray(i)){if(i.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);if(i[0].length===0||i[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");let s=i[0].charCodeAt(0),o=i[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(let a=s,l=o;a<=l;a++)e.push(String.fromCharCode(a))}else e.push(...Array.from(i))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}var l8=$(()=>{"use strict"});var HB,k4,JC=$(()=>{nn();Qr();fu();Jc();_t();zt();T4();E4();t8();Ia();a8();l8();HB=class WB extends Ul{constructor(e){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;let t={...WB.defaultOptions,...e};this._textureSize=t.textureSize,this._mipmap=t.mipmap;let r=t.style.clone();t.overrideFill&&(r._fill.color=16777215,r._fill.alpha=1,r._fill.texture=re.WHITE,r._fill.fill=null),this.applyFillAsTint=t.overrideFill;let i=r.fontSize;r.fontSize=this.baseMeasurementFontSize;let s=Pa(r);t.overrideSize?r._stroke&&(r._stroke.width*=this.baseRenderedFontSize/i):r.fontSize=this.baseRenderedFontSize=i,this._style=r,this._skipKerning=t.skipKerning??!1,this.resolution=t.resolution??1,this._padding=t.padding??4,this.fontMetrics=Ei.measureFont(s),this.lineHeight=r.lineHeight||this.fontMetrics.fontSize||r.fontSize}ensureCharacters(e){let t=D0(e).filter(g=>!this._currentChars.includes(g)).filter((g,y,x)=>x.indexOf(g)===y);if(!t.length)return;this._currentChars=[...this._currentChars,...t];let r;this._currentPageIndex===-1?r=this._nextPage():r=this.pages[this._currentPageIndex];let{canvas:i,context:s}=r.canvasAndContext,o=r.texture.source,a=this._style,l=this._currentX,c=this._currentY,u=this.baseRenderedFontSize/this.baseMeasurementFontSize,d=this._padding*u,f=0,h=!1,p=i.width/this.resolution,m=i.height/this.resolution;for(let g=0;g<t.length;g++){let y=t[g],x=Ei.measureText(y,a,i,!1);x.lineHeight=x.height;let b=x.width*u,_=Math.ceil((a.fontStyle==="italic"?2:1)*b),S=x.height*u,C=_+d*2,k=S+d*2;if(h=!1,y!==`
`&&y!=="\r"&&y!=="	"&&y!==" "&&(h=!0,f=Math.ceil(Math.max(k,f))),l+C>p&&(c+=f,f=k,l=0,c+f>m)){o.update();let w=this._nextPage();i=w.canvasAndContext.canvas,s=w.canvasAndContext.context,o=w.texture.source,c=0}let v=b/u-(a.dropShadow?.distance??0)-(a._stroke?.width??0);if(this.chars[y]={id:y.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:v,kerning:{}},h){this._drawGlyph(s,x,l+d,c+d,u,a);let w=o.width*u,A=o.height*u,E=new $e(l/w*o.width,c/A*o.height,C/w*o.width,k/A*o.height);this.chars[y].texture=new re({source:o,frame:E}),l+=Math.ceil(C)}}o.update(),this._currentX=l,this._currentY=c,this._skipKerning&&this._applyKerning(t,s)}get pageTextures(){return oe(Ie,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(e,t){let r=this._measureCache;for(let i=0;i<e.length;i++){let s=e[i];for(let o=0;o<this._currentChars.length;o++){let a=this._currentChars[o],l=r[s];l||(l=r[s]=t.measureText(s).width);let c=r[a];c||(c=r[a]=t.measureText(a).width);let u=t.measureText(s+a).width,d=u-(l+c);d&&(this.chars[s].kerning[a]=d),u=t.measureText(s+a).width,d=u-(l+c),d&&(this.chars[a].kerning[s]=d)}}}_nextPage(){this._currentPageIndex++;let e=this.resolution,t=zn.getOptimalCanvasAndContext(this._textureSize,this._textureSize,e);this._setupContext(t.context,this._style,e);let r=e*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i=new re({source:new An({resource:t.canvas,resolution:r,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})}),s={canvasAndContext:t,texture:i};return this.pages[this._currentPageIndex]=s,s}_setupContext(e,t,r){t.fontSize=this.baseRenderedFontSize,e.scale(r,r),e.font=Pa(t),t.fontSize=this.baseMeasurementFontSize,e.textBaseline=t.textBaseline;let i=t._stroke,s=i?.width??0;if(i&&(e.lineWidth=s,e.lineJoin=i.join,e.miterLimit=i.miterLimit,e.strokeStyle=Ll(i,e)),t._fill&&(e.fillStyle=Ll(t._fill,e)),t.dropShadow){let o=t.dropShadow,a=ce.shared.setValue(o.color).toArray(),l=o.blur*r,c=o.distance*r;e.shadowColor=`rgba(${a[0]*255},${a[1]*255},${a[2]*255},${o.alpha})`,e.shadowBlur=l,e.shadowOffsetX=Math.cos(o.angle)*c,e.shadowOffsetY=Math.sin(o.angle)*c}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0}_drawGlyph(e,t,r,i,s,o){let a=t.text,l=t.fontProperties,u=(o._stroke?.width??0)*s,d=r+u/2,f=i-u/2,h=l.descent*s,p=t.lineHeight*s;o.stroke&&u&&e.strokeText(a,d,f+p-h),o._fill&&e.fillText(a,d,f+p-h)}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){let{canvasAndContext:t,texture:r}=this.pages[e];zn.returnCanvasAndContext(t),r.destroy(!0)}this.pages=null}};HB.defaultOptions={textureSize:512,style:new dr,mipmap:!0};k4=HB});function M0(n,e,t,r){let i={width:0,height:0,offsetY:0,scale:e.fontSize/t.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};i.offsetY=t.baseLineOffset;let s=i.lines[0],o=null,a=!0,l={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},c=p=>{let m=s.width;for(let g=0;g<l.index;g++){let y=p.positions[g];s.chars.push(p.chars[g]),s.charPositions.push(y+m)}s.width+=p.width,a=!1,l.width=0,l.index=0,l.chars.length=0},u=()=>{let p=s.chars.length-1;if(r){let m=s.chars[p];for(;m===" ";)s.width-=t.chars[m].xAdvance,m=s.chars[--p]}i.width=Math.max(i.width,s.width),s={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,i.lines.push(s),i.height+=t.lineHeight},d=t.baseMeasurementFontSize/e.fontSize,f=e.letterSpacing*d,h=e.wordWrapWidth*d;for(let p=0;p<n.length+1;p++){let m,g=p===n.length;g||(m=n[p]);let y=t.chars[m]||t.chars[" "];if(/(?:\s)/.test(m)||m==="\r"||m===`
`||g){if(!a&&e.wordWrap&&s.width+l.width-f>h?(u(),c(l),g||s.charPositions.push(0)):(l.start=s.width,c(l),g||s.charPositions.push(0)),m==="\r"||m===`
`)s.width!==0&&u();else if(!g){let S=y.xAdvance+(y.kerning[o]||0)+f;s.width+=S,s.spaceWidth=S,s.spacesIndex.push(s.charPositions.length),s.chars.push(m)}}else{let _=y.kerning[o]||0,S=y.xAdvance+_+f;l.positions[l.index++]=l.width+_,l.chars.push(m),l.width+=S}o=m}return u(),e.align==="center"?YK(i):e.align==="right"?KK(i):e.align==="justify"&&QK(i),i}function YK(n){for(let e=0;e<n.lines.length;e++){let t=n.lines[e],r=n.width/2-t.width/2;for(let i=0;i<t.charPositions.length;i++)t.charPositions[i]+=r}}function KK(n){for(let e=0;e<n.lines.length;e++){let t=n.lines[e],r=n.width-t.width;for(let i=0;i<t.charPositions.length;i++)t.charPositions[i]+=r}}function QK(n){let e=n.width;for(let t=0;t<n.lines.length;t++){let r=n.lines[t],i=0,s=r.spacesIndex[i++],o=0,a=r.spacesIndex.length,c=(e-r.width)/a;for(let u=0;u<r.charPositions.length;u++)u===s&&(s=r.spacesIndex[i++],o+=c),r.charPositions[u]+=o}}var c8=$(()=>{"use strict"});var u8,eA,Qi,I4=$(()=>{Io();zt();Gt();Ia();JC();c8();l8();u8=0,eA=class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(e,t){let r=`${t.fontFamily}-bitmap`,i=!0;if(t._fill.fill&&!t._stroke)r+=t._fill.fill.styleKey,i=!1;else if(t._stroke||t.dropShadow){let o=t.styleKey;o=o.substring(0,o.lastIndexOf("-")),r=`${o}-bitmap`,i=!1}if(!kt.has(r)){let o=new k4({style:t,overrideFill:i,overrideSize:!0,...this.defaultOptions});u8++,u8>50&&ve("BitmapText",`You have dynamically created ${u8} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),o.once("destroy",()=>{u8--,kt.remove(r)}),kt.set(r,o)}let s=kt.get(r);return s.ensureCharacters?.(e),s}getLayout(e,t,r=!0){let i=this.getFont(e,t);return M0([...e],t,i,r)}measureText(e,t,r=!0){return this.getLayout(e,t,r)}install(...e){let t=e[0];typeof t=="string"&&(t={name:t,style:e[1],chars:e[2]?.chars,resolution:e[2]?.resolution,padding:e[2]?.padding,skipKerning:e[2]?.skipKerning},oe(Ie,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));let r=t?.name;if(!r)throw new Error("[BitmapFontManager] Property `name` is required.");t={...this.defaultOptions,...t};let i=t.style,s=i instanceof dr?i:new dr(i),o=s._fill.fill!==null&&s._fill.fill!==void 0,a=new k4({style:s,overrideFill:o,skipKerning:t.skipKerning,padding:t.padding,resolution:t.resolution,overrideSize:!1}),l=D0(t.chars);return a.ensureCharacters(l.join("")),kt.set(`${r}-bitmap`,a),a.once("destroy",()=>kt.remove(`${r}-bitmap`)),a}uninstall(e){let t=`${e}-bitmap`,r=kt.get(t);r&&r.destroy()}},Qi=new eA});function VB(n,e){e.groupTransform=n.groupTransform,e.groupColorAlpha=n.groupColorAlpha,e.groupColor=n.groupColor,e.groupBlendMode=n.groupBlendMode,e.globalDisplayStatus=n.globalDisplayStatus,e.groupTransform=n.groupTransform,e.localDisplayStatus=n.localDisplayStatus,e.groupAlpha=n.groupAlpha,e._roundPixels=n._roundPixels}var gu,tA=$(()=>{Io();ee();On();r8();ZC();I4();c8();gu=class{constructor(e){this._gpuBitmapText={},this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(e){let t=this._getGpuBitmapText(e);return e._didTextUpdate&&(e._didTextUpdate=!1,this._updateContext(e,t)),this._renderer.renderPipes.graphics.validateRenderable(t)}addRenderable(e,t){let r=this._getGpuBitmapText(e);VB(e,r),e._didTextUpdate&&(e._didTextUpdate=!1,this._updateContext(e,r)),this._renderer.renderPipes.graphics.addRenderable(r,t),r.context.customShader&&this._updateDistanceField(e)}destroyRenderable(e){e.off("destroyed",this._destroyRenderableBound),this._destroyRenderableByUid(e.uid)}_destroyRenderableByUid(e){let t=this._gpuBitmapText[e].context;t.customShader&&(Ze.return(t.customShader),t.customShader=null),Ze.return(this._gpuBitmapText[e]),this._gpuBitmapText[e]=null}updateRenderable(e){let t=this._getGpuBitmapText(e);VB(e,t),this._renderer.renderPipes.graphics.updateRenderable(t),t.context.customShader&&this._updateDistanceField(e)}_updateContext(e,t){let{context:r}=t,i=Qi.getFont(e.text,e._style);r.clear(),i.distanceField.type!=="none"&&(r.customShader||(r.customShader=Ze.get(P0)));let s=Array.from(e.text),o=e._style,a=i.baseLineOffset,l=M0(s,o,i,!0),c=0,u=o.padding,d=l.scale,f=l.width,h=l.height+l.offsetY;o._stroke&&(f+=o._stroke.width/d,h+=o._stroke.width/d),r.translate(-e._anchor._x*f-u,-e._anchor._y*h-u).scale(d,d);let p=i.applyFillAsTint?o._fill.color:16777215;for(let m=0;m<l.lines.length;m++){let g=l.lines[m];for(let y=0;y<g.charPositions.length;y++){let x=s[c++],b=i.chars[x];b?.texture&&r.texture(b.texture,p||"black",Math.round(g.charPositions[y]+b.xOffset),Math.round(a+b.yOffset))}a+=i.lineHeight}}_getGpuBitmapText(e){return this._gpuBitmapText[e.uid]||this.initGpuText(e)}initGpuText(e){let t=Ze.get(ze);return this._gpuBitmapText[e.uid]=t,this._updateContext(e,t),e.on("destroyed",this._destroyRenderableBound),this._gpuBitmapText[e.uid]}_updateDistanceField(e){let t=this._getGpuBitmapText(e).context,r=e._style.fontFamily,i=kt.get(`${r}-bitmap`),{a:s,b:o,c:a,d:l}=e.groupTransform,c=Math.sqrt(s*s+o*o),u=Math.sqrt(a*a+l*l),d=(Math.abs(c)+Math.abs(u))/2,f=i.baseRenderedFontSize/e._style.fontSize,h=d*i.distanceField.range*(1/f);t.customShader.resources.localUniforms.uniforms.uDistance=h}destroy(){for(let e in this._gpuBitmapText)this._destroyRenderableByUid(e);this._gpuBitmapText=null,this._renderer=null}};gu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"bitmapText"}});var rA=$(()=>{ee();tA();ke.add(gu)});var yu,nA=$(()=>{ee();_t();Jh();On();_0();yu=class{constructor(e){this._gpuText=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.runners.resolutionChange.add(this),this._renderer.renderableGC.addManagedHash(this,"_gpuText")}resolutionChange(){for(let e in this._gpuText){let t=this._gpuText[e];if(!t)continue;let r=t.batchableSprite.renderable;r._autoResolution&&(r._resolution=this._renderer.resolution,r.onViewUpdate())}}validateRenderable(e){let t=this._getGpuText(e),r=e._getKey();return t.textureNeedsUploading?(t.textureNeedsUploading=!1,!0):t.currentKey!==r}addRenderable(e,t){let i=this._getGpuText(e).batchableSprite;e._didTextUpdate&&this._updateText(e),this._renderer.renderPipes.batch.addToBatch(i,t)}updateRenderable(e){let r=this._getGpuText(e).batchableSprite;e._didTextUpdate&&this._updateText(e),r._batcher.updateElement(r)}destroyRenderable(e){e.off("destroyed",this._destroyRenderableBound),this._destroyRenderableById(e.uid)}_destroyRenderableById(e){let t=this._gpuText[e];this._renderer.htmlText.decreaseReferenceCount(t.currentKey),Ze.return(t.batchableSprite),this._gpuText[e]=null}_updateText(e){let t=e._getKey(),r=this._getGpuText(e),i=r.batchableSprite;r.currentKey!==t&&this._updateGpuText(e).catch(o=>{console.error(o)}),e._didTextUpdate=!1;let s=e._style.padding;Sa(i.bounds,e._anchor,i.texture,s)}async _updateGpuText(e){e._didTextUpdate=!1;let t=this._getGpuText(e);if(t.generatingTexture)return;let r=e._getKey();this._renderer.htmlText.decreaseReferenceCount(t.currentKey),t.generatingTexture=!0,t.currentKey=r;let i=e.resolution??this._renderer.resolution,s=await this._renderer.htmlText.getManagedTexture(e.text,i,e._style,e._getKey()),o=t.batchableSprite;o.texture=t.texture=s,t.generatingTexture=!1,t.textureNeedsUploading=!0,e.onViewUpdate();let a=e._style.padding;Sa(o.bounds,e._anchor,o.texture,a)}_getGpuText(e){return this._gpuText[e.uid]||this.initGpuText(e)}initGpuText(e){let t={texture:re.EMPTY,currentKey:"--",batchableSprite:Ze.get(ws),textureNeedsUploading:!1,generatingTexture:!1},r=t.batchableSprite;return r.renderable=e,r.transform=e.groupTransform,r.texture=re.EMPTY,r.bounds={minX:0,maxX:1,minY:0,maxY:0},r.roundPixels=this._renderer._roundPixels|e._roundPixels,e._resolution=e._autoResolution?this._renderer.resolution:e.resolution,this._gpuText[e.uid]=t,e.on("destroyed",this._destroyRenderableBound),t}destroy(){for(let e in this._gpuText)this._destroyRenderableById(e);this._gpuText=null,this._renderer=null}};yu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"htmlText"}});function d8(){let{userAgent:n}=Fe.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(n)}var iA=$(()=>{Vt()});var f8,h8,Gl,p8=$(()=>{"use strict";f8="http://www.w3.org/2000/svg",h8="http://www.w3.org/1999/xhtml",Gl=class{constructor(){this.svgRoot=document.createElementNS(f8,"svg"),this.foreignObject=document.createElementNS(f8,"foreignObject"),this.domElement=document.createElementNS(h8,"div"),this.styleElement=document.createElementNS(h8,"style"),this.image=new Image;let{foreignObject:e,svgRoot:t,styleElement:r,domElement:i}=this;e.setAttribute("width","10000"),e.setAttribute("height","10000"),e.style.overflow="hidden",t.appendChild(e),e.appendChild(r),e.appendChild(i)}}});function m8(n){let e=n._stroke,t=n._fill,i=[`div { ${[`color: ${ce.shared.setValue(t.color).toHex()}`,`font-size: ${n.fontSize}px`,`font-family: ${n.fontFamily}`,`font-weight: ${n.fontWeight}`,`font-style: ${n.fontStyle}`,`font-variant: ${n.fontVariant}`,`letter-spacing: ${n.letterSpacing}px`,`text-align: ${n.align}`,`padding: ${n.padding}px`,`white-space: ${n.whiteSpace==="pre"&&n.wordWrap?"pre-wrap":n.whiteSpace}`,...n.lineHeight?[`line-height: ${n.lineHeight}px`]:[],...n.wordWrap?[`word-wrap: ${n.breakWords?"break-all":"break-word"}`,`max-width: ${n.wordWrapWidth}px`]:[],...e?[YB(e)]:[],...n.dropShadow?[qB(n.dropShadow)]:[],...n.cssOverrides].join(";")} }`];return ZK(n.tagStyles,i),i.join(" ")}function qB(n){let e=ce.shared.setValue(n.color).setAlpha(n.alpha).toHexa(),t=Math.round(Math.cos(n.angle)*n.distance),r=Math.round(Math.sin(n.angle)*n.distance),i=`${t}px ${r}px`;return n.blur>0?`text-shadow: ${i} ${n.blur}px ${e}`:`text-shadow: ${i} ${e}`}function YB(n){return[`-webkit-text-stroke-width: ${n.width}px`,`-webkit-text-stroke-color: ${ce.shared.setValue(n.color).toHex()}`,`text-stroke-width: ${n.width}px`,`text-stroke-color: ${ce.shared.setValue(n.color).toHex()}`,"paint-order: stroke"].join(";")}function ZK(n,e){for(let t in n){let r=n[t],i=[];for(let s in r)XB[s]?i.push(XB[s](r[s])):jB[s]&&i.push(jB[s].replace("{{VALUE}}",r[s]));e.push(`${t} { ${i.join(";")} }`)}}var jB,XB,sA=$(()=>{nn();jB={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},XB={fill:n=>`color: ${ce.shared.setValue(n).toHex()}`,breakWords:n=>`word-wrap: ${n?"break-all":"break-word"}`,stroke:YB,dropShadow:qB}});var Js,P4=$(()=>{Gt();Ia();J9();sA();Js=class n extends dr{constructor(e={}){super(e),this._cssOverrides=[],this.cssOverrides??(this.cssOverrides=e.cssOverrides),this.tagStyles=e.tagStyles??{}}set cssOverrides(e){this._cssOverrides=e instanceof Array?e:[e],this.update()}get cssOverrides(){return this._cssOverrides}_generateKey(){return this._styleKey=T0(this)+this._cssOverrides.join("-"),this._styleKey}update(){this._cssStyle=null,super.update()}clone(){return new n({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?{...this.dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides})}get cssStyle(){return this._cssStyle||(this._cssStyle=m8(this)),this._cssStyle}addOverride(...e){let t=e.filter(r=>!this.cssOverrides.includes(r));t.length>0&&(this.cssOverrides.push(...t),this.update())}removeOverride(...e){let t=e.filter(r=>this.cssOverrides.includes(r));t.length>0&&(this.cssOverrides=this.cssOverrides.filter(r=>!t.includes(r)),this.update())}set fill(e){typeof e!="string"&&typeof e!="number"&&ve("[HTMLTextStyle] only color fill is not supported by HTMLText"),super.fill=e}set stroke(e){e&&typeof e!="string"&&typeof e!="number"&&ve("[HTMLTextStyle] only color stroke is not supported by HTMLText"),super.stroke=e}}});function g8(n,e){let t=e.fontFamily,r=[],i={},s=/font-family:([^;"\s]+)/g,o=n.match(s);function a(l){i[l]||(r.push(l),i[l]=!0)}if(Array.isArray(t))for(let l=0;l<t.length;l++)a(t[l]);else a(t);o&&o.forEach(l=>{let c=l.split(":")[1].trim();a(c)});for(let l in e.tagStyles){let c=e.tagStyles[l].fontFamily;a(c)}return r}var oA=$(()=>{"use strict"});async function y8(n){let t=await(await Fe.get().fetch(n)).blob(),r=new FileReader;return await new Promise((s,o)=>{r.onloadend=()=>s(r.result),r.onerror=o,r.readAsDataURL(t)})}var aA=$(()=>{Vt()});async function D4(n,e){let t=await y8(e);return`@font-face {
        font-family: "${n.fontFamily}";
        src: url('${t}');
        font-weight: ${n.fontWeight};
        font-style: ${n.fontStyle};
    }`}var lA=$(()=>{aA()});async function x8(n,e,t){let r=n.filter(i=>kt.has(`${i}-and-url`)).map((i,s)=>{if(!R0.has(i)){let{url:o}=kt.get(`${i}-and-url`);s===0?R0.set(i,D4({fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:i},o)):R0.set(i,D4({fontWeight:t.fontWeight,fontStyle:t.fontStyle,fontFamily:i},o))}return R0.get(i)});return(await Promise.all(r)).join(`
`)}var R0,cA=$(()=>{Io();lA();R0=new Map});function b8(n,e,t,r,i){let{domElement:s,styleElement:o,svgRoot:a}=i;s.innerHTML=`<style>${e.cssStyle}</style><div style='padding:0;'>${n}</div>`,s.setAttribute("style",`transform: scale(${t});transform-origin: top left; display: inline-block`),o.textContent=r;let{width:l,height:c}=i.image;return a.setAttribute("width",l.toString()),a.setAttribute("height",c.toString()),new XMLSerializer().serializeToString(a)}var uA=$(()=>{"use strict"});function _8(n,e){let t=zn.getOptimalCanvasAndContext(n.width,n.height,e),{context:r}=t;return r.clearRect(0,0,n.width,n.height),r.drawImage(n,0,0),t}var dA=$(()=>{fu()});function v8(n,e,t){return new Promise(async r=>{t&&await new Promise(i=>setTimeout(i,100)),n.onload=()=>{r()},n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(e)}`,n.crossOrigin="anonymous"})}var fA=$(()=>{"use strict"});function F0(n,e,t,r){r||(r=KB||(KB=new Gl));let{domElement:i,styleElement:s,svgRoot:o}=r;i.innerHTML=`<style>${e.cssStyle};</style><div style='padding:0'>${n}</div>`,i.setAttribute("style","transform-origin: top left; display: inline-block"),t&&(s.textContent=t),document.body.appendChild(o);let a=i.getBoundingClientRect();o.remove();let l=e.padding*2;return{width:a.width-l,height:a.height-l}}var KB,w8=$(()=>{p8()});var $l,hA=$(()=>{ee();fu();Ws();Yi();iA();Gt();On();e8();p8();P4();oA();cA();uA();dA();fA();w8();$l=class{constructor(e){this._activeTextures={},this._renderer=e,this._createCanvas=e.type===Bt.WEBGPU}getTexture(e){return this._buildTexturePromise(e.text,e.resolution,e.style)}getManagedTexture(e,t,r,i){if(this._activeTextures[i])return this._increaseReferenceCount(i),this._activeTextures[i].promise;let s=this._buildTexturePromise(e,t,r).then(o=>(this._activeTextures[i].texture=o,o));return this._activeTextures[i]={texture:null,promise:s,usageCount:1},s}async _buildTexturePromise(e,t,r){let i=Ze.get(Gl),s=g8(e,r),o=await x8(s,r,Js.defaultTextStyle),a=F0(e,r,o,i),l=Math.ceil(Math.ceil(Math.max(1,a.width)+r.padding*2)*t),c=Math.ceil(Math.ceil(Math.max(1,a.height)+r.padding*2)*t),u=i.image,d=2;u.width=(l|0)+d,u.height=(c|0)+d;let f=b8(e,r,t,o,i);await v8(u,f,d8()&&s.length>0);let h=u,p;this._createCanvas&&(p=_8(u,t));let m=I0(p?p.canvas:h,u.width-d,u.height-d,t);return this._createCanvas&&(this._renderer.texture.initSource(m.source),zn.returnCanvasAndContext(p)),Ze.return(i),m}_increaseReferenceCount(e){this._activeTextures[e].usageCount++}decreaseReferenceCount(e){let t=this._activeTextures[e];t&&(t.usageCount--,t.usageCount===0&&(t.texture?this._cleanUp(t):t.promise.then(r=>{t.texture=r,this._cleanUp(t)}).catch(()=>{ve("HTMLTextSystem: Failed to clean texture")}),this._activeTextures[e]=null))}_cleanUp(e){rt.returnTexture(e.texture),e.texture.source.resource=null,e.texture.source.uploadMethodId="unknown"}getReferenceCount(e){return this._activeTextures[e].usageCount}destroy(){this._activeTextures=null}};$l.extension={type:[z.WebGLSystem,z.WebGPUSystem,z.CanvasSystem],name:"htmlText"};$l.defaultFontOptions={fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal"}});var pA=$(()=>{ee();nA();hA();ke.add($l);ke.add(yu)});var QB,en,Da=$(()=>{Po();qs();Al();zt();QB=class ZB extends Gn{constructor(...e){let t=e[0]??{};t instanceof Float32Array&&(oe(Ie,"use new MeshGeometry({ positions, uvs, indices }) instead"),t={positions:t,uvs:e[1],indices:e[2]}),t={...ZB.defaultOptions,...t};let r=t.positions||new Float32Array([0,0,1,0,1,1,0,1]),i=t.uvs||new Float32Array([0,0,1,0,1,1,0,1]),s=t.indices||new Uint32Array([0,1,2,0,2,3]),o=t.shrinkBuffersToFit,a=new ar({data:r,label:"attribute-mesh-positions",shrinkToFit:o,usage:nt.VERTEX|nt.COPY_DST}),l=new ar({data:i,label:"attribute-mesh-uvs",shrinkToFit:o,usage:nt.VERTEX|nt.COPY_DST}),c=new ar({data:s,label:"index-mesh-buffer",shrinkToFit:o,usage:nt.INDEX|nt.COPY_DST});super({attributes:{aPosition:{buffer:a,format:"float32x2",stride:2*4,offset:0},aUV:{buffer:l,format:"float32x2",stride:2*4,offset:0}},indexBuffer:c,topology:t.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(e){this.attributes.aPosition.buffer.data=e}get uvs(){return this.attributes.aUV.buffer.data}set uvs(e){this.attributes.aUV.buffer.data=e}get indices(){return this.indexBuffer.data}set indices(e){this.indexBuffer.data=e}};QB.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};en=QB});var Ma,S8,zl,xu=$(()=>{"use strict";Ma={name:"local-uniform-bit",vertex:{header:`

            struct LocalUniforms {
                uTransformMatrix:mat3x3<f32>,
                uColor:vec4<f32>,
                uRound:f32,
            }

            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `}},S8={...Ma,vertex:{...Ma.vertex,header:Ma.vertex.header.replace("group(1)","group(2)")}},zl={name:"local-uniform-bit",vertex:{header:`

            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix = uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `}}});var C8,A8,mA=$(()=>{"use strict";C8={name:"tiling-bit",vertex:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`
            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;

            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;
        `},fragment:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`

            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);
            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;
            var unclamped = coord;
            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);

            var bias = 0.;

            if(unclamped.x == coord.x && unclamped.y == coord.y)
            {
                bias = -32.;
            } 

            outColor = textureSampleBias(uTexture, uSampler, coord, bias);
        `}},A8={name:"tiling-bit",vertex:{header:`
            uniform mat3 uTextureTransform;
            uniform vec4 uSizeAnchor;
        
        `,main:`
            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;

            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;
        `},fragment:{header:`
            uniform sampler2D uTexture;
            uniform mat3 uMapCoord;
            uniform vec4 uClampFrame;
            uniform vec2 uClampOffset;
        `,main:`

        vec2 coord = vUV + ceil(uClampOffset - vUV);
        coord = (uMapCoord * vec3(coord, 1.0)).xy;
        vec2 unclamped = coord;
        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);
        
        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0
    
        `}}});var gA,yA,B0,xA=$(()=>{Ct();Aa();xu();Ea();bs();Hr();_t();mA();B0=class extends xr{constructor(){gA??(gA=ms({name:"tiling-sprite-shader",bits:[Ma,C8,ys]})),yA??(yA=gs({name:"tiling-sprite-shader",bits:[zl,A8,xs]}));let e=new pt({uMapCoord:{value:new ue,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new ue,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:yA,gpuProgram:gA,resources:{localUniforms:new pt({uTransformMatrix:{value:new ue,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:e,uTexture:re.EMPTY.source,uSampler:re.EMPTY.source.style}})}updateUniforms(e,t,r,i,s,o){let a=this.resources.tilingUniforms,l=o.width,c=o.height,u=o.textureMatrix,d=a.uniforms.uTextureTransform;d.set(r.a*l/e,r.b*l/t,r.c*c/e,r.d*c/t,r.tx/e,r.ty/t),d.invert(),a.uniforms.uMapCoord=u.mapCoord,a.uniforms.uClampFrame=u.uClampFrame,a.uniforms.uClampOffset=u.uClampOffset,a.uniforms.uTextureTransform=d,a.uniforms.uSizeAnchor[0]=e,a.uniforms.uSizeAnchor[1]=t,a.uniforms.uSizeAnchor[2]=i,a.uniforms.uSizeAnchor[3]=s,o&&(this.resources.uTexture=o.source,this.resources.uSampler=o.source.style)}}});var N0,bA=$(()=>{Da();N0=class extends en{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}});function E8(n,e){let t=n.anchor.x,r=n.anchor.y;e[0]=-t*n.width,e[1]=-r*n.height,e[2]=(1-t)*n.width,e[3]=-r*n.height,e[4]=(1-t)*n.width,e[5]=(1-r)*n.height,e[6]=-t*n.width,e[7]=(1-r)*n.height}var _A=$(()=>{"use strict"});function T8(n,e,t,r){let i=0,s=n.length/(e||2),o=r.a,a=r.b,l=r.c,c=r.d,u=r.tx,d=r.ty;for(t*=e;i<s;){let f=n[t],h=n[t+1];n[t]=o*f+l*h+u,n[t+1]=a*f+c*h+d,t+=e,i++}}var vA=$(()=>{"use strict"});function k8(n,e){let t=n.texture,r=t.frame.width,i=t.frame.height,s=0,o=0;n.applyAnchorToTexture&&(s=n.anchor.x,o=n.anchor.y),e[0]=e[6]=-s,e[2]=e[4]=1-s,e[1]=e[3]=-o,e[5]=e[7]=1-o;let a=ue.shared;a.copyFrom(n._tileTransform.matrix),a.tx/=n.width,a.ty/=n.height,a.invert(),a.scale(n.width/r,n.height/i),T8(e,2,0,a)}var wA=$(()=>{Ct();vA()});var I8,bu,SA=$(()=>{ee();Z2();Ki();Yi();ou();y4();Da();xA();bA();_A();wA();I8=new N0,bu=class{constructor(e){this._state=ur.default2d,this._tilingSpriteDataHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_tilingSpriteDataHash")}validateRenderable(e){let t=this._getTilingSpriteData(e),r=t.canBatch;this._updateCanBatch(e);let i=t.canBatch;if(i&&i===r){let{batchableMesh:s}=t;return!s._batcher.checkAndUpdateTexture(s,e.texture)}return r!==i}addRenderable(e,t){let r=this._renderer.renderPipes.batch;this._updateCanBatch(e);let i=this._getTilingSpriteData(e),{geometry:s,canBatch:o}=i;if(o){i.batchableMesh||(i.batchableMesh=new Do);let a=i.batchableMesh;e.didViewUpdate&&(this._updateBatchableMesh(e),a.geometry=s,a.renderable=e,a.transform=e.groupTransform,a.texture=e._texture),a.roundPixels=this._renderer._roundPixels|e._roundPixels,r.addToBatch(a,t)}else r.break(t),i.shader||(i.shader=new B0),this.updateRenderable(e),t.add(e)}execute(e){let{shader:t}=this._tilingSpriteDataHash[e.uid];t.groups[0]=this._renderer.globalUniforms.bindGroup;let r=t.resources.localUniforms.uniforms;r.uTransformMatrix=e.groupTransform,r.uRound=this._renderer._roundPixels|e._roundPixels,vs(e.groupColorAlpha,r.uColor,0),this._state.blendMode=Xs(e.groupBlendMode,e.texture._source),this._renderer.encoder.draw({geometry:I8,shader:t,state:this._state})}updateRenderable(e){let t=this._getTilingSpriteData(e),{canBatch:r}=t;if(r){let{batchableMesh:i}=t;e.didViewUpdate&&this._updateBatchableMesh(e),i._batcher.updateElement(i)}else if(e.didViewUpdate){let{shader:i}=t;i.updateUniforms(e.width,e.height,e._tileTransform.matrix,e.anchor.x,e.anchor.y,e.texture)}}destroyRenderable(e){let t=this._getTilingSpriteData(e);t.batchableMesh=null,t.shader?.destroy(),this._tilingSpriteDataHash[e.uid]=null,e.off("destroyed",this._destroyRenderableBound)}_getTilingSpriteData(e){return this._tilingSpriteDataHash[e.uid]||this._initTilingSpriteData(e)}_initTilingSpriteData(e){let t=new en({indices:I8.indices,positions:I8.positions.slice(),uvs:I8.uvs.slice()});return this._tilingSpriteDataHash[e.uid]={canBatch:!0,renderable:e,geometry:t},e.on("destroyed",this._destroyRenderableBound),this._tilingSpriteDataHash[e.uid]}_updateBatchableMesh(e){let t=this._getTilingSpriteData(e),{geometry:r}=t,i=e.texture.source.style;i.addressMode!=="repeat"&&(i.addressMode="repeat",i.update()),k8(e,r.uvs),E8(e,r.positions)}destroy(){for(let e in this._tilingSpriteDataHash)this.destroyRenderable(this._tilingSpriteDataHash[e].renderable);this._tilingSpriteDataHash=null,this._renderer=null}_updateCanBatch(e){let t=this._getTilingSpriteData(e),r=e.texture,i=!0;return this._renderer.type===Bt.WEBGL&&(i=this._renderer.context.supports.nonPowOf2wrapping),t.canBatch=r.textureMatrix.isSimple&&(i||r.source.isPowerOfTwo),t.canBatch}};bu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"tilingSprite"}});var CA=$(()=>{ee();SA();ke.add(bu)});var JB,Hl,M4=$(()=>{zt();Da();JB=class eN extends en{constructor(...e){super({});let t=e[0]??{};typeof t=="number"&&(oe(Ie,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),t={width:t,height:e[1],verticesX:e[2],verticesY:e[3]}),this.build(t)}build(e){e={...eN.defaultOptions,...e},this.verticesX=this.verticesX??e.verticesX,this.verticesY=this.verticesY??e.verticesY,this.width=this.width??e.width,this.height=this.height??e.height;let t=this.verticesX*this.verticesY,r=[],i=[],s=[],o=this.verticesX-1,a=this.verticesY-1,l=this.width/o,c=this.height/a;for(let d=0;d<t;d++){let f=d%this.verticesX,h=d/this.verticesX|0;r.push(f*l,h*c),i.push(f/o,h/a)}let u=o*a;for(let d=0;d<u;d++){let f=d%o,h=d/o|0,p=h*this.verticesX+f,m=h*this.verticesX+f+1,g=(h+1)*this.verticesX+f,y=(h+1)*this.verticesX+f+1;s.push(p,m,g,m,y,g)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint32Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};JB.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};Hl=JB});var tN,eo,P8=$(()=>{M4();tN=class rN extends Hl{constructor(e={}){e={...rN.defaultOptions,...e},super({width:e.width,height:e.height,verticesX:4,verticesY:4}),this.update(e)}update(e){this.width=e.width??this.width,this.height=e.height??this.height,this._originalWidth=e.originalWidth??this._originalWidth,this._originalHeight=e.originalHeight??this._originalHeight,this._leftWidth=e.leftWidth??this._leftWidth,this._rightWidth=e.rightWidth??this._rightWidth,this._topHeight=e.topHeight??this._topHeight,this._bottomHeight=e.bottomHeight??this._bottomHeight,this.updateUvs(),this.updatePositions()}updatePositions(){let e=this.positions,t=this._leftWidth+this._rightWidth,r=this.width>t?1:this.width/t,i=this._topHeight+this._bottomHeight,s=this.height>i?1:this.height/i,o=Math.min(r,s);e[9]=e[11]=e[13]=e[15]=this._topHeight*o,e[17]=e[19]=e[21]=e[23]=this.height-this._bottomHeight*o,e[25]=e[27]=e[29]=e[31]=this.height,e[2]=e[10]=e[18]=e[26]=this._leftWidth*o,e[4]=e[12]=e[20]=e[28]=this.width-this._rightWidth*o,e[6]=e[14]=e[22]=e[30]=this.width,this.getBuffer("aPosition").update()}updateUvs(){let e=this.uvs;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1;let t=1/this._originalWidth,r=1/this._originalHeight;e[2]=e[10]=e[18]=e[26]=t*this._leftWidth,e[9]=e[11]=e[13]=e[15]=r*this._topHeight,e[4]=e[12]=e[20]=e[28]=1-t*this._rightWidth,e[17]=e[19]=e[21]=e[23]=1-r*this._bottomHeight,this.getBuffer("aUV").update()}};tN.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};eo=tN});var _u,AA=$(()=>{ee();On();y4();P8();_u=class{constructor(e){this._gpuSpriteHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_gpuSpriteHash")}addRenderable(e,t){let r=this._getGpuSprite(e);e.didViewUpdate&&this._updateBatchableSprite(e,r),this._renderer.renderPipes.batch.addToBatch(r,t)}updateRenderable(e){let t=this._gpuSpriteHash[e.uid];e.didViewUpdate&&this._updateBatchableSprite(e,t),t._batcher.updateElement(t)}validateRenderable(e){let t=this._getGpuSprite(e);return!t._batcher.checkAndUpdateTexture(t,e._texture)}destroyRenderable(e){let t=this._gpuSpriteHash[e.uid];Ze.return(t.geometry),Ze.return(t),this._gpuSpriteHash[e.uid]=null,e.off("destroyed",this._destroyRenderableBound)}_updateBatchableSprite(e,t){t.geometry.update(e),t.texture=e._texture}_getGpuSprite(e){return this._gpuSpriteHash[e.uid]||this._initGPUSprite(e)}_initGPUSprite(e){let t=Ze.get(Do);return t.geometry=Ze.get(eo),t.renderable=e,t.transform=e.groupTransform,t.texture=e._texture,t.roundPixels=this._renderer._roundPixels|e._roundPixels,this._gpuSpriteHash[e.uid]=t,e.didViewUpdate||this._updateBatchableSprite(e,t),e.on("destroyed",this._destroyRenderableBound),t}destroy(){for(let e in this._gpuSpriteHash)this._gpuSpriteHash[e].geometry.destroy();this._gpuSpriteHash=null,this._renderer=null}};_u.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"nineSliceSprite"}});var EA=$(()=>{ee();AA();ke.add(_u)});var vu,TA=$(()=>{ee();vu=class{constructor(e){this._renderer=e}push(e,t,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:t,filterEffect:e})}pop(e,t,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(e){e.action==="pushFilter"?this._renderer.filter.push(e):e.action==="popFilter"&&this._renderer.filter.pop()}destroy(){this._renderer=null}};vu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"filter"}});function D8(n,e){e.clear(),M8(n,e),e.isValid||e.set(0,0,0,0);let t=n.renderGroup||n.parentRenderGroup;return e.applyMatrix(t.worldTransform),e}function M8(n,e){if(n.localDisplayStatus!==7||!n.measurable)return;let t=!!n.effects.length,r=e;if((n.renderGroup||t)&&(r=ii.get().clear()),n.boundsArea)e.addRect(n.boundsArea,n.worldTransform);else{if(n.renderPipeId){let s=n.bounds;r.addFrame(s.minX,s.minY,s.maxX,s.maxY,n.groupTransform)}let i=n.children;for(let s=0;s<i.length;s++)M8(i[s],r)}if(t){let i=!1,s=n.renderGroup||n.parentRenderGroup;for(let o=0;o<n.effects.length;o++)n.effects[o].addBounds&&(i||(i=!0,r.applyMatrix(s.worldTransform)),n.effects[o].addBounds(r,!0));i&&(r.applyMatrix(s.worldTransform.copyTo(JK).invert()),e.addBounds(r,n.relativeGroupTransform)),e.addBounds(r),ii.return(r)}else n.renderGroup&&(e.addBounds(r,n.relativeGroupTransform),ii.return(r))}var JK,kA=$(()=>{Ct();ll();JK=new ue});function R8(n,e){e.clear();let t=e.matrix;for(let r=0;r<n.length;r++){let i=n[r];i.globalDisplayStatus<7||(e.matrix=i.worldTransform,e.addBounds(i.bounds))}return e.matrix=t,e}var IA=$(()=>{"use strict"});var eQ,wu,PA=$(()=>{ee();Ct();vi();Ca();Al();Hr();_t();Ws();Yi();Ln();kA();IA();Gt();eQ=new Gn({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:2*4,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])}),wu=class{constructor(e){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new pt({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new Jr({}),this.renderer=e}get activeBackTexture(){return this._activeFilterData?.backTexture}push(e){let t=this.renderer,r=e.filterEffect.filters;this._filterStack[this._filterStackIndex]||(this._filterStack[this._filterStackIndex]=this._getFilterData());let i=this._filterStack[this._filterStackIndex];if(this._filterStackIndex++,r.length===0){i.skip=!0;return}let s=i.bounds;if(e.renderables?R8(e.renderables,s):e.filterEffect.filterArea?(s.clear(),s.addRect(e.filterEffect.filterArea),s.applyMatrix(e.container.worldTransform)):D8(e.container,s),e.container){let p=(e.container.renderGroup||e.container.parentRenderGroup).cacheToLocalTransform;p&&s.applyMatrix(p)}let o=t.renderTarget.renderTarget.colorTexture.source,a=1/0,l=0,c=!0,u=!1,d=!1,f=!0;for(let h=0;h<r.length;h++){let p=r[h];if(a=Math.min(a,p.resolution==="inherit"?o._resolution:p.resolution),l+=p.padding,p.antialias==="off"?c=!1:p.antialias==="inherit"&&c&&(c=o.antialias),p.clipToViewport||(f=!1),!!!(p.compatibleRenderers&t.type)){d=!1;break}if(p.blendRequired&&!(t.backBuffer?.useBackBuffer??!0)){ve("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),d=!1;break}d=p.enabled||d,u||(u=p.blendRequired)}if(!d){i.skip=!0;return}if(f){let h=t.renderTarget.rootViewPort,p=t.renderTarget.renderTarget.resolution;s.fitBounds(0,h.width/p,0,h.height/p)}if(s.scale(a).ceil().scale(1/a).pad(l|0),!s.isPositive){i.skip=!0;return}i.skip=!1,i.bounds=s,i.blendRequired=u,i.container=e.container,i.filterEffect=e.filterEffect,i.previousRenderSurface=t.renderTarget.renderSurface,i.inputTexture=rt.getOptimalTexture(s.width,s.height,a,c),t.renderTarget.bind(i.inputTexture,!0),t.globalUniforms.push({offset:s})}pop(){let e=this.renderer;this._filterStackIndex--;let t=this._filterStack[this._filterStackIndex];if(t.skip)return;this._activeFilterData=t;let r=t.inputTexture,i=t.bounds,s=re.EMPTY;if(e.renderTarget.finishRenderPass(),t.blendRequired){let a=this._filterStackIndex>0?this._filterStack[this._filterStackIndex-1].bounds:null,l=e.renderTarget.getRenderTarget(t.previousRenderSurface);s=this.getBackTexture(l,i,a)}t.backTexture=s;let o=t.filterEffect.filters;if(this._globalFilterBindGroup.setResource(r.source.style,2),this._globalFilterBindGroup.setResource(s.source,3),e.globalUniforms.pop(),o.length===1)o[0].apply(this,r,t.previousRenderSurface,!1),rt.returnTexture(r);else{let a=t.inputTexture,l=rt.getOptimalTexture(i.width,i.height,a.source._resolution,!1),c=0;for(c=0;c<o.length-1;++c){o[c].apply(this,a,l,!0);let d=a;a=l,l=d}o[c].apply(this,a,t.previousRenderSurface,!1),rt.returnTexture(a),rt.returnTexture(l)}t.blendRequired&&rt.returnTexture(s)}getBackTexture(e,t,r){let i=e.colorTexture.source._resolution,s=rt.getOptimalTexture(t.width,t.height,i,!1),o=t.minX,a=t.minY;r&&(o-=r.minX,a-=r.minY),o=Math.floor(o*i),a=Math.floor(a*i);let l=Math.ceil(t.width*i),c=Math.ceil(t.height*i);return this.renderer.renderTarget.copyToTexture(e,s,{x:o,y:a},{width:l,height:c},{x:0,y:0}),s}applyFilter(e,t,r,i){let s=this.renderer,o=this._filterStack[this._filterStackIndex],a=o.bounds,l=Ve.shared,u=o.previousRenderSurface===r,d=this.renderer.renderTarget.rootRenderTarget.colorTexture.source._resolution,f=this._filterStackIndex-1;for(;f>0&&this._filterStack[f].skip;)--f;f>0&&(d=this._filterStack[f].inputTexture.source._resolution);let h=this._filterGlobalUniforms,p=h.uniforms,m=p.uOutputFrame,g=p.uInputSize,y=p.uInputPixel,x=p.uInputClamp,b=p.uGlobalFrame,_=p.uOutputTexture;if(u){let k=this._filterStackIndex;for(;k>0;){k--;let v=this._filterStack[this._filterStackIndex-1];if(!v.skip){l.x=v.bounds.minX,l.y=v.bounds.minY;break}}m[0]=a.minX-l.x,m[1]=a.minY-l.y}else m[0]=0,m[1]=0;m[2]=t.frame.width,m[3]=t.frame.height,g[0]=t.source.width,g[1]=t.source.height,g[2]=1/g[0],g[3]=1/g[1],y[0]=t.source.pixelWidth,y[1]=t.source.pixelHeight,y[2]=1/y[0],y[3]=1/y[1],x[0]=.5*y[2],x[1]=.5*y[3],x[2]=t.frame.width*g[2]-.5*y[2],x[3]=t.frame.height*g[3]-.5*y[3];let S=this.renderer.renderTarget.rootRenderTarget.colorTexture;b[0]=l.x*d,b[1]=l.y*d,b[2]=S.source.width*d,b[3]=S.source.height*d;let C=this.renderer.renderTarget.getRenderTarget(r);if(s.renderTarget.bind(r,!!i),r instanceof re?(_[0]=r.frame.width,_[1]=r.frame.height):(_[0]=C.width,_[1]=C.height),_[2]=C.isRoot?-1:1,h.update(),s.renderPipes.uniformBatch){let k=s.renderPipes.uniformBatch.getUboResource(h);this._globalFilterBindGroup.setResource(k,0)}else this._globalFilterBindGroup.setResource(h,0);this._globalFilterBindGroup.setResource(t.source,1),this._globalFilterBindGroup.setResource(t.source.style,2),e.groups[0]=this._globalFilterBindGroup,s.encoder.draw({geometry:eQ,shader:e,state:e._state,topology:"triangle-list"}),s.type===Bt.WEBGL&&s.renderTarget.finishRenderPass()}_getFilterData(){return{skip:!1,inputTexture:null,bounds:new Nt,container:null,filterEffect:null,blendRequired:!1,previousRenderSurface:null}}calculateSpriteMatrix(e,t){let r=this._activeFilterData,i=e.set(r.inputTexture._source.width,0,0,r.inputTexture._source.height,r.bounds.minX,r.bounds.minY),s=t.worldTransform.copyTo(ue.shared),o=t.renderGroup||t.parentRenderGroup;return o&&o.cacheToLocalTransform&&s.prepend(o.cacheToLocalTransform),s.invert(),i.prepend(s),i.scale(1/t.texture.frame.width,1/t.texture.frame.height),i.translate(t.anchor.x,t.anchor.y),i}};wu.extension={type:[z.WebGLSystem,z.WebGPUSystem],name:"filter"}});var DA=$(()=>{ee();TA();PA();ke.add(wu);ke.add(vu)});var tQ={};var nN=$(()=>{$F();Nw();HF();R7();L7();lC();uC();wC();XC();rA();pA();CA();EA();DA()});var rQ={};var iN=$(()=>{Nw();R7();L7();lC();uC();wC();XC();rA();pA();CA();EA();DA()});var sN,be,Fo=$(()=>{Ci();qi();bs();Ki();sN=class FA extends xr{constructor(e){e={...FA.defaultOptions,...e},super(e),this.enabled=!0,this._state=ur.for2d(),this.blendMode=e.blendMode,this.padding=e.padding,typeof e.antialias=="boolean"?this.antialias=e.antialias?"on":"off":this.antialias=e.antialias,this.resolution=e.resolution,this.blendRequired=e.blendRequired,this.clipToViewport=e.clipToViewport,this.addResource("uTexture",0,1)}apply(e,t,r,i){e.applyFilter(this,t,r,i)}get blendMode(){return this._state.blendMode}set blendMode(e){this._state.blendMode=e}static from(e){let{gpu:t,gl:r,...i}=e,s,o;return t&&(s=pe.from(t)),r&&(o=he.from(r)),new FA({gpuProgram:s,glProgram:o,...i})}};sN.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};be=sN});async function e3(n){if(!n)for(let e=0;e<BA.length;e++){let t=BA[e];if(t.value.test()){await t.value.load();return}}}async function aN(n){return e3(!n)}var BA,NA=$(()=>{ee();BA=[];ke.handleByNamedList(z.Environment,BA)});function O0(){if(typeof t3=="boolean")return t3;try{t3=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{t3=!1}return t3}var t3,O8=$(()=>{"use strict"});var tn,Su=$(()=>{"use strict";tn=(n=>(n[n.NONE=0]="NONE",n[n.COLOR=16384]="COLOR",n[n.STENCIL=1024]="STENCIL",n[n.DEPTH=256]="DEPTH",n[n.COLOR_DEPTH=16640]="COLOR_DEPTH",n[n.COLOR_STENCIL=17408]="COLOR_STENCIL",n[n.DEPTH_STENCIL=1280]="DEPTH_STENCIL",n[n.ALL=17664]="ALL",n))(tn||{})});var jl,L8=$(()=>{"use strict";jl=class{constructor(e){this.items=[],this._name=e}emit(e,t,r,i,s,o,a,l){let{name:c,items:u}=this;for(let d=0,f=u.length;d<f;d++)u[d][c](e,t,r,i,s,o,a,l);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){let t=this.items.indexOf(e);return t!==-1&&this.items.splice(t,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}});var nQ,lN,Bo,L0=$(()=>{nn();NA();Vi();O8();zt();Su();L8();Nn();nQ=["init","destroy","contextChange","resolutionChange","reset","renderEnd","renderStart","render","update","postrender","prerender"],lN=class cN extends st{constructor(e){super(),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=e.type,this.name=e.name,this.config=e;let t=[...nQ,...this.config.runners??[]];this._addRunners(...t),this._unsafeEvalCheck()}async init(e={}){let t=e.skipExtensionImports===!0?!0:e.manageImports===!1;await e3(t),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(let r in this._systemsHash)e={...this._systemsHash[r].constructor.defaultOptions,...e};e={...cN.defaultOptions,...e},this._roundPixels=e.roundPixels?1:0;for(let r=0;r<this.runners.init.items.length;r++)await this.runners.init.items[r].init(e);this._initOptions=e}render(e,t){let r=e;if(r instanceof we&&(r={container:r},t&&(oe(Ie,"passing a second argument is deprecated, please use render options instead"),r.target=t.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,r.clearColor=this.background.colorRgba),r.clearColor){let i=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=i?r.clearColor:ce.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),r.container.enableRenderGroup(),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r)}resize(e,t,r){let i=this.view.resolution;this.view.resize(e,t,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),r!==void 0&&r!==i&&this.runners.resolutionChange.emit(r)}clear(e={}){let t=this;e.target||(e.target=t.renderTarget.renderTarget),e.clearColor||(e.clearColor=this.background.colorRgba),e.clear??(e.clear=tn.ALL);let{clear:r,clearColor:i,target:s}=e;ce.shared.setValue(i??this.background.colorRgba),t.renderTarget.clear(s,r,ce.shared.toArray())}get resolution(){return this.view.resolution}set resolution(e){this.view.resolution=e,this.runners.resolutionChange.emit(e)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...e){e.forEach(t=>{this.runners[t]=new jl(t)})}_addSystems(e){let t;for(t in e){let r=e[t];this._addSystem(r.value,r.name)}}_addSystem(e,t){let r=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=r,this._systemsHash[t]=r;for(let i in this.runners)this.runners[i].add(r);return this}_addPipes(e,t){let r=t.reduce((i,s)=>(i[s.name]=s.value,i),{});e.forEach(i=>{let s=i.value,o=i.name,a=r[o];this.renderPipes[o]=new s(this,a?new a:null)})}destroy(e=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(e),Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(e){return this.textureGenerator.generateTexture(e)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!O0())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}};lN.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};Bo=lN});var Cu,OA=$(()=>{ee();Ct();wl();r4();Aa();n0();i0();xu();Ea();bs();Hr();Cu=class{init(){let e=new pt({uTransformMatrix:{value:new ue,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),t=ms({name:"graphics",bits:[Il,Dl(Si()),S8,ys]});this.shader=new xr({gpuProgram:t,resources:{localUniforms:e}})}execute(e,t){let r=t.context,i=r.customShader||this.shader,s=e.renderer,o=s.graphicsContext,{batcher:a,instructions:l}=o.getContextRenderData(r),c=s.encoder;c.setGeometry(a.geometry,i.gpuProgram);let u=s.globalUniforms.bindGroup;c.setBindGroup(0,u,i.gpuProgram);let d=s.renderPipes.uniformBatch.getUniformBindGroup(i.resources.localUniforms,!0);c.setBindGroup(2,d,i.gpuProgram);let f=l.instructions,h=null;for(let p=0;p<l.instructionSize;p++){let m=f[p];if(m.topology!==h&&(h=m.topology,c.setPipelineFromGeometryProgramAndState(a.geometry,i.gpuProgram,e.state,m.topology)),i.groups[1]=m.bindGroup,!m.gpuBindGroup){let g=m.textures;m.bindGroup=Sl(g.textures,g.count),m.gpuBindGroup=s.bindGroup.getBindGroup(m.bindGroup,i.gpuProgram,1)}c.setBindGroup(1,m.bindGroup,i.gpuProgram),c.renderPassEncoder.drawIndexed(m.size,1,m.start)}}destroy(){this.shader.destroy(!0),this.shader=null}};Cu.extension={type:[z.WebGPUPipesAdaptor],name:"graphics"}});var $8,z8,H8=$(()=>{"use strict";$8={name:"texture-bit",vertex:{header:`

        struct TextureUniforms {
            uTextureMatrix:mat3x3<f32>,
        }

        @group(2) @binding(2) var<uniform> textureUniforms : TextureUniforms;
        `,main:`
            uv = (textureUniforms.uTextureMatrix * vec3(uv, 1.0)).xy;
        `},fragment:{header:`
            @group(2) @binding(0) var uTexture: texture_2d<f32>;
            @group(2) @binding(1) var uSampler: sampler;

         
        `,main:`
            outColor = textureSample(uTexture, uSampler, vUV);
        `}},z8={name:"texture-bit",vertex:{header:`
            uniform mat3 uTextureMatrix;
        `,main:`
            uv = (uTextureMatrix * vec3(uv, 1.0)).xy;
        `},fragment:{header:`
        uniform sampler2D uTexture;

         
        `,main:`
            outColor = texture(uTexture, vUV);
        `}}});var Au,LA=$(()=>{ee();Ct();Aa();xu();Ea();H8();bs();_t();Gt();Au=class{init(){let e=ms({name:"mesh",bits:[Ma,$8,ys]});this._shader=new xr({gpuProgram:e,resources:{uTexture:re.EMPTY._source,uSampler:re.EMPTY._source.style,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new ue}}}})}execute(e,t){let r=e.renderer,i=t._shader;if(!i)i=this._shader,i.groups[2]=r.texture.getTextureBindGroup(t.texture);else if(!i.gpuProgram){ve("Mesh shader has no gpuProgram",t.shader);return}let s=i.gpuProgram;if(s.autoAssignGlobalUniforms&&(i.groups[0]=r.globalUniforms.bindGroup),s.autoAssignLocalUniforms){let o=e.localUniforms;i.groups[1]=r.renderPipes.uniformBatch.getUniformBindGroup(o,!0)}r.encoder.draw({geometry:t._geometry,shader:i,state:t.state})}destroy(){this._shader.destroy(!0),this._shader=null}};Au.extension={type:[z.WebGPUPipesAdaptor],name:"mesh"}});var W8,Eu,UA=$(()=>{ee();Ki();r4();W8=ur.for2d(),Eu=class{start(e,t,r){let i=e.renderer,s=i.encoder,o=r.gpuProgram;this._shader=r,this._geometry=t,s.setGeometry(t,o),W8.blendMode="normal",i.pipeline.getPipeline(t,o,W8);let a=i.globalUniforms.bindGroup;s.resetBindGroup(1),s.setBindGroup(0,a,o)}execute(e,t){let r=this._shader.gpuProgram,i=e.renderer,s=i.encoder;if(!t.bindGroup){let l=t.textures;t.bindGroup=Sl(l.textures,l.count)}W8.blendMode=t.blendMode;let o=i.bindGroup.getBindGroup(t.bindGroup,r,1),a=i.pipeline.getPipeline(this._geometry,r,W8,t.topology);t.bindGroup._touch(i.textureGC.count),s.setPipeline(a),s.renderPassEncoder.setBindGroup(1,o),s.renderPassEncoder.drawIndexed(t.size,1,t.start)}};Eu.extension={type:[z.WebGPUPipesAdaptor],name:"batch"}});var Tu,GA=$(()=>{ee();Tu=class{constructor(e){this._renderer=e}updateRenderable(){}destroyRenderable(){}validateRenderable(){return!1}addRenderable(e,t){this._renderer.renderPipes.batch.break(t),t.add(e)}execute(e){e.isRenderable&&e.render(this._renderer)}destroy(){this._renderer=null}};Tu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"customRender"}});function ku(n,e){let t=n.instructionSet,r=t.instructions;for(let i=0;i<t.instructionSize;i++){let s=r[i];e[s.renderPipeId].execute(s)}}var V8=$(()=>{"use strict"});var iQ,Iu,$A=$(()=>{ee();Ct();On();_0();V8();iQ=new ue,Iu=class{constructor(e){this._renderer=e}addRenderGroup(e,t){e.isCachedAsTexture?this._addRenderableCacheAsTexture(e,t):this._addRenderableDirect(e,t)}execute(e){e.isRenderable&&(e.isCachedAsTexture?this._executeCacheAsTexture(e):this._executeDirect(e))}destroy(){this._renderer=null}_addRenderableDirect(e,t){this._renderer.renderPipes.batch.break(t),e._batchableRenderGroup&&(Ze.return(e._batchableRenderGroup),e._batchableRenderGroup=null),t.add(e)}_addRenderableCacheAsTexture(e,t){let r=e._batchableRenderGroup??(e._batchableRenderGroup=Ze.get(ws));r.renderable=e.root,r.transform=e.root.relativeGroupTransform,r.texture=e.texture,r.bounds=e._textureBounds,t.add(e),this._renderer.renderPipes.batch.addToBatch(r,t)}_executeCacheAsTexture(e){if(e.textureNeedsUpdate){e.textureNeedsUpdate=!1;let t=iQ.identity().translate(-e._textureBounds.x,-e._textureBounds.y);this._renderer.renderTarget.push(e.texture,!0,null,e.texture.frame),this._renderer.globalUniforms.push({worldTransformMatrix:t,worldColor:4294967295}),ku(e,this._renderer.renderPipes),this._renderer.renderTarget.finishRenderPass(),this._renderer.renderTarget.pop(),this._renderer.globalUniforms.pop()}e._batchableRenderGroup._batcher.updateElement(e._batchableRenderGroup),e._batchableRenderGroup._batcher.geometry.buffers[0].update()}_executeDirect(e){this._renderer.globalUniforms.push({worldTransformMatrix:e.inverseParentTextureTransform,worldColor:e.worldColorAlpha}),ku(e,this._renderer.renderPipes),this._renderer.globalUniforms.pop()}};Iu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"renderGroup"}});function j8(n,e){let t=n.root,r=n.instructionSet;r.reset();let i=e.renderPipes?e:e.batch.renderer,s=i.renderPipes;s.batch.buildStart(r),s.blendMode.buildStart(),s.colorMask.buildStart(),t.sortableChildren&&t.sortChildren(),uN(t,r,i,!0),s.batch.buildEnd(r),s.blendMode.buildEnd(r)}function Xl(n,e,t){let r=t.renderPipes?t:t.batch.renderer;n.globalDisplayStatus<7||!n.includeInBuild||(n.sortableChildren&&n.sortChildren(),n.isSimple?sQ(n,e,r):uN(n,e,r,!1))}function sQ(n,e,t){if(n.renderPipeId){let r=n,{renderPipes:i,renderableGC:s}=t;i.blendMode.setBlendMode(r,n.groupBlendMode,e),i[r.renderPipeId].addRenderable(r,e),s.addRenderable(r),r.didViewUpdate=!1}if(!n.renderGroup){let r=n.children,i=r.length;for(let s=0;s<i;s++)Xl(r[s],e,t)}}function uN(n,e,t,r){let{renderPipes:i,renderableGC:s}=t;if(!r&&n.renderGroup)i.renderGroup.addRenderGroup(n.renderGroup,e);else{for(let c=0;c<n.effects.length;c++){let u=n.effects[c];i[u.pipe].push(u,n,e)}let o=n,a=o.renderPipeId;a&&(i.blendMode.setBlendMode(o,o.groupBlendMode,e),i[a].addRenderable(o,e),s.addRenderable(o),o.didViewUpdate=!1);let l=n.children;if(l.length)for(let c=0;c<l.length;c++)Xl(l[c],e,t);for(let c=n.effects.length-1;c>=0;c--){let u=n.effects[c];i[u.pipe].pop(u,n,e)}}}var r3=$(()=>{"use strict"});function Pu(n,e){e||(e=0);for(let t=e;t<n.length&&n[t];t++)n[t]=null}var X8=$(()=>{"use strict"});function n3(n,e=!1){zA(n);let t=n.childrenToUpdate,r=n.updateTick++;for(let i in t){let s=Number(i),o=t[i],a=o.list,l=o.index;for(let c=0;c<l;c++){let u=a[c];u.parentRenderGroup===n&&u.relativeRenderGroupDepth===s&&q8(u,r,0)}Pu(a,l),o.index=0}if(e)for(let i=0;i<n.renderGroupChildren.length;i++)n3(n.renderGroupChildren[i],e)}function zA(n){let e=n.root,t;if(n.renderGroupParent){let r=n.renderGroupParent;n.worldTransform.appendFrom(e.relativeGroupTransform,r.worldTransform),n.worldColor=cl(e.groupColor,r.worldColor),t=e.groupAlpha*r.worldAlpha}else n.worldTransform.copyFrom(e.localTransform),n.worldColor=e.localColor,t=e.localAlpha;t=t<0?0:t>1?1:t,n.worldAlpha=t,n.worldColorAlpha=n.worldColor+((t*255|0)<<24)}function q8(n,e,t){if(e===n.updateTick)return;n.updateTick=e,n.didChange=!1;let r=n.localTransform;n.updateLocalTransform();let i=n.parent;if(i&&!i.renderGroup?(t|=n._updateFlags,n.relativeGroupTransform.appendFrom(r,i.relativeGroupTransform),t&dN&&fN(n,i,t)):(t=n._updateFlags,n.relativeGroupTransform.copyFrom(r),t&dN&&fN(n,oQ,t)),!n.renderGroup){let s=n.children,o=s.length;for(let c=0;c<o;c++)q8(s[c],e,t);let a=n.parentRenderGroup,l=n;l.renderPipeId&&!a.structureDidChange&&a.updateRenderable(l)}}function fN(n,e,t){if(t&Hc){n.groupColor=cl(n.localColor,e.groupColor);let r=n.localAlpha*e.groupAlpha;r=r<0?0:r>1?1:r,n.groupAlpha=r,n.groupColorAlpha=n.groupColor+((r*255|0)<<24)}t&W2&&(n.groupBlendMode=n.localBlendMode==="inherit"?e.groupBlendMode:n.localBlendMode),t&hl&&(n.globalDisplayStatus=n.localDisplayStatus&e.globalDisplayStatus),n._updateFlags=0}var oQ,dN,HA=$(()=>{Vi();X8();o7();oQ=new we,dN=hl|Hc|W2});function Y8(n,e){let{list:t,index:r}=n.childrenRenderablesToUpdate,i=!1;for(let s=0;s<r;s++){let o=t[s];if(i=e[o.renderPipeId].validateRenderable(o),i)break}return n.structureDidChange=i,i}var WA=$(()=>{"use strict"});var aQ,Du,VA=$(()=>{ee();Ct();Ws();Ln();r3();X8();V8();HA();WA();aQ=new ue,Du=class{constructor(e){this._renderer=e}render({container:e,transform:t}){let r=e.parent,i=e.renderGroup.renderGroupParent;e.parent=null,e.renderGroup.renderGroupParent=null;let s=this._renderer,o=aQ;t&&(o=o.copyFrom(e.renderGroup.localTransform),e.renderGroup.localTransform.copyFrom(t));let a=s.renderPipes;this._updateCachedRenderGroups(e.renderGroup,null),this._updateRenderGroups(e.renderGroup),s.globalUniforms.start({worldTransformMatrix:t?e.renderGroup.localTransform:e.renderGroup.worldTransform,worldColor:e.renderGroup.worldColorAlpha}),ku(e.renderGroup,a),a.uniformBatch&&a.uniformBatch.renderEnd(),t&&e.renderGroup.localTransform.copyFrom(o),e.parent=r,e.renderGroup.renderGroupParent=i}destroy(){this._renderer=null}_updateCachedRenderGroups(e,t){if(e.isCachedAsTexture){if(!e.updateCacheTexture)return;t=e}e._parentCacheAsTextureRenderGroup=t;for(let r=e.renderGroupChildren.length-1;r>=0;r--)this._updateCachedRenderGroups(e.renderGroupChildren[r],t);if(e.invalidateMatrices(),e.isCachedAsTexture){if(e.textureNeedsUpdate){let r=e.root.getLocalBounds();r.ceil();let i=e.texture;e.texture&&rt.returnTexture(e.texture);let s=this._renderer,o=e.textureOptions.resolution||s.view.resolution,a=e.textureOptions.antialias??s.view.antialias;e.texture=rt.getOptimalTexture(r.width,r.height,o,a),e._textureBounds||(e._textureBounds=new Nt),e._textureBounds.copyFrom(r),i!==e.texture&&e.renderGroupParent&&(e.renderGroupParent.structureDidChange=!0)}}else e.texture&&(rt.returnTexture(e.texture),e.texture=null)}_updateRenderGroups(e){let t=this._renderer,r=t.renderPipes;if(e.runOnRender(),e.instructionSet.renderPipes=r,e.structureDidChange?Pu(e.childrenRenderablesToUpdate.list,0):Y8(e,r),n3(e),e.structureDidChange?(e.structureDidChange=!1,j8(e,t)):this._updateRenderables(e),e.childrenRenderablesToUpdate.index=0,t.renderPipes.batch.upload(e.instructionSet),!(e.isCachedAsTexture&&!e.textureNeedsUpdate))for(let i=0;i<e.renderGroupChildren.length;i++)this._updateRenderGroups(e.renderGroupChildren[i])}_updateRenderables(e){let{list:t,index:r}=e.childrenRenderablesToUpdate;for(let i=0;i<r;i++){let s=t[i];s.didViewUpdate&&e.updateRenderable(s)}Pu(t,r)}};Du.extension={type:[z.WebGLSystem,z.WebGPUSystem,z.CanvasSystem],name:"renderGroup"}});var Mu,jA=$(()=>{ee();On();_0();Mu=class{constructor(e){this._gpuSpriteHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_gpuSpriteHash")}addRenderable(e,t){let r=this._getGpuSprite(e);e.didViewUpdate&&this._updateBatchableSprite(e,r),this._renderer.renderPipes.batch.addToBatch(r,t)}updateRenderable(e){let t=this._gpuSpriteHash[e.uid];e.didViewUpdate&&this._updateBatchableSprite(e,t),t._batcher.updateElement(t)}validateRenderable(e){let t=this._getGpuSprite(e);return!t._batcher.checkAndUpdateTexture(t,e._texture)}destroyRenderable(e){let t=this._gpuSpriteHash[e.uid];Ze.return(t),this._gpuSpriteHash[e.uid]=null,e.off("destroyed",this._destroyRenderableBound)}_updateBatchableSprite(e,t){t.bounds=e.visualBounds,t.texture=e._texture}_getGpuSprite(e){return this._gpuSpriteHash[e.uid]||this._initGPUSprite(e)}_initGPUSprite(e){let t=Ze.get(ws);return t.renderable=e,t.transform=e.groupTransform,t.texture=e._texture,t.bounds=e.visualBounds,t.roundPixels=this._renderer._roundPixels|e._roundPixels,this._gpuSpriteHash[e.uid]=t,e.on("destroyed",this._destroyRenderableBound),t}destroy(){for(let e in this._gpuSpriteHash)Ze.return(this._gpuSpriteHash[e]);this._gpuSpriteHash=null,this._renderer=null}};Mu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"sprite"}});var hN,ql,K8=$(()=>{Nn();hN=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i,ql="8.6.6"});var Ru,Fu,Q8=$(()=>{ee();K8();Ru=class{static init(){globalThis.__PIXI_APP_INIT__?.(this,ql)}static destroy(){}};Ru.extension=z.Application;Fu=class{constructor(e){this._renderer=e}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,ql)}destroy(){this._renderer=null}};Fu.extension={type:[z.WebGLSystem,z.WebGPUSystem],name:"initHook",priority:-10}});var XA,i3,qA=$(()=>{ee();Ki();g9();XA=class pN{constructor(e,t){this.state=ur.for2d(),this._batchersByInstructionSet=Object.create(null),this._activeBatches=Object.create(null),this.renderer=e,this._adaptor=t,this._adaptor.init?.(this)}static getBatcher(e){return new this._availableBatchers[e]}buildStart(e){let t=this._batchersByInstructionSet[e.uid];t||(t=this._batchersByInstructionSet[e.uid]=Object.create(null),t.default||(t.default=new tu)),this._activeBatches=t,this._activeBatch=this._activeBatches.default;for(let r in this._activeBatches)this._activeBatches[r].begin()}addToBatch(e,t){if(this._activeBatch.name!==e.batcherName){this._activeBatch.break(t);let r=this._activeBatches[e.batcherName];r||(r=this._activeBatches[e.batcherName]=pN.getBatcher(e.batcherName),r.begin()),this._activeBatch=r}this._activeBatch.add(e)}break(e){this._activeBatch.break(e)}buildEnd(e){this._activeBatch.break(e);let t=this._activeBatches;for(let r in t){let i=t[r],s=i.geometry;s.indexBuffer.setDataWithSize(i.indexBuffer,i.indexSize,!0),s.buffers[0].setDataWithSize(i.attributeBuffer.float32View,i.attributeSize,!1)}}upload(e){let t=this._batchersByInstructionSet[e.uid];for(let r in t){let i=t[r],s=i.geometry;i.dirty&&(i.dirty=!1,s.buffers[0].update(i.attributeSize*4))}}execute(e){if(e.action==="startBatch"){let t=e.batcher,r=t.geometry,i=t.shader;this._adaptor.start(this,r,i)}this._adaptor.execute(this,e)}destroy(){this.state=null,this.renderer=null,this._adaptor=null;for(let e in this._activeBatches)this._activeBatches[e].destroy();this._activeBatches=null}};XA.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"batch"};XA._availableBatchers=Object.create(null);i3=XA;ke.handleByMap(z.Batcher,i3._availableBatchers);ke.add(tu)});var Z8,YA=$(()=>{Z8=`in vec2 vMaskCoord;
in vec2 vTextureCoord;

uniform sampler2D uTexture;
uniform sampler2D uMaskTexture;

uniform float uAlpha;
uniform vec4 uMaskClamp;
uniform float uInverse;

out vec4 finalColor;

void main(void)
{
    float clip = step(3.5,
        step(uMaskClamp.x, vMaskCoord.x) +
        step(uMaskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, uMaskClamp.z) +
        step(vMaskCoord.y, uMaskClamp.w));

    // TODO look into why this is needed
    float npmAlpha = uAlpha;
    vec4 original = texture(uTexture, vTextureCoord);
    vec4 masky = texture(uMaskTexture, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    float a = alphaMul * masky.r * npmAlpha * clip;

    if (uInverse == 1.0) {
        a = 1.0 - a;
    }

    finalColor = original * a;
}
`});var J8,KA=$(()=>{J8=`in vec2 aPosition;

out vec2 vTextureCoord;
out vec2 vMaskCoord;


uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;
uniform mat3 uFilterMatrix;

vec4 filterVertexPosition(  vec2 aPosition )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
       
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord(  vec2 aPosition )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

vec2 getFilterCoord( vec2 aPosition )
{
    return  ( uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}   

void main(void)
{
    gl_Position = filterVertexPosition(aPosition);
    vTextureCoord = filterTextureCoord(aPosition);
    vMaskCoord = getFilterCoord(aPosition);
}
`});var s3,QA=$(()=>{s3=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct MaskUniforms {
  uFilterMatrix:mat3x3<f32>,
  uMaskClamp:vec4<f32>,
  uAlpha:f32,
  uInverse:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> filterUniforms : MaskUniforms;
@group(1) @binding(1) var uMaskTexture: texture_2d<f32>;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) filterUv : vec2<f32>,
};

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);
}

fn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>
{
  return ( filterUniforms.uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}

@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>,
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
   getFilterCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) filterUv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    var maskClamp = filterUniforms.uMaskClamp;
    var uAlpha = filterUniforms.uAlpha;

    var clip = step(3.5,
      step(maskClamp.x, filterUv.x) +
      step(maskClamp.y, filterUv.y) +
      step(filterUv.x, maskClamp.z) +
      step(filterUv.y, maskClamp.w));

    var mask = textureSample(uMaskTexture, uSampler, filterUv);
    var source = textureSample(uTexture, uSampler, uv);
    var alphaMul = 1.0 - uAlpha * (1.0 - mask.a);

    var a: f32 = alphaMul * mask.r * uAlpha * clip;

    if (filterUniforms.uInverse == 1.0) {
        a = 1.0 - a;
    }

    return source * a;
}
`});var U0,ZA=$(()=>{Ct();Ci();qi();Hr();x7();Fo();YA();KA();QA();U0=class extends be{constructor(e){let{sprite:t,...r}=e,i=new fl(t.texture),s=new pt({uFilterMatrix:{value:new ue,type:"mat3x3<f32>"},uMaskClamp:{value:i.uClampFrame,type:"vec4<f32>"},uAlpha:{value:1,type:"f32"},uInverse:{value:e.inverse?1:0,type:"f32"}}),o=pe.from({vertex:{source:s3,entryPoint:"mainVertex"},fragment:{source:s3,entryPoint:"mainFragment"}}),a=he.from({vertex:J8,fragment:Z8,name:"mask-filter"});super({...r,gpuProgram:o,glProgram:a,resources:{filterUniforms:s,uMaskTexture:t.texture.source}}),this.sprite=t,this._textureMatrix=i}set inverse(e){this.resources.filterUniforms.uniforms.uInverse=e?1:0}get inverse(){return this.resources.filterUniforms.uniforms.uInverse===1}apply(e,t,r,i){this._textureMatrix.texture=this.sprite.texture,e.calculateSpriteMatrix(this.resources.filterUniforms.uniforms.uFilterMatrix,this.sprite).prepend(this._textureMatrix.mapCoord),this.resources.uMaskTexture=this.sprite.texture.source,e.applyFilter(this,t,r,i)}}});var lQ,JA,Bu,eE=$(()=>{ee();Lh();ZA();Ln();Nc();r3();xl();On();_t();Ws();Yi();lQ=new Nt,JA=class extends Hs{constructor(){super(),this.filters=[new U0({sprite:new At(re.EMPTY),inverse:!1,resolution:"inherit",antialias:"inherit"})]}get sprite(){return this.filters[0].sprite}set sprite(e){this.filters[0].sprite=e}get inverse(){return this.filters[0].inverse}set inverse(e){this.filters[0].inverse=e}},Bu=class{constructor(e){this._activeMaskStage=[],this._renderer=e}push(e,t,r){let i=this._renderer;if(i.renderPipes.batch.break(r),r.add({renderPipeId:"alphaMask",action:"pushMaskBegin",mask:e,inverse:t._maskOptions.inverse,canBundle:!1,maskedContainer:t}),e.inverse=t._maskOptions.inverse,e.renderMaskToTexture){let s=e.mask;s.includeInBuild=!0,Xl(s,r,i),s.includeInBuild=!1}i.renderPipes.batch.break(r),r.add({renderPipeId:"alphaMask",action:"pushMaskEnd",mask:e,maskedContainer:t,inverse:t._maskOptions.inverse,canBundle:!1})}pop(e,t,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"alphaMask",action:"popMaskEnd",mask:e,inverse:t._maskOptions.inverse,canBundle:!1})}execute(e){let t=this._renderer,r=e.mask.renderMaskToTexture;if(e.action==="pushMaskBegin"){let i=Ze.get(JA);if(i.inverse=e.inverse,r){e.mask.mask.measurable=!0;let s=Eo(e.mask.mask,!0,lQ);e.mask.mask.measurable=!1,s.ceil();let o=t.renderTarget.renderTarget.colorTexture.source,a=rt.getOptimalTexture(s.width,s.height,o._resolution,o.antialias);t.renderTarget.push(a,!0),t.globalUniforms.push({offset:s,worldColor:4294967295});let l=i.sprite;l.texture=a,l.worldTransform.tx=s.minX,l.worldTransform.ty=s.minY,this._activeMaskStage.push({filterEffect:i,maskedContainer:e.maskedContainer,filterTexture:a})}else i.sprite=e.mask.mask,this._activeMaskStage.push({filterEffect:i,maskedContainer:e.maskedContainer})}else if(e.action==="pushMaskEnd"){let i=this._activeMaskStage[this._activeMaskStage.length-1];r&&(t.type===Bt.WEBGL&&t.renderTarget.finishRenderPass(),t.renderTarget.pop(),t.globalUniforms.pop()),t.filter.push({renderPipeId:"filter",action:"pushFilter",container:i.maskedContainer,filterEffect:i.filterEffect,canBundle:!1})}else if(e.action==="popMaskEnd"){t.filter.pop();let i=this._activeMaskStage.pop();r&&rt.returnTexture(i.filterTexture),Ze.return(i.filterEffect)}}destroy(){this._renderer=null,this._activeMaskStage=null}};Bu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"alphaMask"}});var Nu,tE=$(()=>{ee();Nu=class{constructor(e){this._colorStack=[],this._colorStackIndex=0,this._currentColor=0,this._renderer=e}buildStart(){this._colorStack[0]=15,this._colorStackIndex=1,this._currentColor=15}push(e,t,r){this._renderer.renderPipes.batch.break(r);let s=this._colorStack;s[this._colorStackIndex]=s[this._colorStackIndex-1]&e.mask;let o=this._colorStack[this._colorStackIndex];o!==this._currentColor&&(this._currentColor=o,r.add({renderPipeId:"colorMask",colorMask:o,canBundle:!1})),this._colorStackIndex++}pop(e,t,r){this._renderer.renderPipes.batch.break(r);let s=this._colorStack;this._colorStackIndex--;let o=s[this._colorStackIndex-1];o!==this._currentColor&&(this._currentColor=o,r.add({renderPipeId:"colorMask",colorMask:o,canBundle:!1}))}execute(e){this._renderer.colorMask.setMask(e.colorMask)}destroy(){this._colorStack=null}};Nu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"colorMask"}});var Ou,rE=$(()=>{ee();r3();Su();Cl();Ou=class{constructor(e){this._maskStackHash={},this._maskHash=new WeakMap,this._renderer=e}push(e,t,r){var i;let s=e,o=this._renderer;o.renderPipes.batch.break(r),o.renderPipes.blendMode.setBlendMode(s.mask,"none",r),r.add({renderPipeId:"stencilMask",action:"pushMaskBegin",mask:e,inverse:t._maskOptions.inverse,canBundle:!1});let a=s.mask;a.includeInBuild=!0,this._maskHash.has(s)||this._maskHash.set(s,{instructionsStart:0,instructionsLength:0});let l=this._maskHash.get(s);l.instructionsStart=r.instructionSize,Xl(a,r,o),a.includeInBuild=!1,o.renderPipes.batch.break(r),r.add({renderPipeId:"stencilMask",action:"pushMaskEnd",mask:e,inverse:t._maskOptions.inverse,canBundle:!1});let c=r.instructionSize-l.instructionsStart-1;l.instructionsLength=c;let u=o.renderTarget.renderTarget.uid;(i=this._maskStackHash)[u]??(i[u]=0)}pop(e,t,r){let i=e,s=this._renderer;s.renderPipes.batch.break(r),s.renderPipes.blendMode.setBlendMode(i.mask,"none",r),r.add({renderPipeId:"stencilMask",action:"popMaskBegin",inverse:t._maskOptions.inverse,canBundle:!1});let o=this._maskHash.get(e);for(let a=0;a<o.instructionsLength;a++)r.instructions[r.instructionSize++]=r.instructions[o.instructionsStart++];r.add({renderPipeId:"stencilMask",action:"popMaskEnd",canBundle:!1})}execute(e){var t;let r=this._renderer,i=r.renderTarget.renderTarget.uid,s=(t=this._maskStackHash)[i]??(t[i]=0);e.action==="pushMaskBegin"?(r.renderTarget.ensureDepthStencil(),r.stencil.setStencilMode(Jt.RENDERING_MASK_ADD,s),s++,r.colorMask.setMask(0)):e.action==="pushMaskEnd"?(e.inverse?r.stencil.setStencilMode(Jt.INVERSE_MASK_ACTIVE,s):r.stencil.setStencilMode(Jt.MASK_ACTIVE,s),r.colorMask.setMask(15)):e.action==="popMaskBegin"?(r.colorMask.setMask(0),s!==0?r.stencil.setStencilMode(Jt.RENDERING_MASK_REMOVE,s):(r.renderTarget.clear(null,tn.STENCIL),r.stencil.setStencilMode(Jt.DISABLED,s)),s--):e.action==="popMaskEnd"&&(e.inverse?r.stencil.setStencilMode(Jt.INVERSE_MASK_ACTIVE,s):r.stencil.setStencilMode(Jt.MASK_ACTIVE,s),r.colorMask.setMask(15)),this._maskStackHash[i]=s}destroy(){this._renderer=null,this._maskStackHash=null,this._maskHash=null}};Ou.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"stencilMask"}});var nE,eg,iE=$(()=>{nn();ee();nE=class mN{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new ce(0),this.color=this._backgroundColor,this.alpha=1}init(e){e={...mN.defaultOptions,...e},this.clearBeforeRender=e.clearBeforeRender,this.color=e.background||e.backgroundColor||this._backgroundColor,this.alpha=e.backgroundAlpha,this._backgroundColor.setAlpha(e.backgroundAlpha)}get color(){return this._backgroundColor}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get colorRgba(){return this._backgroundColor.toArray()}destroy(){}};nE.extension={type:[z.WebGLSystem,z.WebGPUSystem,z.CanvasSystem],name:"background",priority:0};nE.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};eg=nE});var o3,Lu,sE=$(()=>{ee();Lh();Gt();o3={};ke.handle(z.BlendMode,n=>{if(!n.name)throw new Error("BlendMode extension must have a name property");o3[n.name]=n.ref},n=>{delete o3[n.name]});Lu=class{constructor(e){this._isAdvanced=!1,this._filterHash=Object.create(null),this._renderer=e}setBlendMode(e,t,r){if(this._activeBlendMode===t){this._isAdvanced&&this._renderableList.push(e);return}this._activeBlendMode=t,this._isAdvanced&&this._endAdvancedBlendMode(r),this._isAdvanced=!!o3[t],this._isAdvanced&&(this._beginAdvancedBlendMode(r),this._renderableList.push(e))}_beginAdvancedBlendMode(e){this._renderer.renderPipes.batch.break(e);let t=this._activeBlendMode;if(!o3[t]){ve(`Unable to assign BlendMode: '${t}'. You may want to include: import 'pixi.js/advanced-blend-modes'`);return}let r=this._filterHash[t];r||(r=this._filterHash[t]=new Hs,r.filters=[new o3[t]]);let i={renderPipeId:"filter",action:"pushFilter",renderables:[],filterEffect:r,canBundle:!1};this._renderableList=i.renderables,e.add(i)}_endAdvancedBlendMode(e){this._renderableList=null,this._renderer.renderPipes.batch.break(e),e.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}buildStart(){this._isAdvanced=!1}buildEnd(e){this._isAdvanced&&this._endAdvancedBlendMode(e)}destroy(){this._renderer=null,this._renderableList=null;for(let e in this._filterHash)this._filterHash[e].destroy();this._filterHash=null}};Lu.extension={type:[z.WebGLPipes,z.WebGPUPipes,z.CanvasPipes],name:"blendMode"}});var oE,aE,tg,lE=$(()=>{ee();Vi();_t();oE={png:"image/png",jpg:"image/jpeg",webp:"image/webp"},aE=class gN{constructor(e){this._renderer=e}_normalizeOptions(e,t={}){return e instanceof we||e instanceof re?{target:e,...t}:{...t,...e}}async image(e){let t=new Image;return t.src=await this.base64(e),t}async base64(e){e=this._normalizeOptions(e,gN.defaultImageOptions);let{format:t,quality:r}=e,i=this.canvas(e);if(i.toBlob!==void 0)return new Promise((s,o)=>{i.toBlob(a=>{if(!a){o(new Error("ICanvas.toBlob failed!"));return}let l=new FileReader;l.onload=()=>s(l.result),l.onerror=o,l.readAsDataURL(a)},oE[t],r)});if(i.toDataURL!==void 0)return i.toDataURL(oE[t],r);if(i.convertToBlob!==void 0){let s=await i.convertToBlob({type:oE[t],quality:r});return new Promise((o,a)=>{let l=new FileReader;l.onload=()=>o(l.result),l.onerror=a,l.readAsDataURL(s)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e){e=this._normalizeOptions(e);let t=e.target,r=this._renderer;if(t instanceof re)return r.texture.generateCanvas(t);let i=r.textureGenerator.generateTexture(e),s=r.texture.generateCanvas(i);return i.destroy(!0),s}pixels(e){e=this._normalizeOptions(e);let t=e.target,r=this._renderer,i=t instanceof re?t:r.textureGenerator.generateTexture(e),s=r.texture.getPixels(i);return t instanceof we&&i.destroy(!0),s}texture(e){return e=this._normalizeOptions(e),e.target instanceof re?e.target:this._renderer.textureGenerator.generateTexture(e)}download(e){e=this._normalizeOptions(e);let t=this.canvas(e),r=document.createElement("a");r.download=e.filename??"image.png",r.href=t.toDataURL("image/png"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}log(e){let t=e.width??200;e=this._normalizeOptions(e);let r=this.canvas(e),i=r.toDataURL();console.log(`[Pixi Texture] ${r.width}px ${r.height}px`);let s=["font-size: 1px;",`padding: ${t}px 300px;`,`background: url(${i}) no-repeat;`,"background-size: contain;"].join(" ");console.log("%c ",s)}destroy(){this._renderer=null}};aE.extension={type:[z.WebGLSystem,z.WebGPUSystem],name:"extract"};aE.defaultImageOptions={format:"png",quality:1};tg=aE});var G0,cE=$(()=>{cn();_t();G0=class n extends re{static create(e){return new n({source:new ot(e)})}resize(e,t,r){return this.source.resize(e,t,r),this}}});var cQ,uQ,dQ,Uu,uE=$(()=>{nn();ee();Ct();Qr();Ln();Gh();Vi();cE();cQ=new $e,uQ=new Nt,dQ=[0,0,0,0],Uu=class{constructor(e){this._renderer=e}generateTexture(e){e instanceof we&&(e={target:e,frame:void 0,textureSourceOptions:{},resolution:void 0});let t=e.resolution||this._renderer.resolution,r=e.antialias||this._renderer.view.antialias,i=e.target,s=e.clearColor;s?s=Array.isArray(s)&&s.length===4?s:ce.shared.setValue(s).toArray():s=dQ;let o=e.frame?.copyTo(cQ)||ul(i,uQ).rectangle;o.width=Math.max(o.width,1/t)|0,o.height=Math.max(o.height,1/t)|0;let a=G0.create({...e.textureSourceOptions,width:o.width,height:o.height,resolution:t,antialias:r}),l=ue.shared.translate(-o.x,-o.y);return this._renderer.render({container:i,transform:l,target:a,clearColor:s}),a.source.updateMipmaps(),a}destroy(){this._renderer=null}};Uu.extension={type:[z.WebGLSystem,z.WebGPUSystem],name:"textureGenerator"}});var Gu,dE=$(()=>{ee();Ct();vi();ou();Ca();Yi();Hr();Gu=class{constructor(e){this._stackIndex=0,this._globalUniformDataStack=[],this._uniformsPool=[],this._activeUniforms=[],this._bindGroupPool=[],this._activeBindGroups=[],this._renderer=e}reset(){this._stackIndex=0;for(let e=0;e<this._activeUniforms.length;e++)this._uniformsPool.push(this._activeUniforms[e]);for(let e=0;e<this._activeBindGroups.length;e++)this._bindGroupPool.push(this._activeBindGroups[e]);this._activeUniforms.length=0,this._activeBindGroups.length=0}start(e){this.reset(),this.push(e)}bind({size:e,projectionMatrix:t,worldTransformMatrix:r,worldColor:i,offset:s}){let o=this._renderer.renderTarget.renderTarget,a=this._stackIndex?this._globalUniformDataStack[this._stackIndex-1]:{projectionData:o,worldTransformMatrix:new ue,worldColor:4294967295,offset:new Ve},l={projectionMatrix:t||this._renderer.renderTarget.projectionMatrix,resolution:e||o.size,worldTransformMatrix:r||a.worldTransformMatrix,worldColor:i||a.worldColor,offset:s||a.offset,bindGroup:null},c=this._uniformsPool.pop()||this._createUniforms();this._activeUniforms.push(c);let u=c.uniforms;u.uProjectionMatrix=l.projectionMatrix,u.uResolution=l.resolution,u.uWorldTransformMatrix.copyFrom(l.worldTransformMatrix),u.uWorldTransformMatrix.tx-=l.offset.x,u.uWorldTransformMatrix.ty-=l.offset.y,vs(l.worldColor,u.uWorldColorAlpha,0),c.update();let d;this._renderer.renderPipes.uniformBatch?d=this._renderer.renderPipes.uniformBatch.getUniformBindGroup(c,!1):(d=this._bindGroupPool.pop()||new Jr,this._activeBindGroups.push(d),d.setResource(c,0)),l.bindGroup=d,this._currentGlobalUniformData=l}push(e){this.bind(e),this._globalUniformDataStack[this._stackIndex++]=this._currentGlobalUniformData}pop(){this._currentGlobalUniformData=this._globalUniformDataStack[--this._stackIndex-1],this._renderer.type===Bt.WEBGL&&this._currentGlobalUniformData.bindGroup.resources[0].update()}get bindGroup(){return this._currentGlobalUniformData.bindGroup}get globalUniformData(){return this._currentGlobalUniformData}get uniformGroup(){return this._currentGlobalUniformData.bindGroup.resources[0]}_createUniforms(){return new pt({uProjectionMatrix:{value:new ue,type:"mat3x3<f32>"},uWorldTransformMatrix:{value:new ue,type:"mat3x3<f32>"},uWorldColorAlpha:{value:new Float32Array(4),type:"vec4<f32>"},uResolution:{value:[0,0],type:"vec2<f32>"}},{isStatic:!0})}destroy(){this._renderer=null}};Gu.extension={type:[z.WebGLSystem,z.WebGPUSystem,z.CanvasSystem],name:"globalUniforms"}});var fQ,$u,fE=$(()=>{ee();ml();fQ=1,$u=class{constructor(){this._tasks=[],this._offset=0}init(){yr.system.add(this._update,this)}repeat(e,t,r=!0){let i=fQ++,s=0;return r&&(this._offset+=1e3,s=this._offset),this._tasks.push({func:e,duration:t,start:performance.now(),offset:s,last:performance.now(),repeat:!0,id:i}),i}cancel(e){for(let t=0;t<this._tasks.length;t++)if(this._tasks[t].id===e){this._tasks.splice(t,1);return}}_update(){let e=performance.now();for(let t=0;t<this._tasks.length;t++){let r=this._tasks[t];if(e-r.offset-r.last>=r.duration){let i=e-r.start;r.func(i),r.last=e}}}destroy(){yr.system.remove(this._update,this),this._tasks.length=0}};$u.extension={type:[z.WebGLSystem,z.WebGPUSystem,z.CanvasSystem],name:"scheduler",priority:0}});function rg(n){if(!yN){if(Fe.get().getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){let e=[`%c  %c  %c  %c  %c PixiJS %c v${ql} (${n}) http://www.pixijs.com/

`,"background: #E72264; padding:5px 0;","background: #6CA2EA; padding:5px 0;","background: #B5D33D; padding:5px 0;","background: #FED23F; padding:5px 0;","color: #FFFFFF; background: #E72264; padding:5px 0;","color: #E72264; background: #FFFFFF; padding:5px 0;"];globalThis.console.log(...e)}else globalThis.console&&globalThis.console.log(`PixiJS ${ql} - ${n} - http://www.pixijs.com/`);yN=!0}}var yN,hE=$(()=>{Vt();K8();yN=!1});var Lo,pE=$(()=>{ee();hE();Yi();Lo=class{constructor(e){this._renderer=e}init(e){if(e.hello){let t=this._renderer.name;this._renderer.type===Bt.WEBGL&&(t+=` ${this._renderer.context.webGLVersion}`),rg(t)}}};Lo.extension={type:[z.WebGLSystem,z.WebGPUSystem,z.CanvasSystem],name:"hello",priority:-2};Lo.defaultOptions={hello:!1}});function ng(n){let e=!1;for(let r in n)if(n[r]==null){e=!0;break}if(!e)return n;let t=Object.create(null);for(let r in n){let i=n[r];i&&(t[r]=i)}return t}function ig(n){let e=0;for(let t=0;t<n.length;t++)n[t]==null?e++:n[t-e]=n[t];return n.length-=e,n}var mE=$(()=>{"use strict"});var hQ,gE,$0,yE=$(()=>{ee();mE();hQ=0,gE=class xN{constructor(e){this._managedRenderables=[],this._managedHashes=[],this._managedArrays=[],this._renderer=e}init(e){e={...xN.defaultOptions,...e},this.maxUnusedTime=e.renderableGCMaxUnusedTime,this._frequency=e.renderableGCFrequency,this.enabled=e.renderableGCActive}get enabled(){return!!this._handler}set enabled(e){this.enabled!==e&&(e?(this._handler=this._renderer.scheduler.repeat(()=>this.run(),this._frequency,!1),this._hashHandler=this._renderer.scheduler.repeat(()=>{for(let t of this._managedHashes)t.context[t.hash]=ng(t.context[t.hash])},this._frequency),this._arrayHandler=this._renderer.scheduler.repeat(()=>{for(let t of this._managedArrays)ig(t.context[t.hash])},this._frequency)):(this._renderer.scheduler.cancel(this._handler),this._renderer.scheduler.cancel(this._hashHandler),this._renderer.scheduler.cancel(this._arrayHandler)))}addManagedHash(e,t){this._managedHashes.push({context:e,hash:t})}addManagedArray(e,t){this._managedArrays.push({context:e,hash:t})}prerender({container:e}){this._now=performance.now(),e.renderGroup.gcTick=hQ++,this._updateInstructionGCTick(e.renderGroup,e.renderGroup.gcTick)}addRenderable(e){this.enabled&&(e._lastUsed===-1&&(this._managedRenderables.push(e),e.once("destroyed",this._removeRenderable,this)),e._lastUsed=this._now)}run(){let e=this._now,t=this._managedRenderables,r=this._renderer.renderPipes,i=0;for(let s=0;s<t.length;s++){let o=t[s];if(o===null){i++;continue}let a=o.renderGroup??o.parentRenderGroup,l=a?.instructionSet?.gcTick??-1;if((a?.gcTick??0)===l&&(o._lastUsed=e),e-o._lastUsed>this.maxUnusedTime){if(!o.destroyed){let c=r;a&&(a.structureDidChange=!0),c[o.renderPipeId].destroyRenderable(o)}o._lastUsed=-1,i++,o.off("destroyed",this._removeRenderable,this)}else t[s-i]=o}t.length-=i}destroy(){this.enabled=!1,this._renderer=null,this._managedRenderables.length=0,this._managedHashes.length=0,this._managedArrays.length=0}_removeRenderable(e){let t=this._managedRenderables.indexOf(e);t>=0&&(e.off("destroyed",this._removeRenderable,this),this._managedRenderables[t]=null)}_updateInstructionGCTick(e,t){e.instructionSet.gcTick=t;for(let r of e.renderGroupChildren)this._updateInstructionGCTick(r,t)}};gE.extension={type:[z.WebGLSystem,z.WebGPUSystem],name:"renderableGC",priority:0};gE.defaultOptions={renderableGCActive:!0,renderableGCMaxUnusedTime:6e4,renderableGCFrequency:3e4};$0=gE});var xE,sg,bE=$(()=>{ee();xE=class bN{constructor(e){this._renderer=e,this.count=0,this.checkCount=0}init(e){e={...bN.defaultOptions,...e},this.checkCountMax=e.textureGCCheckCountMax,this.maxIdle=e.textureGCAMaxIdle??e.textureGCMaxIdle,this.active=e.textureGCActive}postrender(){this._renderer.renderingToScreen&&(this.count++,this.active&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let e=this._renderer.texture.managedTextures;for(let t=0;t<e.length;t++){let r=e[t];r.autoGarbageCollect&&r.resource&&r._touched>-1&&this.count-r._touched>this.maxIdle&&(r._touched=-1,r.unload())}}destroy(){this._renderer=null}};xE.extension={type:[z.WebGLSystem,z.WebGPUSystem],name:"textureGC"};xE.defaultOptions={textureGCActive:!0,textureGCAMaxIdle:null,textureGCMaxIdle:60*60,textureGCCheckCountMax:600};sg=xE});var _N,zu,og=$(()=>{_n();cn();_t();_N=class vN{constructor(e={}){if(this.uid=gt("renderTarget"),this.colorTextures=[],this.dirtyId=0,this.isRoot=!1,this._size=new Float32Array(2),this._managedColorTextures=!1,e={...vN.defaultOptions,...e},this.stencil=e.stencil,this.depth=e.depth,this.isRoot=e.isRoot,typeof e.colorTextures=="number"){this._managedColorTextures=!0;for(let t=0;t<e.colorTextures;t++)this.colorTextures.push(new ot({width:e.width,height:e.height,resolution:e.resolution,antialias:e.antialias}))}else{this.colorTextures=[...e.colorTextures.map(r=>r.source)];let t=this.colorTexture.source;this.resize(t.width,t.height,t._resolution)}this.colorTexture.source.on("resize",this.onSourceResize,this),(e.depthStencilTexture||this.stencil)&&(e.depthStencilTexture instanceof re||e.depthStencilTexture instanceof ot?this.depthStencilTexture=e.depthStencilTexture.source:this.ensureDepthStencilTexture())}get size(){let e=this._size;return e[0]=this.pixelWidth,e[1]=this.pixelHeight,e}get width(){return this.colorTexture.source.width}get height(){return this.colorTexture.source.height}get pixelWidth(){return this.colorTexture.source.pixelWidth}get pixelHeight(){return this.colorTexture.source.pixelHeight}get resolution(){return this.colorTexture.source._resolution}get colorTexture(){return this.colorTextures[0]}onSourceResize(e){this.resize(e.width,e.height,e._resolution,!0)}ensureDepthStencilTexture(){this.depthStencilTexture||(this.depthStencilTexture=new ot({width:this.width,height:this.height,resolution:this.resolution,format:"depth24plus-stencil8",autoGenerateMipmaps:!1,antialias:!1,mipLevelCount:1}))}resize(e,t,r=this.resolution,i=!1){this.dirtyId++,this.colorTextures.forEach((s,o)=>{i&&o===0||s.source.resize(e,t,r)}),this.depthStencilTexture&&this.depthStencilTexture.source.resize(e,t,r)}destroy(){this.colorTexture.source.off("resize",this.onSourceResize,this),this._managedColorTextures&&this.colorTextures.forEach(e=>{e.destroy()}),this.depthStencilTexture&&(this.depthStencilTexture.destroy(),delete this.depthStencilTexture)}};_N.defaultOptions={width:0,height:0,resolution:1,colorTextures:1,stencil:!1,depth:!1,antialias:!1,isRoot:!1};zu=_N});function H0(n,e){if(!z0.has(n)){let t=new re({source:new Cn({resource:n,...e})}),r=()=>{z0.get(n)===t&&z0.delete(n)};t.once("destroy",r),t.source.once("destroy",r),z0.set(n,t)}return z0.get(n)}function wN(n){return z0.has(n)}var z0,ag=$(()=>{Zc();_t();z0=new Map});var _E,W0,vE=$(()=>{Vt();ee();Qr();zt();og();ag();_E=class SN{get autoDensity(){return this.texture.source.autoDensity}set autoDensity(e){this.texture.source.autoDensity=e}get resolution(){return this.texture.source._resolution}set resolution(e){this.texture.source.resize(this.texture.source.width,this.texture.source.height,e)}init(e){e={...SN.defaultOptions,...e},e.view&&(oe(Ie,"ViewSystem.view has been renamed to ViewSystem.canvas"),e.canvas=e.view),this.screen=new $e(0,0,e.width,e.height),this.canvas=e.canvas||Fe.get().createCanvas(),this.antialias=!!e.antialias,this.texture=H0(this.canvas,e),this.renderTarget=new zu({colorTextures:[this.texture],depth:!!e.depth,isRoot:!0}),this.texture.source.transparent=e.backgroundAlpha<1,this.resolution=e.resolution}resize(e,t,r){this.texture.source.resize(e,t,r),this.screen.width=this.texture.frame.width,this.screen.height=this.texture.frame.height}destroy(e=!1){(typeof e=="boolean"?e:!!e?.removeView)&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}};_E.extension={type:[z.WebGLSystem,z.WebGPUSystem,z.CanvasSystem],name:"view",priority:0};_E.defaultOptions={width:800,height:600,autoDensity:!1,antialias:!1};W0=_E});var V0,j0,lg=$(()=>{GA();$A();VA();jA();Q8();qA();eE();tE();rE();iE();sE();lE();uE();dE();fE();pE();yE();bE();vE();V0=[eg,Gu,Lo,W0,Du,sg,Uu,tg,Fu,$0,$u],j0=[Lu,i3,Mu,Iu,Bu,Ou,Nu,Tu]});var Hu,wE=$(()=>{ee();Hu=class{constructor(e){this._hash=Object.create(null),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_hash")}contextChange(e){this._gpu=e}getBindGroup(e,t,r){return e._updateKey(),this._hash[e._key]||this._createBindGroup(e,t,r)}_createBindGroup(e,t,r){let i=this._gpu.device,s=t.layout[r],o=[],a=this._renderer;for(let u in s){let d=e.resources[u]??e.resources[s[u]],f;if(d._resourceType==="uniformGroup"){let h=d;a.ubo.updateUniformGroup(h);let p=h.buffer;f={buffer:a.buffer.getGPUBuffer(p),offset:0,size:p.descriptor.size}}else if(d._resourceType==="buffer"){let h=d;f={buffer:a.buffer.getGPUBuffer(h),offset:0,size:h.descriptor.size}}else if(d._resourceType==="bufferResource"){let h=d;f={buffer:a.buffer.getGPUBuffer(h.buffer),offset:h.offset,size:h.size}}else if(d._resourceType==="textureSampler"){let h=d;f=a.texture.getGpuSampler(h)}else if(d._resourceType==="textureSource"){let h=d;f=a.texture.getGpuSource(h).createView({})}o.push({binding:s[u],resource:f})}let l=a.shader.getProgramData(t).bindGroups[r],c=i.createBindGroup({layout:l,entries:o});return this._hash[e._key]=c,c}destroy(){for(let e of Object.keys(this._hash))this._hash[e]=null;this._hash=null,this._renderer=null}};Hu.extension={type:[z.WebGPUSystem],name:"bindGroup"}});var Wu,SE=$(()=>{ee();H7();Wu=class{constructor(e){this._gpuBuffers=Object.create(null),this._managedBuffers=[],e.renderableGC.addManagedHash(this,"_gpuBuffers")}contextChange(e){this._gpu=e}getGPUBuffer(e){return this._gpuBuffers[e.uid]||this.createGPUBuffer(e)}updateBuffer(e){let t=this._gpuBuffers[e.uid]||this.createGPUBuffer(e),r=e.data;return e._updateID&&r&&(e._updateID=0,this._gpu.device.queue.writeBuffer(t,0,r.buffer,0,(e._updateSize||r.byteLength)+3&-4)),t}destroyAll(){for(let e in this._gpuBuffers)this._gpuBuffers[e].destroy();this._gpuBuffers={}}createGPUBuffer(e){this._gpuBuffers[e.uid]||(e.on("update",this.updateBuffer,this),e.on("change",this.onBufferChange,this),e.on("destroy",this.onBufferDestroy,this),this._managedBuffers.push(e));let t=this._gpu.device.createBuffer(e.descriptor);return e._updateID=0,e.data&&(eu(e.data.buffer,t.getMappedRange()),t.unmap()),this._gpuBuffers[e.uid]=t,t}onBufferChange(e){this._gpuBuffers[e.uid].destroy(),e._updateID=0,this._gpuBuffers[e.uid]=this.createGPUBuffer(e)}onBufferDestroy(e){this._managedBuffers.splice(this._managedBuffers.indexOf(e),1),this._destroyBuffer(e)}destroy(){this._managedBuffers.forEach(e=>this._destroyBuffer(e)),this._managedBuffers=null,this._gpuBuffers=null}_destroyBuffer(e){this._gpuBuffers[e.uid].destroy(),e.off("update",this.updateBuffer,this),e.off("change",this.onBufferChange,this),e.off("destroy",this.onBufferDestroy,this),this._gpuBuffers[e.uid]=null}};Wu.extension={type:[z.WebGPUSystem],name:"buffer"}});var Vu,CE=$(()=>{ee();Vu=class{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.pipeline.setColorMask(e))}destroy(){this._renderer=null,this._colorMaskCache=null}};Vu.extension={type:[z.WebGPUSystem],name:"colorMask"}});var Yl,AE=$(()=>{Vt();ee();Yl=class{constructor(e){this._renderer=e}async init(e){return this._initPromise?this._initPromise:(this._initPromise=this._createDeviceAndAdaptor(e).then(t=>{this.gpu=t,this._renderer.runners.contextChange.emit(this.gpu)}),this._initPromise)}contextChange(e){this._renderer.gpu=e}async _createDeviceAndAdaptor(e){let t=await Fe.get().getNavigator().gpu.requestAdapter({powerPreference:e.powerPreference,forceFallbackAdapter:e.forceFallbackAdapter}),r=["texture-compression-bc","texture-compression-astc","texture-compression-etc2"].filter(s=>t.features.has(s)),i=await t.requestDevice({requiredFeatures:r});return{adapter:t,device:i}}destroy(){this.gpu=null,this._renderer=null}};Yl.extension={type:[z.WebGPUSystem],name:"device"};Yl.defaultOptions={powerPreference:void 0,forceFallbackAdapter:!1}});var ju,EE=$(()=>{ee();ju=class{constructor(e){this._boundBindGroup=Object.create(null),this._boundVertexBuffer=Object.create(null),this._renderer=e}renderStart(){this.commandFinished=new Promise(e=>{this._resolveCommandFinished=e}),this.commandEncoder=this._renderer.gpu.device.createCommandEncoder()}beginRenderPass(e){this.endRenderPass(),this._clearCache(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(e.descriptor)}endRenderPass(){this.renderPassEncoder&&this.renderPassEncoder.end(),this.renderPassEncoder=null}setViewport(e){this.renderPassEncoder.setViewport(e.x,e.y,e.width,e.height,0,1)}setPipelineFromGeometryProgramAndState(e,t,r,i){let s=this._renderer.pipeline.getPipeline(e,t,r,i);this.setPipeline(s)}setPipeline(e){this._boundPipeline!==e&&(this._boundPipeline=e,this.renderPassEncoder.setPipeline(e))}_setVertexBuffer(e,t){this._boundVertexBuffer[e]!==t&&(this._boundVertexBuffer[e]=t,this.renderPassEncoder.setVertexBuffer(e,this._renderer.buffer.updateBuffer(t)))}_setIndexBuffer(e){if(this._boundIndexBuffer===e)return;this._boundIndexBuffer=e;let t=e.data.BYTES_PER_ELEMENT===2?"uint16":"uint32";this.renderPassEncoder.setIndexBuffer(this._renderer.buffer.updateBuffer(e),t)}resetBindGroup(e){this._boundBindGroup[e]=null}setBindGroup(e,t,r){if(this._boundBindGroup[e]===t)return;this._boundBindGroup[e]=t,t._touch(this._renderer.textureGC.count);let i=this._renderer.bindGroup.getBindGroup(t,r,e);this.renderPassEncoder.setBindGroup(e,i)}setGeometry(e,t){let r=this._renderer.pipeline.getBufferNamesToBind(e,t);for(let i in r)this._setVertexBuffer(i,e.attributes[r[i]].buffer);e.indexBuffer&&this._setIndexBuffer(e.indexBuffer)}_setShaderBindGroups(e,t){for(let r in e.groups){let i=e.groups[r];t||this._syncBindGroup(i),this.setBindGroup(r,i,e.gpuProgram)}}_syncBindGroup(e){for(let t in e.resources){let r=e.resources[t];r.isUniformGroup&&this._renderer.ubo.updateUniformGroup(r)}}draw(e){let{geometry:t,shader:r,state:i,topology:s,size:o,start:a,instanceCount:l,skipSync:c}=e;this.setPipelineFromGeometryProgramAndState(t,r.gpuProgram,i,s),this.setGeometry(t,r.gpuProgram),this._setShaderBindGroups(r,c),t.indexBuffer?this.renderPassEncoder.drawIndexed(o||t.indexBuffer.data.length,l??t.instanceCount,a||0):this.renderPassEncoder.draw(o||t.getSize(),l??t.instanceCount,a||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this._gpu.device.queue.submit([this.commandEncoder.finish()]),this._resolveCommandFinished(),this.commandEncoder=null}restoreRenderPass(){let e=this._renderer.renderTarget.adaptor.getDescriptor(this._renderer.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(e);let t=this._boundPipeline,r={...this._boundVertexBuffer},i=this._boundIndexBuffer,s={...this._boundBindGroup};this._clearCache();let o=this._renderer.renderTarget.viewport;this.renderPassEncoder.setViewport(o.x,o.y,o.width,o.height,0,1),this.setPipeline(t);for(let a in r)this._setVertexBuffer(a,r[a]);for(let a in s)this.setBindGroup(a,s[a],null);this._setIndexBuffer(i)}_clearCache(){for(let e=0;e<16;e++)this._boundBindGroup[e]=null,this._boundVertexBuffer[e]=null;this._boundIndexBuffer=null,this._boundPipeline=null}destroy(){this._renderer=null,this._gpu=null,this._boundBindGroup=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundPipeline=null}contextChange(e){this._gpu=e}};ju.extension={type:[z.WebGPUSystem],name:"encoder",priority:1}});var Xu,TE=$(()=>{ee();Cl();Xu=class{constructor(e){this._renderTargetStencilState=Object.create(null),this._renderer=e,e.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(e){let t=this._renderTargetStencilState[e.uid];t||(t=this._renderTargetStencilState[e.uid]={stencilMode:Jt.DISABLED,stencilReference:0}),this._activeRenderTarget=e,this.setStencilMode(t.stencilMode,t.stencilReference)}setStencilMode(e,t){let r=this._renderTargetStencilState[this._activeRenderTarget.uid];r.stencilMode=e,r.stencilReference=t;let i=this._renderer;i.pipeline.setStencilMode(e),i.encoder.renderPassEncoder.setStencilReference(t)}destroy(){this._renderer.renderTarget.onRenderTargetChange.remove(this),this._renderer=null,this._activeRenderTarget=null,this._renderTargetStencilState=null}};Xu.extension={type:[z.WebGPUSystem],name:"stencil"}});var Kl,cg=$(()=>{O8();Po();qs();Kl=class{constructor(e){this._syncFunctionHash=Object.create(null),this._adaptor=e,this._systemCheck()}_systemCheck(){if(!O0())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}ensureUniformGroup(e){let t=this.getUniformGroupData(e);e.buffer||(e.buffer=new ar({data:new Float32Array(t.layout.size/4),usage:nt.UNIFORM|nt.COPY_DST}))}getUniformGroupData(e){return this._syncFunctionHash[e._signature]||this._initUniformGroup(e)}_initUniformGroup(e){let t=e._signature,r=this._syncFunctionHash[t];if(!r){let i=Object.keys(e.uniformStructures).map(a=>e.uniformStructures[a]),s=this._adaptor.createUboElements(i),o=this._generateUboSync(s.uboElements);r=this._syncFunctionHash[t]={layout:s,syncFunction:o}}return this._syncFunctionHash[t]}_generateUboSync(e){return this._adaptor.generateUboSync(e)}syncUniformGroup(e,t,r){let i=this.getUniformGroupData(e);e.buffer||(e.buffer=new ar({data:new Float32Array(i.layout.size/4),usage:nt.UNIFORM|nt.COPY_DST}));let s=null;return t||(t=e.buffer.data,s=e.buffer.dataInt32),r||(r=0),i.syncFunction(e.uniforms,t,s,r),!0}updateUniformGroup(e){if(e.isStatic&&!e._dirtyId)return!1;e._dirtyId=0;let t=this.syncUniformGroup(e);return e.buffer.update(),t}destroy(){this._syncFunctionHash=null}}});function ug(n){let e=n.map(r=>({data:r,offset:0,size:0})),t=0;for(let r=0;r<e.length;r++){let i=e[r],s=qu[i.data.type].size,o=qu[i.data.type].align;if(!qu[i.data.type])throw new Error(`[Pixi.js] WebGPU UniformBuffer: Unknown type ${i.data.type}`);i.data.size>1&&(s=Math.max(s,o)*i.data.size),t=Math.ceil(t/o)*o,i.size=s,i.offset=t,t+=s}return t=Math.ceil(t/16)*16,{uboElements:e,size:t}}var qu,dg=$(()=>{"use strict";qu={i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},f16:{align:2,size:2},"vec2<i32>":{align:8,size:8},"vec2<u32>":{align:8,size:8},"vec2<f32>":{align:8,size:8},"vec2<f16>":{align:4,size:4},"vec3<i32>":{align:16,size:12},"vec3<u32>":{align:16,size:12},"vec3<f32>":{align:16,size:12},"vec3<f16>":{align:8,size:6},"vec4<i32>":{align:16,size:16},"vec4<u32>":{align:16,size:16},"vec4<f32>":{align:16,size:16},"vec4<f16>":{align:8,size:8},"mat2x2<f32>":{align:8,size:16},"mat2x2<f16>":{align:4,size:8},"mat3x2<f32>":{align:8,size:24},"mat3x2<f16>":{align:4,size:12},"mat4x2<f32>":{align:8,size:32},"mat4x2<f16>":{align:4,size:16},"mat2x3<f32>":{align:16,size:32},"mat2x3<f16>":{align:8,size:16},"mat3x3<f32>":{align:16,size:48},"mat3x3<f16>":{align:8,size:24},"mat4x3<f32>":{align:16,size:64},"mat4x3<f16>":{align:8,size:32},"mat2x4<f32>":{align:16,size:32},"mat2x4<f16>":{align:8,size:16},"mat3x4<f32>":{align:16,size:48},"mat3x4<f16>":{align:8,size:24},"mat4x4<f32>":{align:16,size:64},"mat4x4<f16>":{align:8,size:32}}});var to,fg=$(()=>{"use strict";to=[{type:"mat3x3<f32>",test:n=>n.value.a!==void 0,ubo:`
            var matrix = uv[name].toArray(true);
            data[offset] = matrix[0];
            data[offset + 1] = matrix[1];
            data[offset + 2] = matrix[2];
            data[offset + 4] = matrix[3];
            data[offset + 5] = matrix[4];
            data[offset + 6] = matrix[5];
            data[offset + 8] = matrix[6];
            data[offset + 9] = matrix[7];
            data[offset + 10] = matrix[8];
        `,uniform:`
            gl.uniformMatrix3fv(ud[name].location, false, uv[name].toArray(true));
        `},{type:"vec4<f32>",test:n=>n.type==="vec4<f32>"&&n.size===1&&n.value.width!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.x;
            data[offset + 1] = v.y;
            data[offset + 2] = v.width;
            data[offset + 3] = v.height;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height) {
                cv[0] = v.x;
                cv[1] = v.y;
                cv[2] = v.width;
                cv[3] = v.height;
                gl.uniform4f(ud[name].location, v.x, v.y, v.width, v.height);
            }
        `},{type:"vec2<f32>",test:n=>n.type==="vec2<f32>"&&n.size===1&&n.value.x!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.x;
            data[offset + 1] = v.y;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.x || cv[1] !== v.y) {
                cv[0] = v.x;
                cv[1] = v.y;
                gl.uniform2f(ud[name].location, v.x, v.y);
            }
        `},{type:"vec4<f32>",test:n=>n.type==="vec4<f32>"&&n.size===1&&n.value.red!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.red;
            data[offset + 1] = v.green;
            data[offset + 2] = v.blue;
            data[offset + 3] = v.alpha;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha) {
                cv[0] = v.red;
                cv[1] = v.green;
                cv[2] = v.blue;
                cv[3] = v.alpha;
                gl.uniform4f(ud[name].location, v.red, v.green, v.blue, v.alpha);
            }
        `},{type:"vec3<f32>",test:n=>n.type==="vec3<f32>"&&n.size===1&&n.value.red!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.red;
            data[offset + 1] = v.green;
            data[offset + 2] = v.blue;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue) {
                cv[0] = v.red;
                cv[1] = v.green;
                cv[2] = v.blue;
                gl.uniform3f(ud[name].location, v.red, v.green, v.blue);
            }
        `}]});function X0(n,e,t,r){let i=[`
        var v = null;
        var v2 = null;
        var t = 0;
        var index = 0;
        var name = null;
        var arrayOffset = null;
    `],s=0;for(let a=0;a<n.length;a++){let l=n[a],c=l.data.name,u=!1,d=0;for(let f=0;f<to.length;f++)if(to[f].test(l.data)){d=l.offset/4,i.push(`name = "${c}";`,`offset += ${d-s};`,to[f][e]||to[f].ubo),u=!0;break}if(!u)if(l.data.size>1)d=l.offset/4,i.push(t(l,d-s));else{let f=r[l.data.type];d=l.offset/4,i.push(`
                    v = uv.${c};
                    offset += ${d-s};
                    ${f};
                `)}s=d}let o=i.join(`
`);return new Function("uv","data","dataInt32","offset",o)}var hg=$(()=>{fg()});function q0(n,e){return`
        for (let i = 0; i < ${n*e}; i++) {
            data[offset + (((i / ${n})|0) * 4) + (i % ${n})] = v[i];
        }
    `}var a3,pg,mg=$(()=>{"use strict";a3={f32:`
        data[offset] = v;`,i32:`
        dataInt32[offset] = v;`,"vec2<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];`,"vec3<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];`,"vec4<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];
        data[offset + 3] = v[3];`,"vec2<i32>":`
        dataInt32[offset] = v[0];
        dataInt32[offset + 1] = v[1];`,"vec3<i32>":`
        dataInt32[offset] = v[0];
        dataInt32[offset + 1] = v[1];
        dataInt32[offset + 2] = v[2];`,"vec4<i32>":`
        dataInt32[offset] = v[0];
        dataInt32[offset + 1] = v[1];
        dataInt32[offset + 2] = v[2];
        dataInt32[offset + 3] = v[3];`,"mat2x2<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 4] = v[2];
        data[offset + 5] = v[3];`,"mat3x3<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];
        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];
        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];`,"mat4x4<f32>":`
        for (let i = 0; i < 16; i++) {
            data[offset + i] = v[i];
        }`,"mat3x2<f32>":q0(3,2),"mat4x2<f32>":q0(4,2),"mat2x3<f32>":q0(2,3),"mat4x3<f32>":q0(4,3),"mat2x4<f32>":q0(2,4),"mat3x4<f32>":q0(3,4)},pg={...a3,"mat2x2<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];
        data[offset + 3] = v[3];
    `}});function gg(n,e){let{size:t,align:r}=qu[n.data.type],i=(r-t)/4,s=n.data.type.indexOf("i32")>=0?"dataInt32":"data";return`
         v = uv.${n.data.name};
         ${e!==0?`offset += ${e};`:""}

         arrayOffset = offset;

         t = 0;

         for(var i=0; i < ${n.data.size*(t/4)}; i++)
         {
             for(var j = 0; j < ${t/4}; j++)
             {
                 ${s}[arrayOffset++] = v[t++];
             }
             ${i!==0?`arrayOffset += ${i};`:""}
         }
     `}var kE=$(()=>{dg()});function yg(n){return X0(n,"uboWgsl",gg,pg)}var IE=$(()=>{hg();mg();kE()});var Yu,PE=$(()=>{ee();cg();dg();IE();Yu=class extends Kl{constructor(){super({createUboElements:ug,generateUboSync:yg})}};Yu.extension={type:[z.WebGPUSystem],name:"ubo"}});var Uo,l3=$(()=>{Nn();_n();Uo=class extends st{constructor({buffer:e,offset:t,size:r}){super(),this.uid=gt("buffer"),this._resourceType="bufferResource",this._touched=0,this._resourceId=gt("resource"),this._bufferResource=!0,this.destroyed=!1,this.buffer=e,this.offset=t|0,this.size=r,this.buffer.on("change",this.onBufferChange,this)}onBufferChange(){this._resourceId=gt("resource"),this.emit("change",this)}destroy(e=!1){this.destroyed=!0,e&&this.buffer.destroy(),this.emit("change",this),this.buffer=null}}});var Y0,DE=$(()=>{"use strict";Y0=class{constructor({minUniformOffsetAlignment:e}){this._minUniformOffsetAlignment=256,this.byteIndex=0,this._minUniformOffsetAlignment=e,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(e){if(e>this._minUniformOffsetAlignment/4)throw new Error(`UniformBufferBatch: array is too large: ${e*4}`);let t=this.byteIndex,r=t+e*4;if(r=Math.ceil(r/this._minUniformOffsetAlignment)*this._minUniformOffsetAlignment,r>this.data.length*4)throw new Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=r,t}addGroup(e){let t=this.addEmptyGroup(e.length);for(let r=0;r<e.length;r++)this.data[t/4+r]=e[r];return t}destroy(){this.data=null}}});var Ql,Ku,ME=$(()=>{ee();Po();l3();qs();DE();Ca();Ql=128,Ku=class{constructor(e){this._bindGroupHash=Object.create(null),this._buffers=[],this._bindGroups=[],this._bufferResources=[],this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_bindGroupHash"),this._batchBuffer=new Y0({minUniformOffsetAlignment:Ql});let t=256/Ql;for(let r=0;r<t;r++){let i=nt.UNIFORM|nt.COPY_DST;r===0&&(i|=nt.COPY_SRC),this._buffers.push(new ar({data:this._batchBuffer.data,usage:i}))}}renderEnd(){this._uploadBindGroups(),this._resetBindGroups()}_resetBindGroups(){for(let e in this._bindGroupHash)this._bindGroupHash[e]=null;this._batchBuffer.clear()}getUniformBindGroup(e,t){if(!t&&this._bindGroupHash[e.uid])return this._bindGroupHash[e.uid];this._renderer.ubo.ensureUniformGroup(e);let r=e.buffer.data,i=this._batchBuffer.addEmptyGroup(r.length);return this._renderer.ubo.syncUniformGroup(e,this._batchBuffer.data,i/4),this._bindGroupHash[e.uid]=this._getBindGroup(i/Ql),this._bindGroupHash[e.uid]}getUboResource(e){this._renderer.ubo.updateUniformGroup(e);let t=e.buffer.data,r=this._batchBuffer.addGroup(t);return this._getBufferResource(r/Ql)}getArrayBindGroup(e){let t=this._batchBuffer.addGroup(e);return this._getBindGroup(t/Ql)}getArrayBufferResource(e){let r=this._batchBuffer.addGroup(e)/Ql;return this._getBufferResource(r)}_getBufferResource(e){if(!this._bufferResources[e]){let t=this._buffers[e%2];this._bufferResources[e]=new Uo({buffer:t,offset:(e/2|0)*256,size:Ql})}return this._bufferResources[e]}_getBindGroup(e){if(!this._bindGroups[e]){let t=new Jr({0:this._getBufferResource(e)});this._bindGroups[e]=t}return this._bindGroups[e]}_uploadBindGroups(){let e=this._renderer.buffer,t=this._buffers[0];t.update(this._batchBuffer.byteIndex),e.updateBuffer(t);let r=this._renderer.gpu.device.createCommandEncoder();for(let i=1;i<this._buffers.length;i++){let s=this._buffers[i];r.copyBufferToBuffer(e.getGPUBuffer(t),Ql,e.getGPUBuffer(s),0,this._batchBuffer.byteIndex)}this._renderer.gpu.device.queue.submit([r.finish()])}destroy(){for(let e=0;e<this._bindGroups.length;e++)this._bindGroups[e].destroy();this._bindGroups=null,this._bindGroupHash=null;for(let e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers=null;for(let e=0;e<this._bufferResources.length;e++)this._bufferResources[e].destroy();this._bufferResources=null,this._batchBuffer.destroy(),this._bindGroupHash=null,this._renderer=null}};Ku.extension={type:[z.WebGPUPipes],name:"uniformBatch"}});function K0(n,e){for(let t in n.attributes){let r=n.attributes[t],i=e[t];i?(r.format??(r.format=i.format),r.offset??(r.offset=i.offset),r.instance??(r.instance=i.instance)):ve(`Attribute ${t} is not present in the shader, but is present in the geometry. Unable to infer attribute details.`)}pQ(n)}function pQ(n){let{buffers:e,attributes:t}=n,r={},i={};for(let s in e){let o=e[s];r[o.uid]=0,i[o.uid]=0}for(let s in t){let o=t[s];r[o.buffer.uid]+=$n(o.format).stride}for(let s in t){let o=t[s];o.stride??(o.stride=r[o.buffer.uid]),o.start??(o.start=i[o.buffer.uid]),i[o.buffer.uid]+=$n(o.format).stride}}var xg=$(()=>{Gt();El()});var Cs,bg=$(()=>{Cl();Cs=[];Cs[Jt.NONE]=void 0;Cs[Jt.DISABLED]={stencilWriteMask:0,stencilReadMask:0};Cs[Jt.RENDERING_MASK_ADD]={stencilFront:{compare:"equal",passOp:"increment-clamp"},stencilBack:{compare:"equal",passOp:"increment-clamp"}};Cs[Jt.RENDERING_MASK_REMOVE]={stencilFront:{compare:"equal",passOp:"decrement-clamp"},stencilBack:{compare:"equal",passOp:"decrement-clamp"}};Cs[Jt.MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"equal",passOp:"keep"},stencilBack:{compare:"equal",passOp:"keep"}};Cs[Jt.INVERSE_MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"not-equal",passOp:"replace"},stencilBack:{compare:"not-equal",passOp:"replace"}}});function gQ(n,e,t,r,i){return n<<24|e<<16|t<<10|r<<5|i}function yQ(n,e,t,r){return t<<6|n<<3|r<<1|e}var mQ,Qu,RE=$(()=>{ee();Gt();xg();Cl();t0();bg();mQ={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};Qu=class{constructor(e){this._moduleCache=Object.create(null),this._bufferLayoutsCache=Object.create(null),this._bindingNamesCache=Object.create(null),this._pipeCache=Object.create(null),this._pipeStateCaches=Object.create(null),this._colorMask=15,this._multisampleCount=1,this._renderer=e}contextChange(e){this._gpu=e,this.setStencilMode(Jt.DISABLED),this._updatePipeHash()}setMultisampleCount(e){this._multisampleCount!==e&&(this._multisampleCount=e,this._updatePipeHash())}setRenderTarget(e){this._multisampleCount=e.msaaSamples,this._depthStencilAttachment=e.descriptor.depthStencilAttachment?1:0,this._updatePipeHash()}setColorMask(e){this._colorMask!==e&&(this._colorMask=e,this._updatePipeHash())}setStencilMode(e){this._stencilMode!==e&&(this._stencilMode=e,this._stencilState=Cs[e],this._updatePipeHash())}setPipeline(e,t,r,i){let s=this.getPipeline(e,t,r);i.setPipeline(s)}getPipeline(e,t,r,i){e._layoutKey||(K0(e,t.attributeData),this._generateBufferKey(e)),i||(i=e.topology);let s=gQ(e._layoutKey,t._layoutKey,r.data,r._blendModeId,mQ[i]);return this._pipeCache[s]?this._pipeCache[s]:(this._pipeCache[s]=this._createPipeline(e,t,r,i),this._pipeCache[s])}_createPipeline(e,t,r,i){let s=this._gpu.device,o=this._createVertexBufferLayouts(e,t),a=this._renderer.state.getColorTargets(r);a[0].writeMask=this._stencilMode===Jt.RENDERING_MASK_ADD?0:this._colorMask;let l=this._renderer.shader.getProgramData(t).pipeline,c={vertex:{module:this._getModule(t.vertex.source),entryPoint:t.vertex.entryPoint,buffers:o},fragment:{module:this._getModule(t.fragment.source),entryPoint:t.fragment.entryPoint,targets:a},primitive:{topology:i,cullMode:r.cullMode},layout:l,multisample:{count:this._multisampleCount},label:"PIXI Pipeline"};return this._depthStencilAttachment&&(c.depthStencil={...this._stencilState,format:"depth24plus-stencil8",depthWriteEnabled:r.depthTest,depthCompare:r.depthTest?"less":"always"}),s.createRenderPipeline(c)}_getModule(e){return this._moduleCache[e]||this._createModule(e)}_createModule(e){let t=this._gpu.device;return this._moduleCache[e]=t.createShaderModule({code:e}),this._moduleCache[e]}_generateBufferKey(e){let t=[],r=0,i=Object.keys(e.attributes).sort();for(let o=0;o<i.length;o++){let a=e.attributes[i[o]];t[r++]=a.offset,t[r++]=a.format,t[r++]=a.stride,t[r++]=a.instance}let s=t.join("|");return e._layoutKey=Ys(s,"geometry"),e._layoutKey}_generateAttributeLocationsKey(e){let t=[],r=0,i=Object.keys(e.attributeData).sort();for(let o=0;o<i.length;o++){let a=e.attributeData[i[o]];t[r++]=a.location}let s=t.join("|");return e._attributeLocationsKey=Ys(s,"programAttributes"),e._attributeLocationsKey}getBufferNamesToBind(e,t){let r=e._layoutKey<<16|t._attributeLocationsKey;if(this._bindingNamesCache[r])return this._bindingNamesCache[r];let i=this._createVertexBufferLayouts(e,t),s=Object.create(null),o=t.attributeData;for(let a=0;a<i.length;a++){let c=Object.values(i[a].attributes)[0].shaderLocation;for(let u in o)if(o[u].location===c){s[a]=u;break}}return this._bindingNamesCache[r]=s,s}_createVertexBufferLayouts(e,t){t._attributeLocationsKey||this._generateAttributeLocationsKey(t);let r=e._layoutKey<<16|t._attributeLocationsKey;if(this._bufferLayoutsCache[r])return this._bufferLayoutsCache[r];let i=[];return e.buffers.forEach(s=>{let o={arrayStride:0,stepMode:"vertex",attributes:[]},a=o.attributes;for(let l in t.attributeData){let c=e.attributes[l];(c.divisor??1)!==1&&ve(`Attribute ${l} has an invalid divisor value of '${c.divisor}'. WebGPU only supports a divisor value of 1`),c.buffer===s&&(o.arrayStride=c.stride,o.stepMode=c.instance?"instance":"vertex",a.push({shaderLocation:t.attributeData[l].location,offset:c.offset,format:c.format}))}a.length&&i.push(o)}),this._bufferLayoutsCache[r]=i,i}_updatePipeHash(){let e=yQ(this._stencilMode,this._multisampleCount,this._colorMask,this._depthStencilAttachment);this._pipeStateCaches[e]||(this._pipeStateCaches[e]=Object.create(null)),this._pipeCache=this._pipeStateCaches[e]}destroy(){this._renderer=null,this._bufferLayoutsCache=null}};Qu.extension={type:[z.WebGPUSystem],name:"pipeline"}});function _g(n,e,t,r,i,s){let o=s?1:-1;return n.identity(),n.a=1/r*2,n.d=o*(1/i*2),n.tx=-1-e*n.a,n.ty=-o-t*n.d,n}var FE=$(()=>{"use strict"});function vg(n){let e=n.colorTexture.source.resource;return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement&&document.body.contains(e)}var BE=$(()=>{"use strict"});var Zl,wg=$(()=>{Ct();Qr();Su();FE();L8();Zc();cn();_t();ag();BE();og();Zl=class{constructor(e){this.rootViewPort=new $e,this.viewport=new $e,this.onRenderTargetChange=new jl("onRenderTargetChange"),this.projectionMatrix=new ue,this.defaultClearColor=[0,0,0,0],this._renderSurfaceToRenderTargetHash=new Map,this._gpuRenderTargetHash=Object.create(null),this._renderTargetStack=[],this._renderer=e,e.renderableGC.addManagedHash(this,"_gpuRenderTargetHash")}finishRenderPass(){this.adaptor.finishRenderPass(this.renderTarget)}renderStart({target:e,clear:t,clearColor:r,frame:i}){this._renderTargetStack.length=0,this.push(e,t,r,i),this.rootViewPort.copyFrom(this.viewport),this.rootRenderTarget=this.renderTarget,this.renderingToScreen=vg(this.rootRenderTarget),this.adaptor.prerender?.(this.rootRenderTarget)}postrender(){this.adaptor.postrender?.(this.rootRenderTarget)}bind(e,t=!0,r,i){let s=this.getRenderTarget(e),o=this.renderTarget!==s;this.renderTarget=s,this.renderSurface=e;let a=this.getGpuRenderTarget(s);(s.pixelWidth!==a.width||s.pixelHeight!==a.height)&&(this.adaptor.resizeGpuRenderTarget(s),a.width=s.pixelWidth,a.height=s.pixelHeight);let l=s.colorTexture,c=this.viewport,u=l.pixelWidth,d=l.pixelHeight;if(!i&&e instanceof re&&(i=e.frame),i){let f=l._resolution;c.x=i.x*f+.5|0,c.y=i.y*f+.5|0,c.width=i.width*f+.5|0,c.height=i.height*f+.5|0}else c.x=0,c.y=0,c.width=u,c.height=d;return _g(this.projectionMatrix,0,0,c.width/l.resolution,c.height/l.resolution,!s.isRoot),this.adaptor.startRenderPass(s,t,r,c),o&&this.onRenderTargetChange.emit(s),s}clear(e,t=tn.ALL,r){t&&(e&&(e=this.getRenderTarget(e)),this.adaptor.clear(e||this.renderTarget,t,r,this.viewport))}contextChange(){this._gpuRenderTargetHash=Object.create(null)}push(e,t=tn.ALL,r,i){let s=this.bind(e,t,r,i);return this._renderTargetStack.push({renderTarget:s,frame:i}),s}pop(){this._renderTargetStack.pop();let e=this._renderTargetStack[this._renderTargetStack.length-1];this.bind(e.renderTarget,!1,null,e.frame)}getRenderTarget(e){return e.isTexture&&(e=e.source),this._renderSurfaceToRenderTargetHash.get(e)??this._initRenderTarget(e)}copyToTexture(e,t,r,i,s){r.x<0&&(i.width+=r.x,s.x-=r.x,r.x=0),r.y<0&&(i.height+=r.y,s.y-=r.y,r.y=0);let{pixelWidth:o,pixelHeight:a}=e;return i.width=Math.min(i.width,o-r.x),i.height=Math.min(i.height,a-r.y),this.adaptor.copyToTexture(e,t,r,i,s)}ensureDepthStencil(){this.renderTarget.stencil||(this.renderTarget.stencil=!0,this.adaptor.startRenderPass(this.renderTarget,!1,null,this.viewport))}destroy(){this._renderer=null,this._renderSurfaceToRenderTargetHash.forEach((e,t)=>{e!==t&&e.destroy()}),this._renderSurfaceToRenderTargetHash.clear(),this._gpuRenderTargetHash=Object.create(null)}_initRenderTarget(e){let t=null;return Cn.test(e)&&(e=H0(e).source),e instanceof zu?t=e:e instanceof ot&&(t=new zu({colorTextures:[e]}),Cn.test(e.source.resource)&&(t.isRoot=!0),e.once("destroy",()=>{t.destroy(),this._renderSurfaceToRenderTargetHash.delete(e);let r=this._gpuRenderTargetHash[t.uid];r&&(this._gpuRenderTargetHash[t.uid]=null,this.adaptor.destroyGpuRenderTarget(r))})),this._renderSurfaceToRenderTargetHash.set(e,t),t}getGpuRenderTarget(e){return this._gpuRenderTargetHash[e.uid]||(this._gpuRenderTargetHash[e.uid]=this.adaptor.initGpuRenderTarget(e))}}});var Q0,NE=$(()=>{"use strict";Q0=class{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}});var Z0,OE=$(()=>{Su();Zc();cn();NE();Z0=class{init(e,t){this._renderer=e,this._renderTargetSystem=t}copyToTexture(e,t,r,i,s){let o=this._renderer,a=this._getGpuColorTexture(e),l=o.texture.getGpuSource(t.source);return o.encoder.commandEncoder.copyTextureToTexture({texture:a,origin:r},{texture:l,origin:s},i),t}startRenderPass(e,t=!0,r,i){let o=this._renderTargetSystem.getGpuRenderTarget(e),a=this.getDescriptor(e,t,r);o.descriptor=a,this._renderer.pipeline.setRenderTarget(o),this._renderer.encoder.beginRenderPass(o),this._renderer.encoder.setViewport(i)}finishRenderPass(){this._renderer.encoder.endRenderPass()}_getGpuColorTexture(e){let t=this._renderTargetSystem.getGpuRenderTarget(e);return t.contexts[0]?t.contexts[0].getCurrentTexture():this._renderer.texture.getGpuSource(e.colorTextures[0].source)}getDescriptor(e,t,r){typeof t=="boolean"&&(t=t?tn.ALL:tn.NONE);let i=this._renderTargetSystem,s=i.getGpuRenderTarget(e),o=e.colorTextures.map((c,u)=>{let d=s.contexts[u],f,h;d?f=d.getCurrentTexture().createView():f=this._renderer.texture.getGpuSource(c).createView({mipLevelCount:1}),s.msaaTextures[u]&&(h=f,f=this._renderer.texture.getTextureView(s.msaaTextures[u]));let p=t&tn.COLOR?"clear":"load";return r??(r=i.defaultClearColor),{view:f,resolveTarget:h,clearValue:r,storeOp:"store",loadOp:p}}),a;if((e.stencil||e.depth)&&!e.depthStencilTexture&&(e.ensureDepthStencilTexture(),e.depthStencilTexture.source.sampleCount=s.msaa?4:1),e.depthStencilTexture){let c=t&tn.STENCIL?"clear":"load",u=t&tn.DEPTH?"clear":"load";a={view:this._renderer.texture.getGpuSource(e.depthStencilTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:c,depthClearValue:1,depthLoadOp:u,depthStoreOp:"store"}}return{colorAttachments:o,depthStencilAttachment:a}}clear(e,t=!0,r,i){if(!t)return;let{gpu:s,encoder:o}=this._renderer,a=s.device;if(o.commandEncoder===null){let c=a.createCommandEncoder(),u=this.getDescriptor(e,t,r),d=c.beginRenderPass(u);d.setViewport(i.x,i.y,i.width,i.height,0,1),d.end();let f=c.finish();a.queue.submit([f])}else this.startRenderPass(e,t,r,i)}initGpuRenderTarget(e){e.isRoot=!0;let t=new Q0;return e.colorTextures.forEach((r,i)=>{if(Cn.test(r.resource)){let s=r.resource.getContext("webgpu"),o=r.transparent?"premultiplied":"opaque";try{s.configure({device:this._renderer.gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:o})}catch(a){console.error(a)}t.contexts[i]=s}if(t.msaa=r.source.antialias,r.source.antialias){let s=new ot({width:0,height:0,sampleCount:4});t.msaaTextures[i]=s}}),t.msaa&&(t.msaaSamples=4,e.depthStencilTexture&&(e.depthStencilTexture.source.sampleCount=4)),t}destroyGpuRenderTarget(e){e.contexts.forEach(t=>{t.unconfigure()}),e.msaaTextures.forEach(t=>{t.destroy()}),e.msaaTextures.length=0,e.contexts.length=0}ensureDepthStencilTexture(e){let t=this._renderTargetSystem.getGpuRenderTarget(e);e.depthStencilTexture&&t.msaa&&(e.depthStencilTexture.source.sampleCount=4)}resizeGpuRenderTarget(e){let t=this._renderTargetSystem.getGpuRenderTarget(e);t.width=e.width,t.height=e.height,t.msaa&&e.colorTextures.forEach((r,i)=>{t.msaaTextures[i]?.resize(r.source.width,r.source.height,r.source._resolution)})}}});var Zu,LE=$(()=>{ee();wg();OE();Zu=class extends Zl{constructor(e){super(e),this.adaptor=new Z0,this.adaptor.init(e,this)}};Zu.extension={type:[z.WebGPUSystem],name:"renderTarget"}});var Ju,UE=$(()=>{ee();Ju=class{constructor(){this._gpuProgramData=Object.create(null)}contextChange(e){this._gpu=e,this.maxTextures=e.device.limits.maxSampledTexturesPerShaderStage}getProgramData(e){return this._gpuProgramData[e._layoutKey]||this._createGPUProgramData(e)}_createGPUProgramData(e){let t=this._gpu.device,r=e.gpuLayout.map(s=>t.createBindGroupLayout({entries:s})),i={bindGroupLayouts:r};return this._gpuProgramData[e._layoutKey]={bindGroups:r,pipeline:t.createPipelineLayout(i)},this._gpuProgramData[e._layoutKey]}destroy(){this._gpu=null,this._gpuProgramData=null}};Ju.extension={type:[z.WebGPUSystem],name:"shader"}});var En,GE=$(()=>{"use strict";En={};En.normal={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}};En.add={alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}};En.multiply={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}};En.screen={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}};En.overlay={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}};En.none={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}};En["normal-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}};En["add-npm"]={alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}};En["screen-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}};En.erase={alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"one-minus-src",operation:"add"}};En.min={alpha:{srcFactor:"one",dstFactor:"one",operation:"min"},color:{srcFactor:"one",dstFactor:"one",operation:"min"}};En.max={alpha:{srcFactor:"one",dstFactor:"one",operation:"max"},color:{srcFactor:"one",dstFactor:"one",operation:"max"}}});var e1,$E=$(()=>{ee();Ki();GE();e1=class{constructor(){this.defaultState=new ur,this.defaultState.blend=!0}contextChange(e){this.gpu=e}getColorTargets(e){return[{format:"bgra8unorm",writeMask:0,blend:En[e.blendMode]||En.normal}]}destroy(){this.gpu=null}};e1.extension={type:[z.WebGPUSystem],name:"state"}});var Sg,zE=$(()=>{"use strict";Sg={type:"image",upload(n,e,t){let r=n.resource,i=(n.pixelWidth|0)*(n.pixelHeight|0),s=r.byteLength/i;t.device.queue.writeTexture({texture:e},r,{offset:0,rowsPerImage:n.pixelHeight,bytesPerRow:n.pixelHeight*s},{width:n.pixelWidth,height:n.pixelHeight,depthOrArrayLayers:1})}}});var c3,xQ,Cg,HE=$(()=>{"use strict";c3={"bc1-rgba-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"bc2-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc3-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc7-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"etc1-rgb-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"etc2-rgba8unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"astc-4x4-unorm":{blockBytes:16,blockWidth:4,blockHeight:4}},xQ={blockBytes:4,blockWidth:1,blockHeight:1},Cg={type:"compressed",upload(n,e,t){let r=n.pixelWidth,i=n.pixelHeight,s=c3[n.format]||xQ;for(let o=0;o<n.resource.length;o++){let a=n.resource[o],l=Math.ceil(r/s.blockWidth)*s.blockBytes;t.device.queue.writeTexture({texture:e,mipLevel:o},a,{offset:0,bytesPerRow:l},{width:Math.ceil(r/s.blockWidth)*s.blockWidth,height:Math.ceil(i/s.blockHeight)*s.blockHeight,depthOrArrayLayers:1}),r=Math.max(r>>1,1),i=Math.max(i>>1,1)}}}});var J0,Ag=$(()=>{"use strict";J0={type:"image",upload(n,e,t){let r=n.resource;if(!r)return;let i=Math.min(e.width,n.resourceWidth||n.pixelWidth),s=Math.min(e.height,n.resourceHeight||n.pixelHeight),o=n.alphaMode==="premultiply-alpha-on-upload";t.device.queue.copyExternalImageToTexture({source:r},{texture:e,premultipliedAlpha:o},{width:i,height:s})}}});var Eg,WE=$(()=>{Ag();Eg={type:"video",upload(n,e,t){J0.upload(n,e,t)}}});var ed,VE=$(()=>{"use strict";ed=class{constructor(e){this.device=e,this.sampler=e.createSampler({minFilter:"linear"}),this.pipelines={}}_getMipmapPipeline(e){let t=this.pipelines[e];return t||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:`
                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(
                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));

                        struct VertexOutput {
                        @builtin(position) position : vec4<f32>,
                        @location(0) texCoord : vec2<f32>,
                        };

                        @vertex
                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {
                        var output : VertexOutput;
                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);
                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);
                        return output;
                        }

                        @group(0) @binding(0) var imgSampler : sampler;
                        @group(0) @binding(1) var img : texture_2d<f32>;

                        @fragment
                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {
                        return textureSample(img, imgSampler, texCoord);
                        }
                    `})),t=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:e}]}}),this.pipelines[e]=t),t}generateMipmap(e){let t=this._getMipmapPipeline(e.format);if(e.dimension==="3d"||e.dimension==="1d")throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let r=e,i=e.depthOrArrayLayers||1,s=e.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!s){let l={size:{width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:i},format:e.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:e.mipLevelCount-1};r=this.device.createTexture(l)}let o=this.device.createCommandEncoder({}),a=t.getBindGroupLayout(0);for(let l=0;l<i;++l){let c=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:l,arrayLayerCount:1}),u=s?1:0;for(let d=1;d<e.mipLevelCount;++d){let f=r.createView({baseMipLevel:u++,mipLevelCount:1,dimension:"2d",baseArrayLayer:l,arrayLayerCount:1}),h=o.beginRenderPass({colorAttachments:[{view:f,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),p=this.device.createBindGroup({layout:a,entries:[{binding:0,resource:this.sampler},{binding:1,resource:c}]});h.setPipeline(t),h.setBindGroup(0,p),h.draw(3,1,0,0),h.end(),c=f}}if(!s){let l={width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:i};for(let c=1;c<e.mipLevelCount;++c)o.copyTextureToTexture({texture:r,mipLevel:c-1},{texture:e,mipLevel:c},l),l.width=Math.ceil(l.width/2),l.height=Math.ceil(l.height/2)}return this.device.queue.submit([o.finish()]),s||r.destroy(),e}}});var t1,jE=$(()=>{Vt();ee();Hr();fu();Ca();zE();HE();Ag();WE();VE();t1=class{constructor(e){this.managedTextures=[],this._gpuSources=Object.create(null),this._gpuSamplers=Object.create(null),this._bindGroupHash=Object.create(null),this._textureViewHash=Object.create(null),this._uploads={image:J0,buffer:Sg,video:Eg,compressed:Cg},this._renderer=e,e.renderableGC.addManagedHash(this,"_gpuSources"),e.renderableGC.addManagedHash(this,"_gpuSamplers"),e.renderableGC.addManagedHash(this,"_bindGroupHash"),e.renderableGC.addManagedHash(this,"_textureViewHash")}contextChange(e){this._gpu=e}initSource(e){if(e.autoGenerateMipmaps){let l=Math.max(e.pixelWidth,e.pixelHeight);e.mipLevelCount=Math.floor(Math.log2(l))+1}let t=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST;e.uploadMethodId!=="compressed"&&(t|=GPUTextureUsage.RENDER_ATTACHMENT,t|=GPUTextureUsage.COPY_SRC);let r=c3[e.format]||{blockBytes:4,blockWidth:1,blockHeight:1},i=Math.ceil(e.pixelWidth/r.blockWidth)*r.blockWidth,s=Math.ceil(e.pixelHeight/r.blockHeight)*r.blockHeight,o={label:e.label,size:{width:i,height:s},format:e.format,sampleCount:e.sampleCount,mipLevelCount:e.mipLevelCount,dimension:e.dimension,usage:t},a=this._gpu.device.createTexture(o);return this._gpuSources[e.uid]=a,this.managedTextures.includes(e)||(e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceResize,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),e.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(e)),this.onSourceUpdate(e),a}onSourceUpdate(e){let t=this.getGpuSource(e);t&&(this._uploads[e.uploadMethodId]&&this._uploads[e.uploadMethodId].upload(e,t,this._gpu),e.autoGenerateMipmaps&&e.mipLevelCount>1&&this.onUpdateMipmaps(e))}onSourceUnload(e){let t=this._gpuSources[e.uid];t&&(this._gpuSources[e.uid]=null,t.destroy())}onUpdateMipmaps(e){this._mipmapGenerator||(this._mipmapGenerator=new ed(this._gpu.device));let t=this.getGpuSource(e);this._mipmapGenerator.generateMipmap(t)}onSourceDestroy(e){e.off("update",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("destroy",this.onSourceDestroy,this),e.off("resize",this.onSourceResize,this),e.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}onSourceResize(e){let t=this._gpuSources[e.uid];t?(t.width!==e.pixelWidth||t.height!==e.pixelHeight)&&(this._textureViewHash[e.uid]=null,this._bindGroupHash[e.uid]=null,this.onSourceUnload(e),this.initSource(e)):this.initSource(e)}_initSampler(e){return this._gpuSamplers[e._resourceId]=this._gpu.device.createSampler(e),this._gpuSamplers[e._resourceId]}getGpuSampler(e){return this._gpuSamplers[e._resourceId]||this._initSampler(e)}getGpuSource(e){return this._gpuSources[e.uid]||this.initSource(e)}getTextureBindGroup(e){return this._bindGroupHash[e.uid]??this._createTextureBindGroup(e)}_createTextureBindGroup(e){let t=e.source;return this._bindGroupHash[e.uid]=new Jr({0:t,1:t.style,2:new pt({uTextureMatrix:{type:"mat3x3<f32>",value:e.textureMatrix.mapCoord}})}),this._bindGroupHash[e.uid]}getTextureView(e){let t=e.source;return this._textureViewHash[t.uid]??this._createTextureView(t)}_createTextureView(e){return this._textureViewHash[e.uid]=this.getGpuSource(e).createView(),this._textureViewHash[e.uid]}generateCanvas(e){let t=this._renderer,r=t.gpu.device.createCommandEncoder(),i=Fe.get().createCanvas();i.width=e.source.pixelWidth,i.height=e.source.pixelHeight;let s=i.getContext("webgpu");return s.configure({device:t.gpu.device,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,format:Fe.get().getNavigator().gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),r.copyTextureToTexture({texture:t.texture.getGpuSource(e.source),origin:{x:0,y:0}},{texture:s.getCurrentTexture()},{width:i.width,height:i.height}),t.gpu.device.queue.submit([r.finish()]),i}getPixels(e){let t=this.generateCanvas(e),r=zn.getOptimalCanvasAndContext(t.width,t.height),i=r.context;i.drawImage(t,0,0);let{width:s,height:o}=t,a=i.getImageData(0,0,s,o),l=new Uint8ClampedArray(a.data.buffer);return zn.returnCanvasAndContext(r),{pixels:l,width:s,height:o}}destroy(){this.managedTextures.slice().forEach(e=>this.onSourceDestroy(e)),this.managedTextures=null;for(let e of Object.keys(this._bindGroupHash)){let t=Number(e);this._bindGroupHash[t]?.destroy(),this._bindGroupHash[t]=null}this._gpu=null,this._mipmapGenerator=null,this._gpuSources=null,this._bindGroupHash=null,this._textureViewHash=null,this._gpuSamplers=null}};t1.extension={type:[z.WebGPUSystem],name:"texture"}});var TN={};X1(TN,{WebGPURenderer:()=>u3});var bQ,_Q,vQ,CN,AN,EN,u3,XE=$(()=>{ee();OA();LA();UA();L0();lg();Yi();wE();SE();CE();AE();EE();TE();PE();ME();RE();LE();UE();$E();jE();bQ=[...V0,Yu,ju,Yl,Wu,t1,Zu,Ju,e1,Qu,Vu,Xu,Hu],_Q=[...j0,Ku],vQ=[Eu,Au,Cu],CN=[],AN=[],EN=[];ke.handleByNamedList(z.WebGPUSystem,CN);ke.handleByNamedList(z.WebGPUPipes,AN);ke.handleByNamedList(z.WebGPUPipesAdaptor,EN);ke.add(...bQ,..._Q,...vQ);u3=class extends Bo{constructor(){let e={name:"webgpu",type:Bt.WEBGPU,systems:CN,renderPipes:AN,renderPipeAdaptors:EN};super(e)}}});var r1,qE=$(()=>{ee();Ct();wl();Aa();n0();i0();xu();Ea();d4();bs();Hr();r1=class{init(){let e=new pt({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new ue,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),t=Si(),r=gs({name:"graphics",bits:[Pl,Ml(t),zl,xs]});this.shader=new xr({glProgram:r,resources:{localUniforms:e,batchSamplers:Rl(t)}})}execute(e,t){let r=t.context,i=r.customShader||this.shader,s=e.renderer,o=s.graphicsContext,{batcher:a,instructions:l}=o.getContextRenderData(r);i.groups[0]=s.globalUniforms.bindGroup,s.state.set(e.state),s.shader.bind(i),s.geometry.bind(a.geometry,i.glProgram);let c=l.instructions;for(let u=0;u<l.instructionSize;u++){let d=c[u];if(d.size){for(let f=0;f<d.textures.count;f++)s.texture.bind(d.textures.textures[f],f);s.geometry.draw(d.topology,d.size,d.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}};r1.extension={type:[z.WebGLPipesAdaptor],name:"graphics"}});var n1,YE=$(()=>{ee();Ct();Aa();xu();Ea();H8();bs();_t();Gt();n1=class{init(){let e=gs({name:"mesh",bits:[zl,z8,xs]});this._shader=new xr({glProgram:e,resources:{uTexture:re.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new ue}}}})}execute(e,t){let r=e.renderer,i=t._shader;if(i){if(!i.glProgram){ve("Mesh shader has no glProgram",t.shader);return}}else{i=this._shader;let s=t.texture,o=s.source;i.resources.uTexture=o,i.resources.uSampler=o.style,i.resources.textureUniforms.uniforms.uTextureMatrix=s.textureMatrix.mapCoord}i.groups[100]=r.globalUniforms.bindGroup,i.groups[101]=e.localUniformsBindGroup,r.encoder.draw({geometry:t._geometry,shader:i,state:t.state})}destroy(){this._shader.destroy(!0),this._shader=null}};n1.extension={type:[z.WebGLPipesAdaptor],name:"mesh"}});var i1,KE=$(()=>{ee();Ki();i1=class{constructor(){this._didUpload=!1,this._tempState=ur.for2d()}init(e){e.renderer.runners.contextChange.add(this)}contextChange(){this._didUpload=!1}start(e,t,r){let i=e.renderer;i.shader.bind(r,this._didUpload),i.shader.updateUniformGroup(i.globalUniforms.uniformGroup),i.geometry.bind(t,r.glProgram)}execute(e,t){let r=e.renderer;this._didUpload=!0,this._tempState.blendMode=t.blendMode,r.state.set(this._tempState);let i=t.textures.textures;for(let s=0;s<t.textures.count;s++)r.texture.bind(i[s],s);r.geometry.draw(t.topology,t.size,t.start)}};i1.extension={type:[z.WebGLPipesAdaptor],name:"batch"}});var s1,QE=$(()=>{"use strict";s1=(n=>(n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n))(s1||{})});var td,ZE=$(()=>{"use strict";td=class{constructor(e,t){this._lastBindBaseLocation=-1,this._lastBindCallId=-1,this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.type=t}}});var o1,JE=$(()=>{ee();qs();QE();ZE();o1=class{constructor(e){this._gpuBuffers=Object.create(null),this._boundBufferBases=Object.create(null),this._minBaseLocation=0,this._nextBindBaseIndex=this._minBaseLocation,this._bindCallId=0,this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_gpuBuffers")}destroy(){this._renderer=null,this._gl=null,this._gpuBuffers=null,this._boundBufferBases=null}contextChange(){let e=this._gl=this._renderer.gl;this._gpuBuffers=Object.create(null),this._maxBindings=e.MAX_UNIFORM_BUFFER_BINDINGS?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0}getGlBuffer(e){return this._gpuBuffers[e.uid]||this.createGLBuffer(e)}bind(e){let{_gl:t}=this,r=this.getGlBuffer(e);t.bindBuffer(r.type,r.buffer)}bindBufferBase(e,t){let{_gl:r}=this;this._boundBufferBases[t]!==e&&(this._boundBufferBases[t]=e,e._lastBindBaseLocation=t,r.bindBufferBase(r.UNIFORM_BUFFER,t,e.buffer))}nextBindBase(e){this._bindCallId++,this._minBaseLocation=0,e&&(this._boundBufferBases[0]=null,this._minBaseLocation=1,this._nextBindBaseIndex<1&&(this._nextBindBaseIndex=1))}freeLocationForBufferBase(e){let t=this.getLastBindBaseLocation(e);if(t>=this._minBaseLocation)return e._lastBindCallId=this._bindCallId,t;let r=0,i=this._nextBindBaseIndex;for(;r<2;){i>=this._maxBindings&&(i=this._minBaseLocation,r++);let s=this._boundBufferBases[i];if(s&&s._lastBindCallId===this._bindCallId){i++;continue}break}return t=i,this._nextBindBaseIndex=i+1,r>=2?-1:(e._lastBindCallId=this._bindCallId,this._boundBufferBases[t]=null,t)}getLastBindBaseLocation(e){let t=e._lastBindBaseLocation;return this._boundBufferBases[t]===e?t:-1}bindBufferRange(e,t,r,i){let{_gl:s}=this;r||(r=0),t||(t=0),this._boundBufferBases[t]=null,s.bindBufferRange(s.UNIFORM_BUFFER,t||0,e.buffer,r*256,i||256)}updateBuffer(e){let{_gl:t}=this,r=this.getGlBuffer(e);if(e._updateID===r.updateID)return r;r.updateID=e._updateID,t.bindBuffer(r.type,r.buffer);let i=e.data,s=e.descriptor.usage&nt.STATIC?t.STATIC_DRAW:t.DYNAMIC_DRAW;return i?r.byteLength>=i.byteLength?t.bufferSubData(r.type,0,i,0,e._updateSize/i.BYTES_PER_ELEMENT):(r.byteLength=i.byteLength,t.bufferData(r.type,i,s)):(r.byteLength=e.descriptor.size,t.bufferData(r.type,r.byteLength,s)),r}destroyAll(){let e=this._gl;for(let t in this._gpuBuffers)e.deleteBuffer(this._gpuBuffers[t].buffer);this._gpuBuffers=Object.create(null)}onBufferDestroy(e,t){let r=this._gpuBuffers[e.uid],i=this._gl;t||i.deleteBuffer(r.buffer),this._gpuBuffers[e.uid]=null}createGLBuffer(e){let{_gl:t}=this,r=s1.ARRAY_BUFFER;e.descriptor.usage&nt.INDEX?r=s1.ELEMENT_ARRAY_BUFFER:e.descriptor.usage&nt.UNIFORM&&(r=s1.UNIFORM_BUFFER);let i=new td(t.createBuffer(),r);return this._gpuBuffers[e.uid]=i,e.on("destroy",this.onBufferDestroy,this),i}};o1.extension={type:[z.WebGLSystem],name:"buffer"}});var eT,Tg,tT=$(()=>{Vt();ee();Gt();eT=class kN{constructor(e){this.supports={uint32Indices:!0,uniformBufferObject:!0,vertexArrayObject:!0,srgbTextures:!0,nonPowOf2wrapping:!0,msaa:!0,nonPowOf2mipmaps:!0},this._renderer=e,this.extensions=Object.create(null),this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this._renderer.gl=e}init(e){e={...kN.defaultOptions,...e};let t=this.multiView=e.multiView;if(e.context&&t&&(ve("Renderer created with both a context and multiview enabled. Disabling multiView as both cannot work together."),t=!1),t?this.canvas=Fe.get().createCanvas(this._renderer.canvas.width,this._renderer.canvas.height):this.canvas=this._renderer.view.canvas,e.context)this.initFromContext(e.context);else{let r=this._renderer.background.alpha<1,i=e.premultipliedAlpha??!0,s=e.antialias&&!this._renderer.backBuffer.useBackBuffer;this.createContext(e.preferWebGLVersion,{alpha:r,premultipliedAlpha:i,antialias:s,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference??"default"})}}ensureCanvasSize(e){if(!this.multiView){e!==this.canvas&&ve("multiView is disabled, but targetCanvas is not the main canvas");return}let{canvas:t}=this;(t.width<e.width||t.height<e.height)&&(t.width=Math.max(e.width,e.width),t.height=Math.max(e.height,e.height))}initFromContext(e){this.gl=e,this.webGLVersion=e instanceof Fe.get().getWebGLRenderingContext()?1:2,this.getExtensions(),this.validateContext(e),this._renderer.runners.contextChange.emit(e);let t=this._renderer.view.canvas;t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}createContext(e,t){let r,i=this.canvas;if(e===2&&(r=i.getContext("webgl2",t)),!r&&(r=i.getContext("webgl",t),!r))throw new Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=r,this.initFromContext(this.gl)}getExtensions(){let{gl:e}=this,t={anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc"),rgtc:e.getExtension("EXT_texture_compression_rgtc"),loseContext:e.getExtension("WEBGL_lose_context")};if(this.webGLVersion===1)this.extensions={...t,drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear"),vertexAttribDivisorANGLE:e.getExtension("ANGLE_instanced_arrays"),srgb:e.getExtension("EXT_sRGB")};else{this.extensions={...t,colorBufferFloat:e.getExtension("EXT_color_buffer_float")};let r=e.getExtension("WEBGL_provoking_vertex");r&&r.provokingVertexWEBGL(r.FIRST_VERTEX_CONVENTION_WEBGL)}}handleContextLost(e){e.preventDefault(),this._contextLossForced&&(this._contextLossForced=!1,setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext?.restoreContext()},0))}handleContextRestored(){this._renderer.runners.contextChange.emit(this.gl)}destroy(){let e=this._renderer.view.canvas;this._renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext?.loseContext()}forceContextLoss(){this.extensions.loseContext?.loseContext(),this._contextLossForced=!0}validateContext(e){let t=e.getContextAttributes();t&&!t.stencil&&ve("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let r=this.supports,i=this.webGLVersion===2,s=this.extensions;r.uint32Indices=i||!!s.uint32ElementIndex,r.uniformBufferObject=i,r.vertexArrayObject=i||!!s.vertexArrayObject,r.srgbTextures=i||!!s.srgb,r.nonPowOf2wrapping=i,r.nonPowOf2mipmaps=i,r.msaa=i,r.uint32Indices||ve("Provided WebGL context does not support 32 index buffer, large scenes may not render correctly")}};eT.extension={type:[z.WebGLSystem],name:"context"};eT.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0,preferWebGLVersion:2,multiView:!1};Tg=eT});var rd,d3,rT,It,kg=$(()=>{"use strict";rd=(n=>(n[n.RGBA=6408]="RGBA",n[n.RGB=6407]="RGB",n[n.RG=33319]="RG",n[n.RED=6403]="RED",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.ALPHA=6406]="ALPHA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n))(rd||{}),d3=(n=>(n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n))(d3||{}),rT=(n=>(n[n.CLAMP=33071]="CLAMP",n[n.REPEAT=10497]="REPEAT",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n))(rT||{}),It=(n=>(n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.BYTE=5120]="BYTE",n[n.SHORT=5122]="SHORT",n[n.INT=5124]="INT",n[n.FLOAT=5126]="FLOAT",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.HALF_FLOAT=36193]="HALF_FLOAT",n))(It||{})});function Ig(n){return IN[n]??IN.float32}var IN,nT=$(()=>{kg();IN={uint8x2:It.UNSIGNED_BYTE,uint8x4:It.UNSIGNED_BYTE,sint8x2:It.BYTE,sint8x4:It.BYTE,unorm8x2:It.UNSIGNED_BYTE,unorm8x4:It.UNSIGNED_BYTE,snorm8x2:It.BYTE,snorm8x4:It.BYTE,uint16x2:It.UNSIGNED_SHORT,uint16x4:It.UNSIGNED_SHORT,sint16x2:It.SHORT,sint16x4:It.SHORT,unorm16x2:It.UNSIGNED_SHORT,unorm16x4:It.UNSIGNED_SHORT,snorm16x2:It.SHORT,snorm16x4:It.SHORT,float16x2:It.HALF_FLOAT,float16x4:It.HALF_FLOAT,float32:It.FLOAT,float32x2:It.FLOAT,float32x3:It.FLOAT,float32x4:It.FLOAT,uint32:It.UNSIGNED_INT,uint32x2:It.UNSIGNED_INT,uint32x3:It.UNSIGNED_INT,uint32x4:It.UNSIGNED_INT,sint32:It.INT,sint32x2:It.INT,sint32x3:It.INT,sint32x4:It.INT}});var wQ,a1,iT=$(()=>{ee();El();xg();nT();wQ={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5},a1=class{constructor(e){this._geometryVaoHash=Object.create(null),this._renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this._renderer.renderableGC.addManagedHash(this,"_geometryVaoHash")}contextChange(){let e=this.gl=this._renderer.gl;if(!this._renderer.context.supports.vertexArrayObject)throw new Error("[PixiJS] Vertex Array Objects are not supported on this device");let t=this._renderer.context.extensions.vertexArrayObject;t&&(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=i=>t.bindVertexArrayOES(i),e.deleteVertexArray=i=>t.deleteVertexArrayOES(i));let r=this._renderer.context.extensions.vertexAttribDivisorANGLE;r&&(e.drawArraysInstanced=(i,s,o,a)=>{r.drawArraysInstancedANGLE(i,s,o,a)},e.drawElementsInstanced=(i,s,o,a,l)=>{r.drawElementsInstancedANGLE(i,s,o,a,l)},e.vertexAttribDivisor=(i,s)=>r.vertexAttribDivisorANGLE(i,s)),this._activeGeometry=null,this._activeVao=null,this._geometryVaoHash=Object.create(null)}bind(e,t){let r=this.gl;this._activeGeometry=e;let i=this.getVao(e,t);this._activeVao!==i&&(this._activeVao=i,r.bindVertexArray(i)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let e=this._activeGeometry,t=this._renderer.buffer;for(let r=0;r<e.buffers.length;r++){let i=e.buffers[r];t.updateBuffer(i)}}checkCompatibility(e,t){let r=e.attributes,i=t._attributeData;for(let s in i)if(!r[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(e,t){let r=e.attributes,i=t._attributeData,s=["g",e.uid];for(let o in r)i[o]&&s.push(o,i[o].location);return s.join("-")}getVao(e,t){return this._geometryVaoHash[e.uid]?.[t._key]||this.initGeometryVao(e,t)}initGeometryVao(e,t,r=!0){let i=this._renderer.gl,s=this._renderer.buffer;this._renderer.shader._getProgramData(t),this.checkCompatibility(e,t);let o=this.getSignature(e,t);this._geometryVaoHash[e.uid]||(this._geometryVaoHash[e.uid]=Object.create(null),e.on("destroy",this.onGeometryDestroy,this));let a=this._geometryVaoHash[e.uid],l=a[o];if(l)return a[t._key]=l,l;K0(e,t._attributeData);let c=e.buffers;l=i.createVertexArray(),i.bindVertexArray(l);for(let u=0;u<c.length;u++){let d=c[u];s.bind(d)}return this.activateVao(e,t),a[t._key]=l,a[o]=l,i.bindVertexArray(null),l}onGeometryDestroy(e,t){let r=this._geometryVaoHash[e.uid],i=this.gl;if(r){if(t)for(let s in r)this._activeVao!==r[s]&&this.unbind(),i.deleteVertexArray(r[s]);this._geometryVaoHash[e.uid]=null}}destroyAll(e=!1){let t=this.gl;for(let r in this._geometryVaoHash){if(e)for(let i in this._geometryVaoHash[r]){let s=this._geometryVaoHash[r];this._activeVao!==s&&this.unbind(),t.deleteVertexArray(s[i])}this._geometryVaoHash[r]=null}}activateVao(e,t){let r=this._renderer.gl,i=this._renderer.buffer,s=e.attributes;e.indexBuffer&&i.bind(e.indexBuffer);let o=null;for(let a in s){let l=s[a],c=l.buffer,u=i.getGlBuffer(c),d=t._attributeData[a];if(d){o!==u&&(i.bind(c),o=u);let f=d.location;r.enableVertexAttribArray(f);let h=$n(l.format),p=Ig(l.format);if(d.format?.substring(1,4)==="int"?r.vertexAttribIPointer(f,h.size,p,l.stride,l.offset):r.vertexAttribPointer(f,h.size,p,h.normalised,l.stride,l.offset),l.instance)if(this.hasInstance){let m=l.divisor??1;r.vertexAttribDivisor(f,m)}else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,r,i){let{gl:s}=this._renderer,o=this._activeGeometry,a=wQ[e||o.topology];if(i??(i=o.instanceCount),o.indexBuffer){let l=o.indexBuffer.data.BYTES_PER_ELEMENT,c=l===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;i>1?s.drawElementsInstanced(a,t||o.indexBuffer.data.length,c,(r||0)*l,i):s.drawElements(a,t||o.indexBuffer.data.length,c,(r||0)*l)}else i>1?s.drawArraysInstanced(a,r||0,t||o.getSize(),i):s.drawArrays(a,r||0,t||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this._renderer=null,this.gl=null,this._activeVao=null,this._activeGeometry=null}};a1.extension={type:[z.WebGLSystem],name:"geometry"}});var SQ,sT,Pg,oT=$(()=>{ee();Gt();Al();bs();Ki();cn();_t();Ci();SQ=new Gn({attributes:{aPosition:[-1,-1,3,-1,-1,3]}}),sT=class PN{constructor(e){this.useBackBuffer=!1,this._useBackBufferThisRender=!1,this._renderer=e}init(e={}){let{useBackBuffer:t,antialias:r}={...PN.defaultOptions,...e};this.useBackBuffer=t,this._antialias=r,this._renderer.context.supports.msaa||(ve("antialiasing, is not supported on when using the back buffer"),this._antialias=!1),this._state=ur.for2d();let i=new he({vertex:`
                attribute vec2 aPosition;
                out vec2 vUv;

                void main() {
                    gl_Position = vec4(aPosition, 0.0, 1.0);

                    vUv = (aPosition + 1.0) / 2.0;

                    // flip dem UVs
                    vUv.y = 1.0 - vUv.y;
                }`,fragment:`
                in vec2 vUv;
                out vec4 finalColor;

                uniform sampler2D uTexture;

                void main() {
                    finalColor = texture(uTexture, vUv);
                }`,name:"big-triangle"});this._bigTriangleShader=new xr({glProgram:i,resources:{uTexture:re.WHITE.source}})}renderStart(e){let t=this._renderer.renderTarget.getRenderTarget(e.target);if(this._useBackBufferThisRender=this.useBackBuffer&&!!t.isRoot,this._useBackBufferThisRender){let r=this._renderer.renderTarget.getRenderTarget(e.target);this._targetTexture=r.colorTexture,e.target=this._getBackBufferTexture(r.colorTexture)}}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){let e=this._renderer;e.renderTarget.finishRenderPass(),this._useBackBufferThisRender&&(e.renderTarget.bind(this._targetTexture,!1),this._bigTriangleShader.resources.uTexture=this._backBufferTexture.source,e.encoder.draw({geometry:SQ,shader:this._bigTriangleShader,state:this._state}))}_getBackBufferTexture(e){return this._backBufferTexture=this._backBufferTexture||new re({source:new ot({width:e.width,height:e.height,resolution:e._resolution,antialias:this._antialias})}),this._backBufferTexture.source.resize(e.width,e.height,e._resolution),this._backBufferTexture}destroy(){this._backBufferTexture&&(this._backBufferTexture.destroy(),this._backBufferTexture=null)}};sT.extension={type:[z.WebGLSystem],name:"backBuffer",priority:1};sT.defaultOptions={useBackBuffer:!1};Pg=sT});var l1,aT=$(()=>{ee();l1=class{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.gl.colorMask(!!(e&8),!!(e&4),!!(e&2),!!(e&1)))}};l1.extension={type:[z.WebGLSystem],name:"colorMask"}});var c1,lT=$(()=>{ee();c1=class{constructor(e){this.commandFinished=Promise.resolve(),this._renderer=e}setGeometry(e,t){this._renderer.geometry.bind(e,t.glProgram)}finishRenderPass(){}draw(e){let t=this._renderer,{geometry:r,shader:i,state:s,skipSync:o,topology:a,size:l,start:c,instanceCount:u}=e;t.shader.bind(i,o),t.geometry.bind(r,t.shader._activeProgram),s&&t.state.set(s),t.geometry.draw(a,l,c,u??r.instanceCount)}destroy(){this._renderer=null}};c1.extension={type:[z.WebGLSystem],name:"encoder"}});var u1,cT=$(()=>{ee();bg();Cl();u1=class{constructor(e){this._stencilCache={enabled:!1,stencilReference:0,stencilMode:Jt.NONE},this._renderTargetStencilState=Object.create(null),e.renderTarget.onRenderTargetChange.add(this)}contextChange(e){this._gl=e,this._comparisonFuncMapping={always:e.ALWAYS,never:e.NEVER,equal:e.EQUAL,"not-equal":e.NOTEQUAL,less:e.LESS,"less-equal":e.LEQUAL,greater:e.GREATER,"greater-equal":e.GEQUAL},this._stencilOpsMapping={keep:e.KEEP,zero:e.ZERO,replace:e.REPLACE,invert:e.INVERT,"increment-clamp":e.INCR,"decrement-clamp":e.DECR,"increment-wrap":e.INCR_WRAP,"decrement-wrap":e.DECR_WRAP},this._stencilCache.enabled=!1,this._stencilCache.stencilMode=Jt.NONE,this._stencilCache.stencilReference=0}onRenderTargetChange(e){if(this._activeRenderTarget===e)return;this._activeRenderTarget=e;let t=this._renderTargetStencilState[e.uid];t||(t=this._renderTargetStencilState[e.uid]={stencilMode:Jt.DISABLED,stencilReference:0}),this.setStencilMode(t.stencilMode,t.stencilReference)}setStencilMode(e,t){let r=this._renderTargetStencilState[this._activeRenderTarget.uid],i=this._gl,s=Cs[e],o=this._stencilCache;if(r.stencilMode=e,r.stencilReference=t,e===Jt.DISABLED){this._stencilCache.enabled&&(this._stencilCache.enabled=!1,i.disable(i.STENCIL_TEST));return}this._stencilCache.enabled||(this._stencilCache.enabled=!0,i.enable(i.STENCIL_TEST)),(e!==o.stencilMode||o.stencilReference!==t)&&(o.stencilMode=e,o.stencilReference=t,i.stencilFunc(this._comparisonFuncMapping[s.stencilBack.compare],t,255),i.stencilOp(i.KEEP,i.KEEP,this._stencilOpsMapping[s.stencilBack.passOp]))}};u1.extension={type:[z.WebGLSystem],name:"stencil"}});function Dg(n){let e=n.map(s=>({data:s,offset:0,size:0})),t=16,r=0,i=0;for(let s=0;s<e.length;s++){let o=e[s];if(r=f3[o.data.type],!r)throw new Error(`Unknown type ${o.data.type}`);o.data.size>1&&(r=Math.max(r,t)*o.data.size);let a=r===12?16:r;o.size=r;let l=i%t;l>0&&t-l<a?i+=(t-l)%16:i+=(r-l%r)%r,o.offset=i,i+=r}return i=Math.ceil(i/16)*16,{uboElements:e,size:i}}var f3,Mg=$(()=>{"use strict";f3={f32:4,i32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"vec2<i32>":8,"vec3<i32>":12,"vec4<i32>":16,"mat2x2<f32>":32,"mat3x3<f32>":48,"mat4x4<f32>":64}});function Rg(n,e){let t=Math.max(f3[n.data.type]/16,1),r=n.data.value.length/n.data.size,i=(4-r%4)%4,s=n.data.type.indexOf("i32")>=0?"dataInt32":"data";return`
        v = uv.${n.data.name};
        offset += ${e};

        arrayOffset = offset;

        t = 0;

        for(var i=0; i < ${n.data.size*t}; i++)
        {
            for(var j = 0; j < ${r}; j++)
            {
                ${s}[arrayOffset++] = v[t++];
            }
            ${i!==0?`arrayOffset += ${i};`:""}
        }
    `}var uT=$(()=>{Mg()});function Fg(n){return X0(n,"uboStd40",Rg,a3)}var dT=$(()=>{hg();mg();uT()});var d1,fT=$(()=>{ee();cg();Mg();dT();d1=class extends Kl{constructor(){super({createUboElements:Dg,generateUboSync:Fg})}};d1.extension={type:[z.WebGLSystem],name:"ubo"}});var nd,hT=$(()=>{"use strict";nd=class{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}});var id,pT=$(()=>{Qr();Gt();Zc();Su();hT();id=class{constructor(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new $e}init(e,t){this._renderer=e,this._renderTargetSystem=t,e.runners.contextChange.add(this)}contextChange(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new $e}copyToTexture(e,t,r,i,s){let o=this._renderTargetSystem,a=this._renderer,l=o.getGpuRenderTarget(e),c=a.gl;return this.finishRenderPass(e),c.bindFramebuffer(c.FRAMEBUFFER,l.resolveTargetFramebuffer),a.texture.bind(t,0),c.copyTexSubImage2D(c.TEXTURE_2D,0,s.x,s.y,r.x,r.y,i.width,i.height),t}startRenderPass(e,t=!0,r,i){let s=this._renderTargetSystem,o=e.colorTexture,a=s.getGpuRenderTarget(e),l=i.y;e.isRoot&&(l=o.pixelHeight-i.height),e.colorTextures.forEach(d=>{this._renderer.texture.unbind(d)});let c=this._renderer.gl;c.bindFramebuffer(c.FRAMEBUFFER,a.framebuffer);let u=this._viewPortCache;(u.x!==i.x||u.y!==l||u.width!==i.width||u.height!==i.height)&&(u.x=i.x,u.y=l,u.width=i.width,u.height=i.height,c.viewport(i.x,l,i.width,i.height)),!a.depthStencilRenderBuffer&&(e.stencil||e.depth)&&this._initStencil(a),this.clear(e,t,r)}finishRenderPass(e){let r=this._renderTargetSystem.getGpuRenderTarget(e);if(!r.msaa)return;let i=this._renderer.gl;i.bindFramebuffer(i.FRAMEBUFFER,r.resolveTargetFramebuffer),i.bindFramebuffer(i.READ_FRAMEBUFFER,r.framebuffer),i.blitFramebuffer(0,0,r.width,r.height,0,0,r.width,r.height,i.COLOR_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,r.framebuffer)}initGpuRenderTarget(e){let t=this._renderer,r=t.gl,i=new nd;return e.colorTexture.resource===t.canvas?(this._renderer.context.ensureCanvasSize(e.colorTexture.resource),i.framebuffer=null,i):(this._initColor(e,i),r.bindFramebuffer(r.FRAMEBUFFER,null),i)}destroyGpuRenderTarget(e){let t=this._renderer.gl;e.framebuffer&&(t.deleteFramebuffer(e.framebuffer),e.framebuffer=null),e.resolveTargetFramebuffer&&(t.deleteFramebuffer(e.resolveTargetFramebuffer),e.resolveTargetFramebuffer=null),e.depthStencilRenderBuffer&&(t.deleteRenderbuffer(e.depthStencilRenderBuffer),e.depthStencilRenderBuffer=null),e.msaaRenderBuffer.forEach(r=>{t.deleteRenderbuffer(r)}),e.msaaRenderBuffer=null}clear(e,t,r){if(!t)return;let i=this._renderTargetSystem;typeof t=="boolean"&&(t=t?tn.ALL:tn.NONE);let s=this._renderer.gl;if(t&tn.COLOR){r??(r=i.defaultClearColor);let o=this._clearColorCache,a=r;(o[0]!==a[0]||o[1]!==a[1]||o[2]!==a[2]||o[3]!==a[3])&&(o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],s.clearColor(a[0],a[1],a[2],a[3]))}s.clear(t)}resizeGpuRenderTarget(e){if(e.isRoot)return;let r=this._renderTargetSystem.getGpuRenderTarget(e);this._resizeColor(e,r),(e.stencil||e.depth)&&this._resizeStencil(r)}_initColor(e,t){let r=this._renderer,i=r.gl,s=i.createFramebuffer();if(t.resolveTargetFramebuffer=s,i.bindFramebuffer(i.FRAMEBUFFER,s),t.width=e.colorTexture.source.pixelWidth,t.height=e.colorTexture.source.pixelHeight,e.colorTextures.forEach((o,a)=>{let l=o.source;l.antialias&&(r.context.supports.msaa?t.msaa=!0:ve("[RenderTexture] Antialiasing on textures is not supported in WebGL1")),r.texture.bindSource(l,0);let u=r.texture.getGlSource(l).texture;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,3553,u,0)}),t.msaa){let o=i.createFramebuffer();t.framebuffer=o,i.bindFramebuffer(i.FRAMEBUFFER,o),e.colorTextures.forEach((a,l)=>{let c=i.createRenderbuffer();t.msaaRenderBuffer[l]=c})}else t.framebuffer=s;this._resizeColor(e,t)}_resizeColor(e,t){let r=e.colorTexture.source;if(t.width=r.pixelWidth,t.height=r.pixelHeight,e.colorTextures.forEach((i,s)=>{s!==0&&i.source.resize(r.width,r.height,r._resolution)}),t.msaa){let i=this._renderer,s=i.gl,o=t.framebuffer;s.bindFramebuffer(s.FRAMEBUFFER,o),e.colorTextures.forEach((a,l)=>{let c=a.source;i.texture.bindSource(c,0);let d=i.texture.getGlSource(c).internalFormat,f=t.msaaRenderBuffer[l];s.bindRenderbuffer(s.RENDERBUFFER,f),s.renderbufferStorageMultisample(s.RENDERBUFFER,4,d,c.pixelWidth,c.pixelHeight),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+l,s.RENDERBUFFER,f)})}}_initStencil(e){if(e.framebuffer===null)return;let t=this._renderer.gl,r=t.createRenderbuffer();e.depthStencilRenderBuffer=r,t.bindRenderbuffer(t.RENDERBUFFER,r),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,r),this._resizeStencil(e)}_resizeStencil(e){let t=this._renderer.gl;t.bindRenderbuffer(t.RENDERBUFFER,e.depthStencilRenderBuffer),e.msaa?t.renderbufferStorageMultisample(t.RENDERBUFFER,4,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,this._renderer.context.webGLVersion===2?t.DEPTH24_STENCIL8:t.DEPTH_STENCIL,e.width,e.height)}prerender(e){let t=e.colorTexture.resource;this._renderer.context.multiView&&Cn.test(t)&&this._renderer.context.ensureCanvasSize(t)}postrender(e){if(this._renderer.context.multiView&&Cn.test(e.colorTexture.resource)){let t=this._renderer.context.canvas,r=e.colorTexture;r.context2D.drawImage(t,0,r.pixelHeight-t.height)}}}});var f1,mT=$(()=>{ee();wg();pT();f1=class extends Zl{constructor(e){super(e),this.adaptor=new id,this.adaptor.init(e,this)}};f1.extension={type:[z.WebGLSystem],name:"renderTarget"}});function Bg(n,e){let t=[],r=[`
        var g = s.groups;
        var sS = r.shader;
        var p = s.glProgram;
        var ugS = r.uniformGroup;
        var resources;
    `],i=!1,s=0,o=e._getProgramData(n.glProgram);for(let l in n.groups){let c=n.groups[l];t.push(`
            resources = g[${l}].resources;
        `);for(let u in c.resources){let d=c.resources[u];if(d instanceof pt)if(d.ubo){let f=n._uniformBindMap[l][Number(u)];t.push(`
                        sS.bindUniformBlock(
                            resources[${u}],
                            '${f}',
                            ${n.glProgram._uniformBlockData[f].index}
                        );
                    `)}else t.push(`
                        ugS.updateUniformGroup(resources[${u}], p, sD);
                    `);else if(d instanceof Uo){let f=n._uniformBindMap[l][Number(u)];t.push(`
                    sS.bindUniformBlock(
                        resources[${u}],
                        '${f}',
                        ${n.glProgram._uniformBlockData[f].index}
                    );
                `)}else if(d instanceof ot){let f=n._uniformBindMap[l][u],h=o.uniformData[f];h&&(i||(i=!0,r.push(`
                        var tS = r.texture;
                        `)),e._gl.uniform1i(h.location,s),t.push(`
                        tS.bind(resources[${u}], ${s});
                    `),s++)}}}let a=[...r,...t].join(`
`);return new Function("r","s","sD",a)}var gT=$(()=>{l3();Hr();cn()});var Ng,sd,yT=$(()=>{"use strict";Ng=class{},sd=class{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}});function h3(n,e,t){let r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}var xT=$(()=>{"use strict"});function bT(n){let e=new Array(n);for(let t=0;t<e.length;t++)e[t]=!1;return e}function od(n,e){switch(n){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return bT(2*e);case"bvec3":return bT(3*e);case"bvec4":return bT(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Og=$(()=>{"use strict"});function p3(n,e){if(!Lg){let t=Object.keys(DN);Lg={};for(let r=0;r<t.length;++r){let i=t[r];Lg[n[i]]=DN[i]}}return Lg[e]}function Ug(n,e){let t=p3(n,e);return CQ[t]||"float32"}var Lg,DN,CQ,Gg=$(()=>{"use strict";Lg=null,DN={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},CQ={float:"float32",vec2:"float32x2",vec3:"float32x3",vec4:"float32x4",int:"sint32",ivec2:"sint32x2",ivec3:"sint32x3",ivec4:"sint32x4",uint:"uint32",uvec2:"uint32x2",uvec3:"uint32x3",uvec4:"uint32x4",bool:"uint32",bvec2:"uint32x2",bvec3:"uint32x3",bvec4:"uint32x4"}});function $g(n,e,t=!1){let r={},i=e.getProgramParameter(n,e.ACTIVE_ATTRIBUTES);for(let o=0;o<i;o++){let a=e.getActiveAttrib(n,o);if(a.name.startsWith("gl_"))continue;let l=Ug(e,a.type);r[a.name]={location:0,format:l,stride:$n(l).stride,offset:0,instance:!1,start:0}}let s=Object.keys(r);if(t){s.sort((o,a)=>o>a?1:-1);for(let o=0;o<s.length;o++)r[s[o]].location=o,e.bindAttribLocation(n,o,s[o]);e.linkProgram(n)}else for(let o=0;o<s.length;o++)r[s[o]].location=e.getAttribLocation(n,s[o]);return r}var _T=$(()=>{El();Gg()});function zg(n,e){if(!e.ACTIVE_UNIFORM_BLOCKS)return{};let t={},r=e.getProgramParameter(n,e.ACTIVE_UNIFORM_BLOCKS);for(let i=0;i<r;i++){let s=e.getActiveUniformBlockName(n,i),o=e.getUniformBlockIndex(n,s),a=e.getActiveUniformBlockParameter(n,i,e.UNIFORM_BLOCK_DATA_SIZE);t[s]={name:s,index:o,size:a}}return t}var vT=$(()=>{"use strict"});function Hg(n,e){let t={},r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){let s=e.getActiveUniform(n,i),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),l=p3(e,s.type);t[o]={name:o,index:i,type:l,size:s.size,isArray:a,value:od(l,s.size)}}return t}var wT=$(()=>{Og();Gg()});function MN(n,e){let t=n.getShaderSource(e).split(`
`).map((c,u)=>`${u}: ${c}`),r=n.getShaderInfoLog(e),i=r.split(`
`),s={},o=i.map(c=>parseFloat(c.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(c=>c&&!s[c]?(s[c]=!0,!0):!1),a=[""];o.forEach(c=>{t[c-1]=`%c${t[c-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let l=t.join(`
`);a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function Wg(n,e,t,r){n.getProgramParameter(e,n.LINK_STATUS)||(n.getShaderParameter(t,n.COMPILE_STATUS)||MN(n,t),n.getShaderParameter(r,n.COMPILE_STATUS)||MN(n,r),console.error("PixiJS Error: Could not initialize shader."),n.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",n.getProgramInfoLog(e)))}var ST=$(()=>{"use strict"});function Vg(n,e){let t=h3(n,n.VERTEX_SHADER,e.vertex),r=h3(n,n.FRAGMENT_SHADER,e.fragment),i=n.createProgram();n.attachShader(i,t),n.attachShader(i,r);let s=e.transformFeedbackVaryings;s&&(typeof n.transformFeedbackVaryings!="function"?ve("TransformFeedback is not supported but TransformFeedbackVaryings are given."):n.transformFeedbackVaryings(i,s.names,s.bufferMode==="separate"?n.SEPARATE_ATTRIBS:n.INTERLEAVED_ATTRIBS)),n.linkProgram(i),n.getProgramParameter(i,n.LINK_STATUS)||Wg(n,i,t,r),e._attributeData=$g(i,n,!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertex)),e._uniformData=Hg(i,n),e._uniformBlockData=zg(i,n),n.deleteShader(t),n.deleteShader(r);let o={};for(let l in e._uniformData){let c=e._uniformData[l];o[l]={location:n.getUniformLocation(i,l),value:od(c.type,c.size)}}return new sd(i,o)}var CT=$(()=>{Gt();yT();xT();Og();_T();vT();wT();ST()});var jg,h1,AT=$(()=>{ee();wl();gT();CT();jg={textureCount:0,blockIndex:0},h1=class{constructor(e){this._activeProgram=null,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_programDataHash")}contextChange(e){this._gl=e,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._activeProgram=null,this.maxTextures=Si()}bind(e,t){if(this._setProgram(e.glProgram),t)return;jg.textureCount=0,jg.blockIndex=0;let r=this._shaderSyncFunctions[e.glProgram._key];r||(r=this._shaderSyncFunctions[e.glProgram._key]=this._generateShaderSync(e,this)),this._renderer.buffer.nextBindBase(!!e.glProgram.transformFeedbackVaryings),r(this._renderer,e,jg)}updateUniformGroup(e){this._renderer.uniformGroup.updateUniformGroup(e,this._activeProgram,jg)}bindUniformBlock(e,t,r=0){let i=this._renderer.buffer,s=this._getProgramData(this._activeProgram),o=e._bufferResource;o||this._renderer.ubo.updateUniformGroup(e);let a=e.buffer,l=i.updateBuffer(a),c=i.freeLocationForBufferBase(l);if(o){let{offset:d,size:f}=e;d===0&&f===a.data.byteLength?i.bindBufferBase(l,c):i.bindBufferRange(l,c,d)}else i.getLastBindBaseLocation(l)!==c&&i.bindBufferBase(l,c);let u=this._activeProgram._uniformBlockData[t].index;s.uniformBlockBindings[r]!==c&&(s.uniformBlockBindings[r]=c,this._renderer.gl.uniformBlockBinding(s.program,u,c))}_setProgram(e){if(this._activeProgram===e)return;this._activeProgram=e;let t=this._getProgramData(e);this._gl.useProgram(t.program)}_getProgramData(e){return this._programDataHash[e._key]||this._createProgramData(e)}_createProgramData(e){let t=e._key;return this._programDataHash[t]=Vg(this._gl,e),this._programDataHash[t]}destroy(){for(let e of Object.keys(this._programDataHash))this._programDataHash[e].destroy(),this._programDataHash[e]=null;this._programDataHash=null}_generateShaderSync(e,t){return Bg(e,t)}};h1.extension={type:[z.WebGLSystem],name:"shader"}});var Xg,qg,ET=$(()=>{"use strict";Xg={f32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1f(location, v);
        }`,"vec2<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2f(location, v[0], v[1]);
        }`,"vec3<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3f(location, v[0], v[1], v[2]);
        }`,"vec4<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4f(location, v[0], v[1], v[2], v[3]);
        }`,i32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1i(location, v);
        }`,"vec2<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2i(location, v[0], v[1]);
        }`,"vec3<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3i(location, v[0], v[1], v[2]);
        }`,"vec4<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4i(location, v[0], v[1], v[2], v[3]);
        }`,u32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1ui(location, v);
        }`,"vec2<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2ui(location, v[0], v[1]);
        }`,"vec3<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3ui(location, v[0], v[1], v[2]);
        }`,"vec4<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
        }`,bool:`if (cv !== v) {
            cu.value = v;
            gl.uniform1i(location, v);
        }`,"vec2<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2i(location, v[0], v[1]);
        }`,"vec3<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3i(location, v[0], v[1], v[2]);
        }`,"vec4<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4i(location, v[0], v[1], v[2], v[3]);
        }`,"mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);"},qg={f32:"gl.uniform1fv(location, v);","vec2<f32>":"gl.uniform2fv(location, v);","vec3<f32>":"gl.uniform3fv(location, v);","vec4<f32>":"gl.uniform4fv(location, v);","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);",i32:"gl.uniform1iv(location, v);","vec2<i32>":"gl.uniform2iv(location, v);","vec3<i32>":"gl.uniform3iv(location, v);","vec4<i32>":"gl.uniform4iv(location, v);",u32:"gl.uniform1iv(location, v);","vec2<u32>":"gl.uniform2iv(location, v);","vec3<u32>":"gl.uniform3iv(location, v);","vec4<u32>":"gl.uniform4iv(location, v);",bool:"gl.uniform1iv(location, v);","vec2<bool>":"gl.uniform2iv(location, v);","vec3<bool>":"gl.uniform3iv(location, v);","vec4<bool>":"gl.uniform4iv(location, v);"}});function Yg(n,e){let t=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
        var name = null;
    `];for(let r in n.uniforms){if(!e[r]){n.uniforms[r]instanceof pt?n.uniforms[r].ubo?t.push(`
                        renderer.shader.bindUniformBlock(uv.${r}, "${r}");
                    `):t.push(`
                        renderer.shader.updateUniformGroup(uv.${r});
                    `):n.uniforms[r]instanceof Uo&&t.push(`
                        renderer.shader.bindBufferResource(uv.${r}, "${r}");
                    `);continue}let i=n.uniformStructures[r],s=!1;for(let o=0;o<to.length;o++){let a=to[o];if(i.type===a.type&&a.test(i)){t.push(`name = "${r}";`,to[o].uniform),s=!0;break}}if(!s){let a=(i.size===1?Xg:qg)[i.type].replace("location",`ud["${r}"].location`);t.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${a};`)}}return new Function("ud","uv","renderer","syncData",t.join(`
`))}var TT=$(()=>{l3();Hr();fg();ET()});var p1,kT=$(()=>{ee();TT();p1=class{constructor(e){this._cache={},this._uniformGroupSyncHash={},this._renderer=e,this.gl=null,this._cache={}}contextChange(e){this.gl=e}updateUniformGroup(e,t,r){let i=this._renderer.shader._getProgramData(t);(!e.isStatic||e._dirtyId!==i.uniformDirtyGroups[e.uid])&&(i.uniformDirtyGroups[e.uid]=e._dirtyId,this._getUniformSyncFunction(e,t)(i.uniformData,e.uniforms,this._renderer,r))}_getUniformSyncFunction(e,t){return this._uniformGroupSyncHash[e._signature]?.[t._key]||this._createUniformSyncFunction(e,t)}_createUniformSyncFunction(e,t){let r=this._uniformGroupSyncHash[e._signature]||(this._uniformGroupSyncHash[e._signature]={}),i=this._getSignature(e,t._uniformData,"u");return this._cache[i]||(this._cache[i]=this._generateUniformsSync(e,t._uniformData)),r[t._key]=this._cache[i],r[t._key]}_generateUniformsSync(e,t){return Yg(e,t)}_getSignature(e,t,r){let i=e.uniforms,s=[`${r}-`];for(let o in i)s.push(o),t[o]&&s.push(t[o].type);return s.join("-")}destroy(){this._renderer=null,this._cache=null}};p1.extension={type:[z.WebGLSystem],name:"uniformGroup"}});function Kg(n){let e={};if(e.normal=[n.ONE,n.ONE_MINUS_SRC_ALPHA],e.add=[n.ONE,n.ONE],e.multiply=[n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],e.screen=[n.ONE,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],e.none=[0,0],e["normal-npm"]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA],e["add-npm"]=[n.SRC_ALPHA,n.ONE,n.ONE,n.ONE],e["screen-npm"]=[n.SRC_ALPHA,n.ONE_MINUS_SRC_COLOR,n.ONE,n.ONE_MINUS_SRC_ALPHA],e.erase=[n.ZERO,n.ONE_MINUS_SRC_ALPHA],!(n instanceof Fe.get().getWebGLRenderingContext()))e.min=[n.ONE,n.ONE,n.ONE,n.ONE,n.MIN,n.MIN],e.max=[n.ONE,n.ONE,n.ONE,n.ONE,n.MAX,n.MAX];else{let r=n.getExtension("EXT_blend_minmax");r&&(e.min=[n.ONE,n.ONE,n.ONE,n.ONE,r.MIN_EXT,r.MIN_EXT],e.max=[n.ONE,n.ONE,n.ONE,n.ONE,r.MAX_EXT,r.MAX_EXT])}return e}var IT=$(()=>{Vt()});var AQ,EQ,TQ,kQ,IQ,PQ,RN,Qg,DT=$(()=>{ee();Ki();IT();AQ=0,EQ=1,TQ=2,kQ=3,IQ=4,PQ=5,RN=class PT{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[AQ]=this.setBlend,this.map[EQ]=this.setOffset,this.map[TQ]=this.setCullFace,this.map[kQ]=this.setDepthTest,this.map[IQ]=this.setFrontFace,this.map[PQ]=this.setDepthMask,this.checks=[],this.defaultState=ur.for2d()}contextChange(e){this.gl=e,this.blendModesMap=Kg(e),this.reset()}set(e){if(e||(e=this.defaultState),this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)t&1&&this.map[r].call(this,!!(e.data&1<<r)),t>>=1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e||(e=this.defaultState);for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this._updateCheck(PT._checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this._updateCheck(PT._checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(this.blendModesMap[e]||(e="normal"),e===this.blendMode)return;this.blendMode=e;let t=this.blendModesMap[e],r=this.gl;t.length===2?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}_updateCheck(e,t){let r=this.checks.indexOf(e);t&&r===-1?this.checks.push(e):!t&&r!==-1&&this.checks.splice(r,1)}static _checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static _checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};RN.extension={type:[z.WebGLSystem],name:"state"};Qg=RN});var ad,MT=$(()=>{kg();ad=class{constructor(e){this.target=d3.TEXTURE_2D,this.texture=e,this.width=-1,this.height=-1,this.type=It.UNSIGNED_BYTE,this.internalFormat=rd.RGBA,this.format=rd.RGBA,this.samplerType=0}}});var Zg,RT=$(()=>{"use strict";Zg={id:"buffer",upload(n,e,t){e.width===n.width||e.height===n.height?t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,e.format,e.type,n.resource):t.texImage2D(e.target,0,e.internalFormat,n.width,n.height,0,e.format,e.type,n.resource),e.width=n.width,e.height=n.height}}});var DQ,Jg,FT=$(()=>{"use strict";DQ={"bc1-rgba-unorm":!0,"bc1-rgba-unorm-srgb":!0,"bc2-rgba-unorm":!0,"bc2-rgba-unorm-srgb":!0,"bc3-rgba-unorm":!0,"bc3-rgba-unorm-srgb":!0,"bc4-r-unorm":!0,"bc4-r-snorm":!0,"bc5-rg-unorm":!0,"bc5-rg-snorm":!0,"bc6h-rgb-ufloat":!0,"bc6h-rgb-float":!0,"bc7-rgba-unorm":!0,"bc7-rgba-unorm-srgb":!0,"etc2-rgb8unorm":!0,"etc2-rgb8unorm-srgb":!0,"etc2-rgb8a1unorm":!0,"etc2-rgb8a1unorm-srgb":!0,"etc2-rgba8unorm":!0,"etc2-rgba8unorm-srgb":!0,"eac-r11unorm":!0,"eac-r11snorm":!0,"eac-rg11unorm":!0,"eac-rg11snorm":!0,"astc-4x4-unorm":!0,"astc-4x4-unorm-srgb":!0,"astc-5x4-unorm":!0,"astc-5x4-unorm-srgb":!0,"astc-5x5-unorm":!0,"astc-5x5-unorm-srgb":!0,"astc-6x5-unorm":!0,"astc-6x5-unorm-srgb":!0,"astc-6x6-unorm":!0,"astc-6x6-unorm-srgb":!0,"astc-8x5-unorm":!0,"astc-8x5-unorm-srgb":!0,"astc-8x6-unorm":!0,"astc-8x6-unorm-srgb":!0,"astc-8x8-unorm":!0,"astc-8x8-unorm-srgb":!0,"astc-10x5-unorm":!0,"astc-10x5-unorm-srgb":!0,"astc-10x6-unorm":!0,"astc-10x6-unorm-srgb":!0,"astc-10x8-unorm":!0,"astc-10x8-unorm-srgb":!0,"astc-10x10-unorm":!0,"astc-10x10-unorm-srgb":!0,"astc-12x10-unorm":!0,"astc-12x10-unorm-srgb":!0,"astc-12x12-unorm":!0,"astc-12x12-unorm-srgb":!0},Jg={id:"compressed",upload(n,e,t){t.pixelStorei(t.UNPACK_ALIGNMENT,4);let r=n.pixelWidth,i=n.pixelHeight,s=!!DQ[n.format];for(let o=0;o<n.resource.length;o++){let a=n.resource[o];s?t.compressedTexImage2D(t.TEXTURE_2D,o,e.internalFormat,r,i,0,a):t.texImage2D(t.TEXTURE_2D,o,e.internalFormat,r,i,0,e.format,e.type,a),r=Math.max(r>>1,1),i=Math.max(i>>1,1)}}}});var ld,ey=$(()=>{"use strict";ld={id:"image",upload(n,e,t,r){let i=n.alphaMode==="premultiply-alpha-on-upload";t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i);let s=e.width,o=e.height,a=n.pixelWidth,l=n.pixelHeight,c=n.resourceWidth,u=n.resourceHeight;c<a||u<l?((s!==a||o!==l)&&t.texImage2D(e.target,0,e.internalFormat,a,l,0,e.format,e.type,null),r===2?t.texSubImage2D(t.TEXTURE_2D,0,0,0,c,u,e.format,e.type,n.resource):t.texSubImage2D(t.TEXTURE_2D,0,0,0,e.format,e.type,n.resource)):s===a||o===l?t.texSubImage2D(t.TEXTURE_2D,0,0,0,e.format,e.type,n.resource):r===2?t.texImage2D(e.target,0,e.internalFormat,a,l,0,e.format,e.type,n.resource):t.texImage2D(e.target,0,e.internalFormat,e.format,e.type,n.resource),e.width=a,e.height=l}}});var ty,BT=$(()=>{ey();ty={id:"video",upload(n,e,t,r){if(!n.isValid){t.texImage2D(e.target,0,e.internalFormat,1,1,0,e.format,e.type,null);return}ld.upload(n,e,t,r)}}});var m3,ry,cd,ny,NT=$(()=>{"use strict";m3={linear:9729,nearest:9728},ry={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},cd={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},ny={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519}});function g3(n,e,t,r,i,s,o,a){let l=s;if(!a||n.addressModeU!=="repeat"||n.addressModeV!=="repeat"||n.addressModeW!=="repeat"){let c=cd[o?"clamp-to-edge":n.addressModeU],u=cd[o?"clamp-to-edge":n.addressModeV],d=cd[o?"clamp-to-edge":n.addressModeW];e[i](l,e.TEXTURE_WRAP_S,c),e[i](l,e.TEXTURE_WRAP_T,u),e.TEXTURE_WRAP_R&&e[i](l,e.TEXTURE_WRAP_R,d)}if((!a||n.magFilter!=="linear")&&e[i](l,e.TEXTURE_MAG_FILTER,m3[n.magFilter]),t){if(!a||n.mipmapFilter!=="linear"){let c=ry[n.minFilter][n.mipmapFilter];e[i](l,e.TEXTURE_MIN_FILTER,c)}}else e[i](l,e.TEXTURE_MIN_FILTER,m3[n.minFilter]);if(r&&n.maxAnisotropy>1){let c=Math.min(n.maxAnisotropy,e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));e[i](l,r.TEXTURE_MAX_ANISOTROPY_EXT,c)}n.compare&&e[i](l,e.TEXTURE_COMPARE_FUNC,ny[n.compare])}var OT=$(()=>{NT()});function iy(n){return{r8unorm:n.RED,r8snorm:n.RED,r8uint:n.RED,r8sint:n.RED,r16uint:n.RED,r16sint:n.RED,r16float:n.RED,rg8unorm:n.RG,rg8snorm:n.RG,rg8uint:n.RG,rg8sint:n.RG,r32uint:n.RED,r32sint:n.RED,r32float:n.RED,rg16uint:n.RG,rg16sint:n.RG,rg16float:n.RG,rgba8unorm:n.RGBA,"rgba8unorm-srgb":n.RGBA,rgba8snorm:n.RGBA,rgba8uint:n.RGBA,rgba8sint:n.RGBA,bgra8unorm:n.RGBA,"bgra8unorm-srgb":n.RGBA,rgb9e5ufloat:n.RGB,rgb10a2unorm:n.RGBA,rg11b10ufloat:n.RGB,rg32uint:n.RG,rg32sint:n.RG,rg32float:n.RG,rgba16uint:n.RGBA,rgba16sint:n.RGBA,rgba16float:n.RGBA,rgba32uint:n.RGBA,rgba32sint:n.RGBA,rgba32float:n.RGBA,stencil8:n.STENCIL_INDEX8,depth16unorm:n.DEPTH_COMPONENT,depth24plus:n.DEPTH_COMPONENT,"depth24plus-stencil8":n.DEPTH_STENCIL,depth32float:n.DEPTH_COMPONENT,"depth32float-stencil8":n.DEPTH_STENCIL}}var LT=$(()=>{"use strict"});function sy(n,e){let t={},r=n.RGBA;return n instanceof Fe.get().getWebGLRenderingContext()?e.srgb&&(t={"rgba8unorm-srgb":e.srgb.SRGB8_ALPHA8_EXT,"bgra8unorm-srgb":e.srgb.SRGB8_ALPHA8_EXT}):(t={"rgba8unorm-srgb":n.SRGB8_ALPHA8,"bgra8unorm-srgb":n.SRGB8_ALPHA8},r=n.RGBA8),{r8unorm:n.R8,r8snorm:n.R8_SNORM,r8uint:n.R8UI,r8sint:n.R8I,r16uint:n.R16UI,r16sint:n.R16I,r16float:n.R16F,rg8unorm:n.RG8,rg8snorm:n.RG8_SNORM,rg8uint:n.RG8UI,rg8sint:n.RG8I,r32uint:n.R32UI,r32sint:n.R32I,r32float:n.R32F,rg16uint:n.RG16UI,rg16sint:n.RG16I,rg16float:n.RG16F,rgba8unorm:n.RGBA,...t,rgba8snorm:n.RGBA8_SNORM,rgba8uint:n.RGBA8UI,rgba8sint:n.RGBA8I,bgra8unorm:r,rgb9e5ufloat:n.RGB9_E5,rgb10a2unorm:n.RGB10_A2,rg11b10ufloat:n.R11F_G11F_B10F,rg32uint:n.RG32UI,rg32sint:n.RG32I,rg32float:n.RG32F,rgba16uint:n.RGBA16UI,rgba16sint:n.RGBA16I,rgba16float:n.RGBA16F,rgba32uint:n.RGBA32UI,rgba32sint:n.RGBA32I,rgba32float:n.RGBA32F,stencil8:n.STENCIL_INDEX8,depth16unorm:n.DEPTH_COMPONENT16,depth24plus:n.DEPTH_COMPONENT24,"depth24plus-stencil8":n.DEPTH24_STENCIL8,depth32float:n.DEPTH_COMPONENT32F,"depth32float-stencil8":n.DEPTH32F_STENCIL8,...e.s3tc?{"bc1-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT,"bc2-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{},...e.s3tc_sRGB?{"bc1-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,"bc2-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{},...e.rgtc?{"bc4-r-unorm":e.rgtc.COMPRESSED_RED_RGTC1_EXT,"bc4-r-snorm":e.rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT,"bc5-rg-unorm":e.rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT,"bc5-rg-snorm":e.rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}:{},...e.bptc?{"bc6h-rgb-float":e.bptc.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,"bc6h-rgb-ufloat":e.bptc.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,"bc7-rgba-unorm":e.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":e.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{},...e.etc?{"etc2-rgb8unorm":e.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":e.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":e.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":e.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":e.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":e.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":e.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":e.etc.COMPRESSED_SIGNED_RG11_EAC}:{},...e.astc?{"astc-4x4-unorm":e.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x4-unorm":e.astc.COMPRESSED_RGBA_ASTC_5x4_KHR,"astc-5x4-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,"astc-5x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{}}}var UT=$(()=>{Vt()});function oy(n){return{r8unorm:n.UNSIGNED_BYTE,r8snorm:n.BYTE,r8uint:n.UNSIGNED_BYTE,r8sint:n.BYTE,r16uint:n.UNSIGNED_SHORT,r16sint:n.SHORT,r16float:n.HALF_FLOAT,rg8unorm:n.UNSIGNED_BYTE,rg8snorm:n.BYTE,rg8uint:n.UNSIGNED_BYTE,rg8sint:n.BYTE,r32uint:n.UNSIGNED_INT,r32sint:n.INT,r32float:n.FLOAT,rg16uint:n.UNSIGNED_SHORT,rg16sint:n.SHORT,rg16float:n.HALF_FLOAT,rgba8unorm:n.UNSIGNED_BYTE,"rgba8unorm-srgb":n.UNSIGNED_BYTE,rgba8snorm:n.BYTE,rgba8uint:n.UNSIGNED_BYTE,rgba8sint:n.BYTE,bgra8unorm:n.UNSIGNED_BYTE,"bgra8unorm-srgb":n.UNSIGNED_BYTE,rgb9e5ufloat:n.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:n.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:n.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:n.UNSIGNED_INT,rg32sint:n.INT,rg32float:n.FLOAT,rgba16uint:n.UNSIGNED_SHORT,rgba16sint:n.SHORT,rgba16float:n.HALF_FLOAT,rgba32uint:n.UNSIGNED_INT,rgba32sint:n.INT,rgba32float:n.FLOAT,stencil8:n.UNSIGNED_BYTE,depth16unorm:n.UNSIGNED_SHORT,depth24plus:n.UNSIGNED_INT,"depth24plus-stencil8":n.UNSIGNED_INT_24_8,depth32float:n.FLOAT,"depth32float-stencil8":n.FLOAT_32_UNSIGNED_INT_24_8_REV}}var GT=$(()=>{"use strict"});function FN(n){n instanceof Uint8ClampedArray&&(n=new Uint8Array(n.buffer));let e=n.length;for(let t=0;t<e;t+=4){let r=n[t+3];if(r!==0){let i=255.001/r;n[t]=n[t]*i+.5,n[t+1]=n[t+1]*i+.5,n[t+2]=n[t+2]*i+.5}}}var BN=$(()=>{"use strict"});var MQ,m1,$T=$(()=>{Vt();ee();_t();MT();RT();FT();ey();BT();OT();LT();UT();GT();MQ=4,m1=class{constructor(e){this.managedTextures=[],this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundTextures=[],this._activeTextureLocation=-1,this._boundSamplers=Object.create(null),this._uploads={image:ld,buffer:Zg,video:ty,compressed:Jg},this._useSeparateSamplers=!1,this._renderer=e,this._renderer.renderableGC.addManagedHash(this,"_glTextures"),this._renderer.renderableGC.addManagedHash(this,"_glSamplers")}contextChange(e){this._gl=e,this._mapFormatToInternalFormat||(this._mapFormatToInternalFormat=sy(e,this._renderer.context.extensions),this._mapFormatToType=oy(e),this._mapFormatToFormat=iy(e)),this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundSamplers=Object.create(null);for(let t=0;t<16;t++)this.bind(re.EMPTY,t)}initSource(e){this.bind(e)}bind(e,t=0){let r=e.source;e?(this.bindSource(r,t),this._useSeparateSamplers&&this._bindSampler(r.style,t)):(this.bindSource(null,t),this._useSeparateSamplers&&this._bindSampler(null,t))}bindSource(e,t=0){let r=this._gl;if(e._touched=this._renderer.textureGC.count,this._boundTextures[t]!==e){this._boundTextures[t]=e,this._activateLocation(t),e||(e=re.EMPTY.source);let i=this.getGlSource(e);r.bindTexture(i.target,i.texture)}}_bindSampler(e,t=0){let r=this._gl;if(!e){this._boundSamplers[t]=null,r.bindSampler(t,null);return}let i=this._getGlSampler(e);this._boundSamplers[t]!==i&&(this._boundSamplers[t]=i,r.bindSampler(t,i))}unbind(e){let t=e.source,r=this._boundTextures,i=this._gl;for(let s=0;s<r.length;s++)if(r[s]===t){this._activateLocation(s);let o=this.getGlSource(t);i.bindTexture(o.target,null),r[s]=null}}_activateLocation(e){this._activeTextureLocation!==e&&(this._activeTextureLocation=e,this._gl.activeTexture(this._gl.TEXTURE0+e))}_initSource(e){let t=this._gl,r=new ad(t.createTexture());if(r.type=this._mapFormatToType[e.format],r.internalFormat=this._mapFormatToInternalFormat[e.format],r.format=this._mapFormatToFormat[e.format],e.autoGenerateMipmaps&&(this._renderer.context.supports.nonPowOf2mipmaps||e.isPowerOfTwo)){let i=Math.max(e.width,e.height);e.mipLevelCount=Math.floor(Math.log2(i))+1}return this._glTextures[e.uid]=r,this.managedTextures.includes(e)||(e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceUpdate,this),e.on("styleChange",this.onStyleChange,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),e.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(e)),this.onSourceUpdate(e),this.updateStyle(e,!1),r}onStyleChange(e){this.updateStyle(e,!1)}updateStyle(e,t){let r=this._gl,i=this.getGlSource(e);r.bindTexture(r.TEXTURE_2D,i.texture),this._boundTextures[this._activeTextureLocation]=e,g3(e.style,r,e.mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"texParameteri",r.TEXTURE_2D,!this._renderer.context.supports.nonPowOf2wrapping&&!e.isPowerOfTwo,t)}onSourceUnload(e){let t=this._glTextures[e.uid];t&&(this.unbind(e),this._glTextures[e.uid]=null,this._gl.deleteTexture(t.texture))}onSourceUpdate(e){let t=this._gl,r=this.getGlSource(e);t.bindTexture(t.TEXTURE_2D,r.texture),this._boundTextures[this._activeTextureLocation]=e,this._uploads[e.uploadMethodId]?this._uploads[e.uploadMethodId].upload(e,r,t,this._renderer.context.webGLVersion):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.pixelWidth,e.pixelHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),e.autoGenerateMipmaps&&e.mipLevelCount>1&&this.onUpdateMipmaps(e,!1)}onUpdateMipmaps(e,t=!0){t&&this.bindSource(e,0);let r=this.getGlSource(e);this._gl.generateMipmap(r.target)}onSourceDestroy(e){e.off("destroy",this.onSourceDestroy,this),e.off("update",this.onSourceUpdate,this),e.off("resize",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("styleChange",this.onStyleChange,this),e.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}_initSampler(e){let t=this._gl,r=this._gl.createSampler();return this._glSamplers[e._resourceId]=r,g3(e,t,this._boundTextures[this._activeTextureLocation].mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"samplerParameteri",r,!1,!0),this._glSamplers[e._resourceId]}_getGlSampler(e){return this._glSamplers[e._resourceId]||this._initSampler(e)}getGlSource(e){return this._glTextures[e.uid]||this._initSource(e)}generateCanvas(e){let{pixels:t,width:r,height:i}=this.getPixels(e),s=Fe.get().createCanvas();s.width=r,s.height=i;let o=s.getContext("2d");if(o){let a=o.createImageData(r,i);a.data.set(t),o.putImageData(a,0,0)}return s}getPixels(e){let t=e.source.resolution,r=e.frame,i=Math.max(Math.round(r.width*t),1),s=Math.max(Math.round(r.height*t),1),o=new Uint8Array(MQ*i*s),a=this._renderer,l=a.renderTarget.getRenderTarget(e),c=a.renderTarget.getGpuRenderTarget(l),u=a.gl;return u.bindFramebuffer(u.FRAMEBUFFER,c.resolveTargetFramebuffer),u.readPixels(Math.round(r.x*t),Math.round(r.y*t),i,s,u.RGBA,u.UNSIGNED_BYTE,o),{pixels:new Uint8ClampedArray(o.buffer),width:i,height:s}}destroy(){this.managedTextures.slice().forEach(e=>this.onSourceDestroy(e)),this.managedTextures=null,this._renderer=null}};m1.extension={type:[z.WebGLSystem],name:"texture"}});var UN={};X1(UN,{WebGLRenderer:()=>y3});var RQ,FQ,BQ,NN,ON,LN,y3,zT=$(()=>{ee();qE();YE();KE();L0();lg();Yi();JE();tT();iT();oT();aT();lT();cT();fT();mT();AT();kT();DT();$T();RQ=[...V0,d1,Pg,Tg,o1,m1,f1,a1,p1,h1,c1,Qg,u1,l1],FQ=[...j0],BQ=[i1,n1,r1],NN=[],ON=[],LN=[];ke.handleByNamedList(z.WebGLSystem,NN);ke.handleByNamedList(z.WebGLPipes,ON);ke.handleByNamedList(z.WebGLPipesAdaptor,LN);ke.add(...RQ,...FQ,...BQ);y3=class extends Bo{constructor(){let e={name:"webgl",type:Bt.WEBGL,systems:NN,renderPipes:ON,renderPipeAdaptors:LN};super(e)}}});var M3=ut(Ad=>{"use strict";function MZ(n,e,t){if(t===void 0&&(t=Array.prototype),n&&typeof t.find=="function")return t.find.call(n,e);for(var r=0;r<n.length;r++)if(Object.prototype.hasOwnProperty.call(n,r)){var i=n[r];if(e.call(void 0,i,r,n))return i}}function tk(n,e){return e===void 0&&(e=Object),e&&typeof e.freeze=="function"?e.freeze(n):n}function RZ(n,e){if(n===null||typeof n!="object")throw new TypeError("target is not an object");for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n}var uO=tk({HTML:"text/html",isHTML:function(n){return n===uO.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),dO=tk({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(n){return n===dO.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});Ad.assign=RZ;Ad.find=MZ;Ad.freeze=tk;Ad.MIME_TYPE=uO;Ad.NAMESPACE=dO});var fk=ut(tc=>{var bO=M3(),$o=bO.find,R3=bO.NAMESPACE;function FZ(n){return n!==""}function BZ(n){return n?n.split(/[\t\n\f\r ]+/).filter(FZ):[]}function NZ(n,e){return n.hasOwnProperty(e)||(n[e]=!0),n}function fO(n){if(!n)return[];var e=BZ(n);return Object.keys(e.reduce(NZ,{}))}function OZ(n){return function(e){return n&&n.indexOf(e)!==-1}}function B3(n,e){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}function Ii(n,e){var t=n.prototype;if(!(t instanceof e)){let i=function(){};var r=i;i.prototype=e.prototype,i=new i,B3(t,i),n.prototype=t=i}t.constructor!=n&&(typeof n!="function"&&console.error("unknown Class:"+n),t.constructor=n)}var Pi={},no=Pi.ELEMENT_NODE=1,Td=Pi.ATTRIBUTE_NODE=2,Ly=Pi.TEXT_NODE=3,_O=Pi.CDATA_SECTION_NODE=4,vO=Pi.ENTITY_REFERENCE_NODE=5,LZ=Pi.ENTITY_NODE=6,wO=Pi.PROCESSING_INSTRUCTION_NODE=7,SO=Pi.COMMENT_NODE=8,CO=Pi.DOCUMENT_NODE=9,AO=Pi.DOCUMENT_TYPE_NODE=10,Ba=Pi.DOCUMENT_FRAGMENT_NODE=11,UZ=Pi.NOTATION_NODE=12,Vn={},fn={},ZLe=Vn.INDEX_SIZE_ERR=(fn[1]="Index size error",1),JLe=Vn.DOMSTRING_SIZE_ERR=(fn[2]="DOMString size error",2),ki=Vn.HIERARCHY_REQUEST_ERR=(fn[3]="Hierarchy request error",3),eUe=Vn.WRONG_DOCUMENT_ERR=(fn[4]="Wrong document",4),tUe=Vn.INVALID_CHARACTER_ERR=(fn[5]="Invalid character",5),rUe=Vn.NO_DATA_ALLOWED_ERR=(fn[6]="No data allowed",6),nUe=Vn.NO_MODIFICATION_ALLOWED_ERR=(fn[7]="No modification allowed",7),EO=Vn.NOT_FOUND_ERR=(fn[8]="Not found",8),iUe=Vn.NOT_SUPPORTED_ERR=(fn[9]="Not supported",9),hO=Vn.INUSE_ATTRIBUTE_ERR=(fn[10]="Attribute in use",10),sUe=Vn.INVALID_STATE_ERR=(fn[11]="Invalid state",11),oUe=Vn.SYNTAX_ERR=(fn[12]="Syntax error",12),aUe=Vn.INVALID_MODIFICATION_ERR=(fn[13]="Invalid modification",13),lUe=Vn.NAMESPACE_ERR=(fn[14]="Invalid namespace",14),cUe=Vn.INVALID_ACCESS_ERR=(fn[15]="Invalid access",15);function Vr(n,e){if(e instanceof Error)var t=e;else t=this,Error.call(this,fn[n]),this.message=fn[n],Error.captureStackTrace&&Error.captureStackTrace(this,Vr);return t.code=n,e&&(this.message=this.message+": "+e),t}Vr.prototype=Error.prototype;B3(Vn,Vr);function Fa(){}Fa.prototype={length:0,item:function(n){return n>=0&&n<this.length?this[n]:null},toString:function(n,e){for(var t=[],r=0;r<this.length;r++)Ed(this[r],t,n,e);return t.join("")},filter:function(n){return Array.prototype.filter.call(this,n)},indexOf:function(n){return Array.prototype.indexOf.call(this,n)}};function kd(n,e){this._node=n,this._refresh=e,ik(this)}function ik(n){var e=n._node._inc||n._node.ownerDocument._inc;if(n._inc!==e){var t=n._refresh(n._node);if(LO(n,"length",t.length),!n.$$length||t.length<n.$$length)for(var r=t.length;r in n;r++)Object.prototype.hasOwnProperty.call(n,r)&&delete n[r];B3(t,n),n._inc=e}}kd.prototype.item=function(n){return ik(this),this[n]||null};Ii(kd,Fa);function Uy(){}function TO(n,e){for(var t=n.length;t--;)if(n[t]===e)return t}function pO(n,e,t,r){if(r?e[TO(e,r)]=t:e[e.length++]=t,n){t.ownerElement=n;var i=n.ownerDocument;i&&(r&&PO(i,n,r),GZ(i,n,t))}}function mO(n,e,t){var r=TO(e,t);if(r>=0){for(var i=e.length-1;r<i;)e[r]=e[++r];if(e.length=i,n){var s=n.ownerDocument;s&&(PO(s,n,t),t.ownerElement=null)}}else throw new Vr(EO,new Error(n.tagName+"@"+t))}Uy.prototype={length:0,item:Fa.prototype.item,getNamedItem:function(n){for(var e=this.length;e--;){var t=this[e];if(t.nodeName==n)return t}},setNamedItem:function(n){var e=n.ownerElement;if(e&&e!=this._ownerElement)throw new Vr(hO);var t=this.getNamedItem(n.nodeName);return pO(this._ownerElement,this,n,t),t},setNamedItemNS:function(n){var e=n.ownerElement,t;if(e&&e!=this._ownerElement)throw new Vr(hO);return t=this.getNamedItemNS(n.namespaceURI,n.localName),pO(this._ownerElement,this,n,t),t},removeNamedItem:function(n){var e=this.getNamedItem(n);return mO(this._ownerElement,this,e),e},removeNamedItemNS:function(n,e){var t=this.getNamedItemNS(n,e);return mO(this._ownerElement,this,t),t},getNamedItemNS:function(n,e){for(var t=this.length;t--;){var r=this[t];if(r.localName==e&&r.namespaceURI==n)return r}return null}};function kO(){}kO.prototype={hasFeature:function(n,e){return!0},createDocument:function(n,e,t){var r=new N3;if(r.implementation=this,r.childNodes=new Fa,r.doctype=t||null,t&&r.appendChild(t),e){var i=r.createElementNS(n,e);r.appendChild(i)}return r},createDocumentType:function(n,e,t){var r=new zy;return r.name=n,r.nodeName=n,r.publicId=e||"",r.systemId=t||"",r}};function jt(){}jt.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(n,e){return Gy(this,n,e)},replaceChild:function(n,e){Gy(this,n,e,MO),e&&this.removeChild(e)},removeChild:function(n){return DO(this,n)},appendChild:function(n){return this.insertBefore(n,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(n){return nk(this.ownerDocument||this,this,n)},normalize:function(){for(var n=this.firstChild;n;){var e=n.nextSibling;e&&e.nodeType==Ly&&n.nodeType==Ly?(this.removeChild(e),n.appendData(e.data)):(n.normalize(),n=e)}},isSupported:function(n,e){return this.ownerDocument.implementation.hasFeature(n,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(n){for(var e=this;e;){var t=e._nsMap;if(t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&t[r]===n)return r}e=e.nodeType==Td?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(n){for(var e=this;e;){var t=e._nsMap;if(t&&Object.prototype.hasOwnProperty.call(t,n))return t[n];e=e.nodeType==Td?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(n){var e=this.lookupPrefix(n);return e==null}};function IO(n){return n=="<"&&"&lt;"||n==">"&&"&gt;"||n=="&"&&"&amp;"||n=='"'&&"&quot;"||"&#"+n.charCodeAt()+";"}B3(Pi,jt);B3(Pi,jt.prototype);function F3(n,e){if(e(n))return!0;if(n=n.firstChild)do if(F3(n,e))return!0;while(n=n.nextSibling)}function N3(){this.ownerDocument=this}function GZ(n,e,t){n&&n._inc++;var r=t.namespaceURI;r===R3.XMLNS&&(e._nsMap[t.prefix?t.localName:""]=t.value)}function PO(n,e,t,r){n&&n._inc++;var i=t.namespaceURI;i===R3.XMLNS&&delete e._nsMap[t.prefix?t.localName:""]}function sk(n,e,t){if(n&&n._inc){n._inc++;var r=e.childNodes;if(t)r[r.length++]=t;else{for(var i=e.firstChild,s=0;i;)r[s++]=i,i=i.nextSibling;r.length=s,delete r[r.length]}}}function DO(n,e){var t=e.previousSibling,r=e.nextSibling;return t?t.nextSibling=r:n.firstChild=r,r?r.previousSibling=t:n.lastChild=t,e.parentNode=null,e.previousSibling=null,e.nextSibling=null,sk(n.ownerDocument,n),e}function $Z(n){return n&&(n.nodeType===jt.DOCUMENT_NODE||n.nodeType===jt.DOCUMENT_FRAGMENT_NODE||n.nodeType===jt.ELEMENT_NODE)}function zZ(n){return n&&(zo(n)||ok(n)||Na(n)||n.nodeType===jt.DOCUMENT_FRAGMENT_NODE||n.nodeType===jt.COMMENT_NODE||n.nodeType===jt.PROCESSING_INSTRUCTION_NODE)}function Na(n){return n&&n.nodeType===jt.DOCUMENT_TYPE_NODE}function zo(n){return n&&n.nodeType===jt.ELEMENT_NODE}function ok(n){return n&&n.nodeType===jt.TEXT_NODE}function gO(n,e){var t=n.childNodes||[];if($o(t,zo)||Na(e))return!1;var r=$o(t,Na);return!(e&&r&&t.indexOf(r)>t.indexOf(e))}function yO(n,e){var t=n.childNodes||[];function r(s){return zo(s)&&s!==e}if($o(t,r))return!1;var i=$o(t,Na);return!(e&&i&&t.indexOf(i)>t.indexOf(e))}function HZ(n,e,t){if(!$Z(n))throw new Vr(ki,"Unexpected parent node type "+n.nodeType);if(t&&t.parentNode!==n)throw new Vr(EO,"child not in parent");if(!zZ(e)||Na(e)&&n.nodeType!==jt.DOCUMENT_NODE)throw new Vr(ki,"Unexpected node type "+e.nodeType+" for parent node type "+n.nodeType)}function WZ(n,e,t){var r=n.childNodes||[],i=e.childNodes||[];if(e.nodeType===jt.DOCUMENT_FRAGMENT_NODE){var s=i.filter(zo);if(s.length>1||$o(i,ok))throw new Vr(ki,"More than one element or text in fragment");if(s.length===1&&!gO(n,t))throw new Vr(ki,"Element in fragment can not be inserted before doctype")}if(zo(e)&&!gO(n,t))throw new Vr(ki,"Only one element can be added and only after doctype");if(Na(e)){if($o(r,Na))throw new Vr(ki,"Only one doctype is allowed");var o=$o(r,zo);if(t&&r.indexOf(o)<r.indexOf(t))throw new Vr(ki,"Doctype can only be inserted before an element");if(!t&&o)throw new Vr(ki,"Doctype can not be appended since element is present")}}function MO(n,e,t){var r=n.childNodes||[],i=e.childNodes||[];if(e.nodeType===jt.DOCUMENT_FRAGMENT_NODE){var s=i.filter(zo);if(s.length>1||$o(i,ok))throw new Vr(ki,"More than one element or text in fragment");if(s.length===1&&!yO(n,t))throw new Vr(ki,"Element in fragment can not be inserted before doctype")}if(zo(e)&&!yO(n,t))throw new Vr(ki,"Only one element can be added and only after doctype");if(Na(e)){let l=function(c){return Na(c)&&c!==t};var a=l;if($o(r,l))throw new Vr(ki,"Only one doctype is allowed");var o=$o(r,zo);if(t&&r.indexOf(o)<r.indexOf(t))throw new Vr(ki,"Doctype can only be inserted before an element")}}function Gy(n,e,t,r){HZ(n,e,t),n.nodeType===jt.DOCUMENT_NODE&&(r||WZ)(n,e,t);var i=e.parentNode;if(i&&i.removeChild(e),e.nodeType===Ba){var s=e.firstChild;if(s==null)return e;var o=e.lastChild}else s=o=e;var a=t?t.previousSibling:n.lastChild;s.previousSibling=a,o.nextSibling=t,a?a.nextSibling=s:n.firstChild=s,t==null?n.lastChild=o:t.previousSibling=o;do s.parentNode=n;while(s!==o&&(s=s.nextSibling));return sk(n.ownerDocument||n,n),e.nodeType==Ba&&(e.firstChild=e.lastChild=null),e}function VZ(n,e){return e.parentNode&&e.parentNode.removeChild(e),e.parentNode=n,e.previousSibling=n.lastChild,e.nextSibling=null,e.previousSibling?e.previousSibling.nextSibling=e:n.firstChild=e,n.lastChild=e,sk(n.ownerDocument,n,e),e}N3.prototype={nodeName:"#document",nodeType:CO,doctype:null,documentElement:null,_inc:1,insertBefore:function(n,e){if(n.nodeType==Ba){for(var t=n.firstChild;t;){var r=t.nextSibling;this.insertBefore(t,e),t=r}return n}return Gy(this,n,e),n.ownerDocument=this,this.documentElement===null&&n.nodeType===no&&(this.documentElement=n),n},removeChild:function(n){return this.documentElement==n&&(this.documentElement=null),DO(this,n)},replaceChild:function(n,e){Gy(this,n,e,MO),n.ownerDocument=this,e&&this.removeChild(e),zo(n)&&(this.documentElement=n)},importNode:function(n,e){return OO(this,n,e)},getElementById:function(n){var e=null;return F3(this.documentElement,function(t){if(t.nodeType==no&&t.getAttribute("id")==n)return e=t,!0}),e},getElementsByClassName:function(n){var e=fO(n);return new kd(this,function(t){var r=[];return e.length>0&&F3(t.documentElement,function(i){if(i!==t&&i.nodeType===no){var s=i.getAttribute("class");if(s){var o=n===s;if(!o){var a=fO(s);o=e.every(OZ(a))}o&&r.push(i)}}}),r})},createElement:function(n){var e=new g1;e.ownerDocument=this,e.nodeName=n,e.tagName=n,e.localName=n,e.childNodes=new Fa;var t=e.attributes=new Uy;return t._ownerElement=e,e},createDocumentFragment:function(){var n=new Hy;return n.ownerDocument=this,n.childNodes=new Fa,n},createTextNode:function(n){var e=new ak;return e.ownerDocument=this,e.appendData(n),e},createComment:function(n){var e=new lk;return e.ownerDocument=this,e.appendData(n),e},createCDATASection:function(n){var e=new ck;return e.ownerDocument=this,e.appendData(n),e},createProcessingInstruction:function(n,e){var t=new dk;return t.ownerDocument=this,t.tagName=t.nodeName=t.target=n,t.nodeValue=t.data=e,t},createAttribute:function(n){var e=new $y;return e.ownerDocument=this,e.name=n,e.nodeName=n,e.localName=n,e.specified=!0,e},createEntityReference:function(n){var e=new uk;return e.ownerDocument=this,e.nodeName=n,e},createElementNS:function(n,e){var t=new g1,r=e.split(":"),i=t.attributes=new Uy;return t.childNodes=new Fa,t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.namespaceURI=n,r.length==2?(t.prefix=r[0],t.localName=r[1]):t.localName=e,i._ownerElement=t,t},createAttributeNS:function(n,e){var t=new $y,r=e.split(":");return t.ownerDocument=this,t.nodeName=e,t.name=e,t.namespaceURI=n,t.specified=!0,r.length==2?(t.prefix=r[0],t.localName=r[1]):t.localName=e,t}};Ii(N3,jt);function g1(){this._nsMap={}}g1.prototype={nodeType:no,hasAttribute:function(n){return this.getAttributeNode(n)!=null},getAttribute:function(n){var e=this.getAttributeNode(n);return e&&e.value||""},getAttributeNode:function(n){return this.attributes.getNamedItem(n)},setAttribute:function(n,e){var t=this.ownerDocument.createAttribute(n);t.value=t.nodeValue=""+e,this.setAttributeNode(t)},removeAttribute:function(n){var e=this.getAttributeNode(n);e&&this.removeAttributeNode(e)},appendChild:function(n){return n.nodeType===Ba?this.insertBefore(n,null):VZ(this,n)},setAttributeNode:function(n){return this.attributes.setNamedItem(n)},setAttributeNodeNS:function(n){return this.attributes.setNamedItemNS(n)},removeAttributeNode:function(n){return this.attributes.removeNamedItem(n.nodeName)},removeAttributeNS:function(n,e){var t=this.getAttributeNodeNS(n,e);t&&this.removeAttributeNode(t)},hasAttributeNS:function(n,e){return this.getAttributeNodeNS(n,e)!=null},getAttributeNS:function(n,e){var t=this.getAttributeNodeNS(n,e);return t&&t.value||""},setAttributeNS:function(n,e,t){var r=this.ownerDocument.createAttributeNS(n,e);r.value=r.nodeValue=""+t,this.setAttributeNode(r)},getAttributeNodeNS:function(n,e){return this.attributes.getNamedItemNS(n,e)},getElementsByTagName:function(n){return new kd(this,function(e){var t=[];return F3(e,function(r){r!==e&&r.nodeType==no&&(n==="*"||r.tagName==n)&&t.push(r)}),t})},getElementsByTagNameNS:function(n,e){return new kd(this,function(t){var r=[];return F3(t,function(i){i!==t&&i.nodeType===no&&(n==="*"||i.namespaceURI===n)&&(e==="*"||i.localName==e)&&r.push(i)}),r})}};N3.prototype.getElementsByTagName=g1.prototype.getElementsByTagName;N3.prototype.getElementsByTagNameNS=g1.prototype.getElementsByTagNameNS;Ii(g1,jt);function $y(){}$y.prototype.nodeType=Td;Ii($y,jt);function O3(){}O3.prototype={data:"",substringData:function(n,e){return this.data.substring(n,n+e)},appendData:function(n){n=this.data+n,this.nodeValue=this.data=n,this.length=n.length},insertData:function(n,e){this.replaceData(n,0,e)},appendChild:function(n){throw new Error(fn[ki])},deleteData:function(n,e){this.replaceData(n,e,"")},replaceData:function(n,e,t){var r=this.data.substring(0,n),i=this.data.substring(n+e);t=r+t+i,this.nodeValue=this.data=t,this.length=t.length}};Ii(O3,jt);function ak(){}ak.prototype={nodeName:"#text",nodeType:Ly,splitText:function(n){var e=this.data,t=e.substring(n);e=e.substring(0,n),this.data=this.nodeValue=e,this.length=e.length;var r=this.ownerDocument.createTextNode(t);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}};Ii(ak,O3);function lk(){}lk.prototype={nodeName:"#comment",nodeType:SO};Ii(lk,O3);function ck(){}ck.prototype={nodeName:"#cdata-section",nodeType:_O};Ii(ck,O3);function zy(){}zy.prototype.nodeType=AO;Ii(zy,jt);function RO(){}RO.prototype.nodeType=UZ;Ii(RO,jt);function FO(){}FO.prototype.nodeType=LZ;Ii(FO,jt);function uk(){}uk.prototype.nodeType=vO;Ii(uk,jt);function Hy(){}Hy.prototype.nodeName="#document-fragment";Hy.prototype.nodeType=Ba;Ii(Hy,jt);function dk(){}dk.prototype.nodeType=wO;Ii(dk,jt);function BO(){}BO.prototype.serializeToString=function(n,e,t){return NO.call(n,e,t)};jt.prototype.toString=NO;function NO(n,e){var t=[],r=this.nodeType==9&&this.documentElement||this,i=r.prefix,s=r.namespaceURI;if(s&&i==null){var i=r.lookupPrefix(s);if(i==null)var o=[{namespace:s,prefix:null}]}return Ed(this,t,n,e,o),t.join("")}function xO(n,e,t){var r=n.prefix||"",i=n.namespaceURI;if(!i||r==="xml"&&i===R3.XML||i===R3.XMLNS)return!1;for(var s=t.length;s--;){var o=t[s];if(o.prefix===r)return o.namespace!==i}return!0}function rk(n,e,t){n.push(" ",e,'="',t.replace(/[<>&"\t\n\r]/g,IO),'"')}function Ed(n,e,t,r,i){if(i||(i=[]),r)if(n=r(n),n){if(typeof n=="string"){e.push(n);return}}else return;switch(n.nodeType){case no:var s=n.attributes,o=s.length,y=n.firstChild,a=n.tagName;t=R3.isHTML(n.namespaceURI)||t;var l=a;if(!t&&!n.prefix&&n.namespaceURI){for(var c,u=0;u<s.length;u++)if(s.item(u).name==="xmlns"){c=s.item(u).value;break}if(!c)for(var d=i.length-1;d>=0;d--){var f=i[d];if(f.prefix===""&&f.namespace===n.namespaceURI){c=f.namespace;break}}if(c!==n.namespaceURI)for(var d=i.length-1;d>=0;d--){var f=i[d];if(f.namespace===n.namespaceURI){f.prefix&&(l=f.prefix+":"+a);break}}}e.push("<",l);for(var h=0;h<o;h++){var p=s.item(h);p.prefix=="xmlns"?i.push({prefix:p.localName,namespace:p.value}):p.nodeName=="xmlns"&&i.push({prefix:"",namespace:p.value})}for(var h=0;h<o;h++){var p=s.item(h);if(xO(p,t,i)){var m=p.prefix||"",g=p.namespaceURI;rk(e,m?"xmlns:"+m:"xmlns",g),i.push({prefix:m,namespace:g})}Ed(p,e,t,r,i)}if(a===l&&xO(n,t,i)){var m=n.prefix||"",g=n.namespaceURI;rk(e,m?"xmlns:"+m:"xmlns",g),i.push({prefix:m,namespace:g})}if(y||t&&!/^(?:meta|link|img|br|hr|input)$/i.test(a)){if(e.push(">"),t&&/^script$/i.test(a))for(;y;)y.data?e.push(y.data):Ed(y,e,t,r,i.slice()),y=y.nextSibling;else for(;y;)Ed(y,e,t,r,i.slice()),y=y.nextSibling;e.push("</",l,">")}else e.push("/>");return;case CO:case Ba:for(var y=n.firstChild;y;)Ed(y,e,t,r,i.slice()),y=y.nextSibling;return;case Td:return rk(e,n.name,n.value);case Ly:return e.push(n.data.replace(/[<&>]/g,IO));case _O:return e.push("<![CDATA[",n.data,"]]>");case SO:return e.push("<!--",n.data,"-->");case AO:var x=n.publicId,b=n.systemId;if(e.push("<!DOCTYPE ",n.name),x)e.push(" PUBLIC ",x),b&&b!="."&&e.push(" ",b),e.push(">");else if(b&&b!=".")e.push(" SYSTEM ",b,">");else{var _=n.internalSubset;_&&e.push(" [",_,"]"),e.push(">")}return;case wO:return e.push("<?",n.target," ",n.data,"?>");case vO:return e.push("&",n.nodeName,";");default:e.push("??",n.nodeName)}}function OO(n,e,t){var r;switch(e.nodeType){case no:r=e.cloneNode(!1),r.ownerDocument=n;case Ba:break;case Td:t=!0;break}if(r||(r=e.cloneNode(!1)),r.ownerDocument=n,r.parentNode=null,t)for(var i=e.firstChild;i;)r.appendChild(OO(n,i,t)),i=i.nextSibling;return r}function nk(n,e,t){var r=new e.constructor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];typeof s!="object"&&s!=r[i]&&(r[i]=s)}switch(e.childNodes&&(r.childNodes=new Fa),r.ownerDocument=n,r.nodeType){case no:var o=e.attributes,a=r.attributes=new Uy,l=o.length;a._ownerElement=r;for(var c=0;c<l;c++)r.setAttributeNode(nk(n,o.item(c),!0));break;case Td:t=!0}if(t)for(var u=e.firstChild;u;)r.appendChild(nk(n,u,t)),u=u.nextSibling;return r}function LO(n,e,t){n[e]=t}try{if(Object.defineProperty){let n=function(e){switch(e.nodeType){case no:case Ba:var t=[];for(e=e.firstChild;e;)e.nodeType!==7&&e.nodeType!==8&&t.push(n(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}};jZ=n,Object.defineProperty(kd.prototype,"length",{get:function(){return ik(this),this.$$length}}),Object.defineProperty(jt.prototype,"textContent",{get:function(){return n(this)},set:function(e){switch(this.nodeType){case no:case Ba:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),LO=function(e,t,r){e["$$"+t]=r}}}catch{}var jZ;tc.DocumentType=zy;tc.DOMException=Vr;tc.DOMImplementation=kO;tc.Element=g1;tc.Node=jt;tc.NodeList=Fa;tc.XMLSerializer=BO});var GO=ut(L3=>{"use strict";var UO=M3().freeze;L3.XML_ENTITIES=UO({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'});L3.HTML_ENTITIES=UO({Aacute:"\xC1",aacute:"\xE1",Abreve:"\u0102",abreve:"\u0103",ac:"\u223E",acd:"\u223F",acE:"\u223E\u0333",Acirc:"\xC2",acirc:"\xE2",acute:"\xB4",Acy:"\u0410",acy:"\u0430",AElig:"\xC6",aelig:"\xE6",af:"\u2061",Afr:"\u{1D504}",afr:"\u{1D51E}",Agrave:"\xC0",agrave:"\xE0",alefsym:"\u2135",aleph:"\u2135",Alpha:"\u0391",alpha:"\u03B1",Amacr:"\u0100",amacr:"\u0101",amalg:"\u2A3F",AMP:"&",amp:"&",And:"\u2A53",and:"\u2227",andand:"\u2A55",andd:"\u2A5C",andslope:"\u2A58",andv:"\u2A5A",ang:"\u2220",ange:"\u29A4",angle:"\u2220",angmsd:"\u2221",angmsdaa:"\u29A8",angmsdab:"\u29A9",angmsdac:"\u29AA",angmsdad:"\u29AB",angmsdae:"\u29AC",angmsdaf:"\u29AD",angmsdag:"\u29AE",angmsdah:"\u29AF",angrt:"\u221F",angrtvb:"\u22BE",angrtvbd:"\u299D",angsph:"\u2222",angst:"\xC5",angzarr:"\u237C",Aogon:"\u0104",aogon:"\u0105",Aopf:"\u{1D538}",aopf:"\u{1D552}",ap:"\u2248",apacir:"\u2A6F",apE:"\u2A70",ape:"\u224A",apid:"\u224B",apos:"'",ApplyFunction:"\u2061",approx:"\u2248",approxeq:"\u224A",Aring:"\xC5",aring:"\xE5",Ascr:"\u{1D49C}",ascr:"\u{1D4B6}",Assign:"\u2254",ast:"*",asymp:"\u2248",asympeq:"\u224D",Atilde:"\xC3",atilde:"\xE3",Auml:"\xC4",auml:"\xE4",awconint:"\u2233",awint:"\u2A11",backcong:"\u224C",backepsilon:"\u03F6",backprime:"\u2035",backsim:"\u223D",backsimeq:"\u22CD",Backslash:"\u2216",Barv:"\u2AE7",barvee:"\u22BD",Barwed:"\u2306",barwed:"\u2305",barwedge:"\u2305",bbrk:"\u23B5",bbrktbrk:"\u23B6",bcong:"\u224C",Bcy:"\u0411",bcy:"\u0431",bdquo:"\u201E",becaus:"\u2235",Because:"\u2235",because:"\u2235",bemptyv:"\u29B0",bepsi:"\u03F6",bernou:"\u212C",Bernoullis:"\u212C",Beta:"\u0392",beta:"\u03B2",beth:"\u2136",between:"\u226C",Bfr:"\u{1D505}",bfr:"\u{1D51F}",bigcap:"\u22C2",bigcirc:"\u25EF",bigcup:"\u22C3",bigodot:"\u2A00",bigoplus:"\u2A01",bigotimes:"\u2A02",bigsqcup:"\u2A06",bigstar:"\u2605",bigtriangledown:"\u25BD",bigtriangleup:"\u25B3",biguplus:"\u2A04",bigvee:"\u22C1",bigwedge:"\u22C0",bkarow:"\u290D",blacklozenge:"\u29EB",blacksquare:"\u25AA",blacktriangle:"\u25B4",blacktriangledown:"\u25BE",blacktriangleleft:"\u25C2",blacktriangleright:"\u25B8",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bne:"=\u20E5",bnequiv:"\u2261\u20E5",bNot:"\u2AED",bnot:"\u2310",Bopf:"\u{1D539}",bopf:"\u{1D553}",bot:"\u22A5",bottom:"\u22A5",bowtie:"\u22C8",boxbox:"\u29C9",boxDL:"\u2557",boxDl:"\u2556",boxdL:"\u2555",boxdl:"\u2510",boxDR:"\u2554",boxDr:"\u2553",boxdR:"\u2552",boxdr:"\u250C",boxH:"\u2550",boxh:"\u2500",boxHD:"\u2566",boxHd:"\u2564",boxhD:"\u2565",boxhd:"\u252C",boxHU:"\u2569",boxHu:"\u2567",boxhU:"\u2568",boxhu:"\u2534",boxminus:"\u229F",boxplus:"\u229E",boxtimes:"\u22A0",boxUL:"\u255D",boxUl:"\u255C",boxuL:"\u255B",boxul:"\u2518",boxUR:"\u255A",boxUr:"\u2559",boxuR:"\u2558",boxur:"\u2514",boxV:"\u2551",boxv:"\u2502",boxVH:"\u256C",boxVh:"\u256B",boxvH:"\u256A",boxvh:"\u253C",boxVL:"\u2563",boxVl:"\u2562",boxvL:"\u2561",boxvl:"\u2524",boxVR:"\u2560",boxVr:"\u255F",boxvR:"\u255E",boxvr:"\u251C",bprime:"\u2035",Breve:"\u02D8",breve:"\u02D8",brvbar:"\xA6",Bscr:"\u212C",bscr:"\u{1D4B7}",bsemi:"\u204F",bsim:"\u223D",bsime:"\u22CD",bsol:"\\",bsolb:"\u29C5",bsolhsub:"\u27C8",bull:"\u2022",bullet:"\u2022",bump:"\u224E",bumpE:"\u2AAE",bumpe:"\u224F",Bumpeq:"\u224E",bumpeq:"\u224F",Cacute:"\u0106",cacute:"\u0107",Cap:"\u22D2",cap:"\u2229",capand:"\u2A44",capbrcup:"\u2A49",capcap:"\u2A4B",capcup:"\u2A47",capdot:"\u2A40",CapitalDifferentialD:"\u2145",caps:"\u2229\uFE00",caret:"\u2041",caron:"\u02C7",Cayleys:"\u212D",ccaps:"\u2A4D",Ccaron:"\u010C",ccaron:"\u010D",Ccedil:"\xC7",ccedil:"\xE7",Ccirc:"\u0108",ccirc:"\u0109",Cconint:"\u2230",ccups:"\u2A4C",ccupssm:"\u2A50",Cdot:"\u010A",cdot:"\u010B",cedil:"\xB8",Cedilla:"\xB8",cemptyv:"\u29B2",cent:"\xA2",CenterDot:"\xB7",centerdot:"\xB7",Cfr:"\u212D",cfr:"\u{1D520}",CHcy:"\u0427",chcy:"\u0447",check:"\u2713",checkmark:"\u2713",Chi:"\u03A7",chi:"\u03C7",cir:"\u25CB",circ:"\u02C6",circeq:"\u2257",circlearrowleft:"\u21BA",circlearrowright:"\u21BB",circledast:"\u229B",circledcirc:"\u229A",circleddash:"\u229D",CircleDot:"\u2299",circledR:"\xAE",circledS:"\u24C8",CircleMinus:"\u2296",CirclePlus:"\u2295",CircleTimes:"\u2297",cirE:"\u29C3",cire:"\u2257",cirfnint:"\u2A10",cirmid:"\u2AEF",cirscir:"\u29C2",ClockwiseContourIntegral:"\u2232",CloseCurlyDoubleQuote:"\u201D",CloseCurlyQuote:"\u2019",clubs:"\u2663",clubsuit:"\u2663",Colon:"\u2237",colon:":",Colone:"\u2A74",colone:"\u2254",coloneq:"\u2254",comma:",",commat:"@",comp:"\u2201",compfn:"\u2218",complement:"\u2201",complexes:"\u2102",cong:"\u2245",congdot:"\u2A6D",Congruent:"\u2261",Conint:"\u222F",conint:"\u222E",ContourIntegral:"\u222E",Copf:"\u2102",copf:"\u{1D554}",coprod:"\u2210",Coproduct:"\u2210",COPY:"\xA9",copy:"\xA9",copysr:"\u2117",CounterClockwiseContourIntegral:"\u2233",crarr:"\u21B5",Cross:"\u2A2F",cross:"\u2717",Cscr:"\u{1D49E}",cscr:"\u{1D4B8}",csub:"\u2ACF",csube:"\u2AD1",csup:"\u2AD0",csupe:"\u2AD2",ctdot:"\u22EF",cudarrl:"\u2938",cudarrr:"\u2935",cuepr:"\u22DE",cuesc:"\u22DF",cularr:"\u21B6",cularrp:"\u293D",Cup:"\u22D3",cup:"\u222A",cupbrcap:"\u2A48",CupCap:"\u224D",cupcap:"\u2A46",cupcup:"\u2A4A",cupdot:"\u228D",cupor:"\u2A45",cups:"\u222A\uFE00",curarr:"\u21B7",curarrm:"\u293C",curlyeqprec:"\u22DE",curlyeqsucc:"\u22DF",curlyvee:"\u22CE",curlywedge:"\u22CF",curren:"\xA4",curvearrowleft:"\u21B6",curvearrowright:"\u21B7",cuvee:"\u22CE",cuwed:"\u22CF",cwconint:"\u2232",cwint:"\u2231",cylcty:"\u232D",Dagger:"\u2021",dagger:"\u2020",daleth:"\u2138",Darr:"\u21A1",dArr:"\u21D3",darr:"\u2193",dash:"\u2010",Dashv:"\u2AE4",dashv:"\u22A3",dbkarow:"\u290F",dblac:"\u02DD",Dcaron:"\u010E",dcaron:"\u010F",Dcy:"\u0414",dcy:"\u0434",DD:"\u2145",dd:"\u2146",ddagger:"\u2021",ddarr:"\u21CA",DDotrahd:"\u2911",ddotseq:"\u2A77",deg:"\xB0",Del:"\u2207",Delta:"\u0394",delta:"\u03B4",demptyv:"\u29B1",dfisht:"\u297F",Dfr:"\u{1D507}",dfr:"\u{1D521}",dHar:"\u2965",dharl:"\u21C3",dharr:"\u21C2",DiacriticalAcute:"\xB4",DiacriticalDot:"\u02D9",DiacriticalDoubleAcute:"\u02DD",DiacriticalGrave:"`",DiacriticalTilde:"\u02DC",diam:"\u22C4",Diamond:"\u22C4",diamond:"\u22C4",diamondsuit:"\u2666",diams:"\u2666",die:"\xA8",DifferentialD:"\u2146",digamma:"\u03DD",disin:"\u22F2",div:"\xF7",divide:"\xF7",divideontimes:"\u22C7",divonx:"\u22C7",DJcy:"\u0402",djcy:"\u0452",dlcorn:"\u231E",dlcrop:"\u230D",dollar:"$",Dopf:"\u{1D53B}",dopf:"\u{1D555}",Dot:"\xA8",dot:"\u02D9",DotDot:"\u20DC",doteq:"\u2250",doteqdot:"\u2251",DotEqual:"\u2250",dotminus:"\u2238",dotplus:"\u2214",dotsquare:"\u22A1",doublebarwedge:"\u2306",DoubleContourIntegral:"\u222F",DoubleDot:"\xA8",DoubleDownArrow:"\u21D3",DoubleLeftArrow:"\u21D0",DoubleLeftRightArrow:"\u21D4",DoubleLeftTee:"\u2AE4",DoubleLongLeftArrow:"\u27F8",DoubleLongLeftRightArrow:"\u27FA",DoubleLongRightArrow:"\u27F9",DoubleRightArrow:"\u21D2",DoubleRightTee:"\u22A8",DoubleUpArrow:"\u21D1",DoubleUpDownArrow:"\u21D5",DoubleVerticalBar:"\u2225",DownArrow:"\u2193",Downarrow:"\u21D3",downarrow:"\u2193",DownArrowBar:"\u2913",DownArrowUpArrow:"\u21F5",DownBreve:"\u0311",downdownarrows:"\u21CA",downharpoonleft:"\u21C3",downharpoonright:"\u21C2",DownLeftRightVector:"\u2950",DownLeftTeeVector:"\u295E",DownLeftVector:"\u21BD",DownLeftVectorBar:"\u2956",DownRightTeeVector:"\u295F",DownRightVector:"\u21C1",DownRightVectorBar:"\u2957",DownTee:"\u22A4",DownTeeArrow:"\u21A7",drbkarow:"\u2910",drcorn:"\u231F",drcrop:"\u230C",Dscr:"\u{1D49F}",dscr:"\u{1D4B9}",DScy:"\u0405",dscy:"\u0455",dsol:"\u29F6",Dstrok:"\u0110",dstrok:"\u0111",dtdot:"\u22F1",dtri:"\u25BF",dtrif:"\u25BE",duarr:"\u21F5",duhar:"\u296F",dwangle:"\u29A6",DZcy:"\u040F",dzcy:"\u045F",dzigrarr:"\u27FF",Eacute:"\xC9",eacute:"\xE9",easter:"\u2A6E",Ecaron:"\u011A",ecaron:"\u011B",ecir:"\u2256",Ecirc:"\xCA",ecirc:"\xEA",ecolon:"\u2255",Ecy:"\u042D",ecy:"\u044D",eDDot:"\u2A77",Edot:"\u0116",eDot:"\u2251",edot:"\u0117",ee:"\u2147",efDot:"\u2252",Efr:"\u{1D508}",efr:"\u{1D522}",eg:"\u2A9A",Egrave:"\xC8",egrave:"\xE8",egs:"\u2A96",egsdot:"\u2A98",el:"\u2A99",Element:"\u2208",elinters:"\u23E7",ell:"\u2113",els:"\u2A95",elsdot:"\u2A97",Emacr:"\u0112",emacr:"\u0113",empty:"\u2205",emptyset:"\u2205",EmptySmallSquare:"\u25FB",emptyv:"\u2205",EmptyVerySmallSquare:"\u25AB",emsp:"\u2003",emsp13:"\u2004",emsp14:"\u2005",ENG:"\u014A",eng:"\u014B",ensp:"\u2002",Eogon:"\u0118",eogon:"\u0119",Eopf:"\u{1D53C}",eopf:"\u{1D556}",epar:"\u22D5",eparsl:"\u29E3",eplus:"\u2A71",epsi:"\u03B5",Epsilon:"\u0395",epsilon:"\u03B5",epsiv:"\u03F5",eqcirc:"\u2256",eqcolon:"\u2255",eqsim:"\u2242",eqslantgtr:"\u2A96",eqslantless:"\u2A95",Equal:"\u2A75",equals:"=",EqualTilde:"\u2242",equest:"\u225F",Equilibrium:"\u21CC",equiv:"\u2261",equivDD:"\u2A78",eqvparsl:"\u29E5",erarr:"\u2971",erDot:"\u2253",Escr:"\u2130",escr:"\u212F",esdot:"\u2250",Esim:"\u2A73",esim:"\u2242",Eta:"\u0397",eta:"\u03B7",ETH:"\xD0",eth:"\xF0",Euml:"\xCB",euml:"\xEB",euro:"\u20AC",excl:"!",exist:"\u2203",Exists:"\u2203",expectation:"\u2130",ExponentialE:"\u2147",exponentiale:"\u2147",fallingdotseq:"\u2252",Fcy:"\u0424",fcy:"\u0444",female:"\u2640",ffilig:"\uFB03",fflig:"\uFB00",ffllig:"\uFB04",Ffr:"\u{1D509}",ffr:"\u{1D523}",filig:"\uFB01",FilledSmallSquare:"\u25FC",FilledVerySmallSquare:"\u25AA",fjlig:"fj",flat:"\u266D",fllig:"\uFB02",fltns:"\u25B1",fnof:"\u0192",Fopf:"\u{1D53D}",fopf:"\u{1D557}",ForAll:"\u2200",forall:"\u2200",fork:"\u22D4",forkv:"\u2AD9",Fouriertrf:"\u2131",fpartint:"\u2A0D",frac12:"\xBD",frac13:"\u2153",frac14:"\xBC",frac15:"\u2155",frac16:"\u2159",frac18:"\u215B",frac23:"\u2154",frac25:"\u2156",frac34:"\xBE",frac35:"\u2157",frac38:"\u215C",frac45:"\u2158",frac56:"\u215A",frac58:"\u215D",frac78:"\u215E",frasl:"\u2044",frown:"\u2322",Fscr:"\u2131",fscr:"\u{1D4BB}",gacute:"\u01F5",Gamma:"\u0393",gamma:"\u03B3",Gammad:"\u03DC",gammad:"\u03DD",gap:"\u2A86",Gbreve:"\u011E",gbreve:"\u011F",Gcedil:"\u0122",Gcirc:"\u011C",gcirc:"\u011D",Gcy:"\u0413",gcy:"\u0433",Gdot:"\u0120",gdot:"\u0121",gE:"\u2267",ge:"\u2265",gEl:"\u2A8C",gel:"\u22DB",geq:"\u2265",geqq:"\u2267",geqslant:"\u2A7E",ges:"\u2A7E",gescc:"\u2AA9",gesdot:"\u2A80",gesdoto:"\u2A82",gesdotol:"\u2A84",gesl:"\u22DB\uFE00",gesles:"\u2A94",Gfr:"\u{1D50A}",gfr:"\u{1D524}",Gg:"\u22D9",gg:"\u226B",ggg:"\u22D9",gimel:"\u2137",GJcy:"\u0403",gjcy:"\u0453",gl:"\u2277",gla:"\u2AA5",glE:"\u2A92",glj:"\u2AA4",gnap:"\u2A8A",gnapprox:"\u2A8A",gnE:"\u2269",gne:"\u2A88",gneq:"\u2A88",gneqq:"\u2269",gnsim:"\u22E7",Gopf:"\u{1D53E}",gopf:"\u{1D558}",grave:"`",GreaterEqual:"\u2265",GreaterEqualLess:"\u22DB",GreaterFullEqual:"\u2267",GreaterGreater:"\u2AA2",GreaterLess:"\u2277",GreaterSlantEqual:"\u2A7E",GreaterTilde:"\u2273",Gscr:"\u{1D4A2}",gscr:"\u210A",gsim:"\u2273",gsime:"\u2A8E",gsiml:"\u2A90",Gt:"\u226B",GT:">",gt:">",gtcc:"\u2AA7",gtcir:"\u2A7A",gtdot:"\u22D7",gtlPar:"\u2995",gtquest:"\u2A7C",gtrapprox:"\u2A86",gtrarr:"\u2978",gtrdot:"\u22D7",gtreqless:"\u22DB",gtreqqless:"\u2A8C",gtrless:"\u2277",gtrsim:"\u2273",gvertneqq:"\u2269\uFE00",gvnE:"\u2269\uFE00",Hacek:"\u02C7",hairsp:"\u200A",half:"\xBD",hamilt:"\u210B",HARDcy:"\u042A",hardcy:"\u044A",hArr:"\u21D4",harr:"\u2194",harrcir:"\u2948",harrw:"\u21AD",Hat:"^",hbar:"\u210F",Hcirc:"\u0124",hcirc:"\u0125",hearts:"\u2665",heartsuit:"\u2665",hellip:"\u2026",hercon:"\u22B9",Hfr:"\u210C",hfr:"\u{1D525}",HilbertSpace:"\u210B",hksearow:"\u2925",hkswarow:"\u2926",hoarr:"\u21FF",homtht:"\u223B",hookleftarrow:"\u21A9",hookrightarrow:"\u21AA",Hopf:"\u210D",hopf:"\u{1D559}",horbar:"\u2015",HorizontalLine:"\u2500",Hscr:"\u210B",hscr:"\u{1D4BD}",hslash:"\u210F",Hstrok:"\u0126",hstrok:"\u0127",HumpDownHump:"\u224E",HumpEqual:"\u224F",hybull:"\u2043",hyphen:"\u2010",Iacute:"\xCD",iacute:"\xED",ic:"\u2063",Icirc:"\xCE",icirc:"\xEE",Icy:"\u0418",icy:"\u0438",Idot:"\u0130",IEcy:"\u0415",iecy:"\u0435",iexcl:"\xA1",iff:"\u21D4",Ifr:"\u2111",ifr:"\u{1D526}",Igrave:"\xCC",igrave:"\xEC",ii:"\u2148",iiiint:"\u2A0C",iiint:"\u222D",iinfin:"\u29DC",iiota:"\u2129",IJlig:"\u0132",ijlig:"\u0133",Im:"\u2111",Imacr:"\u012A",imacr:"\u012B",image:"\u2111",ImaginaryI:"\u2148",imagline:"\u2110",imagpart:"\u2111",imath:"\u0131",imof:"\u22B7",imped:"\u01B5",Implies:"\u21D2",in:"\u2208",incare:"\u2105",infin:"\u221E",infintie:"\u29DD",inodot:"\u0131",Int:"\u222C",int:"\u222B",intcal:"\u22BA",integers:"\u2124",Integral:"\u222B",intercal:"\u22BA",Intersection:"\u22C2",intlarhk:"\u2A17",intprod:"\u2A3C",InvisibleComma:"\u2063",InvisibleTimes:"\u2062",IOcy:"\u0401",iocy:"\u0451",Iogon:"\u012E",iogon:"\u012F",Iopf:"\u{1D540}",iopf:"\u{1D55A}",Iota:"\u0399",iota:"\u03B9",iprod:"\u2A3C",iquest:"\xBF",Iscr:"\u2110",iscr:"\u{1D4BE}",isin:"\u2208",isindot:"\u22F5",isinE:"\u22F9",isins:"\u22F4",isinsv:"\u22F3",isinv:"\u2208",it:"\u2062",Itilde:"\u0128",itilde:"\u0129",Iukcy:"\u0406",iukcy:"\u0456",Iuml:"\xCF",iuml:"\xEF",Jcirc:"\u0134",jcirc:"\u0135",Jcy:"\u0419",jcy:"\u0439",Jfr:"\u{1D50D}",jfr:"\u{1D527}",jmath:"\u0237",Jopf:"\u{1D541}",jopf:"\u{1D55B}",Jscr:"\u{1D4A5}",jscr:"\u{1D4BF}",Jsercy:"\u0408",jsercy:"\u0458",Jukcy:"\u0404",jukcy:"\u0454",Kappa:"\u039A",kappa:"\u03BA",kappav:"\u03F0",Kcedil:"\u0136",kcedil:"\u0137",Kcy:"\u041A",kcy:"\u043A",Kfr:"\u{1D50E}",kfr:"\u{1D528}",kgreen:"\u0138",KHcy:"\u0425",khcy:"\u0445",KJcy:"\u040C",kjcy:"\u045C",Kopf:"\u{1D542}",kopf:"\u{1D55C}",Kscr:"\u{1D4A6}",kscr:"\u{1D4C0}",lAarr:"\u21DA",Lacute:"\u0139",lacute:"\u013A",laemptyv:"\u29B4",lagran:"\u2112",Lambda:"\u039B",lambda:"\u03BB",Lang:"\u27EA",lang:"\u27E8",langd:"\u2991",langle:"\u27E8",lap:"\u2A85",Laplacetrf:"\u2112",laquo:"\xAB",Larr:"\u219E",lArr:"\u21D0",larr:"\u2190",larrb:"\u21E4",larrbfs:"\u291F",larrfs:"\u291D",larrhk:"\u21A9",larrlp:"\u21AB",larrpl:"\u2939",larrsim:"\u2973",larrtl:"\u21A2",lat:"\u2AAB",lAtail:"\u291B",latail:"\u2919",late:"\u2AAD",lates:"\u2AAD\uFE00",lBarr:"\u290E",lbarr:"\u290C",lbbrk:"\u2772",lbrace:"{",lbrack:"[",lbrke:"\u298B",lbrksld:"\u298F",lbrkslu:"\u298D",Lcaron:"\u013D",lcaron:"\u013E",Lcedil:"\u013B",lcedil:"\u013C",lceil:"\u2308",lcub:"{",Lcy:"\u041B",lcy:"\u043B",ldca:"\u2936",ldquo:"\u201C",ldquor:"\u201E",ldrdhar:"\u2967",ldrushar:"\u294B",ldsh:"\u21B2",lE:"\u2266",le:"\u2264",LeftAngleBracket:"\u27E8",LeftArrow:"\u2190",Leftarrow:"\u21D0",leftarrow:"\u2190",LeftArrowBar:"\u21E4",LeftArrowRightArrow:"\u21C6",leftarrowtail:"\u21A2",LeftCeiling:"\u2308",LeftDoubleBracket:"\u27E6",LeftDownTeeVector:"\u2961",LeftDownVector:"\u21C3",LeftDownVectorBar:"\u2959",LeftFloor:"\u230A",leftharpoondown:"\u21BD",leftharpoonup:"\u21BC",leftleftarrows:"\u21C7",LeftRightArrow:"\u2194",Leftrightarrow:"\u21D4",leftrightarrow:"\u2194",leftrightarrows:"\u21C6",leftrightharpoons:"\u21CB",leftrightsquigarrow:"\u21AD",LeftRightVector:"\u294E",LeftTee:"\u22A3",LeftTeeArrow:"\u21A4",LeftTeeVector:"\u295A",leftthreetimes:"\u22CB",LeftTriangle:"\u22B2",LeftTriangleBar:"\u29CF",LeftTriangleEqual:"\u22B4",LeftUpDownVector:"\u2951",LeftUpTeeVector:"\u2960",LeftUpVector:"\u21BF",LeftUpVectorBar:"\u2958",LeftVector:"\u21BC",LeftVectorBar:"\u2952",lEg:"\u2A8B",leg:"\u22DA",leq:"\u2264",leqq:"\u2266",leqslant:"\u2A7D",les:"\u2A7D",lescc:"\u2AA8",lesdot:"\u2A7F",lesdoto:"\u2A81",lesdotor:"\u2A83",lesg:"\u22DA\uFE00",lesges:"\u2A93",lessapprox:"\u2A85",lessdot:"\u22D6",lesseqgtr:"\u22DA",lesseqqgtr:"\u2A8B",LessEqualGreater:"\u22DA",LessFullEqual:"\u2266",LessGreater:"\u2276",lessgtr:"\u2276",LessLess:"\u2AA1",lesssim:"\u2272",LessSlantEqual:"\u2A7D",LessTilde:"\u2272",lfisht:"\u297C",lfloor:"\u230A",Lfr:"\u{1D50F}",lfr:"\u{1D529}",lg:"\u2276",lgE:"\u2A91",lHar:"\u2962",lhard:"\u21BD",lharu:"\u21BC",lharul:"\u296A",lhblk:"\u2584",LJcy:"\u0409",ljcy:"\u0459",Ll:"\u22D8",ll:"\u226A",llarr:"\u21C7",llcorner:"\u231E",Lleftarrow:"\u21DA",llhard:"\u296B",lltri:"\u25FA",Lmidot:"\u013F",lmidot:"\u0140",lmoust:"\u23B0",lmoustache:"\u23B0",lnap:"\u2A89",lnapprox:"\u2A89",lnE:"\u2268",lne:"\u2A87",lneq:"\u2A87",lneqq:"\u2268",lnsim:"\u22E6",loang:"\u27EC",loarr:"\u21FD",lobrk:"\u27E6",LongLeftArrow:"\u27F5",Longleftarrow:"\u27F8",longleftarrow:"\u27F5",LongLeftRightArrow:"\u27F7",Longleftrightarrow:"\u27FA",longleftrightarrow:"\u27F7",longmapsto:"\u27FC",LongRightArrow:"\u27F6",Longrightarrow:"\u27F9",longrightarrow:"\u27F6",looparrowleft:"\u21AB",looparrowright:"\u21AC",lopar:"\u2985",Lopf:"\u{1D543}",lopf:"\u{1D55D}",loplus:"\u2A2D",lotimes:"\u2A34",lowast:"\u2217",lowbar:"_",LowerLeftArrow:"\u2199",LowerRightArrow:"\u2198",loz:"\u25CA",lozenge:"\u25CA",lozf:"\u29EB",lpar:"(",lparlt:"\u2993",lrarr:"\u21C6",lrcorner:"\u231F",lrhar:"\u21CB",lrhard:"\u296D",lrm:"\u200E",lrtri:"\u22BF",lsaquo:"\u2039",Lscr:"\u2112",lscr:"\u{1D4C1}",Lsh:"\u21B0",lsh:"\u21B0",lsim:"\u2272",lsime:"\u2A8D",lsimg:"\u2A8F",lsqb:"[",lsquo:"\u2018",lsquor:"\u201A",Lstrok:"\u0141",lstrok:"\u0142",Lt:"\u226A",LT:"<",lt:"<",ltcc:"\u2AA6",ltcir:"\u2A79",ltdot:"\u22D6",lthree:"\u22CB",ltimes:"\u22C9",ltlarr:"\u2976",ltquest:"\u2A7B",ltri:"\u25C3",ltrie:"\u22B4",ltrif:"\u25C2",ltrPar:"\u2996",lurdshar:"\u294A",luruhar:"\u2966",lvertneqq:"\u2268\uFE00",lvnE:"\u2268\uFE00",macr:"\xAF",male:"\u2642",malt:"\u2720",maltese:"\u2720",Map:"\u2905",map:"\u21A6",mapsto:"\u21A6",mapstodown:"\u21A7",mapstoleft:"\u21A4",mapstoup:"\u21A5",marker:"\u25AE",mcomma:"\u2A29",Mcy:"\u041C",mcy:"\u043C",mdash:"\u2014",mDDot:"\u223A",measuredangle:"\u2221",MediumSpace:"\u205F",Mellintrf:"\u2133",Mfr:"\u{1D510}",mfr:"\u{1D52A}",mho:"\u2127",micro:"\xB5",mid:"\u2223",midast:"*",midcir:"\u2AF0",middot:"\xB7",minus:"\u2212",minusb:"\u229F",minusd:"\u2238",minusdu:"\u2A2A",MinusPlus:"\u2213",mlcp:"\u2ADB",mldr:"\u2026",mnplus:"\u2213",models:"\u22A7",Mopf:"\u{1D544}",mopf:"\u{1D55E}",mp:"\u2213",Mscr:"\u2133",mscr:"\u{1D4C2}",mstpos:"\u223E",Mu:"\u039C",mu:"\u03BC",multimap:"\u22B8",mumap:"\u22B8",nabla:"\u2207",Nacute:"\u0143",nacute:"\u0144",nang:"\u2220\u20D2",nap:"\u2249",napE:"\u2A70\u0338",napid:"\u224B\u0338",napos:"\u0149",napprox:"\u2249",natur:"\u266E",natural:"\u266E",naturals:"\u2115",nbsp:"\xA0",nbump:"\u224E\u0338",nbumpe:"\u224F\u0338",ncap:"\u2A43",Ncaron:"\u0147",ncaron:"\u0148",Ncedil:"\u0145",ncedil:"\u0146",ncong:"\u2247",ncongdot:"\u2A6D\u0338",ncup:"\u2A42",Ncy:"\u041D",ncy:"\u043D",ndash:"\u2013",ne:"\u2260",nearhk:"\u2924",neArr:"\u21D7",nearr:"\u2197",nearrow:"\u2197",nedot:"\u2250\u0338",NegativeMediumSpace:"\u200B",NegativeThickSpace:"\u200B",NegativeThinSpace:"\u200B",NegativeVeryThinSpace:"\u200B",nequiv:"\u2262",nesear:"\u2928",nesim:"\u2242\u0338",NestedGreaterGreater:"\u226B",NestedLessLess:"\u226A",NewLine:`
`,nexist:"\u2204",nexists:"\u2204",Nfr:"\u{1D511}",nfr:"\u{1D52B}",ngE:"\u2267\u0338",nge:"\u2271",ngeq:"\u2271",ngeqq:"\u2267\u0338",ngeqslant:"\u2A7E\u0338",nges:"\u2A7E\u0338",nGg:"\u22D9\u0338",ngsim:"\u2275",nGt:"\u226B\u20D2",ngt:"\u226F",ngtr:"\u226F",nGtv:"\u226B\u0338",nhArr:"\u21CE",nharr:"\u21AE",nhpar:"\u2AF2",ni:"\u220B",nis:"\u22FC",nisd:"\u22FA",niv:"\u220B",NJcy:"\u040A",njcy:"\u045A",nlArr:"\u21CD",nlarr:"\u219A",nldr:"\u2025",nlE:"\u2266\u0338",nle:"\u2270",nLeftarrow:"\u21CD",nleftarrow:"\u219A",nLeftrightarrow:"\u21CE",nleftrightarrow:"\u21AE",nleq:"\u2270",nleqq:"\u2266\u0338",nleqslant:"\u2A7D\u0338",nles:"\u2A7D\u0338",nless:"\u226E",nLl:"\u22D8\u0338",nlsim:"\u2274",nLt:"\u226A\u20D2",nlt:"\u226E",nltri:"\u22EA",nltrie:"\u22EC",nLtv:"\u226A\u0338",nmid:"\u2224",NoBreak:"\u2060",NonBreakingSpace:"\xA0",Nopf:"\u2115",nopf:"\u{1D55F}",Not:"\u2AEC",not:"\xAC",NotCongruent:"\u2262",NotCupCap:"\u226D",NotDoubleVerticalBar:"\u2226",NotElement:"\u2209",NotEqual:"\u2260",NotEqualTilde:"\u2242\u0338",NotExists:"\u2204",NotGreater:"\u226F",NotGreaterEqual:"\u2271",NotGreaterFullEqual:"\u2267\u0338",NotGreaterGreater:"\u226B\u0338",NotGreaterLess:"\u2279",NotGreaterSlantEqual:"\u2A7E\u0338",NotGreaterTilde:"\u2275",NotHumpDownHump:"\u224E\u0338",NotHumpEqual:"\u224F\u0338",notin:"\u2209",notindot:"\u22F5\u0338",notinE:"\u22F9\u0338",notinva:"\u2209",notinvb:"\u22F7",notinvc:"\u22F6",NotLeftTriangle:"\u22EA",NotLeftTriangleBar:"\u29CF\u0338",NotLeftTriangleEqual:"\u22EC",NotLess:"\u226E",NotLessEqual:"\u2270",NotLessGreater:"\u2278",NotLessLess:"\u226A\u0338",NotLessSlantEqual:"\u2A7D\u0338",NotLessTilde:"\u2274",NotNestedGreaterGreater:"\u2AA2\u0338",NotNestedLessLess:"\u2AA1\u0338",notni:"\u220C",notniva:"\u220C",notnivb:"\u22FE",notnivc:"\u22FD",NotPrecedes:"\u2280",NotPrecedesEqual:"\u2AAF\u0338",NotPrecedesSlantEqual:"\u22E0",NotReverseElement:"\u220C",NotRightTriangle:"\u22EB",NotRightTriangleBar:"\u29D0\u0338",NotRightTriangleEqual:"\u22ED",NotSquareSubset:"\u228F\u0338",NotSquareSubsetEqual:"\u22E2",NotSquareSuperset:"\u2290\u0338",NotSquareSupersetEqual:"\u22E3",NotSubset:"\u2282\u20D2",NotSubsetEqual:"\u2288",NotSucceeds:"\u2281",NotSucceedsEqual:"\u2AB0\u0338",NotSucceedsSlantEqual:"\u22E1",NotSucceedsTilde:"\u227F\u0338",NotSuperset:"\u2283\u20D2",NotSupersetEqual:"\u2289",NotTilde:"\u2241",NotTildeEqual:"\u2244",NotTildeFullEqual:"\u2247",NotTildeTilde:"\u2249",NotVerticalBar:"\u2224",npar:"\u2226",nparallel:"\u2226",nparsl:"\u2AFD\u20E5",npart:"\u2202\u0338",npolint:"\u2A14",npr:"\u2280",nprcue:"\u22E0",npre:"\u2AAF\u0338",nprec:"\u2280",npreceq:"\u2AAF\u0338",nrArr:"\u21CF",nrarr:"\u219B",nrarrc:"\u2933\u0338",nrarrw:"\u219D\u0338",nRightarrow:"\u21CF",nrightarrow:"\u219B",nrtri:"\u22EB",nrtrie:"\u22ED",nsc:"\u2281",nsccue:"\u22E1",nsce:"\u2AB0\u0338",Nscr:"\u{1D4A9}",nscr:"\u{1D4C3}",nshortmid:"\u2224",nshortparallel:"\u2226",nsim:"\u2241",nsime:"\u2244",nsimeq:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsqsube:"\u22E2",nsqsupe:"\u22E3",nsub:"\u2284",nsubE:"\u2AC5\u0338",nsube:"\u2288",nsubset:"\u2282\u20D2",nsubseteq:"\u2288",nsubseteqq:"\u2AC5\u0338",nsucc:"\u2281",nsucceq:"\u2AB0\u0338",nsup:"\u2285",nsupE:"\u2AC6\u0338",nsupe:"\u2289",nsupset:"\u2283\u20D2",nsupseteq:"\u2289",nsupseteqq:"\u2AC6\u0338",ntgl:"\u2279",Ntilde:"\xD1",ntilde:"\xF1",ntlg:"\u2278",ntriangleleft:"\u22EA",ntrianglelefteq:"\u22EC",ntriangleright:"\u22EB",ntrianglerighteq:"\u22ED",Nu:"\u039D",nu:"\u03BD",num:"#",numero:"\u2116",numsp:"\u2007",nvap:"\u224D\u20D2",nVDash:"\u22AF",nVdash:"\u22AE",nvDash:"\u22AD",nvdash:"\u22AC",nvge:"\u2265\u20D2",nvgt:">\u20D2",nvHarr:"\u2904",nvinfin:"\u29DE",nvlArr:"\u2902",nvle:"\u2264\u20D2",nvlt:"<\u20D2",nvltrie:"\u22B4\u20D2",nvrArr:"\u2903",nvrtrie:"\u22B5\u20D2",nvsim:"\u223C\u20D2",nwarhk:"\u2923",nwArr:"\u21D6",nwarr:"\u2196",nwarrow:"\u2196",nwnear:"\u2927",Oacute:"\xD3",oacute:"\xF3",oast:"\u229B",ocir:"\u229A",Ocirc:"\xD4",ocirc:"\xF4",Ocy:"\u041E",ocy:"\u043E",odash:"\u229D",Odblac:"\u0150",odblac:"\u0151",odiv:"\u2A38",odot:"\u2299",odsold:"\u29BC",OElig:"\u0152",oelig:"\u0153",ofcir:"\u29BF",Ofr:"\u{1D512}",ofr:"\u{1D52C}",ogon:"\u02DB",Ograve:"\xD2",ograve:"\xF2",ogt:"\u29C1",ohbar:"\u29B5",ohm:"\u03A9",oint:"\u222E",olarr:"\u21BA",olcir:"\u29BE",olcross:"\u29BB",oline:"\u203E",olt:"\u29C0",Omacr:"\u014C",omacr:"\u014D",Omega:"\u03A9",omega:"\u03C9",Omicron:"\u039F",omicron:"\u03BF",omid:"\u29B6",ominus:"\u2296",Oopf:"\u{1D546}",oopf:"\u{1D560}",opar:"\u29B7",OpenCurlyDoubleQuote:"\u201C",OpenCurlyQuote:"\u2018",operp:"\u29B9",oplus:"\u2295",Or:"\u2A54",or:"\u2228",orarr:"\u21BB",ord:"\u2A5D",order:"\u2134",orderof:"\u2134",ordf:"\xAA",ordm:"\xBA",origof:"\u22B6",oror:"\u2A56",orslope:"\u2A57",orv:"\u2A5B",oS:"\u24C8",Oscr:"\u{1D4AA}",oscr:"\u2134",Oslash:"\xD8",oslash:"\xF8",osol:"\u2298",Otilde:"\xD5",otilde:"\xF5",Otimes:"\u2A37",otimes:"\u2297",otimesas:"\u2A36",Ouml:"\xD6",ouml:"\xF6",ovbar:"\u233D",OverBar:"\u203E",OverBrace:"\u23DE",OverBracket:"\u23B4",OverParenthesis:"\u23DC",par:"\u2225",para:"\xB6",parallel:"\u2225",parsim:"\u2AF3",parsl:"\u2AFD",part:"\u2202",PartialD:"\u2202",Pcy:"\u041F",pcy:"\u043F",percnt:"%",period:".",permil:"\u2030",perp:"\u22A5",pertenk:"\u2031",Pfr:"\u{1D513}",pfr:"\u{1D52D}",Phi:"\u03A6",phi:"\u03C6",phiv:"\u03D5",phmmat:"\u2133",phone:"\u260E",Pi:"\u03A0",pi:"\u03C0",pitchfork:"\u22D4",piv:"\u03D6",planck:"\u210F",planckh:"\u210E",plankv:"\u210F",plus:"+",plusacir:"\u2A23",plusb:"\u229E",pluscir:"\u2A22",plusdo:"\u2214",plusdu:"\u2A25",pluse:"\u2A72",PlusMinus:"\xB1",plusmn:"\xB1",plussim:"\u2A26",plustwo:"\u2A27",pm:"\xB1",Poincareplane:"\u210C",pointint:"\u2A15",Popf:"\u2119",popf:"\u{1D561}",pound:"\xA3",Pr:"\u2ABB",pr:"\u227A",prap:"\u2AB7",prcue:"\u227C",prE:"\u2AB3",pre:"\u2AAF",prec:"\u227A",precapprox:"\u2AB7",preccurlyeq:"\u227C",Precedes:"\u227A",PrecedesEqual:"\u2AAF",PrecedesSlantEqual:"\u227C",PrecedesTilde:"\u227E",preceq:"\u2AAF",precnapprox:"\u2AB9",precneqq:"\u2AB5",precnsim:"\u22E8",precsim:"\u227E",Prime:"\u2033",prime:"\u2032",primes:"\u2119",prnap:"\u2AB9",prnE:"\u2AB5",prnsim:"\u22E8",prod:"\u220F",Product:"\u220F",profalar:"\u232E",profline:"\u2312",profsurf:"\u2313",prop:"\u221D",Proportion:"\u2237",Proportional:"\u221D",propto:"\u221D",prsim:"\u227E",prurel:"\u22B0",Pscr:"\u{1D4AB}",pscr:"\u{1D4C5}",Psi:"\u03A8",psi:"\u03C8",puncsp:"\u2008",Qfr:"\u{1D514}",qfr:"\u{1D52E}",qint:"\u2A0C",Qopf:"\u211A",qopf:"\u{1D562}",qprime:"\u2057",Qscr:"\u{1D4AC}",qscr:"\u{1D4C6}",quaternions:"\u210D",quatint:"\u2A16",quest:"?",questeq:"\u225F",QUOT:'"',quot:'"',rAarr:"\u21DB",race:"\u223D\u0331",Racute:"\u0154",racute:"\u0155",radic:"\u221A",raemptyv:"\u29B3",Rang:"\u27EB",rang:"\u27E9",rangd:"\u2992",range:"\u29A5",rangle:"\u27E9",raquo:"\xBB",Rarr:"\u21A0",rArr:"\u21D2",rarr:"\u2192",rarrap:"\u2975",rarrb:"\u21E5",rarrbfs:"\u2920",rarrc:"\u2933",rarrfs:"\u291E",rarrhk:"\u21AA",rarrlp:"\u21AC",rarrpl:"\u2945",rarrsim:"\u2974",Rarrtl:"\u2916",rarrtl:"\u21A3",rarrw:"\u219D",rAtail:"\u291C",ratail:"\u291A",ratio:"\u2236",rationals:"\u211A",RBarr:"\u2910",rBarr:"\u290F",rbarr:"\u290D",rbbrk:"\u2773",rbrace:"}",rbrack:"]",rbrke:"\u298C",rbrksld:"\u298E",rbrkslu:"\u2990",Rcaron:"\u0158",rcaron:"\u0159",Rcedil:"\u0156",rcedil:"\u0157",rceil:"\u2309",rcub:"}",Rcy:"\u0420",rcy:"\u0440",rdca:"\u2937",rdldhar:"\u2969",rdquo:"\u201D",rdquor:"\u201D",rdsh:"\u21B3",Re:"\u211C",real:"\u211C",realine:"\u211B",realpart:"\u211C",reals:"\u211D",rect:"\u25AD",REG:"\xAE",reg:"\xAE",ReverseElement:"\u220B",ReverseEquilibrium:"\u21CB",ReverseUpEquilibrium:"\u296F",rfisht:"\u297D",rfloor:"\u230B",Rfr:"\u211C",rfr:"\u{1D52F}",rHar:"\u2964",rhard:"\u21C1",rharu:"\u21C0",rharul:"\u296C",Rho:"\u03A1",rho:"\u03C1",rhov:"\u03F1",RightAngleBracket:"\u27E9",RightArrow:"\u2192",Rightarrow:"\u21D2",rightarrow:"\u2192",RightArrowBar:"\u21E5",RightArrowLeftArrow:"\u21C4",rightarrowtail:"\u21A3",RightCeiling:"\u2309",RightDoubleBracket:"\u27E7",RightDownTeeVector:"\u295D",RightDownVector:"\u21C2",RightDownVectorBar:"\u2955",RightFloor:"\u230B",rightharpoondown:"\u21C1",rightharpoonup:"\u21C0",rightleftarrows:"\u21C4",rightleftharpoons:"\u21CC",rightrightarrows:"\u21C9",rightsquigarrow:"\u219D",RightTee:"\u22A2",RightTeeArrow:"\u21A6",RightTeeVector:"\u295B",rightthreetimes:"\u22CC",RightTriangle:"\u22B3",RightTriangleBar:"\u29D0",RightTriangleEqual:"\u22B5",RightUpDownVector:"\u294F",RightUpTeeVector:"\u295C",RightUpVector:"\u21BE",RightUpVectorBar:"\u2954",RightVector:"\u21C0",RightVectorBar:"\u2953",ring:"\u02DA",risingdotseq:"\u2253",rlarr:"\u21C4",rlhar:"\u21CC",rlm:"\u200F",rmoust:"\u23B1",rmoustache:"\u23B1",rnmid:"\u2AEE",roang:"\u27ED",roarr:"\u21FE",robrk:"\u27E7",ropar:"\u2986",Ropf:"\u211D",ropf:"\u{1D563}",roplus:"\u2A2E",rotimes:"\u2A35",RoundImplies:"\u2970",rpar:")",rpargt:"\u2994",rppolint:"\u2A12",rrarr:"\u21C9",Rrightarrow:"\u21DB",rsaquo:"\u203A",Rscr:"\u211B",rscr:"\u{1D4C7}",Rsh:"\u21B1",rsh:"\u21B1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2019",rthree:"\u22CC",rtimes:"\u22CA",rtri:"\u25B9",rtrie:"\u22B5",rtrif:"\u25B8",rtriltri:"\u29CE",RuleDelayed:"\u29F4",ruluhar:"\u2968",rx:"\u211E",Sacute:"\u015A",sacute:"\u015B",sbquo:"\u201A",Sc:"\u2ABC",sc:"\u227B",scap:"\u2AB8",Scaron:"\u0160",scaron:"\u0161",sccue:"\u227D",scE:"\u2AB4",sce:"\u2AB0",Scedil:"\u015E",scedil:"\u015F",Scirc:"\u015C",scirc:"\u015D",scnap:"\u2ABA",scnE:"\u2AB6",scnsim:"\u22E9",scpolint:"\u2A13",scsim:"\u227F",Scy:"\u0421",scy:"\u0441",sdot:"\u22C5",sdotb:"\u22A1",sdote:"\u2A66",searhk:"\u2925",seArr:"\u21D8",searr:"\u2198",searrow:"\u2198",sect:"\xA7",semi:";",seswar:"\u2929",setminus:"\u2216",setmn:"\u2216",sext:"\u2736",Sfr:"\u{1D516}",sfr:"\u{1D530}",sfrown:"\u2322",sharp:"\u266F",SHCHcy:"\u0429",shchcy:"\u0449",SHcy:"\u0428",shcy:"\u0448",ShortDownArrow:"\u2193",ShortLeftArrow:"\u2190",shortmid:"\u2223",shortparallel:"\u2225",ShortRightArrow:"\u2192",ShortUpArrow:"\u2191",shy:"\xAD",Sigma:"\u03A3",sigma:"\u03C3",sigmaf:"\u03C2",sigmav:"\u03C2",sim:"\u223C",simdot:"\u2A6A",sime:"\u2243",simeq:"\u2243",simg:"\u2A9E",simgE:"\u2AA0",siml:"\u2A9D",simlE:"\u2A9F",simne:"\u2246",simplus:"\u2A24",simrarr:"\u2972",slarr:"\u2190",SmallCircle:"\u2218",smallsetminus:"\u2216",smashp:"\u2A33",smeparsl:"\u29E4",smid:"\u2223",smile:"\u2323",smt:"\u2AAA",smte:"\u2AAC",smtes:"\u2AAC\uFE00",SOFTcy:"\u042C",softcy:"\u044C",sol:"/",solb:"\u29C4",solbar:"\u233F",Sopf:"\u{1D54A}",sopf:"\u{1D564}",spades:"\u2660",spadesuit:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcaps:"\u2293\uFE00",sqcup:"\u2294",sqcups:"\u2294\uFE00",Sqrt:"\u221A",sqsub:"\u228F",sqsube:"\u2291",sqsubset:"\u228F",sqsubseteq:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",sqsupset:"\u2290",sqsupseteq:"\u2292",squ:"\u25A1",Square:"\u25A1",square:"\u25A1",SquareIntersection:"\u2293",SquareSubset:"\u228F",SquareSubsetEqual:"\u2291",SquareSuperset:"\u2290",SquareSupersetEqual:"\u2292",SquareUnion:"\u2294",squarf:"\u25AA",squf:"\u25AA",srarr:"\u2192",Sscr:"\u{1D4AE}",sscr:"\u{1D4C8}",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22C6",Star:"\u22C6",star:"\u2606",starf:"\u2605",straightepsilon:"\u03F5",straightphi:"\u03D5",strns:"\xAF",Sub:"\u22D0",sub:"\u2282",subdot:"\u2ABD",subE:"\u2AC5",sube:"\u2286",subedot:"\u2AC3",submult:"\u2AC1",subnE:"\u2ACB",subne:"\u228A",subplus:"\u2ABF",subrarr:"\u2979",Subset:"\u22D0",subset:"\u2282",subseteq:"\u2286",subseteqq:"\u2AC5",SubsetEqual:"\u2286",subsetneq:"\u228A",subsetneqq:"\u2ACB",subsim:"\u2AC7",subsub:"\u2AD5",subsup:"\u2AD3",succ:"\u227B",succapprox:"\u2AB8",succcurlyeq:"\u227D",Succeeds:"\u227B",SucceedsEqual:"\u2AB0",SucceedsSlantEqual:"\u227D",SucceedsTilde:"\u227F",succeq:"\u2AB0",succnapprox:"\u2ABA",succneqq:"\u2AB6",succnsim:"\u22E9",succsim:"\u227F",SuchThat:"\u220B",Sum:"\u2211",sum:"\u2211",sung:"\u266A",Sup:"\u22D1",sup:"\u2283",sup1:"\xB9",sup2:"\xB2",sup3:"\xB3",supdot:"\u2ABE",supdsub:"\u2AD8",supE:"\u2AC6",supe:"\u2287",supedot:"\u2AC4",Superset:"\u2283",SupersetEqual:"\u2287",suphsol:"\u27C9",suphsub:"\u2AD7",suplarr:"\u297B",supmult:"\u2AC2",supnE:"\u2ACC",supne:"\u228B",supplus:"\u2AC0",Supset:"\u22D1",supset:"\u2283",supseteq:"\u2287",supseteqq:"\u2AC6",supsetneq:"\u228B",supsetneqq:"\u2ACC",supsim:"\u2AC8",supsub:"\u2AD4",supsup:"\u2AD6",swarhk:"\u2926",swArr:"\u21D9",swarr:"\u2199",swarrow:"\u2199",swnwar:"\u292A",szlig:"\xDF",Tab:"	",target:"\u2316",Tau:"\u03A4",tau:"\u03C4",tbrk:"\u23B4",Tcaron:"\u0164",tcaron:"\u0165",Tcedil:"\u0162",tcedil:"\u0163",Tcy:"\u0422",tcy:"\u0442",tdot:"\u20DB",telrec:"\u2315",Tfr:"\u{1D517}",tfr:"\u{1D531}",there4:"\u2234",Therefore:"\u2234",therefore:"\u2234",Theta:"\u0398",theta:"\u03B8",thetasym:"\u03D1",thetav:"\u03D1",thickapprox:"\u2248",thicksim:"\u223C",ThickSpace:"\u205F\u200A",thinsp:"\u2009",ThinSpace:"\u2009",thkap:"\u2248",thksim:"\u223C",THORN:"\xDE",thorn:"\xFE",Tilde:"\u223C",tilde:"\u02DC",TildeEqual:"\u2243",TildeFullEqual:"\u2245",TildeTilde:"\u2248",times:"\xD7",timesb:"\u22A0",timesbar:"\u2A31",timesd:"\u2A30",tint:"\u222D",toea:"\u2928",top:"\u22A4",topbot:"\u2336",topcir:"\u2AF1",Topf:"\u{1D54B}",topf:"\u{1D565}",topfork:"\u2ADA",tosa:"\u2929",tprime:"\u2034",TRADE:"\u2122",trade:"\u2122",triangle:"\u25B5",triangledown:"\u25BF",triangleleft:"\u25C3",trianglelefteq:"\u22B4",triangleq:"\u225C",triangleright:"\u25B9",trianglerighteq:"\u22B5",tridot:"\u25EC",trie:"\u225C",triminus:"\u2A3A",TripleDot:"\u20DB",triplus:"\u2A39",trisb:"\u29CD",tritime:"\u2A3B",trpezium:"\u23E2",Tscr:"\u{1D4AF}",tscr:"\u{1D4C9}",TScy:"\u0426",tscy:"\u0446",TSHcy:"\u040B",tshcy:"\u045B",Tstrok:"\u0166",tstrok:"\u0167",twixt:"\u226C",twoheadleftarrow:"\u219E",twoheadrightarrow:"\u21A0",Uacute:"\xDA",uacute:"\xFA",Uarr:"\u219F",uArr:"\u21D1",uarr:"\u2191",Uarrocir:"\u2949",Ubrcy:"\u040E",ubrcy:"\u045E",Ubreve:"\u016C",ubreve:"\u016D",Ucirc:"\xDB",ucirc:"\xFB",Ucy:"\u0423",ucy:"\u0443",udarr:"\u21C5",Udblac:"\u0170",udblac:"\u0171",udhar:"\u296E",ufisht:"\u297E",Ufr:"\u{1D518}",ufr:"\u{1D532}",Ugrave:"\xD9",ugrave:"\xF9",uHar:"\u2963",uharl:"\u21BF",uharr:"\u21BE",uhblk:"\u2580",ulcorn:"\u231C",ulcorner:"\u231C",ulcrop:"\u230F",ultri:"\u25F8",Umacr:"\u016A",umacr:"\u016B",uml:"\xA8",UnderBar:"_",UnderBrace:"\u23DF",UnderBracket:"\u23B5",UnderParenthesis:"\u23DD",Union:"\u22C3",UnionPlus:"\u228E",Uogon:"\u0172",uogon:"\u0173",Uopf:"\u{1D54C}",uopf:"\u{1D566}",UpArrow:"\u2191",Uparrow:"\u21D1",uparrow:"\u2191",UpArrowBar:"\u2912",UpArrowDownArrow:"\u21C5",UpDownArrow:"\u2195",Updownarrow:"\u21D5",updownarrow:"\u2195",UpEquilibrium:"\u296E",upharpoonleft:"\u21BF",upharpoonright:"\u21BE",uplus:"\u228E",UpperLeftArrow:"\u2196",UpperRightArrow:"\u2197",Upsi:"\u03D2",upsi:"\u03C5",upsih:"\u03D2",Upsilon:"\u03A5",upsilon:"\u03C5",UpTee:"\u22A5",UpTeeArrow:"\u21A5",upuparrows:"\u21C8",urcorn:"\u231D",urcorner:"\u231D",urcrop:"\u230E",Uring:"\u016E",uring:"\u016F",urtri:"\u25F9",Uscr:"\u{1D4B0}",uscr:"\u{1D4CA}",utdot:"\u22F0",Utilde:"\u0168",utilde:"\u0169",utri:"\u25B5",utrif:"\u25B4",uuarr:"\u21C8",Uuml:"\xDC",uuml:"\xFC",uwangle:"\u29A7",vangrt:"\u299C",varepsilon:"\u03F5",varkappa:"\u03F0",varnothing:"\u2205",varphi:"\u03D5",varpi:"\u03D6",varpropto:"\u221D",vArr:"\u21D5",varr:"\u2195",varrho:"\u03F1",varsigma:"\u03C2",varsubsetneq:"\u228A\uFE00",varsubsetneqq:"\u2ACB\uFE00",varsupsetneq:"\u228B\uFE00",varsupsetneqq:"\u2ACC\uFE00",vartheta:"\u03D1",vartriangleleft:"\u22B2",vartriangleright:"\u22B3",Vbar:"\u2AEB",vBar:"\u2AE8",vBarv:"\u2AE9",Vcy:"\u0412",vcy:"\u0432",VDash:"\u22AB",Vdash:"\u22A9",vDash:"\u22A8",vdash:"\u22A2",Vdashl:"\u2AE6",Vee:"\u22C1",vee:"\u2228",veebar:"\u22BB",veeeq:"\u225A",vellip:"\u22EE",Verbar:"\u2016",verbar:"|",Vert:"\u2016",vert:"|",VerticalBar:"\u2223",VerticalLine:"|",VerticalSeparator:"\u2758",VerticalTilde:"\u2240",VeryThinSpace:"\u200A",Vfr:"\u{1D519}",vfr:"\u{1D533}",vltri:"\u22B2",vnsub:"\u2282\u20D2",vnsup:"\u2283\u20D2",Vopf:"\u{1D54D}",vopf:"\u{1D567}",vprop:"\u221D",vrtri:"\u22B3",Vscr:"\u{1D4B1}",vscr:"\u{1D4CB}",vsubnE:"\u2ACB\uFE00",vsubne:"\u228A\uFE00",vsupnE:"\u2ACC\uFE00",vsupne:"\u228B\uFE00",Vvdash:"\u22AA",vzigzag:"\u299A",Wcirc:"\u0174",wcirc:"\u0175",wedbar:"\u2A5F",Wedge:"\u22C0",wedge:"\u2227",wedgeq:"\u2259",weierp:"\u2118",Wfr:"\u{1D51A}",wfr:"\u{1D534}",Wopf:"\u{1D54E}",wopf:"\u{1D568}",wp:"\u2118",wr:"\u2240",wreath:"\u2240",Wscr:"\u{1D4B2}",wscr:"\u{1D4CC}",xcap:"\u22C2",xcirc:"\u25EF",xcup:"\u22C3",xdtri:"\u25BD",Xfr:"\u{1D51B}",xfr:"\u{1D535}",xhArr:"\u27FA",xharr:"\u27F7",Xi:"\u039E",xi:"\u03BE",xlArr:"\u27F8",xlarr:"\u27F5",xmap:"\u27FC",xnis:"\u22FB",xodot:"\u2A00",Xopf:"\u{1D54F}",xopf:"\u{1D569}",xoplus:"\u2A01",xotime:"\u2A02",xrArr:"\u27F9",xrarr:"\u27F6",Xscr:"\u{1D4B3}",xscr:"\u{1D4CD}",xsqcup:"\u2A06",xuplus:"\u2A04",xutri:"\u25B3",xvee:"\u22C1",xwedge:"\u22C0",Yacute:"\xDD",yacute:"\xFD",YAcy:"\u042F",yacy:"\u044F",Ycirc:"\u0176",ycirc:"\u0177",Ycy:"\u042B",ycy:"\u044B",yen:"\xA5",Yfr:"\u{1D51C}",yfr:"\u{1D536}",YIcy:"\u0407",yicy:"\u0457",Yopf:"\u{1D550}",yopf:"\u{1D56A}",Yscr:"\u{1D4B4}",yscr:"\u{1D4CE}",YUcy:"\u042E",yucy:"\u044E",Yuml:"\u0178",yuml:"\xFF",Zacute:"\u0179",zacute:"\u017A",Zcaron:"\u017D",zcaron:"\u017E",Zcy:"\u0417",zcy:"\u0437",Zdot:"\u017B",zdot:"\u017C",zeetrf:"\u2128",ZeroWidthSpace:"\u200B",Zeta:"\u0396",zeta:"\u03B6",Zfr:"\u2128",zfr:"\u{1D537}",ZHcy:"\u0416",zhcy:"\u0436",zigrarr:"\u21DD",Zopf:"\u2124",zopf:"\u{1D56B}",Zscr:"\u{1D4B5}",zscr:"\u{1D4CF}",zwj:"\u200D",zwnj:"\u200C"});L3.entityMap=L3.HTML_ENTITIES});var qO=ut(pk=>{var z3=M3().NAMESPACE,hk=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,$O=new RegExp("[\\-\\.0-9"+hk.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),zO=new RegExp("^"+hk.source+$O.source+"*(?::"+hk.source+$O.source+"*)?$"),U3=0,rc=1,Id=2,G3=3,Pd=4,Dd=5,$3=6,Wy=7;function Md(n,e){this.message=n,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,Md)}Md.prototype=new Error;Md.prototype.name=Md.name;function VO(){}VO.prototype={parse:function(n,e,t){var r=this.domBuilder;r.startDocument(),jO(e,e={}),XZ(n,e,t,r,this.errorHandler),r.endDocument()}};function XZ(n,e,t,r,i){function s(P){if(P>65535){P-=65536;var D=55296+(P>>10),N=56320+(P&1023);return String.fromCharCode(D,N)}else return String.fromCharCode(P)}function o(P){var D=P.slice(1,-1);return Object.hasOwnProperty.call(t,D)?t[D]:D.charAt(0)==="#"?s(parseInt(D.substr(1).replace("x","0x"))):(i.error("entity not found:"+P),P)}function a(P){if(P>m){var D=n.substring(m,P).replace(/&#?\w+;/g,o);f&&l(m),r.characters(D,0,P-m),m=P}}function l(P,D){for(;P>=u&&(D=d.exec(n));)c=D.index,u=c+D[0].length,f.lineNumber++;f.columnNumber=P-c+1}for(var c=0,u=0,d=/.*(?:\r\n?|\n)|.*$/g,f=r.locator,h=[{currentNSMap:e}],p={},m=0;;){try{var g=n.indexOf("<",m);if(g<0){if(!n.substr(m).match(/^\s*$/)){var y=r.doc,x=y.createTextNode(n.substr(m));y.appendChild(x),r.currentElement=x}return}switch(g>m&&a(g),n.charAt(g+1)){case"/":var E=n.indexOf(">",g+3),b=n.substring(g+2,E).replace(/[ \t\n\r]+$/g,""),_=h.pop();E<0?(b=n.substring(g+2).replace(/[\s<].*/,""),i.error("end tag name: "+b+" is not complete:"+_.tagName),E=g+1+b.length):b.match(/\s</)&&(b=b.replace(/[\s<].*/,""),i.error("end tag name: "+b+" maybe not complete"),E=g+1+b.length);var S=_.localNSMap,C=_.tagName==b,k=C||_.tagName&&_.tagName.toLowerCase()==b.toLowerCase();if(k){if(r.endElement(_.uri,_.localName,b),S)for(var v in S)Object.prototype.hasOwnProperty.call(S,v)&&r.endPrefixMapping(v);C||i.fatalError("end tag name: "+b+" is not match the current start tagName:"+_.tagName)}else h.push(_);E++;break;case"?":f&&l(g),E=ZZ(n,g,r);break;case"!":f&&l(g),E=QZ(n,g,r,i);break;default:f&&l(g);var w=new XO,A=h[h.length-1].currentNSMap,E=qZ(n,g,w,A,o,i),I=w.length;if(!w.closed&&KZ(n,E,w.tagName,p)&&(w.closed=!0,t.nbsp||i.warning("unclosed xml attribute")),f&&I){for(var M=HO(f,{}),T=0;T<I;T++){var R=w[T];l(R.offset),R.locator=HO(f,{})}r.locator=M,WO(w,r,A)&&h.push(w),r.locator=f}else WO(w,r,A)&&h.push(w);z3.isHTML(w.uri)&&!w.closed?E=YZ(n,E,w.tagName,o,r):E++}}catch(P){if(P instanceof Md)throw P;i.error("element parse error: "+P),E=-1}E>m?m=E:a(Math.max(g,m)+1)}}function HO(n,e){return e.lineNumber=n.lineNumber,e.columnNumber=n.columnNumber,e}function qZ(n,e,t,r,i,s){function o(h,p,m){t.attributeNames.hasOwnProperty(h)&&s.fatalError("Attribute "+h+" redefined"),t.addValue(h,p.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,i),m)}for(var a,l,c=++e,u=U3;;){var d=n.charAt(c);switch(d){case"=":if(u===rc)a=n.slice(e,c),u=G3;else if(u===Id)u=G3;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(u===G3||u===rc)if(u===rc&&(s.warning('attribute value must after "="'),a=n.slice(e,c)),e=c+1,c=n.indexOf(d,e),c>0)l=n.slice(e,c),o(a,l,e-1),u=Dd;else throw new Error("attribute value no end '"+d+"' match");else if(u==Pd)l=n.slice(e,c),o(a,l,e),s.warning('attribute "'+a+'" missed start quot('+d+")!!"),e=c+1,u=Dd;else throw new Error('attribute value must after "="');break;case"/":switch(u){case U3:t.setTagName(n.slice(e,c));case Dd:case $3:case Wy:u=Wy,t.closed=!0;case Pd:case rc:break;case Id:t.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),u==U3&&t.setTagName(n.slice(e,c)),c;case">":switch(u){case U3:t.setTagName(n.slice(e,c));case Dd:case $3:case Wy:break;case Pd:case rc:l=n.slice(e,c),l.slice(-1)==="/"&&(t.closed=!0,l=l.slice(0,-1));case Id:u===Id&&(l=a),u==Pd?(s.warning('attribute "'+l+'" missed quot(")!'),o(a,l,e)):((!z3.isHTML(r[""])||!l.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+l+'" missed value!! "'+l+'" instead!!'),o(l,l,e));break;case G3:throw new Error("attribute value missed!!")}return c;case"\x80":d=" ";default:if(d<=" ")switch(u){case U3:t.setTagName(n.slice(e,c)),u=$3;break;case rc:a=n.slice(e,c),u=Id;break;case Pd:var l=n.slice(e,c);s.warning('attribute "'+l+'" missed quot(")!!'),o(a,l,e);case Dd:u=$3;break}else switch(u){case Id:var f=t.tagName;(!z3.isHTML(r[""])||!a.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),o(a,a,e),e=c,u=rc;break;case Dd:s.warning('attribute space is required"'+a+'"!!');case $3:u=rc,e=c;break;case G3:u=Pd,e=c;break;case Wy:throw new Error("elements closed character '/' and '>' must be connected to")}}c++}}function WO(n,e,t){for(var r=n.tagName,i=null,d=n.length;d--;){var s=n[d],o=s.qName,a=s.value,f=o.indexOf(":");if(f>0)var l=s.prefix=o.slice(0,f),c=o.slice(f+1),u=l==="xmlns"&&c;else c=o,l=null,u=o==="xmlns"&&"";s.localName=c,u!==!1&&(i==null&&(i={},jO(t,t={})),t[u]=i[u]=a,s.uri=z3.XMLNS,e.startPrefixMapping(u,a))}for(var d=n.length;d--;){s=n[d];var l=s.prefix;l&&(l==="xml"&&(s.uri=z3.XML),l!=="xmlns"&&(s.uri=t[l||""]))}var f=r.indexOf(":");f>0?(l=n.prefix=r.slice(0,f),c=n.localName=r.slice(f+1)):(l=null,c=n.localName=r);var h=n.uri=t[l||""];if(e.startElement(h,c,r,n),n.closed){if(e.endElement(h,c,r),i)for(l in i)Object.prototype.hasOwnProperty.call(i,l)&&e.endPrefixMapping(l)}else return n.currentNSMap=t,n.localNSMap=i,!0}function YZ(n,e,t,r,i){if(/^(?:script|textarea)$/i.test(t)){var s=n.indexOf("</"+t+">",e),o=n.substring(e+1,s);if(/[&<]/.test(o))return/^script$/i.test(t)?(i.characters(o,0,o.length),s):(o=o.replace(/&#?\w+;/g,r),i.characters(o,0,o.length),s)}return e+1}function KZ(n,e,t,r){var i=r[t];return i==null&&(i=n.lastIndexOf("</"+t+">"),i<e&&(i=n.lastIndexOf("</"+t)),r[t]=i),i<e}function jO(n,e){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}function QZ(n,e,t,r){var i=n.charAt(e+2);switch(i){case"-":if(n.charAt(e+3)==="-"){var s=n.indexOf("-->",e+4);return s>e?(t.comment(n,e+4,s-e-4),s+3):(r.error("Unclosed comment"),-1)}else return-1;default:if(n.substr(e+3,6)=="CDATA["){var s=n.indexOf("]]>",e+9);return t.startCDATA(),t.characters(n,e+9,s-e-9),t.endCDATA(),s+3}var o=JZ(n,e),a=o.length;if(a>1&&/!doctype/i.test(o[0][0])){var l=o[1][0],c=!1,u=!1;a>3&&(/^public$/i.test(o[2][0])?(c=o[3][0],u=a>4&&o[4][0]):/^system$/i.test(o[2][0])&&(u=o[3][0]));var d=o[a-1];return t.startDTD(l,c,u),t.endDTD(),d.index+d[0].length}}return-1}function ZZ(n,e,t){var r=n.indexOf("?>",e);if(r){var i=n.substring(e,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(i){var s=i[0].length;return t.processingInstruction(i[1],i[2]),r+2}else return-1}return-1}function XO(){this.attributeNames={}}XO.prototype={setTagName:function(n){if(!zO.test(n))throw new Error("invalid tagName:"+n);this.tagName=n},addValue:function(n,e,t){if(!zO.test(n))throw new Error("invalid attribute:"+n);this.attributeNames[n]=this.length,this[this.length++]={qName:n,value:e,offset:t}},length:0,getLocalName:function(n){return this[n].localName},getLocator:function(n){return this[n].locator},getQName:function(n){return this[n].qName},getURI:function(n){return this[n].uri},getValue:function(n){return this[n].value}};function JZ(n,e){var t,r=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=e,i.exec(n);t=i.exec(n);)if(r.push(t),t[1])return r}pk.XMLReader=VO;pk.ParseError=Md});var tL=ut(jy=>{var eJ=M3(),tJ=fk(),YO=GO(),ZO=qO(),rJ=tJ.DOMImplementation,KO=eJ.NAMESPACE,nJ=ZO.ParseError,iJ=ZO.XMLReader;function JO(n){return n.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function eL(n){this.options=n||{locator:{}}}eL.prototype.parseFromString=function(n,e){var t=this.options,r=new iJ,i=t.domBuilder||new H3,s=t.errorHandler,o=t.locator,a=t.xmlns||{},l=/\/x?html?$/.test(e),c=l?YO.HTML_ENTITIES:YO.XML_ENTITIES;o&&i.setDocumentLocator(o),r.errorHandler=sJ(s,i,o),r.domBuilder=t.domBuilder||i,l&&(a[""]=KO.HTML),a.xml=a.xml||KO.XML;var u=t.normalizeLineEndings||JO;return n&&typeof n=="string"?r.parse(u(n),a,c):r.errorHandler.error("invalid doc source"),i.doc};function sJ(n,e,t){if(!n){if(e instanceof H3)return e;n=e}var r={},i=n instanceof Function;t=t||{};function s(o){var a=n[o];!a&&i&&(a=n.length==2?function(l){n(o,l)}:n),r[o]=a&&function(l){a("[xmldom "+o+"]	"+l+mk(t))}||function(){}}return s("warning"),s("error"),s("fatalError"),r}function H3(){this.cdata=!1}function Rd(n,e){e.lineNumber=n.lineNumber,e.columnNumber=n.columnNumber}H3.prototype={startDocument:function(){this.doc=new rJ().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(n,e,t,r){var i=this.doc,s=i.createElementNS(n,t||e),o=r.length;Vy(this,s),this.currentElement=s,this.locator&&Rd(this.locator,s);for(var a=0;a<o;a++){var n=r.getURI(a),l=r.getValue(a),t=r.getQName(a),c=i.createAttributeNS(n,t);this.locator&&Rd(r.getLocator(a),c),c.value=c.nodeValue=l,s.setAttributeNode(c)}},endElement:function(n,e,t){var r=this.currentElement,i=r.tagName;this.currentElement=r.parentNode},startPrefixMapping:function(n,e){},endPrefixMapping:function(n){},processingInstruction:function(n,e){var t=this.doc.createProcessingInstruction(n,e);this.locator&&Rd(this.locator,t),Vy(this,t)},ignorableWhitespace:function(n,e,t){},characters:function(n,e,t){if(n=QO.apply(this,arguments),n){if(this.cdata)var r=this.doc.createCDATASection(n);else var r=this.doc.createTextNode(n);this.currentElement?this.currentElement.appendChild(r):/^\s*$/.test(n)&&this.doc.appendChild(r),this.locator&&Rd(this.locator,r)}},skippedEntity:function(n){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(n){(this.locator=n)&&(n.lineNumber=0)},comment:function(n,e,t){n=QO.apply(this,arguments);var r=this.doc.createComment(n);this.locator&&Rd(this.locator,r),Vy(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(n,e,t){var r=this.doc.implementation;if(r&&r.createDocumentType){var i=r.createDocumentType(n,e,t);this.locator&&Rd(this.locator,i),Vy(this,i),this.doc.doctype=i}},warning:function(n){console.warn("[xmldom warning]	"+n,mk(this.locator))},error:function(n){console.error("[xmldom error]	"+n,mk(this.locator))},fatalError:function(n){throw new nJ(n,this.locator)}};function mk(n){if(n)return`
@`+(n.systemId||"")+"#[line:"+n.lineNumber+",col:"+n.columnNumber+"]"}function QO(n,e,t){return typeof n=="string"?n.substr(e,t):n.length>=e+t||e?new java.lang.String(n,e,t)+"":n}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(n){H3.prototype[n]=function(){return null}});function Vy(n,e){n.currentElement?n.currentElement.appendChild(e):n.doc.appendChild(e)}jy.__DOMHandler=H3;jy.normalizeLineEndings=JO;jy.DOMParser=eL});var nL=ut(Xy=>{var rL=fk();Xy.DOMImplementation=rL.DOMImplementation;Xy.XMLSerializer=rL.XMLSerializer;Xy.DOMParser=tL().DOMParser});var _p=ut((aut,hz)=>{hz.exports=jx;function jx(n,e){var t=n&&n.type,r;if(t==="FeatureCollection")for(r=0;r<n.features.length;r++)jx(n.features[r],e);else if(t==="GeometryCollection")for(r=0;r<n.geometries.length;r++)jx(n.geometries[r],e);else if(t==="Feature")jx(n.geometry,e);else if(t==="Polygon")dz(n.coordinates,e);else if(t==="MultiPolygon")for(r=0;r<n.coordinates.length;r++)dz(n.coordinates[r],e);return n}function dz(n,e){if(n.length!==0){fz(n[0],e);for(var t=1;t<n.length;t++)fz(n[t],!e)}}function fz(n,e){for(var t=0,r=0,i=0,s=n.length,o=s-1;i<s;o=i++){var a=(n[i][0]-n[o][0])*(n[o][1]+n[i][1]),l=t+a;r+=Math.abs(t)>=Math.abs(a)?t-l+a:a-l+t,t=l}t+r>=0!=!!e&&n.reverse()}});var xz=ut((lut,yz)=>{var pz=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,mz=new RegExp("^"+pz.source+"(\\s"+pz.source+"){1,}"),Bre=n=>{let e=n.split(";"),t=e.pop(),r=(e.shift()||"").split("=").pop(),i=0;function s(x){let b=t.substring(i).match(x);return b?(i+=b[0].length,b[0]):null}function o(x){return x&&r.match(/\d+/)&&(x.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+r}}),x}function a(){s(/^\s*/)}function l(){a();let x=0,b=[],_=[b],S=b,C;for(;C=s(/^(\()/)||s(/^(\))/)||s(/^(,)/)||s(mz);){if(C==="(")_.push(S),S=[],_[_.length-1].push(S),x++;else if(C===")"){if(S.length===0||(S=_.pop(),!S))return null;if(x--,x===0)break}else if(C===",")S=[],_[_.length-1].push(S);else if(!C.split(/\s/g).some(isNaN))Array.prototype.push.apply(S,C.split(/\s/g).map(parseFloat));else return null;a()}return x!==0?null:b}function c(){let x=[],b,_;for(;_=s(mz)||s(/^(,)/);)_===","?(x.push(b),b=[]):_.split(/\s/g).some(isNaN)||(b||(b=[]),Array.prototype.push.apply(b,_.split(/\s/g).map(parseFloat))),a();if(b)x.push(b);else return null;return x.length?x:null}function u(){if(!s(/^(point(\sz)?)/i)||(a(),!s(/^(\()/)))return null;let x=c();return!x||(a(),!s(/^(\))/))?null:{type:"Point",coordinates:x[0]}}function d(){if(!s(/^(multipoint(\sz)?)/i))return null;a(),t="MULTIPOINT ("+t.substring(t.indexOf("(")+1,t.length-1).replace(/\(/g,"").replace(/\)/g,"")+")";let b=l();return b?(a(),{type:"MultiPoint",coordinates:b}):null}function f(){if(!s(/^(multilinestring(\sz)?)/i))return null;a();let x=l();return x?(a(),{type:"MultiLineString",coordinates:x}):null}function h(){if(!s(/^(linestring(\sz)?)/i)||(a(),!s(/^(\()/)))return null;let x=c();return!x||!s(/^(\))/)?null:{type:"LineString",coordinates:x}}function p(){if(!s(/^(polygon(\sz)?)/i))return null;a();let x=l();return x?{type:"Polygon",coordinates:x}:null}function m(){if(!s(/^(multipolygon(\sz)?)/i))return null;a();let x=l();return x?{type:"MultiPolygon",coordinates:x}:null}function g(){let x=[],b;if(!s(/^(geometrycollection)/i)||(a(),!s(/^(\()/)))return null;for(;b=y();)x.push(b),a(),s(/^(,)/),a();return s(/^(\))/)?{type:"GeometryCollection",geometries:x}:null}function y(){return u()||h()||p()||d()||f()||m()||g()}return o(y())},gz=n=>{n.type==="Feature"&&(n=n.geometry);function e(a){return a.join(" ")}function t(a){return a.map(e).join(", ")}function r(a){return a.map(t).map(s).join(", ")}function i(a){return a.map(r).map(s).join(", ")}function s(a){return"("+a+")"}let o=n;switch(o.type){case"Point":return o.coordinates&&o.coordinates.length===3?"POINT Z ("+e(o.coordinates)+")":"POINT ("+e(o.coordinates)+")";case"LineString":return o.coordinates&&o.coordinates[0]&&o.coordinates[0].length===3?"LINESTRING Z ("+t(o.coordinates)+")":"LINESTRING ("+t(o.coordinates)+")";case"Polygon":return o.coordinates&&o.coordinates[0]&&o.coordinates[0][0]&&o.coordinates[0][0].length===3?"POLYGON Z ("+r(o.coordinates)+")":"POLYGON ("+r(o.coordinates)+")";case"MultiPoint":return o.coordinates&&o.coordinates[0]&&o.coordinates[0].length===3?"MULTIPOINT Z ("+t(o.coordinates)+")":"MULTIPOINT ("+t(o.coordinates)+")";case"MultiLineString":return o.coordinates&&o.coordinates[0]&&o.coordinates[0][0]&&o.coordinates[0][0].length===3?"MULTILINESTRING Z ("+r(o.coordinates)+")":"MULTILINESTRING ("+r(o.coordinates)+")";case"MultiPolygon":return o.coordinates&&o.coordinates[0]&&o.coordinates[0][0]&&o.coordinates[0][0]&&o.coordinates[0][0][0].length===3?"MULTIPOLYGON Z ("+i(o.coordinates)+")":"MULTIPOLYGON ("+i(o.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+o.geometries.map(gz).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}};yz.exports={parse:Bre,stringify:gz}});var bz=ut((cut,nI)=>{"use strict";nI.exports=vp;nI.exports.default=vp;function vp(n,e){if(!(this instanceof vp))return new vp(n,e);if(this.data=n||[],this.length=this.data.length,this.compare=e||Nre,this.length>0)for(var t=(this.length>>1)-1;t>=0;t--)this._down(t)}function Nre(n,e){return n<e?-1:n>e?1:0}vp.prototype={push:function(n){this.data.push(n),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var n=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),n}},peek:function(){return this.data[0]},_up:function(n){for(var e=this.data,t=this.compare,r=e[n];n>0;){var i=n-1>>1,s=e[i];if(t(r,s)>=0)break;e[n]=s,n=i}e[n]=r},_down:function(n){for(var e=this.data,t=this.compare,r=this.length>>1,i=e[n];n<r;){var s=(n<<1)+1,o=s+1,a=e[s];if(o<this.length&&t(e[o],a)<0&&(s=o,a=e[o]),t(a,i)>=0)break;e[n]=a,n=s}e[n]=i}}});var vz=ut((uut,iI)=>{"use strict";var Ore=bz();iI.exports=_z;iI.exports.default=_z;function _z(n,e,t){e=e||1;for(var r,i,s,o,a=0;a<n[0].length;a++){var l=n[0][a];(!a||l[0]<r)&&(r=l[0]),(!a||l[1]<i)&&(i=l[1]),(!a||l[0]>s)&&(s=l[0]),(!a||l[1]>o)&&(o=l[1])}var c=s-r,u=o-i,d=Math.min(c,u),f=d/2,h=new Ore(null,Lre);if(d===0)return[r,i];for(var p=r;p<s;p+=d)for(var m=i;m<o;m+=d)h.push(new lc(p+f,m+f,f,n));var g=Gre(n),y=new lc(r+c/2,i+u/2,0,n);y.d>g.d&&(g=y);for(var x=h.length;h.length;){var b=h.pop();b.d>g.d&&(g=b,t&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,x)),!(b.max-g.d<=e)&&(f=b.h/2,h.push(new lc(b.x-f,b.y-f,f,n)),h.push(new lc(b.x+f,b.y-f,f,n)),h.push(new lc(b.x-f,b.y+f,f,n)),h.push(new lc(b.x+f,b.y+f,f,n)),x+=4)}return t&&(console.log("num probes: "+x),console.log("best distance: "+g.d)),[g.x,g.y]}function Lre(n,e){return e.max-n.max}function lc(n,e,t,r){this.x=n,this.y=e,this.h=t,this.d=Ure(n,e,r),this.max=this.d+this.h*Math.SQRT2}function Ure(n,e,t){for(var r=!1,i=1/0,s=0;s<t.length;s++)for(var o=t[s],a=0,l=o.length,c=l-1;a<l;c=a++){var u=o[a],d=o[c];u[1]>e!=d[1]>e&&n<(d[0]-u[0])*(e-u[1])/(d[1]-u[1])+u[0]&&(r=!r),i=Math.min(i,$re(n,e,u,d))}return(r?1:-1)*Math.sqrt(i)}function Gre(n){for(var e=0,t=0,r=0,i=n[0],s=0,o=i.length,a=o-1;s<o;a=s++){var l=i[s],c=i[a],u=l[0]*c[1]-c[0]*l[1];t+=(l[0]+c[0])*u,r+=(l[1]+c[1])*u,e+=u*3}return e===0?new lc(i[0][0],i[0][1],0,n):new lc(t/e,r/e,0,n)}function $re(n,e,t,r){var i=t[0],s=t[1],o=r[0]-i,a=r[1]-s;if(o!==0||a!==0){var l=((n-i)*o+(e-s)*a)/(o*o+a*a);l>1?(i=r[0],s=r[1]):l>0&&(i+=o*l,s+=a*l)}return o=n-i,a=e-s,o*o+a*a}});var Gz=ut((EI,TI)=>{(function(n,e){typeof EI=="object"&&typeof TI<"u"?TI.exports=e():typeof define=="function"&&define.amd?define(e):n.quickselect=e()})(EI,function(){"use strict";function n(i,s,o,a,l){e(i,s,o||0,a||i.length-1,l||r)}function e(i,s,o,a,l){for(;a>o;){if(a-o>600){var c=a-o+1,u=s-o+1,d=Math.log(c),f=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*f*(c-f)/c)*(u-c/2<0?-1:1),p=Math.max(o,Math.floor(s-u*f/c+h)),m=Math.min(a,Math.floor(s+(c-u)*f/c+h));e(i,s,p,m,l)}var g=i[s],y=o,x=a;for(t(i,o,s),l(i[a],g)>0&&t(i,o,a);y<x;){for(t(i,y,x),y++,x--;l(i[y],g)<0;)y++;for(;l(i[x],g)>0;)x--}l(i[o],g)===0?t(i,o,x):(x++,t(i,x,a)),x<=s&&(o=x+1),s<=x&&(a=x-1)}}function t(i,s,o){var a=i[s];i[s]=i[o],i[o]=a}function r(i,s){return i<s?-1:i>s?1:0}return n})});var Wz=ut((M0t,PI)=>{"use strict";PI.exports=Tp;PI.exports.default=Tp;var Pne=Gz();function Tp(n,e){if(!(this instanceof Tp))return new Tp(n,e);this._maxEntries=Math.max(4,n||9),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),e&&this._initFormat(e),this.clear()}Tp.prototype={all:function(){return this._all(this.data,[])},search:function(n){var e=this.data,t=[],r=this.toBBox;if(!Cb(n,e))return t;for(var i=[],s,o,a,l;e;){for(s=0,o=e.children.length;s<o;s++)a=e.children[s],l=e.leaf?r(a):a,Cb(n,l)&&(e.leaf?t.push(a):II(n,l)?this._all(a,t):i.push(a));e=i.pop()}return t},collides:function(n){var e=this.data,t=this.toBBox;if(!Cb(n,e))return!1;for(var r=[],i,s,o,a;e;){for(i=0,s=e.children.length;i<s;i++)if(o=e.children[i],a=e.leaf?t(o):o,Cb(n,a)){if(e.leaf||II(n,a))return!0;r.push(o)}e=r.pop()}return!1},load:function(n){if(!(n&&n.length))return this;if(n.length<this._minEntries){for(var e=0,t=n.length;e<t;e++)this.insert(n[e]);return this}var r=this._build(n.slice(),0,n.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}return this},insert:function(n){return n&&this._insert(n,this.data.height-1),this},clear:function(){return this.data=tf([]),this},remove:function(n,e){if(!n)return this;for(var t=this.data,r=this.toBBox(n),i=[],s=[],o,a,l,c;t||i.length;){if(t||(t=i.pop(),a=i[i.length-1],o=s.pop(),c=!0),t.leaf&&(l=Dne(n,t.children,e),l!==-1))return t.children.splice(l,1),i.push(t),this._condense(i),this;!c&&!t.leaf&&II(t,r)?(i.push(t),s.push(o),o=0,a=t,t=t.children[0]):a?(o++,t=a.children[o],c=!1):t=null}return this},toBBox:function(n){return n},compareMinX:$z,compareMinY:zz,toJSON:function(){return this.data},fromJSON:function(n){return this.data=n,this},_all:function(n,e){for(var t=[];n;)n.leaf?e.push.apply(e,n.children):t.push.apply(t,n.children),n=t.pop();return e},_build:function(n,e,t,r){var i=t-e+1,s=this._maxEntries,o;if(i<=s)return o=tf(n.slice(e,t+1)),ef(o,this.toBBox),o;r||(r=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,r-1))),o=tf([]),o.leaf=!1,o.height=r;var a=Math.ceil(i/s),l=a*Math.ceil(Math.sqrt(s)),c,u,d,f;for(Hz(n,e,t,l,this.compareMinX),c=e;c<=t;c+=l)for(d=Math.min(c+l-1,t),Hz(n,c,d,a,this.compareMinY),u=c;u<=d;u+=a)f=Math.min(u+a-1,d),o.children.push(this._build(n,u,f,r-1));return ef(o,this.toBBox),o},_chooseSubtree:function(n,e,t,r){for(var i,s,o,a,l,c,u,d;r.push(e),!(e.leaf||r.length-1===t);){for(u=d=1/0,i=0,s=e.children.length;i<s;i++)o=e.children[i],l=kI(o),c=Mne(n,o)-l,c<d?(d=c,u=l<u?l:u,a=o):c===d&&l<u&&(u=l,a=o);e=a||e.children[0]}return e},_insert:function(n,e,t){var r=this.toBBox,i=t?n:r(n),s=[],o=this._chooseSubtree(i,this.data,e,s);for(o.children.push(n),Ep(o,i);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(i,s,e)},_split:function(n,e){var t=n[e],r=t.children.length,i=this._minEntries;this._chooseSplitAxis(t,i,r);var s=this._chooseSplitIndex(t,i,r),o=tf(t.children.splice(s,t.children.length-s));o.height=t.height,o.leaf=t.leaf,ef(t,this.toBBox),ef(o,this.toBBox),e?n[e-1].children.push(o):this._splitRoot(t,o)},_splitRoot:function(n,e){this.data=tf([n,e]),this.data.height=n.height+1,this.data.leaf=!1,ef(this.data,this.toBBox)},_chooseSplitIndex:function(n,e,t){var r,i,s,o,a,l,c,u;for(l=c=1/0,r=e;r<=t-e;r++)i=Ap(n,0,r,this.toBBox),s=Ap(n,r,t,this.toBBox),o=Rne(i,s),a=kI(i)+kI(s),o<l?(l=o,u=r,c=a<c?a:c):o===l&&a<c&&(c=a,u=r);return u},_chooseSplitAxis:function(n,e,t){var r=n.leaf?this.compareMinX:$z,i=n.leaf?this.compareMinY:zz,s=this._allDistMargin(n,e,t,r),o=this._allDistMargin(n,e,t,i);s<o&&n.children.sort(r)},_allDistMargin:function(n,e,t,r){n.children.sort(r);var i=this.toBBox,s=Ap(n,0,e,i),o=Ap(n,t-e,t,i),a=Sb(s)+Sb(o),l,c;for(l=e;l<t-e;l++)c=n.children[l],Ep(s,n.leaf?i(c):c),a+=Sb(s);for(l=t-e-1;l>=e;l--)c=n.children[l],Ep(o,n.leaf?i(c):c),a+=Sb(o);return a},_adjustParentBBoxes:function(n,e,t){for(var r=t;r>=0;r--)Ep(e[r],n)},_condense:function(n){for(var e=n.length-1,t;e>=0;e--)n[e].children.length===0?e>0?(t=n[e-1].children,t.splice(t.indexOf(n[e]),1)):this.clear():ef(n[e],this.toBBox)},_initFormat:function(n){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(n[0])),this.compareMinY=new Function("a","b",e.join(n[1])),this.toBBox=new Function("a","return {minX: a"+n[0]+", minY: a"+n[1]+", maxX: a"+n[2]+", maxY: a"+n[3]+"};")}};function Dne(n,e,t){if(!t)return e.indexOf(n);for(var r=0;r<e.length;r++)if(t(n,e[r]))return r;return-1}function ef(n,e){Ap(n,0,n.children.length,e,n)}function Ap(n,e,t,r,i){i||(i=tf(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var s=e,o;s<t;s++)o=n.children[s],Ep(i,n.leaf?r(o):o);return i}function Ep(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function $z(n,e){return n.minX-e.minX}function zz(n,e){return n.minY-e.minY}function kI(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Sb(n){return n.maxX-n.minX+(n.maxY-n.minY)}function Mne(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function Rne(n,e){var t=Math.max(n.minX,e.minX),r=Math.max(n.minY,e.minY),i=Math.min(n.maxX,e.maxX),s=Math.min(n.maxY,e.maxY);return Math.max(0,i-t)*Math.max(0,s-r)}function II(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function Cb(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function tf(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Hz(n,e,t,r,i){for(var s=[e,t],o;s.length;)t=s.pop(),e=s.pop(),!(t-e<=r)&&(o=e+Math.ceil((t-e)/r/2)*r,Pne(n,o,e,t,i),s.push(e,o,o,t))}});var jz=ut((R0t,Vz)=>{"use strict";Vz.exports=Ab;Ab.polyline=Ab;Ab.polygon=Fne;function Ab(n,e,t){var r=n.length,i=rf(n[0],e),s=[],o,a,l,c,u;for(t||(t=[]),o=1;o<r;o++){for(a=n[o-1],l=n[o],c=u=rf(l,e);;)if(i|c){if(i&c)break;i?(a=DI(a,l,i,e),i=rf(a,e)):(l=DI(a,l,c,e),c=rf(l,e))}else{s.push(a),c!==u?(s.push(l),o<r-1&&(t.push(s),s=[])):o===r-1&&s.push(l);break}i=u}return s.length&&t.push(s),t}function Fne(n,e){var t,r,i,s,o,a,l;for(r=1;r<=8;r*=2){for(t=[],i=n[n.length-1],s=!(rf(i,e)&r),o=0;o<n.length;o++)a=n[o],l=!(rf(a,e)&r),l!==s&&t.push(DI(i,a,r,e)),l&&t.push(a),i=a,s=l;if(n=t,!n.length)break}return t}function DI(n,e,t,r){return t&8?[n[0]+(e[0]-n[0])*(r[3]-n[1])/(e[1]-n[1]),r[3]]:t&4?[n[0]+(e[0]-n[0])*(r[1]-n[1])/(e[1]-n[1]),r[1]]:t&2?[r[2],n[1]+(e[1]-n[1])*(r[2]-n[0])/(e[0]-n[0])]:t&1?[r[0],n[1]+(e[1]-n[1])*(r[0]-n[0])/(e[0]-n[0])]:null}function rf(n,e){var t=0;return n[0]<e[0]?t|=1:n[0]>e[2]&&(t|=2),n[1]<e[1]?t|=4:n[1]>e[3]&&(t|=8),t}});var kp=ut((F0t,Yz)=>{"use strict";var Bne=Wz(),Nne=jz();Yz.exports=One;function One(n){for(var e=[],t=0;t<n.features.length;t++){var r=n.features[t];if(r.geometry){var i=r.geometry.coordinates;if(r.geometry.type==="Polygon")e.push(Xz(i,r.properties));else if(r.geometry.type==="MultiPolygon")for(var s=0;s<i.length;s++)e.push(Xz(i[s],r.properties))}}var o=Bne().load(e);function a(l,c){for(var u=[],d=o.search({minX:l[0],minY:l[1],maxX:l[0],maxY:l[1]}),f=0;f<d.length;f++)if(qz(d[f].coords,l))if(c)u.push(d[f].props);else return d[f].props;return c&&u.length?u:null}return a.tree=o,a.bbox=function(c){for(var u=[],d=o.search({minX:c[0],minY:c[1],maxX:c[2],maxY:c[3]}),f=0;f<d.length;f++)Lne(d[f].coords,c)&&u.push(d[f].props);return u},a}function Lne(n,e){var t=[(e[0]+e[2])/2,(e[1]+e[3])/2];if(qz(n,t))return!0;for(var r=0;r<n.length;r++)if(Nne(n[r],e).length>0)return!0;return!1}function qz(n,e){for(var t=!1,r=0,i=n.length;r<i;r++)for(var s=n[r],o=0,a=s.length,l=a-1;o<a;l=o++)Une(e,s[o],s[l])&&(t=!t);return t}function Une(n,e,t){return e[1]>n[1]!=t[1]>n[1]&&n[0]<(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1])+e[0]}function Xz(n,e){for(var t={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0,coords:n,props:e},r=0;r<n[0].length;r++){var i=n[0][r];t.minX=Math.min(t.minX,i[0]),t.minY=Math.min(t.minY,i[1]),t.maxX=Math.max(t.maxX,i[0]),t.maxY=Math.max(t.maxY,i[1])}return t}});var yH=ut((udt,Rb)=>{Rb.exports.RADIUS=6378137;Rb.exports.FLATTENING=1/298.257223563;Rb.exports.POLAR_RADIUS=63567523142e-4});var VI=ut((ddt,WI)=>{var xH=yH();WI.exports.geometry=_H;WI.exports.ring=HI;function _H(n){var e=0,t;switch(n.type){case"Polygon":return bH(n.coordinates);case"MultiPolygon":for(t=0;t<n.coordinates.length;t++)e+=bH(n.coordinates[t]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(t=0;t<n.geometries.length;t++)e+=_H(n.geometries[t]);return e}}function bH(n){var e=0;if(n&&n.length>0){e+=Math.abs(HI(n[0]));for(var t=1;t<n.length;t++)e-=Math.abs(HI(n[t]))}return e}function HI(n){var e,t,r,i,s,o,a,l=0,c=n.length;if(c>2){for(a=0;a<c;a++)a===c-2?(i=c-2,s=c-1,o=0):a===c-1?(i=c-1,s=0,o=1):(i=a,s=a+1,o=a+2),e=n[i],t=n[s],r=n[o],l+=(zI(r[0])-zI(e[0]))*Math.sin(zI(t[1]));l=l*xH.RADIUS*xH.RADIUS/2}return l}function zI(n){return n*Math.PI/180}});var wH=ut(vH=>{vH.validateCenter=function(e){var t=[2,3];if(!Array.isArray(e)||!t.includes(e.length))throw new Error("ERROR! Center has to be an array of length two or three");var[r,i]=e;if(typeof r!="number"||typeof i!="number")throw new Error(`ERROR! Longitude and Latitude has to be numbers but where ${typeof r} and ${typeof i}`);if(r>180||r<-180)throw new Error(`ERROR! Longitude has to be between -180 and 180 but was ${r}`);if(i>90||i<-90)throw new Error(`ERROR! Latitude has to be between -90 and 90 but was ${i}`)}});var CH=ut(SH=>{SH.validateRadius=function(e){if(typeof e!="number")throw new Error(`ERROR! Radius has to be a positive number but was: ${typeof e}`);if(e<=0)throw new Error(`ERROR! Radius has to be a positive number but was: ${e}`)}});var EH=ut(AH=>{AH.validateNumberOfEdges=function(e){if(typeof e!="number"){let t=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Number of edges has to be a number but was: ${t}`)}if(e<3)throw new Error(`ERROR! Number of edges has to be at least 3 but was: ${e}`)}});var kH=ut(TH=>{TH.validateEarthRadius=function(e){if(typeof e!="number"){let t=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Earth radius has to be a number but was: ${t}`)}if(e<=0)throw new Error(`ERROR! Earth radius has to be a positive number but was: ${e}`)}});var PH=ut(IH=>{IH.validateBearing=function(e){if(typeof e!="number"){let t=Array.isArray(e)?"array":typeof e;throw new Error(`ERROR! Bearing has to be a number but was: ${t}`)}}});var NH=ut(R1=>{var DH=wH().validateCenter,MH=CH().validateRadius,RH=EH().validateNumberOfEdges,FH=kH().validateEarthRadius,BH=PH().validateBearing;function mie({center:n,radius:e,numberOfEdges:t,earthRadius:r,bearing:i}){DH(n),MH(e),RH(t),FH(r),BH(i)}R1.validateCenter=DH;R1.validateRadius=MH;R1.validateNumberOfEdges=RH;R1.validateEarthRadius=FH;R1.validateBearing=BH;R1.validateInput=mie});var UH=ut((xdt,LH)=>{"use strict";var{validateInput:gie}=NH(),jI=6378137;function XI(n){return n*Math.PI/180}function OH(n){return n*180/Math.PI}function yie(n,e,t,r){var i=XI(n[1]),s=XI(n[0]),o=e/t,a=Math.asin(Math.sin(i)*Math.cos(o)+Math.cos(i)*Math.sin(o)*Math.cos(r)),l=s+Math.atan2(Math.sin(r)*Math.sin(o)*Math.cos(i),Math.cos(o)-Math.sin(i)*Math.sin(a));return[OH(l),OH(a)]}LH.exports=function(e,t,r){var i=xie(r),s=bie(r),o=vie(r),a=_ie(r);gie({center:e,radius:t,numberOfEdges:i,earthRadius:s,bearing:o});for(var l=XI(o),c=[],u=0;u<i;++u)c.push(yie(e,t,s,l+a*2*Math.PI*-u/i));return c.push(c[0]),{type:"Polygon",coordinates:[c]}};function xie(n){if(qI(n))return 32;if(Fb(n)){var e=n.numberOfEdges;return e===void 0?32:e}return n}function bie(n){if(qI(n))return jI;if(Fb(n)){var e=n.earthRadius;return e===void 0?jI:e}return jI}function _ie(n){return Fb(n)&&n.rightHandRule?-1:1}function vie(n){if(qI(n))return 0;if(Fb(n)){var e=n.bearing;return e===void 0?0:e}return 0}function Fb(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function qI(n){return n==null}});var GH=ut((bdt,YI)=>{(function(){function n(e,t,r){function i(f){return f.map(function(h,p){return p<2?1*h.toFixed(t):1*h.toFixed(r)})}function s(f){return f.map(i)}function o(f){return f.map(s)}function a(f){return f.map(o)}function l(f){if(!f)return{};switch(f.type){case"Point":return f.coordinates=i(f.coordinates),f;case"LineString":case"MultiPoint":return f.coordinates=s(f.coordinates),f;case"Polygon":case"MultiLineString":return f.coordinates=o(f.coordinates),f;case"MultiPolygon":return f.coordinates=a(f.coordinates),f;case"GeometryCollection":return f.geometries=f.geometries.map(l),f;default:return{}}}function c(f){return f.geometry=l(f.geometry),f}function u(f){return f.features=f.features.map(c),f}function d(f){return f.geometries=f.geometries.map(l),f}if(!e)return e;switch(e.type){case"Feature":return c(e);case"GeometryCollection":return d(e);case"FeatureCollection":return u(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiPolygon":case"MultiLineString":return l(e);default:return e}}YI.exports=n,YI.exports.parse=n})()});var HH=ut((_dt,zH)=>{function Bb(n){return typeof n=="object"&&n!==null}function wie(n,e){Array.isArray(n)?n.forEach(e):Bb(n)&&Object.keys(n).forEach(function(t){var r=n[t];e(r,t)})}function $H(n){var e=0;return Array.isArray(n)||Bb(n)?(wie(n,function(t){if(Array.isArray(t)||Bb(t)){var r=$H(t);r>e&&(e=r)}}),e+1):e}function Sie(n,e){e=e||{};var t=JSON.stringify([1],null,nf(e,"indent",2)).slice(2,-3),r=nf(e,"margins",!1),i=nf(e,"arrayMargins",!1),s=nf(e,"objectMargins",!1),o=t===""?1/0:nf(e,"maxLength",80),a=nf(e,"maxNesting",1/0);return function l(c,u,d){c&&typeof c.toJSON=="function"&&(c=c.toJSON());var f=JSON.stringify(c);if(f===void 0)return f;var h=o-u.length-d,p=$H(c);if(p<=a&&f.length<=h){var m=Aie(f,{addMargin:r,addArrayMargin:i,addObjectMargin:s});if(m.length<=h)return m}if(Bb(c)){var g=u+t,y=[],x,b=function(S,C){return C===S.length-1?0:1};if(Array.isArray(c)){for(var _=0;_<c.length;_++)y.push(l(c[_],g,b(c,_))||"null");x="[]"}else Object.keys(c).forEach(function(S,C,k){var v=JSON.stringify(S)+": ",w=l(c[S],g,v.length+b(k,C));w!==void 0&&y.push(v+w)}),x="{}";if(y.length>0)return[x[0],t+y.join(`,
`+g),x[1]].join(`
`+u)}return f}(n,"",0)}var Cie=/("(?:[^\\"]|\\.)*")|[:,\][}{]/g;function Aie(n,e){e=e||{};var t={"{":"{","}":"}","[":"[","]":"]",",":", ",":":": "};return(e.addMargin||e.addObjectMargin)&&(t["{"]="{ ",t["}"]=" }"),(e.addMargin||e.addArrayMargin)&&(t["["]="[ ",t["]"]=" ]"),n.replace(Cie,function(r,i){return i?r:t[r]})}function nf(n,e,t){return e in n?n[e]:t}zH.exports=Sie});var cW=ut((f6t,mf)=>{mf.exports=zie;mf.exports.pair=Wie;mf.exports.format=uP;mf.exports.formatPair=Hie;mf.exports.coordToDMS=lW;function zie(n,e){var t=dP(n,e);return t===null?null:t.val}function Hie(n){return uP(n.lat,"lat")+" "+uP(n.lon,"lon")}function uP(n,e){var t=lW(n,e);return t.whole+"\xB0 "+(t.minutes?t.minutes+"' ":"")+(t.seconds?t.seconds+'" ':"")+t.dir}function lW(n,e){var t={lat:["N","S"],lon:["E","W"]}[e]||"",r=t[n>=0?0:1],i=Math.abs(n),s=Math.floor(i),o=i-s,a=o*60,l=Math.floor(a),c=Math.floor((a-l)*60);return{whole:s,minutes:l,seconds:c,dir:r}}function dP(n,e){if(e||(e="NSEW"),typeof n!="string")return null;n=n.toUpperCase();var t=/^[\s\,]*([NSEW])?\s*([\-|\—|\―]?[0-9.]+)[°º˚]?\s*(?:([0-9.]+)['’′‘]\s*)?(?:([0-9.]+)(?:''|"|”|″)\s*)?([NSEW])?/,r=n.match(t);if(!r)return null;var i=r[0],s;if(r[1]&&r[5]?(s=r[1],i=i.slice(0,-1)):s=r[1]||r[5],s&&e.indexOf(s)===-1)return null;var o=r[2]?parseFloat(r[2]):0,a=r[3]?parseFloat(r[3])/60:0,l=r[4]?parseFloat(r[4])/3600:0,c=o<0?-1:1;return(s==="S"||s==="W")&&(c*=-1),{val:(Math.abs(o)+a+l)*c,dim:s,matched:i,remain:n.slice(i.length)}}function Wie(n,e){n=n.trim();var t=dP(n,e);if(!t)return null;n=t.remain.trim();var r=dP(n,e);return!r||r.remain?null:t.dim?Vie(t.val,r.val,t.dim):[t.val,r.val]}function Vie(n,e,t){if(t==="N"||t==="S")return[n,e];if(t==="W"||t==="E")return[e,n]}});var vj=ut((DRt,_j)=>{"use strict";_j.exports=function(n,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,r=e.cmp&&function(s){return function(o){return function(a,l){var c={key:a,value:o[a]},u={key:l,value:o[l]};return s(c,u)}}}(e.cmp),i=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,l;if(Array.isArray(o)){for(l="[",a=0;a<o.length;a++)a&&(l+=","),l+=s(o[a])||"null";return l+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var c=i.push(o)-1,u=Object.keys(o).sort(r&&r(o));for(l="",a=0;a<u.length;a++){var d=u[a],f=s(o[d]);f&&(l&&(l+=","),l+=JSON.stringify(d)+":"+f)}return i.splice(c,1),"{"+l+"}"}}(n)}});var OD={};X1(OD,{AbstractBehavior:()=>Nr,AbstractMode:()=>tr,AbstractSystem:()=>Se,AbstractUiCard:()=>uo,AddNoteMode:()=>N5,AddPointMode:()=>O5,AssetSystem:()=>ap,BrowseMode:()=>L5,Category:()=>b2,Collection:()=>wo,Context:()=>lv,Difference:()=>Fn,DragBehavior:()=>J3,DragNodeMode:()=>U5,DragNoteMode:()=>G5,DrawAreaMode:()=>$5,DrawBehavior:()=>ep,DrawLineMode:()=>z5,Edit:()=>ga,EditSystem:()=>up,EsriService:()=>q5,FetchError:()=>wh,Field:()=>P2,FilterSystem:()=>dp,Graph:()=>Fr,GraphicsSystem:()=>Cp,HoverBehavior:()=>tp,ImagerySource:()=>$i,ImagerySourceBing:()=>I2,ImagerySourceCustom:()=>k2,ImagerySourceEsri:()=>Mc,ImagerySourceNone:()=>T2,ImagerySystem:()=>Ip,KartaviewService:()=>Y5,KeepRightService:()=>K5,KeyOperationBehavior:()=>Pt,LANGUAGE_SUFFIX_REGEX:()=>Hb,LassoBehavior:()=>rp,LocalizationSystem:()=>Pp,LocationSystem:()=>Lp,Map3dSystem:()=>Up,MapInteractionBehavior:()=>np,MapNudgeBehavior:()=>ip,MapRouletteService:()=>J5,MapSystem:()=>$p,MapWithAIService:()=>e6,MapillaryService:()=>Z5,MoveMode:()=>H5,NominatimService:()=>t6,NsiService:()=>n6,OsmService:()=>i6,OsmWikibaseService:()=>o6,OsmoseService:()=>s6,OvertureService:()=>a6,PasteBehavior:()=>sp,PhotoSystem:()=>zp,Preset:()=>Co,PresetSystem:()=>Yp,QAItem:()=>Qe,RapidDataset:()=>Hi,RapidSystem:()=>Qp,RotateMode:()=>W5,SaveMode:()=>V5,SelectBehavior:()=>op,SelectMode:()=>j5,SelectOsmMode:()=>X5,StorageSystem:()=>Zp,StreetsideService:()=>l6,StyleSystem:()=>e5,TaginfoService:()=>u6,Tree:()=>zi,UiAccount:()=>af,UiApiStatus:()=>lf,UiAttribution:()=>cf,UiBackgroundCard:()=>l5,UiBearingControl:()=>f5,UiContributors:()=>df,UiDefs:()=>hf,UiDownloadTool:()=>C5,UiDrawModesTool:()=>A5,UiFeatureList:()=>gf,UiField:()=>Fi,UiFilterStatus:()=>yf,UiFullscreen:()=>vf,UiGeolocateControl:()=>h5,UiHistoryCard:()=>c5,UiInfoCards:()=>wf,UiInspector:()=>Sf,UiLocationCard:()=>u5,UiMap3dViewer:()=>Af,UiMapControls:()=>Ef,UiMapFooter:()=>Mf,UiMapPanes:()=>Df,UiMapToolbar:()=>Xf,UiMeasurementCard:()=>d5,UiMinimap:()=>$f,UiOvermap:()=>Jf,UiOvertureInspector:()=>Yf,UiPhotoViewer:()=>Qf,UiProjectLinks:()=>Rf,UiRapidCatalog:()=>Wf,UiRapidDatasetToggle:()=>Vf,UiRapidInspector:()=>eh,UiRapidPowerUserFeatures:()=>jf,UiRapidTool:()=>E5,UiSaveTool:()=>T5,UiScale:()=>Ff,UiShortcuts:()=>th,UiSidebar:()=>nh,UiSourceSwitch:()=>Bf,UiSpector:()=>Zf,UiSystem:()=>I5,UiUndoRedoTool:()=>k5,UiValidatorStatus:()=>Nf,UiVersionInfo:()=>Of,UiViewOn:()=>qn,UiZoomControl:()=>p5,UiZoomToControl:()=>m5,UploaderSystem:()=>P5,UrlHashSystem:()=>D5,ValidationFix:()=>Re,ValidationIssue:()=>et,ValidationSystem:()=>B5,VectorTileService:()=>p6,WikidataService:()=>m6,WikipediaService:()=>g6,actionAddEntity:()=>Yt,actionAddMember:()=>Ic,actionAddMidpoint:()=>Cr,actionAddVertex:()=>ls,actionChangeMember:()=>nl,actionChangePreset:()=>ti,actionChangeTags:()=>Ft,actionCircularize:()=>ym,actionConnect:()=>Pc,actionCopyEntities:()=>y2,actionDeleteMember:()=>il,actionDeleteMultiple:()=>pa,actionDeleteNode:()=>vo,actionDeleteRelation:()=>$r,actionDeleteWay:()=>cs,actionDiscardTags:()=>ma,actionDisconnect:()=>Eh,actionExtract:()=>x2,actionJoin:()=>xm,actionMerge:()=>bm,actionMergeNodes:()=>bi,actionMergePolygon:()=>Fm,actionMergeRemoteChanges:()=>M2,actionMove:()=>Ao,actionMoveMember:()=>Nm,actionMoveNode:()=>Wi,actionNoop:()=>Om,actionOrthogonalize:()=>al,actionRapidAcceptFeature:()=>Um,actionReflect:()=>zm,actionRestrictTurn:()=>jR,actionReverse:()=>ns,actionRevert:()=>Mh,actionRotate:()=>F2,actionScale:()=>XR,actionSplit:()=>$s,actionStraightenNodes:()=>Gm,actionStraightenWay:()=>$m,actionSyncCrossingTags:()=>Gs,actionUnrestrictTurn:()=>qR,actionUpgradeTags:()=>Hm,behaviors:()=>io,geoChooseEdge:()=>Ar,geoHasLineIntersections:()=>HR,geoHasSelfIntersections:()=>Rc,geoOrthoCalcScore:()=>Bm,geoOrthoCanOrthogonalize:()=>R2,geoOrthoMaxOffsetAngle:()=>VR,geoOrthoNormalizedDotProduct:()=>Fc,modes:()=>ui,operationCircularize:()=>QP,operationContinue:()=>ZP,operationCopy:()=>eD,operationCycleHighwayTag:()=>JP,operationDelete:()=>Ji,operationDisconnect:()=>tD,operationDowngrade:()=>rD,operationExtract:()=>nD,operationMerge:()=>iD,operationMove:()=>M5,operationOrthogonalize:()=>sD,operationPaste:()=>R5,operationReflectLong:()=>aD,operationReflectShort:()=>oD,operationReverse:()=>lD,operationRotate:()=>F5,operationSplit:()=>cD,operationStraighten:()=>uD,osmAreaKeys:()=>Sc,osmChangeset:()=>ri,osmEntity:()=>me,osmFlowingWaterwayTagValues:()=>Q1,osmInferRestriction:()=>GR,osmIntersection:()=>UR,osmIsInterestingTag:()=>Yn,osmIsOldMultipolygonOuterMember:()=>g2,osmJoinWays:()=>xi,osmLanes:()=>am,osmLifecyclePrefixes:()=>oa,osmNode:()=>Le,osmNodeGeometriesForTags:()=>qa,osmOldMultipolygonOuterMember:()=>bR,osmOldMultipolygonOuterMemberOfRelation:()=>m2,osmOneWayTags:()=>Ya,osmPavedTags:()=>Cc,osmPointTags:()=>Y1,osmRailwayTrackTagValues:()=>k6,osmRelation:()=>mr,osmRemoveLifecyclePrefix:()=>dh,osmRoutableHighwayTagValues:()=>is,osmSetAreaKeys:()=>A6,osmSetPointTags:()=>E6,osmSetVertexTags:()=>T6,osmTagSuggestingArea:()=>Xa,osmTurn:()=>Dh,osmVertexTags:()=>K1,osmWay:()=>Rt,services:()=>qr,svgTagClasses:()=>Sj,systems:()=>Xr,uiChangesetEditor:()=>Vb,uiCombobox:()=>ct,uiCommit:()=>Yb,uiCommitWarnings:()=>qb,uiConfirm:()=>gc,uiConflicts:()=>Kb,uiDataEditor:()=>ff,uiDataHeader:()=>Qb,uiDetectionDetails:()=>Zb,uiDetectionHeader:()=>Jb,uiDetectionInspector:()=>pf,uiDisclosure:()=>N1,uiEditMenu:()=>e_,uiEntityEditor:()=>l_,uiFieldAccess:()=>ZI,uiFieldAddress:()=>JI,uiFieldCheck:()=>F1,uiFieldCombo:()=>Zi,uiFieldCycleway:()=>eP,uiFieldDefaultCheck:()=>F1,uiFieldEmail:()=>Ri,uiFieldIdentifier:()=>Ri,uiFieldLanes:()=>$b,uiFieldLocalized:()=>tP,uiFieldManyCombo:()=>Zi,uiFieldMultiCombo:()=>Zi,uiFieldNetworkCombo:()=>Zi,uiFieldNumber:()=>Ri,uiFieldOnewayCheck:()=>F1,uiFieldRadio:()=>qp,uiFieldRoadspeed:()=>rP,uiFieldSemiCombo:()=>Zi,uiFieldStructureRadio:()=>qp,uiFieldTel:()=>Ri,uiFieldText:()=>Ri,uiFieldTextarea:()=>nP,uiFieldTypeCombo:()=>Zi,uiFieldUrl:()=>Ri,uiFieldWikidata:()=>iP,uiFieldWikipedia:()=>Wb,uiFields:()=>of,uiFlash:()=>_f,uiFormFields:()=>uf,uiIcon:()=>X,uiIntro:()=>co,uiKeepRightDetails:()=>g_,uiKeepRightEditor:()=>Cf,uiKeepRightHeader:()=>y_,uiLoading:()=>Vo,uiMapRouletteDetails:()=>H_,uiMapRouletteEditor:()=>zf,uiMapRouletteMenu:()=>Hf,uiModal:()=>vr,uiNoteComments:()=>V_,uiNoteEditor:()=>qf,uiNoteHeader:()=>j_,uiNoteReport:()=>X_,uiOsmoseDetails:()=>q_,uiOsmoseEditor:()=>Kf,uiOsmoseHeader:()=>Y_,uiPane:()=>Ms,uiPaneBackground:()=>SP,uiPaneHelp:()=>CP,uiPaneIssues:()=>EP,uiPaneMapData:()=>TP,uiPanePreferences:()=>kP,uiPopover:()=>zb,uiPresetIcon:()=>O1,uiPresetList:()=>m_,uiRapidColorpicker:()=>W_,uiRapidFirstEditDialog:()=>kV,uiRestore:()=>K_,uiSection:()=>Ke,uiSectionBackgroundDisplayOptions:()=>x_,uiSectionBackgroundList:()=>C_,uiSectionBackgroundOffset:()=>A_,uiSectionChanges:()=>Xb,uiSectionColorSelection:()=>Cj,uiSectionColorblindModeOptions:()=>Aj,uiSectionDataLayers:()=>D_,uiSectionEntityIssues:()=>t_,uiSectionFeatureType:()=>r_,uiSectionMapFeatures:()=>M_,uiSectionMapInteractionOptions:()=>N_,uiSectionMapStyleOptions:()=>R_,uiSectionOverlayList:()=>E_,uiSectionPhotoOverlays:()=>F_,uiSectionPresetFields:()=>n_,uiSectionPrivacy:()=>B_,uiSectionRawMemberEditor:()=>i_,uiSectionRawMembershipEditor:()=>s_,uiSectionRawTagEditor:()=>mc,uiSectionSelectionList:()=>o_,uiSectionValidationIssues:()=>Pf,uiSectionValidationOptions:()=>T_,uiSectionValidationRules:()=>k_,uiSectionValidationStatus:()=>I_,uiSettingsCustomBackground:()=>S_,uiSettingsCustomData:()=>P_,uiSplash:()=>Z_,uiSuccess:()=>J_,uiTagReference:()=>Jo,uiToggle:()=>jb,uiTooltip:()=>de,uiWhatsNew:()=>ev,utilCmd:()=>Te,utilDetect:()=>Et,utilFetchResponse:()=>Ae,utilFunctor:()=>Wt,utilGetDimensions:()=>um,utilGetSetValue:()=>Ee,utilHighlightEntities:()=>Je,utilIsColorValid:()=>el,utilKeybinding:()=>Xe,utilNoAuto:()=>Oe,utilRebind:()=>xe,utilSetDimensions:()=>PM,utilSetTransform:()=>fa,utilTotalExtent:()=>Mt,utilTriggerEvent:()=>h2,validationAlmostJunction:()=>FP,validationAmbiguousCrossingTags:()=>NP,validationCloseNodes:()=>BP,validationCrossingWays:()=>OP,validationCurbNodes:()=>WP,validationDisconnectedWay:()=>LP,validationDuplicateWaySegments:()=>UP,validationFormatting:()=>GP,validationHelpRequest:()=>$P,validationImpossibleOneway:()=>zP,validationIncompatibleSource:()=>HP,validationMismatchedGeometry:()=>jP,validationMissingRole:()=>XP,validationMissingTag:()=>qP,validationOutdatedTags:()=>YP,validationPrivateData:()=>KP,validationSuspiciousName:()=>hD,validationUnsquareWay:()=>pD,validationYShapedConnection:()=>fD});function Yt(n){return function(e){return e.replace(n)}}var w6=Ot(GD(),1),hv=Ot(v6(),1),Rj=Object.defineProperty,Fj=(n,e,t)=>e in n?Rj(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Bj=(n,e,t)=>Fj(n,typeof e!="symbol"?e+"":e,t),Nj=[250,157,60,79,142,134,229,129,138,126,210,129,29,71,160,208];function $D(n,e){e=e||Nj;let r=new w6.default.ModeOfOperation.ctr(e).decrypt(w6.default.utils.hex.toBytes(n));return w6.default.utils.utf8.fromBytes(r)}function Kr(n,e){if(n===e)return!0;let t=n.length;if(t!==e.length)return!1;for(;t--;)if(n[t]!==e[t])return!1;return!0}function an(n,e){let t=new Set(e);return Array.from(new Set(n)).filter(r=>!t.has(r))}function bn(n,e){let t=new Set(e);return Array.from(new Set(n)).filter(r=>t.has(r))}function Ur(n,e){let t=new Set(n);return e.forEach(r=>t.add(r)),Array.from(t)}function Ge(n){return Array.from(new Set(n))}function ch(n,e){if(!e||e<0)return[n.slice()];let t=new Array(Math.ceil(n.length/e));return Array.from(t,(r,i)=>n.slice(i*e,i*e+e))}function hr(n,e){return n.reduce((t,r)=>{let i=typeof e=="function"?e(r):r[e];return(t[i]=t[i]||[]).push(r),t},{})}function q1(n,e){let t=new Set;return n.reduce((r,i)=>{let s=typeof e=="function"?e(i):i[e];return s&&!t.has(s)&&(t.add(s),r.push(i)),r},[])}function Ir(n,e){let t={};for(let[r,i]of Object.entries(n))e.includes(r)||(t[r]=i);return t}function pv(n){let e={};for(let[s,o]of Object.entries(n))s&&o!==void 0&&(e[s]=i(s,o));return e;function t(s){return/_hours|_times|:conditional$/.test(s)}function r(s){return/^(description|note|fixme|inscription)$/.test(s)}function i(s,o){if(r(s))return o;let a=o.split(";").map(l=>l.trim()).join(t(s)?"; ":";");return(s.indexOf("website")!==-1||s.indexOf("email")!==-1||a.indexOf("http")===0)&&(a=a.replace(/[\u200B-\u200F\uFEFF]/g,"")),a}}function Ht(n,e){let t=new Set,r=new Set;return n.forEach(i),Array.from(r);function i(s){if(t.has(s))return;t.add(s);let o=e.hasEntity(s);o&&(o.type==="node"?r.add(o):o.type==="way"?(o.nodes||[]).forEach(i):(o.members||[]).forEach(a=>i(a.id)))}}function ia(n,e){let t=[];return Ur(Object.keys(n),Object.keys(e)).sort().forEach(i=>{let s=n[i],o=e[i];(s||s==="")&&(o===void 0||o!==s)&&t.push({type:"-",key:i,oldVal:s,newVal:o,display:`- ${i}=${s}`}),(o||o==="")&&(s===void 0||o!==s)&&t.push({type:"+",key:i,oldVal:s,newVal:o,display:`+ ${i}=${o}`})}),t}function zD(n){let e=n?.tags??{};return Object.keys(e).map(t=>`${t}=${e[t]}`).join(", ")}function HD(n){globalThis.document||(globalThis.document=new Oj);let e;function t(){let i=new Date;i.setSeconds(i.getSeconds()+5),globalThis.document.cookie=n+"=1; expires="+i.toUTCString()+"; sameSite=strict"}return{lock:()=>e?!0:globalThis.document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+n+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")?!1:(t(),e=globalThis.setInterval(t,4e3),!0),unlock:()=>{e&&(globalThis.document.cookie=n+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; sameSite=strict",globalThis.clearInterval(e),e=null)},locked:()=>!!e}}var Oj=class{constructor(){Bj(this,"_cookies",new Map)}get cookie(){let n=[];for(let[e,t]of this._cookies)n.push(t!==void 0?`${e}=${t}`:e);return n.join(";")}set cookie(n){let e=n.split(";");for(let t of e){let[r,i]=t.split("=");this._cookies.set(r.trim(),i!==void 0?i.trim():void 0)}}};function S6(n,e){if(n=(0,hv.remove)(n.toLowerCase()),e=(0,hv.remove)(e.toLowerCase()),n.length===0)return e.length;if(e.length===0)return n.length;let t=[];for(let r=0;r<=e.length;r++)t[r]=[r];for(let r=0;r<=n.length;r++)t[0][r]=r;for(let r=1;r<=e.length;r++)for(let i=1;i<=n.length;i++)e.charAt(r-1)===n.charAt(i-1)?t[r][i]=t[r-1][i-1]:t[r][i]=Math.min(t[r-1][i-1]+1,Math.min(t[r][i-1]+1,t[r-1][i]+1));return t[e.length][n.length]}function uh(n){let e=0;if(n.length===0)return e;for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e}function ft(n,e){function t(r){return encodeURIComponent(r).replace(/(%2F|%3A|%2C|%7B|%7D)/g,decodeURIComponent)}return Object.keys(n).sort((r,i)=>{let s=/^map/.test(r),o=/^map/.test(i);return s&&!o?-1:o&&!s?1:r.localeCompare(i)}).map(r=>encodeURIComponent(r)+"="+(e?t(n[r]):encodeURIComponent(n[r]))).join("&")}function sa(n){let e=0;for(;e<n.length&&(n[e]==="?"||n[e]==="#");)e++;return n=n.slice(e),n.split("&").reduce((t,r)=>{let i=r.split("=");return i.length===2&&(t[i[0]]=decodeURIComponent(i[1])),t},{})}function mv(n){return Array.from(n).length}function C6(n,e){return Array.from(n).slice(0,e).join("")}function wc(n){return n.toLowerCase().replace(/[^a-z0-9]+/g,"_")}function xo(n){return"rapideditor-"+wc(n.toString())+"-"+new Date().getTime().toString()}function ns(n,e){var t=/^.*(_|:)?(description|name|note|website|ref|source|comment|watch|attribution)(_|:)?/,r=/^([+\-]?)(?=[\d.])/,i=/direction$/,s=/^turn:lanes:?/,o=[[/:right$/,":left"],[/:left$/,":right"],[/:forward$/,":backward"],[/:backward$/,":forward"],[/:right:/,":left:"],[/:left:/,":right:"],[/:forward:/,":backward:"],[/:backward:/,":forward:"]],a={left:"right",right:"left",up:"down",down:"up",forward:"backward",backward:"forward",forwards:"backward",backwards:"forward"},l={forward:"backward",backward:"forward",forwards:"backward",backwards:"forward"},c={yes:"-1",1:"-1","-1":"yes"},u={N:"S",NNE:"SSW",NE:"SW",ENE:"WSW",E:"W",ESE:"WNW",SE:"NW",SSE:"NNW",S:"N",SSW:"NNE",SW:"NE",WSW:"ENE",W:"E",WNW:"ESE",NW:"SE",NNW:"SSE"};function d(g){for(var y=0;y<o.length;++y){var x=o[y];if(x[0].test(g))return g.replace(x[0],x[1])}return g}function f(g,y,x){if(t.test(g)||s.test(g))return y;if(g==="incline"&&r.test(y))return y.replace(r,function(_,S){return S==="-"?"":"-"});if(e&&e.reverseOneway&&g==="oneway")return c[y]||y;if(x&&i.test(g)){if(u[y])return u[y];var b=parseFloat(y);if(typeof b=="number"&&!isNaN(b))return b<180?b+=180:b-=180,b.toString()}return a[y]||y}function h(g,y){for(var x=0;x<y.length;x++){var b=g.hasEntity(y[x]);if(!(!b||!Object.keys(b.tags).length)){var _={};for(var S in b.tags)_[d(S)]=f(S,b.tags[S],b.id===n);g=g.replace(b.update({tags:_}))}}return g}function p(g,y){var x=y.nodes.slice().reverse(),b={},_;for(var S in y.tags)b[d(S)]=f(S,y.tags[S]);return g.parentRelations(y).forEach(function(C){C.members.forEach(function(k,v){k.id===y.id&&(_=l[k.role])&&(C=C.updateMember({role:_},v),g=g.replace(C))})}),h(g,x).replace(y.update({nodes:x,tags:b}))}var m=function(g){var y=g.entity(n);return y.type==="way"?p(g,y):h(g,[n])};return m.disabled=function(g){var y=g.hasEntity(n);if(!y||y.type==="way")return!1;for(var x in y.tags){var b=y.tags[x];if(d(x)!==x||f(x,b,!0)!==b)return!1}return"nondirectional_node"},m.entityID=function(){return n},m}function Yn(n){return n!=="attribution"&&n!=="created_by"&&n!=="source"&&n!=="odbl"&&n.indexOf("source:")!==0&&n.indexOf("source_ref")!==0&&n.indexOf("tiger:")!==0}var Sc={};function A6(n){Sc=n}var oa={proposed:!0,planned:!0,construction:!0,disused:!0,abandoned:!0,was:!0,dismantled:!0,razed:!0,demolished:!0,destroyed:!0,removed:!0,obliterated:!0,intermittent:!0};function dh(n){let e=n.split(":");return e.length===1?n:e[0]in oa?n.slice(e[0].length+1):n}var WD={amenity:{bicycle_parking:!0},highway:{elevator:!0,rest_area:!0,services:!0},public_transport:{platform:!0},railway:{platform:!0,roundhouse:!0,station:!0,traverser:!0,turntable:!0,ventilation_shaft:!0,wash:!0},traffic_calming:{island:!0},waterway:{dam:!0}};function Xa(n){if(n.area==="yes")return{area:"yes"};if(n.area==="no")return null;var e={};for(var t in n){let r=dh(t);if(r in Sc&&!(n[t]in Sc[r])||r in WD&&n[t]in WD[r])return e[t]=n[t],e}return null}var Y1={};function E6(n){Y1=n}var K1={};function T6(n){K1=n}function qa(n){var e={};for(var t in n)if(Y1[t]&&(Y1[t]["*"]||Y1[t][n[t]])&&(e.point=!0),K1[t]&&(K1[t]["*"]||K1[t][n[t]])&&(e.vertex=!0),e.point&&e.vertex)break;return e}var Ya={aerialway:{chair_lift:!0,drag_lift:!0,"j-bar":!0,magic_carpet:!0,mixed_lift:!0,platter:!0,rope_tow:!0,"t-bar":!0,zip_line:!0},highway:{motorway:!0},junction:{circular:!0,roundabout:!0},man_made:{goods_conveyor:!0,"piste:halfpipe":!0},"piste:type":{downhill:!0,sled:!0,yes:!0},roller_coaster:{track:!0},"seamark:type":{"two-way_route":!0,recommended_traffic_lane:!0,separation_lane:!0,separation_roundabout:!0},waterway:{canal:!0,ditch:!0,drain:!0,fish_pass:!0,flowline:!0,pressurised:!0,river:!0,spillway:!0,stream:!0,tidal_channel:!0}},Cc={surface:{paved:!0,asphalt:!0,concrete:!0,chipseal:!0,"concrete:lanes":!0,"concrete:plates":!0},tracktype:{grade1:!0}},gv={surface:{cobblestone:!0,"cobblestone:flattened":!0,unhewn_cobblestone:!0,sett:!0,paving_stones:!0,metal:!0,wood:!0}},fh={natural:{cliff:!0,coastline:"coastline"},barrier:{retaining_wall:!0,kerb:!0,guard_rail:!0,city_wall:!0},man_made:{embankment:!0},waterway:{weir:!0}},is={motorway:!0,trunk:!0,primary:!0,secondary:!0,tertiary:!0,residential:!0,motorway_link:!0,trunk_link:!0,primary_link:!0,secondary_link:!0,tertiary_link:!0,unclassified:!0,road:!0,service:!0,track:!0,living_street:!0,bus_guideway:!0,busway:!0,path:!0,footway:!0,cycleway:!0,bridleway:!0,pedestrian:!0,corridor:!0,steps:!0},VD={runway:!0,taxiway:!0},Ns={path:!0,footway:!0,cycleway:!0,bridleway:!0,pedestrian:!0,corridor:!0,steps:!0},k6={rail:!0,light_rail:!0,tram:!0,subway:!0,monorail:!0,funicular:!0,miniature:!0,narrow_gauge:!0,disused:!0,preserved:!0},Q1={canal:!0,ditch:!0,drain:!0,fish_pass:!0,flowline:!0,river:!0,stream:!0,tidal_channel:!0};function Oi(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function Z1(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function I6(n){let e,t,r;n.length!==2?(e=Oi,t=(a,l)=>Oi(n(a),l),r=(a,l)=>n(a)-l):(e=n===Oi||n===Z1?n:Lj,t=n,r=n);function i(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{let d=c+u>>>1;t(a[d],l)<0?c=d+1:u=d}while(c<u)}return c}function s(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{let d=c+u>>>1;t(a[d],l)<=0?c=d+1:u=d}while(c<u)}return c}function o(a,l,c=0,u=a.length){let d=i(a,l,c,u-1);return d>c&&r(a[d-1],l)>-r(a[d],l)?d-1:d}return{left:i,center:o,right:s}}function Lj(){return 0}function P6(n){return n===null?NaN:+n}function*jD(n,e){if(e===void 0)for(let t of n)t!=null&&(t=+t)>=t&&(yield t);else{let t=-1;for(let r of n)(r=e(r,++t,n))!=null&&(r=+r)>=r&&(yield r)}}var XD=I6(Oi),qD=XD.right,Uj=XD.left,Gj=I6(P6).center,yv=qD;var Dn=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){let t=this._partials,r=0;for(let i=0;i<this._n&&i<32;i++){let s=t[i],o=e+s,a=Math.abs(e)<Math.abs(s)?e-(o-s):s-(o-e);a&&(t[r++]=a),e=o}return t[r]=e,this._n=r+1,this}valueOf(){let e=this._partials,t=this._n,r,i,s,o=0;if(t>0){for(o=e[--t];t>0&&(r=o,i=e[--t],o=r+i,s=i-(o-r),!s););t>0&&(s<0&&e[t-1]<0||s>0&&e[t-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}};function YD(n=Oi){if(n===Oi)return xv;if(typeof n!="function")throw new TypeError("compare is not a function");return(e,t)=>{let r=n(e,t);return r||r===0?r:(n(t,t)===0)-(n(e,e)===0)}}function xv(n,e){return(n==null||!(n>=n))-(e==null||!(e>=e))||(n<e?-1:n>e?1:0)}var $j=Math.sqrt(50),zj=Math.sqrt(10),Hj=Math.sqrt(2);function D6(n,e,t){let r=(e-n)/Math.max(0,t),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=$j?10:s>=zj?5:s>=Hj?2:1,a,l,c;return i<0?(c=Math.pow(10,-i)/o,a=Math.round(n*c),l=Math.round(e*c),a/c<n&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,i)*o,a=Math.round(n/c),l=Math.round(e/c),a*c<n&&++a,l*c>e&&--l),l<a&&.5<=t&&t<2?D6(n,e,t*2):[a,l,c]}function M6(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];let r=e<n,[i,s,o]=r?D6(e,n,t):D6(n,e,t);if(!(s>=i))return[];let a=s-i+1,l=new Array(a);if(r)if(o<0)for(let c=0;c<a;++c)l[c]=(s-c)/-o;else for(let c=0;c<a;++c)l[c]=(s-c)*o;else if(o<0)for(let c=0;c<a;++c)l[c]=(i+c)/-o;else for(let c=0;c<a;++c)l[c]=(i+c)*o;return l}function hh(n,e,t){return e=+e,n=+n,t=+t,D6(n,e,t)[2]}function bv(n,e,t){e=+e,n=+n,t=+t;let r=e<n,i=r?hh(e,n,t):hh(n,e,t);return(r?-1:1)*(i<0?1/-i:i)}function R6(n,e){let t;if(e===void 0)for(let r of n)r!=null&&(t<r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let i of n)(i=e(i,++r,n))!=null&&(t<i||t===void 0&&i>=i)&&(t=i)}return t}function F6(n,e){let t;if(e===void 0)for(let r of n)r!=null&&(t>r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let i of n)(i=e(i,++r,n))!=null&&(t>i||t===void 0&&i>=i)&&(t=i)}return t}function B6(n,e,t=0,r=1/0,i){if(e=Math.floor(e),t=Math.floor(Math.max(0,t)),r=Math.floor(Math.min(n.length-1,r)),!(t<=e&&e<=r))return n;for(i=i===void 0?xv:YD(i);r>t;){if(r-t>600){let l=r-t+1,c=e-t+1,u=Math.log(l),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(l-d)/l)*(c-l/2<0?-1:1),h=Math.max(t,Math.floor(e-c*d/l+f)),p=Math.min(r,Math.floor(e+(l-c)*d/l+f));B6(n,e,h,p,i)}let s=n[e],o=t,a=r;for(ph(n,t,e),i(n[r],s)>0&&ph(n,t,r);o<a;){for(ph(n,o,a),++o,--a;i(n[o],s)<0;)++o;for(;i(n[a],s)>0;)--a}i(n[t],s)===0?ph(n,t,a):(++a,ph(n,a,r)),a<=e&&(t=a+1),e<=a&&(r=a-1)}return n}function ph(n,e,t){let r=n[e];n[e]=n[t],n[t]=r}function _v(n,e,t){if(n=Float64Array.from(jD(n,t)),!(!(r=n.length)||isNaN(e=+e))){if(e<=0||r<2)return F6(n);if(e>=1)return R6(n);var r,i=(r-1)*e,s=Math.floor(i),o=R6(B6(n,s).subarray(0,s+1)),a=F6(n.subarray(s+1));return o+(a-o)*(i-s)}}function N6(n,e){return _v(n,.5,e)}var J1=1e-6,vv=1e-12,e2=Math.PI,mh=e2/2,wv=e2/4,O6=e2*2,Ac=180/e2,pr=e2/180,t2=Math.abs,KD=Math.atan,aa=Math.atan2,Pr=Math.cos;var QD=Math.exp;var L6=Math.hypot,ZD=Math.log;var Dr=Math.sin;var r2=Math.sqrt,JD=Math.tan;function gh(n){return n>1?mh:n<-1?-mh:Math.asin(n)}function Kn(){}function U6(n,e){n&&tM.hasOwnProperty(n.type)&&tM[n.type](n,e)}var eM={Feature:function(n,e){U6(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,r=-1,i=t.length;++r<i;)U6(t[r].geometry,e)}},tM={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)n=t[r],e.point(n[0],n[1],n[2])},LineString:function(n,e){Sv(n.coordinates,e,0)},MultiLineString:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)Sv(t[r],e,0)},Polygon:function(n,e){rM(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)rM(t[r],e)},GeometryCollection:function(n,e){for(var t=n.geometries,r=-1,i=t.length;++r<i;)U6(t[r],e)}};function Sv(n,e,t){var r=-1,i=n.length-t,s;for(e.lineStart();++r<i;)s=n[r],e.point(s[0],s[1],s[2]);e.lineEnd()}function rM(n,e){var t=-1,r=n.length;for(e.polygonStart();++t<r;)Sv(n[t],e,1);e.polygonEnd()}function Ka(n,e){n&&eM.hasOwnProperty(n.type)?eM[n.type](n,e):U6(n,e)}var yh=new Dn,G6=new Dn,nM,iM,Cv,Av,Ev,Os={point:Kn,lineStart:Kn,lineEnd:Kn,polygonStart:function(){yh=new Dn,Os.lineStart=Wj,Os.lineEnd=Vj},polygonEnd:function(){var n=+yh;G6.add(n<0?O6+n:n),this.lineStart=this.lineEnd=this.point=Kn},sphere:function(){G6.add(O6)}};function Wj(){Os.point=jj}function Vj(){sM(nM,iM)}function jj(n,e){Os.point=sM,nM=n,iM=e,n*=pr,e*=pr,Cv=n,Av=Pr(e=e/2+wv),Ev=Dr(e)}function sM(n,e){n*=pr,e*=pr,e=e/2+wv;var t=n-Cv,r=t>=0?1:-1,i=r*t,s=Pr(e),o=Dr(e),a=Ev*o,l=Av*s+a*Pr(i),c=a*r*Dr(i);yh.add(aa(c,l)),Cv=n,Av=s,Ev=o}function bo(n){return G6=new Dn,Ka(n,Os),G6*2}function oM(n){return[aa(n[1],n[0]),gh(n[2])]}function aM(n){var e=n[0],t=n[1],r=Pr(t);return[r*Pr(e),r*Dr(e),Dr(t)]}function Tv(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function lM(n){var e=r2(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=e,n[1]/=e,n[2]/=e}var Sr,fi,Mr,Ui,Ec,fM,hM,n2,xh,Qa,ca,la={point:kv,lineStart:cM,lineEnd:uM,polygonStart:function(){la.point=mM,la.lineStart=Xj,la.lineEnd=qj,xh=new Dn,Os.polygonStart()},polygonEnd:function(){Os.polygonEnd(),la.point=kv,la.lineStart=cM,la.lineEnd=uM,yh<0?(Sr=-(Mr=180),fi=-(Ui=90)):xh>J1?Ui=90:xh<-J1&&(fi=-90),ca[0]=Sr,ca[1]=Mr},sphere:function(){Sr=-(Mr=180),fi=-(Ui=90)}};function kv(n,e){Qa.push(ca=[Sr=n,Mr=n]),e<fi&&(fi=e),e>Ui&&(Ui=e)}function pM(n,e){var t=aM([n*pr,e*pr]);if(n2){var r=Tv(n2,t),i=[r[1],-r[0],0],s=Tv(i,r);lM(s),s=oM(s);var o=n-Ec,a=o>0?1:-1,l=s[0]*Ac*a,c,u=t2(o)>180;u^(a*Ec<l&&l<a*n)?(c=s[1]*Ac,c>Ui&&(Ui=c)):(l=(l+360)%360-180,u^(a*Ec<l&&l<a*n)?(c=-s[1]*Ac,c<fi&&(fi=c)):(e<fi&&(fi=e),e>Ui&&(Ui=e))),u?n<Ec?Li(Sr,n)>Li(Sr,Mr)&&(Mr=n):Li(n,Mr)>Li(Sr,Mr)&&(Sr=n):Mr>=Sr?(n<Sr&&(Sr=n),n>Mr&&(Mr=n)):n>Ec?Li(Sr,n)>Li(Sr,Mr)&&(Mr=n):Li(n,Mr)>Li(Sr,Mr)&&(Sr=n)}else Qa.push(ca=[Sr=n,Mr=n]);e<fi&&(fi=e),e>Ui&&(Ui=e),n2=t,Ec=n}function cM(){la.point=pM}function uM(){ca[0]=Sr,ca[1]=Mr,la.point=kv,n2=null}function mM(n,e){if(n2){var t=n-Ec;xh.add(t2(t)>180?t+(t>0?360:-360):t)}else fM=n,hM=e;Os.point(n,e),pM(n,e)}function Xj(){Os.lineStart()}function qj(){mM(fM,hM),Os.lineEnd(),t2(xh)>J1&&(Sr=-(Mr=180)),ca[0]=Sr,ca[1]=Mr,n2=null}function Li(n,e){return(e-=n)<0?e+360:e}function Yj(n,e){return n[0]-e[0]}function dM(n,e){return n[0]<=n[1]?n[0]<=e&&e<=n[1]:e<n[0]||n[1]<e}function Iv(n){var e,t,r,i,s,o,a;if(Ui=Mr=-(Sr=fi=1/0),Qa=[],Ka(n,la),t=Qa.length){for(Qa.sort(Yj),e=1,r=Qa[0],s=[r];e<t;++e)i=Qa[e],dM(r,i[0])||dM(r,i[1])?(Li(r[0],i[1])>Li(r[0],r[1])&&(r[1]=i[1]),Li(i[0],r[1])>Li(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(o=-1/0,t=s.length-1,e=0,r=s[t];e<=t;r=i,++e)i=s[e],(a=Li(r[1],i[0]))>o&&(o=a,Sr=i[0],Mr=r[1])}return Qa=ca=null,Sr===1/0||fi===1/0?[[NaN,NaN],[NaN,NaN]]:[[Sr,fi],[Mr,Ui]]}var bh,$6,z6,H6,W6,V6,j6,X6,Pv,Dv,Mv,xM,bM,Qn,Zn,Jn,Ls={sphere:Kn,point:Rv,lineStart:gM,lineEnd:yM,polygonStart:function(){Ls.lineStart=Zj,Ls.lineEnd=Jj},polygonEnd:function(){Ls.lineStart=gM,Ls.lineEnd=yM}};function Rv(n,e){n*=pr,e*=pr;var t=Pr(e);_h(t*Pr(n),t*Dr(n),Dr(e))}function _h(n,e,t){++bh,z6+=(n-z6)/bh,H6+=(e-H6)/bh,W6+=(t-W6)/bh}function gM(){Ls.point=Kj}function Kj(n,e){n*=pr,e*=pr;var t=Pr(e);Qn=t*Pr(n),Zn=t*Dr(n),Jn=Dr(e),Ls.point=Qj,_h(Qn,Zn,Jn)}function Qj(n,e){n*=pr,e*=pr;var t=Pr(e),r=t*Pr(n),i=t*Dr(n),s=Dr(e),o=aa(r2((o=Zn*s-Jn*i)*o+(o=Jn*r-Qn*s)*o+(o=Qn*i-Zn*r)*o),Qn*r+Zn*i+Jn*s);$6+=o,V6+=o*(Qn+(Qn=r)),j6+=o*(Zn+(Zn=i)),X6+=o*(Jn+(Jn=s)),_h(Qn,Zn,Jn)}function yM(){Ls.point=Rv}function Zj(){Ls.point=eX}function Jj(){_M(xM,bM),Ls.point=Rv}function eX(n,e){xM=n,bM=e,n*=pr,e*=pr,Ls.point=_M;var t=Pr(e);Qn=t*Pr(n),Zn=t*Dr(n),Jn=Dr(e),_h(Qn,Zn,Jn)}function _M(n,e){n*=pr,e*=pr;var t=Pr(e),r=t*Pr(n),i=t*Dr(n),s=Dr(e),o=Zn*s-Jn*i,a=Jn*r-Qn*s,l=Qn*i-Zn*r,c=L6(o,a,l),u=gh(c),d=c&&-u/c;Pv.add(d*o),Dv.add(d*a),Mv.add(d*l),$6+=u,V6+=u*(Qn+(Qn=r)),j6+=u*(Zn+(Zn=i)),X6+=u*(Jn+(Jn=s)),_h(Qn,Zn,Jn)}function Fv(n){bh=$6=z6=H6=W6=V6=j6=X6=0,Pv=new Dn,Dv=new Dn,Mv=new Dn,Ka(n,Ls);var e=+Pv,t=+Dv,r=+Mv,i=L6(e,t,r);return i<vv&&(e=V6,t=j6,r=X6,$6<J1&&(e=z6,t=H6,r=W6),i=L6(e,t,r),i<vv)?[NaN,NaN]:[aa(t,e)*Ac,gh(r/i)*Ac]}var Bv,Nv,q6,Y6,i2={sphere:Kn,point:Kn,lineStart:tX,lineEnd:Kn,polygonStart:Kn,polygonEnd:Kn};function tX(){i2.point=nX,i2.lineEnd=rX}function rX(){i2.point=i2.lineEnd=Kn}function nX(n,e){n*=pr,e*=pr,Nv=n,q6=Dr(e),Y6=Pr(e),i2.point=iX}function iX(n,e){n*=pr,e*=pr;var t=Dr(e),r=Pr(e),i=t2(n-Nv),s=Pr(i),o=Dr(i),a=r*o,l=Y6*t-q6*r*s,c=q6*t+Y6*r*s;Bv.add(aa(r2(a*a+l*l),c)),Nv=n,q6=t,Y6=r}function Ov(n){return Bv=new Dn,Ka(n,i2),+Bv}function K6(n,e){return[n,ZD(JD((mh+e)/2))]}K6.invert=function(n,e){return[n,2*KD(QD(e))-mh]};function Q6(n){for(var e=-1,t=n.length,r,i=n[t-1],s=0;++e<t;)r=i,i=n[e],s+=r[1]*i[0]-r[0]*i[1];return s/2}function hi(n){for(var e=-1,t=n.length,r=0,i=0,s,o=n[t-1],a,l=0;++e<t;)s=o,o=n[e],l+=a=s[0]*o[1]-o[0]*s[1],r+=(s[0]+o[0])*a,i+=(s[1]+o[1])*a;return l*=3,[r/l,i/l]}function vM(n,e,t){return(e[0]-n[0])*(t[1]-n[1])-(e[1]-n[1])*(t[0]-n[0])}function sX(n,e){return n[0]-e[0]||n[1]-e[1]}function wM(n){let e=n.length,t=[0,1],r=2,i;for(i=2;i<e;++i){for(;r>1&&vM(n[t[r-2]],n[t[r-1]],n[i])<=0;)--r;t[r++]=i}return t.slice(0,r)}function pi(n){if((t=n.length)<3)return null;var e,t,r=new Array(t),i=new Array(t);for(e=0;e<t;++e)r[e]=[+n[e][0],+n[e][1],e];for(r.sort(sX),e=0;e<t;++e)i[e]=[r[e][0],-r[e][1]];var s=wM(r),o=wM(i),a=o[0]===s[0],l=o[o.length-1]===s[s.length-1],c=[];for(e=s.length-1;e>=0;--e)c.push(n[r[s[e]][2]]);for(e=+a;e<o.length-l;++e)c.push(n[r[o[e]][2]]);return c}var oX=Object.defineProperty,aX=(n,e,t)=>e in n?oX(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,mi=(n,e,t)=>aX(n,typeof e!="symbol"?e+"":e,t),Kt=2*Math.PI,Mn=Math.PI/180,Tc=180/Math.PI,Us=Math.PI/2,lX=0,cX=24,Z6=256*Math.pow(2,lX)/Kt,J6=256*Math.pow(2,cX)/Kt,AM=2*Math.atan(Math.exp(Math.PI))-Us,uX=-AM,em=6378137,tm=6356752314245179e-9;function a2(n){return n*(Kt*tm/360)}function Za(n,e){return Math.abs(e)>=90?0:n*(Kt*em/360)*Math.abs(Math.cos(e*Mn))}function Gi(n){return n/(Kt*tm/360)}function Gr(n,e){return Math.abs(e)>=90?0:n/(Kt*em/360)/Math.abs(Math.cos(e*Mn))}function rm(n,e=256){return[n[0]*e/(Kt*em),-n[1]*e/(Kt*tm)]}function nm(n,e=256){return[n[0]*Kt*em/e,-n[1]*Kt*tm/e]}function ht(n,e){let t=Za(n[0]-e[0],(n[1]+e[1])/2),r=a2(n[1]-e[1]);return Math.sqrt(t*t+r*r)}function l2(n,e=256){let t=Math.log(e)*Math.LOG2E;return Math.log(n*Kt)/Math.LN2-t}function gi(n,e=256){return e*Math.pow(2,n)/Kt}function im(n,e){let t=1/0,r;for(let i=0;i<n.length;i++){let s=ht(n[i],e);s<t&&(t=s,r=i)}return r!==void 0?{index:r,distance:t,point:n[r]}:null}var le=class ua{constructor(e,t){mi(this,"min",[1/0,1/0]),mi(this,"max",[-1/0,-1/0]);let r;e instanceof ua?(r=e.min,t=e.max):r=e,r&&r.length===2&&(this.min[0]=r[0],this.min[1]=r[1],t||(t=r)),t&&t.length===2&&(this.max[0]=t[0],this.max[1]=t[1])}equals(e){return this.min[0]===e.min[0]&&this.min[1]===e.min[1]&&this.max[0]===e.max[0]&&this.max[1]===e.max[1]}area(){return Math.abs((this.max[0]-this.min[0])*(this.max[1]-this.min[1]))}center(){return[(this.min[0]+this.max[0])/2,(this.min[1]+this.max[1])/2]}rectangle(){return[this.min[0],this.min[1],this.max[0],this.max[1]]}toParam(){return this.rectangle().join(",")}bbox(){return{minX:this.min[0],minY:this.min[1],maxX:this.max[0],maxY:this.max[1]}}polygon(){return[[this.min[0],this.min[1]],[this.min[0],this.max[1]],[this.max[0],this.max[1]],[this.max[0],this.min[1]],[this.min[0],this.min[1]]]}contains(e){return e.min[0]>=this.min[0]&&e.min[1]>=this.min[1]&&e.max[0]<=this.max[0]&&e.max[1]<=this.max[1]}intersects(e){return e.min[0]<=this.max[0]&&e.min[1]<=this.max[1]&&e.max[0]>=this.min[0]&&e.max[1]>=this.min[1]}intersection(e){return this.intersects(e)?new ua([Math.max(e.min[0],this.min[0]),Math.max(e.min[1],this.min[1])],[Math.min(e.max[0],this.max[0]),Math.min(e.max[1],this.max[1])]):new ua}percentContainedIn(e){let t=this.intersection(e).area(),r=this.area();return t===1/0||r===1/0?0:t===0||r===0?e.contains(this)?1:0:t/r}extend(e){return e instanceof ua?new ua([Math.min(e.min[0],this.min[0]),Math.min(e.min[1],this.min[1])],[Math.max(e.max[0],this.max[0]),Math.max(e.max[1],this.max[1])]):new ua([Math.min(e[0],this.min[0]),Math.min(e[1],this.min[1])],[Math.max(e[0],this.max[0]),Math.max(e[1],this.max[1])])}extendSelf(e){return e instanceof ua?(this.min=[Math.min(e.min[0],this.min[0]),Math.min(e.min[1],this.min[1])],this.max=[Math.max(e.max[0],this.max[0]),Math.max(e.max[1],this.max[1])]):(this.min=[Math.min(e[0],this.min[0]),Math.min(e[1],this.min[1])],this.max=[Math.max(e[0],this.max[0]),Math.max(e[1],this.max[1])]),this}padByMeters(e){let t=Gi(e),r=Gr(e,this.center()[1]);return new ua([this.min[0]-r,this.min[1]-t],[this.max[0]+r,this.max[1]+t])}};function dt(n,e,t){return Math.max(e,Math.min(n,t))}function Qt(n,e,t){let r=t-e;return((n-e)%r+r)%r+e}var dX=class{constructor(n){mi(this,"x",0),mi(this,"y",0),mi(this,"k",256/Math.PI),mi(this,"r",0),mi(this,"_v",1),n&&(this.props=n)}get v(){return this._v}set v(n){this._v=n}get translation(){return[this.x,this.y]}set translation(n){this.props={x:n[0],y:n[1]}}get scale(){return this.k}set scale(n){this.props={k:n}}get zoom(){return l2(this.k)}set zoom(n){this.props={k:gi(+n)}}get rotation(){return this.r}set rotation(n){this.props={r:n}}get props(){return{x:this.x,y:this.y,k:this.k,r:this.r}}set props(n){let e=!1;if(n.x!==void 0&&n.x!==null){let t=+n.x;!isNaN(t)&&isFinite(t)&&this.x!==t&&(this.x=t,e=!0)}if(n.y!==void 0&&n.y!==null){let t=+n.y;!isNaN(t)&&isFinite(t)&&this.y!==t&&(this.y=t,e=!0)}if(n.k!==void 0&&n.k!==null){let t=+n.k;!isNaN(t)&&isFinite(t)&&(t=dt(t,Z6,J6),this.k!==t&&(this.k=t,e=!0))}if(n.r!==void 0&&n.r!==null){let t=+n.r;!isNaN(t)&&isFinite(t)&&(t=Qt(t,0,Kt),this.r!==t&&(this.r=t,e=!0))}e&&this.v++}};function He(n,e,t){return t?Math.abs(n[0]-e[0])<=t&&Math.abs(n[1]-e[1])<=t:n[0]===e[0]&&n[1]===e[1]}function bt(n,e){return[n[0]+e[0],n[1]+e[1]]}function Me(n,e){return[n[0]-e[0],n[1]-e[1]]}function yi(n,e){return[n[0]*e,n[1]*e]}function lr(n,e,t){let r=Me(n,t);return[r[0]*Math.cos(e)-r[1]*Math.sin(e)+t[0],r[0]*Math.sin(e)+r[1]*Math.cos(e)+t[1]]}function SM(n){return[Math.ceil(n[0]),Math.ceil(n[1])]}function at(n,e,t){return[n[0]+(e[0]-n[0])*t,n[1]+(e[1]-n[1])*t]}function Ne(n,e=[0,0]){let t=n[0]-e[0],r=n[1]-e[1];return Math.sqrt(t*t+r*r)}function Uv(n,e=[0,0]){let t=n[0]-e[0],r=n[1]-e[1];return t*t+r*r}function o2(n){let e=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return e!==0?yi(n,1/e):[0,0]}function sr(n,e){return Math.atan2(e[1]-n[1],e[0]-n[0])}function ss(n,e,t){t=t||[0,0];let r=Me(n,t),i=Me(e,t);return r[0]*i[0]+r[1]*i[1]}function sm(n,e,t){t=t||[0,0];let r=o2(Me(n,t)),i=o2(Me(e,t));return ss(r,i)}function vh(n,e,t){t=t||[0,0];let r=Me(n,t),i=Me(e,t);return r[0]*i[1]-r[1]*i[0]}function EM(n,e){let t=1/0,r,i;for(let s=0;s<e.length-1;s++){let o=e[s],a=Me(e[s+1],o),l=Me(n,o),c=ss(l,a)/ss(a,a),u;c<0?u=o:c>1?u=e[s+1]:u=[o[0]+c*a[0],o[1]+c*a[1]];let d=Ne(u,n);d<t&&(t=d,r=s+1,i=u)}return r!==void 0&&i!==void 0?{index:r,distance:t,target:i}:null}var Rn=class{constructor(n,e){mi(this,"_transform",new dX),mi(this,"_dimensions",[0,0]),mi(this,"_v",1),n&&(this.transform=n),e&&(this.dimensions=e)}get v(){return this._v+this._transform.v}set v(n){this._v=n-this._transform.v}project(n,e){let{x:t,y:r,k:i,r:s}=this._transform,o=n[0]*Mn,a=dt(n[1]*Mn,uX,AM),l=o,c=Math.log(Math.tan((Us+a)/2)),u=[l*i+t,r-c*i];return e&&s?lr(u,s,this.center()):u}unproject(n,e){let{x:t,y:r,k:i,r:s}=this._transform;e&&s&&(n=lr(n,-s,this.center()));let o=(n[0]-t)/i,a=dt((r-n[1])/i,-Math.PI,Math.PI),l=o,c=2*Math.atan(Math.exp(a))-Us;return[l*Tc,c*Tc]}set transform(n){this._transform.props=n}get transform(){return this._transform}set dimensions(n){let[e,t]=SM([+n[0],+n[1]]);!isNaN(e)&&isFinite(e)&&!isNaN(t)&&isFinite(t)&&(this._dimensions[0]!==e||this._dimensions[1]!==t)&&(this._dimensions=[e,t],this.v++)}get dimensions(){return this._dimensions}center(){return yi(this._dimensions,.5)}centerLoc(){return this.unproject(this.center())}visiblePolygon(){let[n,e]=this._dimensions,t=Qt(this._transform.r,0,Kt);if(t){let r=Math.abs(Math.sin(t)),i=Math.abs(Math.cos(t)),s=n*r,o=e*i,a=s*r,l=s*i,c=o*r,u=o*i,d,f,h,p;return t>0&&t<=Us?(d=[a,-l],f=[-c,u],h=[n-a,e+l],p=[n+c,e-u]):t>Us&&t<=Math.PI?(d=[n+c,u],f=[n-a,-l],h=[-c,e-u],p=[a,e+l]):t>Math.PI&&t<=3*Us?(d=[n-a,e+l],f=[n+c,e-u],h=[a,-l],p=[-c,u]):(d=[-c,e-u],f=[a,e+l],h=[n+c,u],p=[n-a,-l]),[d,f,h,p,d]}else return[[0,0],[0,e],[n,e],[n,0],[0,0]]}visibleDimensions(){let[n,e]=this._dimensions,t=this._transform.r;if(t){let r=Math.abs(Math.sin(t)),i=Math.abs(Math.cos(t)),s=n*i+e*r,o=e*i+n*r;return SM([s,o])}else return[n,e]}visibleExtent(){let n=this.visiblePolygon(),e=this.unproject(n[1],!0),t=this.unproject(n[3],!0);return new le(e,t)}};function TM(n,e){return n[0]===e[0]&&n[1]===e[1]||n[0]===e[1]&&n[1]===e[0]}function _o(n,e,t){let r=new Array(n.length);for(let i=0;i<n.length;i++)r[i]=lr(n[i],e,t);return r}function da(n,e){if(n.length!==2||e.length!==2)return null;let t=[n[0][0],n[0][1]],r=[n[1][0],n[1][1]],i=[e[0][0],e[0][1]],s=[e[1][0],e[1][1]],o=Me(r,t),a=Me(s,i),l=vh(Me(i,t),o),c=vh(o,a);if(l&&c){let u=l/c,d=vh(Me(i,t),a)/c;if(d>=0&&d<=1&&u>=0&&u<=1)return at(t,r,d)}return null}function om(n,e){let t=[];for(let r=0;r<n.length-1;r++)for(let i=0;i<e.length-1;i++){let s=[n[r],n[r+1]],o=[e[i],e[i+1]],a=da(s,o);a&&t.push(a)}return t}function Lv(n,e){for(let t=0;t<n.length-1;t++)for(let r=0;r<e.length-1;r++){let i=[n[t],n[t+1]],s=[e[r],e[r+1]];if(da(i,s))return!0}return!1}function c2(n,e){let[t,r]=n,i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){let[a,l]=e[s],[c,u]=e[o];l>r!=u>r&&t<(c-a)*(r-l)/(u-l)+a&&(i=!i)}return i}function u2(n,e){return e.every(t=>c2(t,n))}function s2(n,e,t){function r(i,s){return s.some(o=>c2(o,i))}return r(n,e)||!!t&&Lv(n,e)}function d2(n){let e=pi(n);if(!e)return null;let t=hi(e),r=1/0,i=new le,s=0,o=e[0];for(let a=0;a<=e.length-1;a++){let l=a===e.length-1?e[0]:e[a+1],c=Math.atan2(l[1]-o[1],l[0]-o[0]),d=_o(e,-c,t).reduce((h,p)=>(h.min[0]=Math.min(h.min[0],p[0]),h.min[1]=Math.min(h.min[1],p[1]),h.max[0]=Math.max(h.max[0],p[0]),h.max[1]=Math.max(h.max[1],p[1]),h),new le),f=d.area();f<r&&(r=f,i=d,s=c),o=l}return{poly:_o(i.polygon(),s,t),angle:s}}function Gv(n){let e=0;for(let t=0;t<n.length-1;t++)e+=Ne(n[t],n[t+1]);return e}function CM(n,e){return Array.from(Array(1+e-n).keys()).map(t=>n+t)}var or=class kM{constructor(){mi(this,"_tileSize",256),mi(this,"_zoomRange",[0,24]),mi(this,"_margin",0),mi(this,"_skipNullIsland",!1)}getTiles(e){let t=this._tileSize,r=this._margin*t,i=e.transform.props,[s,o]=e.dimensions,a=e.visiblePolygon(),l=[[0,0],[0,o],[s,o],[s,0],[0,0]],c=A(l,r);if(i.r){let E=e.center();l=_o(l,-i.r,E),c=_o(c,-i.r,E),a=_o(a,-i.r,E)}r&&(a=A(a,r));let u=i.k*Math.PI,d=[u-i.x,u-i.y];for(let E=0;E<5;E++)a[E]=bt(d,a[E]),l[E]=bt(d,l[E]),c[E]=bt(d,c[E]);let f=a[0],h=a[2],p=l2(i.k,t),m=dt(Math.round(p),this._zoomRange[0],this._zoomRange[1]),g=0,y=Math.pow(2,m)-1,x=Math.log(t)*Math.LOG2E,b=Math.pow(2,p-m+x),_=CM(dt(Math.floor(f[0]/b),g,y),dt(Math.floor(h[0]/b),g,y)),S=CM(dt(Math.floor(f[1]/b),g,y),dt(Math.floor(h[1]/b),g,y)),C=Math.pow(2,m)/2*t,k=gi(m,t),v=new Rn({x:C,y:C,k}),w=[];for(let E of S)for(let I of _){if(this._skipNullIsland&&kM.isNearNullIsland(I,E,m))continue;let M=[I*b,E*b],T=[(I+1)*b,(E+1)*b],R=new le(M,T),P=R.polygon(),D=s2(c,P,!1)||s2(P,c,!1);if(!D&&i.r!==0&&(D=Lv(c,P)),!D)continue;let N=s2(l,P,!1)||s2(P,l,!1);!N&&i.r!==0&&(N=Lv(l,P));let F=[I*t,E*t],B=[(I+1)*t,(E+1)*t],O=v.unproject([F[0],B[1]]),G=v.unproject([B[0],F[1]]),U=[I,E,m],W={id:U.toString(),xyz:U,pxExtent:R,wgs84Extent:new le(O,G),isVisible:N};N?w.unshift(W):w.push(W)}return{tiles:w};function A(E,I){return[[E[0][0]-I,E[0][1]-I],[E[1][0]-I,E[1][1]+I],[E[2][0]+I,E[2][1]+I],[E[3][0]+I,E[3][1]-I],[E[4][0]-I,E[4][1]-I]]}}getGeoJSON(e){return{type:"FeatureCollection",features:e.tiles.map(r=>({type:"Feature",properties:{id:r.id,name:r.id},geometry:{type:"Polygon",coordinates:[r.wgs84Extent.polygon()]}}))}}tileSize(e){return e===void 0?this._tileSize:(this._tileSize=e,this)}zoomRange(e,t){return e===void 0?this._zoomRange:(t===void 0&&(t=e),this._zoomRange=[e,t],this)}margin(e){return e===void 0?this._margin:(this._margin=+e,this)}skipNullIsland(e){return e===void 0?this._skipNullIsland:(this._skipNullIsland=e,this)}static isNearNullIsland(e,t,r){if(r>=7){let i=Math.pow(2,r-1),s=Math.pow(2,r-6),o=i-s/2,a=i+s/2-1;return e>=o&&e<=a&&t>=o&&t<=a}return!1}};var fX=0;function me(n){if(!(this instanceof me))return n&&n.type?me[n.type].apply(this,arguments):n&&n.id?me[me.id.type(n.id)].apply(this,arguments):new me().initialize(arguments)}me.id=function(n){return me.id.fromOSM(n,me.id.next[n]--)};me.id.next={changeset:-1,node:-1,way:-1,relation:-1};me.id.fromOSM=function(n,e){return n[0]+e};me.id.toOSM=function(n){return n.slice(1)};me.id.type=function(n){return{c:"changeset",n:"node",w:"way",r:"relation"}[n[0]]};me.key=function(n){return n.id+"v"+(n.v||0)};var f2;me.deprecatedTagValuesByKey=function(n){return f2||(f2={},n.forEach(function(e){var t=Object.keys(e.old);if(t.length===1){var r=t[0],i=e.old[r];i!=="*"&&(f2[r]?f2[r].push(i):f2[r]=[i])}})),f2};me.prototype={tags:{},initialize:function(n){for(var e=0;e<n.length;++e){var t=n[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t[r]===void 0?delete this[r]:this[r]=t[r])}return!this.id&&this.type&&(this.id=me.id(this.type)),this.hasOwnProperty("visible")||(this.visible=!0),this},copy:function(n,e){if(e[this.id])return e[this.id];var t=me(this,{id:void 0,user:void 0,version:void 0,v:void 0});return e[this.id]=t,t},osmId:function(){return me.id.toOSM(this.id)},isNew:function(){return this.osmId()<0},update:function(n){return me(this,n).touch()},touch:function(){return this.v=fX++,this},mergeTags:function(n){var e=Object.assign({},this.tags),t=!1;for(var r in n){var i=e[r],s=n[r];if(!i)t=!0,e[r]=s;else if(r==="building"){if(s==="yes")continue;i==="yes"&&(t=!0,e[r]=s)}else i!==s&&(t=!0,e[r]=C6(Ur(i.split(/;\s*/),s.split(/;\s*/)).join(";"),255))}return t?this.update({tags:e}):this},intersects:function(n,e){return this.extent(e).intersects(n)},hasNonGeometryTags:function(){return Object.keys(this.tags).some(function(n){return n!=="area"})},hasParentRelations:function(n){return n.parentRelations(this).length>0},hasInterestingTags:function(){return Object.keys(this.tags).some(Yn)},isHighwayIntersection:function(){return!1},isDegenerate:function(){return!0},deprecatedTags:function(n){var e=this.tags;if(Object.keys(e).length===0)return[];var t=[];return n.forEach(function(r){var i=Object.keys(r.old);if(r.replace){var s=Object.keys(r.replace).some(function(a){if(!e[a]||r.old[a])return!1;var l=r.replace[a];return!(l==="*"||l===e[a])});if(s)return}var o=i.every(function(a){if(!e[a])return!1;if(r.old[a]==="*"||r.old[a]===e[a])return!0;var l=e[a].split(";").filter(Boolean);if(l.length===0)return!1;if(l.length>1)return l.indexOf(r.old[a])!==-1;if(e[a]===r.old[a])if(r.replace&&r.old[a]===r.replace[a]){var c=Object.keys(r.replace);return!c.every(function(u){return e[u]===r.replace[u]})}else return!0;return!1});o&&t.push(r)}),t}};function am(n){if(n.type!=="way"||!n.tags.highway)return null;var e=n.tags,t=n.isOneWay(),r=hX(e,t),i=pX(e),s=mX(e,t,r),o=s.forward,a=s.backward,l=s.bothways,c={};c.unspecified=$v(e["turn:lanes"]),c.forward=$v(e["turn:lanes:forward"]),c.backward=$v(e["turn:lanes:backward"]);var u={};u.unspecified=zv(e["maxspeed:lanes"],i),u.forward=zv(e["maxspeed:lanes:forward"],i),u.backward=zv(e["maxspeed:lanes:backward"],i);var d={};d.unspecified=ei(e["psv:lanes"]),d.forward=ei(e["psv:lanes:forward"]),d.backward=ei(e["psv:lanes:backward"]);var f={};f.unspecified=ei(e["bus:lanes"]),f.forward=ei(e["bus:lanes:forward"]),f.backward=ei(e["bus:lanes:backward"]);var h={};h.unspecified=ei(e["taxi:lanes"]),h.forward=ei(e["taxi:lanes:forward"]),h.backward=ei(e["taxi:lanes:backward"]);var p={};p.unspecified=ei(e["hov:lanes"]),p.forward=ei(e["hov:lanes:forward"]),p.backward=ei(e["hov:lanes:backward"]);var m={};m.unspecified=ei(e["hgv:lanes"]),m.forward=ei(e["hgv:lanes:forward"]),m.backward=ei(e["hgv:lanes:backward"]);var g={};g.unspecified=Hv(e["bicycleway:lanes"]),g.forward=Hv(e["bicycleway:lanes:forward"]),g.backward=Hv(e["bicycleway:lanes:backward"]);var y={forward:[],backward:[],unspecified:[]};return Ja(y,c,"turnLane"),Ja(y,u,"maxspeed"),Ja(y,d,"psv"),Ja(y,f,"bus"),Ja(y,h,"taxi"),Ja(y,p,"hov"),Ja(y,m,"hgv"),Ja(y,g,"bicycleway"),{metadata:{count:r,oneway:t,forward:o,backward:a,bothways:l,turnLanes:c,maxspeed:i,maxspeedLanes:u,psvLanes:d,busLanes:f,taxiLanes:h,hovLanes:p,hgvLanes:m,bicyclewayLanes:g},lanes:y}}function hX(n,e){var t;if(n.lanes&&(t=parseInt(n.lanes,10),t>0))return t;switch(n.highway){case"trunk":case"motorway":t=e?2:4;break;default:t=e?1:2;break}return t}function pX(n){var e=n.maxspeed;if(e){var t=/^([0-9][\.0-9]+?)(?:[ ]?(?:km\/h|kmh|kph|mph|knots))?$/;if(t.test(e))return parseInt(e,10)}}function mX(n,e,t){var r=parseInt(n["lanes:forward"],10),i=parseInt(n["lanes:backward"],10),s=parseInt(n["lanes:both_ways"],10)>0?1:0;return parseInt(n.oneway,10)===-1?(r=0,s=0,i=t):e?(r=t,s=0,i=0):isNaN(r)&&isNaN(i)?(i=Math.floor((t-s)/2),r=t-s-i):isNaN(r)?(i>t-s&&(i=t-s),r=t-s-i):isNaN(i)&&(r>t-s&&(r=t-s),i=t-s-r),{forward:r,backward:i,bothways:s}}function $v(n){if(n){var e=["left","slight_left","sharp_left","through","right","slight_right","sharp_right","reverse","merge_to_left","merge_to_right","none"];return n.split("|").map(function(t){return t===""&&(t="none"),t.split(";").map(function(r){return e.indexOf(r)===-1?"unknown":r})})}}function zv(n,e){if(n)return n.split("|").map(function(t){if(t==="none")return t;var r=parseInt(t,10);return t===""||r===e?null:isNaN(r)?"unknown":r})}function ei(n){if(n){var e=["yes","no","designated"];return n.split("|").map(function(t){return t===""&&(t="no"),e.indexOf(t)===-1?"unknown":t})}}function Hv(n){if(n){var e=["yes","no","designated","lane"];return n.split("|").map(function(t){return t===""&&(t="no"),e.indexOf(t)===-1?"unknown":t})}}function Ja(n,e,t){e.forward&&e.forward.forEach(function(r,i){n.forward[i]||(n.forward[i]={}),n.forward[i][t]=r}),e.backward&&e.backward.forEach(function(r,i){n.backward[i]||(n.backward[i]={}),n.backward[i][t]=r}),e.unspecified&&e.unspecified.forEach(function(r,i){n.unspecified[i]||(n.unspecified[i]={}),n.unspecified[i][t]=r})}var wt;function Et(n){if(wt&&!n)return wt;wt={};let e=navigator.userAgent,t=null;t=e.match(/(edg)\/?\s*(\.?\d+(\.\d+)*)/i),t!==null&&(wt.browser="Edge",wt.version=t[2]),wt.browser||(t=e.match(/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/i),t!==null&&(wt.browser="msie",wt.version=t[1])),wt.browser||(t=e.match(/(opr)\/?\s*(\.?\d+(\.\d+)*)/i),t!==null&&(wt.browser="Opera",wt.version=t[2])),wt.browser||(t=e.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),t!==null&&(wt.browser=t[1],wt.version=t[2],t=e.match(/version\/([\.\d]+)/i),t!==null&&(wt.version=t[1]))),wt.browser||(wt.browser=navigator.appName,wt.version=navigator.appVersion),wt.version=wt.version.split(/\W/).slice(0,2).join("."),wt.browser.toLowerCase()==="msie"?wt.support=!1:wt.support=!0,/Win/.test(e)?(wt.os="win",wt.platform="Windows"):/Mac/.test(e)?(wt.os="mac",wt.platform="Macintosh"):/X11/.test(e)||/Linux/.test(e)?(wt.os="linux",wt.platform="Linux"):(wt.os="win",wt.platform="Unknown"),wt.locales=navigator.languages.slice();let r=window.top.location,i=r.origin;return i||(i=r.protocol+"//"+r.hostname+(r.port?":"+r.port:"")),wt.host=i+r.pathname,wt.prefersColorScheme=window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light",wt.prefersContrast=window.matchMedia?.("(prefers-contrast: more)").matches?"more":window.matchMedia?.("(prefers-contrast: less)").matches?"less":null,wt.prefersReducedMotion=window.matchMedia?.("(prefers-reduced-motion: reduce)").matches,wt.prefersReducedTransparency=window.matchMedia?.("(prefers-reduced-transparency: reduce)").matches,wt}var Te=function(n){let e=Et();return e.os==="mac"?n:e.os==="win"&&n==="\u2318\u21E7Z"?"\u2303Y":n.replace("\u2318","\u2303")};Te.display=function(n,e){if(e.length!==1)return e;let t=n.systems.l10n,i=Et().os==="mac";return{"\u2318":i?"\u2318 "+t.t("shortcuts.key.cmd"):t.t("shortcuts.key.ctrl"),"\u21E7":i?"\u21E7 "+t.t("shortcuts.key.shift"):t.t("shortcuts.key.shift"),"\u2325":i?"\u2325 "+t.t("shortcuts.key.option"):t.t("shortcuts.key.alt"),"\u2303":i?"\u2303 "+t.t("shortcuts.key.ctrl"):t.t("shortcuts.key.ctrl"),"\u232B":i?"\u232B "+t.t("shortcuts.key.delete"):t.t("shortcuts.key.backspace"),"\u2326":i?"\u2326 "+t.t("shortcuts.key.del"):t.t("shortcuts.key.del"),"\u2196":i?"\u2196 "+t.t("shortcuts.key.pgup"):t.t("shortcuts.key.pgup"),"\u2198":i?"\u2198 "+t.t("shortcuts.key.pgdn"):t.t("shortcuts.key.pgdn"),"\u21DE":i?"\u21DE "+t.t("shortcuts.key.home"):t.t("shortcuts.key.home"),"\u21DF":i?"\u21DF "+t.t("shortcuts.key.end"):t.t("shortcuts.key.end"),"\u21B5":i?"\u23CE "+t.t("shortcuts.key.return"):t.t("shortcuts.key.enter"),"\u238B":i?"\u238B "+t.t("shortcuts.key.esc"):t.t("shortcuts.key.esc"),"\u2630":i?"\u2630 "+t.t("shortcuts.key.menu"):t.t("shortcuts.key.menu")}[e]||e};var wh=class extends Error{constructor(e){let t=e.status+" "+e.statusText;super(t),this.name="FetchError",this.status=e.status,this.statusText=e.statusText,this.response=e}};function Ae(n){if(!n.ok)throw new wh(n);let e=(n.headers.get("content-type")||"").split(";")[0];if(!e)switch((new URL(n.url).pathname.split("/").at(-1)||"").toLowerCase().split(".").at(-1)||""){case"geojson":case"json":e="application/json";break;case"htm":case"html":e="text/html";break;case"svg":e="image/svg+xml";break;case"gpx":case"kml":case"xml":e="application/xml";break;case"mvt":case"pb":case"pbf":case"pmtiles":case"proto":e="application/protobuf";break;default:e="text/plain"}switch(e){case"application/geo+json":case"application/json":case"application/vnd.geo+json":case"text/x-json":return n.status===204||n.status===205?void 0:n.json();case"application/xhtml+xml":case"application/xml":case"image/svg+xml":case"text/html":case"text/xml":return n.text().then(t=>new window.DOMParser().parseFromString(t,e));case"application/octet-stream":case"application/protobuf":case"application/vnd.google.protobuf":case"application/vnd.mapbox-vector-tile":case"application/x-protobuf":return n.arrayBuffer();default:return n.text()}}function Mt(n,e){let t=new le;for(let r of n){let i=typeof r=="string"?e.hasEntity(r):r;i&&t.extendSelf(i.extent(e))}return t}function lm(n){return n?n.type==="FeatureCollection"?n.features:[n]:[]}function cm(n){let e=new le;if(!n)return e;for(let t of lm(n)){let r=t.geometry;if(!r)continue;let i=r.type,s=r.coordinates,o=/^Multi/.test(i)?s:[s];if(/Polygon$/.test(i))for(let a of o){let l=a[0];for(let c of l)e.extendSelf(c)}else if(/LineString$/.test(i))for(let a of o)for(let l of a)e.extendSelf(l);else if(/Point$/.test(i))for(let a of o)e.extendSelf(a)}return e}function Je(n,e,t){let r=t.systems.editor,i=t.systems.gfx,s=i.scene;if(!s)return;let o=s.layers.get("osm");if(e){for(let a of n)if(o.setClass("highlight",a),a[0]==="r"){let l=r.staging.graph.hasEntity(a);if(!l)continue;for(let c of l.members)o.setClass("highlight",c.id)}}else o.clearClass("highlight");i.immediateRedraw()}function el(n){return!(!n.match(/^(#([0-9a-fA-F]{3}){1,2}|\w+)$/)||!CSS.supports("color",n)||["unset","inherit","initial","revert"].includes(n))}function fa(n,e,t,r,i){let s=`translate3d(${e}px,${t}px,0)`,o=r&&r!==1?` scale(${r})`:"",a=i?` rotate(${i}rad)`:"";n.style.transform=`${s}${o}${a}`}function Wt(n){return typeof n=="function"?n:()=>n}function Oe(n){let e=n.size()&&n.node().tagName.toLowerCase()==="textarea";return n.attr("autocomplete","new-password").attr("autocorrect","off").attr("autocapitalize","off").attr("data-1p-ignore","true").attr("data-bwignore","true").attr("data-form-type","other").attr("data-lpignore","true").attr("spellcheck",e?"true":"false")}function IM(n,e){var t=e.getBoundingClientRect(),r=[t.width,t.height];return n.property("__dimensions__",r),r}function um(n,e){if(!n||n.empty())return[0,0];var t=n.node(),r=n.property("__dimensions__");return!r||e?IM(n,t):r}function PM(n,e){(!n||n.empty())&&(n={node:()=>({}),empty:()=>!1,property:(r,i)=>{n[r]=i},attr:(r,i)=>(n.node().attributes=n.node().attributes||{},n.node().attributes[r]=i,n)});var t=n.node();return e===null?(IM(n,t),n):(n.property("__dimensions__",[e[0],e[1]]).attr("width",e[0]).attr("height",e[1]),n)}function Ee(n,e){function t(r){function i(){delete this.value}function s(){this.value!==r&&(this.value=r)}function o(){var a=r.apply(this,arguments);a==null?delete this.value:this.value!==a&&(this.value=a)}return r==null?i:typeof r=="function"?o:s}return arguments.length===1?n.property("value"):n.each(t(e))}var dm="http://www.w3.org/1999/xhtml",Wv={svg:"http://www.w3.org/2000/svg",xhtml:dm,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ha(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),Wv.hasOwnProperty(e)?{space:Wv[e],local:n}:n}function gX(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===dm&&e.documentElement.namespaceURI===dm?e.createElement(n):e.createElementNS(t,n)}}function yX(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function fm(n){var e=ha(n);return(e.local?yX:gX)(e)}function xX(){}function kc(n){return n==null?xX:function(){return this.querySelector(n)}}function DM(n){typeof n!="function"&&(n=kc(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=new Array(o),l,c,u=0;u<o;++u)(l=s[u])&&(c=n.call(l,l.__data__,u,s))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new Rr(r,this._parents)}function Vv(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function bX(){return[]}function Sh(n){return n==null?bX:function(){return this.querySelectorAll(n)}}function _X(n){return function(){return Vv(n.apply(this,arguments))}}function MM(n){typeof n=="function"?n=_X(n):n=Sh(n);for(var e=this._groups,t=e.length,r=[],i=[],s=0;s<t;++s)for(var o=e[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(r.push(n.call(l,l.__data__,c,o)),i.push(l));return new Rr(r,i)}function Ch(n){return function(){return this.matches(n)}}function hm(n){return function(e){return e.matches(n)}}var vX=Array.prototype.find;function wX(n){return function(){return vX.call(this.children,n)}}function SX(){return this.firstElementChild}function RM(n){return this.select(n==null?SX:wX(typeof n=="function"?n:hm(n)))}var CX=Array.prototype.filter;function AX(){return Array.from(this.children)}function EX(n){return function(){return CX.call(this.children,n)}}function FM(n){return this.selectAll(n==null?AX:EX(typeof n=="function"?n:hm(n)))}function BM(n){typeof n!="function"&&(n=Ch(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=[],l,c=0;c<o;++c)(l=s[c])&&n.call(l,l.__data__,c,s)&&a.push(l);return new Rr(r,this._parents)}function pm(n){return new Array(n.length)}function NM(){return new Rr(this._enter||this._groups.map(pm),this._parents)}function Ah(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}Ah.prototype={constructor:Ah,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function OM(n){return function(){return n}}function TX(n,e,t,r,i,s){for(var o=0,a,l=e.length,c=s.length;o<c;++o)(a=e[o])?(a.__data__=s[o],r[o]=a):t[o]=new Ah(n,s[o]);for(;o<l;++o)(a=e[o])&&(i[o]=a)}function kX(n,e,t,r,i,s,o){var a,l,c=new Map,u=e.length,d=s.length,f=new Array(u),h;for(a=0;a<u;++a)(l=e[a])&&(f[a]=h=o.call(l,l.__data__,a,e)+"",c.has(h)?i[a]=l:c.set(h,l));for(a=0;a<d;++a)h=o.call(n,s[a],a,s)+"",(l=c.get(h))?(r[a]=l,l.__data__=s[a],c.delete(h)):t[a]=new Ah(n,s[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(f[a])===l&&(i[a]=l)}function IX(n){return n.__data__}function LM(n,e){if(!arguments.length)return Array.from(this,IX);var t=e?kX:TX,r=this._parents,i=this._groups;typeof n!="function"&&(n=OM(n));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var u=r[c],d=i[c],f=d.length,h=PX(n.call(u,u&&u.__data__,c,r)),p=h.length,m=a[c]=new Array(p),g=o[c]=new Array(p),y=l[c]=new Array(f);t(u,d,m,g,y,h,e);for(var x=0,b=0,_,S;x<p;++x)if(_=m[x]){for(x>=b&&(b=x+1);!(S=g[b])&&++b<p;);_._next=S||null}}return o=new Rr(o,r),o._enter=a,o._exit=l,o}function PX(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function UM(){return new Rr(this._exit||this._groups.map(pm),this._parents)}function GM(n,e,t){var r=this.enter(),i=this,s=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?s.remove():t(s),r&&i?r.merge(i).order():i}function $M(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,i=t.length,s=r.length,o=Math.min(i,s),a=new Array(i),l=0;l<o;++l)for(var c=t[l],u=r[l],d=c.length,f=a[l]=new Array(d),h,p=0;p<d;++p)(h=c[p]||u[p])&&(f[p]=h);for(;l<i;++l)a[l]=t[l];return new Rr(a,this._parents)}function zM(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function HM(n){n||(n=DX);function e(d,f){return d&&f?n(d.__data__,f.__data__):!d-!f}for(var t=this._groups,r=t.length,i=new Array(r),s=0;s<r;++s){for(var o=t[s],a=o.length,l=i[s]=new Array(a),c,u=0;u<a;++u)(c=o[u])&&(l[u]=c);l.sort(e)}return new Rr(i,this._parents).order()}function DX(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function WM(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function VM(){return Array.from(this)}function jM(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function XM(){let n=0;for(let e of this)++n;return n}function qM(){return!this.node()}function YM(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],s=0,o=i.length,a;s<o;++s)(a=i[s])&&n.call(a,a.__data__,s,i);return this}function MX(n){return function(){this.removeAttribute(n)}}function RX(n){return function(){this.removeAttributeNS(n.space,n.local)}}function FX(n,e){return function(){this.setAttribute(n,e)}}function BX(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function NX(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function OX(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function KM(n,e){var t=ha(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?RX:MX:typeof e=="function"?t.local?OX:NX:t.local?BX:FX)(t,e))}function mm(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function LX(n){return function(){this.style.removeProperty(n)}}function UX(n,e,t){return function(){this.style.setProperty(n,e,t)}}function GX(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function QM(n,e,t){return arguments.length>1?this.each((e==null?LX:typeof e=="function"?GX:UX)(n,e,t??"")):tl(this.node(),n)}function tl(n,e){return n.style.getPropertyValue(e)||mm(n).getComputedStyle(n,null).getPropertyValue(e)}function $X(n){return function(){delete this[n]}}function zX(n,e){return function(){this[n]=e}}function HX(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function ZM(n,e){return arguments.length>1?this.each((e==null?$X:typeof e=="function"?HX:zX)(n,e)):this.node()[n]}function JM(n){return n.trim().split(/^|\s+/)}function jv(n){return n.classList||new eR(n)}function eR(n){this._node=n,this._names=JM(n.getAttribute("class")||"")}eR.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function tR(n,e){for(var t=jv(n),r=-1,i=e.length;++r<i;)t.add(e[r])}function rR(n,e){for(var t=jv(n),r=-1,i=e.length;++r<i;)t.remove(e[r])}function WX(n){return function(){tR(this,n)}}function VX(n){return function(){rR(this,n)}}function jX(n,e){return function(){(e.apply(this,arguments)?tR:rR)(this,n)}}function nR(n,e){var t=JM(n+"");if(arguments.length<2){for(var r=jv(this.node()),i=-1,s=t.length;++i<s;)if(!r.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?jX:e?WX:VX)(t,e))}function XX(){this.textContent=""}function qX(n){return function(){this.textContent=n}}function YX(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function iR(n){return arguments.length?this.each(n==null?XX:(typeof n=="function"?YX:qX)(n)):this.node().textContent}function KX(){this.innerHTML=""}function QX(n){return function(){this.innerHTML=n}}function ZX(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function sR(n){return arguments.length?this.each(n==null?KX:(typeof n=="function"?ZX:QX)(n)):this.node().innerHTML}function JX(){this.nextSibling&&this.parentNode.appendChild(this)}function oR(){return this.each(JX)}function eq(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function aR(){return this.each(eq)}function lR(n){var e=typeof n=="function"?n:fm(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function tq(){return null}function cR(n,e){var t=typeof n=="function"?n:fm(n),r=e==null?tq:typeof e=="function"?e:kc(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function rq(){var n=this.parentNode;n&&n.removeChild(this)}function uR(){return this.each(rq)}function nq(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function iq(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function dR(n){return this.select(n?iq:nq)}function fR(n){return arguments.length?this.property("__data__",n):this.node().__data__}function sq(n){return function(e){n.call(this,e,this.__data__)}}function oq(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function aq(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,i=e.length,s;t<i;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function lq(n,e,t){return function(){var r=this.__on,i,s=sq(e);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=t),i.value=e;return}}this.addEventListener(n.type,s,t),i={type:n.type,name:n.name,value:e,listener:s,options:t},r?r.push(i):this.__on=[i]}}function hR(n,e,t){var r=oq(n+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(i=0,u=a[l];i<s;++i)if((o=r[i]).type===u.type&&o.name===u.name)return u.value}return}for(a=e?lq:aq,i=0;i<s;++i)this.each(a(r[i],e,t));return this}function pR(n,e,t){var r=mm(n),i=r.CustomEvent;typeof i=="function"?i=new i(e,t):(i=r.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),n.dispatchEvent(i)}function cq(n,e){return function(){return pR(this,n,e)}}function uq(n,e){return function(){return pR(this,n,e.apply(this,arguments))}}function mR(n,e){return this.each((typeof e=="function"?uq:cq)(n,e))}function*gR(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var Xv=[null];function Rr(n,e){this._groups=n,this._parents=e}function yR(){return new Rr([[document.documentElement]],Xv)}function dq(){return this}Rr.prototype=yR.prototype={constructor:Rr,select:DM,selectAll:MM,selectChild:RM,selectChildren:FM,filter:BM,data:LM,enter:NM,exit:UM,join:GM,merge:$M,selection:dq,order:zM,sort:HM,call:WM,nodes:VM,node:jM,size:XM,empty:qM,each:YM,attr:KM,style:QM,property:ZM,classed:nR,text:iR,html:sR,raise:oR,lower:aR,append:lR,insert:cR,remove:uR,clone:dR,datum:fR,on:hR,dispatch:mR,[Symbol.iterator]:gR};var fe=yR;function H(n){return typeof n=="string"?new Rr([[document.querySelector(n)]],[document.documentElement]):new Rr([[n]],Xv)}function xR(n){let e;for(;e=n.sourceEvent;)n=e;return n}function os(n,e){if(n=xR(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[n.clientX-i.left-e.clientLeft,n.clientY-i.top-e.clientTop]}}return[n.pageX,n.pageY]}function Xe(n){var e={};function t(o,a){var l=!1,c=Object.keys(e).map(function(h){return e[h]}),u,d;for(u=0;u<c.length;u++)if(d=c[u],!!d.event.modifiers.shiftKey&&!!d.capture===a&&f(o,d,!0)){d.callback(o),l=!0;break}if(l)return;for(u=0;u<c.length;u++)if(d=c[u],!d.event.modifiers.shiftKey&&!!d.capture===a&&f(o,d,!1)){d.callback(o);break}function f(h,p,m){var g=h,y=!1,x=!0;return g.key!==void 0&&(x=g.key.charCodeAt(0)>255,y=!0,p.event.key===void 0?y=!1:Array.isArray(p.event.key)?p.event.key.map(function(b){return b.toLowerCase()}).indexOf(g.key.toLowerCase())===-1&&(y=!1):g.key.toLowerCase()!==p.event.key.toLowerCase()&&(y=!1)),!y&&x&&(y=g.keyCode===p.event.keyCode),!(!y||!(g.ctrlKey&&g.altKey)&&(g.ctrlKey!==p.event.modifiers.ctrlKey||g.altKey!==p.event.modifiers.altKey)||g.metaKey!==p.event.modifiers.metaKey||m&&g.shiftKey!==p.event.modifiers.shiftKey)}}function r(o){t(o,!0)}function i(o){var a=H(o.target).node().tagName;a==="INPUT"||a==="SELECT"||a==="TEXTAREA"||t(o,!1)}function s(o){return o=o||H(document),o.on("keydown.capture."+n,r,!0),o.on("keydown.bubble."+n,i,!1),s}return s.unbind=function(o){return e=[],o=o||H(document),o.on("keydown.capture."+n,null),o.on("keydown.bubble."+n,null),s},s.clear=function(){return e={},s},s.off=function(o,a){for(var l=Ge([].concat(o)),c=0;c<l.length;c++){var u=l[c]+(a?"-capture":"-bubble");delete e[u]}return s},s.trigger=function(o){var a={type:o.type,key:o.key,keyCode:o.keyCode,shiftKey:o.shiftKey,ctrlKey:o.ctrlKey,altKey:o.altKey,metaKey:o.metaKey};return t(a,!1),s},s.on=function(o,a,l){if(typeof a!="function")return s.off(o,l);for(var c=Ge([].concat(o)),u=0;u<c.length;u++){var d=c[u]+(l?"-capture":"-bubble"),f={id:d,capture:l,callback:a,event:{key:void 0,keyCode:0,modifiers:{shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1}}};e[d]&&console.warn('warning: duplicate keybinding for "'+d+'"'),e[d]=f;for(var h=c[u].toLowerCase().match(/(?:(?:[^+⇧⌃⌥⌘])+|[⇧⌃⌥⌘]|\+\+|^\+$)/g),p=0;p<h.length;p++)if(h[p]==="++"&&(h[p]="+"),h[p]in Xe.modifierCodes){var m=Xe.modifierProperties[Xe.modifierCodes[h[p]]];f.event.modifiers[m]=!0}else f.event.key=Xe.keys[h[p]]||h[p],h[p]in Xe.keyCodes&&(f.event.keyCode=Xe.keyCodes[h[p]])}return s},s}Xe.modifierCodes={"\u21E7":16,shift:16,"\u2303":17,ctrl:17,"\u2325":18,alt:18,option:18,"\u2318":91,meta:91,cmd:91,super:91,win:91};Xe.modifierProperties={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"};Xe.plusKeys=["+","ffplus","=","ffequals","\u2260","\xB1"];Xe.minusKeys=["_","-","ffminus","dash","\u2013","\u2014"];Xe.keys={"\u232B":"Backspace",backspace:"Backspace","\u21E5":"Tab","\u21C6":"Tab",tab:"Tab","\u21A9":"Enter","\u21B5":"Enter","\u23CE":"Enter",return:"Enter",enter:"Enter","\u2305":"Enter",pause:"Pause","pause-break":"Pause","\u21EA":"CapsLock",caps:"CapsLock","caps-lock":"CapsLock","\u238B":["Escape","Esc"],escape:["Escape","Esc"],esc:["Escape","Esc"],space:[" ","Spacebar"],"\u2196":"PageUp",pgup:"PageUp","page-up":"PageUp","\u2198":"PageDown",pgdown:"PageDown","page-down":"PageDown","\u21DF":"End",end:"End","\u21DE":"Home",home:"Home",ins:"Insert",insert:"Insert","\u2326":["Delete","Del"],del:["Delete","Del"],delete:["Delete","Del"],"\u2190":["ArrowLeft","Left"],left:["ArrowLeft","Left"],"arrow-left":["ArrowLeft","Left"],"\u2191":["ArrowUp","Up"],up:["ArrowUp","Up"],"arrow-up":["ArrowUp","Up"],"\u2192":["ArrowRight","Right"],right:["ArrowRight","Right"],"arrow-right":["ArrowRight","Right"],"\u2193":["ArrowDown","Down"],down:["ArrowDown","Down"],"arrow-down":["ArrowDown","Down"],"*":["*","Multiply"],star:["*","Multiply"],asterisk:["*","Multiply"],multiply:["*","Multiply"],"+":["+","Add"],plus:["+","Add"],"-":["-","Subtract"],subtract:["-","Subtract"],dash:["-","Subtract"],semicolon:";",equals:"=",comma:",",period:".","full-stop":".",slash:"/","forward-slash":"/",tick:"`","back-quote":"`","open-bracket":"[","back-slash":"\\","close-bracket":"]",quote:"'",apostrophe:"'","num-0":"0","num-1":"1","num-2":"2","num-3":"3","num-4":"4","num-5":"5","num-6":"6","num-7":"7","num-8":"8","num-9":"9",f1:"F1",f2:"F2",f3:"F3",f4:"F4",f5:"F5",f6:"F6",f7:"F7",f8:"F8",f9:"F9",f10:"F10",f11:"F11",f12:"F12",f13:"F13",f14:"F14",f15:"F15",f16:"F16",f17:"F17",f18:"F18",f19:"F19",f20:"F20",f21:"F21",f22:"F22",f23:"F23",f24:"F24",f25:"F25"};Xe.keyCodes={"\u232B":8,backspace:8,"\u21E5":9,"\u21C6":9,tab:9,"\u21A9":13,"\u21B5":13,"\u23CE":13,return:13,enter:13,"\u2305":13,pause:19,"pause-break":19,"\u21EA":20,caps:20,"caps-lock":20,"\u238B":27,escape:27,esc:27,space:32,"\u2196":33,pgup:33,"page-up":33,"\u2198":34,pgdown:34,"page-down":34,"\u21DF":35,end:35,"\u21DE":36,home:36,ins:45,insert:45,"\u2326":46,del:46,delete:46,"\u2190":37,left:37,"arrow-left":37,"\u2191":38,up:38,"arrow-up":38,"\u2192":39,right:39,"arrow-right":39,"\u2193":40,down:40,"arrow-down":40,ffequals:61,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,"|":124,ffplus:171,ffminus:173,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,dash:189,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostrophe:222};var as=95,rl=0;for(;++as<106;)Xe.keyCodes["num-"+rl]=as,++rl;as=47;rl=0;for(;++as<58;)Xe.keyCodes[rl]=as,++rl;as=111;rl=1;for(;++as<136;)Xe.keyCodes["f"+rl]=as,++rl;as=64;for(;++as<91;)Xe.keyCodes[String.fromCharCode(as).toLowerCase()]=as;function xe(n,e){for(var t=1,r=arguments.length,i;++t<r;)n[i=arguments[t]]=fq(n,e,e[i]);return n}function fq(n,e,t){return function(){var r=t.apply(e,arguments);return r===e?n:r}}function h2(n,e,t=document){n.each(function(){var r=t.createEvent("HTMLEvents");r.initEvent(e,!0,!0),typeof this.dispatchEvent=="function"?this.dispatchEvent(r):typeof this.emit=="function"&&this.emit(e,r)})}function Rt(){if(this instanceof Rt)arguments.length&&this.initialize(arguments);else return new Rt().initialize(arguments)}me.way=Rt;Rt.prototype=Object.create(me.prototype);Object.assign(Rt.prototype,{type:"way",nodes:[],copy:function(n,e){if(e[this.id])return e[this.id];var t=me.prototype.copy.call(this,n,e),r=this.nodes.map(function(i){return n.entity(i).copy(n,e).id});return t=t.update({nodes:r}),e[this.id]=t,t},extent:function(n){return n.transient(this,"extent",function(){return Mt(this.nodes,n)})},first:function(){return this.nodes[0]},last:function(){return this.nodes[this.nodes.length-1]},contains:function(n){return this.nodes.indexOf(n)>=0},affix:function(n){if(this.nodes[0]===n)return"prefix";if(this.nodes[this.nodes.length-1]===n)return"suffix"},layer:function(){return isFinite(this.tags.layer)?Math.max(-10,Math.min(+this.tags.layer,10)):this.tags.covered==="yes"?-1:this.tags.location==="overground"?1:this.tags.location==="underground"?-1:this.tags.location==="underwater"?-10:this.tags.power==="line"||this.tags.power==="minor_line"||this.tags.aerialway?10:this.tags.bridge?1:this.tags.cutting||this.tags.tunnel||this.tags.waterway?-1:this.tags.man_made==="pipeline"||this.tags.boundary?-10:0},impliedLineWidthMeters:function(){var n={highway:{motorway:5,motorway_link:5,trunk:4.5,trunk_link:4.5,primary:4,secondary:4,tertiary:4,primary_link:4,secondary_link:4,tertiary_link:4,unclassified:4,road:4,living_street:4,bus_guideway:4,pedestrian:4,residential:3.5,service:3.5,track:3,cycleway:2.5,bridleway:2,corridor:2,steps:2,path:1.5,footway:1.5},railway:{rail:2.5,light_rail:2.5,tram:2.5,subway:2.5,monorail:2.5,funicular:2.5,disused:2.5,preserved:2.5,miniature:1.5,narrow_gauge:1.5},waterway:{river:50,canal:25,stream:5,tidal_channel:5,fish_pass:2.5,drain:2.5,ditch:1.5}};for(var e in n)if(this.tags[e]&&n[e][this.tags[e]]){var t=n[e][this.tags[e]];if(e==="highway"){var r=this.tags.lanes&&parseInt(this.tags.lanes,10);return r||(r=this.isOneWay()?1:2),t*r}return t}return null},isOneWay:function(){var n={yes:!0,1:!0,"-1":!0,reversible:!0,alternating:!0,no:!1,0:!1};if(n[this.tags.oneway]!==void 0)return n[this.tags.oneway];for(var e in this.tags)if(e in Ya&&this.tags[e]in Ya[e])return!0;return!1},sidednessIdentifier:function(){for(let n in this.tags){let e=this.tags[n],t=dh(n);if(t in fh&&e in fh[t])return fh[t][e]===!0?t:fh[t][e]}return null},isSided:function(){return this.tags.two_sided==="yes"?!1:this.sidednessIdentifier()!==null},lanes:function(){return am(this)},isClosed:function(){return this.nodes.length>1&&this.first()===this.last()},isConvex:function(n){if(!this.isClosed()||this.isDegenerate())return null;for(var e=Ge(n.childNodes(this)),t=e.map(function(u){return u.loc}),r=0,i=0,s=0;s<t.length;s++){var o=t[(s+1)%t.length],a=t[s],l=t[(s+2)%t.length],c=vh(a,l,o);if(r=c>0?1:c<0?-1:0,r!==0){if(i&&r!==i)return!1;i=r}}return!0},tagSuggestingArea:function(){return Xa(this.tags)},isArea:function(){return this.tags.area==="yes"?!0:!this.isClosed()||this.tags.area==="no"?!1:this.tagSuggestingArea()!==null},isDegenerate:function(){return new Set(this.nodes).size<(this.isClosed()?3:2)},areAdjacent:function(n,e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t]===n&&(this.nodes[t-1]===e||this.nodes[t+1]===e))return!0;return!1},geometry:function(n){return n.transient(this,"geometry",function(){return this.isArea()?"area":"line"})},segments:function(n){function e(t){var r=t.hasEntity(this.nodes[0]),i=t.hasEntity(this.nodes[1]);return r&&i&&new le([Math.min(r.loc[0],i.loc[0]),Math.min(r.loc[1],i.loc[1])],[Math.max(r.loc[0],i.loc[0]),Math.max(r.loc[1],i.loc[1])])}return n.transient(this,"segments",function(){for(var t=[],r=0;r<this.nodes.length-1;r++)t.push({id:this.id+"-"+r,wayId:this.id,index:r,nodes:[this.nodes[r],this.nodes[r+1]],extent:e});return t})},close:function(){if(this.isClosed()||!this.nodes.length)return this;var n=this.nodes.slice();return n=n.filter(p2),n.push(n[0]),this.update({nodes:n})},unclose:function(){if(!this.isClosed())return this;for(var n=this.nodes.slice(),e=this.first(),t=n.length-1;t>0&&n.length>1&&n[t]===e;)n.splice(t,1),t=n.length-1;return n=n.filter(p2),this.update({nodes:n})},addNode:function(n,e){var t=this.nodes.slice(),r=this.isClosed(),i=r?t.length-1:t.length;if(e===void 0&&(e=i),e<0||e>i)throw new RangeError("index "+e+" out of range 0.."+i);if(r){for(var s=this.first(),o=1;o<t.length&&t.length>2&&t[o]===s;)t.splice(o,1),e>o&&e--;for(o=t.length-1;o>0&&t.length>1&&t[o]===s;)t.splice(o,1),e>o&&e--,o=t.length-1}return t.splice(e,0,n),t=t.filter(p2),r&&(t.length===1||t[0]!==t[t.length-1])&&t.push(t[0]),this.update({nodes:t})},updateNode:function(n,e){var t=this.nodes.slice(),r=this.isClosed(),i=t.length-1;if(e===void 0||e<0||e>i)throw new RangeError("index "+e+" out of range 0.."+i);if(r){for(var s=this.first(),o=1;o<t.length&&t.length>2&&t[o]===s;)t.splice(o,1),e>o&&e--;for(o=t.length-1;o>0&&t.length>1&&t[o]===s;)t.splice(o,1),e===o&&(e=0),o=t.length-1}return t.splice(e,1,n),t=t.filter(p2),r&&(t.length===1||t[0]!==t[t.length-1])&&t.push(t[0]),this.update({nodes:t})},replaceNode:function(n,e){for(var t=this.nodes.slice(),r=this.isClosed(),i=0;i<t.length;i++)t[i]===n&&(t[i]=e);return t=t.filter(p2),r&&(t.length===1||t[0]!==t[t.length-1])&&t.push(t[0]),this.update({nodes:t})},removeNode:function(n){var e=this.nodes.slice(),t=this.isClosed();return e=e.filter(function(r){return r!==n}).filter(p2),t&&(e.length===1||e[0]!==e[e.length-1])&&e.push(e[0]),this.update({nodes:e})},asJXON:function(n){var e={way:{"@id":this.osmId(),"@version":this.version||0,nd:this.nodes.map(function(t){return{keyAttributes:{ref:me.id.toOSM(t)}}},this),tag:Object.keys(this.tags).map(function(t){return{keyAttributes:{k:t,v:this.tags[t]}}},this)}};return n&&(e.way["@changeset"]=n),e},asGeoJSON:function(n){return n.transient(this,"GeoJSON",function(){var e=n.childNodes(this).map(function(t){return t.loc});return this.isArea()&&this.isClosed()?{type:"Polygon",coordinates:[e]}:{type:"LineString",coordinates:e}})},area:function(n){return n.transient(this,"area",function(){var e=n.childNodes(this),t={type:"Polygon",coordinates:[e.map(function(i){return i.loc})]};!this.isClosed()&&e.length&&t.coordinates[0].push(e[0].loc);var r=bo(t);return r>2*Math.PI&&(t.coordinates[0]=t.coordinates[0].reverse(),r=bo(t)),isNaN(r)?0:r})}});function p2(n,e,t){return e===0||n!==t[e-1]}function m2(n,e){if(n.type!=="relation"||!n.isMultipolygon()||Object.keys(n.tags).filter(Yn).length>1)return!1;var t;for(var r in n.members){var i=n.members[r];if((!i.role||i.role==="outer")&&(t||i.type!=="way"||!e.hasEntity(i.id)||(t=e.entity(i.id),Object.keys(t.tags).filter(Yn).length===0)))return!1}return t}function g2(n,e){if(n.type!=="way"||Object.keys(n.tags).filter(Yn).length===0)return!1;var t=e.parentRelations(n);if(t.length!==1)return!1;var r=t[0];if(!r.isMultipolygon()||Object.keys(r.tags).filter(Yn).length>1)return!1;for(var i=r.members,s,o=0;o<i.length;o++)if(s=i[o],s.id===n.id&&s.role&&s.role!=="outer"||s.id!==n.id&&(!s.role||s.role==="outer"))return!1;return r}function bR(n,e){if(n.type!=="way")return!1;var t=e.parentRelations(n);if(t.length!==1)return!1;var r=t[0];if(!r.isMultipolygon()||Object.keys(r.tags).filter(Yn).length>1)return!1;for(var i=r.members,s,o,a=0;a<i.length;a++)if(s=i[a],!s.role||s.role==="outer"){if(o)return!1;o=s}if(!o)return!1;var l=e.hasEntity(o.id);return!l||!Object.keys(l.tags).filter(Yn).length?!1:l}function xi(n,e){function t(p){return e.childNodes(e.entity(p.id))}function r(p){var m=ns(p.id,{reverseOneway:!0});return o.actions.push(m),p instanceof Rt?m(e).entity(p.id):p}n=n.filter(function(p){return p.type==="way"&&e.hasEntity(p.id)});var i,s=!0;for(i=0;i<n.length;i++)if(n[i]instanceof Rt){s=!1;break}var o=[];for(o.actions=[];n.length;){for(var a=n.shift(),l=[a],c=t(a).slice();n.length;){var u=c[0],d=c[c.length-1],f=null,h=null;for(i=0;i<n.length;i++)if(a=n[i],h=t(a),s&&l.length===1&&h[0]!==d&&h[h.length-1]!==d&&(h[h.length-1]===u||h[0]===u)&&(l[0]=r(l[0]),c.reverse(),u=c[0],d=c[c.length-1]),h[0]===d){f=c.push,h=h.slice(1);break}else if(h[h.length-1]===d){f=c.push,h=h.slice(0,-1).reverse(),a=r(a);break}else if(h[h.length-1]===u){f=c.unshift,h=h.slice(0,-1);break}else if(h[0]===u){f=c.unshift,h=h.slice(1).reverse(),a=r(a);break}else f=h=null;if(!h)break;f.apply(l,[a]),f.apply(c,h),n.splice(i,1)}l.nodes=c,o.push(l)}return o}function Ic(n,e,t,r){return function(o){var a=o.entity(n),l=/stop|platform/.test(e.role);return(isNaN(t)||r)&&e.type==="way"&&!l?o=i(a,o):(l&&isNaN(t)&&(t=0),o=o.replace(a.addMember(e,t))),o};function i(s,o){var a,l,c,u,d,f,h=[],p=[];for(u=0;u<s.members.length;u++){var m=s.members[u];/stop|platform/.test(m.role)?h.push(m):p.push(m)}if(s=s.update({members:p}),r){l=Rt({id:"wTemp",nodes:r.nodes}),o=o.replace(l);var g={id:l.id,type:"way",role:e.role},y=s.replaceMember({id:r.originalID},g,!0);a=hr(y.members,"type"),a.way=a.way||[]}else a=hr(s.members,"type"),a.way=a.way||[],a.way.push(e);p=A(a.way);var x=xi(p,o);for(u=0;u<x.length;u++){var b=x[u],_=b.nodes.slice(),S=b[0].index;for(d=0;d<p.length&&p[d].index!==S;d++);for(f=0;f<b.length;f++){c=b[f];var C=o.entity(c.id);l&&c.id===l.id&&(_[0].id===r.nodes[0]?c.pair=[{id:r.originalID,type:"way",role:c.role},{id:r.insertedID,type:"way",role:c.role}]:c.pair=[{id:r.insertedID,type:"way",role:c.role},{id:r.originalID,type:"way",role:c.role}]),f>0&&(d+f>=p.length||c.index!==p[d+f].index)&&w(p,c.index,d+f),_.splice(0,C.nodes.length-1)}}l&&(o=o.remove(l));var k=[];for(u=0;u<p.length;u++)c=p[u],c.index!==-1&&(c.pair?(k.push(c.pair[0]),k.push(c.pair[1])):k.push(Ir(c,["index"])));var v=h.concat(a.node||[],k,a.relation||[]);return o.replace(s.update({members:v}));function w(E,I,M){var T;for(T=0;T<E.length&&E[T].index!==I;T++);var R=Object.assign({},E[T]);E[T].index=-1,R.index=M,E.splice(M,0,R)}function A(E){for(var I=new Array(E.length),M=0;M<E.length;M++)I[M]=Object.assign({},E[M]),I[M].index=M;return I}}}function Cr(n,e){return function(t){t=t.replace(e.move(n.loc));var r=bn(t.parentWays(t.entity(n.edge[0])),t.parentWays(t.entity(n.edge[1])));return r.forEach(function(i){for(var s=0;s<i.nodes.length-1;s++)if(TM([i.nodes[s],i.nodes[s+1]],n.edge)){t=t.replace(t.entity(i.id).addNode(e.id,s+1));return}}),t}}function ls(n,e,t){return function(r){return r.replace(r.entity(n).addNode(e,t))}}function nl(n,e,t){return function(r){return r.replace(r.entity(n).updateMember(e,t))}}var _R=new Set(["motorway","trunk","primary","secondary","tertiary","residential","motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","unclassified","road","service","track","living_street","bus_guideway","busway"]),vR=new Set(["path","footway","cycleway","bridleway","pedestrian"]),gm=new Set(["crossing","crossing_ref","crossing:continuous","crossing:island","crossing:markings","crossing:signals"]),wR=new Set(["crossing_ref","crossing:continuous","crossing:island"]);function Gs(n){return function(l){let c=l.entity(n),u=c.geometry(l);return c.type==="way"&&u==="line"?l=i(c,l):c.type==="node"&&u==="vertex"&&(l=s(c,l)),l};function e(a){for(let l of vR)if(a.highway===l&&a[l]==="crossing")return!0;return!1}function t(a){return _R.has(a.highway)||vR.has(a.highway)||!!a.railway||!!a.crossing}function r(a){let l=new Set((a.highway||"").split(";").filter(Boolean));return!!a["crossing:markings"]||l.has("crossing")}function i(a,l,c){let u=Object.assign({},a.tags);u=o(u);let d=e(u),f=!t(u);if(f)for(let g of gm)delete u[g];if(a=a.update({tags:u}),l=l.replace(a),!(d||f))return l;let h={};for(let g of gm)h[g]=u[g];let p=new Set;for(let g of a.nodes){if(g===c)continue;let y=l.hasEntity(g);if(y&&!y.isEndpoint(l)){if(d){let x=!1;for(let b of l.parentWays(y))if(b.id!==a.id&&_R.has(b.tags.highway)){x=!0;break}x&&p.add(y)}else if(f){let x=!0;for(let b of l.parentWays(y))if(b.id!==a.id&&t(b.tags)){x=!1;break}x&&p.add(y)}}}let m=["informal","no"].includes(h.crossing);for(let g of p){let y=Object.assign({},g.tags);for(let[b,_]of Object.entries(h))_?y[b]=_:wR.has(b)||delete y[b];let x=new Set((y.highway||"").split(";").filter(Boolean));d?m?x.delete("crossing"):x.add("crossing"):f&&x.delete("crossing"),x.size?y.highway=Array.from(x).join(";"):delete y.highway,l=l.replace(g.update({tags:y}))}return l}function s(a,l){let c=l.parentWays(a),u=Object.assign({},a.tags);u=o(u);let d=r(u)&&c.some(p=>t(p.tags));if(!d)for(let p of gm)delete u[p];if(a=a.update({tags:u}),l=l.replace(a),!d)return l;let f={};for(let p of gm)f[p]=u[p];let h=new Set;for(let p of c)e(p.tags)&&h.add(p);for(let p of h){let m=Object.assign({},p.tags);for(let[g,y]of Object.entries(f))y?m[g]=y:wR.has(g)||delete m[g];p=p.update({tags:m}),l=l.replace(p),d&&(l=i(p,l,a.id))}return l}function o(a){let l=a.crossing??"",c=a.crossing_ref??"",u=a["crossing:markings"]??"",d=a["crossing:signals"]??"";if(!l&&!c&&!u&&!d||l.includes(";")||c.includes(";")||u.includes(";")||d.includes(";"))return a;let f=Object.assign({},a);if(c){if(!u)switch(c){case"zebra":u=f["crossing:markings"]="zebra";break;default:u=f["crossing:markings"]="yes";break}if(!d)switch(c){case"hawk":case"pelican":case"puffin":case"toucan":case"pegasus":d=f["crossing:signals"]="yes";break}}if(l){if(!u)switch(l){case"island":case"pedestrian_signals":case"traffic_signals":break;case"informal":case"no":case"unmarked":u=f["crossing:markings"]="no";break;case"zebra":u=f["crossing:markings"]="zebra";break;default:u=f["crossing:markings"]="yes";break}if(!d)switch(l){case"informal":case"no":case"uncontrolled":d=f["crossing:signals"]="no";break;case"pedestrian_signals":case"traffic_signals":d=f["crossing:signals"]="yes";break}let h=!["island","informal","no","traffic_signals","pedestrian_signals","unmarked"].includes(l),p=["traffic_signals","pedestrian_signals"].includes(l),m=u&&u!=="no",g=d&&d!=="no";(h&&!m||!h&&m||p&&!g||!p&&g||l==="yes"&&u)&&(l=null,delete f.crossing)}if(!f.crossing){if(d&&d!=="no")f.crossing="traffic_signals";else if(u)switch(u){case"no":f.crossing="unmarked";break;default:f.crossing="marked";break}}return f}}function ti(n,e,t,r){return function(s){let o=s.entity(n),a=o.geometry(s),l=Object.assign({},o.tags),c=o.tags;return e&&(c=e.unsetTags(c,a,t&&t.addTags?Object.keys(t.addTags):null)),t&&(c=t.setTags(c,a,r)),s=s.replace(o.update({tags:c})),["crossing","crossing_ref","crossing:continuous","crossing:island","crossing:markings","crossing:signals"].some(d=>c[d]!==l[d])&&(s=Gs(n)(s)),s}}function Ft(n,e){return function(t){let r=t.entity(n);return t.replace(r.update({tags:e}))}}function Le(){if(this instanceof Le)arguments.length&&this.initialize(arguments);else return new Le().initialize(arguments)}me.node=Le;Le.prototype=Object.create(me.prototype);Object.assign(Le.prototype,{type:"node",loc:[9999,9999],extent:function(){return new le(this.loc)},geometry:function(n){return n.transient(this,"geometry",function(){return n.isPoi(this)?"point":"vertex"})},move:function(n){return this.update({loc:n})},isDegenerate:function(){return!(Array.isArray(this.loc)&&this.loc.length===2&&this.loc[0]>=-180&&this.loc[0]<=180&&this.loc[1]>=-90&&this.loc[1]<=90)},directions:function(n,e){let t;if(this.isHighwayIntersection(n)&&(this.tags.stop||"").toLowerCase()==="all")t="all";else{t=(this.tags.direction||"").toLowerCase();let o=/:direction$/i;for(let[a,l]of Object.entries(this.tags))if(o.test(a)){t=l.toLowerCase();break}}if(t==="")return[];let r={north:0,n:0,northnortheast:22,nne:22,northeast:45,ne:45,eastnortheast:67,ene:67,east:90,e:90,eastsoutheast:112,ese:112,southeast:135,se:135,southsoutheast:157,sse:157,south:180,s:180,southsouthwest:202,ssw:202,southwest:225,sw:225,westsouthwest:247,wsw:247,west:270,w:270,westnorthwest:292,wnw:292,northwest:315,nw:315,northnorthwest:337,nnw:337},i=t.split(";"),s=[];for(let o of i){if(r[o]!==void 0&&(o=r[o]),o!==""&&!isNaN(+o)){s.push(+o);continue}let a=this.tags["traffic_sign:backward"]||o==="backward"||o==="both"||o==="all",l=this.tags["traffic_sign:forward"]||o==="forward"||o==="both"||o==="all";if(!l&&!a)continue;let c=new Set;for(let u of n.parentWays(this)){if(u.geometry(n)!=="line"||!(u.tags.highway||u.tags.railway||u.tags.waterway||u.tags.aeroway))continue;let d=u.nodes;for(let f=0;f<d.length;f++)d[f]===this.id&&(l&&f>0&&c.add(d[f-1]),a&&f<d.length-1&&c.add(d[f+1]))}for(let u of c){let d=e.project(this.loc),f=e.project(n.entity(u).loc);s.push(sr(d,f)*180/Math.PI+90)}}return Ge(s).sort((o,a)=>o-a)},isCrossing:function(){return this.tags.highway==="crossing"||this.tags.railway&&this.tags.railway.indexOf("crossing")!==-1},isEndpoint:function(n){return n.transient(this,"isEndpoint",function(){var e=this.id;return n.parentWays(this).filter(function(t){return!t.isClosed()&&!!t.affix(e)}).length>0})},isConnected:function(n){return n.transient(this,"isConnected",function(){var e=n.parentWays(this);if(e.length>1){for(var t in e)if(e[t].geometry(n)==="line"&&e[t].hasInterestingTags())return!0}else if(e.length===1){var r=e[0],i=r.nodes.slice();return r.isClosed()&&i.pop(),i.indexOf(this.id)!==i.lastIndexOf(this.id)}return!1})},parentIntersectionWays:function(n){return n.transient(this,"parentIntersectionWays",function(){return n.parentWays(this).filter(function(e){return(e.tags.highway||e.tags.waterway||e.tags.railway||e.tags.aeroway)&&e.geometry(n)==="line"})})},isIntersection:function(n){return this.parentIntersectionWays(n).length>1},isHighwayIntersection:function(n){return n.transient(this,"isHighwayIntersection",function(){return n.parentWays(this).filter(function(e){return e.tags.highway&&e.geometry(n)==="line"}).length>1})},isOnAddressLine:function(n){return n.transient(this,"isOnAddressLine",function(){return n.parentWays(this).filter(function(e){return e.tags.hasOwnProperty("addr:interpolation")&&e.geometry(n)==="line"}).length>0})},asJXON:function(n){var e={node:{"@id":this.osmId(),"@lon":this.loc[0],"@lat":this.loc[1],"@version":this.version||0,tag:Object.keys(this.tags).map(function(t){return{keyAttributes:{k:t,v:this.tags[t]}}},this)}};return n&&(e.node["@changeset"]=n),e},asGeoJSON:function(){return{type:"Point",coordinates:this.loc}}});function ym(n,e,t){t=(t||20)*Math.PI/180;var r=function(i,s){(s===null||!isFinite(s))&&(s=1),s=Math.min(Math.max(+s,0),1);var o=i.entity(n),a={};i.childNodes(o).forEach(function(_e){a[_e.id]||(a[_e.id]=_e)}),o.isConvex(i)||(i=r.makeConvex(i));var l=Ge(i.childNodes(o)),c=l.filter(function(_e){return i.parentWays(_e).length!==1}),u=l.map(function(_e){return e.project(_e.loc)}),d=c.map(function(_e){return e.project(_e.loc)}),f=u.length===2?at(u[0],u[1],.5):hi(u),h=N6(u,function(_e){return Ne(f,_e)}),p=Q6(u)>0?1:-1,m,g,y,x;if(c.length||(c=[l[0]],d=[u[0]]),c.length===1){var b=l.indexOf(c[0]),_=Math.floor((b+l.length/2)%l.length);c.push(l[_]),d.push(u[_])}for(g=0;g<d.length;g++){var S=(g+1)%c.length,C=c[g],k=c[S],v=l.indexOf(C),w=l.indexOf(k),A=-1,E=w-v,I={},M=[],T,R,P,D,N,F,B,O;E<0&&(E+=l.length);var G=Ne(f,d[g])||1e-4;d[g]=[f[0]+(d[g][0]-f[0])/G*h,f[1]+(d[g][1]-f[1])/G*h],F=e.unproject(d[g]),B=c[g],O=a[B.id],B=B.move(at(O.loc,F,s)),i=i.replace(B),T=Math.atan2(d[g][1]-f[1],d[g][0]-f[0]),R=Math.atan2(d[S][1]-f[1],d[S][0]-f[0]),P=R-T,P*p>0&&(P=-p*(2*Math.PI-Math.abs(P)));do A++,D=P/(E+A);while(Math.abs(D)>t);for(y=1;y<E;y++)N=T+y*D,F=e.unproject([f[0]+Math.cos(N)*h,f[1]+Math.sin(N)*h]),B=l[(y+v)%l.length],O=a[B.id],I[B.id]=N,B=B.move(at(O.loc,F,s)),i=i.replace(B);for(y=0;y<A;y++){N=T+(E+y)*D,F=e.unproject([f[0]+Math.cos(N)*h,f[1]+Math.sin(N)*h]);var U=1/0;for(var W in I){var V=I[W],j=Math.abs(V-N);j<U&&(U=j,O=a[W])}B=Le({loc:at(O.loc,F,s)}),i=i.replace(B),l.splice(w+y,0,B),M.push(B.id)}if(E===1&&M.length){var Z=o.nodes.lastIndexOf(C.id),Y=o.nodes.lastIndexOf(k.id),K=Y-Z;K<-1&&(K=1);var ne=i.parentWays(c[g]);for(y=0;y<ne.length;y++){var ie=ne[y];if(ie!==o&&ie.areAdjacent(C.id,k.id)){var q=ie.nodes.lastIndexOf(C.id),se=ie.nodes.lastIndexOf(k.id),te=se-q,Q=se;for(te<-1&&(te=1),K!==te&&(M.reverse(),Q=q),x=0;x<M.length;x++)ie=ie.addNode(M[x],Q+x);i=i.replace(ie)}}}}return m=l.map(function(_e){return _e.id}),m.push(m[0]),o=o.update({nodes:m}),i=i.replace(o),i};return r.makeConvex=function(i){var s=i.entity(n),o=Ge(i.childNodes(s)),a=o.map(function(y){return e.project(y.loc)}),l=Q6(a)>0?1:-1,c=pi(a),u,d;for(l===-1&&(o.reverse(),a.reverse()),u=0;u<c.length-1;u++){var f=a.indexOf(c[u]),h=a.indexOf(c[u+1]),p=h-f;for(p<0&&(p+=o.length),d=1;d<p;d++){var m=at(c[u],c[u+1],d/p),g=o[(d+f)%o.length].move(e.unproject(m));i=i.replace(g)}}return i},r.disabled=function(i){if(!i.entity(n).isClosed())return"not_closed";var s=i.entity(n),o=Ge(i.childNodes(s)),a=o.map(function(_){return e.project(_.loc)}),l=pi(a),c=Math.PI/180;if(l.length!==a.length||l.length<3)return!1;var u=hi(a),d=Uv(u,a[0]),f,h;for(f=0;f<l.length;f++){h=l[f];var p=Uv(h,u),m=Math.abs(p-d);if(m>.05*d)return!1}for(f=0;f<l.length;f++){h=l[f];var g=l[(f+1)%l.length],y=Math.atan2(h[1]-u[1],h[0]-u[0]),x=Math.atan2(g[1]-u[1],g[0]-u[0]),b=x-y;if(b<0&&(b=-b),b>Math.PI&&(b=2*Math.PI-b),b>t+c)return!1}return"already_circular"},r.transitionable=!0,r}function cs(n){function e(r,i){if(i.parentWays(r).length||i.parentRelations(r).length)return!1;var s=qa(r.tags);return s.point?!1:s.vertex?!0:!r.hasInterestingTags()}var t=function(r){var i=r.entity(n);return r.parentRelations(i).forEach(function(s){s=s.removeMembersWithID(n),r=r.replace(s),s.isDegenerate()&&(r=$r(s.id)(r))}),new Set(i.nodes).forEach(function(s){r=r.replace(i.removeNode(s));var o=r.entity(s);e(o,r)&&(r=r.remove(o))}),r.remove(i)};return t}function pa(n){var e={way:cs,node:vo,relation:$r},t=function(r){return n.forEach(function(i){r.hasEntity(i)&&(r=e[r.entity(i).type](i)(r))}),r};return t}function $r(n,e){function t(i,s){return!s.parentWays(i).length&&!s.parentRelations(i).length&&!i.hasInterestingTags()&&!e}var r=function(i){var s=i.entity(n);i.parentRelations(s).forEach(function(a){a=a.removeMembersWithID(n),i=i.replace(a),a.isDegenerate()&&(i=$r(a.id)(i))});var o=Ge(s.members.map(function(a){return a.id}));return o.forEach(function(a){i=i.replace(s.removeMembersWithID(a));var l=i.entity(a);t(l,i)&&(i=pa([a])(i))}),i.remove(s)};return r}function vo(n){var e=function(t){var r=t.entity(n);return t.parentWays(r).forEach(function(i){i=i.removeNode(n),t=t.replace(i),i.isDegenerate()&&(t=cs(i.id)(t))}),t.parentRelations(r).forEach(function(i){i=i.removeMembersWithID(n),t=t.replace(i),i.isDegenerate()&&(t=$r(i.id)(t))}),t.remove(r)};return e}function Pc(n){var e=function(t){var r,i,s,o,a;for(o=0;o<n.length&&(r=t.entity(n[o]),!r.version);o++);for(o=0;o<n.length;o++)if(i=t.entity(n[o]),i.id!==r.id){for(s=t.parentWays(i),a=0;a<s.length;a++)t=t.replace(s[a].replaceNode(i.id,r.id));for(s=t.parentRelations(i),a=0;a<s.length;a++)t=t.replace(s[a].replaceMember(i,r));r=r.mergeTags(i.tags),t=vo(i.id)(t)}for(t=t.replace(r),s=t.parentWays(r),o=0;o<s.length;o++)s[o].isDegenerate()&&(t=cs(s[o].id)(t));return t};return e.disabled=function(t){var r={},i=[],s,o,a,l,c,u,d,f,h;for(d=0;d<n.length&&(s=t.entity(n[d]),!s.version);d++);for(d=0;d<n.length;d++)for(o=t.entity(n[d]),l=t.parentRelations(o),f=0;f<l.length;f++){if(c=l[f],u=c.memberById(o.id).role||"",c.hasFromViaTo()&&i.push(c.id),r[c.id]!==void 0&&r[c.id]!==u)return"relation";r[c.id]=u}for(d=0;d<n.length;d++){o=t.entity(n[d]);var p=t.parentWays(o);for(f=0;f<p.length;f++){var m=p[f];for(l=t.parentRelations(m),h=0;h<l.length;h++)c=l[h],c.hasFromViaTo()&&i.push(c.id)}}for(i=Ge(i),d=0;d<i.length;d++)if(c=t.entity(i[d]),!!c.isComplete(t)){var g=c.members.filter(function(N){return N.type==="way"}).map(function(N){return t.entity(N.id)});g=Ge(g);var y=c.memberByRole("from"),x=c.memberByRole("to"),b=y.id===x.id,_={from:[],via:[],to:[],keyfrom:[],keyto:[]};for(f=0;f<c.members.length;f++)D(c.members[f],_);_.keyfrom=Ge(_.keyfrom.filter(R)),_.keyto=Ge(_.keyto.filter(R));var S=P(_.keyfrom,_.keyto);_.from=_.from.filter(S),_.via=_.via.filter(S),_.to=_.to.filter(S);var C=!1,k=!1,v=!1,w=!1,A=!1;for(f=0;f<n.length;f++){var E=n[f];_.from.indexOf(E)!==-1&&(C=!0),_.via.indexOf(E)!==-1&&(k=!0),_.to.indexOf(E)!==-1&&(v=!0),_.keyfrom.indexOf(E)!==-1&&(w=!0),_.keyto.indexOf(E)!==-1&&(A=!0)}if(C&&v&&!b||C&&k||v&&k)return"restriction";if(w||A){if(n.length!==2)return"restriction";var I=null,M=null;for(f=0;f<g.length;f++)a=g[f],a.contains(n[0])&&(I=n[0]),a.contains(n[1])&&(M=n[1]);if(I&&M){var T=!1;for(f=0;f<g.length;f++)if(a=g[f],a.areAdjacent(I,M)){T=!0;break}if(!T)return"restriction"}}for(f=0;f<g.length;f++){for(a=g[f].update({}),h=0;h<n.length;h++)n[h]!==s.id&&(a.areAdjacent(n[h],s.id)?a=a.removeNode(n[h]):a=a.replaceNode(n[h],s.id));if(a.isDegenerate())return"restriction"}}return!1;function R(N,F,B){return B.indexOf(N)!==B.lastIndexOf(N)}function P(N,F){return function(B){return N.indexOf(B)===-1&&F.indexOf(B)===-1}}function D(N,F){var B=t.hasEntity(N.id);if(B){var O=N.role||"";F[O]||(F[O]=[]),N.type==="node"?(F[O].push(N.id),O==="via"&&(F.keyfrom.push(N.id),F.keyto.push(N.id))):N.type==="way"&&(F[O].push.apply(F[O],B.nodes),(O==="from"||O==="via")&&(F.keyfrom.push(B.first()),F.keyfrom.push(B.last())),(O==="to"||O==="via")&&(F.keyto.push(B.first()),F.keyto.push(B.last())))}}},e}function y2(n,e){var t={},r=function(i){n.forEach(function(o){e.entity(o).copy(e,t)});for(var s in t)i=i.replace(t[s]);return i};return r.copies=function(){return t},r}function il(n,e){return function(t){var r=t.entity(n).removeMember(e);return t=t.replace(r),r.isDegenerate()&&(t=$r(r.id)(t)),t}}function ma(n,e){return e=e||{},t=>{return n.modified().forEach(r),n.created().forEach(r),t;function r(i){let s=Object.keys(i.tags),o=!1,a={};for(let l=0;l<s.length;l++){let c=s[l];e[c]||!i.tags[c]?o=!0:a[c]=i.tags[c]}o&&(t=t.replace(i.update({tags:a})))}}}function Eh(n,e){var t,r=function(i){var s=i.entity(n),o=r.connections(i);return o.forEach(function(a){var l=i.entity(a.wayID),c=Le({id:e,loc:s.loc,tags:s.tags});i=i.replace(c),a.index===0&&l.isArea()?i=i.replace(l.replaceNode(l.nodes[0],c.id)):l.isClosed()&&a.index===l.nodes.length-1?i=i.replace(l.unclose().addNode(c.id)):i=i.replace(l.updateNode(c.id,a.index))}),i};return r.connections=function(i){for(var s=[],o=!1,a=i.parentWays(i.entity(n)),l,c,u=0;u<a.length;u++){if(l=a[u],t&&t.indexOf(l.id)===-1){o=!0;continue}if(l.isArea()&&l.nodes[0]===n)s.push({wayID:l.id,index:0});else for(var d=0;d<l.nodes.length;d++)if(c=l.nodes[d],c===n){if(l.isClosed()&&a.length>1&&t&&t.indexOf(l.id)!==-1&&d===l.nodes.length-1)continue;s.push({wayID:l.id,index:d})}}if(o)return s;if(n[1]!=="-"&&s.length>1&&s[0].wayID[1]==="-"){for(var f=1;f<s.length;f++)if(s[f].wayID[1]!=="-")return s.splice(f,1),s}return s.slice(1)},r.disabled=function(i){var s=r.connections(i);if(s.length===0)return"not_connected";var o=i.parentWays(i.entity(n)),a={},l;if(o.forEach(function(c){var u=i.parentRelations(c);u.forEach(function(d){d.id in a?t?(t.indexOf(c.id)!==-1||t.indexOf(a[d.id])!==-1)&&(l=d):l=d:a[d.id]=c.id})}),l)return"relation"},r.limitWays=function(i){return arguments.length?(t=i,r):t},r}function x2(n,e){let t,r=function(o){let a=o.entity(n);return a.type==="node"?i(a,o):s(a,o)};function i(o,a){t=o.id;let l=Le({loc:o.loc});a=a.replace(l);for(let c of a.parentWays(o))a=a.replace(c.replaceNode(n,l.id));for(let c of a.parentRelations(o))a=a.replace(c.replaceMember(o,l));return a}function s(o,a){let l=o.geometry(a),c=["source","wheelchair"],u=["area"],d=/architect|building|height|layer|nycdoitt:bin|roof/i,f=o.asGeoJSON(a),p=(f.type==="LineString"?f.coordinates:f.type==="Polygon"?f.coordinates[0]:f.type==="MultiPolygon"?f.coordinates[0][0]:[]).map(k=>e.project(k)),m;if(p.length)p.length===1?m=p[0]:p.length===2?m=at(p[0],p[1],.5):m=hi(p);else return a;let g=e.unproject(m);(!g||!isFinite(g[0])||!isFinite(g[1]))&&(g=o.extent(a).center());let y={area:!0,corridor:!0,elevator:!0,level:!0,room:!0},x=o.tags.building&&o.tags.building!=="no"||o.tags["building:part"]&&o.tags["building:part"]!=="no",b=l==="area"&&o.tags.indoor&&y[o.tags.indoor],_=Object.assign({},o.tags),S={};for(let k in _)o.type==="relation"&&k==="type"||u.indexOf(k)===-1&&(b&&k==="indoor"||x&&d.test(k)||(S[k]=_[k],!(c.indexOf(k)!==-1||k.match(/^addr:.{1,}/))&&(b&&k==="level"||delete _[k])));!x&&!b&&l==="area"&&(_.area="yes");let C=Le({loc:g,tags:S});return a=a.replace(C),t=C.id,a.replace(o.update({tags:_}))}return r.getExtractedNodeID=function(){return t},r}function xm(n,e={}){function t(i){var s=n.map(function(o){return i.entity(o)});return Object.assign({line:[]},hr(s,function(o){return o.geometry(i)}))}var r=function(i){var s=n.map(i.entity,i);s.sort(function(f,h){var p=f.isSided(),m=h.isSided();return p&&!m?-1:m&&!p?1:0});let o=(s.filter(f=>!f.isNew()).sort((f,h)=>+f.osmId()-+h.osmId())[0]||s[0]).id;var a=xi(s,i),l=a[0];i=a.actions.reduce(function(f,h){return h(f)},i);var c=i.entity(o);if(c=c.update({nodes:l.nodes.map(function(f){return f.id})}),i=i.replace(c),l.forEach(function(f){f.id!==o&&(i.parentRelations(f).forEach(function(h){i=i.replace(h.replaceMember(f,c))}),c=c.mergeTags(f.tags),i=i.replace(c),i=cs(f.id)(i))}),e.tagnosticRoadCombine&&s.length&&s[0].tags.highway){var u=Object.assign({},c.tags);u.highway=s[0].tags.highway,c=c.update({tags:u}),i=i.replace(c)}function d(){if(c.isClosed()){var f=i.parentMultipolygons(c).filter(function(g){return g.members.length===1});if(f.length===1){var h=f[0];for(var p in c.tags)if(h.tags[p]&&h.tags[p]!==c.tags[p])return;c=c.mergeTags(h.tags),i=i.replace(c),i=$r(h.id,!0)(i);var m=Object.assign({},c.tags);c.geometry(i)!=="area"&&(m.area="yes"),delete m.type,c=c.update({tags:m}),i=i.replace(c)}}}return d(),i};return r.resultingWayNodesLength=function(i){return n.reduce(function(s,o){return s+i.entity(o).nodes.length},0)-n.length-1},r.disabled=function(i){var s=t(i);if(n.length<2||n.length!==s.line.length)return"not_eligible";var o=xi(n.map(i.entity,i),i);if(o.length>1)return"not_adjacent";var a;function l(b){return i.parentRelations(i.entity(b)).filter(_=>!_.isRestriction()&&!_.isConnectivity()).map(_=>_.id).sort()}let c=l(n[0]);for(a=1;a<n.length;a++){let b=l(n[a]);if(!Kr(c,b))return"conflicting_relations"}for(a=0;a<n.length-1;a++)for(var u=a+1;u<n.length;u++){var d=i.childNodes(i.entity(n[a])).map(function(b){return b.loc}),f=i.childNodes(i.entity(n[u])).map(function(b){return b.loc}),h=om(d,f),p=bn(o[0].nodes.map(function(b){return b.loc.toString()}),h.map(function(b){return b.toString()}));if(p.length!==h.length)return"paths_intersect"}var m=o[0].nodes.map(function(b){return b.id}).slice(1,-1),g,y={},x=!1;if(o[0].forEach(function(b){var _=i.parentRelations(b);_.forEach(function(C){(C.isRestriction()||C.isConnectivity())&&C.members.some(function(k){return m.indexOf(k.id)>=0})&&(g=C)});for(var S in b.tags)S in y?y[S]&&Yn(S)&&y[S]!==b.tags[S]&&(x=!0,S==="highway"&&e.tagnosticRoadCombine&&!window.mocha&&(x=!1)):y[S]=b.tags[S]}),g)return g.isRestriction()?"restriction":"connectivity";if(x)return"conflicting_tags"},r}function bm(n){function e(r){var i=n.map(function(s){return r.entity(s)});return Object.assign({point:[],area:[],line:[],relation:[]},hr(i,function(s){return s.geometry(r)}))}var t=function(r){var i=e(r),s=i.area[0]||i.line[0],o=i.point;if(o.forEach(function(l){s=s.mergeTags(l.tags),r=r.replace(s),r.parentRelations(l).forEach(function(h){r=r.replace(h.replaceMember(l,s))});for(var c=Ge(r.childNodes(s)),u=l,d=0;d<c.length;d++){var f=c[d];if(!(r.parentWays(f).length>1||r.parentRelations(f).length||f.hasInterestingTags())){r=r.replace(l.update({tags:{},loc:f.loc})),s=s.replaceNode(f.id,l.id),r=r.replace(s),u=f;break}}r=r.remove(u)}),s.tags.area==="yes"){var a=Object.assign({},s.tags);delete a.area,Xa(a)&&(s=s.update({tags:a}),r=r.replace(s))}return r};return t.disabled=function(r){var i=e(r);if(i.point.length===0||i.area.length+i.line.length!==1||i.relation.length!==0)return"not_eligible"},t}function bi(n,e){function t(i){if(!n.length)return null;for(var s=[0,0],o=0,a,l=0;l<n.length;l++){var c=i.entity(n[l]);c.hasInterestingTags()&&(a=++o===1?c.loc:null),s=bt(s,c.loc)}return a||yi(s,1/n.length)}var r=function(i){if(n.length<2)return i;var s=e;s||(s=t(i));for(var o=0;o<n.length;o++){var a=i.entity(n[o]);a.loc!==s&&(i=i.replace(a.move(s)))}return Pc(n)(i)};return r.disabled=function(i){if(n.length<2)return"not_eligible";for(var s=0;s<n.length;s++){var o=i.entity(n[s]);if(o.type!=="node")return"not_eligible"}return Pc(n).disabled(i)},r}function ri(){if(this instanceof ri)arguments.length&&this.initialize(arguments);else return new ri().initialize(arguments)}me.changeset=ri;ri.prototype=Object.create(me.prototype);Object.assign(ri.prototype,{type:"changeset",extent:function(){return new new le()},geometry:function(){return"changeset"},asJXON:function(){return{osm:{changeset:{tag:Object.keys(this.tags).map(function(n){return{"@k":n,"@v":this.tags[n]}},this),"@version":.6,"@generator":"Rapid"}}}},osmChangeJXON:function(n){var e=this.id;function t(s,o){for(var a={},l=0;l<s.length;l++){var c=Object.keys(s[l])[0];a[c]||(a[c]=[]),a[c].push(s[l][c])}var u={};return o.forEach(function(d){a[d]&&(u[d]=a[d])}),u}function r(s){function o(m){return u.find(function(g){return m.keyAttributes.type==="relation"&&m.keyAttributes.ref===g["@id"]})}function a(m){return!c[m["@id"]]&&!l.find(function(g){return g["@id"]===m["@id"]})}var l=[],c={},u=s.relation;if(!u)return s;for(var d=0;d<u.length;d++){var f=u[d];for(c[f["@id"]]||l.push(f);l.length>0;){var h=l[0],p=h.member.map(o).filter(Boolean).filter(a);p.length===0?(c[h["@id"]]=h,l.shift()):l=p.concat(l)}}return s.relation=Object.values(c),s}function i(s){return s.asJXON(e)}return{osmChange:{"@version":.6,"@generator":"Rapid",create:r(t(n.created.map(i),["node","way","relation"])),modify:t(n.modified.map(i),["node","way","relation"]),delete:Object.assign(t(n.deleted.map(i),["relation","way","node"]),{"@if-unused":!0})}}},asGeoJSON:function(){return{}}});function mr(){if(this instanceof mr)arguments.length&&this.initialize(arguments);else return new mr().initialize(arguments)}me.relation=mr;mr.prototype=Object.create(me.prototype);mr.creationOrder=function(n,e){var t=parseInt(me.id.toOSM(n.id),10),r=parseInt(me.id.toOSM(e.id),10);return t<0||r<0?t-r:r-t};Object.assign(mr.prototype,{type:"relation",members:[],copy:function(n,e){if(e[this.id])return e[this.id];var t=me.prototype.copy.call(this,n,e),r=this.members.map(function(i){return Object.assign({},i,{id:n.entity(i.id).copy(n,e).id})});return t=t.update({members:r}),e[this.id]=t,t},extent:function(n,e){return n.transient(this,"extent",function(){if(e&&e[this.id])return new le;e=e||{},e[this.id]=!0;for(var t=new le,r=0;r<this.members.length;r++){var i=n.hasEntity(this.members[r].id);i&&(t=t.extend(i.extent(n,e)))}return t})},geometry:function(n){return n.transient(this,"geometry",function(){return this.isMultipolygon()?"area":"relation"})},isDegenerate:function(){return this.members.length===0},indexedMembers:function(){for(var n=new Array(this.members.length),e=0;e<this.members.length;e++)n[e]=Object.assign({},this.members[e],{index:e});return n},memberByRole:function(n){for(var e=0;e<this.members.length;e++)if(this.members[e].role===n)return Object.assign({},this.members[e],{index:e})},membersByRole:function(n){for(var e=[],t=0;t<this.members.length;t++)this.members[t].role===n&&e.push(Object.assign({},this.members[t],{index:t}));return e},memberById:function(n){for(var e=0;e<this.members.length;e++)if(this.members[e].id===n)return Object.assign({},this.members[e],{index:e})},memberByIdAndRole:function(n,e){for(var t=0;t<this.members.length;t++)if(this.members[t].id===n&&this.members[t].role===e)return Object.assign({},this.members[t],{index:t})},addMember:function(n,e){var t=this.members.slice();return t.splice(e===void 0?t.length:e,0,n),this.update({members:t})},updateMember:function(n,e){var t=this.members.slice();return t.splice(e,1,Object.assign({},t[e],n)),this.update({members:t})},removeMember:function(n){var e=this.members.slice();return e.splice(n,1),this.update({members:e})},removeMembersWithID:function(n){var e=this.members.filter(function(t){return t.id!==n});return this.update({members:e})},moveMember:function(n,e){var t=this.members.slice();return t.splice(e,0,t.splice(n,1)[0]),this.update({members:t})},replaceMember:function(n,e,t){if(!this.memberById(n.id))return this;for(var r=[],i=0;i<this.members.length;i++){var s=this.members[i];s.id!==n.id?r.push(s):(t||!this.memberByIdAndRole(e.id,s.role))&&r.push({id:e.id,type:e.type,role:s.role})}return this.update({members:r})},asJXON:function(n){var e={relation:{"@id":this.osmId(),"@version":this.version||0,member:this.members.map(function(t){return{keyAttributes:{type:t.type,role:t.role,ref:me.id.toOSM(t.id)}}},this),tag:Object.keys(this.tags).map(function(t){return{keyAttributes:{k:t,v:this.tags[t]}}},this)}};return n&&(e.relation["@changeset"]=n),e},asGeoJSON:function(n){return n.transient(this,"GeoJSON",function(){return this.isMultipolygon()?{type:"MultiPolygon",coordinates:this.multipolygon(n)}:{type:"FeatureCollection",properties:this.tags,features:this.members.map(function(e){return Object.assign({role:e.role},n.entity(e.id).asGeoJSON(n))})}})},area:function(n){return n.transient(this,"area",function(){return bo(this.asGeoJSON(n))})},isMultipolygon:function(){return this.tags.type==="multipolygon"},isComplete:function(n){for(var e=0;e<this.members.length;e++)if(!n.hasEntity(this.members[e].id))return!1;return!0},hasFromViaTo:function(){return this.members.some(function(n){return n.role==="from"})&&this.members.some(function(n){return n.role==="via"})&&this.members.some(function(n){return n.role==="to"})},isRestriction:function(){return!!(this.tags.type&&this.tags.type.match(/^restriction:?/))},isValidRestriction:function(){if(!this.isRestriction())return!1;var n=this.members.filter(function(r){return r.role==="from"}),e=this.members.filter(function(r){return r.role==="via"}),t=this.members.filter(function(r){return r.role==="to"});return!(n.length!==1&&this.tags.restriction!=="no_entry"||n.some(function(r){return r.type!=="way"})||t.length!==1&&this.tags.restriction!=="no_exit"||t.some(function(r){return r.type!=="way"})||e.length===0||e.length>1&&e.some(function(r){return r.type!=="way"}))},isConnectivity:function(){return!!(this.tags.type&&this.tags.type.match(/^connectivity:?/))},multipolygon:function(n){var e=this.members.filter(function(c){return(c.role||"outer")==="outer"}),t=this.members.filter(function(c){return c.role==="inner"});e=xi(e,n),t=xi(t,n);var r=function(c){return c.nodes.length>2&&c.nodes[0]!==c.nodes[c.nodes.length-1]&&c.nodes.push(c.nodes[0]),c.nodes.map(function(u){return u.loc})};e=e.map(r),t=t.map(r);var i=e.map(function(c){return[bo({type:"Polygon",coordinates:[c]})>2*Math.PI?c.reverse():c]});function s(c){var u,d;for(u=0;u<e.length;u++)if(d=e[u],u2(d,c))return u;for(u=0;u<e.length;u++)if(d=e[u],s2(d,c,!1))return u}for(var o=0;o<t.length;o++){var a=t[o];bo({type:"Polygon",coordinates:[a]})<2*Math.PI&&(a=a.reverse());var l=s(t[o]);l!==void 0?i[l].push(t[o]):i.push([t[o]])}return i}});var Qe=class n{constructor(e,t,r,i){this.service=e.id,this.itemType=t,this.id=r||`${n.id()}`,this.v=0,this.update(i),e&&typeof e.getIcon=="function"&&(this.icon=e.getIcon(t))}touch(){return this.v++,this}isNew(){return parseInt(this.id,10)<0}update(e){let{service:t,itemType:r,id:i}=this;return Object.keys(e).forEach(s=>this[s]=e[s]),this.service=t,this.itemType=r,this.id=i,this.touch()}get key(){return this.id+"v"+(this.v||0)}static id(){return this.nextId--}};Qe.nextId=-1;function $s(n,e){typeof n=="string"&&(n=[n]);var t,r="longest",i=[];function s(u,d,f){var h=u.entity(d).loc,p=u.entity(f).loc,m=1e-6;return h&&p?ht(h,p):m}function o(u,d,f){var h=new Array(u.length),p,m,g=0,y;function x(_){return Qt(_,0,u.length)}for(p=0,m=x(d+1);m!==d;m=x(m+1))p+=s(f,u[m],u[x(m-1)]),h[m]=p;for(p=0,m=x(d-1);m!==d;m=x(m-1))p+=s(f,u[m],u[x(m+1)]),p<h[m]&&(h[m]=p);for(m=0;m<u.length;m++){var b=h[m]/s(f,u[d],u[m]);b>g&&(y=m,g=b)}return y}function a(u,d){for(var f=0,h=0;h<d.length-1;h++)f+=s(u,d[h],d[h+1]);return f}function l(u,d,f,h){var p=Rt({id:h,tags:f.tags}),m=f.nodes.slice(),g,y,x=f.isArea(),b=g2(f,u);if(f.isClosed()){var _=f.nodes.slice(0,-1),S=_.indexOf(d),C=o(_,S,u);C<S?(g=_.slice(S).concat(_.slice(0,C+1)),y=_.slice(C,S+1)):(g=_.slice(S,C+1),y=_.slice(C).concat(_.slice(0,S+1)))}else{var k=f.nodes.indexOf(d,1);g=f.nodes.slice(0,k+1),y=f.nodes.slice(k)}var v=a(u,g),w=a(u,y);if(r==="longest"&&w>v){f=f.update({nodes:y}),p=p.update({nodes:g});var A=v;v=w,w=A}else f=f.update({nodes:g}),p=p.update({nodes:y});if(f.tags.step_count){var E=parseFloat(f.tags.step_count);if(E&&isFinite(E)&&E>0&&Math.round(E)===E){var I=Object.assign({},f.tags),M=Object.assign({},p.tags),T=v/(v+w),R=Math.round(E*T);I.step_count=R.toString(),M.step_count=(E-R).toString(),f=f.update({tags:I}),p=p.update({tags:M})}}if(u=u.replace(f),u=u.replace(p),u.parentRelations(f).forEach(function(D){var N;if(D.hasFromViaTo()){var F=D.memberByRole("from"),B=D.membersByRole("via"),O=D.memberByRole("to"),G;if(F.id===f.id||O.id===f.id){var U=!1;if(B.length===1&&B[0].type==="node")U=p.contains(B[0].id);else for(G=0;G<B.length;G++)if(B[G].type==="way"){var W=u.hasEntity(B[G].id);if(W&&bn(p.nodes,W.nodes).length){U=!0;break}}U&&(D=D.replaceMember(f,p),u=u.replace(D))}else for(G=0;G<B.length;G++)if(B[G].type==="way"&&B[G].id===f.id){N={id:p.id,type:"way",role:"via"},u=Ic(D.id,N,B[G].index+1)(u);break}}else{D===b&&(u=u.replace(D.mergeTags(f.tags)),u=u.replace(f.update({tags:{}})),u=u.replace(p.update({tags:{}}))),N={id:p.id,type:"way",role:D.memberById(f.id).role};var V={originalID:f.id,insertedID:p.id,nodes:m};u=Ic(D.id,N,void 0,V)(u)}}),!b&&x){var P=mr({tags:Object.assign({},f.tags,{type:"multipolygon"}),members:[{id:f.id,role:"outer",type:"way"},{id:p.id,role:"outer",type:"way"}]});u=u.replace(P),u=u.replace(f.update({tags:{}})),u=u.replace(p.update({tags:{}}))}return i.push(p.id),u}var c=function(u){i=[];for(var d=0,f=0;f<n.length;f++)for(var h=n[f],p=c.waysForNode(h,u),m=0;m<p.length;m++)u=l(u,h,p[m],e&&e[d]),d+=1;return u};return c.getCreatedWayIDs=function(){return i},c.waysForNode=function(u,d){var f=d.entity(u),h=d.parentWays(f).filter(m);if(!t){var p=h.some(function(g){return g.geometry(d)==="line"});if(p)return h.filter(function(g){return g.geometry(d)==="line"})}return h;function m(g){if(t&&t.indexOf(g.id)===-1)return!1;if(g.isClosed())return!0;for(var y=1;y<g.nodes.length-1;y++)if(g.nodes[y]===u)return!0;return!1}},c.ways=function(u){return Ge([].concat.apply([],n.map(function(d){return c.waysForNode(d,u)})))},c.disabled=function(u){for(var d=0;d<n.length;d++){var f=n[d],h=c.waysForNode(f,u);if(h.length===0||t&&t.length!==h.length)return"not_eligible"}},c.limitWays=function(u){return arguments.length?(t=u,c):t},c.keepHistoryOn=function(u){return arguments.length?(r=u,c):r},c}var hq=50,wo=class n{constructor(e,t){this.context=e,this.array=t,this._memo=new Map}item(e){let t=this._memo.get(e);return t||(t=this.array.find(r=>r.id===e),t&&this._memo.set(e,t),t)}index(e){return this.array.findIndex(t=>t.id===e)}matchGeometry(e){let t=this.array.filter(r=>r.matchGeometry(e));return new n(this.context,t)}matchAllGeometry(e){let t=this.array.filter(r=>r&&r.matchAllGeometry(e));return new n(this.context,t)}fallback(e){let t=e;return t==="vertex"&&(t="point"),this.item(t)}search(e,t,r){if(!e)return this;e=e.toLowerCase().trim();function i(S){let C=S.indexOf(e);return C===0||S[C-1]===" "}function s(S){return S.indexOf(e)===0}function o(S){return function(k,v){let w=k[S](),A=v[S]();if(e===w)return-1;if(e===A)return 1;let E=v.orig.matchScore-k.orig.matchScore;return E!==0||(E=w.indexOf(e)-A.indexOf(e),E!==0)?E:w.length-A.length}}let a=this.array.filter(S=>S.matchGeometry(t));if(Array.isArray(r)){let C=this.context.systems.locations.locationSetsAt(r);a=a.filter(k=>!k.locationSetID||C[k.locationSetID])}let l=a.filter(S=>S.searchable!==!1&&S.suggestion!==!0),c=a.filter(S=>S.suggestion===!0),u=l.filter(S=>i(S.searchName())).sort(o("searchName")),d=c.filter(S=>s(S.searchName())).sort(o("searchName")),f=l.filter(S=>i(S.searchNameStripped())).sort(o("searchNameStripped")),h=c.filter(S=>s(S.searchNameStripped())).sort(o("searchNameStripped")),p=l.filter(S=>(S.terms()||[]).some(i)),m=c.filter(S=>(S.terms()||[]).some(i)),g=l.filter(S=>Object.values(S.tags||{}).filter(C=>C!=="*").some(i)),y=l.map(S=>({preset:S,dist:S6(e,S.searchName())})).filter(S=>S.dist+Math.min(e.length-S.preset.searchName().length,0)<3).sort((S,C)=>S.dist-C.dist).map(S=>S.preset),x=c.map(S=>({preset:S,dist:S6(e,S.searchName())})).filter(S=>S.dist+Math.min(e.length-S.preset.searchName().length,0)<1).sort((S,C)=>S.dist-C.dist).map(S=>S.preset),b=l.filter(S=>(S.terms()||[]).some(C=>S6(e,C)+Math.min(e.length-C.length,0)<3)),_=u.concat(d,f,h,p,m,g,y,x,b).slice(0,hq-1);if(typeof t=="string"){let S=this.fallback(t);S&&_.push(S)}return new n(this.context,Ge(_))}};var b2=class{constructor(e,t,r,i={}){this.context=e,this.id=t,this.safeid=wc(t),this.allPresets=i,this.orig={},this.orig.name=r.name??"",this.orig.icon=r.icon,this.orig.matchScore=-1,this.orig.members=r.members??[],Object.assign(this,Ir(this.orig,["name","matchScore","members"]));let s=this.orig.members.map(o=>i[o]).filter(Boolean);this.members=new wo(e,s),this.geometry=s.reduce((o,a)=>{for(let l in a.geometry){let c=a.geometry[l];o.indexOf(c)===-1&&o.push(c)}return o},[]),this._searchName=null,this._searchNameStripped=null}matchGeometry(e){return this.geometry.includes(e)}matchAllGeometry(e){return this.members.array.some(t=>t.matchAllGeometry(e))}matchScore(){return-1}name(){return this.context.systems.l10n.t(`_tagging.presets.categories.${this.id}.name`,{default:this.id})}nameLabel(){return this.context.systems.l10n.tHtml(`_tagging.presets.categories.${this.id}.name`,{default:this.id})}terms(){return[]}searchName(){return this._searchName||(this._searchName=this.name().toLowerCase()),this._searchName}searchNameStripped(){return this._searchNameStripped||(this._searchNameStripped=this._stripDiacritics(this.searchName())),this._searchNameStripped}searchAliases(){return[]}searchAliasesStripped(){return[]}isFallback(){return!1}_stripDiacritics(e){return e.normalize&&(e=e.normalize("NFD")),e=e.replace(/[\u0300-\u036f]/g,""),e}};var Th=Ot(_2(),1);var Fn=class{constructor(e,t){if(this._base=e,this._head=t,this._changes=new Map,this.didChange={},e===t)return;let r=new Set([...t.local.entities.keys(),...e.local.entities.keys()]);for(let i of r){let s=t.hasEntity(i),o=e.hasEntity(i);if(s!==o){if(o&&!s){this._changes.set(i,{base:o,head:s}),this.didChange.deletion=!0;continue}if(!o&&s){this._changes.set(i,{base:o,head:s}),this.didChange.addition=!0;continue}if(s&&o){if(s.members&&o.members&&!(0,Th.default)(s.members,o.members)){this._changes.set(i,{base:o,head:s}),this.didChange.geometry=!0,this.didChange.properties=!0;continue}s.loc&&o.loc&&!He(s.loc,o.loc)&&(this._changes.set(i,{base:o,head:s}),this.didChange.geometry=!0),s.nodes&&o.nodes&&!(0,Th.default)(s.nodes,o.nodes)&&(this._changes.set(i,{base:o,head:s}),this.didChange.geometry=!0),s.tags&&o.tags&&!(0,Th.default)(s.tags,o.tags)&&(this._changes.set(i,{base:o,head:s}),this.didChange.properties=!0)}}}}get changes(){return this._changes}modified(){let e=[];for(let t of this._changes.values())t.base&&t.head&&e.push(t.head);return e}created(){let e=[];for(let t of this._changes.values())!t.base&&t.head&&e.push(t.head);return e}deleted(){let e=[];for(let t of this._changes.values())t.base&&!t.head&&e.push(t.base);return e}summary(){let e=this._base,t=this._head,r=new Map;for(let s of this._changes.values()){let o=s.head,a=s.base;if(o&&o.geometry(t)!=="vertex")i(o,t,a?"modified":"created");else if(a&&a.geometry(e)!=="vertex")i(a,e,"deleted");else if(a&&o){let l=!He(a.loc,o.loc),c=!(0,Th.default)(a.tags,o.tags);if(l)for(let u of t.parentWays(o))r.has(u.id)||i(u,t,"modified");(c||l&&o.hasInterestingTags())&&i(o,t,"modified")}else o&&o.hasInterestingTags()?i(o,t,"created"):a&&a.hasInterestingTags()&&i(a,e,"deleted")}return r;function i(s,o,a){r.set(s.id,{entity:s,graph:o,changeType:a})}}complete(){let e=this._head,t=new Map;for(let[i,s]of this._changes){let o=s.head,a=s.base,l=o||a;if(t.set(i,o),l.type==="way"){let c=o?o.nodes:[],u=a?a.nodes:[];for(let d of Ur(c,u))t.set(d,e.hasEntity(d))}if(l.type==="relation"&&l.isMultipolygon()){let c=o?o.members.map(d=>d.id):[],u=a?a.members.map(d=>d.id):[];for(let d of Ur(c,u)){let f=e.hasEntity(d);f&&t.set(d,f)}}r(e.parentWays(l),t),r(e.parentRelations(l),t)}return t;function r(i){for(let s of i)t.has(s.id)||(t.set(s.id,s),r(e.parentRelations(s)))}}};var ga=class{constructor(e){this.annotation=e.annotation,this.graph=e.graph,this.selectedIDs=e.selectedIDs,this.sources=e.sources||{},this.transform=e.transform}};var ol=Ot(OR(),1);function Pm(n,e,t=0,r=n.length-1,i=Qq){for(;r>t;){if(r-t>600){let l=r-t+1,c=e-t+1,u=Math.log(l),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(l-d)/l)*(c-l/2<0?-1:1),h=Math.max(t,Math.floor(e-c*d/l+f)),p=Math.min(r,Math.floor(e+(l-c)*d/l+f));Pm(n,e,h,p,i)}let s=n[e],o=t,a=r;for(kh(n,t,e),i(n[r],s)>0&&kh(n,t,r);o<a;){for(kh(n,o,a),o++,a--;i(n[o],s)<0;)o++;for(;i(n[a],s)>0;)a--}i(n[t],s)===0?kh(n,t,a):(a++,kh(n,a,r)),a<=e&&(t=a+1),e<=a&&(r=a-1)}}function kh(n,e,t){let r=n[e];n[e]=n[t],n[t]=r}function Qq(n,e){return n<e?-1:n>e?1:0}var Tt=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data,r=[];if(!Mm(e,t))return r;let i=this.toBBox,s=[];for(;t;){for(let o=0;o<t.children.length;o++){let a=t.children[o],l=t.leaf?i(a):a;Mm(e,l)&&(t.leaf?r.push(a):Zv(e,l)?this._all(a,r):s.push(a))}t=s.pop()}return r}collides(e){let t=this.data;if(!Mm(e,t))return!1;let r=[];for(;t;){for(let i=0;i<t.children.length;i++){let s=t.children[i],o=t.leaf?this.toBBox(s):s;if(Mm(e,o)){if(t.leaf||Zv(e,o))return!0;r.push(s)}}t=r.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let r=0;r<e.length;r++)this.insert(e[r]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){let r=this.data;this.data=t,t=r}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=E2([]),this}remove(e,t){if(!e)return this;let r=this.data,i=this.toBBox(e),s=[],o=[],a,l,c;for(;r||s.length;){if(r||(r=s.pop(),l=s[s.length-1],a=o.pop(),c=!0),r.leaf){let u=Zq(e,r.children,t);if(u!==-1)return r.children.splice(u,1),s.push(r),this._condense(s),this}!c&&!r.leaf&&Zv(r,i)?(s.push(r),o.push(a),a=0,l=r,r=r.children[0]):l?(a++,r=l.children[a],c=!1):r=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){let r=[];for(;e;)e.leaf?t.push(...e.children):r.push(...e.children),e=r.pop();return t}_build(e,t,r,i){let s=r-t+1,o=this._maxEntries,a;if(s<=o)return a=E2(e.slice(t,r+1)),A2(a,this.toBBox),a;i||(i=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,i-1))),a=E2([]),a.leaf=!1,a.height=i;let l=Math.ceil(s/o),c=l*Math.ceil(Math.sqrt(o));LR(e,t,r,c,this.compareMinX);for(let u=t;u<=r;u+=c){let d=Math.min(u+c-1,r);LR(e,u,d,l,this.compareMinY);for(let f=u;f<=d;f+=l){let h=Math.min(f+l-1,d);a.children.push(this._build(e,f,h,i-1))}}return A2(a,this.toBBox),a}_chooseSubtree(e,t,r,i){for(;i.push(t),!(t.leaf||i.length-1===r);){let s=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){let c=t.children[l],u=Qv(c),d=tY(e,c)-u;d<o?(o=d,s=u<s?u:s,a=c):d===o&&u<s&&(s=u,a=c)}t=a||t.children[0]}return t}_insert(e,t,r){let i=r?e:this.toBBox(e),s=[],o=this._chooseSubtree(i,this.data,t,s);for(o.children.push(e),Ph(o,i);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(i,s,t)}_split(e,t){let r=e[t],i=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,i);let o=this._chooseSplitIndex(r,s,i),a=E2(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,A2(r,this.toBBox),A2(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this.data=E2([e,t]),this.data.height=e.height+1,this.data.leaf=!1,A2(this.data,this.toBBox)}_chooseSplitIndex(e,t,r){let i,s=1/0,o=1/0;for(let a=t;a<=r-t;a++){let l=Ih(e,0,a,this.toBBox),c=Ih(e,a,r,this.toBBox),u=rY(l,c),d=Qv(l)+Qv(c);u<s?(s=u,i=a,o=d<o?d:o):u===s&&d<o&&(o=d,i=a)}return i||r-t}_chooseSplitAxis(e,t,r){let i=e.leaf?this.compareMinX:Jq,s=e.leaf?this.compareMinY:eY,o=this._allDistMargin(e,t,r,i),a=this._allDistMargin(e,t,r,s);o<a&&e.children.sort(i)}_allDistMargin(e,t,r,i){e.children.sort(i);let s=this.toBBox,o=Ih(e,0,t,s),a=Ih(e,r-t,r,s),l=Dm(o)+Dm(a);for(let c=t;c<r-t;c++){let u=e.children[c];Ph(o,e.leaf?s(u):u),l+=Dm(o)}for(let c=r-t-1;c>=t;c--){let u=e.children[c];Ph(a,e.leaf?s(u):u),l+=Dm(a)}return l}_adjustParentBBoxes(e,t,r){for(let i=r;i>=0;i--)Ph(t[i],e)}_condense(e){for(let t=e.length-1,r;t>=0;t--)e[t].children.length===0?t>0?(r=e[t-1].children,r.splice(r.indexOf(e[t]),1)):this.clear():A2(e[t],this.toBBox)}};function Zq(n,e,t){if(!t)return e.indexOf(n);for(let r=0;r<e.length;r++)if(t(n,e[r]))return r;return-1}function A2(n,e){Ih(n,0,n.children.length,e,n)}function Ih(n,e,t,r,i){i||(i=E2(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=e;s<t;s++){let o=n.children[s];Ph(i,n.leaf?r(o):o)}return i}function Ph(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function Jq(n,e){return n.minX-e.minX}function eY(n,e){return n.minY-e.minY}function Qv(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Dm(n){return n.maxX-n.minX+(n.maxY-n.minY)}function tY(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function rY(n,e){let t=Math.max(n.minX,e.minX),r=Math.max(n.minY,e.minY),i=Math.min(n.maxX,e.maxX),s=Math.min(n.maxY,e.maxY);return Math.max(0,i-t)*Math.max(0,s-r)}function Zv(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function Mm(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function E2(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function LR(n,e,t,r,i){let s=[e,t];for(;s.length;){if(t=s.pop(),e=s.pop(),t-e<=r)continue;let o=e+Math.ceil((t-e)/r/2)*r;Pm(n,o,e,t,i),s.push(e,o,o,t)}}var $i=class{constructor(e,t){this.context=e,this._id=t.id,this._idtx=t.id.replace(/\./g,"<TX_DOT>"),this._name=t.name,this._description=t.description,this._template=t.encrypted?$D(t.template):t.template,this.alpha=t.alpha||1,this.best=!!t.best,this.endDate=t.endDate,this.icon=t.icon,this.overlay=t.overlay,this.polygon=t.polygon,this.projection=t.projection,this.startDate=t.startDate,this.terms_html=t.terms_html,this.terms_text=t.terms_text,this.terms_url=t.terms_url,this.tileSize=t.tileSize||256,this.type=t.type,this.zoomExtent=t.zoomExtent||[0,22],this.zoomRange=t.zoomRange||5,this.isBlocked=!1,this.offset=[0,0]}get id(){return this._id}get idtx(){return this._idtx}get key(){return this._id}get name(){return this.context.systems.l10n.t(`_imagery.imagery.${this._idtx}.name`,{default:this._name})}get description(){return this.context.systems.l10n.t(`_imagery.imagery.${this._idtx}.description`,{default:this._description})}get imageryUsed(){return this._name||this._id}get template(){return this._template}get area(){if(!this.polygon)return Number.MAX_VALUE;let e=bo({type:"MultiPolygon",coordinates:[this.polygon]});return isNaN(e)?0:e}validZoom(e){if(Number.isNaN(e))return!1;let[t,r]=this.zoomExtent;return e>=t&&e<=r}isLocatorOverlay(){return this._id==="mapbox_locator_overlay"}getMetadata(e,t,r){let i={start:this._localeDateString(this.startDate),end:this._localeDateString(this.endDate)};i.range=this._vintageRange(i),r(null,{vintage:i})}nudge(e,t){return this.offset[0]+=e[0]/Math.pow(2,t),this.offset[1]+=e[1]/Math.pow(2,t),this}url(e){let t=this.template,r=t;if(r==="")return r;function i(s,o,a,l){let c=Math.pow(2,l),u=o/c*Math.PI*2-Math.PI,d=Math.atan(Math.sinh(Math.PI*(1-2*a/c))),f;switch(s){case"EPSG:4326":return{x:u*180/Math.PI,y:d*180/Math.PI};default:return f=K6(u,d),{x:2003750834e-2/Math.PI*f[0],y:2003750834e-2/Math.PI*f[1]}}}if(this.type||(/SERVICE=WMS|\{(proj|wkid|bbox)\}/.test(t)?(this.type="wms",this.projection="EPSG:3857"):/\{(x|y)\}/.test(t)?this.type="tms":/\{u\}/.test(t)&&(this.type="bing")),this.type==="wms"){let s=this.tileSize,o=this.projection,a=i(o,e[0],e[1],e[2]),l=i(o,e[0]+1,e[1]+1,e[2]);r=r.replace(/\{(\w+)\}/g,(c,u)=>{switch(u){case"width":case"height":return s;case"proj":return o;case"wkid":return o.replace(/^EPSG:/,"");case"bbox":return o==="EPSG:4326"&&/VERSION=1.3|CRS={proj}/.test(t.toUpperCase())?l.y+","+a.x+","+a.y+","+l.x:a.x+","+l.y+","+l.x+","+a.y;case"w":return a.x;case"s":return l.y;case"n":return l.x;case"e":return a.y;default:return c}})}else if(this.type==="tms"){let s=window.devicePixelRatio&&window.devicePixelRatio>=2;r=r.replace("{x}",e[0]).replace("{y}",e[1]).replace(/\{[t-]y\}/,Math.pow(2,e[2])-e[1]-1).replace(/\{z(oom)?\}/,e[2]).replace(/\{@2x\}|\{r\}/,s?"@2x":"")}else this.type==="bing"&&(r=r.replace("{u}",()=>{let s="";for(let o=e[2];o>0;o--){let a=0,l=1<<o-1;e[0]&l&&a++,e[1]&l&&(a+=2),s+=a.toString()}return s}));return r=r.replace(/\{switch:([^}]+)\}/,(s,o)=>{let a=o.split(",");return a[(e[0]+e[1])%a.length]}),r}_localeDateString(e){if(!e)return null;let t=new Date(e+"T00:00:00Z");return isNaN(t.getTime())?null:t.toISOString().split("T")[0]}_vintageRange(e){let t;return(e.start||e.end)&&(t=e.start||"?",e.start!==e.end&&(t+=" - "+(e.end||"?"))),t}},T2=class extends $i{constructor(e){super(e,{id:"none",template:""})}get name(){return this.context.systems.l10n.t("background.none")}get area(){return-1}get imageryUsed(){return null}},k2=class extends $i{constructor(e,t=""){super(e,{id:"custom",template:t})}get name(){return this.context.systems.l10n.t("background.custom")}get area(){return-2}get imageryUsed(){let e=this.template,[t,r]=e.split("?",2);if(r){let i=sa(r);for(let s of Object.keys(i))/^(access_token|connectid|key|signature|token)$/i.test(s)&&(i[s]="{apikey}");e=t+"?"+ft(i,!0)}return e=e.replace(/token\/(\w+)/,"token/{apikey}").replace(/key=(\w+)/,"key={apikey}"),`Custom (${e} )`}set template(e){this._template=e}get template(){return this._template}},I2=class extends $i{constructor(e,t){super(e,t),this._template="https://ecn.t{switch:0,1,2,3}.tiles.virtualearth.net/tiles/a{u}.jpeg?g=1&pr=odbl&n=z",this.terms_url="https://blog.openstreetmap.org/2010/11/30/microsoft-imagery-details"}},Mc=class extends $i{constructor(e,t){super(e,t),/blankTile/.test(this._template)||(this._template+="?blankTile=false"),this._cache={},this._inflight={},this._prevLoc=null}fetchTilemap(e){if(this._prevLoc&&ht(e,this._prevLoc)<5e3)return;this._prevLoc=e;let t=this.url([1,2,3]),r=20,i=Math.floor((e[0]+180)/360*Math.pow(2,r)),s=Math.floor((1-Math.log(Math.tan(e[1]*Math.PI/180)+1/Math.cos(e[1]*Math.PI/180))/Math.PI)/2*Math.pow(2,r)),o=t.replace(/tile\/[0-9]+\/[0-9]+\/[0-9]+\?blankTile=false/,"tilemap")+"/"+r+"/"+s+"/"+i+"/8/8";fetch(o).then(Ae).then(a=>{if(!a)throw new Error("Unknown Error");let l=!0;for(let c=0;c<a.data.length;c++)a.data[c]||(l=!1);this.zoomExtent[1]=l?22:19}).catch(a=>console.error(a))}getMetadata(e,t,r){let i=t.slice(0,3).join("/"),s=Math.min(t[2],this.zoomExtent[1]),o=this.context.systems.l10n.t("inspector.unknown");if(this._inflight[i])return;let a;switch(!0){case(s>=20&&this._id==="EsriWorldImageryClarity"):a=4;break;case s>=19:a=3;break;case s>=17:a=2;break;case s>=13:a=0;break;default:a=99}let l;if(this._id==="EsriWorldImagery")l="https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/";else if(this._id==="EsriWorldImageryClarity")l="https://serviceslab.arcgisonline.com/arcgis/rest/services/Clarity_World_Imagery/MapServer/";else return;if(l+=a+"/query?returnGeometry=false&geometry="+e.join(",")+"&inSR=4326&geometryType=esriGeometryPoint&outFields=*&f=json",this._cache[i]||(this._cache[i]={}),this._cache[i]&&this._cache[i].metadata)return r(null,this._cache[i].metadata);let c={},u={};a===99?(c={start:null,end:null,range:null},u={vintage:null,source:o,description:o,resolution:o,accuracy:o},r(null,u)):(this._inflight[i]=!0,fetch(l).then(Ae).then(f=>{if(delete this._inflight[i],f){if(f.features&&f.features.length<1)throw new Error("No Results");if(f.error&&f.error.message)throw new Error(f.error.message)}else throw new Error("Unknown Error");let h=this._localeDateString(f.features[0].attributes.SRC_DATE2);c={start:h,end:h,range:h},u={vintage:c,source:d(f.features[0].attributes.NICE_NAME),description:d(f.features[0].attributes.NICE_DESC),resolution:d(+parseFloat(f.features[0].attributes.SRC_RES).toFixed(4)),accuracy:d(+parseFloat(f.features[0].attributes.SRC_ACC).toFixed(4))},isFinite(u.resolution)&&(u.resolution+=" m"),isFinite(u.accuracy)&&(u.accuracy+=" m"),this._cache[i].metadata=u,r&&r(null,u)}).catch(f=>{delete this._inflight[i],r&&r(f.message)}));function d(f){return String(f).trim()||o}}},Rm=class extends Mc{constructor(e,t){super(e,t),this._initPromise=null,this._refreshPromise=null,this._tiler=new or,this._waybackData=new Map,this._releaseDateCache=new Tt,this._oldestDate=null,this._newestDate=null}get key(){let e=this._id,t=this.date;return t&&(e+=`_${t}`),e}get name(){return this.context.systems.l10n.t("background.wayback.name",{default:this._name})}get description(){return this.context.systems.l10n.t("background.wayback.description",{default:this._description})}get template(){return this._waybackData.get(this.startDate)?.template||this._template}get imageryUsed(){let e=this._name,t=this.date;return t&&(e+=` (${t})`),e}get oldestDate(){return this._oldestDate}get newestDate(){return this._newestDate}get localReleaseDates(){let e,[t,r]=this.context.viewport.centerLoc(),i=this._releaseDateCache.search({minX:t,minY:r,maxX:t,maxY:r});return i.length?e=new Set(i[0].releaseDates):e=new Set,this._oldestDate&&e.add(this._oldestDate),this._newestDate&&e.add(this._newestDate),this.startDate&&e.add(this.startDate),[...e].sort().reverse()}set date(e){let t=this._localeDateString(e);if(!t)return;let r=[...this._waybackData.keys()].sort(),i=r[0];for(let s=1;s<r.length&&!(t.localeCompare(i)<=0);s++)i=r[s];this.startDate=i,this.endDate=i}get date(){return this.startDate}initWaybackAsync(){return this._initPromise?this._initPromise:this._initPromise=new Promise(e=>{this.context.systems.assets.loadAssetAsync("wayback").then(i=>ol.setWaybackConfigData(i.wayback)).then(()=>ol.getWaybackItems().then(i=>{if(!Array.isArray(i)||!i.length)throw new Error("No Wayback data");this._oldestDate=i.at(-1).releaseDateLabel,this._newestDate=i.at(0).releaseDateLabel,this.startDate=this.endDate=this._newestDate;for(let s of i)s.template=s.itemURL.replaceAll("{level}","{zoom}").replaceAll("{row}","{y}").replaceAll("{col}","{x}"),s.startDate=s.endDate=s.releaseDateLabel,this._waybackData.set(s.releaseDateLabel,s)})).catch(i=>console.error(i)).finally(()=>e())})}refreshLocalReleaseDatesAsync(){let[e,t]=this.context.viewport.centerLoc(),r=this._releaseDateCache.search({minX:e,minY:t,maxX:e,maxY:t});if(r.length)return Promise.resolve(r[0].releaseDates);if(this._refreshPromise)return this._refreshPromise;let i=14,s=gi(i),[o,a]=new Rn({k:s}).project([e,t]),l=new Rn({k:s,x:-o,y:-a}),c=this._tiler.zoomRange(i).getTiles(l).tiles[0];return this._refreshPromise=new Promise(u=>{ol.getWaybackItemsWithLocalChanges({latitude:t,longitude:e},i).then(d=>{if(!Array.isArray(d)||!d.length)throw new Error("No locally changed Wayback data");let f=c.wgs84Extent.bbox();return f.id=c.id,f.releaseDates=new Set(d.map(h=>h.releaseDateLabel)),this._releaseDateCache.insert(f),f.releaseDates}).catch(d=>(console.error(d),new Set)).then(d=>{this._refreshPromise=null,u(d)})})}getMetadata(e,t,r){let i={longitude:e[0],latitude:e[1]},s=Math.min(t[2],this.zoomExtent[1]),o=this._waybackData.get(this.startDate);if(!o){r(null,{});return}ol.getMetadata(i,s,o.releaseNum).then(a=>{let l=this.context.systems.l10n.t("inspector.unknown"),c=new Date(a.date).toISOString().split("T")[0],d={vintage:{start:c,end:c,range:c},source:f(a.source),description:f(a.provider),resolution:f(+parseFloat(a.resolution).toFixed(4)),accuracy:f(+parseFloat(a.accuracy).toFixed(4))};isFinite(d.resolution)&&(d.resolution+=" m"),isFinite(d.accuracy)&&(d.accuracy+=" m"),r(null,d);function f(h){return String(h).trim()||l}}).catch(a=>{console.error(a),r(a)})}};var P2=class{constructor(e,t,r,i={}){this.context=e,this.id=t,this.safeid=wc(t),this.allFields=i,this.orig={},this.orig.autoSuggestions=r.autoSuggestions??!0,this.orig.caseSensitive=r.caseSensitive??!1,this.orig.customValues=r.customValues??!0,this.orig.default=r.default,this.orig.geometry=r.geometry,this.orig.icon=r.icon,this.orig.increment=r.increment??1,this.orig.key=r.key,this.orig.keys=r.keys??[r.key],this.orig.label=r.label??"",this.orig.locationSet=r.locationSet,this.orig.maxValue=r.maxValue,this.orig.minValue=r.minValue,this.orig.options=r.options,this.orig.pattern=r.pattern,this.orig.placeholder=r.placeholder??"",this.orig.prerequisiteTag=r.prerequisiteTag,this.orig.reference=r.reference,this.orig.snake_case=r.snake_case??!0,this.orig.strings=r.strings,this.orig.terms=(r.terms??[]).join(),this.orig.type=r.type,this.orig.universal=r.universal??!1,this.orig.urlFormat=r.urlFormat,this.orig.usage=r.usage,Object.assign(this,Ir(this.orig,["increment","label","placeholder","terms"])),this.title=this.title.bind(this),this.label=this.label.bind(this),this.placeholder=this.placeholder.bind(this),this.terms=this.terms.bind(this)}increment(){return this.type==="number"?this.orig.increment:void 0}title(){return this._resolveReference("label").t("label",{default:this.orig.label||this.id})}label(){return this._resolveReference("label").tHtml("label",{default:this.orig.label||this.id})}placeholder(){return this._resolveReference("placeholder").t("placeholder",{default:this.orig.placeholder})}terms(){return this._resolveReference("terms").t("terms",{default:this.orig.terms}).toLowerCase().trim().split(/\s*,+\s*/)}matchGeometry(e){return!this.geometry||this.geometry.indexOf(e)!==-1}matchAllGeometry(e){return!this.geometry||e.every(t=>this.geometry.indexOf(t)!==-1)}t(e,t){return this.context.systems.l10n.t(`_tagging.presets.fields.${this.id}.${e}`,t)}tHtml(e,t){return this.context.systems.l10n.tHtml(`_tagging.presets.fields.${this.id}.${e}`,t)}tAppend(e,t){return this.context.systems.l10n.tAppend(`_tagging.presets.fields.${this.id}.${e}`,t)}hasTextForStringID(e){return this.context.systems.l10n.hasTextForStringID(`_tagging.presets.fields.${this.id}.${e}`)}_resolveReference(e){let r=(this.orig[e]||"").match(/^\{(.*)\}$/);if(r){let i=this.allFields[r[1]];if(i)return i;console.error(`Unable to resolve referenced field: ${r[1]}`)}return this}};var Fr=class n{constructor(e,t){e instanceof n?(this._base=e._base,this._local={entities:new Map(e._local.entities),parentWays:new Map(e._local.parentWays),parentRels:new Map(e._local.parentRels)}):(this._base={entities:new Map,parentWays:new Map,parentRels:new Map},this._local={entities:new Map,parentWays:new Map,parentRels:new Map},this.rebase(e||[],[this])),this._transients=new Map,this._childNodes=new Map,this._frozen=!t}get base(){return this._base}get local(){return this._local}get frozen(){return this._frozen}hasEntity(e){let t=this._base.entities,r=this._local.entities;return r.has(e)?r.get(e):t.get(e)}entity(e){let t=this.hasEntity(e);if(!t)throw new Error(`Entity ${e} not found`);return t}geometry(e){return this.entity(e).geometry(this)}transient(e,t,r){let i=e.id,s=this._transients.get(i);s||(s=new Map,this._transients.set(i,s));let o=s.get(t);return o!==void 0||(o=r.call(e),s.set(t,o)),o}isPoi(e){if(e.type!=="node")return!1;let t=this._base.parentWays;return(this._local.parentWays.get(e.id)??t.get(e.id)??new Set).size===0}isShared(e){if(e.type!=="node")return!1;let t=this._base.parentWays,i=this._local.parentWays.get(e.id)??t.get(e.id)??new Set;if(i.size===0)return!1;if(i.size>1)return!0;let s=[...i][0],o=this.entity(s),a=o.isClosed()?o.nodes.length-1:o.nodes.length;for(let l=0,c=0;l<a;l++)if(e.id===o.nodes[l]&&c++,c>1)return!0;return!1}parentWays(e){let t=this._base.parentWays,i=this._local.parentWays.get(e.id)??t.get(e.id)??new Set;return Array.from(i).map(s=>this.entity(s))}parentRelations(e){let t=this._base.parentRels,i=this._local.parentRels.get(e.id)??t.get(e.id)??new Set;return Array.from(i).map(s=>this.entity(s))}parentMultipolygons(e){return this.parentRelations(e).filter(t=>t.isMultipolygon())}childNodes(e){if(!e.nodes)return[];let t=this._childNodes.get(e.id);if(t)return t;t=new Array(e.nodes.length);for(let r=0;r<e.nodes.length;++r)t[r]=this.entity(e.nodes[r]);return this._childNodes.set(e.id,t),t}rebase(e,t,r){let i=this._base,s=t[t.length-1]._local.entities,o=new Set;for(let a of e)if(!(!a.visible||!r&&i.entities.has(a.id))&&(i.entities.set(a.id,a),this._updateCalculated(void 0,a,i.parentWays,i.parentRels),a.type==="way"))for(let l of a.nodes)s.has(l)&&s.get(l)===void 0&&o.add(l);for(let a of t){let l=a._local.entities;for(let c of o)l.has(c)&&l.get(c)===void 0&&l.delete(c);a._updateRebased()}}_updateRebased(){let e=this._base,t=this._local;for(let[r,i]of t.parentWays){let s=e.parentWays.get(r);if(s)for(let o of s)t.entities.has(o)||i.add(o)}for(let[r,i]of t.parentRels){let s=e.parentRels.get(r);if(s)for(let o of s)t.entities.has(o)||i.add(o)}this._transients=new Map}_updateCalculated(e,t,r,i){let s=this._base,o=this._local;r=r||o.parentWays,i=i||o.parentRels;let a=t??e;if(!a)return;let l,c;if(a.type==="way"){e&&t?(l=an(e.nodes,t.nodes),c=an(t.nodes,e.nodes)):e?(l=e.nodes,c=[]):t&&(l=[],c=t.nodes);for(let u of l){let d=new Set(o.parentWays.get(u)??s.parentWays.get(u)??[]);d.delete(a.id),r.set(u,d)}for(let u of c){let d=new Set(o.parentWays.get(u)??s.parentWays.get(u)??[]);d.add(a.id),r.set(u,d)}}else if(a.type==="relation"){let u=e?e.members.map(f=>f.id):[],d=t?t.members.map(f=>f.id):[];e&&t?(l=an(u,d),c=an(d,u)):e?(l=u,c=[]):t&&(l=[],c=d);for(let f of l){let h=new Set(o.parentRels.get(f)??s.parentRels.get(f)??[]);h.delete(a.id),i.set(f,h)}for(let f of c){let h=new Set(o.parentRels.get(f)??s.parentRels.get(f)??[]);h.add(a.id),i.set(f,h)}}}replace(e){let t=e.id,r=this.hasEntity(t);return r===e?this:this.update(function(){this._updateCalculated(r,e),this._local.entities.set(t,e)})}remove(e){let t=e.id,r=this.hasEntity(t);return r?this.update(function(){this._updateCalculated(r,void 0),this._local.entities.set(t,void 0)}):this}revert(e){let t=this._base.entities.get(e),r=this.hasEntity(e);return r===t?this:this.update(function(){this._updateCalculated(r,t),this._local.entities.delete(e)})}update(...e){let t=this._frozen?new n(this,!0):this;for(let r of e)r.call(t,t);return this._frozen&&(t._frozen=!0),t}load(e){let t=this._base,r=this._local;r.entities=new Map;for(let[i,s]of Object.entries(e)){let o=t.entities.get(i);r.entities.set(i,s),this._updateCalculated(o,s)}return this}};var Co=class{constructor(e,t,r,i={},s={}){this.context=e,this.id=t,this.safeid=wc(t),this.allFields=i,this.allPresets=s,this.orig={},this.orig.addTags=r.addTags??r.tags??{},this.orig.aliases=r.aliases??[],this.orig.fields=r.fields??[],this.orig.geometry=r.geometry??[],this.orig.icon=r.icon,this.orig.imageURL=r.imageURL,this.orig.locationSet=r.locationSet,this.orig.matchScore=r.matchScore??1,this.orig.moreFields=r.moreFields??[],this.orig.name=r.name??"",this.orig.reference=r.reference??{},this.orig.removeTags=r.removeTags??r.addTags??r.tags??{},this.orig.replacement=r.replacement,this.orig.searchable=r.searchable??!0,this.orig.suggestion=r.suggestion,this.orig.tags=r.tags??{},this.orig.terms=(r.terms??[]).join(),Object.assign(this,Ir(this.orig,["aliases","fields","matchScore","moreFields","name","reference","terms"])),this._resolved={fields:null,moreFields:null},this._searchName=null,this._searchNameStripped=null,this._searchAliases=null,this._searchAliasesStripped=null}aliases(){return this._resolveName("name").t("aliases",{default:this.orig.aliases}).trim().split(/\s*[\r\n]+\s*/)}name(){return this._resolveName("name").t("name",{default:this.orig.name||this.id})}nameLabel(){return this._resolveName("name").tHtml("name",{default:this.orig.name||this.id})}fields(){return this._resolved.fields||(this._resolved.fields=this._resolveFields("fields"))}moreFields(){return this._resolved.moreFields||(this._resolved.moreFields=this._resolveFields("moreFields"))}resetFields(){return this._resolved={fields:null,moreFields:null}}matchGeometry(e){return this.geometry.includes(e)}matchAllGeometry(e){return e.every(t=>this.matchGeometry(t))}matchScore(e){let t=this.tags,r={},i=0;for(let o in t)if(r[o]=!0,e[o]===t[o])i+=this.orig.matchScore;else if(t[o]==="*"&&o in e)i+=this.orig.matchScore/2;else return-1;let s=this.addTags;for(let o in s)!r[o]&&e[o]===s[o]&&(i+=this.orig.matchScore);return i}t(e,t){return this.context.systems.l10n.t(`_tagging.presets.presets.${this.id}.${e}`,t)}tHtml(e,t){return this.context.systems.l10n.tHtml(`_tagging.presets.presets.${this.id}.${e}`,t)}tAppend(e,t){return this.context.systems.l10n.tAppend(`_tagging.presets.presets.${this.id}.${e}`,t)}subtitle(){if(this.suggestion){let e=this.context.systems.l10n,t=this.id.split("/");return t.pop(),e.t("_tagging.presets.presets."+t.join("/")+".name")}return null}subtitleLabel(){if(this.suggestion){let e=this.context.systems.l10n,t=this.id.split("/");return t.pop(),e.tHtml("_tagging.presets.presets."+t.join("/")+".name")}return null}terms(){return this._resolveName("name").t("terms",{default:this.orig.terms}).toLowerCase().trim().split(/\s*,+\s*/)}searchName(){return this._searchName||(this._searchName=(this.suggestion?this.orig.name:this.name()).toLowerCase()),this._searchName}searchNameStripped(){return this._searchNameStripped||(this._searchNameStripped=this._stripDiacritics(this.searchName())),this._searchNameStripped}searchAliases(){return this._searchAliases||(this._searchAliases=this.aliases().map(e=>e.toLowerCase())),this._searchAliases}searchAliasesStripped(){return this._searchAliasesStripped||(this._searchAliasesStripped=this.searchAliases().map(this._stripDiacritics)),this._searchAliasesStripped}isFallback(){return["point","line","area","relation"].includes(this.id)}reference(){let e=this.tags.wikidata||this.tags["flag:wikidata"]||this.tags["brand:wikidata"]||this.tags["network:wikidata"]||this.tags["operator:wikidata"];if(e)return{qid:e};let t=this.orig.reference.key||Object.keys(Ir(this.tags,"name"))[0],r=this.orig.reference.value||this.tags[t];return r==="*"?{key:t}:{key:t,value:r}}unsetTags(e,t,r,i){let s=r?Ir(this.removeTags,r):this.removeTags;return e=Ir(e,Object.keys(s)),t&&!i&&this.fields().forEach(o=>{o.matchGeometry(t)&&o.key&&o.default===e[o.key]&&delete e[o.key]}),delete e.area,e}setTags(e,t,r){let i=this.addTags;e=Object.assign({},e);for(let s in i)i[s]==="*"?(this.tags[s]||!e[s]||e[s]==="no")&&(e[s]="yes"):e[s]=i[s];if(!i.hasOwnProperty("area")&&(delete e.area,t==="area")){let s=!0;if(this.geometry.indexOf("line")===-1){for(let o in i)if(o in Sc){s=!1;break}}s&&(e.area="yes")}return t&&!r&&this.fields().forEach(s=>{s.matchGeometry(t)&&s.key&&!e[s.key]&&s.default&&(e[s.key]=s.default)}),e}_stripDiacritics(e){return e.normalize&&(e=e.normalize("NFD")),e=e.replace(/[\u0300-\u036f]/g,""),e}_resolveName(e){let r=(this.orig[e]??"").match(/^\{(.*)\}$/);if(r){let i=this.allPresets[r[1]];if(i)return i;console.warn(`Unable to resolve referenced preset: ${r[1]}.${e}`)}return this}_resolveFields(e){let t=this.orig[e]??[],r=this,i=[];for(let a of t){let l=a.match(/^\{(.*)\}$/);l!==null?i=i.concat(o(l[1],e)):this.allFields[a]?i.push(this.allFields[a]):console.warn(`Cannot resolve "${a}" found in ${this.id}.${e}`)}let s=this.id.split("/");for(;!i.length&&s.length;){s.pop();let a=s.join("/");a&&(i=o(a,e))}return Ge(i);function o(a,l){let c=r.allPresets[a];return c?l==="fields"?c.fields():l==="moreFields"?c.moreFields():[]:[]}}};var zi=class{constructor(e){this._current=e,this._entityRBush=new Tt,this._entityBoxes=new Map,this._entitySegments=new Map,this._segmentRBush=new Tt,this._segmentBoxes=new Map}_removeEntity(e){let t=this._entityBoxes.get(e);t&&(this._entityRBush.remove(t),this._entityBoxes.delete(e));let r=this._entitySegments.get(e)??[];for(let i of r){let s=i.id,o=this._segmentBoxes.get(s);o&&(this._segmentRBush.remove(o),this._segmentBoxes.delete(s))}this._entitySegments.delete(e)}_loadEntities(e){let t=this._current,r=[],i=[];for(let[s,o]of e){let a=o.extent(t);if(!a)continue;let l=a.bbox();if(l.id=s,this._entityBoxes.set(s,l),r.push(l),typeof o.segments!="function")continue;let c=o.segments(t)??[];this._entitySegments.set(s,c);for(let u of c){let d=u.id,f=u.extent(t);if(!f)continue;let h=f.bbox();h.id=d,h.segment=u,this._segmentBoxes.set(d,h),i.push(h)}}r.length&&this._entityRBush.load(r),i.length&&this._segmentRBush.load(i)}_includeParents(e,t,r){let i=this._current,s=e.id;if(r||(r=new Set),!r.has(s)){r.add(s);for(let o of i.parentWays(e))this._entityBoxes.has(o.id)&&(this._removeEntity(o.id),t.set(o.id,o)),this._includeParents(o,t,r);for(let o of i.parentRelations(e))this._entityBoxes.has(o.id)&&(this._removeEntity(o.id),t.set(o.id,o)),this._includeParents(o,t,r)}}_setCurrentGraph(e){if(e===this._current)return;let t=new Fn(this._current,e);this._current=e;let r=t.didChange;if(!r.addition&&!r.deletion&&!r.geometry)return;let i=new Map;if(r.deletion)for(let s of t.deleted())this._removeEntity(s.id);if(r.geometry)for(let s of t.modified())this._removeEntity(s.id),i.set(s.id,s),this._includeParents(s,i);if(r.addition)for(let s of t.created())i.set(s.id,s);this._loadEntities(i)}rebase(e,t){let i=this._current.local,s=new Map;for(let o of e){if(!o.visible)continue;let a=o.id;i.entities.has(a)&&i.entities.get(a)===void 0||this._entityBoxes.has(a)&&!t||(this._removeEntity(a),s.set(a,o),this._includeParents(o,s))}this._loadEntities(s)}intersects(e,t){return this._setCurrentGraph(t),this._entityRBush.search(e.bbox()).map(r=>t.entity(r.id))}waySegments(e,t){return this._setCurrentGraph(t),this._segmentRBush.search(e.bbox()).map(r=>r.segment)}};var nY="#da26d3",Hi=class{constructor(e,t){this.context=e,this.id=t.id,this.service=t.service,this.categories=t.categories??new Set,this.tags=t.tags??new Set,this.color=t.color??nY,this.dataUsed=t.dataUsed??[],this.extent=t.extent,this.overlay=t.overlay,this.itemUrl=t.itemUrl??"",this.licenseUrl=t.licenseUrl??"",this.thumbnailUrl=t.thumbnailUrl??this.getThumbnail(),this.added=t.added??!1,this.beta=t.beta??this.categories.has("preview"),this.enabled=t.enabled??!1,this.featured=t.featured??this.categories.has("featured"),this.filtered=t.filtered??!1,this.hidden=t.hidden??!1,this.conflated=t.conflated??!1,this.labelStringID=t.labelStringID,this.descriptionStringID=t.descriptionStringID,this._label=t.label,this._description=t.description,this.label=this.getLabel(),this.description=this.getDescription()}getThumbnail(){let e;return this.categories.has("buildings")?e="buildings":this.categories.has("footways")?e="footways":this.categories.has("roads")?e="roads":e="points",this.context.systems.assets.getFileURL(`img/data-${e}.png`)}getLabel(){let e=this.context.systems.l10n;return this.labelStringID?e.t(this.labelStringID):this._label||this.id}getDescription(){let e=this.context.systems.l10n;return this.descriptionStringID?e.t(this.descriptionStringID):this._description||""}};var Re=class{constructor(e){this.title=e.title,this.onClick=e.onClick,this.disabledReason=e.disabledReason,this.icon=e.icon,this.entityIds=e.entityIds||[],this.issue=null}};var et=class{constructor(e,t){this.context=e,this.type=t.type,this.subtype=t.subtype,this.severity=t.severity,this.entityIds=t.entityIds,this.loc=t.loc,this.data=t.data,this.hash=t.hash,this.autoArgs=t.autoArgs,t.message&&(this.message=t.message.bind(this)),t.reference&&(this.reference=t.reference.bind(this)),t.dynamicFixes&&(this.dynamicFixes=t.dynamicFixes.bind(this)),this.id=this._generateID(),this.key=this._generateKey()}extent(e){return this.loc?new le(this.loc):this.entityIds&&this.entityIds.length?Mt(this.entityIds,e):null}fixes(){let e=typeof this.dynamicFixes=="function"?this.dynamicFixes():[];if(this.severity!=="error"){let t=this.context.systems.l10n,r=this.context.systems.validator;e.push(new Re({title:t.t("issues.fix.ignore_issue.title"),icon:"rapid-icon-close",onClick:()=>{r.ignoreIssue(this.id)}}))}for(let t of e)t.id=t.title,t.issue=this;return e}_generateID(){let e=[this.type];if(this.hash&&e.push(this.hash),this.subtype&&e.push(this.subtype),this.entityIds){let t=this.entityIds.slice().sort();e.push.apply(e,t)}return e.join(":")}_generateKey(){return this.id+":"+Date.now().toString()}};function Dh(n){if(!(this instanceof Dh))return new Dh(n);Object.assign(this,n)}function UR(n,e,t){t=t||30;var r=new Fr,i,s,o;function a(G){return n.parentRelations(G).some(function(U){return U.isRestriction()})}function l(G){if(G.isArea()||G.isDegenerate())return!1;var U={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0,tertiary:!0,tertiary_link:!0,residential:!0,unclassified:!0,living_street:!0,service:!0,busway:!0,road:!0,track:!0};return U[G.tags.highway]}for(var c=n.entity(e),u=[c],d,f=[],h=[],p,m=[],g=[],y,x=[],b,_=[],S,C=[];u.length;){p=u.pop(),d=n.parentWays(p);var k=!1;for(i=0;i<d.length;i++)if(y=d[i],!(!l(y)&&!a(y))){for(m.push(y),k=!0,x=Ge(n.childNodes(y)),s=0;s<x.length;s++)if(b=x[s],b!==p&&f.indexOf(b)===-1&&!(ht(b.loc,c.loc)>t)){var v=!1;for(_=n.parentWays(b),o=0;o<_.length;o++)if(S=_[o],S!==y&&m.indexOf(S)===-1&&l(S)){v=!0;break}v&&u.push(b)}}k&&f.push(p)}f=Ge(f),m=Ge(m),m.forEach(function(G){n.childNodes(G).forEach(function(U){r=r.replace(U)}),r=r.replace(G),n.parentRelations(G).forEach(function(U){U.isRestriction()&&(U.isValidRestriction(n)?r=r.replace(U):U.isComplete(n)&&C.push($r(U.id)))})}),m.forEach(function(G){var U=r.entity(G.id);if(U.tags.oneway==="-1"){var W=ns(U.id,{reverseOneway:!0});C.push(W),r=W(r)}});var w=me.id.next.way;f.forEach(function(G){var U=$s([G.id]).keepHistoryOn("first");U.disabled(r)||U.ways(r).forEach(function(W){var V=$s([G.id]).limitWays([W.id]).keepHistoryOn("first");C.push(V),r=V(r)})}),me.id.next.way=w,h=f.map(function(G){return G.id}),f=[],m=[],h.forEach(function(G){var U=r.entity(G),W=r.parentWays(U);f.push(U),m=m.concat(W)}),f=Ge(f),m=Ge(m),h=f.map(function(G){return G.id}),g=m.map(function(G){return G.id});function A(G,U){var W=G.isOneWay(),V=U.indexOf(G.first())!==-1,j=U.indexOf(G.last())!==-1,Z=V&&j,Y=V&&!W||j,K=V||j&&!W;return G.update({__first:V,__last:j,__from:Y,__via:Z,__to:K,__oneWay:W})}m=[],g.forEach(function(G){var U=A(r.entity(G),h);r=r.replace(U),m.push(U)});var E,I=[],M=[];do for(E=!1,u=h.slice(),i=0;i<u.length;i++){var T=u[i];if(p=r.hasEntity(T),!p){h.indexOf(T)!==-1&&h.splice(h.indexOf(T),1),M.push(T);continue}if(_=r.parentWays(p),_.length<3&&h.indexOf(T)!==-1&&h.splice(h.indexOf(T),1),_.length===2){var R=_[0],P=_[1],D=R&&!R.__via,N=P&&!P.__via,F,B;D&&!N?(F=R,B=P):!D&&N&&(F=P,B=R),F&&B&&(B=A(B,h),r=r.replace(B).remove(F),I.push(F.id),E=!0)}_=r.parentWays(p),_.length<2&&(h.indexOf(T)!==-1&&h.splice(h.indexOf(T),1),M.push(T),E=!0),_.length<1&&(r=r.remove(p))}while(E);f=f.filter(function(G){return M.indexOf(G.id)===-1}).map(function(G){return r.entity(G.id)}),m=m.filter(function(G){return I.indexOf(G.id)===-1}).map(function(G){return r.entity(G.id)});var O={graph:r,actions:C,vertices:f,ways:m};return O.turns=function(G,U){if(!G)return[];U||(U=0);var W=O.graph,V=O.vertices.map(function(ie){return ie.id}),j=W.entity(G);if(!j||!(j.__from||j.__via))return[];var Z=U*2+3,Y=[];return K(j),Y;function K(ie,q,se,te){if(q=(q||[]).slice(),!(q.length>=Z)){q.push(ie.id),se=(se||[]).slice();var Q,_e;if(ie.type==="node"){var je=W.parentWays(ie),Dt=[];for(Q=0;Q<je.length;Q++){var xt=je[Q];if(!(xt.__oneWay&&xt.nodes[0]!==ie.id)&&!(q.indexOf(xt.id)!==-1&&q.length>=3)){var nr=null;for(_e=0;_e<se.length;_e++){var on=se[_e],rn=on.memberByRole("from"),fr=on.membersByRole("via"),Ye=on.memberByRole("to"),mt=/^only_/.test(on.tags.restriction),Yr=rn.id===G,di=!1,_c=!1;if(Ye.id===xt.id)if(fr.length===1&&fr[0].type==="node")di=fr[0].id===ie.id&&(Yr&&q.length===2||!Yr&&q.length>2);else{var ja=[];for(o=2;o<q.length;o+=2)ja.push(q[o]);var Bi=[];for(o=0;o<fr.length;o++)fr[o].type==="way"&&Bi.push(fr[o].id);var na=an(ja,Bi);di=!na.length}else if(mt){for(o=0;o<fr.length;o++)if(fr[o].type==="way"&&fr[o].id===xt.id){_c=!0;break}}if(di?mt?nr={id:on.id,direct:Yr,from:rn.id,no:!1,only:!0,end:!0}:nr={id:on.id,direct:Yr,from:rn.id,no:!0,only:!1,end:!0}:_c?nr={id:on.id,direct:!1,from:rn.id,no:!1,only:!0,end:!1}:mt&&(nr={id:on.id,direct:!1,from:rn.id,no:!0,only:!1,end:!0}),nr&&nr.direct)break}Dt.push({way:xt,restrict:nr})}}Dt.forEach(function(Be){K(Be.way,q,se,Be.restrict)})}else{if(q.length>=3){var Pn=q.slice();if(te&&te.direct===!1){for(Q=0;Q<Pn.length;Q++)if(Pn[Q]===te.from){Pn=Pn.slice(Q);break}}var rs=ne(Pn);if(rs&&(te&&(rs.restrictionID=te.id,rs.no=te.no,rs.only=te.only,rs.direct=te.direct),Y.push(Dh(rs))),q[0]===q[2])return}if(te&&te.end)return;var vc=W.entity(ie.first()),ae=W.entity(ie.last()),ye=ht(vc.loc,ae.loc),Ue=[];if(q.length>1&&(ye>t||!ie.__via))return;!ie.__oneWay&&V.indexOf(vc.id)!==-1&&q.indexOf(vc.id)===-1&&Ue.push(vc),V.indexOf(ae.id)!==-1&&q.indexOf(ae.id)===-1&&Ue.push(ae),Ue.forEach(function(Be){var vt=W.parentRelations(ie).filter(function(qt){if(!qt.isRestriction())return!1;var xn=qt.memberByRole("from");if(!xn||xn.id!==ie.id)return!1;var Bs=/^only_/.test(qt.tags.restriction);if(!Bs)return!0;var Ni=!1,j1=qt.membersByRole("via");if(j1.length===1&&j1[0].type==="node")Ni=j1[0].id===Be.id;else for(var y6=0;y6<j1.length;y6++)if(j1[y6].type==="way"){var LD=W.entity(j1[y6].id);if(LD.first()===Be.id||LD.last()===Be.id){Ni=!0;break}}return Ni});K(Be,q,se.concat(vt),!1)})}}}function ne(ie){if(ie.length<3)return;var q,se,te,Q,_e,je,Dt,xt,nr;if(q=ie[0],Q=ie[ie.length-1],ie.length===3&&q===Q){var on=W.entity(q);if(on.__oneWay)return null;nr=!0,xt=te=je=ie[1],se=_e=rn(q,xt)}else nr=!1,te=ie[1],se=rn(q,te),je=ie[ie.length-2],_e=rn(Q,je),ie.length===3?xt=ie[1]:(Dt=ie.filter(function(fr){return fr[0]==="w"}),Dt=Dt.slice(1,Dt.length-1));return{key:ie.join("_"),path:ie,from:{node:se,way:q,vertex:te},via:{node:xt,ways:Dt},to:{node:_e,way:Q,vertex:je},u:nr};function rn(fr,Ye){var mt=W.entity(fr).nodes;return Ye===mt[0]?mt[1]:mt[mt.length-2]}}},O}function GR(n,e,t){for(var r=n.entity(e.from.way),i=n.entity(e.from.node),s=n.entity(e.from.vertex),o=n.entity(e.to.way),a=n.entity(e.to.node),l=n.entity(e.to.vertex),c=r.tags.oneway==="yes",u=o.tags.oneway==="yes",d=(sr(t.project(s.loc),t.project(i.loc))-sr(t.project(l.loc),t.project(a.loc)))*(180/Math.PI);d<0;)d+=360;return i===a||(d<23||d>336)&&c&&u||(d<40||d>319)&&c&&u&&e.from.vertex!==e.to.vertex?"no_u_turn":d<158?"no_right_turn":d>202?"no_left_turn":"no_straight_on"}function Fm(n,e){function t(i){var s=n.map(function(a){return i.entity(a)}),o=hr(s,function(a){return a.type==="way"&&a.isClosed()?"closedWay":a.type==="relation"&&a.isMultipolygon()?"multipolygon":"other"});return Object.assign({closedWay:[],multipolygon:[],other:[]},o)}var r=function(i){for(var s=t(i),o=s.multipolygon.reduce(function(p,m){return p.concat(xi(m.members,i))},[]).concat(s.closedWay.map(function(p){var m=[{id:p.id}];return m.nodes=i.childNodes(p),m})),a=o.map(function(p,m){return o.map(function(g,y){return m===y?null:u2(g.nodes.map(function(x){return x.loc}),p.nodes.map(function(x){return x.loc}))})}),l=[],c=!0;o.length;)f(o),o=o.filter(u),a=a.filter(u).map(d);function u(p,m){return a[m].some(function(g){return g})}function d(p){return p.filter(u)}function f(p){p.forEach(function(m,g){u(m,g)||m.forEach(function(y){l.push({type:"way",id:y.id,role:c?"outer":"inner"})})}),c=!c}var h=s.multipolygon[0]||mr({id:e,tags:{type:"multipolygon"}});return s.multipolygon.slice(1).forEach(function(p){h=h.mergeTags(p.tags),i=i.remove(p)}),s.closedWay.forEach(function(p){function m(g){return g.id===p.id&&g.role!=="inner"}l.some(m)&&(h=h.mergeTags(p.tags),i=i.replace(p.update({tags:{}})))}),i.replace(h.update({members:l,tags:Ir(h.tags,["area"])}))};return r.disabled=function(i){var s=t(i);if(s.other.length>0||s.closedWay.length+s.multipolygon.length<2)return"not_eligible";if(!s.multipolygon.every(function(a){return a.isComplete(i)}))return"incomplete_relation";if(s.multipolygon.length){if(s.closedWay.some(function(a){return bn(i.parentMultipolygons(a),s.multipolygon).length}))return"not_eligible"}else{var o=[];if(s.closedWay.forEach(function(a,l){l===0?o=i.parentMultipolygons(a):o=bn(o,i.parentMultipolygons(a))}),o=o.filter(function(a){return a.members.length===s.closedWay.length}),o.length)return"not_eligible"}},r}var D2=Ot(_2(),1);function iY(n,e){let t={};for(let s=0;s<e.length;s++){let o=e[s];t[o]?t[o].push(s):t[o]=[s]}let i=[{buffer1index:-1,buffer2index:-1,chain:null}];for(let s=0;s<n.length;s++){let o=n[s],a=t[o]||[],l=0,c=i[0];for(let u=0;u<a.length;u++){let d=a[u],f;for(f=l;f<i.length&&!(i[f].buffer2index<d&&(f===i.length-1||i[f+1].buffer2index>d));f++);if(f<i.length){let h={buffer1index:s,buffer2index:d,chain:i[f]};if(l===i.length?i.push(c):i[l]=c,l=f+1,c=h,l===i.length)break}}i[l]=c}return i[i.length-1]}function $R(n,e){let t=iY(n,e),r=[],i=n.length,s=e.length;for(let o=t;o!==null;o=o.chain){let a=i-o.buffer1index-1,l=s-o.buffer2index-1;i=o.buffer1index,s=o.buffer2index,(a||l)&&r.push({buffer1:[i+1,a],buffer1Content:n.slice(i+1,i+1+a),buffer2:[s+1,l],buffer2Content:e.slice(s+1,s+1+l)})}return r.reverse(),r}function sY(n,e,t){let r=[];function i(l,c){r.push({ab:c,oStart:l.buffer1[0],oLength:l.buffer1[1],abStart:l.buffer2[0],abLength:l.buffer2[1]})}$R(e,n).forEach(l=>i(l,"a")),$R(e,t).forEach(l=>i(l,"b")),r.sort((l,c)=>l.oStart-c.oStart);let s=[],o=0;function a(l){l>o&&(s.push({stable:!0,buffer:"o",bufferStart:o,bufferLength:l-o,bufferContent:e.slice(o,l)}),o=l)}for(;r.length;){let l=r.shift(),c=l.oStart,u=l.oStart+l.oLength,d=[l];for(a(c);r.length;){let f=r[0],h=f.oStart;if(h>u)break;u=Math.max(u,h+f.oLength),d.push(r.shift())}if(d.length===1){if(l.abLength>0){let f=l.ab==="a"?n:t;s.push({stable:!0,buffer:l.ab,bufferStart:l.abStart,bufferLength:l.abLength,bufferContent:f.slice(l.abStart,l.abStart+l.abLength)})}}else{let f={a:[n.length,-1,e.length,-1],b:[t.length,-1,e.length,-1]};for(;d.length;){l=d.shift();let x=l.oStart,b=x+l.oLength,_=l.abStart,S=_+l.abLength,C=f[l.ab];C[0]=Math.min(_,C[0]),C[1]=Math.max(S,C[1]),C[2]=Math.min(x,C[2]),C[3]=Math.max(b,C[3])}let h=f.a[0]+(c-f.a[2]),p=f.a[1]+(u-f.a[3]),m=f.b[0]+(c-f.b[2]),g=f.b[1]+(u-f.b[3]),y={stable:!1,aStart:h,aLength:p-h,aContent:n.slice(h,p),oStart:c,oLength:u-c,oContent:e.slice(c,u),bStart:m,bLength:g-m,bContent:t.slice(m,g)};s.push(y)}o=u}return a(e.length),s}function zR(n,e,t,r){r=Object.assign({excludeFalseConflicts:!0,stringSeparator:/\s+/},r),typeof n=="string"&&(n=n.split(r.stringSeparator)),typeof e=="string"&&(e=e.split(r.stringSeparator)),typeof t=="string"&&(t=t.split(r.stringSeparator));let s=[],o=sY(n,e,t),a=[];function l(){a.length&&s.push({ok:a}),a=[]}function c(u,d){if(u.length!==d.length)return!1;for(let f=0;f<u.length;f++)if(u[f]!==d[f])return!1;return!0}return o.forEach(u=>{u.stable?a.push(...u.bufferContent):r.excludeFalseConflicts&&c(u.aContent,u.bContent)?a.push(...u.aContent):(l(),s.push({conflict:{a:u.aContent,aIndex:u.aStart,o:u.oContent,oIndex:u.oStart,b:u.bContent,bIndex:u.bStart}}))}),l(),s}function M2(n,e={}){let t=e.localGraph,r=e.remoteGraph,i=e.discardTags??{},s=e.formatUser??(g=>g),o=e.localize??(g=>g),a=e.strategy??"safe",l=[];function c(g,y){return a==="force_local"||He(y.loc,g.loc,1e-6)?y:a==="force_remote"?y.update({loc:g.loc}):(l.push(o("merge_remote_changes.conflict.location",{user:s(g.user)})),y)}function u(g,y,x){if(a==="force_local"||(0,D2.default)(x.nodes,y.nodes))return x;if(a==="force_remote")return x.update({nodes:y.nodes});let b=l.length,_=g.nodes||[],S=x.nodes||[],C=y.nodes||[],k=zR(S,_,C,{excludeFalseConflicts:!0}),v=[];for(let w of k)if(w.ok)v.push.apply(v,w.ok);else{let A=w.conflict;if((0,D2.default)(A.o,A.a))v.push.apply(v,A.b);else if((0,D2.default)(A.o,A.b))v.push.apply(v,A.a);else{l.push(o("merge_remote_changes.conflict.nodelist",{user:s(y.user)}));break}}return l.length===b?x.update({nodes:v}):x}function d(g,y,x,b){function _(C,k){let v=b.parentWays(C).some(w=>w.id!==k.id);return C.hasInterestingTags()||v||b.parentRelations(C).length>0}let S=l.length;for(let C of y){let k=b.hasEntity(C);if(g.nodes.indexOf(C)===-1){k&&!_(k,g)&&x.removeIDs.push(C);continue}let v=t.hasEntity(C),w=r.hasEntity(C),A;if(a==="force_remote"&&w&&w.visible)x.replacements.push(w);else if(a==="force_local"&&v)A=me(v),w&&(A=A.update({version:w.version})),x.replacements.push(A);else if(a==="safe"&&v&&w&&v.version!==w.version){if(A=me(v,{version:w.version}),w.visible?A=c(w,A):l.push(o("merge_remote_changes.conflict.deleted",{user:s(w.user)})),l.length!==S)break;x.replacements.push(A)}}return g}function f(g,y){for(let x of g.replacements)y=y.replace(x);return g.removeIDs.length&&(y=pa(g.removeIDs)(y)),y}function h(g,y){return a==="force_local"||(0,D2.default)(y.members,g.members)?y:a==="force_remote"?y.update({members:g.members}):(l.push(o("merge_remote_changes.conflict.memberlist",{user:s(g.user)})),y)}function p(g,y,x){if(a==="force_local"||(0,D2.default)(x.tags,y.tags))return x;if(a==="force_remote")return x.update({tags:y.tags});let b=l.length,_=g.tags??{},S=x.tags??{},C=y.tags??{},k=Ur(Ur(Object.keys(_),Object.keys(S)),Object.keys(C)).filter(function(I){return!i[I]}),v=Object.assign({},S),w=!1;for(var A=0;A<k.length;A++){var E=k[A];_[E]!==C[E]&&S[E]!==C[E]&&(_[E]!==S[E]?l.push(o("merge_remote_changes.conflict.tags",{tag:E,local:S[E],remote:C[E],user:s(y.user)})):(C.hasOwnProperty(E)?v[E]=C[E]:delete v[E],w=!0))}return w&&l.length===b?x.update({tags:v}):x}let m=function(g){let y={replacements:[],removeIDs:[]},x=g.base.entities.get(n),b=t.entity(n),_=r.entity(n),S=me(b,{version:_.version});return _.visible?(S.type==="node"?S=c(_,S):S.type==="way"?(g.rebase(r.childNodes(_),[g],!1),S=u(x,_,S),S=d(S,Ur(b.nodes,_.nodes),y,g)):S.type==="relation"&&(S=h(_,S)),S=p(x,_,S),l.length||(g=f(y,g).replace(S)),g):a==="force_remote"?pa([n])(g):a==="force_local"?(S.type==="way"&&(S=d(S,Ge(b.nodes),y,g),g=f(y,g)),g.replace(S)):(l.push(o("merge_remote_changes.conflict.deleted",{user:s(_.user)})),g)};return m.conflicts=function(){return l},m}function Ar(n,e,t,r){for(var i=Ne,s=n.map(function(y){return t.project(y.loc)}),o=n.map(function(y){return y.id}),a=1/0,l,c,u=0;u<s.length-1;u++)if(!(o[u]===r||o[u+1]===r)){var d=s[u],f=Me(s[u+1],d),h=Me(e,d),p=ss(h,f)/ss(f,f),m;p<0?m=d:p>1?m=s[u+1]:m=[d[0]+p*f[0],d[1]+p*f[1]];var g=i(m,e);g<a&&(a=g,l=u+1,c=t.unproject(m))}return l!==void 0?{index:l,distance:a,loc:c}:null}function HR(n,e,t){var r=[],i=[],s,o,a,l,c;for(s=0;s<n.length-1;s++)a=n[s],l=n[s+1],c=[a.loc,l.loc],(a.id===t||l.id===t)&&r.push(c);for(s=0;s<e.length-1;s++)a=e[s],l=e[s+1],c=[a.loc,l.loc],i.push(c);for(s=0;s<r.length;s++)for(o=0;o<i.length;o++){var u=r[s],d=i[o],f=da(u,d);if(f)return!0}return!1}function Rc(n,e){var t=[],r=[],i,s;for(i=0;i<n.length-1;i++){var o=n[i],a=n[i+1],l=[o.loc,a.loc];o.id===e||a.id===e?t.push(l):r.push(l)}for(i=0;i<t.length;i++)for(s=0;s<r.length;s++){var c=t[i],u=r[s];if(!(He(c[1],u[0])||He(c[0],u[1])||He(c[0],u[0])||He(c[1],u[1]))){var d=da(c,u);if(d){var f=1e-8;if(He(c[1],d,f)||He(c[0],d,f)||He(u[1],d,f)||He(u[0],d,f))continue;return!0}}}return!1}function Fc(n,e,t){return He(t,n)||He(t,e)?1:sm(n,e,t)}function WR(n,e,t,r,i){var s=Math.abs(n);return s<e||i&&Math.abs(s-1)<e?0:s<t||s>r?n:null}function Bm(n,e,t,r){for(var i=0,s=e?0:1,o=e?n.length:n.length-1,a=n.map(function(m){return m.coord}),l=Math.cos((90-r)*Math.PI/180),c=Math.cos(r*Math.PI/180),u=s;u<o;u++){var d=a[(u-1+a.length)%a.length],f=a[u],h=a[(u+1)%a.length],p=WR(Fc(d,h,f),t,l,c);p!==null&&(i=i+2*Math.min(Math.abs(p-1),Math.min(Math.abs(p),Math.abs(p+1))))}return i}function VR(n,e,t){for(var r=-1/0,i=e?0:1,s=e?n.length:n.length-1,o=i;o<s;o++){var a=n[(o-1+n.length)%n.length],l=n[o],c=n[(o+1)%n.length],u=Fc(a,c,l),d=Math.acos(Math.abs(u))*180/Math.PI;d>45&&(d=90-d),!(d>=t)&&d>r&&(r=d)}return r===-1/0?null:r}function R2(n,e,t,r,i){for(var s=null,o=e?0:1,a=e?n.length:n.length-1,l=Math.cos((90-r)*Math.PI/180),c=Math.cos(r*Math.PI/180),u=o;u<a;u++){var d=n[(u-1+n.length)%n.length],f=n[u],h=n[(u+1)%n.length],p=WR(Fc(d,h,f),t,l,c,i);if(p!==null){if(Math.abs(p)>0)return 1;s=0}}return s}function Ao(n,e,t,r){var i=e;function s(f){function h(g){if(n.indexOf(g)!==-1)return!0;var y=f.parentWays(f.entity(g));if(y.length<3)return!0;var x=y.every(function(b){return r.moving[b.id]});return x||delete r.moving[g],x}function p(g){for(var y=0;y<g.length;y++){var x=g[y];if(!r.moving[x]){r.moving[x]=!0;var b=f.hasEntity(x);b&&(b.type==="node"?(r.nodes.push(x),r.startLoc[x]=b.loc):b.type==="way"?(r.ways.push(x),p(b.nodes)):p(b.members.map(function(_){return _.id})))}}}function m(g){function y(I,M){return!I.isClosed()&&!!I.affix(M)}for(var x=0;x<g.length;x++)for(var b=g[x],_=f.childNodes(f.entity(b)),S=0;S<_.length;S++){var C=_[S],k=f.parentWays(C);if(k.length===2){for(var v=f.entity(b),w=null,A=0;A<k.length;A++){var E=k[A];if(!r.moving[E.id]){w=E;break}}w&&(bn(v.nodes,w.nodes).length>2||v.isArea()||w.isArea()||r.intersections.push({nodeId:C.id,movedId:v.id,unmovedId:w.id,movedIsEP:y(v,C.id),unmovedIsEP:y(w,C.id)}))}}}r||(r={}),r.ok||(r.moving={},r.intersections=[],r.replacedVertex={},r.startLoc={},r.nodes=[],r.ways=[],p(n),m(r.ways),r.nodes=r.nodes.filter(h),r.ok=!0)}function o(f,h,p,m){var g=p.entity(h),y=p.entity(f),x=g.nodes.indexOf(f),b,_,S;g.isClosed()?(b=g.nodes.length-1,_=(x+b-1)%b,S=(x+b+1)%b):(b=g.nodes.length,_=x-1,S=x+1);var C=p.hasEntity(g.nodes[_]),k=p.hasEntity(g.nodes[S]);if(!C||!k)return p;var v=h+"_"+f,w=r.replacedVertex[v];w||(w=Le(),r.replacedVertex[v]=w,r.startLoc[w.id]=r.startLoc[f]);var A,E;m?(A=t.project(r.startLoc[f]),E=t.unproject(bt(A,m))):E=r.startLoc[f],w=w.move(E);var I=t.project(w.loc),M=t.project(C.loc),T=t.project(k.loc),R=Math.abs(sr(I,M)-sr(I,T))*(180/Math.PI);if(R>175&&R<185)return p;var P=[C.loc,w.loc,y.loc,k.loc].map(O=>t.project(O)),D=[C.loc,y.loc,w.loc,k.loc].map(O=>t.project(O)),N=Gv(P),F=Gv(D),B=N<=F?x:S;return g.isClosed()&&B===0&&(B=b),g=g.addNode(w.id,B),p.replace(w).replace(g)}function a(f,h){var p=h.entity(f),m=1e-6,g,y;function x(_,S){return S.parentWays(_).length>1||S.parentRelations(_).length||_.hasInterestingTags()}for(var b=0;b<p.nodes.length;b++)y=h.entity(p.nodes[b]),g&&y&&He(g.loc,y.loc,m)&&(x(g,h)?x(y,h)||(p=p.removeNode(y.id),h=h.replace(p).remove(y)):(p=p.removeNode(g.id),h=h.replace(p).remove(g))),g=y;return h}function l(f,h){var p=h.entity(f.nodeId),m=h.entity(f.movedId),g=h.entity(f.unmovedId),y=f.movedIsEP,x=f.unmovedIsEP;if(y&&x)return h;var b=h.childNodes(m).filter(function(E){return E!==p}),_=h.childNodes(g).filter(function(E){return E!==p});m.isClosed()&&m.first()===p.id&&b.push(b[0]),g.isClosed()&&g.first()===p.id&&_.push(_[0]);var S=!y&&Ar(b,t.project(p.loc),t),C=!x&&Ar(_,t.project(p.loc),t),k;if(!y&&!x)for(var v=1e-6,w=10,A=0;A<w&&(k=at(S.loc,C.loc,.5),S=Ar(b,t.project(k),t),C=Ar(_,t.project(k),t),!(Math.abs(S.distance-C.distance)<v));A++);else y?k=C.loc:k=S.loc;return h=h.replace(p.move(k)),!y&&S.index!==m.nodes.indexOf(p.id)&&(m=m.removeNode(p.id).addNode(p.id,S.index),h=h.replace(m)),!x&&C.index!==g.nodes.indexOf(p.id)&&(g=g.removeNode(p.id).addNode(p.id,C.index),h=h.replace(g)),h}function c(f){for(var h=0;h<r.intersections.length;h++){var p=r.intersections[h];f=o(p.nodeId,p.movedId,f,i),f=o(p.nodeId,p.unmovedId,f,null),f=l(p,f),f=a(p.movedId,f),f=a(p.unmovedId,f)}return f}function u(f){function h(A){return bt(t.project(A),i)}for(var p=0;p<r.intersections.length;p++){var m=r.intersections[p];if(!(m.movedIsEP&&m.unmovedIsEP)&&m.movedIsEP){for(var g=f.entity(m.nodeId),y=t.project(g.loc),x=bt(y,i),b=f.childNodes(f.entity(m.movedId)),_=b.map(function(A){return h(A.loc)}),S=f.childNodes(f.entity(m.unmovedId)),C=S.map(function(A){return t.project(A.loc)}),k=om(_,C),v=0;p<k.length;p++)if(!He(k[v],x)){var w=Ar(S,x,t);i=Me(t.project(w.loc),y)}}}}var d=function(f){if(i[0]===0&&i[1]===0)return f;s(f),r.intersections.length&&u(f);for(var h=0;h<r.nodes.length;h++){var p=f.entity(r.nodes[h]),m=t.project(p.loc),g=bt(m,i);f=f.replace(p.move(t.unproject(g)))}return r.intersections.length&&(f=c(f)),f};return d.delta=function(){return i},d}function Nm(n,e,t){return function(r){return r.replace(r.entity(n).moveMember(e,t))}}function Wi(n,e){var t=function(r,i){(i===null||!isFinite(i))&&(i=1),i=Math.min(Math.max(+i,0),1);var s=r.entity(n);return r.replace(s.move(at(s.loc,e,i)))};return t.transitionable=!0,t}function Om(){return function(n){return n}}function al(n,e,t,r,i){var s=i||1e-4,o=r||13,a=Math.cos((90-o)*Math.PI/180),l=Math.cos(o*Math.PI/180),c=function(d,f){(f===null||!isFinite(f))&&(f=1),f=Math.min(Math.max(+f,0),1);var h=d.entity(n);if(h=h.removeNode(""),h.tags.nonsquare){var p=Object.assign({},h.tags);delete p.nonsquare,h=h.update({tags:p})}d=d.replace(h);var m=h.isClosed(),g=d.childNodes(h).slice();if(m&&g.pop(),t!==void 0&&(g=u(g,t,m),g.length!==3))return d;var y={},x=[],b={i:0,dotp:1},_,S,C,k,v,w,A;for(w=0;w<g.length;w++)_=g[w],y[_.id]=(y[_.id]||0)+1,x.push({id:_.id,coord:e.project(_.loc)});if(x.length===3){for(w=0;w<1e3&&(v=x.map(G),x[b.i].coord=bt(x[b.i].coord,v[b.i]),k=b.dotp,!(k<s));w++);_=d.entity(g[b.i].id),C=e.unproject(x[b.i].coord),d=d.replace(_.move(at(_.loc,C,f)))}else{var E=[],I=[];for(w=0;w<x.length;w++){S=x[w];var M=0;if(m||w>0&&w<x.length-1){var T=x[(w-1+x.length)%x.length],R=x[(w+1)%x.length];M=Math.abs(Fc(T.coord,R.coord,S.coord))}M>l?E.push(S):I.push(S)}var P=O(I),D=O(I);for(k=1/0,w=0;w<1e3;w++){for(v=I.map(G),A=0;A<v.length;A++)I[A].coord=bt(I[A].coord,v[A]);var N=Bm(I,m,s,o);if(N<k&&(P=O(I),k=N),k<s)break}var F=P.map(function(U){return U.coord});for(m&&F.push(F[0]),w=0;w<P.length;w++)S=P[w],He(D[w].coord,S.coord)||(_=d.entity(S.id),C=e.unproject(S.coord),d=d.replace(_.move(at(_.loc,C,f))));for(w=0;w<E.length;w++)if(S=E[w],!(y[S.id]>1))if(_=d.entity(S.id),f===1&&d.parentWays(_).length===1&&d.parentRelations(_).length===0&&!_.hasInterestingTags())d=vo(_.id)(d);else{var B=EM(S.coord,F);B&&(C=e.unproject(B.target),d=d.replace(_.move(at(_.loc,C,f))))}}return d;function O(U){return U.map(function(W){return{id:W.id,coord:[W.coord[0],W.coord[1]]}})}function G(U,W,V){if(!m&&(W===0||W===V.length-1))return[0,0];if(y[V[W].id]>1)return[0,0];var j=V[(W-1+V.length)%V.length].coord,Z=U.coord,Y=V[(W+1)%V.length].coord,K=Me(j,Z),ne=Me(Y,Z),ie=2*Math.min(Ne(K),Ne(ne));K=o2(K),ne=o2(ne);var q=K[0]*ne[0]+K[1]*ne[1],se=Math.abs(q);if(se<a){b.i=W,b.dotp=se;var te=o2(bt(K,ne));return yi(te,.1*q*ie)}return[0,0]}};function u(d,f,h){for(var p=h?0:1,m=h?d.length:d.length-1,g=p;g<m;g++)if(d[g].id===f)return[d[(g-1+d.length)%d.length],d[g],d[(g+1)%d.length]];return[]}return c.disabled=function(d){var f=d.entity(n);f=f.removeNode(""),d=d.replace(f);var h=f.isClosed(),p=d.childNodes(f).slice();h&&p.pop();var m=!1;if(t!==void 0&&(m=!0,p=u(p,t,h),p.length!==3))return"end_vertex";var g=p.map(function(x){return e.project(x.loc)}),y=R2(g,h,s,o,m);return y===null?"not_squarish":y===0?"square_enough":!1},c.transitionable=!0,c}function oY(n,e,t,r,i){var s=Math.abs(r.loc[0]-i.loc[0])>Math.abs(r.loc[1]-i.loc[1]),o=s?function(g,y){return r.loc[0]<i.loc[0]?g.loc[0]-y.loc[0]:y.loc[0]-g.loc[0]}:function(g,y){return r.loc[1]<i.loc[1]?g.loc[1]-y.loc[1]:y.loc[1]-g.loc[1]},a=t.nodes,l=a.indexOf(r.id),c=a.indexOf(i.id);if(l===-1||c===-1||l>=c||o(r,i)>=0)return null;for(var u=l+1;u<c&&o(e,n.entity(a[u]))>0;)u++;var d=n.entity(a[u-1]).loc,f=n.entity(a[u]).loc,h=e.loc,p=Math.abs(d[0]-f[0])>Math.abs(d[1]-f[1])?(h[0]-d[0])/(f[0]-d[0]):(h[1]-d[1])/(f[1]-d[1]),m=at(d,f,p);return{insertIdx:u,interpLoc:m}}function Jv(n,e){return Math.abs(n[0]-e[0])>2e-5||Math.abs(n[1]-e[1])>2e-5}function Lm(n){delete n.__fbid__,delete n.__origid__,delete n.__service__,delete n.__datasetid__,delete n.tags.conn,delete n.tags.orig_id,delete n.tags.debug_way_id,delete n.tags.import,delete n.tags.dupe}function Um(n,e){return function(t){var r={},i=e.entity(n);return i.type==="node"?s(i):i.type==="way"?o(i):i.type==="relation"&&a(i),t;function s(l){var c=Le(l);return c.tags=Object.assign({},c.tags),Lm(c),t=t.replace(c),c}function o(l){var c=Rt(l);c.nodes=l.nodes.slice(),c.tags=Object.assign({},c.tags),Lm(c);var u=c.nodes.map(function(d){var f=Le(e.entity(d));f.tags=Object.assign({},f.tags);var h=f.tags.conn&&f.tags.conn.split(","),p=f.tags.dupe;if(Lm(f),p&&t.hasEntity(p)&&!Jv(t.entity(p).loc,f.loc)?f=t.entity(p):t.hasEntity(f.id)&&Jv(t.entity(f.id).loc,f.loc)&&(f=Le({loc:f.loc})),h&&t.hasEntity(h[0])){var m=t.hasEntity(h[0]),g=t.hasEntity(h[1]),y=t.hasEntity(h[2]);if(m&&g&&y){var x=oY(t,f,m,g,y);x&&!Jv(x.interpLoc,f.loc)&&(f.loc=x.interpLoc,t=t.replace(m.addNode(f.id,x.insertIdx)))}}return t=t.replace(f),f.id});return c=c.update({nodes:u}),t=t.replace(c),c}function a(l){var c=r[l.id];if(c)return c;var u=mr(l);u.members=l.members.slice(),u.tags=Object.assign({},l.tags),Lm(u);var d=u.members.map(function(f){var h=e.entity(f.id),p;return h.type==="node"?p=s(h):h.type==="way"?p=o(h):h.type==="relation"&&(p=a(h)),Object.assign(f,{id:p.id})});return u=u.update({members:d}),t=t.replace(u),r[l.id]=u,u}}}function jR(n,e,t){return function(r){var i=r.entity(n.from.way),s=r.entity(n.to.way),o=n.via.node&&r.entity(n.via.node),a=n.via.ways&&n.via.ways.map(function(c){return r.entity(c)}),l=[];return l.push({id:i.id,type:"way",role:"from"}),o?l.push({id:o.id,type:"node",role:"via"}):a&&a.forEach(function(c){l.push({id:c.id,type:"way",role:"via"})}),l.push({id:s.id,type:"way",role:"to"}),r.replace(mr({id:t,tags:{type:"restriction",restriction:e},members:l}))}}function Mh(n){var e=function(t){var r=t.hasEntity(n),i=t.base.entities.get(n);return r&&!i&&(r.type==="node"&&t.parentWays(r).forEach(function(s){s=s.removeNode(n),t=t.replace(s),s.isDegenerate()&&(t=cs(s.id)(t))}),t.parentRelations(r).forEach(function(s){s=s.removeMembersWithID(n),t=t.replace(s),s.isDegenerate()&&(t=$r(s.id)(t))})),t.revert(n)};return e}function F2(n,e,t,r){var i=function(s){return s.update(function(o){for(let a of Ht(n,o)){let l=lr(r.project(a.loc),t,e);o=o.replace(a.move(r.unproject(l)))}})};return i}function XR(n,e,t,r){return function(i){return i.update(function(s){let o,a;Ht(n,s).forEach(function(l){o=r.project(l.loc),a=[o[0]-e[0],o[1]-e[1]],o=[e[0]+t*a[0],e[1]+t*a[1]],s=s.replace(l.move(r.unproject(o)))})})}}function Gm(n,e){function t(s,o,a){return ss(s,a,o)/ss(a,a,o)}function r(s){var o=d2(s),a=[(o.poly[0][0]+o.poly[1][0])/2,(o.poly[0][1]+o.poly[1][1])/2],l=[(o.poly[2][0]+o.poly[3][0])/2,(o.poly[2][1]+o.poly[3][1])/2],c=[(o.poly[3][0]+o.poly[4][0])/2,(o.poly[3][1]+o.poly[4][1])/2],u=[(o.poly[1][0]+o.poly[2][0])/2,(o.poly[1][1]+o.poly[2][1])/2],d=Ne(a,l)>Ne(c,u);return d?[a,l]:[c,u]}var i=function(s,o){(o===null||!isFinite(o))&&(o=1),o=Math.min(Math.max(+o,0),1);for(var a=n.map(function(x){return s.entity(x)}),l=a.map(function(x){return e.project(x.loc)}),c=r(l),u=c[0],d=c[1],f=0;f<l.length;f++){var h=a[f],p=l[f],m=t(p,u,d),g=at(u,d,m),y=e.unproject(g);s=s.replace(h.move(at(h.loc,y,o)))}return s};return i.disabled=function(s){for(var o=n.map(function(y){return s.entity(y)}),a=o.map(function(y){return e.project(y.loc)}),l=r(a),c=l[0],u=l[1],d=0,f=0;f<a.length;f++){var h=a[f],p=t(h,c,u),m=at(c,u,p),g=Ne(m,h);!isNaN(g)&&g>d&&(d=g)}if(d<1e-4)return"straight_enough"},i.transitionable=!0,i}function $m(n,e){function t(o,a,l){return ss(o,l,a)/ss(l,l,a)}function r(o){for(var a=[],l=[],c=[],u=[],d=n.filter(function(S){return o.entity(S).type==="way"}),f=n.filter(function(S){return o.entity(S).type==="node"}),h=0;h<d.length;h++){var p=o.entity(d[h]);a=p.nodes.slice(0),u.push(a),l.push(a[0]),c.push(a[a.length-1])}l=l.filter(function(S){return l.indexOf(S)===l.lastIndexOf(S)}),c=c.filter(function(S){return c.indexOf(S)===c.lastIndexOf(S)});var m=an(l,c).concat(an(c,l))[0],g=[];a=[];for(var y=function(S,C){return C.filter(function(k){return k[0]===S||k[k.length-1]===S})[0]};u.length;)g=y(m,u),u=an(u,[g]),g[0]!==m&&g.reverse(),a=a.concat(g),m=a[a.length-1];if(f.length===2){var x=a.indexOf(f[0]),b=a.indexOf(f[1]),_=[x,b];_.sort(function(S,C){return S-C}),a=a.slice(_[0],_[1]+1)}return a.map(function(S){return o.entity(S)})}function i(o,a){return a.parentWays(o).length>1||a.parentRelations(o).length||o.hasInterestingTags()}var s=function(o,a){(a===null||!isFinite(a))&&(a=1),a=Math.min(Math.max(+a,0),1);var l=r(o),c=l.map(function(b){return e.project(b.loc)}),u=c[0],d=c[c.length-1],f=[],h;for(h=1;h<c.length-1;h++){var p=l[h],m=c[h];if(a<1||i(p,o)){var g=t(m,u,d),y=at(u,d,g),x=e.unproject(y);o=o.replace(p.move(at(p.loc,x,a)))}else f.indexOf(p)===-1&&f.push(p)}for(h=0;h<f.length;h++)o=vo(f[h].id)(o);return o};return s.disabled=function(o){var a=r(o),l=a.map(function(b){return e.project(b.loc)}),c=l[0],u=l[l.length-1],d=.2*Ne(c,u),f;if(d===0)return"too_bendy";var h=0;for(f=1;f<l.length-1;f++){var p=l[f],m=t(p,c,u),g=at(c,u,m),y=Ne(g,p);if(isNaN(y)||y>d)return"too_bendy";y>h&&(h=y)}var x=a.every(function(b,_){return _===0||_===a.length-1||i(b,o)});if(h<1e-4&&x)return"straight_enough"},s.transitionable=!0,s}function qR(n){return function(e){return $r(n.restrictionID)(e)}}function zm(n,e){var t=!0,r=function(i,s){(s===null||!isFinite(s))&&(s=1),s=Math.min(Math.max(+s,0),1);var o=Ht(n,i),a=o.map(function(w){return e.project(w.loc)}),l=d2(a),c=[(l.poly[0][0]+l.poly[1][0])/2,(l.poly[0][1]+l.poly[1][1])/2],u=[(l.poly[2][0]+l.poly[3][0])/2,(l.poly[2][1]+l.poly[3][1])/2],d=[(l.poly[3][0]+l.poly[4][0])/2,(l.poly[3][1]+l.poly[4][1])/2],f=[(l.poly[1][0]+l.poly[2][0])/2,(l.poly[1][1]+l.poly[2][1])/2],h,p,m=Ne(c,u)>Ne(d,f);t&&m||!t&&!m?(h=c,p=u):(h=d,p=f);for(var g=p[0]-h[0],y=p[1]-h[1],x=(g*g-y*y)/(g*g+y*y),b=2*g*y/(g*g+y*y),_=0;_<o.length;_++){var S=o[_],C=e.project(S.loc),k=[x*(C[0]-h[0])+b*(C[1]-h[1])+h[0],b*(C[0]-h[0])-x*(C[1]-h[1])+h[1]],v=e.unproject(k);S=S.move(at(S.loc,v,s)),i=i.replace(S)}return i};return r.useLongAxis=function(i){return arguments.length?(t=i,r):t},r.transitionable=!0,r}function Hm(n,e,t){return function(r){let i=r.entity(n),s=Object.assign({},i.tags),o,a;for(let[l,c]of Object.entries(e))if(l in s)if(c==="*")o=s[l],delete s[l];else if(c===s[l])delete s[l];else{let u=s[l].split(";").filter(Boolean),d=u.indexOf(c);u.length===1||d===-1?delete s[l]:(t&&t[l]&&(a=d),u.splice(d,1),s[l]=u.join(";"))}if(t)for(let[l,c]of Object.entries(t))if(c==="*"){if(s[l]&&s[l]!=="no")continue;s[l]="yes"}else if(c==="$1")s[l]=o;else if(s[l]&&e[l]&&a!==void 0){let u=s[l].split(";").filter(Boolean);u.indexOf(c)===-1&&(u.splice(a,0,c),s[l]=u.join(";"))}else s[l]=c;return r=r.replace(i.update({tags:s})),r}}var ir={};X1(ir,{AbstractBitmapFont:()=>Ul,AbstractRenderer:()=>Bo,AbstractText:()=>Ho,AccessibilitySystem:()=>Wc,AlphaFilter:()=>Yy,AlphaMask:()=>Yc,AlphaMaskPipe:()=>Bu,AnimatedSprite:()=>Bd,Application:()=>x3,ApplicationInitHook:()=>Ru,Assets:()=>Ra,AssetsClass:()=>S3,BLEND_TO_NPM:()=>W7,BUFFER_TYPE:()=>s1,BackgroundLoader:()=>dd,BackgroundSystem:()=>eg,Batch:()=>i4,BatchGeometry:()=>e0,BatchTextureArray:()=>J2,BatchableGraphics:()=>Ta,BatchableMesh:()=>Do,BatchableSprite:()=>ws,Batcher:()=>j7,BatcherPipe:()=>i3,BigPool:()=>Ze,BindGroup:()=>Jr,BindGroupSystem:()=>Hu,BitmapFont:()=>ro,BitmapFontManager:()=>Qi,BitmapText:()=>Wo,BitmapTextPipe:()=>gu,BlendModeFilter:()=>it,BlendModePipe:()=>Lu,BlurFilter:()=>ic,BlurFilterPass:()=>Oa,Bounds:()=>Nt,BrowserAdapter:()=>I7,Buffer:()=>ar,BufferImageSource:()=>_a,BufferResource:()=>Uo,BufferUsage:()=>nt,CLEAR:()=>tn,Cache:()=>kt,CanvasPool:()=>zn,CanvasPoolClass:()=>_4,CanvasSource:()=>Cn,CanvasTextMetrics:()=>Ei,CanvasTextPipe:()=>du,CanvasTextSystem:()=>mu,Circle:()=>ka,Color:()=>ce,ColorBlend:()=>R4,ColorBurnBlend:()=>F4,ColorDodgeBlend:()=>B4,ColorMask:()=>Kc,ColorMaskPipe:()=>Nu,ColorMatrixFilter:()=>sc,CompressedSource:()=>As,Container:()=>we,Culler:()=>Oy,CullerPlugin:()=>D3,CustomRenderPipe:()=>Tu,D3D10_RESOURCE_DIMENSION:()=>Iy,D3DFMT:()=>oi,DATA_URI:()=>hN,DDS:()=>tt,DEG_TO_RAD:()=>ds,DEPRECATED_SCALE_MODES:()=>Q3,DEPRECATED_WRAP_MODES:()=>K3,DOMAdapter:()=>Fe,DRAW_MODES:()=>CL,DXGI_FORMAT:()=>ky,DXGI_TO_TEXTURE_FORMAT:()=>Wn,DarkenBlend:()=>N4,DefaultBatcher:()=>tu,DefaultShader:()=>s0,DifferenceBlend:()=>O4,DisplacementFilter:()=>ix,DivideBlend:()=>L4,DynamicBitmapFont:()=>k4,Ellipse:()=>v0,EventBoundary:()=>j2,EventEmitter:()=>st,EventSystem:()=>X2,EventsTicker:()=>fs,ExclusionBlend:()=>U4,ExtensionType:()=>z,ExtractSystem:()=>tg,FOURCC_TO_TEXTURE_FORMAT:()=>k3,FederatedContainer:()=>k7,FederatedEvent:()=>To,FederatedMouseEvent:()=>Vs,FederatedPointerEvent:()=>vn,FederatedWheelEvent:()=>hs,FillGradient:()=>Mo,FillPattern:()=>Ks,Filter:()=>be,FilterEffect:()=>Hs,FilterPipe:()=>vu,FilterSystem:()=>wu,FontStylePromiseCache:()=>R0,GAUSSIAN_VALUES:()=>Fd,GL_FORMATS:()=>rd,GL_INTERNAL_FORMAT:()=>ZT,GL_TARGETS:()=>d3,GL_TYPES:()=>It,GL_WRAP_MODES:()=>rT,GenerateTextureSystem:()=>Uu,Geometry:()=>Gn,GlBackBufferSystem:()=>Pg,GlBatchAdaptor:()=>i1,GlBuffer:()=>td,GlBufferSystem:()=>o1,GlColorMaskSystem:()=>l1,GlContextSystem:()=>Tg,GlEncoderSystem:()=>c1,GlGeometrySystem:()=>a1,GlGraphicsAdaptor:()=>r1,GlMeshAdaptor:()=>n1,GlParticleContainerAdaptor:()=>g0,GlParticleContainerPipe:()=>cu,GlProgram:()=>he,GlProgramData:()=>sd,GlRenderTarget:()=>nd,GlRenderTargetAdaptor:()=>id,GlRenderTargetSystem:()=>f1,GlShaderSystem:()=>h1,GlStateSystem:()=>Qg,GlStencilSystem:()=>u1,GlTexture:()=>ad,GlTextureSystem:()=>m1,GlUboSystem:()=>d1,GlUniformGroupSystem:()=>p1,GlobalUniformSystem:()=>Gu,GpuBatchAdaptor:()=>Eu,GpuBlendModesToPixi:()=>En,GpuBufferSystem:()=>Wu,GpuColorMaskSystem:()=>Vu,GpuDeviceSystem:()=>Yl,GpuEncoderSystem:()=>ju,GpuGraphicsAdaptor:()=>Cu,GpuGraphicsContext:()=>su,GpuMeshAdapter:()=>Au,GpuMipmapGenerator:()=>ed,GpuParticleContainerAdaptor:()=>b0,GpuParticleContainerPipe:()=>uu,GpuProgram:()=>pe,GpuReadBuffer:()=>wL,GpuRenderTarget:()=>Q0,GpuRenderTargetAdaptor:()=>Z0,GpuRenderTargetSystem:()=>Zu,GpuShaderSystem:()=>Ju,GpuStateSystem:()=>e1,GpuStencilModesToPixi:()=>Cs,GpuStencilSystem:()=>Xu,GpuTextureSystem:()=>t1,GpuUboSystem:()=>Yu,GpuUniformBatchPipe:()=>Ku,Graphics:()=>ze,GraphicsContext:()=>Wr,GraphicsContextRenderData:()=>m4,GraphicsContextSystem:()=>Fl,GraphicsPath:()=>Ss,GraphicsPipe:()=>au,HTMLText:()=>Ld,HTMLTextPipe:()=>yu,HTMLTextRenderData:()=>Gl,HTMLTextStyle:()=>Js,HTMLTextSystem:()=>$l,HardLightBlend:()=>G4,HardMixBlend:()=>$4,HelloSystem:()=>Lo,IGLUniformData:()=>Ng,ImageSource:()=>An,InstructionSet:()=>dl,KTX:()=>_r,LightenBlend:()=>z4,LinearBurnBlend:()=>H4,LinearDodgeBlend:()=>W4,LinearLightBlend:()=>V4,Loader:()=>hd,LoaderParserPriority:()=>cr,LuminosityBlend:()=>j4,MSAA_QUALITY:()=>gk,MaskEffectManager:()=>L2,MaskEffectManagerClass:()=>Uh,MaskFilter:()=>U0,Matrix:()=>ue,Mesh:()=>Tn,MeshGeometry:()=>en,MeshPipe:()=>lu,MeshPlane:()=>gx,MeshRope:()=>xx,MeshSimple:()=>bx,NOOP:()=>Hh,NegationBlend:()=>X4,NineSliceGeometry:()=>eo,NineSlicePlane:()=>_x,NineSliceSprite:()=>bk,NineSliceSpritePipe:()=>_u,NoiseFilter:()=>fL,ObservablePoint:()=>Zt,OverlayBlend:()=>q4,PI_2:()=>Xm,Particle:()=>jL,ParticleBuffer:()=>y0,ParticleContainer:()=>qL,ParticleContainerPipe:()=>Bl,ParticleShader:()=>x0,PerspectiveMesh:()=>UL,PerspectivePlaneGeometry:()=>Gd,PinLightBlend:()=>Y4,PipelineSystem:()=>Qu,PlaneGeometry:()=>Hl,Point:()=>Ve,Polygon:()=>Ai,Pool:()=>xa,PoolGroupClass:()=>Oh,PrepareBase:()=>ax,PrepareQueue:()=>Od,PrepareSystem:()=>Y3,PrepareUpload:()=>Ud,QuadGeometry:()=>N0,RAD_TO_DEG:()=>qm,Rectangle:()=>$e,RenderContainer:()=>fx,RenderGroup:()=>H2,RenderGroupPipe:()=>Iu,RenderGroupSystem:()=>Du,RenderTarget:()=>zu,RenderTargetSystem:()=>Zl,RenderTexture:()=>G0,RenderableGCSystem:()=>$0,RendererInitHook:()=>Fu,RendererType:()=>Bt,ResizePlugin:()=>Vc,Resolver:()=>Sn,RopeGeometry:()=>yx,RoundedRectangle:()=>w0,SCALE_MODES:()=>TL,STENCIL_MODES:()=>Jt,SVGParser:()=>Q9,SVGToGraphicsPath:()=>G9,SaturationBlend:()=>K4,SchedulerSystem:()=>$u,ScissorMask:()=>ux,SdfShader:()=>P0,Shader:()=>xr,ShaderStage:()=>Tl,ShapePath:()=>E0,SharedRenderPipes:()=>j0,SharedSystems:()=>V0,SoftLightBlend:()=>Q4,Sprite:()=>At,SpritePipe:()=>Mu,Spritesheet:()=>Zh,State:()=>ur,StencilMask:()=>Qc,StencilMaskPipe:()=>Ou,SubtractBlend:()=>Z4,SystemRunner:()=>jl,TEXTURE_FORMAT_BLOCK_SIZE:()=>Py,Text:()=>ac,TextStyle:()=>dr,Texture:()=>re,TextureGCSystem:()=>sg,TextureMatrix:()=>fl,TexturePool:()=>rt,TexturePoolClass:()=>Wh,TextureSource:()=>ot,TextureStyle:()=>z2,TextureUvs:()=>dx,Ticker:()=>yr,TickerListener:()=>pl,TickerPlugin:()=>Xc,TilingSprite:()=>cx,TilingSpritePipe:()=>bu,TilingSpriteShader:()=>B0,Transform:()=>Nd,Triangle:()=>ox,UNIFORM_TO_ARRAY_SETTERS:()=>qg,UNIFORM_TO_SINGLE_SETTERS:()=>Xg,UNIFORM_TYPES_MAP:()=>p9,UNIFORM_TYPES_VALUES:()=>u4,UPDATE_BLEND:()=>W2,UPDATE_COLOR:()=>Hc,UPDATE_PRIORITY:()=>si,UPDATE_TRANSFORM:()=>EF,UPDATE_VISIBLE:()=>hl,UboBatch:()=>Y0,UboSystem:()=>Kl,UniformGroup:()=>pt,VERSION:()=>ql,VideoSource:()=>vl,ViewContainer:()=>Zr,ViewSystem:()=>W0,ViewableBuffer:()=>ps,VividLightBlend:()=>J4,WGSL_ALIGN_SIZE_DATA:()=>qu,WGSL_TO_STD40_SIZE:()=>f3,WRAP_MODES:()=>EL,WebGLRenderer:()=>y3,WebGPURenderer:()=>u3,WebWorkerAdapter:()=>sL,WorkerManager:()=>w3,_getGlobalBounds:()=>i7,_getGlobalBoundsRecursive:()=>M8,accessibilityTarget:()=>S7,addBits:()=>o4,addMaskBounds:()=>bl,addMaskLocalBounds:()=>_l,addProgramDefines:()=>K7,alphaFrag:()=>qy,alphaWgsl:()=>W3,applyMatrix:()=>T8,applyProjectiveTransformationToPlane:()=>hx,applyStyleParams:()=>g3,assignWithIgnore:()=>zc,autoDetectEnvironment:()=>aN,autoDetectRenderer:()=>ay,autoDetectSource:()=>YF,basisTranscoderUrls:()=>vd,bgr2rgb:()=>ba,bitmapFontCachePlugin:()=>ly,bitmapFontTextParser:()=>ud,bitmapFontXMLParser:()=>b3,bitmapFontXMLStringParser:()=>_3,blendTemplateFrag:()=>F8,blendTemplateVert:()=>B8,blendTemplateWgsl:()=>N8,blockDataMap:()=>c3,blurTemplateWgsl:()=>Jy,boundsPool:()=>ii,browserExt:()=>MA,buildAdaptiveBezier:()=>C0,buildAdaptiveQuadratic:()=>V9,buildArc:()=>A0,buildArcTo:()=>X9,buildArcToSvg:()=>q9,buildCircle:()=>_s,buildContextBatches:()=>m0,buildEllipse:()=>_9,buildGeometryFromPath:()=>RL,buildInstructions:()=>j8,buildLine:()=>l0,buildPixelLine:()=>E9,buildPolygon:()=>d0,buildRectangle:()=>f0,buildRoundedRectangle:()=>v9,buildSimpleUvs:()=>a0,buildTriangle:()=>h0,buildUvs:()=>o0,cacheAsTextureMixin:()=>Zm,cacheTextureArray:()=>uy,calculateProjection:()=>_g,checkChildrenDidChange:()=>$h,checkDataUrl:()=>Ti,checkExtension:()=>br,checkMaxIfStatementsInShader:()=>$7,childrenHelperMixin:()=>e7,cleanArray:()=>ig,cleanHash:()=>ng,clearList:()=>Pu,closePointEps:()=>S9,collectAllRenderables:()=>Xl,color32BitToUniform:()=>vs,colorBit:()=>Il,colorBitGl:()=>Pl,colorMatrixFilterFrag:()=>tx,colorMatrixFilterWgsl:()=>V3,colorToUniform:()=>CB,compareModeToGlCompare:()=>ny,compileHighShader:()=>o9,compileHighShaderGl:()=>a9,compileHighShaderGlProgram:()=>gs,compileHighShaderGpuProgram:()=>ms,compileHooks:()=>a4,compileInputs:()=>l4,compileOutputs:()=>s9,compileShader:()=>h3,compute2DProjection:()=>mx,convertFormatIfRequired:()=>iO,convertToList:()=>wn,copySearchParams:()=>qc,createIdFromString:()=>Ys,createIndicesForQuads:()=>x4,createLevelBuffers:()=>KN,createLevelBuffersFromKTX:()=>sO,createStringVariations:()=>P7,createTexture:()=>Hn,createUboElementsSTD40:()=>Dg,createUboElementsWGSL:()=>ug,createUboSyncFunction:()=>X0,createUboSyncFunctionSTD40:()=>Fg,createUboSyncFunctionWGSL:()=>yg,crossOrigin:()=>qT,cullingMixin:()=>jm,curveEps:()=>C9,defaultFilterVert:()=>nc,defaultValue:()=>od,definedProps:()=>Un,deprecation:()=>oe,detectAvif:()=>dy,detectBasis:()=>jN,detectCompressed:()=>cO,detectDefaults:()=>fy,detectMp4:()=>hy,detectOgv:()=>py,detectVideoAlphaMode:()=>Y2,detectWebm:()=>my,detectWebp:()=>gy,determineCrossOrigin:()=>KT,displacementFrag:()=>rx,displacementVert:()=>nx,displacementWgsl:()=>j3,earcut:()=>JL.default,effectsMixin:()=>t7,ensureAttributes:()=>K0,ensureIsBuffer:()=>s4,ensureOptions:()=>oc,ensurePrecision:()=>Q7,ensureTextStyle:()=>QL,executeInstructions:()=>ku,extensions:()=>ke,extractAttributesFromGlProgram:()=>$g,extractAttributesFromGpuProgram:()=>t9,extractFontFamilies:()=>g8,extractStructAndGroups:()=>r0,fastCopy:()=>eu,findHooksRx:()=>IS,findMixin:()=>r7,fontStringFromTextStyle:()=>Pa,formatShader:()=>bL,fragmentGPUTemplate:()=>c9,fragmentGlTemplate:()=>d9,generateArraySyncSTD40:()=>Rg,generateArraySyncWGSL:()=>gg,generateBlurFragSource:()=>Ky,generateBlurGlProgram:()=>Zy,generateBlurProgram:()=>ex,generateBlurVertSource:()=>Qy,generateGPULayout:()=>yL,generateGpuLayoutGroups:()=>r9,generateLayout:()=>xL,generateLayoutHash:()=>n9,generateParticleUpdateFunction:()=>B9,generateProgram:()=>Vg,generateShaderSyncCode:()=>Bg,generateTextStyleKey:()=>T0,generateTextureBatchBit:()=>Dl,generateTextureBatchBitGl:()=>Ml,generateUID:()=>kL,generateUniformsSync:()=>Yg,getAdjustedBlendModeBlend:()=>Xs,getAttributeInfoFromFormat:()=>$n,getBatchSamplersUniformGroup:()=>Rl,getBitmapTextLayout:()=>M0,getCanvasBoundingBox:()=>U9,getCanvasFillStyle:()=>Ll,getCanvasTexture:()=>H0,getDefaultUniformValue:()=>m9,getFastGlobalBounds:()=>D8,getFontCss:()=>x8,getFontFamilyName:()=>WT,getGeometryBounds:()=>X7,getGlTypeFromFormat:()=>Ig,getGlobalBounds:()=>Eo,getGlobalMixin:()=>a7,getGlobalRenderableBounds:()=>R8,getLocalBounds:()=>ul,getMatrixRelativeToParent:()=>F7,getMaxFragmentPrecision:()=>Y7,getMaxTexturesPerBatch:()=>Si,getOrientationOfPoints:()=>A9,getParent:()=>mw,getPo2TextureFromSource:()=>I0,getResolutionOfUrl:()=>ec,getSVGUrl:()=>b8,getSupportedCompressedTextureFormats:()=>bd,getSupportedGPUCompressedTextureFormats:()=>A3,getSupportedGlCompressedTextureFormats:()=>C3,getSupportedTextureFormats:()=>Go,getTemporaryCanvasFromImage:()=>_8,getTestContext:()=>K2,getTextureBatchBindGroup:()=>Sl,getTextureDefaultMatrix:()=>WL,getTextureFormatFromKTXTexture:()=>oO,getUboData:()=>zg,getUniformData:()=>Hg,getUrlExtension:()=>Ww,glFormatToGPUFormat:()=>Fy,glUploadBufferImageResource:()=>Zg,glUploadCompressedTextureResource:()=>Jg,glUploadImageResource:()=>ld,glUploadVideoResource:()=>ty,globalUniformsBit:()=>f9,globalUniformsBitGl:()=>h9,globalUniformsUBOBitGl:()=>lB,gpuFormatToBasisTranscoderFormat:()=>QN,gpuFormatToKTXBasisTranscoderFormat:()=>aO,gpuUploadBufferImageResource:()=>Sg,gpuUploadCompressedTextureResource:()=>Cg,gpuUploadImageResource:()=>J0,gpuUploadVideoResource:()=>Eg,groupD8:()=>yt,hasCachedCanvasTexture:()=>wN,hslWgsl:()=>hL,hslgl:()=>Wl,hslgpu:()=>Vl,injectBits:()=>c4,insertVersion:()=>Z7,isMobile:()=>v7,isPow2:()=>zh,isRenderingToScreen:()=>vg,isSafari:()=>d8,isSingleItem:()=>wa,isWebGLSupported:()=>No,isWebGPUSupported:()=>Oo,ktxTranscoderUrls:()=>Sd,loadBasis:()=>YN,loadBasisOnWorker:()=>Ty,loadBitmapFont:()=>cy,loadDDS:()=>ZN,loadEnvironmentExtensions:()=>e3,loadFontAsBase64:()=>y8,loadFontCSS:()=>D4,loadImageBitmap:()=>XT,loadJson:()=>yy,loadKTX:()=>JN,loadKTX2:()=>rO,loadKTX2onWorker:()=>Ry,loadSVGImage:()=>v8,loadSvg:()=>_y,loadTextures:()=>yd,loadTxt:()=>xy,loadVideoTextures:()=>vy,loadWebFont:()=>by,localUniformBit:()=>Ma,localUniformBitGl:()=>zl,localUniformBitGroup2:()=>S8,localUniformMSDFBit:()=>n8,localUniformMSDFBitGl:()=>i8,log2:()=>xF,logDebugTexture:()=>ZL,logProgramError:()=>Wg,logRenderGroupScene:()=>vk,logScene:()=>_k,mSDFBit:()=>s8,mSDFBitGl:()=>o8,mapFormatToGlFormat:()=>iy,mapFormatToGlInternalFormat:()=>sy,mapFormatToGlType:()=>oy,mapGlToVertexFormat:()=>Ug,mapSize:()=>vL,mapType:()=>p3,mapWebGLBlendModesToPixi:()=>Kg,maskFrag:()=>Z8,maskVert:()=>J8,maskWgsl:()=>s3,matrixPool:()=>Br,measureHtmlText:()=>F0,measureMixin:()=>c7,migrateFragmentFromV7toV8:()=>_L,mipmapScaleModeToGlFilter:()=>ry,mixHexColors:()=>PL,multiplyColors:()=>cl,multiplyHexColors:()=>G2,nextPow2:()=>wi,noiseFrag:()=>sx,noiseWgsl:()=>X3,nonCompressedFormats:()=>QT,normalizeExtensionPriority:()=>B2,nssvg:()=>f8,nsxhtml:()=>h8,onRenderMixin:()=>u7,parseDDS:()=>Dy,parseFunctionBody:()=>IL,parseKTX:()=>My,particleData:()=>Z3,particlesFrag:()=>N9,particlesVert:()=>O9,particlesWgsl:()=>b4,path:()=>zr,pointInTriangle:()=>q3,preloadVideo:()=>YT,removeItems:()=>O2,removeStructAndGroupDuplicates:()=>i9,resetUids:()=>fF,resolveCharacters:()=>D0,resolveCompressedTextureUrl:()=>lO,resolveJsonUrl:()=>wy,resolveTextureUrl:()=>xd,resourceToTexture:()=>eS,roundPixelsBit:()=>ys,roundPixelsBitGl:()=>xs,roundedShapeArc:()=>Y9,roundedShapeQuadraticCurve:()=>K9,sayHello:()=>rg,scaleModeToGlFilter:()=>m3,setBasisTranscoderPath:()=>XN,setKTXTranscoderPath:()=>eO,setPositions:()=>E8,setProgramName:()=>J7,setUvs:()=>k8,shapeBuilders:()=>p0,sortMixin:()=>d7,spritesheetAsset:()=>M7,squaredDistanceToLineSegment:()=>Nl,stripVersion:()=>e9,testImageFormat:()=>fd,testVideoFormat:()=>Jl,textStyleToCSS:()=>m8,textureBit:()=>$8,textureBitGl:()=>z8,textureFrom:()=>tS,tilingBit:()=>C8,tilingBitGl:()=>A8,toFillStyle:()=>Qs,toLocalGlobalMixin:()=>f7,toStrokeStyle:()=>Ol,transformVertices:()=>ru,triangulateWithHoles:()=>u0,uboSyncFunctionsSTD40:()=>a3,uboSyncFunctionsWGSL:()=>pg,uid:()=>gt,uniformParsers:()=>to,unpremultiplyAlpha:()=>FN,unsafeEvalSupported:()=>O0,updateLocalTransform:()=>DL,updateQuadBounds:()=>Sa,updateRenderGroupTransform:()=>zA,updateRenderGroupTransforms:()=>n3,updateTransformAndChildren:()=>q8,updateTransformBackwards:()=>U2,updateWorldTransform:()=>ML,v8_0_0:()=>Ie,v8_3_4:()=>Km,validFormats:()=>Cd,validateRenderables:()=>Y8,vertexGPUTemplate:()=>l9,vertexGlTemplate:()=>u9,viewportFromFrame:()=>AL,vkFormatToGPUFormat:()=>By,warn:()=>ve,webworkerExt:()=>RA,wrapModeToGlAddress:()=>cd});ee();var MA={extension:{type:z.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Promise.resolve().then(()=>(nN(),tQ))}};ee();var RA={extension:{type:z.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Promise.resolve().then(()=>(iN(),rQ))}};ee();ee();L7();R7();ee();Ci();qi();Hr();_t();Fo();var F8=`
in vec2 vTextureCoord;
in vec4 vColor;

out vec4 finalColor;

uniform float uBlend;

uniform sampler2D uTexture;
uniform sampler2D uBackTexture;

{FUNCTIONS}

void main()
{ 
    vec4 back = texture(uBackTexture, vTextureCoord);
    vec4 front = texture(uTexture, vTextureCoord);
    float blendedAlpha = front.a + back.a * (1.0 - front.a);
    
    {MAIN}
}
`;var B8=`in vec2 aPosition;
out vec2 vTextureCoord;
out vec2 backgroundUv;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var N8=`
struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct BlendUniforms {
  uBlend:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;
@group(0) @binding(3) var uBackTexture: texture_2d<f32>;

@group(1) @binding(0) var<uniform> blendUniforms : BlendUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

{FUNCTIONS}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>
) -> @location(0) vec4<f32> {


   var back =  textureSample(uBackTexture, uSampler, uv);
   var front = textureSample(uTexture, uSampler, uv);
   var blendedAlpha = front.a + back.a * (1.0 - front.a);
   
   var out = vec4<f32>(0.0,0.0,0.0,0.0);

   {MAIN}

   return out;
}`;var it=class extends be{constructor(e){let t=e.gpu,r=oN({source:N8,...t}),i=pe.from({vertex:{source:r,entryPoint:"mainVertex"},fragment:{source:r,entryPoint:"mainFragment"}}),s=e.gl,o=oN({source:F8,...s}),a=he.from({vertex:B8,fragment:o}),l=new pt({uBlend:{value:1,type:"f32"}});super({gpuProgram:i,glProgram:a,blendRequired:!0,resources:{blendUniforms:l,uBackTexture:re.EMPTY}})}};function oN(n){let{source:e,functions:t,main:r}=n;return e.replace("{FUNCTIONS}",t).replace("{MAIN}",r)}var Wl=`
	float getLuminosity(vec3 c) {
		return 0.3 * c.r + 0.59 * c.g + 0.11 * c.b;
	}

	vec3 setLuminosity(vec3 c, float lum) {
		float modLum = lum - getLuminosity(c);
		vec3 color = c.rgb + vec3(modLum);

		// clip back into legal range
		modLum = getLuminosity(color);
		vec3 modLumVec = vec3(modLum);

		float cMin = min(color.r, min(color.g, color.b));
		float cMax = max(color.r, max(color.g, color.b));

		if(cMin < 0.0) {
			color = mix(modLumVec, color, modLum / (modLum - cMin));
		}

		if(cMax > 1.0) {
			color = mix(modLumVec, color, (1.0 - modLum) / (cMax - modLum));
		}

		return color;
	}

	float getSaturation(vec3 c) {
		return max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));
	}

	vec3 setSaturationMinMidMax(vec3 cSorted, float s) {
		vec3 colorSorted = cSorted;

		if(colorSorted.z > colorSorted.x) {
			colorSorted.y = (((colorSorted.y - colorSorted.x) * s) / (colorSorted.z - colorSorted.x));
			colorSorted.z = s;
		}
		else {
			colorSorted.y = 0.0;
			colorSorted.z = 0.0;
		}

		colorSorted.x = 0.0;

		return colorSorted;
	}

	vec3 setSaturation(vec3 c, float s) {
		vec3 color = c;

		if(color.r <= color.g && color.r <= color.b) {
			if(color.g <= color.b) {
				color = setSaturationMinMidMax(color.rgb, s).rgb;
			}
			else {
				color = setSaturationMinMidMax(color.rbg, s).rbg;
			}
		}
		else if(color.g <= color.r && color.g <= color.b) {
			if(color.r <= color.b) {
				color = setSaturationMinMidMax(color.grb, s).grb;
			}
			else {
				color = setSaturationMinMidMax(color.gbr, s).gbr;
			}
		}
		else {
			// Using bgr for both fixes part of hue
			if(color.r <= color.g) {
				color = setSaturationMinMidMax(color.brg, s).brg;
			}
			else {
				color = setSaturationMinMidMax(color.bgr, s).bgr;
			}
		}

		return color;
	}
    `;var Vl=`
	fn getLuminosity(c: vec3<f32>) -> f32
	{
		return 0.3*c.r + 0.59*c.g + 0.11*c.b;
	}

	fn setLuminosity(c: vec3<f32>, lum: f32) -> vec3<f32>
	{
		var modLum: f32 = lum - getLuminosity(c);
		var color: vec3<f32> = c.rgb + modLum;

		// clip back into legal range
		modLum = getLuminosity(color);
		let modLumVec = vec3<f32>(modLum);

		let cMin: f32 = min(color.r, min(color.g, color.b));
		let cMax: f32 = max(color.r, max(color.g, color.b));

		if(cMin < 0.0)
		{
			color = mix(modLumVec, color, modLum / (modLum - cMin));
		}

		if(cMax > 1.0)
		{
			color = mix(modLumVec, color, (1 - modLum) / (cMax - modLum));
		}

		return color;
	}

	fn getSaturation(c: vec3<f32>) -> f32
	{
		return max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));
	}

	fn setSaturationMinMidMax(cSorted: vec3<f32>, s: f32) -> vec3<f32>
	{
		var colorSorted = cSorted;

		if(colorSorted.z > colorSorted.x)
		{
			colorSorted.y = (((colorSorted.y - colorSorted.x) * s) / (colorSorted.z - colorSorted.x));
			colorSorted.z = s;
		}
		else
		{
			colorSorted.y = 0;
			colorSorted.z = 0;
		}

		colorSorted.x = 0;

		return colorSorted;
	}

	fn setSaturation(c: vec3<f32>, s: f32) -> vec3<f32>
	{
		var color = c;

		if (color.r <= color.g && color.r <= color.b)
		{
			if (color.g <= color.b)
			{
				color = vec3<f32>(setSaturationMinMidMax(color.rgb, s)).rgb;
			}
			else
			{
				color = vec3<f32>(setSaturationMinMidMax(color.rbg, s)).rbg;
			}
		}
		else if (color.g <= color.r && color.g <= color.b)
		{
			if (color.r <= color.b)
			{
				color = vec3<f32>(setSaturationMinMidMax(color.grb, s)).grb;
			}
			else
			{
				color = vec3<f32>(setSaturationMinMidMax(color.gbr, s)).gbr;
			}
		}
		else
		{
			// Using bgr for both fixes part of hue
			if (color.r <= color.g)
			{
				color = vec3<f32>(setSaturationMinMidMax(color.brg, s)).brg;
			}
			else
			{
				color  = vec3<f32>(setSaturationMinMidMax(color.bgr, s)).bgr;
			}
		}

		return color;
	}
	`;var R4=class extends it{constructor(){super({gl:{functions:`
                ${Wl}

                vec3 blendColor(vec3 base, vec3 blend,  float opacity)
                {
                    return (setLuminosity(blend, getLuminosity(base)) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendColor(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                ${Vl}

                fn blendColorOpacity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (setLuminosity(blend, getLuminosity(base)) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendColorOpacity(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
                `}})}};R4.extension={name:"color",type:z.BlendMode};ee();var F4=class extends it{constructor(){super({gl:{functions:`
                float colorBurn(float base, float blend)
                {
                    return max((1.0 - ((1.0 - base) / blend)), 0.0);
                }

                vec3 blendColorBurn(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        colorBurn(base.r, blend.r),
                        colorBurn(base.g, blend.g),
                        colorBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                finalColor = vec4(blendColorBurn(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
            `},gpu:{functions:`
                fn colorBurn(base:f32, blend:f32) -> f32
                {
                    return max((1.0-((1.0-base)/blend)),0.0);
                }

                fn blendColorBurn(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        colorBurn(base.r, blend.r),
                        colorBurn(base.g, blend.g),
                        colorBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendColorBurn(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};F4.extension={name:"color-burn",type:z.BlendMode};ee();var B4=class extends it{constructor(){super({gl:{functions:`
                float colorDodge(float base, float blend)
                {
                    return base / (1.0 - blend);
                }

                vec3 blendColorDodge(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        colorDodge(base.r, blend.r),
                        colorDodge(base.g, blend.g),
                        colorDodge(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendColorDodge(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn colorDodge(base: f32, blend: f32) -> f32
                {
                    return base / (1.0 - blend);
                }

                fn blendColorDodge(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        colorDodge(base.r, blend.r),
                        colorDodge(base.g, blend.g),
                        colorDodge(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                    out = vec4<f32>(blendColorDodge(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
                `}})}};B4.extension={name:"color-dodge",type:z.BlendMode};ee();var N4=class extends it{constructor(){super({gl:{functions:`
                vec3 blendDarken(vec3 base, vec3 blend, float opacity)
                {
                    return (min(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendDarken(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn blendDarken(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (min(blend,base) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendDarken(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
                `}})}};N4.extension={name:"darken",type:z.BlendMode};ee();var O4=class extends it{constructor(){super({gl:{functions:`
                vec3 blendDifference(vec3 base, vec3 blend,  float opacity)
                {
                    return (abs(blend - base) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                finalColor = vec4(blendDifference(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
            `},gpu:{functions:`
                fn blendDifference(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (abs(blend - base) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendDifference(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};O4.extension={name:"difference",type:z.BlendMode};ee();var L4=class extends it{constructor(){super({gl:{functions:`
                float divide(float base, float blend)
                {
                    return (blend > 0.0) ? clamp(base / blend, 0.0, 1.0) : 1.0;
                }

                vec3 blendDivide(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        divide(base.r, blend.r),
                        divide(base.g, blend.g),
                        divide(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendDivide(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn divide(base: f32, blend: f32) -> f32
                {
                    return select(1.0, clamp(base / blend, 0.0, 1.0), blend > 0.0);
                }

                fn blendDivide(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        divide(base.r, blend.r),
                        divide(base.g, blend.g),
                        divide(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendDivide(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};L4.extension={name:"divide",type:z.BlendMode};ee();var U4=class extends it{constructor(){super({gl:{functions:`
                vec3 exclusion(vec3 base, vec3 blend)
                {
                    return base + blend - 2.0 * base * blend;
                }

                vec3 blendExclusion(vec3 base, vec3 blend, float opacity)
                {
                    return (exclusion(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendExclusion(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn exclusion(base: vec3<f32>, blend: vec3<f32>) -> vec3<f32>
                {
                    return base+blend-2.0*base*blend;
                }

                fn blendExclusion(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    return (exclusion(base, blend) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendExclusion(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};U4.extension={name:"exclusion",type:z.BlendMode};ee();var G4=class extends it{constructor(){super({gl:{functions:`
                float hardLight(float base, float blend)
                {
                    return (blend < 0.5) ? 2.0 * base * blend : 1.0 - 2.0 * (1.0 - base) * (1.0 - blend);
                }

                vec3 blendHardLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        hardLight(base.r, blend.r),
                        hardLight(base.g, blend.g),
                        hardLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                finalColor = vec4(blendHardLight(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
            `},gpu:{functions:`
                fn hardLight(base: f32, blend: f32) -> f32
                {
                    return select(1.0 - 2.0 * (1.0 - base) * (1.0 - blend), 2.0 * base * blend, blend < 0.5);
                }

                fn blendHardLight(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        hardLight(base.r, blend.r),
                        hardLight(base.g, blend.g),
                        hardLight(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendHardLight(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
                `}})}};G4.extension={name:"hard-light",type:z.BlendMode};ee();var $4=class extends it{constructor(){super({gl:{functions:`
                float hardMix(float base, float blend)
                {
                    return (base + blend >= 1.0) ? 1.0 : 0.0;
                }

                vec3 blendHardMix(vec3 base, vec3 blend,  float opacity)
                {
                    vec3 blended = vec3(
                        hardMix(base.r, blend.r),
                        hardMix(base.g, blend.g),
                        hardMix(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                finalColor = vec4(blendHardMix(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
            `},gpu:{functions:`
                fn hardMix(base: f32, blend: f32) -> f32
                {
                    return select(0.0, 1.0, base + blend >= 1.0);
                }

                fn blendHardMix(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended: vec3<f32> = vec3<f32>(
                        hardMix(base.r, blend.r),
                        hardMix(base.g, blend.g),
                        hardMix(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendHardMix(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};$4.extension={name:"hard-mix",type:z.BlendMode};ee();var z4=class extends it{constructor(){super({gl:{functions:`
                vec3 blendLighten(vec3 base, vec3 blend, float opacity)
                {
                    return (max(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendLighten(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn blendLighten(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (max(base, blend) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLighten(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};z4.extension={name:"lighten",type:z.BlendMode};ee();var H4=class extends it{constructor(){super({gl:{functions:`
                float linearBurn(float base, float blend)
                {
                    return max(0.0, base + blend - 1.0);
                }

                vec3 blendLinearBurn(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        linearBurn(base.r, blend.r),
                        linearBurn(base.g, blend.g),
                        linearBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendLinearBurn(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn linearBurn(base: f32, blend: f32) -> f32
                {
                    return max(0.0, base + blend - 1.0);
                }

                fn blendLinearBurn(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        linearBurn(base.r, blend.r),
                        linearBurn(base.g, blend.g),
                        linearBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendLinearBurn(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
                `}})}};H4.extension={name:"linear-burn",type:z.BlendMode};ee();var W4=class extends it{constructor(){super({gl:{functions:`
                float linearDodge(float base, float blend) {
                    return min(1.0, base + blend);
                }

                vec3 blendLinearDodge(vec3 base, vec3 blend, float opacity) {
                    vec3 blended = vec3(
                        linearDodge(base.r, blend.r),
                        linearDodge(base.g, blend.g),
                        linearDodge(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendLinearDodge(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn linearDodge(base: f32, blend: f32) -> f32
                {
                    return min(1, base + blend);
                }

                fn blendLinearDodge(base:vec3<f32>, blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        linearDodge(base.r, blend.r),
                        linearDodge(base.g, blend.g),
                        linearDodge(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLinearDodge(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};W4.extension={name:"linear-dodge",type:z.BlendMode};ee();var V4=class extends it{constructor(){super({gl:{functions:`
                float linearBurn(float base, float blend) {
                    return max(0.0, base + blend - 1.0);
                }

                float linearDodge(float base, float blend) {
                    return min(1.0, base + blend);
                }

                float linearLight(float base, float blend) {
                    return (blend <= 0.5) ? linearBurn(base,2.0*blend) : linearBurn(base,2.0*(blend-0.5));
                }

                vec3 blendLinearLight(vec3 base, vec3 blend, float opacity) {
                    vec3 blended = vec3(
                        linearLight(base.r, blend.r),
                        linearLight(base.g, blend.g),
                        linearLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                finalColor = vec4(blendLinearLight(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn linearBurn(base: f32, blend: f32) -> f32
                {
                    return max(0.0, base + blend - 1.0);
                }

                fn linearDodge(base: f32, blend: f32) -> f32
                {
                    return min(1.0, base + blend);
                }

                fn linearLight(base: f32, blend: f32) -> f32
                {
                    return select(linearBurn(base,2.0*(blend-0.5)), linearBurn(base,2.0*blend), blend <= 0.5);
                }

                fn blendLinearLightOpacity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        linearLight(base.r, blend.r),
                        linearLight(base.g, blend.g),
                        linearLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLinearLightOpacity(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};V4.extension={name:"linear-light",type:z.BlendMode};ee();var j4=class extends it{constructor(){super({gl:{functions:`
                ${Wl}

                vec3 blendLuminosity(vec3 base, vec3 blend,  float opacity)
                {
                    vec3 blendLuminosity = setLuminosity(base, getLuminosity(blend));
                    return (blendLuminosity * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendLuminosity(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                ${Vl}

                fn blendLuminosity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blendLuminosity: vec3<f32> = setLuminosity(base, getLuminosity(blend));
                    return (blendLuminosity * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLuminosity(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};j4.extension={name:"luminosity",type:z.BlendMode};ee();var X4=class extends it{constructor(){super({gl:{functions:`
                vec3 negation(vec3 base, vec3 blend)
                {
                    return 1.0-abs(1.0-base-blend);
                }

                vec3 blendNegation(vec3 base, vec3 blend, float opacity)
                {
                    return (negation(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendNegation(back.rgb, front.rgb, front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn blendNegation(base: vec3<f32>, blend: vec3<f32>) -> vec3<f32>
                {
                    return 1.0-abs(1.0-base-blend);
                }

                fn blendNegationOpacity(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    return (blendNegation(base, blend) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendNegationOpacity(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};X4.extension={name:"negation",type:z.BlendMode};ee();var q4=class extends it{constructor(){super({gl:{functions:`
                float overlay(float base, float blend)
                {
                    return (base < 0.5) ? (2.0*base*blend) : (1.0-2.0*(1.0-base)*(1.0-blend));
                }

                vec3 blendOverlay(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        overlay(base.r, blend.r),
                        overlay(base.g, blend.g),
                        overlay(base.b, blend.b)
                    );
   
                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendOverlay(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn overlay(base: f32, blend: f32) -> f32
                {
                    return select((1.0-2.0*(1.0-base)*(1.0-blend)), (2.0*base*blend), base < 0.5);
                }

                fn blendOverlay(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        overlay(base.r, blend.r),
                        overlay(base.g, blend.g),
                        overlay(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendOverlay(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
                `}})}};q4.extension={name:"overlay",type:z.BlendMode};ee();var Y4=class extends it{constructor(){super({gl:{functions:`
                float pinLight(float base, float blend)
                {
                    return (blend <= 0.5) ? min(base, 2.0 * blend) : max(base, 2.0 * (blend - 0.5));
                }

                vec3 blendPinLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        pinLight(base.r, blend.r),
                        pinLight(base.g, blend.g),
                        pinLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                finalColor = vec4(blendPinLight(back.rgb, front.rgb, front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn pinLight(base: f32, blend: f32) -> f32
                {
                    return select(max(base,2.0*(blend-0.5)), min(base,2.0*blend), blend <= 0.5);
                }

                fn blendPinLight(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        pinLight(base.r, blend.r),
                        pinLight(base.g, blend.g),
                        pinLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendPinLight(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
                `}})}};Y4.extension={name:"pin-light",type:z.BlendMode};ee();var K4=class extends it{constructor(){super({gl:{functions:`
                ${Wl}

                vec3 blendSaturation(vec3 base, vec3 blend,  float opacity)
                {
                    vec3 blendSaturation = setLuminosity(setSaturation(base, getSaturation(blend)), getLuminosity(base));
                    return (blendSaturation * opacity + base * (1.0 - opacity));
                }
            `,main:`
                finalColor = vec4(blendSaturation(back.rgb, front.rgb, front.a), blendedAlpha) * uBlend;
            `},gpu:{functions:`
                ${Vl}

                fn blendSaturation(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blendSaturation = setLuminosity(setSaturation(base, getSaturation(blend)), getLuminosity(base));
                    return (blendSaturation * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendSaturation(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
            `}})}};K4.extension={name:"saturation",type:z.BlendMode};ee();var Q4=class extends it{constructor(){super({gl:{functions:`
                float softLight(float base, float blend)
                {
                    return (blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend));
                }

                vec3 blendSoftLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        softLight(base.r, blend.r),
                        softLight(base.g, blend.g),
                        softLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendSoftLight(back.rgb, front.rgb, front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn softLight(base: f32, blend: f32) -> f32
                {
                    return select(2.0 * base * blend + base * base * (1.0 - 2.0 * blend), sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend), blend < 0.5);
                }

                fn blendSoftLight(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended: vec3<f32> = vec3<f32>(
                        softLight(base.r, blend.r),
                        softLight(base.g, blend.g),
                        softLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendSoftLight(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
                `}})}};Q4.extension={name:"soft-light",type:z.BlendMode};ee();var Z4=class extends it{constructor(){super({gl:{functions:`
                float subtract(float base, float blend)
                {
                    return max(0.0, base - blend);
                }

                vec3 blendSubtract(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        subtract(base.r, blend.r),
                        subtract(base.g, blend.g),
                        subtract(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                finalColor = vec4(blendSubtract(back.rgb, front.rgb, front.a), blendedAlpha) * uBlend;
                `},gpu:{functions:`
                fn subtract(base: f32, blend: f32) -> f32
                {
                    return max(0, base - blend);
                }

                fn blendSubtract(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        subtract(base.r, blend.r),
                        subtract(base.g, blend.g),
                        subtract(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendSubtract(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
                `}})}};Z4.extension={name:"subtract",type:z.BlendMode};ee();var J4=class extends it{constructor(){super({gl:{functions:`
                float colorBurn(float base, float blend)
                {
                    return max((1.0-((1.0-base)/blend)),0.0);
                }

                float colorDodge(float base, float blend)
                {
                    return min(1.0, base / (1.0-blend));
                }

                float vividLight(float base, float blend)
                {
                    return (blend < 0.5) ? colorBurn(base,(2.0*blend)) : colorDodge(base,(2.0*(blend-0.5)));
                }

                vec3 blendVividLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        vividLight(base.r, blend.r),
                        vividLight(base.g, blend.g),
                        vividLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                finalColor = vec4(blendVividLight(back.rgb, front.rgb,front.a), blendedAlpha) * uBlend;
            `},gpu:{functions:`
                fn colorBurn(base:f32, blend:f32) -> f32
                {
                    return max((1.0-((1.0-base)/blend)),0.0);
                }

                fn colorDodge(base: f32, blend: f32) -> f32
                {
                    return min(1.0, base / (1.0-blend));
                }

                fn vividLight(base: f32, blend: f32) -> f32
                {
                    return select(colorDodge(base,(2.0*(blend-0.5))), colorBurn(base,(2.0*blend)), blend<0.5);
                }

                fn blendVividLight(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended: vec3<f32> = vec3<f32>(
                        vividLight(base.r, blend.r),
                        vividLight(base.g, blend.g),
                        vividLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendVividLight(back.rgb, front.rgb, front.a), blendedAlpha) * blendUniforms.uBlend;
                `}})}};J4.extension={name:"vivid-light",type:z.BlendMode};ee();Vt();L0();var U8;function No(n){return U8!==void 0||(U8=(()=>{let e={stencil:!0,failIfMajorPerformanceCaveat:n??Bo.defaultOptions.failIfMajorPerformanceCaveat};try{if(!Fe.get().getWebGLRenderingContext())return!1;let r=Fe.get().createCanvas().getContext("webgl",e),i=!!r?.getContextAttributes()?.stencil;if(r){let s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,i}catch{return!1}})()),U8}Vt();var G8;async function Oo(n={}){return G8!==void 0||(G8=await(async()=>{let e=Fe.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(n)).requestDevice(),!0}catch{return!1}})()),G8}L0();var GN=["webgl","webgpu","canvas"];async function ay(n){let e=[];n.preference?(e.push(n.preference),GN.forEach(s=>{s!==n.preference&&e.push(s)})):e=GN.slice();let t,r={};for(let s=0;s<e.length;s++){let o=e[s];if(o==="webgpu"&&await Oo()){let{WebGPURenderer:a}=await Promise.resolve().then(()=>(XE(),TN));t=a,r={...n,...n.webgpu};break}else if(o==="webgl"&&No(n.failIfMajorPerformanceCaveat??Bo.defaultOptions.failIfMajorPerformanceCaveat)){let{WebGLRenderer:a}=await Promise.resolve().then(()=>(zT(),UN));t=a,r={...n,...n.webgl};break}else if(o==="canvas")throw r={...n},new Error("CanvasRenderer is not yet implemented")}if(delete r.webgpu,delete r.webgl,!t)throw new Error("No available renderer for the current environment");let i=new t;return await i.init(r),i}Vi();Q8();zt();var $N=class HT{constructor(...e){this.stage=new we,e[0]!==void 0&&oe(Ie,"Application constructor options are deprecated, please use Application.init() instead.")}async init(e){e={...e},this.renderer=await ay(e),HT._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return oe(Ie,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(e=!1,t=!1){let r=HT._plugins.slice(0);r.reverse(),r.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};$N._plugins=[];var x3=$N;ke.handleByList(z.Application,x3._plugins);ke.add(Ru);ee();Xi();D7();Vt();ee();gl();Qr();_t();a8();I4();var ro=class extends Ul{constructor(e,t){super();let{textures:r,data:i}=e;Object.keys(i.pages).forEach(s=>{let o=i.pages[parseInt(s,10)],a=r[o.id];this.pages.push({texture:a})}),Object.keys(i.chars).forEach(s=>{let o=i.chars[s],{frame:a,source:l}=r[o.page],c=new $e(o.x+a.x,o.y+a.y,o.width,o.height),u=new re({source:l,frame:c});this.chars[s]={id:s.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:u}}),this.baseRenderedFontSize=i.fontSize,this.baseMeasurementFontSize=i.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:i.fontSize},this.baseLineOffset=i.baseLineOffset,this.lineHeight=i.lineHeight,this.fontFamily=i.fontFamily,this.distanceField=i.distanceField??{type:"none",range:0},this.url=t}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){let{texture:t}=this.pages[e];t.destroy(!0)}this.pages=null}static install(e){Qi.install(e)}static uninstall(e){Qi.uninstall(e)}};var ud={test(n){return typeof n=="string"&&n.startsWith("info face=")},parse(n){let e=n.match(/^[a-z]+\s+.+$/gm),t={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let d in e){let f=e[d].match(/^[a-z]+/gm)[0],h=e[d].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),p={};for(let m in h){let g=h[m].split("="),y=g[0],x=g[1].replace(/"/gm,""),b=parseFloat(x),_=isNaN(b)?x:b;p[y]=_}t[f].push(p)}let r={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[i]=t.info,[s]=t.common,[o]=t.distanceField??[];o&&(r.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),r.fontSize=parseInt(i.size,10),r.fontFamily=i.face,r.lineHeight=parseInt(s.lineHeight,10);let a=t.page;for(let d=0;d<a.length;d++)r.pages.push({id:parseInt(a[d].id,10)||0,file:a[d].file});let l={};r.baseLineOffset=r.lineHeight-parseInt(s.base,10);let c=t.char;for(let d=0;d<c.length;d++){let f=c[d],h=parseInt(f.id,10),p=f.letter??f.char??String.fromCharCode(h);p==="space"&&(p=" "),l[h]=p,r.chars[p]={id:h,page:parseInt(f.page,10)||0,x:parseInt(f.x,10),y:parseInt(f.y,10),width:parseInt(f.width,10),height:parseInt(f.height,10),xOffset:parseInt(f.xoffset,10),yOffset:parseInt(f.yoffset,10),xAdvance:parseInt(f.xadvance,10),kerning:{}}}let u=t.kerning||[];for(let d=0;d<u.length;d++){let f=parseInt(u[d].first,10),h=parseInt(u[d].second,10),p=parseInt(u[d].amount,10);r.chars[l[h]].kerning[l[f]]=p}return r}};Vt();var b3={test(n){let e=n;return typeof e!="string"&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(n){let e={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},t=n.getElementsByTagName("info")[0],r=n.getElementsByTagName("common")[0],i=n.getElementsByTagName("distanceField")[0];i&&(e.distanceField={type:i.getAttribute("fieldType"),range:parseInt(i.getAttribute("distanceRange"),10)});let s=n.getElementsByTagName("page"),o=n.getElementsByTagName("char"),a=n.getElementsByTagName("kerning");e.fontSize=parseInt(t.getAttribute("size"),10),e.fontFamily=t.getAttribute("face"),e.lineHeight=parseInt(r.getAttribute("lineHeight"),10);for(let c=0;c<s.length;c++)e.pages.push({id:parseInt(s[c].getAttribute("id"),10)||0,file:s[c].getAttribute("file")});let l={};e.baseLineOffset=e.lineHeight-parseInt(r.getAttribute("base"),10);for(let c=0;c<o.length;c++){let u=o[c],d=parseInt(u.getAttribute("id"),10),f=u.getAttribute("letter")??u.getAttribute("char")??String.fromCharCode(d);f==="space"&&(f=" "),l[d]=f,e.chars[f]={id:d,page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xOffset:parseInt(u.getAttribute("xoffset"),10),yOffset:parseInt(u.getAttribute("yoffset"),10),xAdvance:parseInt(u.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<a.length;c++){let u=parseInt(a[c].getAttribute("first"),10),d=parseInt(a[c].getAttribute("second"),10),f=parseInt(a[c].getAttribute("amount"),10);e.chars[l[d]].kerning[l[u]]=f}return e}};var _3={test(n){return typeof n=="string"&&n.includes("<font>")?b3.test(Fe.get().parseXML(n)):!1},parse(n){return b3.parse(Fe.get().parseXML(n))}};var NQ=[".xml",".fnt"],ly={extension:{type:z.CacheParser,name:"cacheBitmapFont"},test:n=>n instanceof ro,getCacheableAssets(n,e){let t={};return n.forEach(r=>{t[r]=e,t[`${r}-bitmap`]=e}),t[`${e.fontFamily}-bitmap`]=e,t}},cy={extension:{type:z.LoadParser,priority:cr.Normal},name:"loadBitmapFont",test(n){return NQ.includes(zr.extname(n).toLowerCase())},async testParse(n){return ud.test(n)||_3.test(n)},async parse(n,e,t){let r=ud.test(n)?ud.parse(n):_3.parse(n),{src:i}=e,{pages:s}=r,o=[],a=r.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let d=0;d<s.length;++d){let f=s[d].file,h=zr.join(zr.dirname(i),f);h=qc(h,i),o.push({src:h,data:a})}let l=await t.load(o),c=o.map(d=>l[d.src]);return new ro({data:r,textures:c},i)},async load(n,e){return await(await Fe.get().fetch(n)).text()},async unload(n,e,t){await Promise.all(n.pages.map(r=>t.unload(r.texture.source._sourceOrigin))),n.destroy()}};Gt();var dd=class{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<t;r++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}};Io();ee();_t();var uy={extension:{type:z.CacheParser,name:"cacheTextureArray"},test:n=>Array.isArray(n)&&n.every(e=>e instanceof re),getCacheableAssets:(n,e)=>{let t={};return n.forEach(r=>{e.forEach((i,s)=>{t[r+(s===0?"":s+1)]=i})}),t}};ee();async function fd(n){if("Image"in globalThis)return new Promise(e=>{let t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=n});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{let e=await(await fetch(n)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}var dy={extension:{type:z.DetectionParser,priority:1},test:async()=>fd("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async n=>[...n,"avif"],remove:async n=>n.filter(e=>e!=="avif")};ee();var zN=["png","jpg","jpeg"],fy={extension:{type:z.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async n=>[...n,...zN],remove:async n=>n.filter(e=>!zN.includes(e))};ee();var OQ="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Jl(n){return OQ?!1:document.createElement("video").canPlayType(n)!==""}var hy={extension:{type:z.DetectionParser,priority:0},test:async()=>Jl("video/mp4"),add:async n=>[...n,"mp4","m4v"],remove:async n=>n.filter(e=>e!=="mp4"&&e!=="m4v")};ee();var py={extension:{type:z.DetectionParser,priority:0},test:async()=>Jl("video/ogg"),add:async n=>[...n,"ogv"],remove:async n=>n.filter(e=>e!=="ogv")};ee();var my={extension:{type:z.DetectionParser,priority:0},test:async()=>Jl("video/webm"),add:async n=>[...n,"webm"],remove:async n=>n.filter(e=>e!=="webm")};ee();var gy={extension:{type:z.DetectionParser,priority:0},test:async()=>fd("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async n=>[...n,"webp"],remove:async n=>n.filter(e=>e!=="webp")};Gt();gl();q2();Kh();var hd=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,r)=>(this._parsersValidated=!1,e[t]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){let r={promise:null,parser:null};return r.promise=(async()=>{let i=null,s=null;if(t.loadParser&&(s=this._parserHash[t.loadParser],s||ve(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!s){for(let o=0;o<this.parsers.length;o++){let a=this.parsers[o];if(a.load&&a.test?.(e,t,this)){s=a;break}}if(!s)return ve(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}i=await s.load(e,t,this),r.parser=s;for(let o=0;o<this.parsers.length;o++){let a=this.parsers[o];a.parse&&a.parse&&await a.testParse?.(i,t,this)&&(i=await a.parse(i,t,this)||i,r.parser=a)}return i})(),r}async load(e,t){this._parsersValidated||this._validateParsers();let r=0,i={},s=wa(e),o=wn(e,c=>({alias:[c],src:c,data:{}})),a=o.length,l=o.map(async c=>{let u=zr.toAbsolute(c.src);if(!i[c.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,c)),i[c.src]=await this.promiseCache[u].promise,t&&t(++r/a)}catch(d){throw delete this.promiseCache[u],delete i[c.src],new Error(`[Loader.load] Failed to load ${u}.
${d}`)}});return await Promise.all(l),s?i[o[0].src]:i}async unload(e){let r=wn(e,i=>({alias:[i],src:i})).map(async i=>{let s=zr.toAbsolute(i.src),o=this.promiseCache[s];if(o){let a=await o.promise;delete this.promiseCache[s],await o.parser?.unload?.(a,i,this)}});await Promise.all(r)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(t.name?e[t.name]&&ve(`[Assets] loadParser name conflict "${t.name}"`):ve("[Assets] loadParser should have a name"),{...e,[t.name]:t}),{})}};Vt();ee();function Ti(n,e){if(Array.isArray(e)){for(let t of e)if(n.startsWith(`data:${t}`))return!0;return!1}return n.startsWith(`data:${e}`)}gl();function br(n,e){let t=n.split("?")[0],r=zr.extname(t).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}Xi();var LQ=".json",UQ="application/json",yy={extension:{type:z.LoadParser,priority:cr.Low},name:"loadJson",test(n){return Ti(n,UQ)||br(n,LQ)},async load(n){return await(await Fe.get().fetch(n)).json()}};Vt();ee();Xi();var GQ=".txt",$Q="text/plain",xy={name:"loadTxt",extension:{type:z.LoadParser,priority:cr.Low,name:"loadTxt"},test(n){return Ti(n,$Q)||br(n,GQ)},async load(n){return await(await Fe.get().fetch(n)).text()}};Vt();ee();Gt();gl();Io();Xi();var zQ=["normal","bold","100","200","300","400","500","600","700","800","900"],HQ=[".ttf",".otf",".woff",".woff2"],WQ=["font/ttf","font/otf","font/woff","font/woff2"],VQ=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function WT(n){let e=zr.extname(n),i=zr.basename(n,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)),s=i.length>0;for(let a of i)if(!a.match(VQ)){s=!1;break}let o=i.join(" ");return s||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}var jQ=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function XQ(n){return jQ.test(n)?n:encodeURI(n)}var by={extension:{type:z.LoadParser,priority:cr.Low},name:"loadWebFont",test(n){return Ti(n,WQ)||br(n,HQ)},async load(n,e){let t=Fe.get().getFontFaceSet();if(t){let r=[],i=e.data?.family??WT(n),s=e.data?.weights?.filter(a=>zQ.includes(a))??["normal"],o=e.data??{};for(let a=0;a<s.length;a++){let l=s[a],c=new FontFace(i,`url(${XQ(n)})`,{...o,weight:l});await c.load(),t.add(c),r.push(c)}return kt.set(`${i}-and-url`,{url:n,fontFaces:r}),r.length===1?r[0]:r}return ve("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(n){(Array.isArray(n)?n:[n]).forEach(e=>{kt.remove(`${e.family}-and-url`),Fe.get().getFontFaceSet().delete(e)})}};Vt();ee();Jc();pu();yl();function ec(n,e=1){let t=Sn.RETINA_PREFIX?.exec(n);return t?parseFloat(t[1]):e}Xi();_t();Gt();Io();function Hn(n,e,t){n.label=t,n._sourceOrigin=t;let r=new re({source:n,label:t}),i=()=>{delete e.promiseCache[t],kt.has(t)&&kt.remove(t)};return r.source.once("destroy",()=>{e.promiseCache[t]&&(ve("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),i())}),r.once("destroy",()=>{n.destroyed||(ve("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),i())}),r}var qQ=".svg",YQ="image/svg+xml",_y={extension:{type:z.LoadParser,priority:cr.Low,name:"loadSVG"},name:"loadSVG",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(n){return Ti(n,YQ)||br(n,qQ)},async load(n,e,t){return e.data.parseAsGraphicsContext??this.config.parseAsGraphicsContext?QQ(n):KQ(n,e,t,this.config.crossOrigin)},unload(n){n.destroy(!0)}};async function KQ(n,e,t,r){let s=await(await Fe.get().fetch(n)).blob(),o=URL.createObjectURL(s),a=new Image;a.src=o,a.crossOrigin=r,await a.decode(),URL.revokeObjectURL(o);let l=document.createElement("canvas"),c=l.getContext("2d"),u=e.data?.resolution||ec(n),d=e.data?.width??a.width,f=e.data?.height??a.height;l.width=d*u,l.height=f*u,c.drawImage(a,0,0,d*u,f*u);let{parseAsGraphicsContext:h,...p}=e.data,m=new An({resource:l,alphaMode:"premultiply-alpha-on-upload",resolution:u,...p});return Hn(m,t,n)}async function QQ(n){let t=await(await Fe.get().fetch(n)).text(),r=new Wr;return r.svg(t),r}Vt();ee();Jc();var ZQ=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`,pd=null,md=class{constructor(){pd||(pd=URL.createObjectURL(new Blob([ZQ],{type:"application/javascript"}))),this.worker=new Worker(pd)}};md.revokeObjectURL=function(){pd&&(URL.revokeObjectURL(pd),pd=null)};var JQ=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`,gd=null,v3=class{constructor(){gd||(gd=URL.createObjectURL(new Blob([JQ],{type:"application/javascript"}))),this.worker=new Worker(gd)}};v3.revokeObjectURL=function(){gd&&(URL.revokeObjectURL(gd),gd=null)};var HN=0,VT,jT=class{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{let{worker:t}=new md;t.addEventListener("message",r=>{t.terminate(),md.revokeObjectURL(),e(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e,t){return this._run("loadImageBitmap",[e,t?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){VT===void 0&&(VT=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<VT&&(this._createdWorkers++,e=new v3().worker,e.addEventListener("message",t=>{this._complete(t.data),this._returnWorker(t.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){e.error!==void 0?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),this._resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();let r=new Promise((i,s)=>{this._queue.push({id:e,arguments:t,resolve:i,reject:s})});return this._next(),r}_next(){if(!this._queue.length)return;let e=this._getWorker();if(!e)return;let t=this._queue.pop(),r=t.id;this._resolveHash[HN]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:HN++,id:r})}},w3=new jT;Xi();var eZ=[".jpeg",".jpg",".png",".webp",".avif"],tZ=["image/jpeg","image/png","image/webp","image/avif"];async function XT(n,e){let t=await Fe.get().fetch(n);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${n}: ${t.status} ${t.statusText}`);let r=await t.blob();return e?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(r,{premultiplyAlpha:"none"}):createImageBitmap(r)}var yd={name:"loadTextures",extension:{type:z.LoadParser,priority:cr.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(n){return Ti(n,tZ)||br(n,eZ)},async load(n,e,t){let r=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await w3.isImageBitmapSupported()?r=await w3.loadImageBitmap(n,e):r=await XT(n,e):r=await new Promise(s=>{r=new Image,r.crossOrigin=this.config.crossOrigin,r.src=n,r.complete?s(r):r.onload=()=>{s(r)}});let i=new An({resource:r,alphaMode:"premultiply-alpha-on-upload",resolution:e.data?.resolution||ec(n),...e.data});return Hn(i,t,n)},unload(n){n.destroy(!0)}};ee();O7();B7();var WN=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],rZ=WN.map(n=>`video/${n.substring(1)}`);function qT(n,e,t){t===void 0&&!e.startsWith("data:")?n.crossOrigin=KT(e):t!==!1&&(n.crossOrigin=typeof t=="string"?t:"anonymous")}function YT(n){return new Promise((e,t)=>{n.addEventListener("canplaythrough",r),n.addEventListener("error",i),n.load();function r(){s(),e()}function i(o){s(),t(o)}function s(){n.removeEventListener("canplaythrough",r),n.removeEventListener("error",i)}})}function KT(n,e=globalThis.location){if(n.startsWith("data:"))return"";e||(e=globalThis.location);let t=new URL(n,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}var vy={name:"loadVideo",extension:{type:z.LoadParser,name:"loadVideo"},test(n){let e=Ti(n,rZ),t=br(n,WN);return e||t},async load(n,e,t){let r={...vl.defaultOptions,resolution:e.data?.resolution||ec(n),alphaMode:e.data?.alphaMode||await Y2(),...e.data},i=document.createElement("video"),s={preload:r.autoLoad!==!1?"auto":void 0,"webkit-playsinline":r.playsinline!==!1?"":void 0,playsinline:r.playsinline!==!1?"":void 0,muted:r.muted===!0?"":void 0,loop:r.loop===!0?"":void 0,autoplay:r.autoPlay!==!1?"":void 0};Object.keys(s).forEach(l=>{let c=s[l];c!==void 0&&i.setAttribute(l,c)}),r.muted===!0&&(i.muted=!0),qT(i,n,r.crossorigin);let o=document.createElement("source"),a;if(n.startsWith("data:"))a=n.slice(5,n.indexOf(";"));else if(!n.startsWith("blob:")){let l=n.split("?")[0].slice(n.lastIndexOf(".")+1).toLowerCase();a=vl.MIME_TYPES[l]||`video/${l}`}return o.src=n,a&&(o.type=a),new Promise(l=>{let c=async()=>{let u=new vl({...r,resource:i});i.removeEventListener("canplay",c),e.data.preload&&await YT(i),l(Hn(u,t,n))};i.addEventListener("canplay",c),i.appendChild(o)})},unload(n){n.destroy(!0)}};ee();yl();ee();yl();var xd={extension:{type:z.ResolveParser,name:"resolveTexture"},test:yd.test,parse:n=>({resolution:parseFloat(Sn.RETINA_PREFIX.exec(n)?.[1]??"1"),format:n.split(".").pop(),src:n})};var wy={extension:{type:z.ResolveParser,priority:-2,name:"resolveJson"},test:n=>Sn.RETINA_PREFIX.test(n)&&n.endsWith(".json"),parse:xd.parse};yl();q2();Kh();var S3=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Sn,this.loader=new hd,this.cache=kt,this._backgroundLoader=new dd(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){ve("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let s=e.manifest;typeof s=="string"&&(s=await this.load(s)),this.resolver.addManifest(s)}let t=e.texturePreference?.resolution??1,r=typeof t=="number"?[t]:t,i=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:i,resolution:r}}),e.preferences&&this.setPreferences(e.preferences)}add(e){this.resolver.add(e)}async load(e,t){this._initialized||await this.init();let r=wa(e),i=wn(e).map(a=>{if(typeof a!="string"){let l=this.resolver.getAlias(a);return l.some(c=>!this.resolver.hasKey(c))&&this.add(a),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),s=this.resolver.resolve(i),o=await this._mapLoadToResolve(s,t);return r?o[i[0]]:o}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let r=!1;typeof e=="string"&&(r=!0,e=[e]);let i=this.resolver.resolveBundle(e),s={},o=Object.keys(i),a=0,l=0,c=()=>{t?.(++a/l)},u=o.map(d=>{let f=i[d];return l+=Object.keys(f).length,this._mapLoadToResolve(f,c).then(h=>{s[d]=h})});return await Promise.all(u),r?s[e[0]]:s}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);let t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);let t=this.resolver.resolveBundle(e);Object.values(t).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return kt.get(e);let t={};for(let r=0;r<e.length;r++)t[r]=kt.get(e[r]);return t}async _mapLoadToResolve(e,t){let r=[...new Set(Object.values(e))];this._backgroundLoader.active=!1;let i=await this.loader.load(r,t);this._backgroundLoader.active=!0;let s={};return r.forEach(o=>{let a=i[o.src],l=[o.src];o.alias&&l.push(...o.alias),l.forEach(c=>{s[c]=a}),kt.set(l,a)}),s}async unload(e){this._initialized||await this.init();let t=wn(e).map(i=>typeof i!="string"?i.src:i),r=this.resolver.resolve(t);await this._unloadFromResolved(r)}async unloadBundle(e){this._initialized||await this.init(),e=wn(e);let t=this.resolver.resolveBundle(e),r=Object.keys(t).map(i=>this._unloadFromResolved(t[i]));await Promise.all(r)}async _unloadFromResolved(e){let t=Object.values(e);t.forEach(r=>{kt.remove(r.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(let r of e.detections)e.skipDetections||await r.test()?t=await r.add(t):e.skipDetections||(t=await r.remove(t));return t=t.filter((r,i)=>t.indexOf(r)===i),t}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(r=>r in e).forEach(r=>{t.config[r]=e[r]})})}},Ra=new S3;ke.handleByList(z.LoadParser,Ra.loader.parsers).handleByList(z.ResolveParser,Ra.resolver.parsers).handleByList(z.CacheParser,Ra.cache.parsers).handleByList(z.DetectionParser,Ra.detections);ke.add(uy,fy,dy,gy,hy,py,my,yy,xy,by,_y,yd,vy,cy,ly,xd,wy);var VN={loader:z.LoadParser,resolver:z.ResolveParser,cache:z.CacheParser,detection:z.DetectionParser};ke.handle(z.Asset,n=>{let e=n.ref;Object.entries(VN).filter(([t])=>!!e[t]).forEach(([t,r])=>ke.add(Object.assign(e[t],{extension:e[t].extension??r})))},n=>{let e=n.ref;Object.keys(VN).filter(t=>!!e[t]).forEach(t=>ke.remove(e[t]))});ee();var jN={extension:{type:z.DetectionParser,priority:3},test:async()=>!!(await Oo()||No()),add:async n=>[...n,"basis"],remove:async n=>n.filter(e=>e!=="basis")};Xi();ee();cn();var As=class extends ot{constructor(e){super(e),this.uploadMethodId="compressed",this.resource=e.resource,this.mipLevelCount=this.resource.length}};var Sy;function C3(){if(Sy)return Sy;let e=document.createElement("canvas").getContext("webgl");return e?(Sy=[...e.getExtension("EXT_texture_compression_bptc")?["bc6h-rgb-ufloat","bc6h-rgb-float","bc7-rgba-unorm","bc7-rgba-unorm-srgb"]:[],...e.getExtension("WEBGL_compressed_texture_s3tc")?["bc1-rgba-unorm","bc2-rgba-unorm","bc3-rgba-unorm"]:[],...e.getExtension("WEBGL_compressed_texture_s3tc_srgb")?["bc1-rgba-unorm-srgb","bc2-rgba-unorm-srgb","bc3-rgba-unorm-srgb"]:[],...e.getExtension("EXT_texture_compression_rgtc")?["bc4-r-unorm","bc4-r-snorm","bc5-rg-unorm","bc5-rg-snorm"]:[],...e.getExtension("WEBGL_compressed_texture_etc")?["etc2-rgb8unorm","etc2-rgb8unorm-srgb","etc2-rgba8unorm","etc2-rgba8unorm-srgb","etc2-rgb8a1unorm","etc2-rgb8a1unorm-srgb","eac-r11unorm","eac-rg11unorm"]:[],...e.getExtension("WEBGL_compressed_texture_astc")?["astc-4x4-unorm","astc-4x4-unorm-srgb","astc-5x4-unorm","astc-5x4-unorm-srgb","astc-5x5-unorm","astc-5x5-unorm-srgb","astc-6x5-unorm","astc-6x5-unorm-srgb","astc-6x6-unorm","astc-6x6-unorm-srgb","astc-8x5-unorm","astc-8x5-unorm-srgb","astc-8x6-unorm","astc-8x6-unorm-srgb","astc-8x8-unorm","astc-8x8-unorm-srgb","astc-10x5-unorm","astc-10x5-unorm-srgb","astc-10x6-unorm","astc-10x6-unorm-srgb","astc-10x8-unorm","astc-10x8-unorm-srgb","astc-10x10-unorm","astc-10x10-unorm-srgb","astc-12x10-unorm","astc-12x10-unorm-srgb","astc-12x12-unorm","astc-12x12-unorm-srgb"]:[]],Sy):[]}Vt();var Cy;async function A3(){if(Cy)return Cy;let n=await Fe.get().getNavigator().gpu.requestAdapter();return Cy=[...n.features.has("texture-compression-bc")?["bc1-rgba-unorm","bc1-rgba-unorm-srgb","bc2-rgba-unorm","bc2-rgba-unorm-srgb","bc3-rgba-unorm","bc3-rgba-unorm-srgb","bc4-r-unorm","bc4-r-snorm","bc5-rg-unorm","bc5-rg-snorm","bc6h-rgb-ufloat","bc6h-rgb-float","bc7-rgba-unorm","bc7-rgba-unorm-srgb"]:[],...n.features.has("texture-compression-etc2")?["etc2-rgb8unorm","etc2-rgb8unorm-srgb","etc2-rgb8a1unorm","etc2-rgb8a1unorm-srgb","etc2-rgba8unorm","etc2-rgba8unorm-srgb","eac-r11unorm","eac-r11snorm","eac-rg11unorm","eac-rg11snorm"]:[],...n.features.has("texture-compression-astc")?["astc-4x4-unorm","astc-4x4-unorm-srgb","astc-5x4-unorm","astc-5x4-unorm-srgb","astc-5x5-unorm","astc-5x5-unorm-srgb","astc-6x5-unorm","astc-6x5-unorm-srgb","astc-6x6-unorm","astc-6x6-unorm-srgb","astc-8x5-unorm","astc-8x5-unorm-srgb","astc-8x6-unorm","astc-8x6-unorm-srgb","astc-8x8-unorm","astc-8x8-unorm-srgb","astc-10x5-unorm","astc-10x5-unorm-srgb","astc-10x6-unorm","astc-10x6-unorm-srgb","astc-10x8-unorm","astc-10x8-unorm-srgb","astc-10x10-unorm","astc-10x10-unorm-srgb","astc-12x10-unorm","astc-12x10-unorm-srgb","astc-12x12-unorm","astc-12x12-unorm-srgb"]:[]],Cy}var Ay;async function bd(){return Ay!==void 0||(Ay=await(async()=>{let n=await Oo(),e=No();if(n&&e){let t=await A3(),r=C3();return t.filter(i=>r.includes(i))}else{if(n)return await A3();if(e)return C3()}return[]})()),Ay}var QT=["r8unorm","r8snorm","r8uint","r8sint","r16uint","r16sint","r16float","rg8unorm","rg8snorm","rg8uint","rg8sint","r32uint","r32sint","r32float","rg16uint","rg16sint","rg16float","rgba8unorm","rgba8unorm-srgb","rgba8snorm","rgba8uint","rgba8sint","bgra8unorm","bgra8unorm-srgb","rgb9e5ufloat","rgb10a2unorm","rg11b10ufloat","rg32uint","rg32sint","rg32float","rgba16uint","rgba16sint","rgba16float","rgba32uint","rgba32sint","rgba32float","stencil8","depth16unorm","depth24plus","depth24plus-stencil8","depth32float","depth32float-stencil8"],Ey;async function Go(){if(Ey!==void 0)return Ey;let n=await bd();return Ey=[...QT,...n],Ey}var nZ=`(function () {
    'use strict';

    function createLevelBuffers(basisTexture, basisTranscoderFormat) {
      const images = basisTexture.getNumImages();
      const levels = basisTexture.getNumLevels(0);
      const success = basisTexture.startTranscoding();
      if (!success) {
        throw new Error("startTranscoding failed");
      }
      const levelBuffers = [];
      for (let levelIndex = 0; levelIndex < levels; ++levelIndex) {
        for (let sliceIndex = 0; sliceIndex < images; ++sliceIndex) {
          const transcodeSize = basisTexture.getImageTranscodedSizeInBytes(sliceIndex, levelIndex, basisTranscoderFormat);
          const levelBuffer = new Uint8Array(transcodeSize);
          const success2 = basisTexture.transcodeImage(levelBuffer, sliceIndex, levelIndex, basisTranscoderFormat, 1, 0);
          if (!success2) {
            throw new Error("transcodeImage failed");
          }
          levelBuffers.push(levelBuffer);
        }
      }
      return levelBuffers;
    }

    const gpuFormatToBasisTranscoderFormatMap = {
      "bc3-rgba-unorm": 3,
      // cTFBC3_RGBA
      "bc7-rgba-unorm": 6,
      // cTFBC7_RGBA,
      "etc2-rgba8unorm": 1,
      // cTFETC2_RGBA,
      "astc-4x4-unorm": 10,
      // cTFASTC_4x4_RGBA,
      // Uncompressed
      rgba8unorm: 13,
      // cTFRGBA32,
      rgba4unorm: 16
      // cTFRGBA4444,
    };
    function gpuFormatToBasisTranscoderFormat(transcoderFormat) {
      const format = gpuFormatToBasisTranscoderFormatMap[transcoderFormat];
      if (format) {
        return format;
      }
      throw new Error(\`Unsupported transcoderFormat: \${transcoderFormat}\`);
    }

    const settings = {
      jsUrl: "basis/basis_transcoder.js",
      wasmUrl: "basis/basis_transcoder.wasm"
    };
    let basisTranscoderFormat;
    let basisTranscodedTextureFormat;
    let basisPromise;
    async function getBasis() {
      if (!basisPromise) {
        const absoluteJsUrl = new URL(settings.jsUrl, location.origin).href;
        const absoluteWasmUrl = new URL(settings.wasmUrl, location.origin).href;
        importScripts(absoluteJsUrl);
        basisPromise = new Promise((resolve) => {
          BASIS({
            locateFile: (_file) => absoluteWasmUrl
          }).then((module) => {
            module.initializeBasis();
            resolve(module.BasisFile);
          });
        });
      }
      return basisPromise;
    }
    async function fetchBasisTexture(url, BasisTexture) {
      const basisResponse = await fetch(url);
      if (basisResponse.ok) {
        const basisArrayBuffer = await basisResponse.arrayBuffer();
        return new BasisTexture(new Uint8Array(basisArrayBuffer));
      }
      throw new Error(\`Failed to load Basis texture: \${url}\`);
    }
    const preferredTranscodedFormat = [
      "bc7-rgba-unorm",
      "astc-4x4-unorm",
      "etc2-rgba8unorm",
      "bc3-rgba-unorm",
      "rgba8unorm"
    ];
    async function load(url) {
      const BasisTexture = await getBasis();
      const basisTexture = await fetchBasisTexture(url, BasisTexture);
      const levelBuffers = createLevelBuffers(basisTexture, basisTranscoderFormat);
      return {
        width: basisTexture.getImageWidth(0, 0),
        height: basisTexture.getImageHeight(0, 0),
        format: basisTranscodedTextureFormat,
        resource: levelBuffers,
        alphaMode: "no-premultiply-alpha"
      };
    }
    async function init(jsUrl, wasmUrl, supportedTextures) {
      if (jsUrl)
        settings.jsUrl = jsUrl;
      if (wasmUrl)
        settings.wasmUrl = wasmUrl;
      basisTranscodedTextureFormat = preferredTranscodedFormat.filter((format) => supportedTextures.includes(format))[0];
      basisTranscoderFormat = gpuFormatToBasisTranscoderFormat(basisTranscodedTextureFormat);
      await getBasis();
    }
    const messageHandlers = {
      init: async (data) => {
        const { jsUrl, wasmUrl, supportedTextures } = data;
        await init(jsUrl, wasmUrl, supportedTextures);
      },
      load: async (data) => {
        try {
          const textureOptions = await load(data.url);
          return {
            type: "load",
            url: data.url,
            success: true,
            textureOptions,
            transferables: textureOptions.resource?.map((arr) => arr.buffer)
          };
        } catch (e) {
          throw e;
        }
      }
    };
    self.onmessage = async (messageEvent) => {
      const message = messageEvent.data;
      const response = await messageHandlers[message.type](message);
      if (response) {
        self.postMessage(response, response.transferables);
      }
    };

})();
`,_d=null,E3=class{constructor(){_d||(_d=URL.createObjectURL(new Blob([nZ],{type:"application/javascript"}))),this.worker=new Worker(_d)}};E3.revokeObjectURL=function(){_d&&(URL.revokeObjectURL(_d),_d=null)};var vd={jsUrl:"https://files.pixijs.download/transcoders/basis/basis_transcoder.js",wasmUrl:"https://files.pixijs.download/transcoders/basis/basis_transcoder.wasm"};function XN(n){Object.assign(vd,n)}var T3,qN={};function iZ(n){return T3||(T3=new E3().worker,T3.onmessage=e=>{let{success:t,url:r,textureOptions:i}=e.data;t||console.warn("Failed to load Basis texture",r),qN[r](i)},T3.postMessage({type:"init",jsUrl:vd.jsUrl,wasmUrl:vd.wasmUrl,supportedTextures:n})),T3}function Ty(n,e){let t=iZ(e);return new Promise(r=>{qN[n]=r,t.postMessage({type:"load",url:n})})}var YN={extension:{type:z.LoadParser,priority:cr.High,name:"loadBasis"},name:"loadBasis",test(n){return br(n,[".basis"])},async load(n,e,t){let r=await Go(),i=await Ty(n,r),s=new As(i);return Hn(s,t,n)},unload(n){Array.isArray(n)?n.forEach(e=>e.destroy(!0)):n.destroy(!0)}};function KN(n,e){let t=n.getNumImages(),r=n.getNumLevels(0);if(!n.startTranscoding())throw new Error("startTranscoding failed");let s=[];for(let o=0;o<r;++o)for(let a=0;a<t;++a){let l=n.getImageTranscodedSizeInBytes(a,o,e),c=new Uint8Array(l);if(!n.transcodeImage(c,a,o,e,1,0))throw new Error("transcodeImage failed");s.push(c)}return s}var sZ={"bc3-rgba-unorm":3,"bc7-rgba-unorm":6,"etc2-rgba8unorm":1,"astc-4x4-unorm":10,rgba8unorm:13,rgba4unorm:16};function QN(n){let e=sZ[n];if(e)return e;throw new Error(`Unsupported transcoderFormat: ${n}`)}var oZ={MAGIC:0,SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19,PF_FLAGS:20,FOURCC:21,RGB_BITCOUNT:22,R_BIT_MASK:23,G_BIT_MASK:24,B_BIT_MASK:25,A_BIT_MASK:26},aZ={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},ky=(n=>(n[n.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",n[n.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",n[n.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",n[n.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",n[n.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",n[n.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",n[n.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",n[n.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",n[n.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",n[n.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",n[n.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",n[n.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",n[n.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",n[n.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",n[n.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",n[n.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",n[n.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",n[n.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",n[n.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",n[n.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",n[n.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",n[n.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",n[n.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",n[n.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",n[n.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",n[n.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",n[n.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",n[n.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",n[n.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",n[n.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",n[n.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",n[n.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",n[n.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",n[n.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",n[n.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",n[n.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",n[n.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",n[n.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",n[n.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",n[n.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",n[n.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",n[n.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",n[n.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",n[n.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",n[n.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",n[n.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",n[n.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",n[n.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",n[n.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",n[n.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",n[n.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",n[n.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",n[n.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",n[n.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",n[n.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",n[n.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",n[n.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",n[n.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",n[n.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",n[n.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",n[n.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",n[n.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",n[n.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",n[n.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",n[n.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",n[n.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",n[n.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",n[n.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",n[n.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",n[n.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",n[n.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",n[n.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",n[n.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",n[n.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",n[n.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",n[n.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",n[n.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",n[n.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",n[n.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",n[n.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",n[n.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",n[n.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",n[n.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",n[n.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",n[n.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",n[n.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",n[n.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",n[n.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",n[n.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",n[n.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",n[n.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",n[n.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",n[n.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",n[n.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",n[n.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",n[n.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",n[n.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",n[n.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",n[n.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",n[n.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",n[n.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",n[n.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",n[n.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",n[n.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",n[n.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",n[n.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",n[n.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",n[n.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",n[n.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",n[n.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",n[n.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",n[n.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",n[n.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",n[n.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",n[n.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",n[n.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",n[n.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",n[n.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",n[n.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",n[n.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",n[n.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",n[n.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT",n))(ky||{}),Iy=(n=>(n[n.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",n[n.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",n[n.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D",n))(Iy||{});function dn(n){return n.charCodeAt(0)+(n.charCodeAt(1)<<8)+(n.charCodeAt(2)<<16)+(n.charCodeAt(3)<<24)}var oi=(n=>(n[n.UNKNOWN=0]="UNKNOWN",n[n.R8G8B8=20]="R8G8B8",n[n.A8R8G8B8=21]="A8R8G8B8",n[n.X8R8G8B8=22]="X8R8G8B8",n[n.R5G6B5=23]="R5G6B5",n[n.X1R5G5B5=24]="X1R5G5B5",n[n.A1R5G5B5=25]="A1R5G5B5",n[n.A4R4G4B4=26]="A4R4G4B4",n[n.R3G3B2=27]="R3G3B2",n[n.A8=28]="A8",n[n.A8R3G3B2=29]="A8R3G3B2",n[n.X4R4G4B4=30]="X4R4G4B4",n[n.A2B10G10R10=31]="A2B10G10R10",n[n.A8B8G8R8=32]="A8B8G8R8",n[n.X8B8G8R8=33]="X8B8G8R8",n[n.G16R16=34]="G16R16",n[n.A2R10G10B10=35]="A2R10G10B10",n[n.A16B16G16R16=36]="A16B16G16R16",n[n.A8P8=40]="A8P8",n[n.P8=41]="P8",n[n.L8=50]="L8",n[n.A8L8=51]="A8L8",n[n.A4L4=52]="A4L4",n[n.V8U8=60]="V8U8",n[n.L6V5U5=61]="L6V5U5",n[n.X8L8V8U8=62]="X8L8V8U8",n[n.Q8W8V8U8=63]="Q8W8V8U8",n[n.V16U16=64]="V16U16",n[n.A2W10V10U10=67]="A2W10V10U10",n[n.Q16W16V16U16=110]="Q16W16V16U16",n[n.R16F=111]="R16F",n[n.G16R16F=112]="G16R16F",n[n.A16B16G16R16F=113]="A16B16G16R16F",n[n.R32F=114]="R32F",n[n.G32R32F=115]="G32R32F",n[n.A32B32G32R32F=116]="A32B32G32R32F",n[n.UYVY=dn("UYVY")]="UYVY",n[n.R8G8_B8G8=dn("RGBG")]="R8G8_B8G8",n[n.YUY2=dn("YUY2")]="YUY2",n[n.D3DFMT_G8R8_G8B8=dn("GRGB")]="D3DFMT_G8R8_G8B8",n[n.DXT1=dn("DXT1")]="DXT1",n[n.DXT2=dn("DXT2")]="DXT2",n[n.DXT3=dn("DXT3")]="DXT3",n[n.DXT4=dn("DXT4")]="DXT4",n[n.DXT5=dn("DXT5")]="DXT5",n[n.ATI1=dn("ATI1")]="ATI1",n[n.AT1N=dn("AT1N")]="AT1N",n[n.ATI2=dn("ATI2")]="ATI2",n[n.AT2N=dn("AT2N")]="AT2N",n[n.BC4U=dn("BC4U")]="BC4U",n[n.BC4S=dn("BC4S")]="BC4S",n[n.BC5U=dn("BC5U")]="BC5U",n[n.BC5S=dn("BC5S")]="BC5S",n[n.DX10=dn("DX10")]="DX10",n))(oi||{}),k3={[oi.DXT1]:"bc1-rgba-unorm",[oi.DXT2]:"bc2-rgba-unorm",[oi.DXT3]:"bc2-rgba-unorm",[oi.DXT4]:"bc3-rgba-unorm",[oi.DXT5]:"bc3-rgba-unorm",[oi.ATI1]:"bc4-r-unorm",[oi.BC4U]:"bc4-r-unorm",[oi.BC4S]:"bc4-r-snorm",[oi.ATI2]:"bc5-rg-unorm",[oi.BC5U]:"bc5-rg-unorm",[oi.BC5S]:"bc5-rg-snorm",36:"rgba16uint",110:"rgba16sint",111:"r16float",112:"rg16float",113:"rgba16float",114:"r32float",115:"rg32float",116:"rgba32float"},Wn={70:"bc1-rgba-unorm",71:"bc1-rgba-unorm",72:"bc1-rgba-unorm-srgb",73:"bc2-rgba-unorm",74:"bc2-rgba-unorm",75:"bc2-rgba-unorm-srgb",76:"bc3-rgba-unorm",77:"bc3-rgba-unorm",78:"bc3-rgba-unorm-srgb",79:"bc4-r-unorm",80:"bc4-r-unorm",81:"bc4-r-snorm",82:"bc5-rg-unorm",83:"bc5-rg-unorm",84:"bc5-rg-snorm",94:"bc6h-rgb-ufloat",95:"bc6h-rgb-ufloat",96:"bc6h-rgb-float",97:"bc7-rgba-unorm",98:"bc7-rgba-unorm",99:"bc7-rgba-unorm-srgb",28:"rgba8unorm",29:"rgba8unorm-srgb",87:"bgra8unorm",91:"bgra8unorm-srgb",41:"r32float",49:"rg8unorm",56:"r16uint",61:"r8unorm",24:"rgb10a2unorm",11:"rgba16uint",13:"rgba16sint",10:"rgba16float",54:"r16float",34:"rg16float",16:"rg32float",2:"rgba32float"},tt={MAGIC_VALUE:542327876,MAGIC_SIZE:4,HEADER_SIZE:124,HEADER_DX10_SIZE:20,PIXEL_FORMAT_FLAGS:{ALPHAPIXELS:1,ALPHA:2,FOURCC:4,RGB:64,RGBA:65,YUV:512,LUMINANCE:131072,LUMINANCEA:131073},RESOURCE_MISC_TEXTURECUBE:4,HEADER_FIELDS:oZ,HEADER_DX10_FIELDS:aZ,DXGI_FORMAT:ky,D3D10_RESOURCE_DIMENSION:Iy,D3DFMT:oi},Py={"bc1-rgba-unorm":8,"bc1-rgba-unorm-srgb":8,"bc2-rgba-unorm":16,"bc2-rgba-unorm-srgb":16,"bc3-rgba-unorm":16,"bc3-rgba-unorm-srgb":16,"bc4-r-unorm":8,"bc4-r-snorm":8,"bc5-rg-unorm":16,"bc5-rg-snorm":16,"bc6h-rgb-ufloat":16,"bc6h-rgb-float":16,"bc7-rgba-unorm":16,"bc7-rgba-unorm-srgb":16};Xi();ee();function Dy(n,e){let{format:t,fourCC:r,width:i,height:s,dataOffset:o,mipmapCount:a}=cZ(n);if(!e.includes(t))throw new Error(`Unsupported texture format: ${r} ${t}, supported: ${e}`);if(a<=1)return{format:t,width:i,height:s,resource:[new Uint8Array(n,o)],alphaMode:"no-premultiply-alpha"};let l=lZ(t,i,s,o,a,n);return{format:t,width:i,height:s,resource:l,alphaMode:"no-premultiply-alpha"}}function lZ(n,e,t,r,i,s){let o=[],a=Py[n],l=e,c=t,u=r;for(let d=0;d<i;++d){let f=a?Math.max(4,l)/4*Math.max(4,c)/4*a:l*c*4,h=new Uint8Array(s,u,f);o.push(h),u+=f,l=Math.max(l>>1,1),c=Math.max(c>>1,1)}return o}function cZ(n){let e=new Uint32Array(n,0,tt.HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT);if(e[tt.HEADER_FIELDS.MAGIC]!==tt.MAGIC_VALUE)throw new Error("Invalid magic number in DDS header");let t=e[tt.HEADER_FIELDS.HEIGHT],r=e[tt.HEADER_FIELDS.WIDTH],i=Math.max(1,e[tt.HEADER_FIELDS.MIPMAP_COUNT]),s=e[tt.HEADER_FIELDS.PF_FLAGS],o=e[tt.HEADER_FIELDS.FOURCC],a=uZ(e,s,o,n),l=tt.MAGIC_SIZE+tt.HEADER_SIZE+(o===tt.D3DFMT.DX10?tt.HEADER_DX10_SIZE:0);return{format:a,fourCC:o,width:r,height:t,dataOffset:l,mipmapCount:i}}function uZ(n,e,t,r){if(e&tt.PIXEL_FORMAT_FLAGS.FOURCC){if(t===tt.D3DFMT.DX10){let i=new Uint32Array(r,tt.MAGIC_SIZE+tt.HEADER_SIZE,tt.HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT);if(i[tt.HEADER_DX10_FIELDS.MISC_FLAG]===tt.RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSParser does not support cubemap textures");if(i[tt.HEADER_DX10_FIELDS.RESOURCE_DIMENSION]===tt.D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSParser does not supported 3D texture data");let a=i[tt.HEADER_DX10_FIELDS.DXGI_FORMAT];if(a in Wn)return Wn[a];throw new Error(`DDSParser cannot parse texture data with DXGI format ${a}`)}if(t in k3)return k3[t];throw new Error(`DDSParser cannot parse texture data with fourCC format ${t}`)}if(e&tt.PIXEL_FORMAT_FLAGS.RGB||e&tt.PIXEL_FORMAT_FLAGS.RGBA)return dZ(n);throw e&tt.PIXEL_FORMAT_FLAGS.YUV?new Error("DDSParser does not supported YUV uncompressed texture data."):e&tt.PIXEL_FORMAT_FLAGS.LUMINANCE||e&tt.PIXEL_FORMAT_FLAGS.LUMINANCEA?new Error("DDSParser does not support single-channel (lumninance) texture data!"):e&tt.PIXEL_FORMAT_FLAGS.ALPHA||e&tt.PIXEL_FORMAT_FLAGS.ALPHAPIXELS?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}function dZ(n){let e=n[tt.HEADER_FIELDS.RGB_BITCOUNT],t=n[tt.HEADER_FIELDS.R_BIT_MASK],r=n[tt.HEADER_FIELDS.G_BIT_MASK],i=n[tt.HEADER_FIELDS.B_BIT_MASK],s=n[tt.HEADER_FIELDS.A_BIT_MASK];switch(e){case 32:if(t===255&&r===65280&&i===16711680&&s===4278190080)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_R8G8B8A8_UNORM];if(t===16711680&&r===65280&&i===255&&s===4278190080)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_B8G8R8A8_UNORM];if(t===1072693248&&r===1047552&&i===1023&&s===3221225472)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_R10G10B10A2_UNORM];if(t===65535&&r===4294901760&&i===0&&s===0)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_R16G16_UNORM];if(t===4294967295&&r===0&&i===0&&s===0)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_R32_FLOAT];break;case 24:break;case 16:if(t===31744&&r===992&&i===31&&s===32768)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_B5G5R5A1_UNORM];if(t===63488&&r===2016&&i===31&&s===0)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_B5G6R5_UNORM];if(t===3840&&r===240&&i===15&&s===61440)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_B4G4R4A4_UNORM];if(t===255&&r===0&&i===0&&s===65280)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_R8G8_UNORM];if(t===65535&&r===0&&i===0&&s===0)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_R16_UNORM];break;case 8:if(t===255&&r===0&&i===0&&s===0)return Wn[tt.DXGI_FORMAT.DXGI_FORMAT_R8_UNORM];break}throw new Error(`DDSParser does not support uncompressed texture with configuration:
                bitCount = ${e}, rBitMask = ${t}, gBitMask = ${r}, aBitMask = ${s}`)}var ZN={extension:{type:z.LoadParser,priority:cr.High,name:"loadDDS"},name:"loadDDS",test(n){return br(n,[".dds"])},async load(n,e,t){let r=await Go(),s=await(await fetch(n)).arrayBuffer(),o=Dy(s,r),a=new As(o);return Hn(a,t,n)},unload(n){Array.isArray(n)?n.forEach(e=>e.destroy(!0)):n.destroy(!0)}};Xi();ee();var ZT=(n=>(n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGBA=6408]="RGBA",n[n.RGBA8UI=36220]="RGBA8UI",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.RGBA8I=36238]="RGBA8I",n[n.RGBA8=32856]="RGBA8",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n))(ZT||{});var fZ={33776:"bc1-rgba-unorm",33777:"bc1-rgba-unorm",33778:"bc2-rgba-unorm",33779:"bc3-rgba-unorm",35916:"bc1-rgba-unorm-srgb",35917:"bc1-rgba-unorm-srgb",35918:"bc2-rgba-unorm-srgb",35919:"bc3-rgba-unorm-srgb",36283:"bc4-r-unorm",36284:"bc4-r-snorm",36285:"bc5-rg-unorm",36286:"bc5-rg-snorm",37488:"eac-r11unorm",37490:"eac-rg11snorm",37492:"etc2-rgb8unorm",37496:"etc2-rgba8unorm",37493:"etc2-rgb8unorm-srgb",37497:"etc2-rgba8unorm-srgb",37494:"etc2-rgb8a1unorm",37495:"etc2-rgb8a1unorm-srgb",37808:"astc-4x4-unorm",37840:"astc-4x4-unorm-srgb",37809:"astc-5x4-unorm",37841:"astc-5x4-unorm-srgb",37810:"astc-5x5-unorm",37842:"astc-5x5-unorm-srgb",37811:"astc-6x5-unorm",37843:"astc-6x5-unorm-srgb",37812:"astc-6x6-unorm",37844:"astc-6x6-unorm-srgb",37813:"astc-8x5-unorm",37845:"astc-8x5-unorm-srgb",37814:"astc-8x6-unorm",37846:"astc-8x6-unorm-srgb",37815:"astc-8x8-unorm",37847:"astc-8x8-unorm-srgb",37816:"astc-10x5-unorm",37848:"astc-10x5-unorm-srgb",37817:"astc-10x6-unorm",37849:"astc-10x6-unorm-srgb",37818:"astc-10x8-unorm",37850:"astc-10x8-unorm-srgb",37819:"astc-10x10-unorm",37851:"astc-10x10-unorm-srgb",37820:"astc-12x10-unorm",37852:"astc-12x10-unorm-srgb",37821:"astc-12x12-unorm",37853:"astc-12x12-unorm-srgb",36492:"bc7-rgba-unorm",36493:"bc7-rgba-unorm-srgb",36494:"bc6h-rgb-float",36495:"bc6h-rgb-ufloat",35907:"rgba8unorm-srgb",36759:"rgba8snorm",36220:"rgba8uint",36238:"rgba8sint",6408:"rgba8unorm"},hZ=[171,75,84,88,32,49,49,187,13,10,26,10],pZ={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},mZ=64,gZ=67305985,yZ={5121:1,5123:2,5124:4,5125:4,5126:4,36193:8},xZ={6408:4,6407:3,33319:2,6403:1,6409:1,6410:2,6406:1},bZ={32819:2,32820:2,33635:2},_Z={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,36283:.5,36284:.5,36285:1,36286:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,37808:1,37840:1,37809:.8,37841:.8,37810:.64,37842:.64,37811:.53375,37843:.53375,37812:.445,37844:.445,37813:.4,37845:.4,37814:.33375,37846:.33375,37815:.25,37847:.25,37816:.32,37848:.32,37817:.26625,37849:.26625,37818:.2,37850:.2,37819:.16,37851:.16,37820:.13375,37852:.13375,37821:.11125,37853:.11125,36492:1,36493:1,36494:1,36495:1},_r={FILE_HEADER_SIZE:mZ,FILE_IDENTIFIER:hZ,FORMATS_TO_COMPONENTS:xZ,INTERNAL_FORMAT_TO_BYTES_PER_PIXEL:_Z,INTERNAL_FORMAT_TO_TEXTURE_FORMATS:fZ,FIELDS:pZ,TYPES_TO_BYTES_PER_COMPONENT:yZ,TYPES_TO_BYTES_PER_PIXEL:bZ,ENDIANNESS:gZ};function My(n,e){let t=new DataView(n);if(!CZ(t))throw new Error("Invalid KTX identifier in header");let{littleEndian:r,glType:i,glFormat:s,glInternalFormat:o,pixelWidth:a,pixelHeight:l,numberOfMipmapLevels:c,offset:u}=SZ(t),d=_r.INTERNAL_FORMAT_TO_TEXTURE_FORMATS[o];if(!d)throw new Error(`Unknown texture format ${o}`);if(!e.includes(d))throw new Error(`Unsupported texture format: ${d}, supportedFormats: ${e}`);let f=wZ(i,s,o),h=vZ(t,i,f,a,l,u,c,r);return{format:d,width:a,height:l,resource:h,alphaMode:"no-premultiply-alpha"}}function vZ(n,e,t,r,i,s,o,a){let l=r+3&-4,c=i+3&-4,u=r*i;e===0&&(u=l*c);let d=u*t,f=r,h=i,p=l,m=c,g=s,y=new Array(o);for(let x=0;x<o;x++){let b=n.getUint32(g,a),_=g+4;y[x]=new Uint8Array(n.buffer,_,d),_+=d,g+=b+4,g=g%4!==0?g+4-g%4:g,f=f>>1||1,h=h>>1||1,p=f+4-1&-4,m=h+4-1&-4,d=p*m*t}return y}function wZ(n,e,t){let r=_r.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[t];if(n!==0&&(_r.TYPES_TO_BYTES_PER_COMPONENT[n]?r=_r.TYPES_TO_BYTES_PER_COMPONENT[n]*_r.FORMATS_TO_COMPONENTS[e]:r=_r.TYPES_TO_BYTES_PER_PIXEL[n]),r===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");return r}function SZ(n){let e=n.getUint32(_r.FIELDS.ENDIANNESS,!0)===_r.ENDIANNESS,t=n.getUint32(_r.FIELDS.GL_TYPE,e),r=n.getUint32(_r.FIELDS.GL_FORMAT,e),i=n.getUint32(_r.FIELDS.GL_INTERNAL_FORMAT,e),s=n.getUint32(_r.FIELDS.PIXEL_WIDTH,e),o=n.getUint32(_r.FIELDS.PIXEL_HEIGHT,e)||1,a=n.getUint32(_r.FIELDS.PIXEL_DEPTH,e)||1,l=n.getUint32(_r.FIELDS.NUMBER_OF_ARRAY_ELEMENTS,e)||1,c=n.getUint32(_r.FIELDS.NUMBER_OF_FACES,e),u=n.getUint32(_r.FIELDS.NUMBER_OF_MIPMAP_LEVELS,e),d=n.getUint32(_r.FIELDS.BYTES_OF_KEY_VALUE_DATA,e);if(o===0||a!==1)throw new Error("Only 2D textures are supported");if(c!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(l!==1)throw new Error("WebGL does not support array textures");return{littleEndian:e,glType:t,glFormat:r,glInternalFormat:i,pixelWidth:s,pixelHeight:o,numberOfMipmapLevels:u,offset:_r.FILE_HEADER_SIZE+d}}function CZ(n){for(let e=0;e<_r.FILE_IDENTIFIER.length;e++)if(n.getUint8(e)!==_r.FILE_IDENTIFIER[e])return!1;return!0}var JN={extension:{type:z.LoadParser,priority:cr.High,name:"loadKTX"},name:"loadKTX",test(n){return br(n,".ktx")},async load(n,e,t){let r=await Go(),s=await(await fetch(n)).arrayBuffer(),o=My(s,r),a=new As(o);return Hn(a,t,n)},unload(n){Array.isArray(n)?n.forEach(e=>e.destroy(!0)):n.destroy(!0)}};Xi();ee();var AZ=`(function () {
    'use strict';

    const converters = {
      rgb8unorm: {
        convertedFormat: "rgba8unorm",
        convertFunction: convertRGBtoRGBA
      },
      "rgb8unorm-srgb": {
        convertedFormat: "rgba8unorm-srgb",
        convertFunction: convertRGBtoRGBA
      }
    };
    function convertFormatIfRequired(textureOptions) {
      const format = textureOptions.format;
      if (converters[format]) {
        const convertFunction = converters[format].convertFunction;
        const levelBuffers = textureOptions.resource;
        for (let i = 0; i < levelBuffers.length; i++) {
          levelBuffers[i] = convertFunction(levelBuffers[i]);
        }
        textureOptions.format = converters[format].convertedFormat;
      }
    }
    function convertRGBtoRGBA(levelBuffer) {
      const pixelCount = levelBuffer.byteLength / 3;
      const levelBufferWithAlpha = new Uint32Array(pixelCount);
      for (let i = 0; i < pixelCount; ++i) {
        levelBufferWithAlpha[i] = levelBuffer[i * 3] + (levelBuffer[i * 3 + 1] << 8) + (levelBuffer[i * 3 + 2] << 16) + 4278190080;
      }
      return new Uint8Array(levelBufferWithAlpha.buffer);
    }

    function createLevelBuffersFromKTX(ktxTexture) {
      const levelBuffers = [];
      for (let i = 0; i < ktxTexture.numLevels; i++) {
        const imageData = ktxTexture.getImageData(i, 0, 0);
        const levelBuffer = new Uint8Array(imageData.byteLength);
        levelBuffer.set(imageData);
        levelBuffers.push(levelBuffer);
      }
      return levelBuffers;
    }

    const glFormatToGPUFormatMap = {
      6408: "rgba8unorm",
      32856: "bgra8unorm",
      //
      32857: "rgb10a2unorm",
      33189: "depth16unorm",
      33190: "depth24plus",
      33321: "r8unorm",
      33323: "rg8unorm",
      33325: "r16float",
      33326: "r32float",
      33327: "rg16float",
      33328: "rg32float",
      33329: "r8sint",
      33330: "r8uint",
      33331: "r16sint",
      33332: "r16uint",
      33333: "r32sint",
      33334: "r32uint",
      33335: "rg8sint",
      33336: "rg8uint",
      33337: "rg16sint",
      33338: "rg16uint",
      33339: "rg32sint",
      33340: "rg32uint",
      33778: "bc2-rgba-unorm",
      33779: "bc3-rgba-unorm",
      34836: "rgba32float",
      34842: "rgba16float",
      35056: "depth24plus-stencil8",
      35898: "rg11b10ufloat",
      35901: "rgb9e5ufloat",
      35907: "rgba8unorm-srgb",
      // bgra8unorm-srgb
      36012: "depth32float",
      36013: "depth32float-stencil8",
      36168: "stencil8",
      36208: "rgba32uint",
      36214: "rgba16uint",
      36220: "rgba8uint",
      36226: "rgba32sint",
      36232: "rgba16sint",
      36238: "rgba8sint",
      36492: "bc7-rgba-unorm",
      36756: "r8snorm",
      36757: "rg8snorm",
      36759: "rgba8snorm",
      37496: "etc2-rgba8unorm",
      37808: "astc-4x4-unorm"
    };
    function glFormatToGPUFormat(glInternalFormat) {
      const format = glFormatToGPUFormatMap[glInternalFormat];
      if (format) {
        return format;
      }
      throw new Error(\`Unsupported glInternalFormat: \${glInternalFormat}\`);
    }

    const vkFormatToGPUFormatMap = {
      23: "rgb8unorm",
      // VK_FORMAT_R8G8B8_UNORM
      37: "rgba8unorm",
      // VK_FORMAT_R8G8B8A8_UNORM
      43: "rgba8unorm-srgb"
      // VK_FORMAT_R8G8B8A8_SRGB
      // TODO add more!
    };
    function vkFormatToGPUFormat(vkFormat) {
      const format = vkFormatToGPUFormatMap[vkFormat];
      if (format) {
        return format;
      }
      throw new Error(\`Unsupported VkFormat: \${vkFormat}\`);
    }

    function getTextureFormatFromKTXTexture(ktxTexture) {
      if (ktxTexture.classId === 2) {
        return vkFormatToGPUFormat(ktxTexture.vkFormat);
      }
      return glFormatToGPUFormat(ktxTexture.glInternalformat);
    }

    const gpuFormatToBasisTranscoderFormatMap = {
      "bc3-rgba-unorm": "BC3_RGBA",
      "bc7-rgba-unorm": "BC7_M5_RGBA",
      "etc2-rgba8unorm": "ETC2_RGBA",
      "astc-4x4-unorm": "ASTC_4x4_RGBA",
      // Uncompressed
      rgba8unorm: "RGBA32",
      rg11b10ufloat: "R11F_G11F_B10F"
    };
    function gpuFormatToKTXBasisTranscoderFormat(transcoderFormat) {
      const format = gpuFormatToBasisTranscoderFormatMap[transcoderFormat];
      if (format) {
        return format;
      }
      throw new Error(\`Unsupported transcoderFormat: \${transcoderFormat}\`);
    }

    const settings = {
      jsUrl: "",
      wasmUrl: ""
    };
    let basisTranscoderFormat;
    let basisTranscodedTextureFormat;
    let ktxPromise;
    async function getKTX() {
      if (!ktxPromise) {
        const absoluteJsUrl = new URL(settings.jsUrl, location.origin).href;
        const absoluteWasmUrl = new URL(settings.wasmUrl, location.origin).href;
        importScripts(absoluteJsUrl);
        ktxPromise = new Promise((resolve) => {
          LIBKTX({
            locateFile: (_file) => absoluteWasmUrl
          }).then((libktx) => {
            resolve(libktx);
          });
        });
      }
      return ktxPromise;
    }
    async function fetchKTXTexture(url, ktx) {
      const ktx2Response = await fetch(url);
      if (ktx2Response.ok) {
        const ktx2ArrayBuffer = await ktx2Response.arrayBuffer();
        return new ktx.ktxTexture(new Uint8Array(ktx2ArrayBuffer));
      }
      throw new Error(\`Failed to load KTX(2) texture: \${url}\`);
    }
    const preferredTranscodedFormat = [
      "bc7-rgba-unorm",
      "astc-4x4-unorm",
      "etc2-rgba8unorm",
      "bc3-rgba-unorm",
      "rgba8unorm"
    ];
    async function load(url) {
      const ktx = await getKTX();
      const ktxTexture = await fetchKTXTexture(url, ktx);
      let format;
      if (ktxTexture.needsTranscoding) {
        format = basisTranscodedTextureFormat;
        const transcodeFormat = ktx.TranscodeTarget[basisTranscoderFormat];
        const result = ktxTexture.transcodeBasis(transcodeFormat, 0);
        if (result !== ktx.ErrorCode.SUCCESS) {
          throw new Error("Unable to transcode basis texture.");
        }
      } else {
        format = getTextureFormatFromKTXTexture(ktxTexture);
      }
      const levelBuffers = createLevelBuffersFromKTX(ktxTexture);
      const textureOptions = {
        width: ktxTexture.baseWidth,
        height: ktxTexture.baseHeight,
        format,
        mipLevelCount: ktxTexture.numLevels,
        resource: levelBuffers,
        alphaMode: "no-premultiply-alpha"
      };
      convertFormatIfRequired(textureOptions);
      return textureOptions;
    }
    async function init(jsUrl, wasmUrl, supportedTextures) {
      if (jsUrl)
        settings.jsUrl = jsUrl;
      if (wasmUrl)
        settings.wasmUrl = wasmUrl;
      basisTranscodedTextureFormat = preferredTranscodedFormat.filter((format) => supportedTextures.includes(format))[0];
      basisTranscoderFormat = gpuFormatToKTXBasisTranscoderFormat(basisTranscodedTextureFormat);
      await getKTX();
    }
    const messageHandlers = {
      init: async (data) => {
        const { jsUrl, wasmUrl, supportedTextures } = data;
        await init(jsUrl, wasmUrl, supportedTextures);
      },
      load: async (data) => {
        try {
          const textureOptions = await load(data.url);
          return {
            type: "load",
            url: data.url,
            success: true,
            textureOptions,
            transferables: textureOptions.resource?.map((arr) => arr.buffer)
          };
        } catch (e) {
          throw e;
        }
      }
    };
    self.onmessage = async (messageEvent) => {
      const message = messageEvent.data;
      const response = await messageHandlers[message.type]?.(message);
      if (response) {
        self.postMessage(response, response.transferables);
      }
    };

})();
`,wd=null,I3=class{constructor(){wd||(wd=URL.createObjectURL(new Blob([AZ],{type:"application/javascript"}))),this.worker=new Worker(wd)}};I3.revokeObjectURL=function(){wd&&(URL.revokeObjectURL(wd),wd=null)};var Sd={jsUrl:"https://files.pixijs.download/transcoders/ktx/libktx.js",wasmUrl:"https://files.pixijs.download/transcoders/ktx/libktx.wasm"};function eO(n){Object.assign(Sd,n)}var P3,tO={};function EZ(n){return P3||(P3=new I3().worker,P3.onmessage=e=>{let{success:t,url:r,textureOptions:i}=e.data;t||console.warn("Failed to load KTX texture",r),tO[r](i)},P3.postMessage({type:"init",jsUrl:Sd.jsUrl,wasmUrl:Sd.wasmUrl,supportedTextures:n})),P3}function Ry(n,e){let t=EZ(e);return new Promise(r=>{tO[n]=r,t.postMessage({type:"load",url:n})})}var rO={extension:{type:z.LoadParser,priority:cr.High,name:"loadKTX2"},name:"loadKTX2",test(n){return br(n,".ktx2")},async load(n,e,t){let r=await Go(),i=await Ry(n,r),s=new As(i);return Hn(s,t,n)},async unload(n){Array.isArray(n)?n.forEach(e=>e.destroy(!0)):n.destroy(!0)}};var JT={rgb8unorm:{convertedFormat:"rgba8unorm",convertFunction:nO},"rgb8unorm-srgb":{convertedFormat:"rgba8unorm-srgb",convertFunction:nO}};function iO(n){let e=n.format;if(JT[e]){let t=JT[e].convertFunction,r=n.resource;for(let i=0;i<r.length;i++)r[i]=t(r[i]);n.format=JT[e].convertedFormat}}function nO(n){let e=n.byteLength/3,t=new Uint32Array(e);for(let r=0;r<e;++r)t[r]=n[r*3]+(n[r*3+1]<<8)+(n[r*3+2]<<16)+4278190080;return new Uint8Array(t.buffer)}function sO(n){let e=[];for(let t=0;t<n.numLevels;t++){let r=n.getImageData(t,0,0),i=new Uint8Array(r.byteLength);i.set(r),e.push(i)}return e}var TZ={6408:"rgba8unorm",32856:"bgra8unorm",32857:"rgb10a2unorm",33189:"depth16unorm",33190:"depth24plus",33321:"r8unorm",33323:"rg8unorm",33325:"r16float",33326:"r32float",33327:"rg16float",33328:"rg32float",33329:"r8sint",33330:"r8uint",33331:"r16sint",33332:"r16uint",33333:"r32sint",33334:"r32uint",33335:"rg8sint",33336:"rg8uint",33337:"rg16sint",33338:"rg16uint",33339:"rg32sint",33340:"rg32uint",33778:"bc2-rgba-unorm",33779:"bc3-rgba-unorm",34836:"rgba32float",34842:"rgba16float",35056:"depth24plus-stencil8",35898:"rg11b10ufloat",35901:"rgb9e5ufloat",35907:"rgba8unorm-srgb",36012:"depth32float",36013:"depth32float-stencil8",36168:"stencil8",36208:"rgba32uint",36214:"rgba16uint",36220:"rgba8uint",36226:"rgba32sint",36232:"rgba16sint",36238:"rgba8sint",36492:"bc7-rgba-unorm",36756:"r8snorm",36757:"rg8snorm",36759:"rgba8snorm",37496:"etc2-rgba8unorm",37808:"astc-4x4-unorm"};function Fy(n){let e=TZ[n];if(e)return e;throw new Error(`Unsupported glInternalFormat: ${n}`)}var kZ={23:"rgb8unorm",37:"rgba8unorm",43:"rgba8unorm-srgb"};function By(n){let e=kZ[n];if(e)return e;throw new Error(`Unsupported VkFormat: ${n}`)}function oO(n){return n.classId===2?By(n.vkFormat):Fy(n.glInternalformat)}var IZ={"bc3-rgba-unorm":"BC3_RGBA","bc7-rgba-unorm":"BC7_M5_RGBA","etc2-rgba8unorm":"ETC2_RGBA","astc-4x4-unorm":"ASTC_4x4_RGBA",rgba8unorm:"RGBA32",rg11b10ufloat:"R11F_G11F_B10F"};function aO(n){let e=IZ[n];if(e)return e;throw new Error(`Unsupported transcoderFormat: ${n}`)}ee();yl();ee();var Cd=["basis","bc7","bc6h","astc","etc2","bc5","bc4","bc3","bc2","bc1","eac"],lO={extension:z.ResolveParser,test:n=>br(n,[".ktx",".ktx2",".dds"]),parse:n=>{let e,t=n.split(".");if(t.length>2){let r=t[t.length-2];Cd.includes(r)&&(e=r)}else e=t[t.length-1];return{resolution:parseFloat(Sn.RETINA_PREFIX.exec(n)?.[1]??"1"),format:e,src:n}}};var Ny,cO={extension:{type:z.DetectionParser,priority:2},test:async()=>!!(await Oo()||No()),add:async n=>{let e=await bd();return Ny=PZ(e),[...Ny,...n]},remove:async n=>Ny?n.filter(e=>!(e in Ny)):n};function PZ(n){let e=["basis"],t={};return n.forEach(r=>{let i=r.split("-")[0];i&&!t[i]&&(t[i]=!0,e.push(i))}),e.sort((r,i)=>{let s=Cd.indexOf(r),o=Cd.indexOf(i);return s===-1?1:o===-1?-1:s-o}),e}Ln();Nc();var DZ=new Nt,ek=class{cull(e,t,r=!0){this._cullRecursive(e,t,r)}_cullRecursive(e,t,r=!0){if(e.cullable&&e.measurable&&e.includeInBuild){let i=e.cullArea??Eo(e,r,DZ);e.culled=i.x>=t.x+t.width||i.y>=t.y+t.height||i.x+i.width<=t.x||i.y+i.height<=t.y}else e.culled=!1;if(!(!e.cullableChildren||e.culled||!e.renderable||!e.measurable||!e.includeInBuild))for(let i=0;i<e.children.length;i++)this._cullRecursive(e.children[i],t,r)}};ek.shared=new ek;var Oy=ek;ee();var D3=class{static init(){this._renderRef=this.render.bind(this),this.render=()=>{Oy.shared.cull(this.stage,this.renderer.screen),this.renderer.render({container:this.stage})}}static destroy(){this.render=this._renderRef}};D3.extension={priority:10,type:z.Application,name:"culler"};var iL=Ot(nL(),1),sL={createCanvas:(n,e)=>new OffscreenCanvas(n??0,e??0),getCanvasRenderingContext2D:()=>OffscreenCanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>globalThis.location.href,getFontFaceSet:()=>globalThis.fonts,fetch:(n,e)=>fetch(n,e),parseXML:n=>new iL.DOMParser().parseFromString(n,"text/xml")};Ci();qi();Hr();Fo();var nc=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var qy=`
in vec2 vTextureCoord;

out vec4 finalColor;

uniform float uAlpha;
uniform sampler2D uTexture;

void main()
{
    finalColor =  texture(uTexture, vTextureCoord) * uAlpha;
}
`;var W3=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
 
    var sample = textureSample(uTexture, uSampler, uv);
    
    return sample * alphaUniforms.uAlpha;
}`;var oL=class aL extends be{constructor(e){e={...aL.defaultOptions,...e};let t=pe.from({vertex:{source:W3,entryPoint:"mainVertex"},fragment:{source:W3,entryPoint:"mainFragment"}}),r=he.from({vertex:nc,fragment:qy,name:"alpha-filter"}),{alpha:i,...s}=e,o=new pt({uAlpha:{value:i,type:"f32"}});super({...s,gpuProgram:t,glProgram:r,resources:{alphaUniforms:o}})}get alpha(){return this.resources.alphaUniforms.uniforms.uAlpha}set alpha(e){this.resources.alphaUniforms.uniforms.uAlpha=e}};oL.defaultOptions={alpha:1};var Yy=oL;Ws();Yi();zt();Fo();Ws();Yi();Fo();Ci();var Fd={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]};var oJ=["in vec2 vBlurTexCoords[%size%];","uniform sampler2D uTexture;","out vec4 finalColor;","void main(void)","{","    finalColor = vec4(0.0);","    %blur%","}"].join(`
`);function Ky(n){let e=Fd[n],t=e.length,r=oJ,i="",s="finalColor += texture(uTexture, vBlurTexCoords[%index%]) * %value%;",o;for(let a=0;a<n;a++){let l=s.replace("%index%",a.toString());o=a,a>=t&&(o=n-a-1),l=l.replace("%value%",e[o].toString()),i+=l,i+=`
`}return r=r.replace("%blur%",i),r=r.replace("%size%",n.toString()),r}var aJ=`
    in vec2 aPosition;

    uniform float uStrength;

    out vec2 vBlurTexCoords[%size%];

    uniform vec4 uInputSize;
    uniform vec4 uOutputFrame;
    uniform vec4 uOutputTexture;

    vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

    vec2 filterTextureCoord( void )
    {
        return aPosition * (uOutputFrame.zw * uInputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        float pixelStrength = uInputSize.%dimension% * uStrength;

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function Qy(n,e){let t=Math.ceil(n/2),r=aJ,i="",s;e?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * pixelStrength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * pixelStrength);";for(let o=0;o<n;o++){let a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(t-1)}.0`),i+=a,i+=`
`}return r=r.replace("%blur%",i),r=r.replace("%size%",n.toString()),r=r.replace("%dimension%",e?"z":"w"),r}function Zy(n,e){let t=Qy(e,n),r=Ky(e);return he.from({vertex:t,fragment:r,name:`blur-${n?"horizontal":"vertical"}-pass-filter`})}qi();var Jy=`

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct BlurUniforms {
  uStrength:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> blurUniforms : BlurUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    %blur-struct%
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}


@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {

  let filteredCord = filterTextureCoord(aPosition);

  let pixelStrength = gfu.uInputSize.%dimension% * blurUniforms.uStrength;

  return VSOutput(
   filterVertexPosition(aPosition),
    %blur-vertex-out%
  );
}

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  %blur-fragment-in%
) -> @location(0) vec4<f32> {

    var   finalColor = vec4(0.0);

    %blur-sampling%

    return finalColor;
}`;function ex(n,e){let t=Fd[e],r=t.length,i=[],s=[],o=[];for(let d=0;d<e;d++){i[d]=`@location(${d}) offset${d}: vec2<f32>,`,n?s[d]=`filteredCord + vec2(${d-r+1} * pixelStrength, 0.0),`:s[d]=`filteredCord + vec2(0.0, ${d-r+1} * pixelStrength),`;let f=d<r?d:e-d-1,h=t[f].toString();o[d]=`finalColor += textureSample(uTexture, uSampler, offset${d}) * ${h};`}let a=i.join(`
`),l=s.join(`
`),c=o.join(`
`),u=Jy.replace("%blur-struct%",a).replace("%blur-vertex-out%",l).replace("%blur-fragment-in%",a).replace("%blur-sampling%",c).replace("%dimension%",n?"z":"w");return pe.from({vertex:{source:u,entryPoint:"mainVertex"},fragment:{source:u,entryPoint:"mainFragment"}})}var lL=class cL extends be{constructor(e){e={...cL.defaultOptions,...e};let t=Zy(e.horizontal,e.kernelSize),r=ex(e.horizontal,e.kernelSize);super({glProgram:t,gpuProgram:r,resources:{blurUniforms:{uStrength:{value:0,type:"f32"}}},...e}),this.horizontal=e.horizontal,this._quality=0,this.quality=e.quality,this.blur=e.strength,this._uniforms=this.resources.blurUniforms.uniforms}apply(e,t,r,i){if(this._uniforms.uStrength=this.strength/this.passes,this.passes===1)e.applyFilter(this,t,r,i);else{let s=rt.getSameSizeTexture(t),o=t,a=s;this._state.blend=!1;let l=e.renderer.type===Bt.WEBGPU;for(let c=0;c<this.passes-1;c++){e.applyFilter(this,o,a,c===0?!0:l);let u=a;a=o,o=u}this._state.blend=!0,e.applyFilter(this,o,r,i),rt.returnTexture(s)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}};lL.defaultOptions={strength:8,quality:4,kernelSize:5};var Oa=lL;var ic=class extends be{constructor(...e){let t=e[0]??{};typeof t=="number"&&(oe(Ie,"BlurFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }"),t={strength:t},e[1]!==void 0&&(t.quality=e[1]),e[2]!==void 0&&(t.resolution=e[2]||"inherit"),e[3]!==void 0&&(t.kernelSize=e[3])),t={...Oa.defaultOptions,...t};let{strength:r,strengthX:i,strengthY:s,quality:o,...a}=t;super({...a,compatibleRenderers:Bt.BOTH,resources:{}}),this._repeatEdgePixels=!1,this.blurXFilter=new Oa({horizontal:!0,...t}),this.blurYFilter=new Oa({horizontal:!1,...t}),this.quality=o,this.strengthX=i??r,this.strengthY=s??r,this.repeatEdgePixels=!1}apply(e,t,r,i){let s=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(s&&o){let a=rt.getSameSizeTexture(t);this.blurXFilter.blendMode="normal",this.blurXFilter.apply(e,t,a,!0),this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(e,a,r,i),rt.returnTexture(a)}else o?(this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(e,t,r,i)):(this.blurXFilter.blendMode=this.blendMode,this.blurXFilter.apply(e,t,r,i))}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.blur),Math.abs(this.blurYFilter.blur))*2}get strength(){if(this.strengthX!==this.strengthY)throw new Error("BlurFilter's strengthX and strengthY are different");return this.strengthX}set strength(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get strengthX(){return this.blurXFilter.blur}set strengthX(e){this.blurXFilter.blur=e,this.updatePadding()}get strengthY(){return this.blurYFilter.blur}set strengthY(e){this.blurYFilter.blur=e,this.updatePadding()}get blur(){return oe("8.3.0","BlurFilter.blur is deprecated, please use BlurFilter.strength instead."),this.strength}set blur(e){oe("8.3.0","BlurFilter.blur is deprecated, please use BlurFilter.strength instead."),this.strength=e}get blurX(){return oe("8.3.0","BlurFilter.blurX is deprecated, please use BlurFilter.strengthX instead."),this.strengthX}set blurX(e){oe("8.3.0","BlurFilter.blurX is deprecated, please use BlurFilter.strengthX instead."),this.strengthX=e}get blurY(){return oe("8.3.0","BlurFilter.blurY is deprecated, please use BlurFilter.strengthY instead."),this.strengthY}set blurY(e){oe("8.3.0","BlurFilter.blurY is deprecated, please use BlurFilter.strengthY instead."),this.strengthY=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}};ic.defaultOptions={strength:8,quality:4,kernelSize:5};nn();Ci();qi();Hr();Fo();var tx=`
in vec2 vTextureCoord;
in vec4 vColor;

out vec4 finalColor;

uniform float uColorMatrix[20];
uniform float uAlpha;

uniform sampler2D uTexture;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture(uTexture, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * 0.2);
    float diff = (randomValue - 0.5) *  0.5;

    if (uAlpha == 0.0) {
        finalColor = color;
        return;
    }

    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    vec4 result;

    result.r = (uColorMatrix[0] * color.r);
        result.r += (uColorMatrix[1] * color.g);
        result.r += (uColorMatrix[2] * color.b);
        result.r += (uColorMatrix[3] * color.a);
        result.r += uColorMatrix[4];

    result.g = (uColorMatrix[5] * color.r);
        result.g += (uColorMatrix[6] * color.g);
        result.g += (uColorMatrix[7] * color.b);
        result.g += (uColorMatrix[8] * color.a);
        result.g += uColorMatrix[9];

    result.b = (uColorMatrix[10] * color.r);
       result.b += (uColorMatrix[11] * color.g);
       result.b += (uColorMatrix[12] * color.b);
       result.b += (uColorMatrix[13] * color.a);
       result.b += uColorMatrix[14];

    result.a = (uColorMatrix[15] * color.r);
       result.a += (uColorMatrix[16] * color.g);
       result.a += (uColorMatrix[17] * color.b);
       result.a += (uColorMatrix[18] * color.a);
       result.a += uColorMatrix[19];

    vec3 rgb = mix(color.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    finalColor = vec4(rgb, result.a);
}
`;var V3=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct ColorMatrixUniforms {
  uColorMatrix:array<vec4<f32>, 5>,
  uAlpha:f32,
};


@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;
@group(1) @binding(0) var<uniform> colorMatrixUniforms : ColorMatrixUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
  };
  
fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
  );
}


@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
) -> @location(0) vec4<f32> {


  var c = textureSample(uTexture, uSampler, uv);
  
  if (colorMatrixUniforms.uAlpha == 0.0) {
    return c;
  }

 
    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.r /= c.a;
      c.g /= c.a;
      c.b /= c.a;
    }

    var cm = colorMatrixUniforms.uColorMatrix;


    var result = vec4<f32>(0.);

    result.r = (cm[0][0] * c.r);
    result.r += (cm[0][1] * c.g);
    result.r += (cm[0][2] * c.b);
    result.r += (cm[0][3] * c.a);
    result.r += cm[1][0];

    result.g = (cm[1][1] * c.r);
    result.g += (cm[1][2] * c.g);
    result.g += (cm[1][3] * c.b);
    result.g += (cm[2][0] * c.a);
    result.g += cm[2][1];

    result.b = (cm[2][2] * c.r);
    result.b += (cm[2][3] * c.g);
    result.b += (cm[3][0] * c.b);
    result.b += (cm[3][1] * c.a);
    result.b += cm[3][2];

    result.a = (cm[3][3] * c.r);
    result.a += (cm[4][0] * c.g);
    result.a += (cm[4][1] * c.b);
    result.a += (cm[4][2] * c.a);
    result.a += cm[4][3];

    var rgb = mix(c.rgb, result.rgb, colorMatrixUniforms.uAlpha);

    rgb.r *= result.a;
    rgb.g *= result.a;
    rgb.b *= result.a;

    return vec4(rgb, result.a);
}`;var sc=class extends be{constructor(e={}){let t=new pt({uColorMatrix:{value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],type:"f32",size:20},uAlpha:{value:1,type:"f32"}}),r=pe.from({vertex:{source:V3,entryPoint:"mainVertex"},fragment:{source:V3,entryPoint:"mainFragment"}}),i=he.from({vertex:nc,fragment:tx,name:"color-matrix-filter"});super({...e,gpuProgram:r,glProgram:i,resources:{colorMatrixUniforms:t}}),this.alpha=1}_loadMatrix(e,t=!1){let r=e;t&&(this._multiply(r,this.matrix,e),r=this._colorMatrix(r)),this.resources.colorMatrixUniforms.uniforms.uColorMatrix=r,this.resources.colorMatrixUniforms.update()}_multiply(e,t,r){return e[0]=t[0]*r[0]+t[1]*r[5]+t[2]*r[10]+t[3]*r[15],e[1]=t[0]*r[1]+t[1]*r[6]+t[2]*r[11]+t[3]*r[16],e[2]=t[0]*r[2]+t[1]*r[7]+t[2]*r[12]+t[3]*r[17],e[3]=t[0]*r[3]+t[1]*r[8]+t[2]*r[13]+t[3]*r[18],e[4]=t[0]*r[4]+t[1]*r[9]+t[2]*r[14]+t[3]*r[19]+t[4],e[5]=t[5]*r[0]+t[6]*r[5]+t[7]*r[10]+t[8]*r[15],e[6]=t[5]*r[1]+t[6]*r[6]+t[7]*r[11]+t[8]*r[16],e[7]=t[5]*r[2]+t[6]*r[7]+t[7]*r[12]+t[8]*r[17],e[8]=t[5]*r[3]+t[6]*r[8]+t[7]*r[13]+t[8]*r[18],e[9]=t[5]*r[4]+t[6]*r[9]+t[7]*r[14]+t[8]*r[19]+t[9],e[10]=t[10]*r[0]+t[11]*r[5]+t[12]*r[10]+t[13]*r[15],e[11]=t[10]*r[1]+t[11]*r[6]+t[12]*r[11]+t[13]*r[16],e[12]=t[10]*r[2]+t[11]*r[7]+t[12]*r[12]+t[13]*r[17],e[13]=t[10]*r[3]+t[11]*r[8]+t[12]*r[13]+t[13]*r[18],e[14]=t[10]*r[4]+t[11]*r[9]+t[12]*r[14]+t[13]*r[19]+t[14],e[15]=t[15]*r[0]+t[16]*r[5]+t[17]*r[10]+t[18]*r[15],e[16]=t[15]*r[1]+t[16]*r[6]+t[17]*r[11]+t[18]*r[16],e[17]=t[15]*r[2]+t[16]*r[7]+t[17]*r[12]+t[18]*r[17],e[18]=t[15]*r[3]+t[16]*r[8]+t[17]*r[13]+t[18]*r[18],e[19]=t[15]*r[4]+t[16]*r[9]+t[17]*r[14]+t[18]*r[19]+t[19],e}_colorMatrix(e){let t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){let r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}tint(e,t){let[r,i,s]=ce.shared.setValue(e).toArray(),o=[r,0,0,0,0,0,i,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(o,t)}greyscale(e,t){let r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}grayscale(e,t){this.greyscale(e,t)}blackAndWhite(e){let t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;let r=Math.cos(e),i=Math.sin(e),s=Math.sqrt,o=1/3,a=s(o),l=r+(1-r)*o,c=o*(1-r)-a*i,u=o*(1-r)+a*i,d=o*(1-r)+a*i,f=r+o*(1-r),h=o*(1-r)-a*i,p=o*(1-r)-a*i,m=o*(1-r)+a*i,g=r+o*(1-r),y=[l,c,u,0,0,d,f,h,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(y,t)}contrast(e,t){let r=(e||0)+1,i=-.5*(r-1),s=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(s,t)}saturate(e=0,t){let r=e*2/3+1,i=(r-1)*-.5,s=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(s,t)}desaturate(){this.saturate(-1)}negative(e){let t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){let t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){let t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){let t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){let t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){let t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){let t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){let t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,r,i,s){e||(e=.2),t||(t=.15),r||(r=16770432),i||(i=3375104);let o=ce.shared,[a,l,c]=o.setValue(r).toArray(),[u,d,f]=o.setValue(i).toArray(),h=[.3,.59,.11,0,0,a,l,c,e,0,u,d,f,t,0,a-u,l-d,c-f,0,0];this._loadMatrix(h,s)}night(e,t){e||(e=.1);let r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,t)}predator(e,t){let r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,t)}lsd(e){let t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){let e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.resources.colorMatrixUniforms.uniforms.uColorMatrix}set matrix(e){this.resources.colorMatrixUniforms.uniforms.uColorMatrix=e}get alpha(){return this.resources.colorMatrixUniforms.uniforms.uAlpha}set alpha(e){this.resources.colorMatrixUniforms.uniforms.uAlpha=e}};Ct();vi();Ci();qi();Hr();xl();zt();Fo();var rx=`
in vec2 vTextureCoord;
in vec2 vFilterUv;

out vec4 finalColor;

uniform sampler2D uTexture;
uniform sampler2D uMapTexture;

uniform vec4 uInputClamp;
uniform highp vec4 uInputSize;
uniform mat2 uRotation;
uniform vec2 uScale;

void main()
{
    vec4 map = texture(uMapTexture, vFilterUv);
    
    vec2 offset = uInputSize.zw * (uRotation * (map.xy - 0.5)) * uScale; 

    finalColor = texture(uTexture, clamp(vTextureCoord + offset, uInputClamp.xy, uInputClamp.zw));
}
`;var nx=`in vec2 aPosition;
out vec2 vTextureCoord;
out vec2 vFilterUv;


uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

uniform mat3 uFilterMatrix;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

vec2 getFilterCoord( void )
{
  return ( uFilterMatrix * vec3( filterTextureCoord(), 1.0)  ).xy;
}


void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
    vFilterUv = getFilterCoord();
}
`;var j3=`
struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct DisplacementUniforms {
  uFilterMatrix:mat3x3<f32>,
  uScale:vec2<f32>,
  uRotation:mat2x2<f32>
};



@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> filterUniforms : DisplacementUniforms;
@group(1) @binding(1) var uMapTexture: texture_2d<f32>;
@group(1) @binding(2) var uMapSampler : sampler;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) filterUv : vec2<f32>,
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>
{
  return ( filterUniforms.uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}

fn getSize() -> vec2<f32>
{

  
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
   getFilterCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) filterUv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    var map = textureSample(uMapTexture, uMapSampler, filterUv);

    var offset =  gfu.uInputSize.zw * (filterUniforms.uRotation * (map.xy - 0.5)) * filterUniforms.uScale; 
   
    return textureSample(uTexture, uSampler, clamp(uv + offset, gfu.uInputClamp.xy, gfu.uInputClamp.zw));
}`;var ix=class extends be{constructor(...e){let t=e[0];t instanceof At&&(e[1]&&oe(Ie,"DisplacementFilter now uses options object instead of params. {sprite, scale}"),t={sprite:t,scale:e[1]});let{sprite:r,scale:i,...s}=t,o=i??20;typeof o=="number"&&(o=new Ve(o,o));let a=new pt({uFilterMatrix:{value:new ue,type:"mat3x3<f32>"},uScale:{value:o,type:"vec2<f32>"},uRotation:{value:new Float32Array([0,0,0,0]),type:"mat2x2<f32>"}}),l=he.from({vertex:nx,fragment:rx,name:"displacement-filter"}),c=pe.from({vertex:{source:j3,entryPoint:"mainVertex"},fragment:{source:j3,entryPoint:"mainFragment"}}),u=r.texture.source;super({...s,gpuProgram:c,glProgram:l,resources:{filterUniforms:a,uMapTexture:u,uMapSampler:u.style}}),this._sprite=t.sprite,this._sprite.renderable=!1}apply(e,t,r,i){let s=this.resources.filterUniforms.uniforms;e.calculateSpriteMatrix(s.uFilterMatrix,this._sprite);let o=this._sprite.worldTransform,a=Math.sqrt(o.a*o.a+o.b*o.b),l=Math.sqrt(o.c*o.c+o.d*o.d);a!==0&&l!==0&&(s.uRotation[0]=o.a/a,s.uRotation[1]=o.b/a,s.uRotation[2]=o.c/l,s.uRotation[3]=o.d/l),this.resources.uMapTexture=this._sprite.texture.source,e.applyFilter(this,t,r,i)}get scale(){return this.resources.filterUniforms.uniforms.uScale}};Ci();qi();Hr();Fo();var sx=`
in vec2 vTextureCoord;
in vec4 vColor;

out vec4 finalColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uTexture;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture(uTexture, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) *  uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    finalColor = color;
}
`;var X3=`

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct NoiseUniforms {
  uNoise:f32,
  uSeed:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> noiseUniforms : NoiseUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

fn rand(co:vec2<f32>) -> f32
{
  return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}



@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    var pixelPosition =  globalTextureCoord(position.xy);// / (getSize());//-  gfu.uOutputFrame.xy);
  
    
    var sample = textureSample(uTexture, uSampler, uv);
    var randomValue =  rand(pixelPosition.xy * noiseUniforms.uSeed);
    var diff = (randomValue - 0.5) * noiseUniforms.uNoise;
  
    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (sample.a > 0.0) {
      sample.r /= sample.a;
      sample.g /= sample.a;
      sample.b /= sample.a;
    }

    sample.r += diff;
    sample.g += diff;
    sample.b += diff;

    // Premultiply alpha again.
    sample.r *= sample.a;
    sample.g *= sample.a;
    sample.b *= sample.a;
    
    return sample;
}`;var uL=class dL extends be{constructor(e={}){e={...dL.defaultOptions,...e};let t=pe.from({vertex:{source:X3,entryPoint:"mainVertex"},fragment:{source:X3,entryPoint:"mainFragment"}}),r=he.from({vertex:nc,fragment:sx,name:"noise-filter"}),{noise:i,seed:s,...o}=e;super({...o,gpuProgram:t,glProgram:r,resources:{noiseUniforms:new pt({uNoise:{value:1,type:"f32"},uSeed:{value:1,type:"f32"}})}}),this.noise=i,this.seed=s??Math.random()}get noise(){return this.resources.noiseUniforms.uniforms.uNoise}set noise(e){this.resources.noiseUniforms.uniforms.uNoise=e}get seed(){return this.resources.noiseUniforms.uniforms.uSeed}set seed(e){this.resources.noiseUniforms.uniforms.uSeed=e}};uL.defaultOptions={noise:.5};var fL=uL;var hL=`fn getLuminosity(c: vec3<f32>) -> f32 {
  return 0.3 * c.r + 0.59 * c.g + 0.11 * c.b;
}

fn setLuminosity(c: vec3<f32>, lum: f32) -> vec3<f32> {
  let d: f32 = lum - getLuminosity(c);
  let newColor: vec3<f32> = c.rgb + vec3<f32>(d, d, d);

  // clip back into legal range
  let newLum: f32 = getLuminosity(newColor);
  let cMin: f32 = min(newColor.r, min(newColor.g, newColor.b));
  let cMax: f32 = max(newColor.r, max(newColor.g, newColor.b));

  let t1: f32 = newLum / (newLum - cMin);
  let t2: f32 = (1.0 - newLum) / (cMax - newLum);

  let finalColor = mix(vec3<f32>(newLum, newLum, newLum), newColor, select(select(1.0, t2, cMax > 1.0), t1, cMin < 0.0));

  return finalColor;
}

fn getSaturation(c: vec3<f32>) -> f32 {
  return max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));
}

// Set saturation if color components are sorted in ascending order.
fn setSaturationMinMidMax(cSorted: vec3<f32>, s: f32) -> vec3<f32> {
  var result: vec3<f32>;
  if (cSorted.z > cSorted.x) {
    let newY = (((cSorted.y - cSorted.x) * s) / (cSorted.z - cSorted.x));
    result = vec3<f32>(0.0, newY, s);
  } else {
    result = vec3<f32>(0.0, 0.0, 0.0);
  }
  return vec3<f32>(result.x, result.y, result.z);
}

fn setSaturation(c: vec3<f32>, s: f32) -> vec3<f32> {
    var result: vec3<f32> = c;

    if (c.r <= c.g && c.r <= c.b) {
        if (c.g <= c.b) {
            result = setSaturationMinMidMax(result, s);
        } else {
            var temp: vec3<f32> = vec3<f32>(result.r, result.b, result.g);
            temp = setSaturationMinMidMax(temp, s);
            result = vec3<f32>(temp.r, temp.b, temp.g);
        }
    } else if (c.g <= c.r && c.g <= c.b) {
        if (c.r <= c.b) {
            var temp: vec3<f32> = vec3<f32>(result.g, result.r, result.b);
            temp = setSaturationMinMidMax(temp, s);
            result = vec3<f32>(temp.g, temp.r, temp.b);
        } else {
            var temp: vec3<f32> = vec3<f32>(result.g, result.b, result.r);
            temp = setSaturationMinMidMax(temp, s);
            result = vec3<f32>(temp.g, temp.b, temp.r);
        }
    } else {
        if (c.r <= c.g) {
            var temp: vec3<f32> = vec3<f32>(result.b, result.r, result.g);
            temp = setSaturationMinMidMax(temp, s);
            result = vec3<f32>(temp.b, temp.r, temp.g);
        } else {
            var temp: vec3<f32> = vec3<f32>(result.b, result.g, result.r);
            temp = setSaturationMinMidMax(temp, s);
            result = vec3<f32>(temp.b, temp.g, temp.r);
        }
    }

    return result;
}`;function q3(n,e,t,r,i,s,o,a){let l=o-t,c=a-r,u=i-t,d=s-r,f=n-t,h=e-r,p=l*l+c*c,m=l*u+c*d,g=l*f+c*h,y=u*u+d*d,x=u*f+d*h,b=1/(p*y-m*m),_=(y*g-m*x)*b,S=(p*x-m*g)*b;return _>=0&&S>=0&&_+S<1}$9();Qr();var ox=class n{constructor(e=0,t=0,r=0,i=0,s=0,o=0){this.type="triangle",this.x=e,this.y=t,this.x2=r,this.y2=i,this.x3=s,this.y3=o}contains(e,t){let r=(this.x-this.x3)*(t-this.y3)-(this.y-this.y3)*(e-this.x3),i=(this.x2-this.x)*(t-this.y)-(this.y2-this.y)*(e-this.x);if(r<0!=i<0&&r!==0&&i!==0)return!1;let s=(this.x3-this.x2)*(t-this.y2)-(this.y3-this.y2)*(e-this.x2);return s===0||s<0==r+i<=0}strokeContains(e,t,r,i=.5){let s=r/2,o=s*s,{x:a,x2:l,x3:c,y:u,y2:d,y3:f}=this;return Nl(e,t,a,u,l,f)<=o||Nl(e,t,l,d,c,f)<=o||Nl(e,t,c,f,a,u)<=o}clone(){return new n(this.x,this.y,this.x2,this.y2,this.x3,this.y3)}copyFrom(e){return this.x=e.x,this.y=e.y,this.x2=e.x2,this.y2=e.y2,this.x3=e.x3,this.y3=e.y3,this}copyTo(e){return e.copyFrom(this),e}getBounds(e){e||(e=new $e);let t=Math.min(this.x,this.x2,this.x3),r=Math.max(this.x,this.x2,this.x3),i=Math.min(this.y,this.y2,this.y3),s=Math.max(this.y,this.y2,this.y3);return e.x=t,e.y=i,e.width=r-t,e.height=s-i,e}};Vi();jc();ml();var pL=class mL{constructor(e){this._tick=()=>{this.timeout=setTimeout(this._processQueue,0)},this._processQueue=()=>{let{queue:t}=this,r=0;for(;t.length&&r<mL.uploadsPerFrame;){let i=t.shift();this.uploadQueueItem(i),r++}t.length?yr.system.addOnce(this._tick,this,si.UTILITY):this._resolve()},this.renderer=e,this.queue=[],this.resolves=[]}getQueue(){return[...this.queue]}add(e){let t=Array.isArray(e)?e:[e];for(let r of t)r instanceof we?this._addContainer(r):this.resolveQueueItem(r,this.queue);return this}_addContainer(e){this.resolveQueueItem(e,this.queue);for(let t of e.children)this._addContainer(t)}upload(e){return e&&this.add(e),new Promise(t=>{this.queue.length?(this.resolves.push(t),this.dedupeQueue(),yr.system.addOnce(this._tick,this,si.UTILITY)):t()})}dedupeQueue(){let e=Object.create(null),t=0;for(let r=0;r<this.queue.length;r++){let i=this.queue[r];e[i.uid]||(e[i.uid]=!0,this.queue[t++]=i)}this.queue.length=t}_resolve(){let{resolves:e}=this,t=e.slice(0);e.length=0;for(let r of t)r()}};pL.uploadsPerFrame=4;var ax=pL;cn();_t();Vi();r8();pu();Al();Ki();_t();zt();ko();Da();var Tn=class extends Zr{constructor(...e){let t=e[0];t instanceof Gn&&(oe(Ie,"Mesh: use new Mesh({ geometry, shader }) instead"),t={geometry:t,shader:e[1]},e[3]&&(oe(Ie,"Mesh: drawMode argument has been removed, use geometry.topology instead"),t.geometry.topology=e[3]));let{geometry:r,shader:i,texture:s,roundPixels:o,state:a,...l}=t;super({label:"Mesh",...l}),this.renderPipeId="mesh",this._shader=null,this.allowChildren=!1,this.shader=i??null,this.texture=s??i?.texture??re.WHITE,this.state=a??ur.for2d(),this._geometry=r,this._geometry.on("update",this.onViewUpdate,this),this.roundPixels=o??!1}get material(){return oe(Ie,"mesh.material property has been removed, use mesh.shader instead"),this._shader}set shader(e){this._shader!==e&&(this._shader=e,this.onViewUpdate())}get shader(){return this._shader}set geometry(e){this._geometry!==e&&(this._geometry?.off("update",this.onViewUpdate,this),e.on("update",this.onViewUpdate,this),this._geometry=e,this.onViewUpdate())}get geometry(){return this._geometry}set texture(e){e||(e=re.EMPTY);let t=this._texture;t!==e&&(t&&t.dynamic&&t.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this.shader&&(this.shader.texture=e),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}get batched(){return this._shader||this.state.data&12?!1:this._geometry instanceof en?this._geometry.batchMode==="auto"?this._geometry.positions.length/2<=100:this._geometry.batchMode==="batch":!1}get bounds(){return this._geometry.bounds}updateBounds(){this._bounds=this._geometry.bounds}containsPoint(e){let{x:t,y:r}=e;if(!this.bounds.containsPoint(t,r))return!1;let i=this.geometry.getBuffer("aPosition").data,s=this.geometry.topology==="triangle-strip"?3:1;if(this.geometry.getIndex()){let o=this.geometry.getIndex().data,a=o.length;for(let l=0;l+2<a;l+=s){let c=o[l]*2,u=o[l+1]*2,d=o[l+2]*2;if(q3(t,r,i[c],i[c+1],i[u],i[u+1],i[d],i[d+1]))return!0}}else{let o=i.length/2;for(let a=0;a+2<o;a+=s){let l=a*2,c=(a+1)*2,u=(a+2)*2;if(q3(t,r,i[l],i[l+1],i[c],i[c+1],i[u],i[u+1]))return!0}}return!1}destroy(e){if(super.destroy(e),typeof e=="boolean"?e:e?.texture){let r=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(r)}this._geometry?.off("update",this.onViewUpdate,this),this._texture=null,this._geometry=null,this._shader=null}};xl();_t();jc();ml();xl();var Bd=class n extends At{constructor(...e){let t=e[0];Array.isArray(e[0])&&(t={textures:e[0],autoUpdate:e[1]});let{textures:r,autoUpdate:i,...s}=t,[o]=r;super({...s,texture:o instanceof re?o:o.texture}),this._textures=null,this._durations=null,this._autoUpdate=i??!0,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=r}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(yr.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(yr.shared.add(this.update,this,si.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;let t=e.deltaTime,r=this.animationSpeed*t,i=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];let o=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*o,this._currentTime+=o;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this._updateTexture())}_updateTexture(){let e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){let t=[];for(let r=0;r<e.length;++r)t.push(re.from(e[r]));return new n(t)}static fromImages(e){let t=[];for(let r=0;r<e.length;++r)t.push(re.from(e[r]));return new n(t)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof re)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let t=0;t<e.length;t++)this._textures.push(e[t].texture),this._durations.push(e[t].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);let t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(yr.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(yr.shared.add(this.update,this),this._isConnectedToTicker=!0))}};Io();Bc();_t();zt();Gt();Ct();Bc();var Nd=class{constructor({matrix:e,observer:t}={}){this.dirty=!0,this._matrix=e??new ue,this.observer=t,this.position=new Zt(this,0,0),this.scale=new Zt(this,1,1),this.pivot=new Zt(this,0,0),this.skew=new Zt(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){let e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}};ko();var gL=class lx extends Zr{constructor(...e){let t=e[0]||{};t instanceof re&&(t={texture:t}),e.length>1&&(oe(Ie,"use new TilingSprite({ texture, width:100, height:100 }) instead"),t.width=e[1],t.height=e[2]),t={...lx.defaultOptions,...t};let{texture:r,anchor:i,tilePosition:s,tileScale:o,tileRotation:a,width:l,height:c,applyAnchorToTexture:u,roundPixels:d,...f}=t??{};super({label:"TilingSprite",...f}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new Zt({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=u,this.texture=r,this._width=l??r.width,this._height=c??r.height,this._tileTransform=new Nd({observer:{_onUpdate:()=>this.onViewUpdate()}}),i&&(this.anchor=i),this.tilePosition=s,this.tileScale=o,this.tileRotation=a,this.roundPixels=d??!1}static from(e,t={}){return typeof e=="string"?new lx({texture:kt.get(e),...t}):new lx({texture:e,...t})}get uvRespectAnchor(){return ve("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){ve("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=re.EMPTY);let t=this._texture;t!==e&&(t&&t.dynamic&&t.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,t){typeof e=="object"&&(t=e.height??e.width,e=e.width),this._width=e,this._height=t??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){let e=this._bounds,t=this._anchor,r=this._width,i=this._height;e.maxX=-t._x*r,e.minX=e.maxX+r,e.maxY=-t._y*i,e.minY=e.maxY+i}containsPoint(e){let t=this._width,r=this._height,i=-t*this._anchor._x,s=0;return e.x>=i&&e.x<=i+t&&(s=-r*this._anchor._y,e.y>=s&&e.y<=s+r)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){let r=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(r)}this._texture=null}};gL.defaultOptions={texture:re.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};var cx=gL;Bc();zt();ko();var Ho=class extends Zr{constructor(e,t){let{text:r,resolution:i,style:s,anchor:o,width:a,height:l,roundPixels:c,...u}=e;super({...u}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=t,this.text=r??"",this.style=s,this.resolution=i??null,this.allowChildren=!1,this._anchor=new Zt({_onUpdate:()=>{this.onViewUpdate()}}),o&&(this.anchor=o),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,t){typeof e=="object"?(t=e.height??e.width,e=e.width):t??(t=e),e!==void 0&&this._setWidth(e,this.bounds.width),t!==void 0&&this._setHeight(t,this.bounds.height)}containsPoint(e){let t=this.bounds.width,r=this.bounds.height,i=-t*this.anchor.x,s=0;return e.x>=i&&e.x<=i+t&&(s=-r*this.anchor.y,e.y>=s&&e.y<=s+r)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}:${this._resolution}`}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}};function oc(n,e){let t=n[0]??{};return(typeof t=="string"||n[1])&&(oe(Ie,`use new ${e}({ text: "hi!", style }) instead`),t={text:t,style:n[1]}),t}T4();Ia();var ac=class extends Ho{constructor(...e){let t=oc(e,"Text");super(t,dr),this.renderPipeId="text"}updateBounds(){let e=this._bounds,t=this._anchor,r=Ei.measureText(this._text,this._style),{width:i,height:s}=r;e.minX=-t._x*i,e.maxX=e.minX+i,e.minY=-t._y*s,e.maxY=e.minY+s}};var Od=class extends ax{resolveQueueItem(e,t){return e instanceof we?this.resolveContainerQueueItem(e,t):e instanceof ot||e instanceof re?t.push(e.source):e instanceof Wr&&t.push(e),null}resolveContainerQueueItem(e,t){e instanceof At||e instanceof cx||e instanceof Tn?t.push(e.texture.source):e instanceof ac?t.push(e):e instanceof ze?t.push(e.context):e instanceof Bd&&e.textures.forEach(r=>{r.source?t.push(r.source):t.push(r.texture.source)})}resolveGraphicsContextQueueItem(e){this.renderer.graphicsContext.getContextRenderData(e);let{instructions:t}=e;for(let r of t)if(r.action==="texture"){let{image:i}=r.data;return i.source}else if(r.action==="fill"){let{texture:i}=r.data.style;return i.source}return null}};ee();cn();pu();Gt();Ia();I4();var Wo=class extends Ho{constructor(...e){var t;let r=oc(e,"BitmapText");r.style??(r.style=r.style||{}),(t=r.style).fill??(t.fill=16777215),super(r,dr),this.renderPipeId="bitmapText"}updateBounds(){let e=this._bounds,t=this._anchor,r=Qi.measureText(this.text,this._style),i=r.scale,s=r.offsetY*i,o=r.width*i,a=r.height*i,l=this._style._stroke;l&&(o+=l.width,a+=l.width),e.minX=-t._x*o,e.maxX=e.minX+o,e.minY=-t._y*(a+s),e.maxY=e.minY+a}set resolution(e){e!==null&&ve("[BitmapText] dynamically updating the resolution is not supported. Resolution should be managed by the BitmapFont.")}get resolution(){return this._resolution}};P4();w8();var Ld=class extends Ho{constructor(...e){let t=oc(e,"HtmlText");super(t,Js),this.renderPipeId="htmlText"}updateBounds(){let e=this._bounds,t=this._anchor,r=F0(this.text,this._style),{width:i,height:s}=r;e.minX=-t._x*i,e.maxX=e.minX+i,e.minY=-t._y*s,e.maxY=e.minY+s}};var Ud=class extends Od{uploadQueueItem(e){e instanceof ot?this.uploadTextureSource(e):e instanceof ac?this.uploadText(e):e instanceof Ld?this.uploadHTMLText(e):e instanceof Wo?this.uploadBitmapText(e):e instanceof Wr&&this.uploadGraphicsContext(e)}uploadTextureSource(e){this.renderer.texture.initSource(e)}uploadText(e){this.renderer.renderPipes.text.initGpuText(e)}uploadBitmapText(e){this.renderer.renderPipes.bitmapText.initGpuText(e)}uploadHTMLText(e){this.renderer.renderPipes.htmlText.initGpuText(e)}uploadGraphicsContext(e){this.renderer.graphicsContext.getContextRenderData(e);let{instructions:t}=e;for(let r of t)if(r.action==="texture"){let{image:i}=r.data;this.uploadTextureSource(i.source)}else if(r.action==="fill"){let{texture:i}=r.data.style;this.uploadTextureSource(i.source)}return null}};var Y3=class extends Ud{destroy(){clearTimeout(this.timeout),this.renderer=null,this.queue=null,this.resolves=null}};Y3.extension={type:[z.WebGLSystem,z.WebGPUSystem],name:"prepare"};function yL(n){let e=[],t=0;for(let r=0;r<n;r++)e[t]={texture:{sampleType:"float",viewDimension:"2d",multisampled:!1},binding:t,visibility:GPUShaderStage.FRAGMENT},t++,e[t]={sampler:{type:"filtering"},binding:t,visibility:GPUShaderStage.FRAGMENT},t++;return e}function xL(n){let e={},t=0;for(let r=0;r<n;r++)e[`textureSource${r+1}`]=t++,e[`textureSampler${r+1}`]=t++;return e}function bL(n){let e=n.split(/([\n{}])/g).map(i=>i.trim()).filter(i=>i.length),t="";return e.map(i=>{let s=t+i;return i==="{"?t+="    ":i==="}"&&(t=t.substr(0,t.length-4),s=t+i),s}).join(`
`)}e4();t4();var ux=class{constructor(e){this.priority=0,this.pipe="scissorMask",this.mask=e,this.mask.renderable=!1,this.mask.measurable=!1}addBounds(e,t){bl(this.mask,e,t)}addLocalBounds(e,t){_l(this.mask,e,t)}containsPoint(e,t){let r=this.mask;return t(r,e)}reset(){this.mask.measurable=!0,this.mask=null}destroy(){this.reset()}};function _L(n){return n=n.replaceAll("texture2D","texture").replaceAll("gl_FragColor","finalColor").replaceAll("varying","in"),n=`
        out vec4 finalColor;
    ${n}
    `,n}var lJ={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function vL(n){return lJ[n]}Po();qs();function wL(n,e){let t=n.descriptor.size,r=e.gpu.device,i=new ar({data:new Float32Array(24e5),usage:nt.MAP_READ|nt.COPY_DST}),s=e.buffer.createGPUBuffer(i),o=r.createCommandEncoder();o.copyBufferToBuffer(e.buffer.getGPUBuffer(n),0,s,0,t),r.queue.submit([o.finish()]),s.mapAsync(GPUMapMode.READ,0,t).then(()=>{s.getMappedRange(0,t),s.unmap()})}zt();var SL={POINTS:"point-list",LINES:"line-list",LINE_STRIP:"line-strip",TRIANGLES:"triangle-list",TRIANGLE_STRIP:"triangle-strip"},CL=new Proxy(SL,{get(n,e){return oe(Ie,`DRAW_MODES.${e} is deprecated, use '${SL[e]}' instead`),n[e]}});Qr();var cJ=new $e(0,0,1,1);function AL(n,e,t){t||(t=cJ);let r=e.pixelWidth,i=e.pixelHeight;return n.x=t.x*r|0,n.y=t.y*i|0,n.width=t.width*r|0,n.height=t.height*i|0,n}zt();var gk=(n=>(n[n.NONE=0]="NONE",n[n.LOW=2]="LOW",n[n.MEDIUM=4]="MEDIUM",n[n.HIGH=8]="HIGH",n))(gk||{}),K3=(n=>(n.CLAMP="clamp-to-edge",n.REPEAT="repeat",n.MIRRORED_REPEAT="mirror-repeat",n))(K3||{}),EL=new Proxy(K3,{get(n,e){return oe(Ie,`DRAW_MODES.${e} is deprecated, use '${K3[e]}' instead`),n[e]}}),Q3=(n=>(n.NEAREST="nearest",n.LINEAR="linear",n))(Q3||{}),TL=new Proxy(Q3,{get(n,e){return oe(Ie,`DRAW_MODES.${e} is deprecated, use '${Q3[e]}' instead`),n[e]}});g7();var dx=class{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,r){let i=t.width,s=t.height;if(r){let o=e.width/2/i,a=e.height/2/s,l=e.x/i+o,c=e.y/s+a;r=yt.add(r,yt.NW),this.x0=l+o*yt.uX(r),this.y0=c+a*yt.uY(r),r=yt.add(r,2),this.x1=l+o*yt.uX(r),this.y1=c+a*yt.uY(r),r=yt.add(r,2),this.x2=l+o*yt.uX(r),this.y2=c+a*yt.uY(r),r=yt.add(r,2),this.x3=l+o*yt.uX(r),this.y3=c+a*yt.uY(r)}else this.x0=e.x/i,this.y0=e.y/s,this.x1=(e.x+e.width)/i,this.y1=e.y/s,this.x2=(e.x+e.width)/i,this.y2=(e.y+e.height)/s,this.x3=e.x/i,this.y3=(e.y+e.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[pixi.js/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}};var uJ=0;function kL(){return uJ++}function IL(n){let e=n.toString(),t=e.indexOf("{"),r=e.lastIndexOf("}");if(t===-1||r===-1)throw new Error("getFunctionBody: No body found in function definition");return e.slice(t+1,r).trim()}ko();var fx=class extends Zr{constructor(e){typeof e=="function"&&(e={render:e});let{render:t,...r}=e;super({label:"RenderContainer",...r}),this.renderPipeId="customRender",this.batched=!1,t&&(this.render=t),this.containsPoint=e.containsPoint??(()=>!1),this.addBounds=e.addBounds??(()=>!1)}updateBounds(){this._bounds.clear(),this.addBounds(this._bounds)}render(e){}};function PL(n,e,t){let r=n>>16&255,i=n>>8&255,s=n&255,o=e>>16&255,a=e>>8&255,l=e&255,c=r+(o-r)*t,u=i+(a-i)*t,d=s+(l-s)*t;return(c<<16)+(u<<8)+d}function DL(n,e){let t=e._scale,r=e._pivot,i=e._position,s=t._x,o=t._y,a=r._x,l=r._y;n.a=e._cx*s,n.b=e._sx*s,n.c=e._cy*o,n.d=e._sy*o,n.tx=i._x-(a*n.a+l*n.c),n.ty=i._y-(a*n.b+l*n.d)}function ML(n,e,t){let r=n.a,i=n.b,s=n.c,o=n.d,a=n.tx,l=n.ty,c=e.a,u=e.b,d=e.c,f=e.d;t.a=r*c+i*d,t.b=r*u+i*f,t.c=s*c+o*d,t.d=s*u+o*f,t.tx=a*c+l*d+e.tx,t.ty=a*u+l*f+e.ty}y9();x9();Da();w9();M9();R9();F9();A4();var dJ={rectangle:f0,polygon:d0,triangle:h0,circle:_s,ellipse:_s,roundedRectangle:_s};function RL(n){n instanceof Ss&&(n={path:n,textureMatrix:null,out:null});let e=[],t=[],r=[],i=n.path.shapePath,s=n.textureMatrix;i.shapePrimitives.forEach(({shape:l,transform:c})=>{let u=r.length,d=e.length/2,f=[],h=dJ[l.type];h.build(l,f),c&&ru(f,c),h.triangulate(f,e,2,d,r,u);let p=t.length/2;s?(c&&s.append(c.clone().invert()),o0(e,2,d,t,p,2,e.length/2-d,s)):a0(t,p,2,e.length/2-d)});let o=n.out;return o?(o.positions=new Float32Array(e),o.uvs=new Float32Array(t),o.indices=new Uint32Array(r),o):new en({positions:new Float32Array(e),uvs:new Float32Array(t),indices:new Uint32Array(r)})}_t();Oc();M4();function hx(n,e,t,r){let i=t.buffers[0],s=i.data,{verticesX:o,verticesY:a}=t,l=n/(o-1),c=e/(a-1),u=0,d=r[0],f=r[1],h=r[2],p=r[3],m=r[4],g=r[5],y=r[6],x=r[7],b=r[8];for(let _=0;_<s.length;_+=2){let S=u%o*l,C=(u/o|0)*c,k=d*S+f*C+h,v=p*S+m*C+g,w=y*S+x*C+b;s[_]=k/w,s[_+1]=v/w,u++}i.update()}function BL(n,e){let t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return n[0]=o*u-a*c,n[1]=i*c-r*u,n[2]=r*a-i*o,n[3]=a*l-s*u,n[4]=t*u-i*l,n[5]=i*s-t*a,n[6]=s*c-o*l,n[7]=r*l-t*c,n[8]=t*o-r*s,n}function NL(n,e,t){let r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=t[0],h=t[1],p=t[2],m=t[3],g=t[4],y=t[5],x=t[6],b=t[7],_=t[8];return n[0]=f*r+h*o+p*c,n[1]=f*i+h*a+p*u,n[2]=f*s+h*l+p*d,n[3]=m*r+g*o+y*c,n[4]=m*i+g*a+y*u,n[5]=m*s+g*l+y*d,n[6]=x*r+b*o+_*c,n[7]=x*i+b*a+_*u,n[8]=x*s+b*l+_*d,n}function fJ(n,e,t){let r=t[0],i=t[1],s=t[2];return n[0]=e[0]*r+e[1]*i+e[2]*s,n[1]=e[3]*r+e[4]*i+e[5]*s,n[2]=e[6]*r+e[7]*i+e[8]*s,n}var hJ=[0,0,0,0,0,0,0,0,0],pJ=[0,0,0],px=[0,0,0];function FL(n,e,t,r,i,s,o,a,l){let c=hJ;c[0]=e,c[1]=r,c[2]=s,c[3]=t,c[4]=i,c[5]=o,c[6]=1,c[7]=1,c[8]=1;let u=BL(n,c);px[0]=a,px[1]=l,px[2]=1;let d=fJ(pJ,u,px),f=n;return n[0]=d[0],n[1]=0,n[2]=0,n[3]=0,n[4]=d[1],n[5]=0,n[6]=0,n[7]=0,n[8]=d[2],NL(n,f,c)}var mJ=[0,0,0,0,0,0,0,0,0],gJ=[0,0,0,0,0,0,0,0,0];function mx(n,e,t,r,i,s,o,a,l,c,u,d,f,h,p,m,g){let y=FL(mJ,e,t,s,o,c,u,h,p),x=FL(gJ,r,i,a,l,d,f,m,g);return NL(n,BL(y,y),x)}var Gd=class extends Hl{constructor(e){super(e),this._projectionMatrix=[0,0,0,0,0,0,0,0,0];let{width:t,height:r}=e;this.corners=[0,0,t,0,t,r,0,r]}setCorners(e,t,r,i,s,o,a,l){let c=this.corners;c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=s,c[5]=o,c[6]=a,c[7]=l,this.updateProjection()}updateProjection(){let{width:e,height:t}=this,r=this.corners,i=mx(this._projectionMatrix,0,0,r[0],r[1],e,0,r[2],r[3],e,t,r[4],r[5],0,t,r[6],r[7]);hx(e,t,this,i)}};var OL=class LL extends Tn{constructor(e){e={...LL.defaultOptions,...e};let{texture:t,verticesX:r,verticesY:i,...s}=e,o=new Gd(Un({width:t.width,height:t.height,verticesX:r,verticesY:i}));super(Un({...s,geometry:o})),this._texture=t,this.geometry.setCorners(e.x0,e.y0,e.x1,e.y1,e.x2,e.y2,e.x3,e.y3)}textureUpdated(){let e=this.geometry;if(!e)return;let{width:t,height:r}=this.texture;(e.width!==t||e.height!==r)&&(e.width=t,e.height=r,e.updateProjection())}set texture(e){this._texture!==e&&(super.texture=e,this.textureUpdated())}get texture(){return this._texture}setCorners(e,t,r,i,s,o,a,l){this.geometry.setCorners(e,t,r,i,s,o,a,l)}};OL.defaultOptions={texture:re.WHITE,verticesX:10,verticesY:10,x0:0,y0:0,x1:100,y1:0,x2:100,y2:100,x3:0,y3:100};var UL=OL;Oc();M4();var gx=class extends Tn{constructor(e){let{texture:t,verticesX:r,verticesY:i,...s}=e,o=new Hl(Un({width:t.width,height:t.height,verticesX:r,verticesY:i}));super(Un({...s,geometry:o,texture:t})),this.texture=t,this.autoResize=!0}textureUpdated(){let e=this.geometry,{width:t,height:r}=this.texture;this.autoResize&&(e.width!==t||e.height!==r)&&(e.width=t,e.height=r,e.build({}))}set texture(e){this._texture?.off("update",this.textureUpdated,this),super.texture=e,e.on("update",this.textureUpdated,this),this.textureUpdated()}get texture(){return this._texture}destroy(e){this.texture.off("update",this.textureUpdated,this),super.destroy(e)}};Oc();Da();var GL=class $L extends en{constructor(e){let{width:t,points:r,textureScale:i}={...$L.defaultOptions,...e};super({positions:new Float32Array(r.length*4),uvs:new Float32Array(r.length*4),indices:new Uint32Array((r.length-1)*6)}),this.points=r,this._width=t,this.textureScale=i,this._build()}get width(){return this._width}_build(){let e=this.points;if(!e)return;let t=this.getBuffer("aPosition"),r=this.getBuffer("aUV"),i=this.getIndex();if(e.length<1)return;t.data.length/4!==e.length&&(t.data=new Float32Array(e.length*4),r.data=new Float32Array(e.length*4),i.data=new Uint16Array((e.length-1)*6));let s=r.data,o=i.data;s[0]=0,s[1]=0,s[2]=0,s[3]=1;let a=0,l=e[0],c=this._width*this.textureScale,u=e.length;for(let f=0;f<u;f++){let h=f*4;if(this.textureScale>0){let p=l.x-e[f].x,m=l.y-e[f].y,g=Math.sqrt(p*p+m*m);l=e[f],a+=g/c}else a=f/(u-1);s[h]=a,s[h+1]=0,s[h+2]=a,s[h+3]=1}let d=0;for(let f=0;f<u-1;f++){let h=f*2;o[d++]=h,o[d++]=h+1,o[d++]=h+2,o[d++]=h+2,o[d++]=h+1,o[d++]=h+3}r.update(),i.update(),this.updateVertices()}updateVertices(){let e=this.points;if(e.length<1)return;let t=e[0],r,i=0,s=0,o=this.buffers[0].data,a=e.length,l=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let c=0;c<a;c++){let u=e[c],d=c*4;c<e.length-1?r=e[c+1]:r=u,s=-(r.x-t.x),i=r.y-t.y;let f=(1-c/(a-1))*10;f>1&&(f=1);let h=Math.sqrt(i*i+s*s);h<1e-6?(i=0,s=0):(i/=h,s/=h,i*=l,s*=l),o[d]=u.x+i,o[d+1]=u.y+s,o[d+2]=u.x-i,o[d+3]=u.y-s,t=u}this.buffers[0].update()}update(){this.textureScale>0?this._build():this.updateVertices()}};GL.defaultOptions={width:200,points:[],textureScale:0};var yx=GL;var zL=class HL extends Tn{constructor(e){let{texture:t,points:r,textureScale:i,...s}={...HL.defaultOptions,...e},o=new yx(Un({width:t.height,points:r,textureScale:i}));i>0&&(t.source.style.addressMode="repeat"),super(Un({...s,texture:t,geometry:o})),this.autoUpdate=!0,this.onRender=this._render}_render(){let e=this.geometry;(this.autoUpdate||e._width!==this.texture.height)&&(e._width=this.texture.height,e.update())}};zL.defaultOptions={textureScale:0};var xx=zL;Oc();Da();var bx=class extends Tn{constructor(e){let{texture:t,vertices:r,uvs:i,indices:s,topology:o,...a}=e,l=new en(Un({positions:r,uvs:i,indices:s,topology:o}));super(Un({...a,texture:t,geometry:l})),this.autoUpdate=!0,this.onRender=this._render}get vertices(){return this.geometry.getBuffer("aPosition").data}set vertices(e){this.geometry.getBuffer("aPosition").data=e}_render(){this.autoUpdate&&this.geometry.getBuffer("aPosition").update()}};function WL(n,e){let{width:t,height:r}=n.frame;return e.scale(1/t,1/r),e}nn();_t();l7();b7();var VL=class yk{constructor(e){if(e instanceof re)this.texture=e,zc(this,yk.defaultOptions,{});else{let t={...yk.defaultOptions,...e};zc(this,t,{})}}get alpha(){return this._alpha}set alpha(e){this._alpha=Math.min(Math.max(e,0),1),this._updateColor()}get tint(){return ba(this._tint)}set tint(e){typeof e=="number"?this._tint=e:this._tint=ce.shared.setValue(e??16777215).toBgrNumber(),this._updateColor()}_updateColor(){this.color=this._tint+((this._alpha*255|0)<<24)}};VL.defaultOptions={anchorX:0,anchorY:0,x:0,y:0,scaleX:1,scaleY:1,rotation:0,tint:16777215,alpha:1};var jL=VL;Ln();ko();var Z3={vertex:{attributeName:"aVertex",format:"float32x2",code:`
            const texture = p.texture;
            const sx = p.scaleX;
            const sy = p.scaleY;
            const ax = p.anchorX;
            const ay = p.anchorY;
            const trim = texture.trim;
            const orig = texture.orig;

            if (trim)
            {
                w1 = trim.x - (ax * orig.width);
                w0 = w1 + trim.width;

                h1 = trim.y - (ay * orig.height);
                h0 = h1 + trim.height;
            }
            else
            {
                w1 = -ax * (orig.width);
                w0 = w1 + orig.width;

                h1 = -ay * (orig.height);
                h0 = h1 + orig.height;
            }

            f32v[offset] = w1 * sx;
            f32v[offset + 1] = h1 * sy;

            f32v[offset + stride] = w0 * sx;
            f32v[offset + stride + 1] = h1 * sy;

            f32v[offset + (stride * 2)] = w0 * sx;
            f32v[offset + (stride * 2) + 1] = h0 * sy;

            f32v[offset + (stride * 3)] = w1 * sx;
            f32v[offset + (stride * 3) + 1] = h0 * sy;
        `,dynamic:!1},position:{attributeName:"aPosition",format:"float32x2",code:`
            var x = p.x;
            var y = p.y;

            f32v[offset] = x;
            f32v[offset + 1] = y;

            f32v[offset + stride] = x;
            f32v[offset + stride + 1] = y;

            f32v[offset + (stride * 2)] = x;
            f32v[offset + (stride * 2) + 1] = y;

            f32v[offset + (stride * 3)] = x;
            f32v[offset + (stride * 3) + 1] = y;
        `,dynamic:!0},rotation:{attributeName:"aRotation",format:"float32",code:`
            var rotation = p.rotation;

            f32v[offset] = rotation;
            f32v[offset + stride] = rotation;
            f32v[offset + (stride * 2)] = rotation;
            f32v[offset + (stride * 3)] = rotation;
        `,dynamic:!1},uvs:{attributeName:"aUV",format:"float32x2",code:`
            var uvs = p.texture.uvs;

            f32v[offset] = uvs.x0;
            f32v[offset + 1] = uvs.y0;

            f32v[offset + stride] = uvs.x1;
            f32v[offset + stride + 1] = uvs.y1;

            f32v[offset + (stride * 2)] = uvs.x2;
            f32v[offset + (stride * 2) + 1] = uvs.y2;

            f32v[offset + (stride * 3)] = uvs.x3;
            f32v[offset + (stride * 3) + 1] = uvs.y3;
        `,dynamic:!1},color:{attributeName:"aColor",format:"unorm8x4",code:`
            const c = p.color;

            u32v[offset] = c;
            u32v[offset + stride] = c;
            u32v[offset + (stride * 2)] = c;
            u32v[offset + (stride * 3)] = c;
        `,dynamic:!1}};var yJ=new Nt(0,0,0,0),XL=class xk extends Zr{constructor(e={}){e={...xk.defaultOptions,...e,dynamicProperties:{...xk.defaultOptions.dynamicProperties,...e?.dynamicProperties}};let{dynamicProperties:t,shader:r,roundPixels:i,texture:s,particles:o,...a}=e;super({label:"ParticleContainer",...a}),this.renderPipeId="particle",this.batched=!1,this._childrenDirty=!1,this.texture=s||null,this.shader=r,this._properties={};for(let l in Z3){let c=Z3[l],u=t[l];this._properties[l]={...c,dynamic:u}}this.allowChildren=!0,this.roundPixels=i??!1,this.particleChildren=o??[]}addParticle(...e){for(let t=0;t<e.length;t++)this.particleChildren.push(e[t]);return this.onViewUpdate(),e[0]}removeParticle(...e){let t=!1;for(let r=0;r<e.length;r++){let i=this.particleChildren.indexOf(e[r]);i>-1&&(this.particleChildren.splice(i,1),t=!0)}return t&&this.onViewUpdate(),e[0]}update(){this._childrenDirty=!0}onViewUpdate(){this._childrenDirty=!0,super.onViewUpdate()}get bounds(){return yJ}updateBounds(){}destroy(e=!1){if(super.destroy(e),typeof e=="boolean"?e:e?.texture){let r=typeof e=="boolean"?e:e?.textureSource,i=this.texture??this.particleChildren[0]?.texture;i&&i.destroy(r)}this.texture=null,this.shader?.destroy()}removeParticles(e,t){let r=this.particleChildren.splice(e,t);return this.onViewUpdate(),r}removeParticleAt(e){let t=this.particleChildren.splice(e,1);return this.onViewUpdate(),t[0]}addParticleAt(e,t){return this.particleChildren.splice(t,0,e),this.onViewUpdate(),e}addChild(...e){throw new Error("ParticleContainer.addChild() is not available. Please use ParticleContainer.addParticle()")}removeChild(...e){throw new Error("ParticleContainer.removeChild() is not available. Please use ParticleContainer.removeParticle()")}removeChildren(e,t){throw new Error("ParticleContainer.removeChildren() is not available. Please use ParticleContainer.removeParticles()")}removeChildAt(e){throw new Error("ParticleContainer.removeChildAt() is not available. Please use ParticleContainer.removeParticleAt()")}getChildAt(e){throw new Error("ParticleContainer.getChildAt() is not available. Please use ParticleContainer.getParticleAt()")}setChildIndex(e,t){throw new Error("ParticleContainer.setChildIndex() is not available. Please use ParticleContainer.setParticleIndex()")}getChildIndex(e){throw new Error("ParticleContainer.getChildIndex() is not available. Please use ParticleContainer.getParticleIndex()")}addChildAt(e,t){throw new Error("ParticleContainer.addChildAt() is not available. Please use ParticleContainer.addParticleAt()")}swapChildren(e,t){throw new Error("ParticleContainer.swapChildren() is not available. Please use ParticleContainer.swapParticles()")}reparentChild(...e){throw new Error("ParticleContainer.reparentChild() is not available with the particle container")}reparentChildAt(e,t){throw new Error("ParticleContainer.reparentChildAt() is not available with the particle container")}};XL.defaultOptions={dynamicProperties:{vertex:!1,position:!0,rotation:!1,uvs:!1,color:!1},roundPixels:!1};var qL=XL;_t();zt();ko();P8();var YL=class KL extends Zr{constructor(e){e instanceof re&&(e={texture:e});let{width:t,height:r,leftWidth:i,rightWidth:s,topHeight:o,bottomHeight:a,texture:l,roundPixels:c,...u}=e;super({label:"NineSliceSprite",...u}),this.renderPipeId="nineSliceSprite",this.batched=!0,this._leftWidth=i??l?.defaultBorders?.left??eo.defaultOptions.leftWidth,this._topHeight=o??l?.defaultBorders?.top??eo.defaultOptions.topHeight,this._rightWidth=s??l?.defaultBorders?.right??eo.defaultOptions.rightWidth,this._bottomHeight=a??l?.defaultBorders?.bottom??eo.defaultOptions.bottomHeight,this.bounds.maxX=this._width=t??l.width??eo.defaultOptions.width,this.bounds.maxY=this._height=r??l.height??eo.defaultOptions.height,this.allowChildren=!1,this.texture=l??KL.defaultOptions.texture,this.roundPixels=c??!1}updateBounds(){}get width(){return this._width}set width(e){this.bounds.maxX=this._width=e,this.onViewUpdate()}get height(){return this._height}set height(e){this.bounds.maxY=this._height=e,this.onViewUpdate()}setSize(e,t){typeof e=="object"&&(t=e.height??e.width,e=e.width),this.bounds.maxX=this._width=e,this.bounds.maxY=this._height=t??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}get leftWidth(){return this._leftWidth}set leftWidth(e){this._leftWidth=e,this.onViewUpdate()}get topHeight(){return this._topHeight}set topHeight(e){this._topHeight=e,this.onViewUpdate()}get rightWidth(){return this._rightWidth}set rightWidth(e){this._rightWidth=e,this.onViewUpdate()}get bottomHeight(){return this._bottomHeight}set bottomHeight(e){this._bottomHeight=e,this.onViewUpdate()}get texture(){return this._texture}set texture(e){e||(e=re.EMPTY);let t=this._texture;t!==e&&(t&&t.dynamic&&t.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get originalWidth(){return this._texture.width}get originalHeight(){return this._texture.height}destroy(e){if(super.destroy(e),typeof e=="boolean"?e:e?.texture){let r=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(r)}this._texture=null}};YL.defaultOptions={texture:re.EMPTY};var bk=YL,_x=class extends bk{constructor(...e){let t=e[0];t instanceof re&&(oe(Ie,"NineSlicePlane now uses the options object {texture, leftWidth, rightWidth, topHeight, bottomHeight}"),t={texture:t,leftWidth:e[1],topHeight:e[2],rightWidth:e[3],bottomHeight:e[4]}),oe(Ie,"NineSlicePlane is deprecated. Use NineSliceSprite instead."),super(t)}};P4();Ia();function QL(n,e){return e instanceof dr||e instanceof Js?e:n==="html"?new Js(e):new dr(e)}async function ZL(n,e,t=200){let r=await e.extract.base64(n);await e.encoder.commandFinished;let i=t;console.log(`logging texture ${n.source.width}px ${n.source.height}px`);let s=["font-size: 1px;",`padding: ${i}px 300px;`,`background: url(${r}) no-repeat;`,"background-size: contain;"].join(" ");console.log("%c ",s)}xl();var xJ=["#000080","#228B22","#8B0000","#4169E1","#008080","#800000","#9400D3","#FF8C00","#556B2F","#8B008B"],bJ=0;function _k(n,e=0,t={color:"#000000"}){n.renderGroup&&(t.color=xJ[bJ++]);let r="";for(let o=0;o<e;o++)r+="    ";let i=n.label;!i&&n instanceof At&&(i=`sprite:${n.texture.label}`);let s=`%c ${r}|- ${i} (worldX:${n.worldTransform.tx}, relativeRenderX:${n.relativeGroupTransform.tx}, renderX:${n.groupTransform.tx}, localX:${n.x})`;n.renderGroup&&(s+=" (RenderGroup)"),n.filters&&(s+="(*filters)"),console.log(s,`color:${t.color}; font-weight:bold;`),e++;for(let o=0;o<n.children.length;o++){let a=n.children[o];_k(a,e,{...t})}}function vk(n,e=0,t={index:0,color:"#000000"}){let r="";for(let s=0;s<e;s++)r+="    ";let i=`%c ${r}- ${t.index}: ${n.root.label} worldX:${n.worldTransform.tx}`;console.log(i,`color:${t.color}; font-weight:bold;`),e++;for(let s=0;s<n.renderGroupChildren.length;s++){let o=n.renderGroupChildren[s];vk(o,e,{...t,index:s})}}Dw();Mw();Rw();Bw();Io();Xi();yl();q2();D7();Hw();Kh();nn();aw();Vt();NA();zw();Lw();T7();C7();Vh();$w();Xh();A7();E7();YA();KA();QA();Fo();Lh();TA();PA();ZA();g7();Ct();Ym();$2();$9();Bc();vi();kC();IC();PC();Qr();DC();KE();nS();wl();r4();UA();aS();qA();uS();sS();g9();zS();Aa();BS();kS();PS();DS();MS();RS();NS();n0();i0();OS();xu();Ea();H8();Xw();eE();qw();tE();dw();Yw();rE();e4();t4();QE();ZE();JE();Su();tT();iT();nT();oT();aT();lT();hT();cT();fT();pT();mT();gT();d4();Ci();yT();AT();kT();xT();Og();xg();_T();CT();fS();G7();vT();wT();ST();Gg();hS();pS();mS();gS();yS();Mg();dT();uT();TT();ET();DT();IT();kg();MT();$T();RT();FT();ey();BT();OT();LT();UT();GT();NT();BN();zT();wE();SE();DE();CE();AE();EE();TE();PE();ME();RE();FE();NE();OE();LE();Ca();qi();UE();dg();IE();vS();wS();kE();CS();AS();ES();GE();$E();bg();jE();zE();HE();Ag();WE();VE();XE();iE();sE();Po();l3();qs();H7();lE();uE();Al();y9();lS();El();cS();x9();h7();dE();BE();og();wg();fE();SS();bs();GS();cg();Hr();hg();$S();mg();fg();pE();Cl();Z2();Ki();L0();lg();L8();fu();yE();cE();y7();Zc();Jc();cn();O7();_t();bE();x7();Ws();p7();ag();rS();t0();vE();Yi();mC();gC();yC();Ln();kA();Nc();Gh();IA();ll();cw();uw();fw();hw();l7();yw();xw();bw();_w();Vi();GA();Sw();$A();VA();b7();r3();gw();X8();Oc();V8();o7();s7();HA();WA();qE();ou();OA();b9();W9();BC();j9();NC();UC();w9();WS();VS();M9();R9();F9();mB();v4();w4();r8();pu();g4();aC();A4();GC();$C();zC();TC();QS();Z9();HS();D9();M4();YE();LA();y4();Da();cC();dC();_C();bC();vC();pC();L9();xC();fC();hC();P8();AA();mA();xA();SA();vA();bA();_A();wA();_0();xl();jA();a8();I4();tA();JC();c8();l8();nA();p8();P4();hA();oA();cA();uA();dA();aA();lA();fA();w8();sA();T4();SC();jC();E4();t8();ZC();qC();YC();Ia();J9();e8();ko();Vw();jw();jc();ml();Fw();B7();Pw();iA();O8();CC();K8();Nn();mE();Jm();_n();Jh();z7();Q8();zt();Gt();ww();gl();Qm();On();hE();var JL=Ot(KS(),1);ke.add(MA,RA);var Nr=class extends st{constructor(e){super(),this.context=e,this.id="",this._enabled=!1}enable(){this._enabled||(this._enabled=!0)}disable(){this._enabled&&(this._enabled=!1)}get enabled(){return this._enabled}_getEventData(e){let t={screen:[e.global.x,e.global.y],map:[e.global.x,e.global.y]},i=this.context.viewport,s=i.transform.r;s&&(t.map=lr(t.screen,-s,i.center()));let o={id:e.pointerId??e.pointerType??"unknown",event:e,originalEvent:e.originalEvent,coord:t,time:e.timeStamp,isCancelled:!1,target:null};if(!e.target)return o;let a=e.target;for(;a;){let l=a.__feature__;if(l)return o.target={displayObject:a,feature:l,featureID:l.id,layer:l.layer,layerID:l.layer.id,data:l.data,dataID:l.dataID},o;if(a.parent)a=a.parent;else return o.target={displayObject:e.target,feature:null,featureID:null,layer:null,layerID:null,data:null,dataID:null},o}}};var _J=1,vJ=4,J3=class extends Nr{constructor(e){super(e),this.id="drag",this.dragTarget=null,this.lastDown=null,this.lastMove=null,this._doMove=this._doMove.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.lastMove=null,this.dragTarget=null;let e=this.context.systems.gfx.events;e.on("modifierchange",this._doMove),e.on("pointerover",this._doMove),e.on("pointerout",this._doMove),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;let e=this.lastMove,t=this.dragTarget;e&&t&&(t.feature.allowInteraction=!0,this.dragTarget=null,this.emit("cancel",e)),this._enabled=!1,this.lastDown=null,this.lastMove=null,this.dragTarget=null;let r=this.context.systems.gfx.events;r.off("modifierchange",this._doMove),r.off("pointerover",this._doMove),r.off("pointerout",this._doMove),r.off("pointerdown",this._pointerdown),r.off("pointermove",this._pointermove),r.off("pointerup",this._pointerup),r.off("pointercancel",this._pointercancel)}_pointerdown(e){if(this.lastDown||e.pointerType==="mouse"&&e.button!==0)return;let t=this._getEventData(e),r=t.target,i=r?.data;if(!i)return;let s=i instanceof Qe&&i.isNew()&&r.layerID==="notes",o=i instanceof Le&&r.layerID==="osm",a=i.type==="midpoint"&&r.layerID==="osm";(s||o||a)&&(this.lastDown=t,this.lastMove=null,this.dragTarget=null)}_pointermove(e){let t=this.context,r=t.systems.editor,i=t.systems.gfx,s=r.staging.graph;if(H(i.overlay).select(".edit-menu").size()){this._pointercancel(e);return}if(!i.events.pointerOverRenderer)return;let l=this.lastDown,c=this._getEventData(e);if(!(!l||l.id!==c.id)){if(this.lastMove=c,this.dragTarget)this._doMove();else if(l.target){let u=Ne(l.coord.screen,c.coord.screen),d=e.pointerType==="pen"?vJ:_J;if(u>=d){let f=Object.assign({},l.target);this.dragTarget=f,f.feature.allowInteraction=!1;let h=f.data,p=h instanceof Qe,m=h instanceof Le,g=h.type==="midpoint",y=[];g?y=[h.way]:m&&(y=s.parentWays(h));let x=new Set;for(let C of y){x.add(C.id);for(let k of s.parentRelations(C))x.add(k.id)}let b=t.selectedIDs(),S=b.some(C=>x.has(C))?b.slice():[];if(m)t.enter("drag-node",{nodeID:h.id,reselectIDs:S});else if(p)t.enter("drag-note",{noteID:h.id});else if(g){let C={loc:h.loc,edge:[h.a.id,h.b.id]};t.enter("drag-node",{midpoint:C,reselectIDs:S})}this.emit("start",l)}}}}_pointerup(e){let t=this.lastDown,r=this._getEventData(e);if(!t||t.id!==r.id)return;this.dragTarget&&(this._snappingDisabled()?r.target=null:r.target=Object.assign({},r.target)),this.lastDown=null,this.lastMove=null;let i=this.dragTarget;i&&(i.feature.allowInteraction=!0,this.dragTarget=null,this.emit("end",r))}_pointercancel(e){let t=this._getEventData(e);this.lastDown=null,this.lastMove=null;let r=this.dragTarget;r&&(r.feature.allowInteraction=!0,this.dragTarget=null,this.emit("cancel",t))}_snappingDisabled(){let e=this.context.systems.gfx.events;if(!e.pointerOverRenderer)return!1;let t=e.modifierKeys,r=Et().os==="mac";return t.has("Alt")||t.has("Meta")||!r&&t.has("Control")}_doMove(){if(!this._enabled||!this.lastMove)return;let e=Object.assign({},this.lastMove);this._snappingDisabled()&&(e.target=null),this.emit("move",e)}};var eU=4,tU=12,ep=class extends Nr{constructor(e){super(e),this.id="draw",this._spaceClickDisabled=!1,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._doClick=this._doClick.bind(this),this._doMove=this._doMove.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._spaceClickDisabled=!1;let e=this.context.systems.gfx.events;e.on("keydown",this._keydown),e.on("keyup",this._keyup),e.on("modifierchange",this._doMove),e.on("pointerover",this._doMove),e.on("pointerout",this._doMove),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this.lastDown=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._spaceClickDisabled=!1;let e=this.context.systems.gfx.events;e.off("keydown",this._keydown),e.off("keyup",this._keyup),e.off("modifierchange",this._doMove),e.off("pointerover",this._doMove),e.off("pointerout",this._doMove),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel)}_keydown(e){["Enter","Escape","Esc"].includes(e.key)?(e.preventDefault(),this.emit("finish")):["Backspace","Delete","Del"].includes(e.key)?(e.preventDefault(),this.emit("cancel")):!this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spacebar())}_keyup(e){this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spaceClickDisabled=!1)}_pointerdown(e){if(this.lastDown)return;let t=this._getEventData(e);this.lastDown=t,this.lastClick=null,this.emit("down",t)}_pointermove(e){let t=this._getEventData(e);this.lastMove=t,this._spaceClickDisabled&&this.lastSpace&&Ne(t.coord.screen,this.lastSpace.coord.screen)>tU&&(this._spaceClickDisabled=!1);let r=this.lastDown;r&&!r.isCancelled&&r.id===t.id&&Ne(r.coord.screen,t.coord.screen)>=eU&&(r.isCancelled=!0),this._doMove()}_pointerup(e){let t=this.lastDown,r=this._getEventData(e);if(!t||t.id!==r.id||(this.lastDown=null,t.isCancelled))return;let i=Ne(t.coord.screen,r.coord.screen);(i<eU||i<tU&&r.time-t.time<500)&&(this.lastClick=r,this._doClick())}_pointercancel(){this.lastDown=null}_spacebar(){this._spaceClickDisabled||this.lastMove&&(this._spaceClickDisabled=!0,this.lastSpace=this.lastMove,this.lastClick=this.lastMove,this._doClick())}_doMove(){if(!this._enabled||!this.lastMove)return;let t=this.context.systems.gfx.events;if(!t.pointerOverRenderer)return;let r=t.modifierKeys,i=Et().os==="mac",s=r.has("Alt")||r.has("Meta")||!i&&r.has("Control"),o=Object.assign({},this.lastMove);(s||!1)&&(o.target=null),this.emit("move",o)}_doClick(){if(!this._enabled||!this.lastClick)return;let r=this.context.systems.gfx.events.modifierKeys,i=Et().os==="mac",s=r.has("Alt")||r.has("Meta")||!i&&r.has("Control"),o=Object.assign({},this.lastClick);(s||!1)&&(o.target=null),this.emit("click",o)}};var tp=class extends Nr{constructor(e){super(e),this.id="hover",this.lastMove=null,this.hoverTarget=null,this._doHover=this._doHover.bind(this),this._pointermove=this._pointermove.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastMove=null,this.hoverTarget=null;let e=this.context.systems.gfx.events;e.on("modifierchange",this._doHover),e.on("pointerover",this._doHover),e.on("pointerout",this._doHover),e.on("pointermove",this._pointermove)}disable(){if(!this._enabled)return;let e=this.lastMove;this.hoverTarget&&e&&(e.target=null,this._doHover()),this._enabled=!1,this.lastMove=null,this.hoverTarget=null;let t=this.context.systems.gfx.events;t.off("modifierchange",this._doHover),t.off("pointerover",this._doHover),t.off("pointerout",this._doHover),t.off("pointermove",this._pointermove)}_pointermove(e){this._enabled&&(this.lastMove=this._getEventData(e),this._doHover())}_doHover(){if(!this._enabled||!this.lastMove||this.context.behaviors.mapInteraction.gesture)return;let r=this.context.systems.gfx.events,i=r.modifierKeys,s=Et().os==="mac",o=i.has("Alt")||i.has("Meta")||!s&&i.has("Control"),a=Object.assign({},this.lastMove);(o||!1||!r.pointerOverRenderer)&&(a.target=null);let c=this.hoverTarget?.featureID||null,u=a?.target?.featureID||null;c!==u&&(this.hoverTarget=Object.assign({},a.target),this.emit("hoverchange",a))}};var Pt=class extends Nr{constructor(e,t){super(e),this.id=`key-${t.id}`,this._operation=t,window.mocha||(this._keybinding=this.context.keybinding()),this._keydown=this._keydown.bind(this)}enable(){if(this._enabled)return;let e=this._operation;e.available()&&e.keys&&(this._keybinding.on(e.keys,this._keydown),this._enabled=!0)}disable(){if(!this._enabled)return;this._enabled=!1;let e=this._operation;e.keys&&this._keybinding.off(e.keys)}_keydown(e){let t=this.context,r=this._operation,i=t.systems.ui;if(r.availableForKeypress&&!r.availableForKeypress())return;e.preventDefault(),r.disabled()?i.Flash.duration(4e3).iconName(`#rapid-operation-${r.id}`).iconClass("operation disabled").label(r.tooltip)():(i.Flash.duration(2e3).iconName(`#rapid-operation-${r.id}`).iconClass("operation").label(r.annotation()||r.title)(),r.point&&r.point(null),r())}};var rp=class extends Nr{constructor(e){super(e),this.id="lasso",this._lassoing=!1,this._extent=null,this._coords=[],this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this._lassoing=!1,this._extent=null;let e=this.context.systems.gfx.events;e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup)}disable(){if(!this._enabled)return;this._enabled=!1,this._lassoing=!1,this._extent=null;let e=this.context.systems.gfx.events;e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup)}_pointerdown(){let e=this.context,t=e.systems.gfx,r=e.systems.map,i=t.events;if(!i.pointerOverRenderer)return;if(i.modifierKeys.has("Shift")){this._lassoing=!0;let a=r.mouseLoc();this._extent=new le(a),this._coords.push(a)}}_pointermove(){if(!this._lassoing)return;let e=this.context,t=e.systems.gfx,r=e.systems.map;if(!t.events.pointerOverRenderer)return;let s=r.mouseLoc();this._extent=this._extent.extend(new le(s)),this._coords.push(s);let o=t.scene.layers.get("map-ui");o.lassoData=this._coords,t.immediateRedraw()}_pointerup(){if(!this._lassoing)return;this._lassoing=!1;let r=this.context.systems.gfx.scene.layers.get("map-ui"),i=this._lassoed();this._coords=[],r.lassoData=null,this._extent=null,i.length&&this.context.enter("select-osm",{selection:{osm:i}})}_normalize(e,t){return[[Math.min(e[0],t[0]),Math.min(e[1],t[1])],[Math.max(e[0],t[0]),Math.max(e[1],t[1])]]}_lassoed(){let e=this.context,t=e.systems.editor,r=e.systems.locations,i=e.systems.filters,s=t.staging.graph;if(!this.context.editable())return[];let o=this._coords,a=t.intersects(this._extent).filter(l=>l.type==="node"&&c2(l.loc,o)&&!i.isHidden(l,s,l.geometry(s))&&!r.blocksAt(l.loc).length);return a.sort(function(l,c){let u=s.parentWays(l),d=s.parentWays(c);if(u.length&&d.length){let f=bn(u,d);if(f.length){let h=f[0].nodes;return h.indexOf(l.id)-h.indexOf(c.id)}else return parseFloat(u[0].id.slice(1))-parseFloat(d[0].id.slice(1))}else if(u.length||d.length)return u.length-d.length;return l.loc[0]-c.loc[0]}),a.map(l=>l.id)}};var wJ=1,SJ=4,wk=2,Sk=24,CJ=.01,np=class extends Nr{constructor(e){super(e),this.id="mapInteraction",this.lastDown=null,this.gesture=null,this.doubleClickEnabled=!0,this._lastPoint=null,this._lastAngle=null,this.activeTouches={},this._initialPinchDistance=null,this._initialScale=null,this.previousMode=this.context.mode?.id,this._click=this._click.bind(this),this._keydown=this._keydown.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._wheel=this._wheel.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.lastDown=null,this.gesture=null,this._lastPoint=null,this._lastAngle=null;let e=this.context.systems.gfx.events;e.on("click",this._click),e.on("keydown",this._keydown),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel),e.on("wheel",this._wheel)}disable(){if(!this._enabled)return;this._enabled=!1,this.lastDown=null,this.gesture=null,this._lastPoint=null,this._lastAngle=null;let e=this.context.systems.gfx.events;e.off("click",this._click),e.off("keydown",this._keydown),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel),e.off("wheel",this._wheel)}_keydown(e){let t=document.activeElement?.tagName??"BODY";if(!["BODY","BUTTON"].includes(t)||document.activeElement?.classList?.contains("preset-list-button"))return;let r=this.context,i=r.systems.map,s=r.viewport,o=100;if(!r.services.mapillary.viewerShowing&&r.mode?.id!=="select-osm")if(e.shiftKey){let a=2.5*Mn,l=s.transform.props,c;e.key==="ArrowLeft"?c=-a:e.key==="ArrowRight"&&(c=a),c&&(e.preventDefault(),i.transformEase({x:l.x,y:l.y,k:l.k,r:l.r+c},o))}else{let[l,c]=s.dimensions,u=e.altKey||e.metaKey||e.ctrlKey,d;e.key==="ArrowLeft"?d=u?[l/2,0]:[80,0]:e.key==="ArrowRight"?d=u?[-l/2,0]:[-80,0]:e.key==="ArrowUp"?d=u?[0,c/2]:[0,80]:e.key==="ArrowDown"&&(d=u?[0,-c/2]:[0,-80]),d&&(e.preventDefault(),i.pan(d,o))}}_click(e){if(!this.doubleClickEnabled||e.detail!==2||e.pointerType==="mouse"&&e.button!==0)return;let t=this.context,r=t.systems.map,s=t.viewport.transform.props,o=this._getEventData(e),[a,l]=o.coord.map,c=e.getModifierState("Shift"),u=[(a-s.x)/s.k,(l-s.y)/s.k],d=s.k*(c?.5:2);d=dt(d,Z6,J6);let f=a-u[0]*d,h=l-u[1]*d;r.transformEase({x:f,y:h,k:d,r:s.r})}_pointerdown(e){if(this._isPaneOpen())return;let t=this.context.mode.id;if(this.previousMode!==t&&(this._resetTouchStates(),this.previousMode=t),this.activeTouches[e.pointerId]={x:e.global.x,y:e.global.y,clientX:e.clientX,clientY:e.clientY},Object.keys(this.activeTouches).length===2){this._initialPinchDistance||(this._initialPinchDistance=this._getDistanceBetweenTouches());let l=Object.values(this.activeTouches);this._initialAngle=Math.atan2(l[1].clientY-l[0].clientY,l[1].clientX-l[0].clientX)}this._updatePinchState();let r=this.context,i=r.systems.gfx.events;if(i.modifierKeys.has("Shift"))return;let s=this._getEventData(e);if(s.target?.data instanceof Le&&s.target?.layerID==="osm"&&e.pointerType==="mouse"&&e.button===0)return;this.lastDown=s,this.gesture=null,this._lastPoint=null,this._lastAngle=null;let a=r.mode.id;a==="draw-area"||a==="draw-line"?i.setCursor("crosshair"):i.setCursor("grabbing")}_pointermove(e){if(this._isPaneOpen())return;let t=this.context,r=t.systems.gfx,i=t.systems.map,s=r.events,o=t.viewport;if(this.activeTouches[e.pointerId]={x:e.global.x,y:e.global.y,clientX:e.clientX,clientY:e.clientY},Object.keys(this.activeTouches).length===2){let d=Object.values(this.activeTouches),f=this._getDistanceBetweenTouches(),h=Math.atan2(d[1].clientY-d[0].clientY,d[1].clientX-d[0].clientX),p=h-this._initialAngle,m=f/this._initialPinchDistance,g=o.transform.zoom,y=g>16?.25:g/16*.1+.25,x=1+(m-1)*y,b=g*x,_=Math.max(wk,Math.min(b,Sk));if(i.zoom(_),this._initialPinchDistance=f,this._initialAngle=h,Math.abs(p)>CJ){let S=o.transform.props;i.transform({x:S.x,y:S.y,k:S.k,r:S.r+p})}}let a=this.lastDown,l=this._getEventData(e);if(!a||a.id!==l.id)return;let c=[l.originalEvent.clientX,l.originalEvent.clientY],u=o.transform.props;if(!this.gesture){let d=Ne(a.coord.screen,l.coord.screen),f=a.originalEvent.pointerType==="pen"?SJ:wJ;if(this._lastPoint=c,this._lastAngle=u.r,d>=f){let h=s.modifierKeys;this.gesture=h.has("Alt")||h.has("Control")?"rotate":"pan"}}if(this.gesture){let[d,f]=Me(c,this._lastPoint);if(this._lastPoint=c,this.gesture==="pan")i.pan([d,f]);else if(this.gesture==="rotate"){let h=l.coord.screen,p=o.center(),[m,g]=[h[0]>p[0]?1:-1,h[1]>p[1]?-1:1],y=g*d+m*f,b=this._lastAngle+y*Mn*.3;this._lastAngle=b,i.transform({x:u.x,y:u.y,k:u.k,r:b})}}}_pointerup(e){delete this.activeTouches[e.pointerId],Object.keys(this.activeTouches).length===0&&(this._initialPinchDistance=null,this._initialAngle=null),this._updatePinchState(),this.lastDown=null,this.gesture=null,this._lastPoint=null,this._lastAngle=null;let t=this.context.systems.gfx.events,r=this.context.mode.id;r==="draw-area"||r==="draw-line"?t.setCursor("crosshair"):t.setCursor("grab")}_pointercancel(e){delete this.activeTouches[e.pointerId],Object.keys(this.activeTouches).length===0&&(this._initialPinchDistance=null,this._initialAngle=null),this._updatePinchState(),Object.keys(this.activeTouches).length===0&&(this.lastDown=null,this.gesture=null,this._lastPoint=null,this._lastAngle=null)}_pinchStart(e){let t=this._getDistanceBetweenTouches(e);this._initialPinchDistance=t,this._initialScale=this.context.viewport.transform.scale}_pinchMove(e){if(this._initialPinchDistance){let t=this.context.viewport.transform.zoom,r=Math.max(wk,Math.min(t,Sk));this.context.systems.map.zoom(r)}}_pinchEnd(e){this._initialPinchDistance=null,this._initialScale=null}_getDistanceBetweenTouches(){let e=Object.values(this.activeTouches);if(e.length===2){let[t,r]=e;return Math.hypot(t.clientX-r.clientX,t.clientY-r.clientY)}return 0}_wheel(e){let t=this.context,r=t.systems.map,[i,s]=[e._normalizedDeltaX,e._normalizedDeltaY];if(e._gesture==="zoom"){let a=t.viewport.transform.props,[l,c]=e._coord.map,u=(l-a.x)/a.k,d=(c-a.y)/a.k,f=a.k*Math.pow(2,-s/500);f=dt(f,Z6,J6);let h=l-u*f,p=c-d*f;r.transform({x:h,y:p,k:f,r:a.r})}else r.pan([-i,-s])}_updatePinchState(){let e=Object.values(this.activeTouches);if(e.length===2){let[t,r]=e,i=Math.hypot(t.x-r.x,t.y-r.y),s=this.context.viewport.transform.zoom,o=Math.max(wk,Math.min(s,Sk));this.context.systems.map.zoom(o),this._initialPinchDistance=i}}_resetTouchStates(){this.activeTouches={},this._initialPinchDistance=null,this._initialAngle=null,this.gesture=null}_isPaneOpen(){return/Mobi|Android/i.test(navigator.userAgent)?this.context.container().select(".map-panes").selectAll(".issues-pane.shown, .map-data-pane.shown, .preferences-pane.shown, .background-pane.shown, .help-pane.shown").size()>0:!1}};var AJ=16,ip=class extends Nr{constructor(e){super(e),this.id="mapNudge",this._nudge=[0,0],this._intervalID=null,this._doNudge=this._doNudge.bind(this),this._pointermove=this._pointermove.bind(this)}enable(){if(this._enabled)return;this._nudge=[0,0],this.context.systems.gfx.events.on("pointermove",this._pointermove),this._intervalID||(this._intervalID=window.setInterval(this._doNudge,AJ))}allow(){this._enabled=!0}disable(){this._enabled=!1,this.context.systems.gfx.events.off("pointermove",this._pointermove),this._intervalID&&(window.clearInterval(this._intervalID),this._intervalID=null)}_pointermove(e){if(!this._enabled)return;let t=this.context,r=this._getEventData(e),[i,s]=r.coord.screen,[o,a]=t.viewport.dimensions,l=130,c=o-70,u=a-100,d=70;if(c<=d||u<=l){this._nudge=[0,0];return}let[f,h]=[0,0];(s<l||s>u||i<d||i>c)&&(f=dt(-2*(i-d)/(c-d)+1,-1,1),h=dt(-2*(s-l)/(u-l)+1,-1,1));let p=3;this._nudge=yi([f,h],p)}_doNudge(){if(!this._enabled)return;let e=this.context.systems.map;(this._nudge[0]||this._nudge[1])&&(e.pan(this._nudge),this.emit("nudge",this._nudge))}};var sp=class extends Nr{constructor(e){super(e),this.id="paste",this._isMacOS=Et().os==="mac",this._keydown=this._keydown.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this.context.systems.gfx.events.on("keydown",this._keydown)}disable(){if(!this._enabled)return;this._enabled=!1,this.context.systems.gfx.events.off("keydown",this._keydown)}_keydown(e){let t=this._isMacOS;(t&&e.metaKey||!t&&e.ctrlKey)&&e.key==="v"&&this._doPaste(e)}_doPaste(e){let t=this.context,r=t.systems.editor,i=t.systems.gfx,s=t.systems.l10n,o=t.systems.map,a=t.copyGraph,l=t.copyIDs;if(!l.length||!t.scene().layers.get("osm")?.enabled||!i.events.pointerOverRenderer)return;e.preventDefault(),e.stopPropagation();let d=y2(l,a);r.beginTransaction(),r.perform(d);let f=r.staging.graph,h=d.copies(),p=new Set;for(let C of Object.values(h))p.add(C.id);let m=new le,g=[];for(let[C,k]of Object.entries(h)){let v=a.entity(C);m=m.extend(v.extent(a)),f.parentWays(k).some(E=>p.has(E.id))||g.push(k.id)}let y=t.viewport,x=t.copyLoc,b=x&&y.project(x)||y.project(m.center()),_=Me(o.mouse(),b),S=s.t("operations.paste.annotation",{n:g.length});r.perform(Ao(g,_,y)),r.commit({annotation:S,selectedIDs:g}),r.endTransaction(),t.enter("move",{selection:{osm:g}})}};var Ck=4,rU=12,op=class extends Nr{constructor(e){super(e),this.id="select",this._multiSelection=new Set,this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this._showsMapRouletteMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._cancelLongPress=this._cancelLongPress.bind(this),this._doLongPress=this._doLongPress.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerup=this._pointerup.bind(this)}enable(){if(this._enabled)return;this._enabled=!0,this._multiSelection.clear(),this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this._showsMapRouletteMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null;let e=this.context.systems.gfx.events;e.on("keydown",this._keydown),e.on("keyup",this._keyup),e.on("pointerdown",this._pointerdown),e.on("pointermove",this._pointermove),e.on("pointerup",this._pointerup),e.on("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this._multiSelection.clear(),this._spaceClickDisabled=!1,this._longPressTimeout=null,this._showsMenu=!1,this._showsMapRouletteMenu=!1,this.lastDown=null,this.lastUp=null,this.lastMove=null,this.lastSpace=null,this.lastClick=null,this._cancelLongPress();let e=this.context.systems.gfx.events;e.off("keydown",this._keydown),e.off("keyup",this._keyup),e.off("pointerdown",this._pointerdown),e.off("pointermove",this._pointermove),e.off("pointerup",this._pointerup),e.off("pointercancel",this._pointercancel)}_keydown(e){this._cancelLongPress();let t=this.context;if(["Escape","Esc"].includes(e.key)){if(t.container().select(".combobox").size())return;e.preventDefault(),t.enter("browse");return}else if(e.key==="ContextMenu"){e.preventDefault(),this._doContextMenu();return}else if(!this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)){let r=document.activeElement;if(r&&new Set(["INPUT","TEXTAREA"]).has(r.nodeName))return;e.preventDefault(),e.stopPropagation(),this._spacebar()}}_keyup(e){this._spaceClickDisabled&&[" ","Spacebar"].includes(e.key)&&(e.preventDefault(),e.stopPropagation(),this._spaceClickDisabled=!1)}_pointerdown(e){if(this.lastDown)return;this.context.systems.ui.closeEditMenu(),this._showsMenu=!1,this.context.systems.ui.closeMapRouletteMenu(),this._showsMapRouletteMenu=!1;let t=this._getEventData(e);this.lastDown=t,this.lastClick=null,this._cancelLongPress(),e.pointerType==="touch"&&(this._longPressTimeout=window.setTimeout(this._doLongPress,750,t))}_pointermove(e){let t=this._getEventData(e);this.lastMove=t,this._spaceClickDisabled&&this.lastSpace&&Ne(t.coord.screen,this.lastSpace.coord.screen)>rU&&(this._spaceClickDisabled=!1);let r=this.lastDown;r&&!r.isCancelled&&r.id===t.id&&Ne(r.coord.screen,t.coord.screen)>=Ck&&(r.isCancelled=!0)}_pointerup(e){let t=this.lastDown,r=this._getEventData(e);if(!t||t.id!==r.id||(this.lastDown=null,t.isCancelled))return;let i=Ne(t.coord.screen,r.coord.screen),s=Ne(r.coord.screen,this.lastUp?this.lastUp.coord.screen:0);if(r.event.button===0&&this.lastUp?.target?.dataID&&s<Ck&&this.lastUp?.target?.dataID===r.target?.dataID&&r.time-(this.lastUp?this.lastUp.time:0)<500)this.lastClick=this.lastUp=r,this._doDoubleClick();else if(i<Ck||i<rU&&r.time-t.time<500)if(this.lastClick=this.lastUp=r,r.event.button===2){this.context.selectedIDs().includes(t.target.dataID)||this._doSelect();let a=t.target;if(a&&a.data&&a.data.service==="maproulette"){let l=this.context.systems.ui,c=r.coord.screen;l.showMapRouletteMenu(c,"rightclick")}else this._doContextMenu()}else this._doSelect()}_pointercancel(){this.lastDown=null}_spacebar(){this._spaceClickDisabled||this.lastMove&&(this._spaceClickDisabled=!0,this.lastSpace=this.lastMove,this.lastClick=this.lastMove,this._doSelect())}_doSelect(){if(!this._enabled||!this.lastClick)return;this._cancelLongPress();let e=this.context,t=e.systems.gfx,r=e.systems.photos,s=t.events.modifierKeys,o=Et().os==="mac",a=s.has("Alt")||s.has("Meta")||!o&&s.has("Control"),l=s.has("Shift"),c=Object.assign({},this.lastClick);a&&(c.target=null);let u=c.target,d=u?.data,f=u?.dataID;if(d){let h=e.behaviors.mapInteraction;h.doubleClickEnabled=!1,window.setTimeout(()=>h.doubleClickEnabled=!0,500)}if(d?.type==="midpoint"&&(d=d.way,f=d.id),!d){e.mode?.id!=="browse"&&!this._multiSelection.size&&!l&&e.enter("browse");return}if(d.__fbid__||d.overture||d.__featurehash__||d instanceof Qe||d.type==="detection"){let h=new Map().set(f,d);e.enter("select",{selection:h});return}if(d instanceof me){let h=e.selectedIDs();l?h.includes(f)?this._showsMenu||(h=h.filter(p=>p!==f),e.enter("select-osm",{selection:{osm:h}})):(h.push(f),e.enter("select-osm",{selection:{osm:h}})):(!this._showsMenu||h.length<=1||!h.includes(f))&&e.enter("select-osm",{selection:{osm:[f]}});return}if(d.type==="photo"){let h=u.layerID;r.selectPhoto(h,f);return}}_cancelLongPress(){this._longPressTimeout&&(window.clearTimeout(this._longPressTimeout),this._longPressTimeout=null,this._showsMenu=!1,this._showsMapRouletteMenu=!1)}_doLongPress(e){this._longPressTimeout=null,this.lastDown===e&&!e.isCancelled&&(this.lastClick=e,e.isCancelled=!0,this._doSelect(),this._doContextMenu())}_doDoubleClick(){if(!this._enabled||!this.lastUp)return;let e=this.context,t=e.systems.editor,r=e.systems.l10n,i=this.lastUp.coord.map,s=this.lastUp.target?.data,o=s instanceof Rt&&!s.__fbid__,a=s.type==="midpoint",l,c;if(o){let u=t.staging.graph,d=e.viewport,f=Ar(u.childNodes(s),i,d);l=f.loc,c=[s.nodes[f.index-1],s.nodes[f.index]]}else a&&(l=s.loc,c=[s.a.id,s.b.id]);l&&c&&(t.perform(Cr({loc:l,edge:c},Le())),t.commit({annotation:r.t("operations.add.annotation.vertex"),selectedIDs:e.selectedIDs()}))}_doContextMenu(){if(!this._enabled||!this.lastClick)return;let e=this.context,t=e.systems.gfx.events,r=e.systems.ui,i=t.modifierKeys,s=Et().os==="mac",o=i.has("Alt")||i.has("Meta")||!s&&i.has("Control"),a=Object.assign({},this.lastClick);o&&(a.target=null);let c=a.target?.data;if(c instanceof Qe&&c.service==="maproulette"){let u=a.coord.screen;this._showsMapRouletteMenu?(r.closeMapRouletteMenu(),this._showsMapRouletteMenu=!1):(r.showMapRouletteMenu(u,"rightclick"),this._showsMapRouletteMenu=!0);return}this._showsMenu?(r.closeEditMenu(),this._showsMenu=!1):(this._showsMenu=!0,r.showEditMenu(a.coord.map))}};var io={available:new Map};io.available.set("drag",J3);io.available.set("draw",ep);io.available.set("hover",tp);io.available.set("lasso",rp);io.available.set("mapInteraction",np);io.available.set("mapNudge",ip);io.available.set("paste",sp);io.available.set("select",op);var Se=class extends st{constructor(e){super(),this.context=e,this.id="",this.dependencies=new Set,this.autoStart=!0,this._started=!1,this._paused=!1}get started(){return this._started}get paused(){return this._paused}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}pause(){this._paused=!0}resume(){this._paused=!1}};var ap=class extends Se{constructor(e){if(super(e),this.id="assets",this.dependencies=new Set,this.sources={latest:{address_formats:"data/address_formats.min.json",imagery:"data/imagery.min.json",intro_graph:"data/intro_graph.min.json",intro_rapid_graph:"data/intro_rapid_graph.min.json",languages:"data/languages.min.json",locales:"data/locales.min.json",phone_formats:"data/phone_formats.min.json",qa_data:"data/qa_data.min.json",shortcuts:"data/shortcuts.min.json",tagging_preset_overrides:"data/preset_overrides.min.json",territory_languages:"data/territory_languages.min.json",wayback:"data/wayback.min.json",mapillary_js:"https://cdn.jsdelivr.net/npm/mapillary-js@4/dist/mapillary.min.js",mapillary_css:"https://cdn.jsdelivr.net/npm/mapillary-js@4/dist/mapillary.min.css",maplibre_js:"https://cdn.jsdelivr.net/npm/maplibre-gl@3/dist/maplibre-gl.min.js",maplibre_css:"https://cdn.jsdelivr.net/npm/maplibre-gl@3/dist/maplibre-gl.min.css",nsi_data:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/nsi.min.json",nsi_dissolved:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/dissolved.min.json",nsi_features:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/featureCollection.min.json",nsi_generics:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/genericWords.min.json",nsi_presets:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/presets/nsi-id-presets.min.json",nsi_replacements:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/replacements.min.json",nsi_trees:"https://cdn.jsdelivr.net/npm/name-suggestion-index@6.0/dist/trees.min.json",oci_defaults:"https://cdn.jsdelivr.net/npm/osm-community-index@5.9/dist/defaults.min.json",oci_features:"https://cdn.jsdelivr.net/npm/osm-community-index@5.9/dist/featureCollection.min.json",oci_resources:"https://cdn.jsdelivr.net/npm/osm-community-index@5.9/dist/resources.min.json",pannellum_js:"https://cdn.jsdelivr.net/npm/pannellum@2/build/pannellum.min.js",pannellum_css:"https://cdn.jsdelivr.net/npm/pannellum@2/build/pannellum.min.css",tagging_deprecated:"https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/deprecated.min.json",tagging_discarded:"https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/discarded.min.json",tagging_preset_categories:"https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/preset_categories.min.json",tagging_preset_defaults:"https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/preset_defaults.min.json",tagging_preset_fields:"https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/fields.min.json",tagging_preset_presets:"https://cdn.jsdelivr.net/npm/@openstreetmap/id-tagging-schema@6.6/dist/presets.min.json",wmf_sitematrix:"https://cdn.jsdelivr.net/npm/wmf-sitematrix@0.2/data/wikipedia.min.json"},local:{address_formats:"data/address_formats.min.json",imagery:"data/imagery.min.json",intro_graph:"data/intro_graph.min.json",intro_rapid_graph:"data/intro_rapid_graph.min.json",languages:"data/languages.min.json",locales:"data/locales.min.json",phone_formats:"data/phone_formats.min.json",qa_data:"data/qa_data.min.json",shortcuts:"data/shortcuts.min.json",tagging_preset_overrides:"data/preset_overrides.min.json",territory_languages:"data/territory_languages.min.json",wayback:"data/wayback.min.json",mapillary_js:"data/modules/mapillary-js/mapillary.js",mapillary_css:"data/modules/mapillary-js/mapillary.css",maplibre_js:"data/modules/maplibre-gl/maplibre-gl.js",maplibre_css:"data/modules/maplibre-gl/maplibre-gl.css",nsi_data:"data/modules/name-suggestion-index/nsi.min.json",nsi_dissolved:"data/modules/name-suggestion-index/dissolved.min.json",nsi_features:"data/modules/name-suggestion-index/featureCollection.min.json",nsi_generics:"data/modules/name-suggestion-index/genericWords.min.json",nsi_presets:"data/modules/name-suggestion-index/presets/nsi-id-presets.min.json",nsi_replacements:"data/modules/name-suggestion-index/replacements.min.json",nsi_trees:"data/modules/name-suggestion-index/trees.min.json",oci_defaults:"data/modules/osm-community-index/defaults.min.json",oci_features:"data/modules/osm-community-index/featureCollection.min.json",oci_resources:"data/modules/osm-community-index/resources.min.json",pannellum_js:"data/modules/pannellum/pannellum.js",pannellum_css:"data/modules/pannellum/pannellum.css",tagging_deprecated:"data/modules/id-tagging-schema/deprecated.min.json",tagging_discarded:"data/modules/id-tagging-schema/discarded.min.json",tagging_preset_categories:"data/modules/id-tagging-schema/preset_categories.min.json",tagging_preset_defaults:"data/modules/id-tagging-schema/preset_defaults.min.json",tagging_preset_fields:"data/modules/id-tagging-schema/fields.min.json",tagging_preset_presets:"data/modules/id-tagging-schema/presets.min.json",wmf_sitematrix:"data/modules/wmf-sitematrix/wikipedia.min.json"}},this.origin="latest",this.filePath="",this.fileReplacements={},this._cache={},this._inflight={},window.mocha){let t=this._cache;t.address_formats={addressFormats:[{format:[["housenumber","street"],["city","postcode"]]}]},t.imagery={imagery:[]},t.languages={languages:{de:{nativeName:"Deutsch"},en:{nativeName:"English"}}},t.locales={locales:{en:{rtl:!1}}},t.phone_formats={phoneFormats:{}},t.qa_data={keepRight:{},osmose:{}},t.shortcuts={shortcuts:[]},t.territory_languages={territoryLanguages:{}},t.tagging_deprecated=[{old:{highway:"no"}},{old:{highway:"ford"},replace:{ford:"*"}}],t.tagging_discarded={},t.tagging_preset_categories={},t.tagging_preset_defaults={},t.tagging_preset_fields={},t.tagging_preset_presets={},t.tagging_preset_overrides={},t.wmf_sitematrix=[["English","English","en"],["German","Deutsch","de"]]}}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}getFileURL(e){if(/^http(s)?:\/\//i.test(e))return e;let t=`${this.filePath}${e}`;return this.fileReplacements[t]||t}getAssetURL(e){if(/^http(s)?:\/\//i.test(e))return e;let t=this.sources[this.origin];if(!t)throw new Error(`Unknown origin "${this.origin}"`);let r=t[e];if(!r)throw new Error(`Unknown asset key "${e}"`);return this.getFileURL(r)}loadAssetAsync(e){if(this._cache[e])return Promise.resolve(this._cache[e]);let t;try{t=this.getAssetURL(e)}catch(i){return Promise.reject(i.message)}let r=this._inflight[t];return r||(this._inflight[t]=r=fetch(t).then(Ae).then(i=>{if(delete this._inflight[t],!i)throw new Error(`No data loaded for "${e}"`);return this._cache[e]=i,i}).catch(i=>{throw delete this._inflight[t],i})),r}};var lp=n=>+n;function y1(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}function EJ(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var x1=EJ;var TJ=typeof global=="object"&&global&&global.Object===Object&&global,nU=TJ;var kJ=typeof self=="object"&&self&&self.Object===Object&&self,IJ=nU||kJ||Function("return this")(),vx=IJ;var PJ=function(){return vx.Date.now()},wx=PJ;var DJ=/\s/;function MJ(n){for(var e=n.length;e--&&DJ.test(n.charAt(e)););return e}var iU=MJ;var RJ=/^\s+/;function FJ(n){return n&&n.slice(0,iU(n)+1).replace(RJ,"")}var sU=FJ;var BJ=vx.Symbol,$d=BJ;var oU=Object.prototype,NJ=oU.hasOwnProperty,OJ=oU.toString,cp=$d?$d.toStringTag:void 0;function LJ(n){var e=NJ.call(n,cp),t=n[cp];try{n[cp]=void 0;var r=!0}catch{}var i=OJ.call(n);return r&&(e?n[cp]=t:delete n[cp]),i}var aU=LJ;var UJ=Object.prototype,GJ=UJ.toString;function $J(n){return GJ.call(n)}var lU=$J;var zJ="[object Null]",HJ="[object Undefined]",cU=$d?$d.toStringTag:void 0;function WJ(n){return n==null?n===void 0?HJ:zJ:cU&&cU in Object(n)?aU(n):lU(n)}var uU=WJ;function VJ(n){return n!=null&&typeof n=="object"}var dU=VJ;var jJ="[object Symbol]";function XJ(n){return typeof n=="symbol"||dU(n)&&uU(n)==jJ}var fU=XJ;var hU=NaN,qJ=/^[-+]0x[0-9a-f]+$/i,YJ=/^0b[01]+$/i,KJ=/^0o[0-7]+$/i,QJ=parseInt;function ZJ(n){if(typeof n=="number")return n;if(fU(n))return hU;if(x1(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=x1(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=sU(n);var t=YJ.test(n);return t||KJ.test(n)?QJ(n.slice(2),t?2:8):qJ.test(n)?hU:+n}var Ak=ZJ;var JJ="Expected a function",eee=Math.max,tee=Math.min;function ree(n,e,t){var r,i,s,o,a,l,c=0,u=!1,d=!1,f=!0;if(typeof n!="function")throw new TypeError(JJ);e=Ak(e)||0,x1(t)&&(u=!!t.leading,d="maxWait"in t,s=d?eee(Ak(t.maxWait)||0,e):s,f="trailing"in t?!!t.trailing:f);function h(C){var k=r,v=i;return r=i=void 0,c=C,o=n.apply(v,k),o}function p(C){return c=C,a=setTimeout(y,e),u?h(C):o}function m(C){var k=C-l,v=C-c,w=e-k;return d?tee(w,s-v):w}function g(C){var k=C-l,v=C-c;return l===void 0||k>=e||k<0||d&&v>=s}function y(){var C=wx();if(g(C))return x(C);a=setTimeout(y,m(C))}function x(C){return a=void 0,f&&r?h(C):(r=i=void 0,o)}function b(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function _(){return a===void 0?o:x(wx())}function S(){var C=wx(),k=g(C);if(r=arguments,i=this,l=C,k){if(a===void 0)return p(l);if(d)return clearTimeout(a),a=setTimeout(y,e),h(l)}return a===void 0&&(a=setTimeout(y,e)),o}return S.cancel=b,S.flush=_,S}var Xt=ree;function X(n,e="",t=""){let r=n.replace("#",""),i=r.split("-")[0];return function(o){let a=["icon"];i&&a.push(`icon-${i}`),r&&a.push(`icon-${r}`),e&&a.push(e);let l=o.selectAll(`svg.icon-${r}`).data([r],c=>c).enter().append("svg").attr("class",a.join(" ")).attr("role","img").attr("aria-labelledby",t);t&&l.append("title").text(t),l.append("use").attr("xlink:href",n)}}function vr(n,e){let t=Xe("modal"),r=n.select("div.modal"),i=r.empty();r.transition().duration(200).style("opacity",0).remove();let s=n.append("div").attr("class","shaded").style("opacity",0);s.close=()=>{s.transition().duration(200).style("opacity",0).remove(),o.transition().duration(200).style("top","0px"),H(document).call(t.unbind)};let o=s.append("div").attr("class","modal fillL");return o.append("input").attr("class","keytrap keytrap-first").on("focus.keytrap",l),e||(s.on("click.remove-modal",c=>{c.target===this&&s.close()}),o.append("button").attr("class","close").on("click",s.close).call(X("#rapid-icon-close")),t.on("\u232B",s.close).on("\u238B",s.close),H(document).call(t)),o.append("div").attr("class","content"),o.append("input").attr("class","keytrap keytrap-last").on("focus.keytrap",a),i?s.transition().style("opacity",1):s.style("opacity",1),s;function a(){let c=o.select("a, button, input:not(.keytrap), select, textarea").node();c?c.focus():H(this).node().blur()}function l(){let c=o.selectAll("a, button, input:not(.keytrap), select, textarea").nodes();c.length?c[c.length-1].focus():H(this).node().blur()}}function Vo(n){let e=n.systems.assets,t=H(null),r="",i=!1,s=o=>{t=vr(o,i);let a=t.select(".content").classed("loading-modal",!0).append("div").attr("class","modal-section fillL");return a.append("img").attr("class","loader").attr("src",e.getFileURL("img/loader-white.gif")),a.append("h3").text(r),t.select("button.close").attr("class","hide"),s};return s.message=function(o){return arguments.length?(r=o,s):r},s.blocking=function(o){return arguments.length?(i=o,s):i},s.close=()=>{t.remove()},s.isShown=()=>t&&!t.empty()&&t.node().parentNode,s}var up=class extends Se{constructor(e){super(e),this.id="editor",this.dependencies=new Set(["gfx","imagery","map","photos","storage"]),this._mutex=HD("lock"),this._canRestoreBackup=!1,this._hasWorkInProgress=!1,this._history=[],this._index=0,this._staging=null,this._checkpoints=new Map,this._inTransition=!1,this._inTransaction=!1,this._tree=null,this._backupStatus=!0,this._fullDifference=null,this._lastStableGraph=null,this._lastStagingGraph=null,this._initPromise=null,this.saveBackup=this.saveBackup.bind(this),this.deferredBackup=Xt(this.saveBackup,1e3,{leading:!1,trailing:!0})}initAsync(){if(this._initPromise)return this._initPromise;for(let r of this.dependencies)if(!this.context.systems[r])return Promise.reject(`Cannot init:  ${this.id} requires ${r}`);this._reset();let e=this.context.systems.storage,t=e.initAsync();return this._initPromise=t.then(()=>{window.mocha||(window.addEventListener("beforeunload",r=>{if(this._history.length>1)return r.preventDefault(),this.saveBackup(),r.returnValue=""}),window.addEventListener("unload",()=>this._mutex.unlock()),this._canRestoreBackup=this._mutex.lock()&&e.hasItem(this._backupKey()))})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){let e=this._index;return this._reset(),this.emit("stagingchange",this._fullDifference),this.emit("stablechange",this._fullDifference),this.emit("historyjump",e,this._index),this.emit("backupstatuschange",this._backupStatus),Promise.resolve()}_reset(){H(document).interrupt("editTransition"),this.deferredBackup.cancel();let e=new Fr,t=new ga({graph:e});this._history=[t],this._index=0;let r=new Fr(e),i=new ga({graph:r});this._staging=i,this._hasWorkInProgress=!1,this._tree=new zi(r),this._lastStableGraph=e,this._lastStagingGraph=r,this._fullDifference=new Fn(e,e),this._backupStatus=!0,this._checkpoints.clear(),this._inTransition=!1,this._inTransaction=!1}get base(){return this._history[0]}get stable(){return this._history[this._index]}get staging(){return this._staging}get tree(){return this._tree}get history(){return this._history.slice()}get index(){return this._index}get hasWorkInProgress(){return this._hasWorkInProgress}perform(...e){return H(document).interrupt("editTransition"),this._perform(e,1),this._updateChanges()}performAsync(e){if(H(document).interrupt("editTransition"),typeof e!="function")return Promise.reject();if(!e.transitionable)return this._perform([e],1),this._updateChanges(),Promise.resolve();let t=150;return new Promise(r=>{H(document).transition("editTransition").duration(t).ease(lp).tween("edit.tween",()=>i=>{i<1&&(this._replaceStaging(),this._perform([e],i),this._updateChanges())}).on("start",()=>{this._inTransition=!0,this._replaceStaging(),this._perform([e],0),this._updateChanges()}).on("end interrupt",()=>{this._replaceStaging(),this._perform([e],1),this._updateChanges(),this._inTransition=!1,r()})})}revert(){if(this._hasWorkInProgress)return H(document).interrupt("editTransition"),this._replaceStaging(),this._updateChanges()}commit(e={}){H(document).interrupt("editTransition");let t=this.context,r=this.staging,i=e.annotation??"";r.annotation=i,r.selectedIDs=e.selectedIDs??[],r.sources=this._gatherSources(i),r.transform=t.viewport.transform.props,this._history.splice(this._index+1,1/0,r),this._index++,this._replaceStaging(),this._updateChanges()}commitAppend(e={}){H(document).interrupt("editTransition");let t=this.context,r=this.staging;if(this._index===0)throw new Error("Can not commitAppend to the base edit!");let i=e.annotation??"";r.annotation=i,r.selectedIDs=e.selectedIDs??[],r.sources=this._gatherSources(i),r.transform=t.viewport.transform.props,this._history.splice(this._index,1/0,r),this._replaceStaging(),this._updateChanges()}undo(){H(document).interrupt("editTransition");let e=this._index;if(this._hasWorkInProgress){this.revert(),this.emit("historyjump",e,this._index);return}this._index>0&&this._index--,this._index!==e&&(this._replaceStaging(),this._updateChanges(),this.emit("historyjump",e,this._index))}redo(){H(document).interrupt("editTransition");let e=this._index;this._index<this._history.length-1&&this._index++,this._index!==e&&(this._replaceStaging(),this._updateChanges(),this.emit("historyjump",e,this._index))}setCheckpoint(e){e&&(H(document).interrupt("editTransition"),this._checkpoints.set(e,{history:this._history.slice(),index:this._index}))}restoreCheckpoint(e){if(!e)return;H(document).interrupt("editTransition");let t=this._index,r=this._checkpoints.get(e);r&&(this._history=r.history.slice(),this._index=r.index,this._replaceStaging(),this._updateChanges(),this.emit("historyjump",t,this._index))}deleteCheckpoint(e){e&&this._checkpoints.delete(e)}merge(e,t){let r=this.base.graph,i=this.staging.graph;t instanceof Set||(t=new Set(e.map(a=>a.id)));let s=new Set;for(let a of e)r.hasEntity(a.id)||s.add(a.id);for(let a of t){let l=i.hasEntity(a);if(l?.type==="relation")for(let c of l.members)s.has(c.id)&&l.touch()}let o=this._history.map(a=>a.graph);o.push(i),r.rebase(e,o,!1),this._tree.rebase(e,!1),this.emit("merge",t)}beginTransaction(){this._inTransaction=!0}endTransaction(){return this._inTransaction=!1,this._updateChanges()}getUndoAnnotation(){let e=this._index;for(;e>=0;){let t=this._history[e];if(t.annotation)return t.annotation;e--}}getRedoAnnotation(){let e=this._index+1;for(;e<=this._history.length-1;){let t=this._history[e];if(t.annotation)return t.annotation;e++}}intersects(e){return this._tree.intersects(e,this.staging.graph)}difference(){return this._fullDifference}changes(e){let t=this._fullDifference;if(e){let r=this.base.graph,i=e(this.stable.graph);t=new Fn(r,i)}return{created:t.created(),modified:t.modified(),deleted:t.deleted()}}hasChanges(){return this._fullDifference.changes.size>0}sourcesUsed(){let e={imagery:new Set,photos:new Set,data:new Set};for(let t=1;t<=this._index;t++){let r=this._history[t];for(let i of["imagery","photos","data"])for(let s of r.sources[i]??[])e[i].add(s)}return e}toIntroGraph(){let e={n:0,r:0,w:0},t={},r=this.stable.graph,i=new Map;for(let a of r.base.entities.values()){let l=o(a);i.set(l.id,l)}for(let[a,l]of r.local.entities)if(l){let c=o(l);i.set(c.id,c)}else i.delete(a);for(let a of i.values())Array.isArray(a.nodes)&&(a.nodes=a.nodes.map(l=>t[l]??l)),Array.isArray(a.members)&&(a.members=a.members.map(l=>(l.id=t[l.id]??l.id,l)));let s={};for(let[a,l]of i)s[a]=l;return JSON.stringify({dataIntroGraph:s});function o(a){let l=Ir(a,["type","user","v","version","visible"]);l.tags&&Object.keys(l.tags).length===0&&delete l.tags,Array.isArray(l.loc)&&(l.loc[0]=+l.loc[0].toFixed(6),l.loc[1]=+l.loc[1].toFixed(6));let c=a.id.match(/([nrw])-\d*/);if(c!==null){let u=c[1],d;do d=u+ ++e[u];while(i.has(d));t[a.id]=d,l.id=d}return l}}toJSON(){if(!this.hasChanges())return;let e=7,t=this.base.graph,r=new Map,i=new Map,s=[];for(let a of this._history){let l=[],c=[];for(let[f,h]of a.graph.local.entities){if(h){let m=me.key(h);r.set(m,o(h)),l.push(m)}else c.push(f);let p=t.hasEntity(f);if(p&&!i.has(f)&&i.set(f,o(p)),h&&h.nodes)for(let m of h.nodes){let g=t.hasEntity(m);g&&!i.has(g.id)&&i.set(g.id,o(g))}if(p)for(let m of t.parentWays(p))i.has(m.id)||i.set(m.id,o(m))}let u=a.sources??{},d={};l.length&&(d.modified=l),c.length&&(d.deleted=c),a.annotation&&(d.annotation=a.annotation),a.selectedIDs&&(d.selectedIDs=a.selectedIDs),a.transform&&(d.transform=a.transform),u.imagery&&(d.imageryUsed=u.imagery),u.photos&&(d.photosUsed=u.photos),u.data&&(d.dataUsed=u.data),s.push(d)}return JSON.stringify({version:3,entities:[...r.values()],baseEntities:[...i.values()],stack:s,nextIDs:me.id.next,index:this._index,timestamp:new Date().getTime()});function o(a){let l=Ir(a,["visible"]);return l.tags&&Object.keys(l.tags).length===0&&delete l.tags,Array.isArray(l.loc)&&(l.loc[0]=+l.loc[0].toFixed(e),l.loc[1]=+l.loc[1].toFixed(e)),l}}fromJSONAsync(e){let t=this.context,r=t.systems.gfx,i=t.services.osm,s=JSON.parse(e);if(s.version!==3)throw new Error(`Backup version ${s.version} not supported.`);r.pause();let o;window.mocha||(o=Vo(t).blocking(!0),t.container().call(o));let a=new Map,l=new Map,c=new Set;me.id.next=s.nextIDs;for(let f of s.baseEntities){let h=me(f);a.set(h.id,h)}for(let f of a.values())if(Array.isArray(f.nodes))for(let h of f.nodes)a.has(h)||c.add(h);for(let f of s.entities)l.set(me.key(f),me(f));let u=()=>new Promise((f,h)=>{if(i&&c.size){let p=(m,g)=>{if(m)h(m);else{let y=hr(g.data,"visible"),x=y.true??[],b=y.false??[];for(let _ of x)c.delete(_.id),a.set(_.id,_);for(let _ of b)i.loadEntityVersion(_.id,+_.version-1,p)}c.size||f()};i.loadMultiple(c,p)}else f()}),d=()=>{let f=[...a.values()],h=new Set(a.keys()),p=this.base.graph;p.rebase(f,[p],!1),this._tree.rebase(f,!1);let m=p;for(let g=1;g<s.stack.length;g++){let y=s.stack[g],x={};for(let S of y.modified??[]){let C=l.get(S);x[C.id]=C}for(let S of y.deleted??[])x[S]=void 0;let b=new Fr(m).load(x);m=b;let _={};Array.isArray(y.imageryUsed)&&(_.imagery=y.imageryUsed),Array.isArray(y.photosUsed)&&(_.photos=y.photosUsed),Array.isArray(y.dataUsed)&&(_.data=y.dataUsed),this._history.push(new ga({annotation:y.annotation,graph:b,selectedIDs:y.selectedIDs,sources:_,transform:y.transform}))}this._index=s.index,this._replaceStaging(),r.resume(),o?.close(),this.emit("merge",h),this._updateChanges(),this.emit("historyjump",0,this._index)};return u().finally(()=>d())}saveBackup(){let e=this.context;if(e.inIntro||e.mode?.id==="save"||this._canRestoreBackup||this._inTransition||this._inTransaction||!this._mutex.locked())return;let t=e.systems.storage,r=this.toJSON();if(r){let i=t.setItem(this._backupKey(),r);i!==this._backupStatus&&(this._backupStatus=i,this.emit("backupstatuschange",this._backupStatus))}}get canRestoreBackup(){return this._canRestoreBackup}restoreBackup(){if(this._canRestoreBackup=!1,!this._mutex.locked())return;let e=this.context,r=e.systems.storage.getItem(this._backupKey());r&&e.resetAsync().then(()=>this.fromJSONAsync(r))}clearBackup(){if(this._canRestoreBackup=!1,this.deferredBackup.cancel(),!this._mutex.locked())return;let e=this.context.systems.storage;e.removeItem(this._backupKey()),e.removeItem("comment"),e.removeItem("hashtags"),e.removeItem("source")}_backupKey(){return"Rapid_"+window.location.origin+"_saved_history"}_gatherSources(e){let t=this.context,r=t.systems.gfx,i=t.systems.imagery,s=t.systems.photos,o={},a=i.imageryUsed();a.length&&(o.imagery=a);let l=s.photosUsed();l.length&&(o.photos=l);let u=r.scene.layers.get("custom-data")?.dataUsed()??[],f=[...e?.dataUsed??[],...u];return f.length&&(o.data=f),o}_perform(e,t=1){let r=this._staging.graph;for(let i of e)typeof i=="function"&&(r=i(r,t));this._staging.graph=r,this._hasWorkInProgress=!0}_replaceStaging(){this._staging=new ga({graph:new Fr(this.stable.graph)}),this._hasWorkInProgress=!1}_updateChanges(){if(this._inTransaction)return;let e=this.base.graph,t=this.stable.graph,r=this.staging.graph,i;if((this._lastStagingGraph!==r||this._hasWorkInProgress)&&(i=new Fn(this._lastStagingGraph,r),this._lastStagingGraph=r,this.emit("stagingchange",i)),this._lastStableGraph!==t){this._fullDifference=new Fn(e,t);let s=new Fn(this._lastStableGraph,t);this._lastStableGraph=t,this.emit("stablechange",s),this.deferredBackup()}return i}};var Sx={motorway:!0,motorway_link:!0,trunk:!0,trunk_link:!0,primary:!0,primary_link:!0,secondary:!0,secondary_link:!0,tertiary:!0,tertiary_link:!0,residential:!0,unclassified:!0,living_street:!0},Cx={busway:!0,service:!0,road:!0,track:!0},Ax={path:!0,footway:!0,cycleway:!0,bridleway:!0,steps:!0,pedestrian:!0},hn=class{constructor(e){this.match=e,this.enabled=!0,this.count=0}},dp=class extends Se{constructor(e){super(e),this.id="filters",this.dependencies=new Set(["editor","storage","urlhash"]),this._filters=new Map,this._hidden=new Set,this._forceVisible=new Set,this._cache={},this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._filters.set("points",new hn(this._isPoint.bind(this))),this._filters.set("traffic_roads",new hn(this._isTrafficRoad.bind(this))),this._filters.set("service_roads",new hn(this._isServiceRoad.bind(this))),this._filters.set("paths",new hn(this._isPath.bind(this))),this._filters.set("buildings",new hn(this._isBuilding.bind(this))),this._filters.set("building_parts",new hn(this._isBuildingPart.bind(this))),this._filters.set("indoor",new hn(this._isIndoor.bind(this))),this._filters.set("landuse",new hn(this._isLanduse.bind(this))),this._filters.set("boundaries",new hn(this._isBoundary.bind(this))),this._filters.set("water",new hn(this._isWater.bind(this))),this._filters.set("rail",new hn(this._isRail.bind(this))),this._filters.set("pistes",new hn(this._isPiste.bind(this))),this._filters.set("aerialways",new hn(this._isAerialway.bind(this))),this._filters.set("power",new hn(this._isPower.bind(this))),this._filters.set("past_future",new hn(this._isPastFuture.bind(this))),this._filters.set("others",new hn(this._isOther.bind(this)))}initAsync(){if(this._initPromise)return this._initPromise;for(let i of this.dependencies)if(!this.context.systems[i])return Promise.reject(`Cannot init:  ${this.id} requires ${i}`);let t=this.context.systems.urlhash,r=Promise.all([t.initAsync()]);return this._initPromise=r.then(()=>{t.on("hashchange",this._hashchange)})}startAsync(){let e=this.context,t=e.systems.storage,s=(e.systems.urlhash.getParam("disable_features")??t.getItem("disabled-features")??"boundaries").replace(/;/g,",").split(",").map(o=>o.trim()).filter(Boolean);for(let o of s){this._hidden.add(o);let a=this._filters.get(o);a.enabled=!1}return this._update(),this._started=!0,Promise.resolve()}resetAsync(){return this._cache={},this._forceVisible.clear(),Promise.resolve()}get keys(){return[...this._filters.keys()]}get hidden(){return this._hidden}isEnabled(e){return this._filters.get(e)?.enabled}enable(e){let t=this._filters.get(e);t&&!t.enabled&&(t.enabled=!0,this._update())}enableAll(){let e=!1;for(let t of this._filters.values())t.enabled||(e=!0,t.enabled=!0);e&&this._update()}disable(e){let t=this._filters.get(e);t?.enabled&&(t.enabled=!1,this._update())}disableAll(){let e=!1;for(let t of this._filters.values())t.enabled&&(e=!0,t.enabled=!1);e&&this._update()}toggle(e){let t=this._filters.get(e);t&&(t.enabled=!t.enabled,this._update())}getStats(){let e={};for(let[t,r]of this._filters)e[t]={enabled:r.enabled,count:r.count};return e}clear(e){for(let t of e)this.clearEntity(t)}clearEntity(e){let t=me.key(e);delete this._cache[t]}getMatches(e,t,r){if(r==="vertex")return new Set;if(r==="relation"&&e.tags.type!=="boundary")return new Set;let i=me.key(e),s=this._cache[i];if(s||(this._cache[i]=s={parents:null,matches:null}),s.matches)return s.matches;let o=s.parents||this.getParents(e,t,r);if(o.length)for(let l of o){let c=me.key(l);this._cache[c]?.matches||this.getMatches(l,t,l.geometry(t))}let a=new Set;for(let[l,c]of this._filters){if(l==="others"){if(a.size)continue;if(e.type==="way"&&(o.length===1&&o[0].isMultipolygon()||o.length>0&&o.every(u=>u.tags.type==="boundary"))){let u=me.key(o[0]),d=this._cache[u]?.matches;if(d){a=new Set(d);continue}}}c.match(e.tags,r)&&a.add(l)}return s.matches=a,a}getParents(e,t,r){if(r==="point")return[];let i=me.key(e),s=this._cache[i];if(s||(this._cache[i]=s={parents:null,matches:null}),!s.parents){let o;r==="vertex"?o=t.parentWays(e):o=t.parentRelations(e),s.parents=o}return s.parents}isHiddenPreset(e,t){if(!this._hidden.size||!e.tags)return null;let r=e.setTags({},t);for(let[i,s]of this._filters)if(s.match(r,t))return this._hidden.has(i)?i:null;return null}isHiddenFeature(e,t,r){if(!this._hidden.size||!e.version||this._forceVisible.has(e.id))return null;let i=[...this.getMatches(e,t,r)];return i.length&&i.every(s=>this._hidden.has(s))?i[0]:null}isHiddenVertex(e,t){if(!this._hidden.size||!e.version||this._forceVisible.has(e.id))return null;let r=this.getParents(e,t,"vertex");if(!r.length)return null;let i=null;for(let s of r){let o=this.isHidden(s,t,s.geometry(t));if(!o)return null;i||(i=o)}return i}hasHiddenConnections(e,t){if(!this._hidden.size)return!1;let r,i;return e.type==="midpoint"?(r=[t.entity(e.edge[0]),t.entity(e.edge[1])],i=[]):(r=e.nodes?t.childNodes(e):[],i=this.getParents(e,t,e.geometry(t))),i=r.reduce((s,o)=>t.isShared(o)?Ur(s,t.parentWays(o)):s,i),i.some(s=>this.isHidden(s,t,s.geometry(t)))}isHidden(e,t,r){return!this._hidden.size||!e.version?null:r==="vertex"?this.isHiddenVertex(e,t):this.isHiddenFeature(e,t,r)}filterScene(e,t){for(let i of this._filters.values())i.count=0;if(!this._hidden.size)return e;let r=[];for(let i of e){let s=i.geometry(t),o=this.isHidden(i,t,s);if(o){if(!(s==="vertex"&&!i.hasInterestingTags())){let l=this._filters.get(o);l.count++}}else r.push(i)}return r}forceVisible(e){this._forceVisible=new Set;let r=this.context.systems.editor.staging.graph;for(let i of e){this._forceVisible.add(i);let s=r.hasEntity(i);if(s?.type==="relation")for(let o of s.members)this._forceVisible.add(o.id)}}_hashchange(e,t){let r=e.get("disable_features"),i=t.get("disable_features");if(r!==i){let s=new Set;typeof r=="string"&&(s=new Set(r.replace(/;/g,",").split(",")));let o=!1;for(let[a,l]of this._filters)l.enabled&&s.has(a)?(l.enabled=!1,o=!0):!l.enabled&&!s.has(a)&&(l.enabled=!0,o=!0);o&&this._update()}}_update(){let e=this.context,t=e.systems.storage,r=e.systems.urlhash;this._hidden=new Set;for(let[s,o]of this._filters)o.enabled||this._hidden.add(s);let i=[...this._hidden].join(",");r.setParam("disable_features",i.length?i:null),t.setItem("disabled-features",i),this.emit("filterchange")}_isPoint(e,t){return t==="point"}_isTrafficRoad(e){return Sx[e.highway]}_isServiceRoad(e){return Cx[e.highway]}_isPath(e){return Ax[e.highway]}_isBuilding(e){return(!!e.building&&e.building!=="no"||e.parking==="multi-storey"||e.parking==="sheds"||e.parking==="carports"||e.parking==="garage_boxes")&&!this._isPastFuture(e)}_isBuildingPart(e){return e["building:part"]}_isIndoor(e){return e.indoor}_isLanduse(e,t){return t==="area"&&!this._isBuilding(e)&&!this._isBuildingPart(e)&&!this._isIndoor(e)&&!this._isWater(e)&&!this._isAerialway(e)&&!this._isPastFuture(e)}_isBoundary(e){return!!e.boundary&&!(Sx[e.highway]||Cx[e.highway]||Ax[e.highway]||e.waterway||e.railway||e.landuse||e.natural||e.building||e.power)}_isWater(e){return(!!e.waterway||e.natural==="water"||e.natural==="coastline"||e.natural==="bay"||e.landuse==="pond"||e.landuse==="basin"||e.landuse==="reservoir"||e.landuse==="salt_pond")&&!this._isPastFuture(e)}_isRail(e){return(!!e.railway||e.landuse==="railway")&&!(Sx[e.highway]||Cx[e.highway]||Ax[e.highway])&&!this._isPastFuture(e)}_isPiste(e){return e["piste:type"]}_isAerialway(e){return e.aerialway&&e.aerialway!=="yes"&&e.aerialway!=="station"}_isPower(e){return!!e.power&&!this._isPastFuture(e)}_isPastFuture(e){if(Sx[e.highway]||Cx[e.highway]||Ax[e.highway])return!1;for(let[t,r]of Object.entries(e)){if(oa[t]||oa[r])return!0;let i=t.split(":");if(i.length!==1&&oa[i[0]])return!0}return!1}_isOther(e,t){return t==="line"||t==="area"}};var Ex=class extends st{constructor(e){super(),this._enabled=!1,this.gfx=e,this.context=e.context,this.pointerOverRenderer=!1,this.modifierKeys=new Set,this.coord={screen:[0,0],map:[0,0]},this._wheelDefault=Et().os==="mac"?"auto":"zoom",this._click=this._click.bind(this),this._keydown=this._keydown.bind(this),this._keyup=this._keyup.bind(this),this._pointercancel=this._pointercancel.bind(this),this._pointerdown=this._pointerdown.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerout=this._pointerout.bind(this),this._pointerover=this._pointerover.bind(this),this._pointerup=this._pointerup.bind(this),this._wheel=this._wheel.bind(this),this.enable()}get enabled(){return this._enabled}enable(){if(this._enabled)return;this._enabled=!0,this.modifierKeys.clear(),window.addEventListener("keydown",this._keydown),window.addEventListener("keyup",this._keyup);let e=this.gfx;e.supersurface.addEventListener("wheel",this._wheel,{passive:!1});let r=e.surface;r.addEventListener("pointerover",this._pointerover),r.addEventListener("pointerout",this._pointerout);let i=e.pixi.stage;i.addEventListener("click",this._click),i.addEventListener("rightclick",this._click),i.addEventListener("pointerdown",this._pointerdown),i.addEventListener("pointermove",this._pointermove),i.addEventListener("pointerup",this._pointerup),i.addEventListener("pointerupoutside",this._pointercancel),i.addEventListener("pointercancel",this._pointercancel)}disable(){if(!this._enabled)return;this._enabled=!1,this.modifierKeys.clear(),window.removeEventListener("keydown",this._keydown),window.removeEventListener("keyup",this._keyup);let e=this.gfx;e.supersurface.removeEventListener("wheel",this._wheel);let r=e.surface;r.removeEventListener("pointerover",this._pointerover),r.removeEventListener("pointerout",this._pointerout);let i=e.pixi.stage;i.removeEventListener("click",this._click),i.removeEventListener("rightclick",this._click),i.removeEventListener("pointerdown",this._pointerdown),i.removeEventListener("pointermove",this._pointermove),i.removeEventListener("pointerup",this._pointerup),i.removeEventListener("pointerupoutside",this._pointercancel),i.removeEventListener("pointercancel",this._pointercancel)}setCursor(e){let t=this.context.assetPath,r=this.gfx.surface,i={areaCursor:`url(${t}img/cursor-select-area.png), pointer`,connectLineCursor:`url(${t}img/cursor-draw-connect-line.png) 9 9, crosshair`,connectVertexCursor:`url(${t}img/cursor-draw-connect-vertex.png) 9 9, crosshair`,lineCursor:`url(${t}img/cursor-select-line.png), pointer`,pointCursor:`url(${t}img/cursor-select-point.png), pointer`,selectSplitCursor:`url(${t}img/cursor-select-split.png), pointer`,vertexCursor:`url(${t}img/cursor-select-vertex.png), pointer`};switch(e){case"areaCursor":r.style.cursor=i.areaCursor;break;case"connectLineCursor":r.style.cursor=i.connectLineCursor;break;case"connectVertexCursor":r.style.cursor=i.connectVertexCursor;break;case"lineCursor":r.style.cursor=i.lineCursor;break;case"pointCursor":r.style.cursor=i.pointCursor;break;case"selectSplitCursor":r.style.cursor=i.selectSplitCursor;break;case"vertexCursor":r.style.cursor=i.vertexCursor;break;default:r.style.cursor=e;break}}_observeModifierKeys(e){let t=this.modifierKeys,r=["Alt","Control","Meta","Shift"],i=!1;for(let s of r){let o=e.getModifierState(s),a=t.has(s);o&&!a?(t.add(s),i=!0):!o&&a&&(t.delete(s),i=!0)}i&&this.emit("modifierchange",t)}_observeCoordinate(e,t){this.coord={screen:[e,t],map:[e,t]};let r=this.context.viewport,i=r.transform.r;i&&(this.coord.map=lr(this.coord.screen,-i,r.center()))}_checkButtons(e){e.ctrlKey&&Et().os==="mac"&&(e.button===0&&(e.button=2),(e.buttons&3)===1&&(e.buttons^=3))}_keydown(e){this._observeModifierKeys(e),this.emit("keydown",e)}_keyup(e){this._observeModifierKeys(e),this.emit("keyup",e)}_pointerover(e){this._observeModifierKeys(e),this.pointerOverRenderer=!0,this.emit("pointerover",e)}_pointerout(e){this._observeModifierKeys(e),this.pointerOverRenderer=!1,this.emit("pointerout",e)}_pointerdown(e){this._observeModifierKeys(e),this._observeCoordinate(e.global.x,e.global.y),this._checkButtons(e),this.emit("pointerdown",e)}_pointermove(e){this._observeModifierKeys(e),this._observeCoordinate(e.global.x,e.global.y),this._checkButtons(e),this.emit("pointermove",e)}_pointerup(e){this._observeModifierKeys(e),this._observeCoordinate(e.global.x,e.global.y),this._checkButtons(e),this.emit("pointerup",e)}_pointercancel(e){this.emit("pointercancel",e)}_click(e){this._checkButtons(e),this.emit("click",e)}_wheel(e){e.preventDefault(),e.stopImmediatePropagation();let r=this.context.systems.storage;this._observeCoordinate(e.offsetX,e.offsetY);let[i,s]=this._normalizeWheelDelta(e),o=typeof s=="number"&&isFinite(s)&&Math.floor(s)===s,a=!o&&e.ctrlKey&&!this.modifierKeys.has("Control"),l="zoom",c=3;if(a)l="zoom",c=6;else if(e.shiftKey)l="zoom",c=3;else{let u=r.getItem("prefs.mouse_wheel.interaction")??this._wheelDefault;u==="pan"||u==="auto"&&(i||o)?(l="pan",c=1):(l="zoom",c=3)}e._gesture=l,e._normalizedDeltaX=i*c,e._normalizedDeltaY=s*c,e._coord=this.coord,this.emit("wheel",e)}_normalizeWheelDelta(e){let[t,r]=[e.deltaX,e.deltaY];r===0&&e.shiftKey&&([t,r]=[e.deltaY,e.deltaX]);let[i,s]=[Math.sign(t),Math.sign(r)],[o,a]=[Math.abs(t),Math.abs(r)],l=typeof a=="number"&&isFinite(o)&&Math.floor(o)===o,c=typeof a=="number"&&isFinite(a)&&Math.floor(a)===a,u=l?0:.001,d=c?0:.001;if(e.deltaMode!==WheelEvent.DOM_DELTA_PIXEL){let m;e.deltaMode===WheelEvent.DOM_DELTA_LINE?m=8:e.deltaMode===WheelEvent.DOM_DELTA_PAGE?m=24:m=1,o*=m,a*=m}let f=40,h=i*(Math.min(f,o)+u),p=s*(Math.min(f,a)+d);return[h,p]}};function Tx(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function Ek(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function pp(){}var fp=.7,Px=1/fp,zd="\\s*([+-]?\\d+)\\s*",hp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",jo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",nee=/^#([0-9a-f]{3,8})$/,iee=new RegExp(`^rgb\\(${zd},${zd},${zd}\\)$`),see=new RegExp(`^rgb\\(${jo},${jo},${jo}\\)$`),oee=new RegExp(`^rgba\\(${zd},${zd},${zd},${hp}\\)$`),aee=new RegExp(`^rgba\\(${jo},${jo},${jo},${hp}\\)$`),lee=new RegExp(`^hsl\\(${hp},${jo},${jo}\\)$`),cee=new RegExp(`^hsla\\(${hp},${jo},${jo},${hp}\\)$`),pU={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Tx(pp,oo,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:mU,formatHex:mU,formatHex8:uee,formatHsl:dee,formatRgb:gU,toString:gU});function mU(){return this.rgb().formatHex()}function uee(){return this.rgb().formatHex8()}function dee(){return wU(this).formatHsl()}function gU(){return this.rgb().formatRgb()}function oo(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=nee.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?yU(e):t===3?new Di(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?kx(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?kx(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=iee.exec(n))?new Di(e[1],e[2],e[3],1):(e=see.exec(n))?new Di(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=oee.exec(n))?kx(e[1],e[2],e[3],e[4]):(e=aee.exec(n))?kx(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=lee.exec(n))?_U(e[1],e[2]/100,e[3]/100,1):(e=cee.exec(n))?_U(e[1],e[2]/100,e[3]/100,e[4]):pU.hasOwnProperty(n)?yU(pU[n]):n==="transparent"?new Di(NaN,NaN,NaN,0):null}function yU(n){return new Di(n>>16&255,n>>8&255,n&255,1)}function kx(n,e,t,r){return r<=0&&(n=e=t=NaN),new Di(n,e,t,r)}function fee(n){return n instanceof pp||(n=oo(n)),n?(n=n.rgb(),new Di(n.r,n.g,n.b,n.opacity)):new Di}function Hd(n,e,t,r){return arguments.length===1?fee(n):new Di(n,e,t,r??1)}function Di(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}Tx(Di,Hd,Ek(pp,{brighter(n){return n=n==null?Px:Math.pow(Px,n),new Di(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?fp:Math.pow(fp,n),new Di(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Di(_1(this.r),_1(this.g),_1(this.b),Dx(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:xU,formatHex:xU,formatHex8:hee,formatRgb:bU,toString:bU}));function xU(){return`#${b1(this.r)}${b1(this.g)}${b1(this.b)}`}function hee(){return`#${b1(this.r)}${b1(this.g)}${b1(this.b)}${b1((isNaN(this.opacity)?1:this.opacity)*255)}`}function bU(){let n=Dx(this.opacity);return`${n===1?"rgb(":"rgba("}${_1(this.r)}, ${_1(this.g)}, ${_1(this.b)}${n===1?")":`, ${n})`}`}function Dx(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function _1(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function b1(n){return n=_1(n),(n<16?"0":"")+n.toString(16)}function _U(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new so(n,e,t,r)}function wU(n){if(n instanceof so)return new so(n.h,n.s,n.l,n.opacity);if(n instanceof pp||(n=oo(n)),!n)return new so;if(n instanceof so)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),s=Math.max(e,t,r),o=NaN,a=s-i,l=(s+i)/2;return a?(e===s?o=(t-r)/a+(t<r)*6:t===s?o=(r-e)/a+2:o=(e-t)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new so(o,a,l,n.opacity)}function SU(n,e,t,r){return arguments.length===1?wU(n):new so(n,e,t,r??1)}function so(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}Tx(so,SU,Ek(pp,{brighter(n){return n=n==null?Px:Math.pow(Px,n),new so(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?fp:Math.pow(fp,n),new so(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new Di(Tk(n>=240?n-240:n+120,i,r),Tk(n,i,r),Tk(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new so(vU(this.h),Ix(this.s),Ix(this.l),Dx(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let n=Dx(this.opacity);return`${n===1?"hsl(":"hsla("}${vU(this.h)}, ${Ix(this.s)*100}%, ${Ix(this.l)*100}%${n===1?")":`, ${n})`}`}}));function vU(n){return n=(n||0)%360,n<0?n+360:n}function Ix(n){return Math.max(0,Math.min(1,n||0))}function Tk(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}function kk(n,e,t,r,i){var s=n*n,o=s*n;return((1-3*n+3*s-o)*e+(4-6*s+3*o)*t+(1+3*n+3*s-3*o)*r+o*i)/6}function CU(n){var e=n.length-1;return function(t){var r=t<=0?t=0:t>=1?(t=1,e-1):Math.floor(t*e),i=n[r],s=n[r+1],o=r>0?n[r-1]:2*i-s,a=r<e-1?n[r+2]:2*s-i;return kk((t-r/e)*e,o,i,s,a)}}function AU(n){var e=n.length;return function(t){var r=Math.floor(((t%=1)<0?++t:t)*e),i=n[(r+e-1)%e],s=n[r%e],o=n[(r+1)%e],a=n[(r+2)%e];return kk((t-r/e)*e,i,s,o,a)}}var mp=n=>()=>n;function pee(n,e){return function(t){return n+t*e}}function mee(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function EU(n){return(n=+n)==1?Mx:function(e,t){return t-e?mee(e,t,n):mp(isNaN(e)?t:e)}}function Mx(n,e){var t=e-n;return t?pee(n,t):mp(isNaN(n)?e:n)}var Xo=function n(e){var t=EU(e);function r(i,s){var o=t((i=Hd(i)).r,(s=Hd(s)).r),a=t(i.g,s.g),l=t(i.b,s.b),c=Mx(i.opacity,s.opacity);return function(u){return i.r=o(u),i.g=a(u),i.b=l(u),i.opacity=c(u),i+""}}return r.gamma=n,r}(1);function TU(n){return function(e){var t=e.length,r=new Array(t),i=new Array(t),s=new Array(t),o,a;for(o=0;o<t;++o)a=Hd(e[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=n(r),i=n(i),s=n(s),a.opacity=1,function(l){return a.r=r(l),a.g=i(l),a.b=s(l),a+""}}}var gee=TU(CU),yee=TU(AU);function kU(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,r=e.slice(),i;return function(s){for(i=0;i<t;++i)r[i]=n[i]*(1-s)+e[i]*s;return r}}function IU(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function PU(n,e){var t=e?e.length:0,r=n?Math.min(t,n.length):0,i=new Array(r),s=new Array(t),o;for(o=0;o<r;++o)i[o]=v1(n[o],e[o]);for(;o<t;++o)s[o]=e[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function DU(n,e){var t=new Date;return n=+n,e=+e,function(r){return t.setTime(n*(1-r)+e*r),t}}function wr(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function MU(n,e){var t={},r={},i;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in n?t[i]=v1(n[i],e[i]):r[i]=e[i];return function(s){for(i in t)r[i]=t[i](s);return r}}var Pk=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ik=new RegExp(Pk.source,"g");function xee(n){return function(){return n}}function bee(n){return function(e){return n(e)+""}}function gp(n,e){var t=Pk.lastIndex=Ik.lastIndex=0,r,i,s,o=-1,a=[],l=[];for(n=n+"",e=e+"";(r=Pk.exec(n))&&(i=Ik.exec(e));)(s=i.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:wr(r,i)})),t=Ik.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?bee(l[0].x):xee(e):(e=l.length,function(c){for(var u=0,d;u<e;++u)a[(d=l[u]).i]=d.x(c);return a.join("")})}function v1(n,e){var t=typeof e,r;return e==null||t==="boolean"?mp(e):(t==="number"?wr:t==="string"?(r=oo(e))?(e=r,Xo):gp:e instanceof oo?Xo:e instanceof Date?DU:IU(e)?kU:Array.isArray(e)?PU:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?MU:wr)(n,e)}function Dk(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}var RU=180/Math.PI,Rx={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Mk(n,e,t,r,i,s){var o,a,l;return(o=Math.sqrt(n*n+e*e))&&(n/=o,e/=o),(l=n*t+e*r)&&(t-=n*l,r-=e*l),(a=Math.sqrt(t*t+r*r))&&(t/=a,r/=a,l/=a),n*r<e*t&&(n=-n,e=-e,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,n)*RU,skewX:Math.atan(l)*RU,scaleX:o,scaleY:a}}var Fx;function FU(n){let e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?Rx:Mk(e.a,e.b,e.c,e.d,e.e,e.f)}function BU(n){return n==null?Rx:(Fx||(Fx=document.createElementNS("http://www.w3.org/2000/svg","g")),Fx.setAttribute("transform",n),(n=Fx.transform.baseVal.consolidate())?(n=n.matrix,Mk(n.a,n.b,n.c,n.d,n.e,n.f)):Rx)}function NU(n,e,t,r){function i(c){return c.length?c.pop()+" ":""}function s(c,u,d,f,h,p){if(c!==d||u!==f){var m=h.push("translate(",null,e,null,t);p.push({i:m-4,x:wr(c,d)},{i:m-2,x:wr(u,f)})}else(d||f)&&h.push("translate("+d+e+f+t)}function o(c,u,d,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:d.push(i(d)+"rotate(",null,r)-2,x:wr(c,u)})):u&&d.push(i(d)+"rotate("+u+r)}function a(c,u,d,f){c!==u?f.push({i:d.push(i(d)+"skewX(",null,r)-2,x:wr(c,u)}):u&&d.push(i(d)+"skewX("+u+r)}function l(c,u,d,f,h,p){if(c!==d||u!==f){var m=h.push(i(h)+"scale(",null,",",null,")");p.push({i:m-4,x:wr(c,d)},{i:m-2,x:wr(u,f)})}else(d!==1||f!==1)&&h.push(i(h)+"scale("+d+","+f+")")}return function(c,u){var d=[],f=[];return c=n(c),u=n(u),s(c.translateX,c.translateY,u.translateX,u.translateY,d,f),o(c.rotate,u.rotate,d,f),a(c.skewX,u.skewX,d,f),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,f),c=u=null,function(h){for(var p=-1,m=f.length,g;++p<m;)d[(g=f[p]).i]=g.x(h);return d.join("")}}}var Rk=NU(FU,"px, ","px)","deg)"),Fk=NU(BU,", ",")",")");var _ee=1e-12;function OU(n){return((n=Math.exp(n))+1/n)/2}function vee(n){return((n=Math.exp(n))-1/n)/2}function wee(n){return((n=Math.exp(2*n))-1)/(n+1)}var Bk=function n(e,t,r){function i(s,o){var a=s[0],l=s[1],c=s[2],u=o[0],d=o[1],f=o[2],h=u-a,p=d-l,m=h*h+p*p,g,y;if(m<_ee)y=Math.log(f/c)/e,g=function(k){return[a+k*h,l+k*p,c*Math.exp(e*k*y)]};else{var x=Math.sqrt(m),b=(f*f-c*c+r*m)/(2*c*t*x),_=(f*f-c*c-r*m)/(2*f*t*x),S=Math.log(Math.sqrt(b*b+1)-b),C=Math.log(Math.sqrt(_*_+1)-_);y=(C-S)/e,g=function(k){var v=k*y,w=OU(S),A=c/(t*x)*(w*wee(e*v+S)-vee(S));return[a+A*h,l+A*p,c*w/OU(e*v+S)]}}return g.duration=y*1e3*e/Math.SQRT2,g}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,l=a*a;return n(o,a,l)},i}(Math.SQRT2,2,4);var Pe=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;var De=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}`;var LU=`in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform float uGamma;
uniform float uContrast;
uniform float uSaturation;
uniform float uBrightness;
uniform vec4 uColor;

void main()
{
    vec4 c = texture(uTexture, vTextureCoord);

    if (c.a > 0.0) {
        c.rgb /= c.a;

        vec3 rgb = pow(c.rgb, vec3(1. / uGamma));
        rgb = mix(vec3(.5), mix(vec3(dot(vec3(.2125, .7154, .0721), rgb)), rgb, uSaturation), uContrast);
        rgb.r *= uColor.r;
        rgb.g *= uColor.g;
        rgb.b *= uColor.b;
        c.rgb = rgb * uBrightness;

        c.rgb *= c.a;
    }

    finalColor = c * uColor.a;
}
`;var UU=`struct AdjustmentUniforms {
  uGamma: f32,
  uContrast: f32,
  uSaturation: f32,
  uBrightness: f32,
  uColor: vec4<f32>,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> adjustmentUniforms : AdjustmentUniforms;

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
  var sample = textureSample(uTexture, uSampler, uv);
  let color = adjustmentUniforms.uColor;

  if (sample.a > 0.0) 
  {
    sample = vec4<f32>(sample.rgb / sample.a, sample.a);
    var rgb: vec3<f32> = pow(sample.rgb, vec3<f32>(1. / adjustmentUniforms.uGamma));
    rgb = mix(vec3<f32>(.5), mix(vec3<f32>(dot(vec3<f32>(.2125, .7154, .0721), rgb)), rgb, adjustmentUniforms.uSaturation), adjustmentUniforms.uContrast);
    rgb.r *= color.r;
    rgb.g *= color.g;
    rgb.b *= color.b;
    sample = vec4<f32>(rgb.rgb * adjustmentUniforms.uBrightness, sample.a);
    sample = vec4<f32>(sample.rgb * sample.a, sample.a);
  }

  return sample * color.a;
}`;var See=Object.defineProperty,Cee=(n,e,t)=>e in n?See(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,GU=(n,e,t)=>(Cee(n,typeof e!="symbol"?e+"":e,t),t),$U=class zU extends be{constructor(e){e={...zU.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:UU,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:LU,name:"adjustment-filter"});super({gpuProgram:t,glProgram:r,resources:{adjustmentUniforms:{uGamma:{value:e.gamma,type:"f32"},uContrast:{value:e.contrast,type:"f32"},uSaturation:{value:e.saturation,type:"f32"},uBrightness:{value:e.brightness,type:"f32"},uColor:{value:[e.red,e.green,e.blue,e.alpha],type:"vec4<f32>"}}}}),GU(this,"uniforms"),this.uniforms=this.resources.adjustmentUniforms.uniforms}get gamma(){return this.uniforms.uGamma}set gamma(e){this.uniforms.uGamma=e}get contrast(){return this.uniforms.uContrast}set contrast(e){this.uniforms.uContrast=e}get saturation(){return this.uniforms.uSaturation}set saturation(e){this.uniforms.uSaturation=e}get brightness(){return this.uniforms.uBrightness}set brightness(e){this.uniforms.uBrightness=e}get red(){return this.uniforms.uColor[0]}set red(e){this.uniforms.uColor[0]=e}get green(){return this.uniforms.uColor[1]}set green(e){this.uniforms.uColor[1]=e}get blue(){return this.uniforms.uColor[2]}set blue(e){this.uniforms.uColor[2]=e}get alpha(){return this.uniforms.uColor[3]}set alpha(e){this.uniforms.uColor[3]=e}};GU($U,"DEFAULT_OPTIONS",{gamma:1,contrast:1,saturation:1,brightness:1,red:1,green:1,blue:1,alpha:1});var Nk=$U;var HU=`
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uOffset;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture(uTexture, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample top right pixel
    color += texture(uTexture, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample bottom right pixel
    color += texture(uTexture, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));

    // Sample bottom left pixel
    color += texture(uTexture, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));

    // Average
    color *= 0.25;

    finalColor = color;
}`;var WU=`struct KawaseBlurUniforms {
  uOffset:vec2<f32>,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> kawaseBlurUniforms : KawaseBlurUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uOffset = kawaseBlurUniforms.uOffset;
  var color: vec4<f32> = vec4<f32>(0.0);

  // Sample top left pixel
  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x - uOffset.x, uv.y + uOffset.y));
  // Sample top right pixel
  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x + uOffset.x, uv.y + uOffset.y));
  // Sample bottom right pixel
  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x + uOffset.x, uv.y - uOffset.y));
  // Sample bottom left pixel
  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x - uOffset.x, uv.y - uOffset.y));
  // Average
  color *= 0.25;

  return color;
}`;var VU=`
precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uOffset;

uniform vec4 uInputClamp;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture(uTexture, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), uInputClamp.xy, uInputClamp.zw));

    // Sample top right pixel
    color += texture(uTexture, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), uInputClamp.xy, uInputClamp.zw));

    // Sample bottom right pixel
    color += texture(uTexture, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), uInputClamp.xy, uInputClamp.zw));

    // Sample bottom left pixel
    color += texture(uTexture, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), uInputClamp.xy, uInputClamp.zw));

    // Average
    color *= 0.25;

    finalColor = color;
}
`;var jU=`struct KawaseBlurUniforms {
  uOffset:vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> kawaseBlurUniforms : KawaseBlurUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uOffset = kawaseBlurUniforms.uOffset;
  var color: vec4<f32> = vec4(0.0);

  // Sample top left pixel
  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x - uOffset.x, uv.y + uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));
  // Sample top right pixel
  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x + uOffset.x, uv.y + uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));
  // Sample bottom right pixel
  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x + uOffset.x, uv.y - uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));
  // Sample bottom left pixel
  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x - uOffset.x, uv.y - uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));
  // Average
  color *= 0.25;
    
  return color;
}`;var Aee=Object.defineProperty,Eee=(n,e,t)=>e in n?Aee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,w1=(n,e,t)=>(Eee(n,typeof e!="symbol"?e+"":e,t),t),XU=class qU extends be{constructor(...e){let t=e[0]??{};(typeof t=="number"||Array.isArray(t))&&(oe("6.0.0","KawaseBlurFilter constructor params are now options object. See params: { strength, quality, clamp, pixelSize }"),t={strength:t},e[1]!==void 0&&(t.quality=e[1]),e[2]!==void 0&&(t.clamp=e[2])),t={...qU.DEFAULT_OPTIONS,...t};let r=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:t?.clamp?jU:WU,entryPoint:"mainFragment"}}),i=he.from({vertex:Pe,fragment:t?.clamp?VU:HU,name:"kawase-blur-filter"});super({gpuProgram:r,glProgram:i,resources:{kawaseBlurUniforms:{uOffset:{value:new Float32Array(2),type:"vec2<f32>"}}}}),w1(this,"uniforms"),w1(this,"_pixelSize",{x:0,y:0}),w1(this,"_clamp"),w1(this,"_kernels",[]),w1(this,"_blur"),w1(this,"_quality"),this.uniforms=this.resources.kawaseBlurUniforms.uniforms,this.pixelSize=t.pixelSize??{x:1,y:1},Array.isArray(t.strength)?this.kernels=t.strength:typeof t.strength=="number"&&(this._blur=t.strength,this.quality=t.quality??3),this._clamp=!!t.clamp}apply(e,t,r,i){let s=this.pixelSizeX/t.source.width,o=this.pixelSizeY/t.source.height,a;if(this._quality===1||this._blur===0)a=this._kernels[0]+.5,this.uniforms.uOffset[0]=a*s,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,t,r,i);else{let l=rt.getSameSizeTexture(t),c=t,u=l,d,f=this._quality-1;for(let h=0;h<f;h++)a=this._kernels[h]+.5,this.uniforms.uOffset[0]=a*s,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,c,u,!0),d=c,c=u,u=d;a=this._kernels[f]+.5,this.uniforms.uOffset[0]=a*s,this.uniforms.uOffset[1]=a*o,e.applyFilter(this,c,r,i),rt.returnTexture(l)}}get strength(){return this._blur}set strength(e){this._blur=e,this._generateKernels()}get quality(){return this._quality}set quality(e){this._quality=Math.max(1,Math.round(e)),this._generateKernels()}get kernels(){return this._kernels}set kernels(e){Array.isArray(e)&&e.length>0?(this._kernels=e,this._quality=e.length,this._blur=Math.max(...e)):(this._kernels=[0],this._quality=1)}get pixelSize(){return this._pixelSize}set pixelSize(e){if(typeof e=="number"){this.pixelSizeX=this.pixelSizeY=e;return}if(Array.isArray(e)){this.pixelSizeX=e[0],this.pixelSizeY=e[1];return}this._pixelSize=e}get pixelSizeX(){return this.pixelSize.x}set pixelSizeX(e){this.pixelSize.x=e}get pixelSizeY(){return this.pixelSize.y}set pixelSizeY(e){this.pixelSize.y=e}get clamp(){return this._clamp}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce((e,t)=>e+t+.5,0))}_generateKernels(){let e=this._blur,t=this._quality,r=[e];if(e>0){let i=e,s=e/t;for(let o=1;o<t;o++)i-=s,r.push(i)}this._kernels=r,this._updatePadding()}};w1(XU,"DEFAULT_OPTIONS",{strength:4,quality:3,clamp:!1,pixelSize:{x:1,y:1}});var yp=XU;var YU=`in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform sampler2D uMapTexture;
uniform float uBloomScale;
uniform float uBrightness;

void main() {
    vec4 color = texture(uTexture, vTextureCoord);
    color.rgb *= uBrightness;
    vec4 bloomColor = vec4(texture(uMapTexture, vTextureCoord).rgb, 0.0);
    bloomColor.rgb *= uBloomScale;
    finalColor = color + bloomColor;
}
`;var KU=`struct AdvancedBloomUniforms {
  uBloomScale: f32,
  uBrightness: f32,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> advancedBloomUniforms : AdvancedBloomUniforms;
@group(1) @binding(1) var uMapTexture: texture_2d<f32>;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  var color = textureSample(uTexture, uSampler, uv);
  color = vec4<f32>(color.rgb * advancedBloomUniforms.uBrightness, color.a);

  var bloomColor = vec4<f32>(textureSample(uMapTexture, uSampler, uv).rgb, 0.0);
  bloomColor = vec4<f32>(bloomColor.rgb * advancedBloomUniforms.uBloomScale, bloomColor.a);
  
  return color + bloomColor;
}
`;var QU=`
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform float uThreshold;

void main() {
    vec4 color = texture(uTexture, vTextureCoord);

    // A simple & fast algorithm for getting brightness.
    // It's inaccuracy , but good enought for this feature.
    float _max = max(max(color.r, color.g), color.b);
    float _min = min(min(color.r, color.g), color.b);
    float brightness = (_max + _min) * 0.5;

    if(brightness > uThreshold) {
        finalColor = color;
    } else {
        finalColor = vec4(0.0, 0.0, 0.0, 0.0);
    }
}
`;var ZU=`struct ExtractBrightnessUniforms {
  uThreshold: f32,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> extractBrightnessUniforms : ExtractBrightnessUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let color: vec4<f32> = textureSample(uTexture, uSampler, uv);

  // A simple & fast algorithm for getting brightness.
  // It's inaccurate, but good enough for this feature.
  let max: f32 = max(max(color.r, color.g), color.b);
  let min: f32 = min(min(color.r, color.g), color.b);
  let brightness: f32 = (max + min) * 0.5;

  return select(vec4<f32>(0.), color, brightness > extractBrightnessUniforms.uThreshold);
}
`;var Tee=Object.defineProperty,kee=(n,e,t)=>e in n?Tee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,JU=(n,e,t)=>(kee(n,typeof e!="symbol"?e+"":e,t),t),eG=class tG extends be{constructor(e){e={...tG.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:ZU,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:QU,name:"extract-brightness-filter"});super({gpuProgram:t,glProgram:r,resources:{extractBrightnessUniforms:{uThreshold:{value:e.threshold,type:"f32"}}}}),JU(this,"uniforms"),this.uniforms=this.resources.extractBrightnessUniforms.uniforms}get threshold(){return this.uniforms.uThreshold}set threshold(e){this.uniforms.uThreshold=e}};JU(eG,"DEFAULT_OPTIONS",{threshold:.5});var rG=eG;var Iee=Object.defineProperty,Pee=(n,e,t)=>e in n?Iee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Wd=(n,e,t)=>(Pee(n,typeof e!="symbol"?e+"":e,t),t),Dee=class nG extends be{constructor(e){e={...nG.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:KU,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:YU,name:"advanced-bloom-filter"});super({gpuProgram:t,glProgram:r,resources:{advancedBloomUniforms:{uBloomScale:{value:e.bloomScale,type:"f32"},uBrightness:{value:e.brightness,type:"f32"}},uMapTexture:re.WHITE}}),Wd(this,"uniforms"),Wd(this,"bloomScale",1),Wd(this,"brightness",1),Wd(this,"_extractFilter"),Wd(this,"_blurFilter"),this.uniforms=this.resources.advancedBloomUniforms.uniforms,this._extractFilter=new rG({threshold:e.threshold}),this._blurFilter=new yp({strength:e.kernels??e.blur,quality:e.kernels?void 0:e.quality}),Object.assign(this,e)}apply(e,t,r,i){let s=rt.getSameSizeTexture(t);this._extractFilter.apply(e,t,s,!0);let o=rt.getSameSizeTexture(t);this._blurFilter.apply(e,s,o,!0),this.uniforms.uBloomScale=this.bloomScale,this.uniforms.uBrightness=this.brightness,this.resources.uMapTexture=o.source,e.applyFilter(this,t,r,i),rt.returnTexture(o),rt.returnTexture(s)}get threshold(){return this._extractFilter.threshold}set threshold(e){this._extractFilter.threshold=e}get kernels(){return this._blurFilter.kernels}set kernels(e){this._blurFilter.kernels=e}get blur(){return this._blurFilter.strength}set blur(e){this._blurFilter.strength=e}get quality(){return this._blurFilter.quality}set quality(e){this._blurFilter.quality=e}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(e){typeof e=="number"&&(e={x:e,y:e}),Array.isArray(e)&&(e={x:e[0],y:e[1]}),this._blurFilter.pixelSize=e}get pixelSizeX(){return this._blurFilter.pixelSizeX}set pixelSizeX(e){this._blurFilter.pixelSizeX=e}get pixelSizeY(){return this._blurFilter.pixelSizeY}set pixelSizeY(e){this._blurFilter.pixelSizeY=e}};Wd(Dee,"DEFAULT_OPTIONS",{threshold:.5,bloomScale:1,brightness:1,blur:8,quality:4,pixelSize:{x:1,y:1}});var iG=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform float uSize;
uniform vec3 uColor;
uniform float uReplaceColor;

uniform vec4 uInputSize;

vec2 mapCoord( vec2 coord )
{
    coord *= uInputSize.xy;
    coord += uInputSize.zw;

    return coord;
}

vec2 unmapCoord( vec2 coord )
{
    coord -= uInputSize.zw;
    coord /= uInputSize.xy;

    return coord;
}

vec2 pixelate(vec2 coord, vec2 size)
{
    return floor(coord / size) * size;
}

vec2 getMod(vec2 coord, vec2 size)
{
    return mod(coord, size) / size;
}

float character(float n, vec2 p)
{
    p = floor(p*vec2(4.0, 4.0) + 2.5);

    if (clamp(p.x, 0.0, 4.0) == p.x)
    {
        if (clamp(p.y, 0.0, 4.0) == p.y)
        {
            if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;
        }
    }
    return 0.0;
}

void main()
{
    vec2 coord = mapCoord(vTextureCoord);

    // get the grid position
    vec2 pixCoord = pixelate(coord, vec2(uSize));
    pixCoord = unmapCoord(pixCoord);

    // sample the color at grid position
    vec4 color = texture(uTexture, pixCoord);

    // brightness of the color as it's perceived by the human eye
    float gray = 0.3 * color.r + 0.59 * color.g + 0.11 * color.b;

    // determine the character to use
    float n =  65536.0;             // .
    if (gray > 0.2) n = 65600.0;    // :
    if (gray > 0.3) n = 332772.0;   // *
    if (gray > 0.4) n = 15255086.0; // o
    if (gray > 0.5) n = 23385164.0; // &
    if (gray > 0.6) n = 15252014.0; // 8
    if (gray > 0.7) n = 13199452.0; // @
    if (gray > 0.8) n = 11512810.0; // #

    // get the mod..
    vec2 modd = getMod(coord, vec2(uSize));

    finalColor = (uReplaceColor > 0.5 ? vec4(uColor, 1.) : color) * character( n, vec2(-1.0) + modd * 2.0);
}
`;var sG=`struct AsciiUniforms {
    uSize: f32,
    uColor: vec3<f32>,
    uReplaceColor: f32,
};

struct GlobalFilterUniforms {
    uInputSize:vec4<f32>,
    uInputPixel:vec4<f32>,
    uInputClamp:vec4<f32>,
    uOutputFrame:vec4<f32>,
    uGlobalFrame:vec4<f32>,
    uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> asciiUniforms : AsciiUniforms;

@fragment
fn mainFragment(
    @location(0) uv: vec2<f32>,
    @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
    let pixelSize: f32 = asciiUniforms.uSize;
    let coord: vec2<f32> = mapCoord(uv);

    // get the rounded color..
    var pixCoord: vec2<f32> = pixelate(coord, vec2<f32>(pixelSize));
    pixCoord = unmapCoord(pixCoord);

    var color = textureSample(uTexture, uSampler, pixCoord);

    // determine the character to use
    let gray: f32 = 0.3 * color.r + 0.59 * color.g + 0.11 * color.b;
    
    var n: f32 = 65536.0; // .
    if (gray > 0.2) {
        n = 65600.0;    // :
    }
    if (gray > 0.3) {
        n = 332772.0;   // *
    }
    if (gray > 0.4) {
        n = 15255086.0; // o
    }
    if (gray > 0.5) {
        n = 23385164.0; // &
    }
    if (gray > 0.6) {
        n = 15252014.0; // 8
    }
    if (gray > 0.7) {
        n = 13199452.0; // @
    }
    if (gray > 0.8) {
        n = 11512810.0; // #
    }

    // get the mod..
    let modd: vec2<f32> = getMod(coord, vec2<f32>(pixelSize));
    return select(color, vec4<f32>(asciiUniforms.uColor, 1.), asciiUniforms.uReplaceColor > 0.5) * character(n, vec2<f32>(-1.0) + modd * 2.0);
}

fn pixelate(coord: vec2<f32>, size: vec2<f32>) -> vec2<f32>
{
    return floor( coord / size ) * size;
}

fn getMod(coord: vec2<f32>, size: vec2<f32>) -> vec2<f32>
{
    return moduloVec2( coord , size) / size;
}

fn character(n: f32, p: vec2<f32>) -> f32
{
    var q: vec2<f32> = floor(p*vec2<f32>(4.0, 4.0) + 2.5);

    if (clamp(q.x, 0.0, 4.0) == q.x)
    {
        if (clamp(q.y, 0.0, 4.0) == q.y)
        {
        if (i32(modulo(n/exp2(q.x + 5.0*q.y), 2.0)) == 1)
        {
            return 1.0;
        }
        }
    }

    return 0.0;
}

fn modulo(x: f32, y: f32) -> f32
{
  return x - y * floor(x/y);
}

fn moduloVec2(x: vec2<f32>, y: vec2<f32>) -> vec2<f32>
{
  return x - y * floor(x/y);
}

fn mapCoord(coord: vec2<f32> ) -> vec2<f32>
{
    var mappedCoord: vec2<f32> = coord;
    mappedCoord *= gfu.uInputSize.xy;
    mappedCoord += gfu.uOutputFrame.xy;
    return mappedCoord;
}

fn unmapCoord(coord: vec2<f32> ) -> vec2<f32>
{
    var mappedCoord: vec2<f32> = coord;
    mappedCoord -= gfu.uOutputFrame.xy;
    mappedCoord /= gfu.uInputSize.xy;
    return mappedCoord;
}`;var Mee=Object.defineProperty,Ree=(n,e,t)=>e in n?Mee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ok=(n,e,t)=>(Ree(n,typeof e!="symbol"?e+"":e,t),t),Fee=class oG extends be{constructor(...e){let t=e[0]??{};typeof t=="number"&&(oe("6.0.0","AsciiFilter constructor params are now options object. See params: { size, color, replaceColor }"),t={size:t});let r=t?.color&&t.replaceColor!==!1;t={...oG.DEFAULT_OPTIONS,...t};let i=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:sG,entryPoint:"mainFragment"}}),s=he.from({vertex:Pe,fragment:iG,name:"ascii-filter"});super({gpuProgram:i,glProgram:s,resources:{asciiUniforms:{uSize:{value:t.size,type:"f32"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uReplaceColor:{value:Number(r),type:"f32"}}}}),Ok(this,"uniforms"),Ok(this,"_color"),this.uniforms=this.resources.asciiUniforms.uniforms,this._color=new ce,this.color=t.color??16777215}get size(){return this.uniforms.uSize}set size(e){this.uniforms.uSize=e}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,i]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=i}get replaceColor(){return this.uniforms.uReplaceColor>.5}set replaceColor(e){this.uniforms.uReplaceColor=e?1:0}};Ok(Fee,"DEFAULT_OPTIONS",{size:8,color:16777215,replaceColor:!1});var aG=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uTransform;
uniform vec3 uLightColor;
uniform float uLightAlpha;
uniform vec3 uShadowColor;
uniform float uShadowAlpha;

uniform vec4 uInputSize;

void main(void) {
    vec2 transform = vec2(1.0 / uInputSize) * vec2(uTransform.x, uTransform.y);
    vec4 color = texture(uTexture, vTextureCoord);
    float light = texture(uTexture, vTextureCoord - transform).a;
    float shadow = texture(uTexture, vTextureCoord + transform).a;

    color.rgb = mix(color.rgb, uLightColor, clamp((color.a - light) * uLightAlpha, 0.0, 1.0));
    color.rgb = mix(color.rgb, uShadowColor, clamp((color.a - shadow) * uShadowAlpha, 0.0, 1.0));
    finalColor = vec4(color.rgb * color.a, color.a);
}
`;var lG=`struct BevelUniforms {
  uLightColor: vec3<f32>,
  uLightAlpha: f32,
  uShadowColor: vec3<f32>,
  uShadowAlpha: f32,
  uTransform: vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> bevelUniforms : BevelUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let transform = vec2<f32>(1.0 / gfu.uInputSize.xy) * vec2<f32>(bevelUniforms.uTransform.x, bevelUniforms.uTransform.y);
  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);
  let lightSample: f32 = textureSample(uTexture, uSampler, uv - transform).a;
  let shadowSample: f32 = textureSample(uTexture, uSampler, uv + transform).a;

  let light = vec4<f32>(bevelUniforms.uLightColor, bevelUniforms.uLightAlpha);
  let shadow = vec4<f32>(bevelUniforms.uShadowColor, bevelUniforms.uShadowAlpha);

  color = vec4<f32>(mix(color.rgb, light.rgb, clamp((color.a - lightSample) * light.a, 0.0, 1.0)), color.a);
  color = vec4<f32>(mix(color.rgb, shadow.rgb, clamp((color.a - shadowSample) * shadow.a, 0.0, 1.0)), color.a);
  
  return vec4<f32>(color.rgb * color.a, color.a);
}`;var Bee=Object.defineProperty,Nee=(n,e,t)=>e in n?Bee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Vd=(n,e,t)=>(Nee(n,typeof e!="symbol"?e+"":e,t),t),Oee=class cG extends be{constructor(e){e={...cG.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:lG,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:aG,name:"bevel-filter"});super({gpuProgram:t,glProgram:r,resources:{bevelUniforms:{uLightColor:{value:new Float32Array(3),type:"vec3<f32>"},uLightAlpha:{value:e.lightAlpha,type:"f32"},uShadowColor:{value:new Float32Array(3),type:"vec3<f32>"},uShadowAlpha:{value:e.shadowAlpha,type:"f32"},uTransform:{value:new Float32Array(2),type:"vec2<f32>"}}},padding:1}),Vd(this,"uniforms"),Vd(this,"_thickness"),Vd(this,"_rotation"),Vd(this,"_lightColor"),Vd(this,"_shadowColor"),this.uniforms=this.resources.bevelUniforms.uniforms,this._lightColor=new ce,this._shadowColor=new ce,this.lightColor=e.lightColor??16777215,this.shadowColor=e.shadowColor??0,Object.assign(this,e)}get rotation(){return this._rotation/ds}set rotation(e){this._rotation=e*ds,this._updateTransform()}get thickness(){return this._thickness}set thickness(e){this._thickness=e,this._updateTransform()}get lightColor(){return this._lightColor.value}set lightColor(e){this._lightColor.setValue(e);let[t,r,i]=this._lightColor.toArray();this.uniforms.uLightColor[0]=t,this.uniforms.uLightColor[1]=r,this.uniforms.uLightColor[2]=i}get lightAlpha(){return this.uniforms.uLightAlpha}set lightAlpha(e){this.uniforms.uLightAlpha=e}get shadowColor(){return this._shadowColor.value}set shadowColor(e){this._shadowColor.setValue(e);let[t,r,i]=this._shadowColor.toArray();this.uniforms.uShadowColor[0]=t,this.uniforms.uShadowColor[1]=r,this.uniforms.uShadowColor[2]=i}get shadowAlpha(){return this.uniforms.uShadowAlpha}set shadowAlpha(e){this.uniforms.uShadowAlpha=e}_updateTransform(){this.uniforms.uTransform[0]=this.thickness*Math.cos(this._rotation),this.uniforms.uTransform[1]=this.thickness*Math.sin(this._rotation)}};Vd(Oee,"DEFAULT_OPTIONS",{rotation:45,thickness:2,lightColor:16777215,lightAlpha:.7,shadowColor:0,shadowAlpha:.7});var Lee=Object.defineProperty,Uee=(n,e,t)=>e in n?Lee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Bx=(n,e,t)=>(Uee(n,typeof e!="symbol"?e+"":e,t),t),Gee=class uG extends Yy{constructor(...e){let t=e[0]??{};if(typeof t=="number"||Array.isArray(t)||"x"in t&&"y"in t){oe("6.0.0","BloomFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }");let r=t;Array.isArray(r)&&(r={x:r[0],y:r[1]}),t={strength:r},e[1]!==void 0&&(t.quality=e[1]),e[2]!==void 0&&(t.resolution=e[2]),e[3]!==void 0&&(t.kernelSize=e[3])}t={...uG.DEFAULT_OPTIONS,...t},super(),Bx(this,"_blurXFilter"),Bx(this,"_blurYFilter"),Bx(this,"_strength"),this._strength={x:2,y:2},t.strength&&(typeof t.strength=="number"?(this._strength.x=t.strength,this._strength.y=t.strength):(this._strength.x=t.strength.x,this._strength.y=t.strength.y)),this._blurXFilter=new Oa({...t,horizontal:!0,strength:this.strengthX}),this._blurYFilter=new Oa({...t,horizontal:!1,strength:this.strengthY}),this._blurYFilter.blendMode="screen",Object.assign(this,t)}apply(e,t,r,i){let s=rt.getSameSizeTexture(t);e.applyFilter(this,t,r,i),this._blurXFilter.apply(e,t,s,!0),this._blurYFilter.apply(e,s,r,!1),rt.returnTexture(s)}get strength(){return this._strength}set strength(e){this._strength=typeof e=="number"?{x:e,y:e}:e,this._updateStrength()}get strengthX(){return this.strength.x}set strengthX(e){this.strength.x=e,this._updateStrength()}get strengthY(){return this.strength.y}set strengthY(e){this.strength.y=e,this._updateStrength()}_updateStrength(){this._blurXFilter.blur=this.strengthX,this._blurYFilter.blur=this.strengthY}get blur(){return oe("6.0.0","BloomFilter.blur is deprecated, please use BloomFilter.strength instead"),this.strengthX}set blur(e){oe("6.0.0","BloomFilter.blur is deprecated, please use BloomFilter.strength instead"),this.strength=e}get blurX(){return oe("6.0.0","BloomFilter.blurX is deprecated, please use BloomFilter.strengthX instead"),this.strengthX}set blurX(e){oe("6.0.0","BloomFilter.blurX is deprecated, please use BloomFilter.strengthX instead"),this.strengthX=e}get blurY(){return oe("6.0.0","BloomFilter.blurY is deprecated, please use BloomFilter.strengthY instead"),this.strengthY}set blurY(e){oe("6.0.0","BloomFilter.blurY is deprecated, please use BloomFilter.strengthY instead"),this.strengthY=e}};Bx(Gee,"DEFAULT_OPTIONS",{strength:{x:2,y:2},quality:4,resolution:1,kernelSize:5});var dG=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uDimensions;
uniform vec2 uCenter;
uniform float uRadius;
uniform float uStrength;

uniform vec4 uInputSize;
uniform vec4 uInputClamp;

void main()
{
    vec2 coord = vTextureCoord * uInputSize.xy;
    coord -= uCenter * uDimensions.xy;
    float distance = length(coord);

    if (distance < uRadius) {
        float percent = distance / uRadius;
        if (uStrength > 0.0) {
            coord *= mix(1.0, smoothstep(0.0, uRadius / distance, percent), uStrength * 0.75);
        } else {
            coord *= mix(1.0, pow(percent, 1.0 + uStrength * 0.75) * uRadius / distance, 1.0 - percent);
        }
    }

    coord += uCenter * uDimensions.xy;
    coord /= uInputSize.xy;
    vec2 clampedCoord = clamp(coord, uInputClamp.xy, uInputClamp.zw);
    vec4 color = texture(uTexture, clampedCoord);

    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    finalColor = color;
}
`;var fG=`struct BulgePinchUniforms {
  uDimensions: vec2<f32>,
  uCenter: vec2<f32>,
  uRadius: f32,
  uStrength: f32,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> bulgePinchUniforms : BulgePinchUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let dimensions: vec2<f32> = bulgePinchUniforms.uDimensions;
  let center: vec2<f32> = bulgePinchUniforms.uCenter;
  let radius: f32 = bulgePinchUniforms.uRadius;
  let strength: f32 = bulgePinchUniforms.uStrength;
  var coord: vec2<f32> = (uv * gfu.uInputSize.xy) - center * dimensions.xy;

  let distance: f32 = length(coord);

  if (distance < radius) {
      let percent: f32 = distance / radius;
      if (strength > 0.0) {
          coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);
      } else {
          coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);
      }
  }
    coord += (center * dimensions.xy);
    coord /= gfu.uInputSize.xy;

    let clampedCoord: vec2<f32> = clamp(coord, gfu.uInputClamp.xy, gfu.uInputClamp.zw);
    var color: vec4<f32> = textureSample(uTexture, uSampler, clampedCoord);
    if (coord.x != clampedCoord.x && coord.y != clampedCoord.y) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    return color;
}

fn compareVec2(x: vec2<f32>, y: vec2<f32>) -> bool
{
  if (x.x == y.x && x.y == y.y)
  {
    return true;
  }

  return false;
}`;var $ee=Object.defineProperty,zee=(n,e,t)=>e in n?$ee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,hG=(n,e,t)=>(zee(n,typeof e!="symbol"?e+"":e,t),t),Hee=class pG extends be{constructor(e){e={...pG.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:fG,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:dG,name:"bulge-pinch-filter"});super({gpuProgram:t,glProgram:r,resources:{bulgePinchUniforms:{uDimensions:{value:[0,0],type:"vec2<f32>"},uCenter:{value:e.center,type:"vec2<f32>"},uRadius:{value:e.radius,type:"f32"},uStrength:{value:e.strength,type:"f32"}}}}),hG(this,"uniforms"),this.uniforms=this.resources.bulgePinchUniforms.uniforms,Object.assign(this,e)}apply(e,t,r,i){this.uniforms.uDimensions[0]=t.frame.width,this.uniforms.uDimensions[1]=t.frame.height,e.applyFilter(this,t,r,i)}get center(){return this.uniforms.uCenter}set center(e){typeof e=="number"&&(e={x:e,y:e}),Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uCenter=e}get centerX(){return this.uniforms.uCenter.x}set centerX(e){this.uniforms.uCenter.x=e}get centerY(){return this.uniforms.uCenter.y}set centerY(e){this.uniforms.uCenter.y=e}get radius(){return this.uniforms.uRadius}set radius(e){this.uniforms.uRadius=e}get strength(){return this.uniforms.uStrength}set strength(e){this.uniforms.uStrength=e}};hG(Hee,"DEFAULT_OPTIONS",{center:{x:.5,y:.5},radius:100,strength:1});var mG=`precision highp float;
in vec2 vTextureCoord;
in vec2 vFilterCoord;
out vec4 finalColor;

const int TYPE_LINEAR = 0;
const int TYPE_RADIAL = 1;
const int TYPE_CONIC = 2;
const int MAX_STOPS = 32;

uniform sampler2D uTexture;
uniform vec4 uOptions;
uniform vec2 uCounts;
uniform vec3 uColors[MAX_STOPS];
uniform vec4 uStops[MAX_STOPS];

const float PI = 3.1415926538;
const float PI_2 = PI*2.;

struct ColorStop {
    float offset;
    vec3 color;
    float alpha;
};

mat2 rotate2d(float angle){
    return mat2(cos(angle), -sin(angle),
    sin(angle), cos(angle));
}

float projectLinearPosition(vec2 pos, float angle){
    vec2 center = vec2(0.5);
    vec2 result = pos - center;
    result = rotate2d(angle) * result;
    result = result + center;
    return clamp(result.x, 0., 1.);
}

float projectRadialPosition(vec2 pos) {
    float r = distance(pos, vec2(0.5));
    return clamp(2.*r, 0., 1.);
}

float projectAnglePosition(vec2 pos, float angle) {
    vec2 center = pos - vec2(0.5);
    float polarAngle=atan(-center.y, center.x);
    return mod(polarAngle + angle, PI_2) / PI_2;
}

float projectPosition(vec2 pos, int type, float angle) {
    if (type == TYPE_LINEAR) {
        return projectLinearPosition(pos, angle);
    } else if (type == TYPE_RADIAL) {
        return projectRadialPosition(pos);
    } else if (type == TYPE_CONIC) {
        return projectAnglePosition(pos, angle);
    }

    return pos.y;
}

void main(void) {
    int uType = int(uOptions[0]);
    float uAngle = uOptions[1];
    float uAlpha = uOptions[2];
    float uReplace = uOptions[3];

    int uNumStops = int(uCounts[0]);
    float uMaxColors = uCounts[1];

    // current/original color
    vec4 currentColor = texture(uTexture, vTextureCoord);

    // skip calculations if gradient alpha is 0
    if (0.0 == uAlpha) {
        finalColor = currentColor;
        return;
    }

    // project position
    float y = projectPosition(vFilterCoord, int(uType), radians(uAngle));

    // check gradient bounds
    float offsetMin = uStops[0][0];
    float offsetMax = 0.0;

    int numStops = int(uNumStops);

    for (int i = 0; i < MAX_STOPS; i++) {
        if (i == numStops-1){ // last index
            offsetMax = uStops[i][0];
        }
    }

    if (y  < offsetMin || y > offsetMax) {
        finalColor = currentColor;
        return;
    }

    // limit colors
    if (uMaxColors > 0.) {
        float stepSize = 1./uMaxColors;
        float stepNumber = float(floor(y/stepSize));
        y = stepSize * (stepNumber + 0.5);// offset by 0.5 to use color from middle of segment
    }

    // find color stops
    ColorStop from;
    ColorStop to;

    for (int i = 0; i < MAX_STOPS; i++) {
        if (y >= uStops[i][0]) {
            from = ColorStop(uStops[i][0], uColors[i], uStops[i][1]);
            to = ColorStop(uStops[i+1][0], uColors[i+1], uStops[i+1][1]);
        }

        if (i == numStops-1){ // last index
            break;
        }
    }

    // mix colors from stops
    vec4 colorFrom = vec4(from.color * from.alpha, from.alpha);
    vec4 colorTo = vec4(to.color * to.alpha, to.alpha);

    float segmentHeight = to.offset - from.offset;
    float relativePos = y - from.offset;// position from 0 to [segmentHeight]
    float relativePercent = relativePos / segmentHeight;// position in percent between [from.offset] and [to.offset].

    float gradientAlpha = uAlpha * currentColor.a;
    vec4 gradientColor = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;

    if (uReplace < 0.5) {
        // mix resulting color with current color
        finalColor = gradientColor + currentColor*(1.-gradientColor.a);
    } else {
        // replace with gradient color
        finalColor = gradientColor;
    }
}
`;var gG=`in vec2 aPosition;
out vec2 vTextureCoord;
out vec2 vFilterCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
    vFilterCoord = vTextureCoord * uInputSize.xy / uOutputFrame.zw;
}
`;var Lk=`struct BaseUniforms {
  uOptions: vec4<f32>,
  uCounts: vec2<f32>,
};

struct StopsUniforms {
  uColors: array<vec3<f32>, MAX_STOPS>,
  uStops: array<vec4<f32>, MAX_STOPS>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> baseUniforms : BaseUniforms;
@group(1) @binding(1) var<uniform> stopsUniforms : StopsUniforms;

struct VSOutput {
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>,
  @location(1) coord : vec2<f32>
};

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn filterCoord( vTextureCoord:vec2<f32> ) -> vec2<f32>
{
    return vTextureCoord * gfu.uInputSize.xy / gfu.uOutputFrame.zw;
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  let vTextureCoord: vec2<f32> = filterTextureCoord(aPosition);
  return VSOutput(
   filterVertexPosition(aPosition),
   vTextureCoord,
   filterCoord(vTextureCoord),
  );
}

struct ColorStop {
  offset: f32,
  color: vec3<f32>,
  alpha: f32,
};

fn rotate2d(angle: f32) -> mat2x2<f32>{
  return mat2x2(cos(angle), -sin(angle),
  sin(angle), cos(angle));
}

fn projectLinearPosition(pos: vec2<f32>, angle: f32) -> f32 {
  var center: vec2<f32> = vec2<f32>(0.5);
  var result: vec2<f32> = pos - center;
  result = rotate2d(angle) * result;
  result = result + center;
  return clamp(result.x, 0.0, 1.0);
}

fn projectRadialPosition(pos: vec2<f32>) -> f32 {
  var r: f32 = distance(pos, vec2<f32>(0.5));
  return clamp(2.0 * r, 0.0, 1.0);
}

fn projectAnglePosition(pos: vec2<f32>, angle: f32) -> f32 {
  var center: vec2<f32> = pos - vec2<f32>(0.5, 0.5);
  var polarAngle: f32 = atan2(-center.y, center.x);
  return ((polarAngle + angle) % PI_2) / PI_2;
}

fn projectPosition(pos: vec2<f32>, gradientType: i32, angle: f32) -> f32 {
  if (gradientType == TYPE_LINEAR) {
      return projectLinearPosition(pos, angle);
  } else if (gradientType == TYPE_RADIAL) {
      return projectRadialPosition(pos);
  } else if (gradientType == TYPE_CONIC) {
      return projectAnglePosition(pos, angle);
  }

  return pos.y;
}

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>,
  @location(1) coord : vec2<f32>
) -> @location(0) vec4<f32> {
  let uType: i32 = i32(baseUniforms.uOptions[0]);
  let uAngle: f32 = baseUniforms.uOptions[1];
  let uAlpha: f32 = baseUniforms.uOptions[2];
  let uReplace: f32 = baseUniforms.uOptions[3];

  let uNumStops: i32 = i32(baseUniforms.uCounts[0]);
  let uMaxColors: f32 = baseUniforms.uCounts[1];

  // current/original color
  var currentColor: vec4<f32> = textureSample(uTexture, uSampler, uv);

  // skip calculations if gradient alpha is 0
  if (uAlpha == 0.0) { return currentColor; }

  // project position
  var y: f32 = projectPosition(coord, uType, radians(uAngle));

  // check gradient bounds
  var offsetMin: f32 = stopsUniforms.uStops[0][0];
  var offsetMax: f32 = 0.0;

  let numStops: i32 = uNumStops;

  for (var i: i32 = 0; i < MAX_STOPS; i = i + 1) {
      if (i == numStops - 1) { // last index
          offsetMax = stopsUniforms.uStops[i][0];
      }
  }

  if (y  < offsetMin || y > offsetMax) { return currentColor; }

  // limit colors
  if (uMaxColors > 0.0) {
      var stepSize: f32 = 1.0 / uMaxColors;
      var stepNumber: f32 = floor(y / stepSize);
      y = stepSize * (stepNumber + 0.5); // offset by 0.5 to use color from middle of segment
  }

  // find color stops
  var stopFrom: ColorStop;
  var stopTo: ColorStop;

  for (var i: i32 = 0; i < MAX_STOPS; i = i + 1) {
      if (y >= stopsUniforms.uStops[i][0]) {
          stopFrom = ColorStop(stopsUniforms.uStops[i][0], stopsUniforms.uColors[i], stopsUniforms.uStops[i][1]);
          stopTo = ColorStop(stopsUniforms.uStops[i + 1][0], stopsUniforms.uColors[i + 1], stopsUniforms.uStops[i + 1][1]);
      }

      if (i == numStops - 1) { // last index
          break;
      }
  }

  // mix colors from stops
  var colorFrom: vec4<f32> = vec4<f32>(stopFrom.color * stopFrom.alpha, stopFrom.alpha);
  var colorTo: vec4<f32> = vec4<f32>(stopTo.color * stopTo.alpha, stopTo.alpha);

  var segmentHeight: f32 = stopTo.offset - stopFrom.offset;
  var relativePos: f32 = y - stopFrom.offset; // position from 0 to [segmentHeight]
  var relativePercent: f32 = relativePos / segmentHeight; // position in percent between [from.offset] and [to.offset].

  var gradientAlpha: f32 = uAlpha * currentColor.a;
  var gradientColor: vec4<f32> = mix(colorFrom, colorTo, relativePercent) * gradientAlpha;

  if (uReplace < 0.5) {
      // mix resulting color with current color
      return gradientColor + currentColor * (1.0 - gradientColor.a);
  } else {
      // replace with gradient color
      return gradientColor;
  }
}

const PI: f32 = 3.14159265358979323846264;
const PI_2: f32 = PI * 2.0;

const TYPE_LINEAR: i32 = 0;
const TYPE_RADIAL: i32 = 1;
const TYPE_CONIC: i32 = 2;
const MAX_STOPS: i32 = 32;`;var S1=S1||{};S1.stringify=function(){var n={"visit_linear-gradient":function(e){return n.visit_gradient(e)},"visit_repeating-linear-gradient":function(e){return n.visit_gradient(e)},"visit_radial-gradient":function(e){return n.visit_gradient(e)},"visit_repeating-radial-gradient":function(e){return n.visit_gradient(e)},visit_gradient:function(e){var t=n.visit(e.orientation);return t&&(t+=", "),e.type+"("+t+n.visit(e.colorStops)+")"},visit_shape:function(e){var t=e.value,r=n.visit(e.at),i=n.visit(e.style);return i&&(t+=" "+i),r&&(t+=" at "+r),t},"visit_default-radial":function(e){var t="",r=n.visit(e.at);return r&&(t+=r),t},"visit_extent-keyword":function(e){var t=e.value,r=n.visit(e.at);return r&&(t+=" at "+r),t},"visit_position-keyword":function(e){return e.value},visit_position:function(e){return n.visit(e.value.x)+" "+n.visit(e.value.y)},"visit_%":function(e){return e.value+"%"},visit_em:function(e){return e.value+"em"},visit_px:function(e){return e.value+"px"},visit_literal:function(e){return n.visit_color(e.value,e)},visit_hex:function(e){return n.visit_color("#"+e.value,e)},visit_rgb:function(e){return n.visit_color("rgb("+e.value.join(", ")+")",e)},visit_rgba:function(e){return n.visit_color("rgba("+e.value.join(", ")+")",e)},visit_color:function(e,t){var r=e,i=n.visit(t.length);return i&&(r+=" "+i),r},visit_angular:function(e){return e.value+"deg"},visit_directional:function(e){return"to "+e.value},visit_array:function(e){var t="",r=e.length;return e.forEach(function(i,s){t+=n.visit(i),s<r-1&&(t+=", ")}),t},visit:function(e){if(!e)return"";var t="";if(e instanceof Array)return n.visit_array(e,t);if(e.type){var r=n["visit_"+e.type];if(r)return r(e);throw Error("Missing visitor visit_"+e.type)}else throw Error("Invalid node.")}};return function(e){return n.visit(e)}}();var S1=S1||{};S1.parse=function(){var n={linearGradient:/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,repeatingLinearGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,radialGradient:/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,repeatingRadialGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},e="";function t(D){var N=new Error(e+": "+D);throw N.source=e,N}function r(){var D=i();return e.length>0&&t("Invalid input not EOF"),D}function i(){return b(s)}function s(){return o("linear-gradient",n.linearGradient,l)||o("repeating-linear-gradient",n.repeatingLinearGradient,l)||o("radial-gradient",n.radialGradient,d)||o("repeating-radial-gradient",n.repeatingRadialGradient,d)}function o(D,N,F){return a(N,function(B){var O=F();return O&&(R(n.comma)||t("Missing comma before color stops")),{type:D,orientation:O,colorStops:b(_)}})}function a(D,N){var F=R(D);if(F){R(n.startCall)||t("Missing (");var B=N(F);return R(n.endCall)||t("Missing )"),B}}function l(){return c()||u()}function c(){return T("directional",n.sideOrCorner,1)}function u(){return T("angular",n.angleValue,1)}function d(){var D,N=f(),F;return N&&(D=[],D.push(N),F=e,R(n.comma)&&(N=f(),N?D.push(N):e=F)),D}function f(){var D=h()||p();if(D)D.at=g();else{var N=m();if(N){D=N;var F=g();F&&(D.at=F)}else{var B=y();B&&(D={type:"default-radial",at:B})}}return D}function h(){var D=T("shape",/^(circle)/i,0);return D&&(D.style=M()||m()),D}function p(){var D=T("shape",/^(ellipse)/i,0);return D&&(D.style=E()||m()),D}function m(){return T("extent-keyword",n.extentKeywords,1)}function g(){if(T("position",/^at/,0)){var D=y();return D||t("Missing positioning value"),D}}function y(){var D=x();if(D.x||D.y)return{type:"position",value:D}}function x(){return{x:E(),y:E()}}function b(D){var N=D(),F=[];if(N)for(F.push(N);R(n.comma);)N=D(),N?F.push(N):t("One extra comma");return F}function _(){var D=S();return D||t("Expected color definition"),D.length=E(),D}function S(){return k()||w()||v()||C()}function C(){return T("literal",n.literalColor,0)}function k(){return T("hex",n.hexColor,1)}function v(){return a(n.rgbColor,function(){return{type:"rgb",value:b(A)}})}function w(){return a(n.rgbaColor,function(){return{type:"rgba",value:b(A)}})}function A(){return R(n.number)[1]}function E(){return T("%",n.percentageValue,1)||I()||M()}function I(){return T("position-keyword",n.positionKeywords,1)}function M(){return T("px",n.pixelValue,1)||T("em",n.emValue,1)}function T(D,N,F){var B=R(N);if(B)return{type:D,value:B[F]}}function R(D){var N,F;return F=/^[\n\r\t\s]+/.exec(e),F&&P(F[0].length),N=D.exec(e),N&&P(N[0].length),N}function P(D){e=e.substr(D)}return function(D){return e=D.toString(),r()}}();var yG=S1.parse;S1.stringify;function Uk(n){let e=yG(CG(n));if(e.length===0)throw new Error("Invalid CSS gradient.");if(e.length!==1)throw new Error("Unsupported CSS gradient (multiple gradients is not supported).");let t=e[0],r=xG(t.type),i=bG(t.colorStops),s=wG(t.orientation);return{type:r,stops:i,angle:s}}function xG(n){let e={"linear-gradient":0,"radial-gradient":1};if(!(n in e))throw new Error(`Unsupported gradient type "${n}"`);return e[n]}function bG(n){let e=vG(n),t=[],r=new ce;for(let i=0;i<n.length;i++){let s=_G(n[i]),o=r.setValue(s).toArray();t.push({offset:e[i],color:o.slice(0,3),alpha:o[3]})}return t}function _G(n){switch(n.type){case"hex":return`#${n.value}`;case"literal":return n.value;default:return`${n.type}(${n.value.join(",")})`}}function vG(n){let e=[];for(let s=0;s<n.length;s++){let o=n[s],a=-1;o.type==="literal"&&o.length&&"type"in o.length&&o.length.type==="%"&&"value"in o.length&&(a=parseFloat(o.length.value)/100),e.push(a)}let r=s=>{for(let o=s;o<e.length;o++)if(e[o]!==-1)return{indexDelta:o-s,offset:e[o]};return{indexDelta:e.length-1-s,offset:1}},i=0;for(let s=0;s<e.length;s++){let o=e[s];if(o!==-1)i=o;else if(s===0)e[s]=0;else if(s+1===e.length)e[s]=1;else{let a=r(s),c=(a.offset-i)/(1+a.indexDelta);for(let u=0;u<=a.indexDelta;u++)e[s+u]=i+(u+1)*c;s+=a.indexDelta,i=e[s]}}return e.map(Wee)}function Wee(n){return n.toString().length>6?parseFloat(n.toString().substring(0,6)):n}function wG(n){if(typeof n>"u")return 0;if("type"in n&&"value"in n)switch(n.type){case"angular":return parseFloat(n.value);case"directional":return SG(n.value)}return 0}function SG(n){let e={left:270,top:0,bottom:180,right:90,"left top":315,"top left":315,"left bottom":225,"bottom left":225,"right top":45,"top right":45,"right bottom":135,"bottom right":135};if(!(n in e))throw new Error(`Unsupported directional value "${n}"`);return e[n]}function CG(n){let e=n.replace(/\s{2,}/gu," ");return e=e.replace(/;/g,""),e=e.replace(/ ,/g,","),e=e.replace(/\( /g,"("),e=e.replace(/ \)/g,")"),e.trim()}var Vee=Object.defineProperty,jee=(n,e,t)=>e in n?Vee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,C1=(n,e,t)=>(jee(n,typeof e!="symbol"?e+"":e,t),t),Gk=90;function Xee(n){return[...n].sort((e,t)=>e.offset-t.offset)}var xp=class Nx extends be{constructor(e){if(e&&"css"in e?e={...Uk(e.css||""),alpha:e.alpha??Nx.defaults.alpha,maxColors:e.maxColors??Nx.defaults.maxColors}:e={...Nx.defaults,...e},!e.stops||e.stops.length<2)throw new Error("ColorGradientFilter requires at least 2 color stops.");let t=pe.from({vertex:{source:Lk,entryPoint:"mainVertex"},fragment:{source:Lk,entryPoint:"mainFragment"}}),r=he.from({vertex:gG,fragment:mG,name:"color-gradient-filter"}),i=32;super({gpuProgram:t,glProgram:r,resources:{baseUniforms:{uOptions:{value:[e.type,e.angle??Gk,e.alpha,e.replace?1:0],type:"vec4<f32>"},uCounts:{value:[e.stops.length,e.maxColors],type:"vec2<f32>"}},stopsUniforms:{uColors:{value:new Float32Array(i*3),type:"vec3<f32>",size:i},uStops:{value:new Float32Array(i*4),type:"vec4<f32>",size:i}}}}),C1(this,"baseUniforms"),C1(this,"stopsUniforms"),C1(this,"_stops",[]),this.baseUniforms=this.resources.baseUniforms.uniforms,this.stopsUniforms=this.resources.stopsUniforms.uniforms,Object.assign(this,e)}get stops(){return this._stops}set stops(e){let t=Xee(e),r=new ce,i,s,o;for(let a=0;a<t.length;a++){r.setValue(t[a].color);let l=a*3;[i,s,o]=r.toArray(),this.stopsUniforms.uColors[l]=i,this.stopsUniforms.uColors[l+1]=s,this.stopsUniforms.uColors[l+2]=o,this.stopsUniforms.uStops[a*4]=t[a].offset,this.stopsUniforms.uStops[a*4+1]=t[a].alpha}this.baseUniforms.uCounts[0]=t.length,this._stops=t}get type(){return this.baseUniforms.uOptions[0]}set type(e){this.baseUniforms.uOptions[0]=e}get angle(){return this.baseUniforms.uOptions[1]+Gk}set angle(e){this.baseUniforms.uOptions[1]=e-Gk}get alpha(){return this.baseUniforms.uOptions[2]}set alpha(e){this.baseUniforms.uOptions[2]=e}get maxColors(){return this.baseUniforms.uCounts[1]}set maxColors(e){this.baseUniforms.uCounts[1]=e}get replace(){return this.baseUniforms.uOptions[3]>.5}set replace(e){this.baseUniforms.uOptions[3]=e?1:0}};C1(xp,"LINEAR",0);C1(xp,"RADIAL",1);C1(xp,"CONIC",2);C1(xp,"defaults",{type:xp.LINEAR,stops:[{offset:0,color:16711680,alpha:1},{offset:1,color:255,alpha:1}],alpha:1,angle:90,maxColors:0,replace:!1});var AG=`in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform sampler2D uMapTexture;
uniform float uMix;
uniform float uSize;
uniform float uSliceSize;
uniform float uSlicePixelSize;
uniform float uSliceInnerSize;

void main() {
    vec4 color = texture(uTexture, vTextureCoord.xy);
    vec4 adjusted;

    if (color.a > 0.0) {
        color.rgb /= color.a;
        float innerWidth = uSize - 1.0;
        float zSlice0 = min(floor(color.b * innerWidth), innerWidth);
        float zSlice1 = min(zSlice0 + 1.0, innerWidth);
        float xOffset = uSlicePixelSize * 0.5 + color.r * uSliceInnerSize;
        float s0 = xOffset + (zSlice0 * uSliceSize);
        float s1 = xOffset + (zSlice1 * uSliceSize);
        float yOffset = uSliceSize * 0.5 + color.g * (1.0 - uSliceSize);
        vec4 slice0Color = texture(uMapTexture, vec2(s0,yOffset));
        vec4 slice1Color = texture(uMapTexture, vec2(s1,yOffset));
        float zOffset = fract(color.b * innerWidth);
        adjusted = mix(slice0Color, slice1Color, zOffset);

        color.rgb *= color.a;
    }

    finalColor = vec4(mix(color, adjusted, uMix).rgb, color.a);

}`;var EG=`struct ColorMapUniforms {
  uMix: f32,
  uSize: f32,
  uSliceSize: f32,
  uSlicePixelSize: f32,
  uSliceInnerSize: f32,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> colorMapUniforms : ColorMapUniforms;
@group(1) @binding(1) var uMapTexture: texture_2d<f32>;
@group(1) @binding(2) var uMapSampler: sampler;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  var color:vec4<f32> = textureSample(uTexture, uSampler, uv);

  var adjusted: vec4<f32>;

  var altColor: vec4<f32> = vec4<f32>(color.rgb / color.a, color.a);
  let innerWidth: f32 = colorMapUniforms.uSize - 1.0;
  let zSlice0: f32 = min(floor(color.b * innerWidth), innerWidth);
  let zSlice1: f32 = min(zSlice0 + 1.0, innerWidth);
  let xOffset: f32 = colorMapUniforms.uSlicePixelSize * 0.5 + color.r * colorMapUniforms.uSliceInnerSize;
  let s0: f32 = xOffset + (zSlice0 * colorMapUniforms.uSliceSize);
  let s1: f32 = xOffset + (zSlice1 * colorMapUniforms.uSliceSize);
  let yOffset: f32 = colorMapUniforms.uSliceSize * 0.5 + color.g * (1.0 - colorMapUniforms.uSliceSize);
  let slice0Color: vec4<f32> = textureSample(uMapTexture, uMapSampler, vec2(s0,yOffset));
  let slice1Color: vec4<f32> = textureSample(uMapTexture, uMapSampler, vec2(s1,yOffset));
  let zOffset: f32 = fract(color.b * innerWidth);
  adjusted = mix(slice0Color, slice1Color, zOffset);
  altColor = vec4<f32>(color.rgb * color.a, color.a);

  let realColor: vec4<f32> = select(color, altColor, color.a > 0.0);

  return vec4<f32>(mix(realColor, adjusted, colorMapUniforms.uMix).rgb, realColor.a);
}`;var qee=Object.defineProperty,Yee=(n,e,t)=>e in n?qee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,La=(n,e,t)=>(Yee(n,typeof e!="symbol"?e+"":e,t),t),Kee=class TG extends be{constructor(...e){let t=e[0]??{};if((t instanceof re||t instanceof ot)&&(oe("6.0.0","ColorMapFilter constructor params are now options object. See params: { colorMap, nearest, mix }"),t={colorMap:t},e[1]!==void 0&&(t.nearest=e[1]),e[2]!==void 0&&(t.mix=e[2])),t={...TG.DEFAULT_OPTIONS,...t},!t.colorMap)throw Error("No color map texture source was provided to ColorMapFilter");let r=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:EG,entryPoint:"mainFragment"}}),i=he.from({vertex:Pe,fragment:AG,name:"color-map-filter"});super({gpuProgram:r,glProgram:i,resources:{colorMapUniforms:{uMix:{value:t.mix,type:"f32"},uSize:{value:0,type:"f32"},uSliceSize:{value:0,type:"f32"},uSlicePixelSize:{value:0,type:"f32"},uSliceInnerSize:{value:0,type:"f32"}},uMapTexture:t.colorMap.source,uMapSampler:t.colorMap.source.style}}),La(this,"uniforms"),La(this,"_size",0),La(this,"_sliceSize",0),La(this,"_slicePixelSize",0),La(this,"_sliceInnerSize",0),La(this,"_nearest",!1),La(this,"_scaleMode","linear"),La(this,"_colorMap"),this.uniforms=this.resources.colorMapUniforms.uniforms,Object.assign(this,t)}get mix(){return this.uniforms.uMix}set mix(e){this.uniforms.uMix=e}get colorSize(){return this._size}get colorMap(){return this._colorMap}set colorMap(e){if(!e||e===this.colorMap)return;let t=e instanceof re?e.source:e;t.style.scaleMode=this._scaleMode,t.autoGenerateMipmaps=!1,this._size=t.height,this._sliceSize=1/this._size,this._slicePixelSize=this._sliceSize/this._size,this._sliceInnerSize=this._slicePixelSize*(this._size-1),this.uniforms.uSize=this._size,this.uniforms.uSliceSize=this._sliceSize,this.uniforms.uSlicePixelSize=this._slicePixelSize,this.uniforms.uSliceInnerSize=this._sliceInnerSize,this.resources.uMapTexture=t,this._colorMap=e}get nearest(){return this._nearest}set nearest(e){this._nearest=e,this._scaleMode=e?"nearest":"linear";let t=this._colorMap;t&&t.source&&(t.source.scaleMode=this._scaleMode,t.source.autoGenerateMipmaps=!1,t.source.style.update(),t.source.update())}updateColorMap(){let e=this._colorMap;e?.source&&(e.source.update(),this.colorMap=e)}destroy(){this._colorMap?.destroy(),super.destroy()}};La(Kee,"DEFAULT_OPTIONS",{colorMap:re.WHITE,nearest:!1,mix:1});var kG=`in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uColor;
uniform float uAlpha;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);
    finalColor = vec4(mix(c.rgb, uColor.rgb, c.a * uAlpha), c.a);
}
`;var IG=`struct ColorOverlayUniforms {
    uColor: vec3<f32>,
    uAlpha: f32,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> colorOverlayUniforms : ColorOverlayUniforms;

@fragment
fn mainFragment(
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
    let c = textureSample(uTexture, uSampler, uv);
    return vec4<f32>(mix(c.rgb, colorOverlayUniforms.uColor.rgb, c.a * colorOverlayUniforms.uAlpha), c.a);
}
`;var Qee=Object.defineProperty,Zee=(n,e,t)=>e in n?Qee(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$k=(n,e,t)=>(Zee(n,typeof e!="symbol"?e+"":e,t),t),Jee=class PG extends be{constructor(...e){let t=e[0]??{};(typeof t=="number"||Array.isArray(t)||t instanceof Float32Array)&&(oe("6.0.0","ColorOverlayFilter constructor params are now options object. See params: { color, alpha }"),t={color:t},e[1]!==void 0&&(t.alpha=e[1])),t={...PG.DEFAULT_OPTIONS,...t};let r=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:IG,entryPoint:"mainFragment"}}),i=he.from({vertex:Pe,fragment:kG,name:"color-overlay-filter"});super({gpuProgram:r,glProgram:i,resources:{colorOverlayUniforms:{uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:t.alpha,type:"f32"}}}}),$k(this,"uniforms"),$k(this,"_color"),this.uniforms=this.resources.colorOverlayUniforms.uniforms,this._color=new ce,this.color=t.color??0}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,i]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=i}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};$k(Jee,"DEFAULT_OPTIONS",{color:0,alpha:1});var DG=`in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uOriginalColor;
uniform vec3 uTargetColor;
uniform float uTolerance;

void main(void) {
    vec4 c = texture(uTexture, vTextureCoord);
    vec3 colorDiff = uOriginalColor - (c.rgb / max(c.a, 0.0000000001));
    float colorDistance = length(colorDiff);
    float doReplace = step(colorDistance, uTolerance);
    finalColor = vec4(mix(c.rgb, (uTargetColor + colorDiff) * c.a, doReplace), c.a);
}
`;var MG=`struct ColorReplaceUniforms {
  uOriginalColor: vec3<f32>,
  uTargetColor: vec3<f32>,
  uTolerance: f32,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> colorReplaceUniforms : ColorReplaceUniforms;

@fragment
fn mainFragment(
   @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let sample: vec4<f32> = textureSample(uTexture, uSampler, uv);

  let colorDiff: vec3<f32> = colorReplaceUniforms.uOriginalColor - (sample.rgb / max(sample.a, 0.0000000001));
  let colorDistance: f32 = length(colorDiff);
  let doReplace: f32 = step(colorDistance, colorReplaceUniforms.uTolerance);

  return vec4<f32>(mix(sample.rgb, (colorReplaceUniforms.uTargetColor + colorDiff) * sample.a, doReplace), sample.a);
}`;var ete=Object.defineProperty,tte=(n,e,t)=>e in n?ete(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ox=(n,e,t)=>(tte(n,typeof e!="symbol"?e+"":e,t),t),rte=class RG extends be{constructor(...e){let t=e[0]??{};(typeof t=="number"||Array.isArray(t)||t instanceof Float32Array)&&(oe("6.0.0","ColorReplaceFilter constructor params are now options object. See params: { originalColor, targetColor, tolerance }"),t={originalColor:t},e[1]!==void 0&&(t.targetColor=e[1]),e[2]!==void 0&&(t.tolerance=e[2])),t={...RG.DEFAULT_OPTIONS,...t};let r=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:MG,entryPoint:"mainFragment"}}),i=he.from({vertex:Pe,fragment:DG,name:"color-replace-filter"});super({gpuProgram:r,glProgram:i,resources:{colorReplaceUniforms:{uOriginalColor:{value:new Float32Array(3),type:"vec3<f32>"},uTargetColor:{value:new Float32Array(3),type:"vec3<f32>"},uTolerance:{value:t.tolerance,type:"f32"}}}}),Ox(this,"uniforms"),Ox(this,"_originalColor"),Ox(this,"_targetColor"),this.uniforms=this.resources.colorReplaceUniforms.uniforms,this._originalColor=new ce,this._targetColor=new ce,this.originalColor=t.originalColor??16711680,this.targetColor=t.targetColor??0,Object.assign(this,t)}get originalColor(){return this._originalColor.value}set originalColor(e){this._originalColor.setValue(e);let[t,r,i]=this._originalColor.toArray();this.uniforms.uOriginalColor[0]=t,this.uniforms.uOriginalColor[1]=r,this.uniforms.uOriginalColor[2]=i}get targetColor(){return this._targetColor.value}set targetColor(e){this._targetColor.setValue(e);let[t,r,i]=this._targetColor.toArray();this.uniforms.uTargetColor[0]=t,this.uniforms.uTargetColor[1]=r,this.uniforms.uTargetColor[2]=i}get tolerance(){return this.uniforms.uTolerance}set tolerance(e){this.uniforms.uTolerance=e}set newColor(e){oe("6.0.0","ColorReplaceFilter.newColor is deprecated, please use ColorReplaceFilter.targetColor instead"),this.targetColor=e}get newColor(){return oe("6.0.0","ColorReplaceFilter.newColor is deprecated, please use ColorReplaceFilter.targetColor instead"),this.targetColor}set epsilon(e){oe("6.0.0","ColorReplaceFilter.epsilon is deprecated, please use ColorReplaceFilter.tolerance instead"),this.tolerance=e}get epsilon(){return oe("6.0.0","ColorReplaceFilter.epsilon is deprecated, please use ColorReplaceFilter.tolerance instead"),this.tolerance}};Ox(rte,"DEFAULT_OPTIONS",{originalColor:16711680,targetColor:0,tolerance:.4});var FG=`in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uTexelSize;
uniform mat3 uMatrix;

void main(void)
{
    vec4 c11 = texture(uTexture, vTextureCoord - uTexelSize); // top left
    vec4 c12 = texture(uTexture, vec2(vTextureCoord.x, vTextureCoord.y - uTexelSize.y)); // top center
    vec4 c13 = texture(uTexture, vec2(vTextureCoord.x + uTexelSize.x, vTextureCoord.y - uTexelSize.y)); // top right

    vec4 c21 = texture(uTexture, vec2(vTextureCoord.x - uTexelSize.x, vTextureCoord.y)); // mid left
    vec4 c22 = texture(uTexture, vTextureCoord); // mid center
    vec4 c23 = texture(uTexture, vec2(vTextureCoord.x + uTexelSize.x, vTextureCoord.y)); // mid right

    vec4 c31 = texture(uTexture, vec2(vTextureCoord.x - uTexelSize.x, vTextureCoord.y + uTexelSize.y)); // bottom left
    vec4 c32 = texture(uTexture, vec2(vTextureCoord.x, vTextureCoord.y + uTexelSize.y)); // bottom center
    vec4 c33 = texture(uTexture, vTextureCoord + uTexelSize); // bottom right

    finalColor =
        c11 * uMatrix[0][0] + c12 * uMatrix[0][1] + c13 * uMatrix[0][2] +
        c21 * uMatrix[1][0] + c22 * uMatrix[1][1] + c23 * uMatrix[1][2] +
        c31 * uMatrix[2][0] + c32 * uMatrix[2][1] + c33 * uMatrix[2][2];

    finalColor.a = c22.a;
}`;var BG=`struct ConvolutionUniforms {
    uMatrix: mat3x3<f32>,
    uTexelSize: vec2<f32>,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> convolutionUniforms : ConvolutionUniforms;

@fragment
fn mainFragment(
    @location(0) uv: vec2<f32>,
    @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
    let texelSize = convolutionUniforms.uTexelSize;
    let matrix = convolutionUniforms.uMatrix;

    let c11: vec4<f32> = textureSample(uTexture, uSampler, uv - texelSize); // top left
    let c12: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x, uv.y - texelSize.y)); // top center
    let c13: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x + texelSize.x, uv.y - texelSize.y)); // top right

    let c21: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x - texelSize.x, uv.y)); // mid left
    let c22: vec4<f32> = textureSample(uTexture, uSampler, uv); // mid center
    let c23: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x + texelSize.x, uv.y)); // mid right

    let c31: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x - texelSize.x, uv.y + texelSize.y)); // bottom left
    let c32: vec4<f32> = textureSample(uTexture, uSampler, vec2<f32>(uv.x, uv.y + texelSize.y)); // bottom center
    let c33: vec4<f32> = textureSample(uTexture, uSampler, uv + texelSize); // bottom right

    var finalColor: vec4<f32> = vec4<f32>(
        c11 * matrix[0][0] + c12 * matrix[0][1] + c13 * matrix[0][2] +
        c21 * matrix[1][0] + c22 * matrix[1][1] + c23 * matrix[1][2] +
        c31 * matrix[2][0] + c32 * matrix[2][1] + c33 * matrix[2][2]
    );

    finalColor.a = c22.a;

    return finalColor;
}`;var nte=Object.defineProperty,ite=(n,e,t)=>e in n?nte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,NG=(n,e,t)=>(ite(n,typeof e!="symbol"?e+"":e,t),t),OG=class LG extends be{constructor(...e){let t=e[0]??{};Array.isArray(t)&&(oe("6.0.0","ConvolutionFilter constructor params are now options object. See params: { matrix, width, height }"),t={matrix:t},e[1]!==void 0&&(t.width=e[1]),e[2]!==void 0&&(t.height=e[2])),t={...LG.DEFAULT_OPTIONS,...t};let r=t.width??200,i=t.height??200,s=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:BG,entryPoint:"mainFragment"}}),o=he.from({vertex:Pe,fragment:FG,name:"convolution-filter"});super({gpuProgram:s,glProgram:o,resources:{convolutionUniforms:{uMatrix:{value:t.matrix,type:"mat3x3<f32>"},uTexelSize:{value:{x:1/r,y:1/i},type:"vec2<f32>"}}}}),NG(this,"uniforms"),this.uniforms=this.resources.convolutionUniforms.uniforms,this.width=r,this.height=i}get matrix(){return this.uniforms.uMatrix}set matrix(e){e.forEach((t,r)=>{this.uniforms.uMatrix[r]=t})}get width(){return 1/this.uniforms.uTexelSize.x}set width(e){this.uniforms.uTexelSize.x=1/e}get height(){return 1/this.uniforms.uTexelSize.y}set height(e){this.uniforms.uTexelSize.y=1/e}};NG(OG,"DEFAULT_OPTIONS",{matrix:new Float32Array(9),width:200,height:200});var zk=OG;var UG=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec4 uLine;
uniform vec2 uNoise;
uniform vec3 uVignette;
uniform float uSeed;
uniform float uTime;
uniform vec2 uDimensions;

uniform vec4 uInputSize;

const float SQRT_2 = 1.414213;

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

float vignette(vec3 co, vec2 coord)
{
    float outter = SQRT_2 - uVignette[0] * SQRT_2;
    vec2 dir = vec2(0.5) - coord;
    dir.y *= uDimensions.y / uDimensions.x;
    float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + uVignette[2] * SQRT_2), 0.0, 1.0);
    return darker + (1.0 - darker) * (1.0 - uVignette[1]);
}

float noise(vec2 coord)
{
    vec2 pixelCoord = coord * uInputSize.xy;
    pixelCoord.x = floor(pixelCoord.x / uNoise[1]);
    pixelCoord.y = floor(pixelCoord.y / uNoise[1]);
    return (rand(pixelCoord * uNoise[1] * uSeed) - 0.5) * uNoise[0];
}

vec3 interlaceLines(vec3 co, vec2 coord)
{
    vec3 color = co;

    float curvature = uLine[0];
    float lineWidth = uLine[1];
    float lineContrast = uLine[2];
    float verticalLine = uLine[3];

    vec2 dir = vec2(coord * uInputSize.xy / uDimensions - 0.5);

    float _c = curvature > 0. ? curvature : 1.;
    float k = curvature > 0. ? (length(dir * dir) * 0.25 * _c * _c + 0.935 * _c) : 1.;
    vec2 uv = dir * k;
    float v = verticalLine > 0.5 ? uv.x * uDimensions.x : uv.y * uDimensions.y;
    v *= min(1.0, 2.0 / lineWidth ) / _c;
    float j = 1. + cos(v * 1.2 - uTime) * 0.5 * lineContrast;
    color *= j;

    float segment = verticalLine > 0.5 ? mod((dir.x + .5) * uDimensions.x, 4.) : mod((dir.y + .5) * uDimensions.y, 4.);
    color *= 0.99 + ceil(segment) * 0.015;

    return color;
}

void main(void)
{
    finalColor = texture(uTexture, vTextureCoord);
    vec2 coord = vTextureCoord * uInputSize.xy / uDimensions;

    if (uNoise[0] > 0.0 && uNoise[1] > 0.0)
    {
        float n = noise(vTextureCoord);
        finalColor += vec4(n, n, n, finalColor.a);
    }

    if (uVignette[0] > 0.)
    {
        float v = vignette(finalColor.rgb, coord);
        finalColor *= vec4(v, v, v, finalColor.a);
    }

    if (uLine[1] > 0.0)
    {
        finalColor = vec4(interlaceLines(finalColor.rgb, vTextureCoord), finalColor.a);  
    }
}
`;var GG=`struct CRTUniforms {
    uLine: vec4<f32>,
    uNoise: vec2<f32>,
    uVignette: vec3<f32>,
    uSeed: f32,
    uTime: f32,
    uDimensions: vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> crtUniforms : CRTUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
    
  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);
  let coord: vec2<f32> = uv * gfu.uInputSize.xy / crtUniforms.uDimensions;

  let uNoise = crtUniforms.uNoise;

  if (uNoise[0] > 0.0 && uNoise[1] > 0.0)
  {
    color += vec4<f32>(vec3<f32>(noise(uv)), color.a);
  }

  if (crtUniforms.uVignette[0] > 0.)
  {
    color *= vec4<f32>(vec3<f32>(vignette(color.rgb, coord)), color.a);
  }

  if (crtUniforms.uLine[1] > 0.0)
  {
    color = vec4<f32>(vec3<f32>(interlaceLines(color.rgb, uv)), color.a);  
  }

  return color;
}

const SQRT_2: f32 = 1.414213;

fn modulo(x: f32, y: f32) -> f32
{
  return x - y * floor(x/y);
}

fn rand(co: vec2<f32>) -> f32
{
  return fract(sin(dot(co, vec2<f32>(12.9898, 78.233))) * 43758.5453);
}

fn vignette(co: vec3<f32>, coord: vec2<f32>) -> f32
{
  let uVignette = crtUniforms.uVignette;
  let uDimensions = crtUniforms.uDimensions;
  
  let outter: f32 = SQRT_2 - uVignette[0] * SQRT_2;
  var dir: vec2<f32> = vec2<f32>(0.5) - coord;
  dir.y *= uDimensions.y / uDimensions.x;
  let darker: f32 = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + uVignette[2] * SQRT_2), 0.0, 1.0);
  return darker + (1.0 - darker) * (1.0 - uVignette[1]);
}

fn noise(coord: vec2<f32>) -> f32
{
  let uNoise = crtUniforms.uNoise;
  let uSeed = crtUniforms.uSeed;

  var pixelCoord: vec2<f32> = coord * gfu.uInputSize.xy;
  pixelCoord.x = floor(pixelCoord.x / uNoise[1]);
  pixelCoord.y = floor(pixelCoord.y / uNoise[1]);
  return (rand(pixelCoord * uNoise[1] * uSeed) - 0.5) * uNoise[0];
}

fn interlaceLines(co: vec3<f32>, coord: vec2<f32>) -> vec3<f32>
{
  var color = co;

  let uDimensions = crtUniforms.uDimensions;

  let curvature: f32 = crtUniforms.uLine[0];
  let lineWidth: f32 = crtUniforms.uLine[1];
  let lineContrast: f32 = crtUniforms.uLine[2];
  let verticalLine: f32 = crtUniforms.uLine[3];

  let dir: vec2<f32> = vec2<f32>(coord * gfu.uInputSize.xy / uDimensions - 0.5);

  let _c: f32 = select(1., curvature, curvature > 0.);
  let k: f32 = select(1., (length(dir * dir) * 0.25 * _c * _c + 0.935 * _c), curvature > 0.);
  let uv: vec2<f32> = dir * k;
  let v: f32 = select(uv.y * uDimensions.y, uv.x * uDimensions.x, verticalLine > 0.5) * min(1.0, 2.0 / lineWidth ) / _c;
  let j: f32 = 1. + cos(v * 1.2 - crtUniforms.uTime) * 0.5 * lineContrast;
  color *= j;

  let segment: f32 = select(modulo((dir.y + .5) * uDimensions.y, 4.), modulo((dir.x + .5) * uDimensions.x, 4.), verticalLine > 0.5);
  color *= 0.99 + ceil(segment) * 0.015;

  return color;
}`;var ste=Object.defineProperty,ote=(n,e,t)=>e in n?ste(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Lx=(n,e,t)=>(ote(n,typeof e!="symbol"?e+"":e,t),t),ate=class $G extends be{constructor(e){e={...$G.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:GG,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:UG,name:"crt-filter"});super({gpuProgram:t,glProgram:r,resources:{crtUniforms:{uLine:{value:new Float32Array(4),type:"vec4<f32>"},uNoise:{value:new Float32Array(2),type:"vec2<f32>"},uVignette:{value:new Float32Array(3),type:"vec3<f32>"},uSeed:{value:e.seed,type:"f32"},uTime:{value:e.time,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),Lx(this,"uniforms"),Lx(this,"seed"),Lx(this,"time"),this.uniforms=this.resources.crtUniforms.uniforms,Object.assign(this,e)}apply(e,t,r,i){this.uniforms.uDimensions[0]=t.frame.width,this.uniforms.uDimensions[1]=t.frame.height,this.uniforms.uSeed=this.seed,this.uniforms.uTime=this.time,e.applyFilter(this,t,r,i)}get curvature(){return this.uniforms.uLine[0]}set curvature(e){this.uniforms.uLine[0]=e}get lineWidth(){return this.uniforms.uLine[1]}set lineWidth(e){this.uniforms.uLine[1]=e}get lineContrast(){return this.uniforms.uLine[2]}set lineContrast(e){this.uniforms.uLine[2]=e}get verticalLine(){return this.uniforms.uLine[3]>.5}set verticalLine(e){this.uniforms.uLine[3]=e?1:0}get noise(){return this.uniforms.uNoise[0]}set noise(e){this.uniforms.uNoise[0]=e}get noiseSize(){return this.uniforms.uNoise[1]}set noiseSize(e){this.uniforms.uNoise[1]=e}get vignetting(){return this.uniforms.uVignette[0]}set vignetting(e){this.uniforms.uVignette[0]=e}get vignettingAlpha(){return this.uniforms.uVignette[1]}set vignettingAlpha(e){this.uniforms.uVignette[1]=e}get vignettingBlur(){return this.uniforms.uVignette[2]}set vignettingBlur(e){this.uniforms.uVignette[2]=e}};Lx(ate,"DEFAULT_OPTIONS",{curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:0,noiseSize:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0,seed:0});var zG=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform float uAngle;
uniform float uScale;
uniform bool uGrayScale;

uniform vec4 uInputSize;

float pattern()
{
    float s = sin(uAngle), c = cos(uAngle);
    vec2 tex = vTextureCoord * uInputSize.xy;
    vec2 point = vec2(
        c * tex.x - s * tex.y,
        s * tex.x + c * tex.y
    ) * uScale;
    return (sin(point.x) * sin(point.y)) * 4.0;
    }

    void main()
    {
    vec4 color = texture(uTexture, vTextureCoord);
    vec3 colorRGB = vec3(color);

    if (uGrayScale)
    {
        colorRGB = vec3(color.r + color.g + color.b) / 3.0;
    }

    finalColor = vec4(colorRGB * 10.0 - 5.0 + pattern(), color.a);
}
`;var HG=`struct DotUniforms {
  uScale:f32,
  uAngle:f32,
  uGrayScale:f32,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> dotUniforms : DotUniforms;

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
  let color: vec4<f32> = textureSample(uTexture, uSampler, uv);
  let gray: vec3<f32> = vec3<f32>(dot(color.rgb, vec3<f32>(0.299, 0.587, 0.114)));
  // dotUniforms.uGrayScale == 1 doesn't ever pass so it is converted to a float and compared to 0.5 instead 
  let finalColor: vec3<f32> = select(color.rgb, gray, f32(dotUniforms.uGrayScale) >= 0.5);

  return vec4<f32>(finalColor * 10.0 - 5.0 + pattern(uv), color.a);
}

fn pattern(uv: vec2<f32>) -> f32
{
  let s: f32 = sin(dotUniforms.uAngle);
  let c: f32 = cos(dotUniforms.uAngle);
  
  let tex: vec2<f32> = uv * gfu.uInputSize.xy;
  
  let p: vec2<f32> = vec2<f32>(
      c * tex.x - s * tex.y,
      s * tex.x + c * tex.y
  ) * dotUniforms.uScale;

  return (sin(p.x) * sin(p.y)) * 4.0;
}`;var lte=Object.defineProperty,cte=(n,e,t)=>e in n?lte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ute=(n,e,t)=>(cte(n,typeof e!="symbol"?e+"":e,t),t),dte=class WG extends be{constructor(...e){let t=e[0]??{};typeof t=="number"&&(oe("6.0.0","DotFilter constructor params are now options object. See params: { scale, angle, grayscale }"),t={scale:t},e[1]!==void 0&&(t.angle=e[1]),e[2]!==void 0&&(t.grayscale=e[2])),t={...WG.DEFAULT_OPTIONS,...t};let r={uScale:{value:t.scale,type:"f32"},uAngle:{value:t.angle,type:"f32"},uGrayScale:{value:t.grayscale?1:0,type:"f32"}},i=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:HG,entryPoint:"mainFragment"}}),s=he.from({vertex:Pe,fragment:zG,name:"dot-filter"});super({gpuProgram:i,glProgram:s,resources:{dotUniforms:r}})}get scale(){return this.resources.dotUniforms.uniforms.uScale}set scale(e){this.resources.dotUniforms.uniforms.uScale=e}get angle(){return this.resources.dotUniforms.uniforms.uAngle}set angle(e){this.resources.dotUniforms.uniforms.uAngle=e}get grayscale(){return this.resources.dotUniforms.uniforms.uGrayScale===1}set grayscale(e){this.resources.dotUniforms.uniforms.uGrayScale=e?1:0}};ute(dte,"DEFAULT_OPTIONS",{scale:1,angle:5,grayscale:!0});var VG=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform float uAlpha;
uniform vec3 uColor;
uniform vec2 uOffset;

uniform vec4 uInputSize;

void main(void){
    vec4 sample = texture(uTexture, vTextureCoord - uOffset * uInputSize.zw);

    // Premultiply alpha
    sample.rgb = uColor.rgb * sample.a;

    // alpha user alpha
    sample *= uAlpha;

    finalColor = sample;
}`;var jG=`struct DropShadowUniforms {
  uAlpha: f32,
  uColor: vec3<f32>,
  uOffset: vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> dropShadowUniforms : DropShadowUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  var color: vec4<f32> = textureSample(uTexture, uSampler, uv - dropShadowUniforms.uOffset * gfu.uInputSize.zw);

  // Premultiply alpha
  color = vec4<f32>(vec3<f32>(dropShadowUniforms.uColor.rgb * color.a), color.a);
  // alpha user alpha
  color *= dropShadowUniforms.uAlpha;

  return color;
}`;var fte=Object.defineProperty,hte=(n,e,t)=>e in n?fte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,jd=(n,e,t)=>(hte(n,typeof e!="symbol"?e+"":e,t),t),pte=class XG extends be{constructor(e){e={...XG.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:jG,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:VG,name:"drop-shadow-filter"});super({gpuProgram:t,glProgram:r,resources:{dropShadowUniforms:{uAlpha:{value:e.alpha,type:"f32"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uOffset:{value:e.offset,type:"vec2<f32>"}}},resolution:e.resolution}),jd(this,"uniforms"),jd(this,"shadowOnly",!1),jd(this,"_color"),jd(this,"_blurFilter"),jd(this,"_basePass"),this.uniforms=this.resources.dropShadowUniforms.uniforms,this._color=new ce,this.color=e.color??0,this._blurFilter=new yp({strength:e.kernels??e.blur,quality:e.kernels?void 0:e.quality}),this._basePass=new be({gpuProgram:pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:`
                    @group(0) @binding(1) var uTexture: texture_2d<f32>; 
                    @group(0) @binding(2) var uSampler: sampler;
                    @fragment
                    fn mainFragment(
                        @builtin(position) position: vec4<f32>,
                        @location(0) uv : vec2<f32>
                    ) -> @location(0) vec4<f32> {
                        return textureSample(uTexture, uSampler, uv);
                    }
                    `,entryPoint:"mainFragment"}}),glProgram:he.from({vertex:Pe,fragment:`
                in vec2 vTextureCoord;
                out vec4 finalColor;
                uniform sampler2D uTexture;

                void main(void){
                    finalColor = texture(uTexture, vTextureCoord);
                }
                `,name:"drop-shadow-filter"}),resources:{}}),Object.assign(this,e)}apply(e,t,r,i){let s=rt.getSameSizeTexture(t);e.applyFilter(this,t,s,!0),this._blurFilter.apply(e,s,r,i),this.shadowOnly||e.applyFilter(this._basePass,t,r,!1),rt.returnTexture(s)}get offset(){return this.uniforms.uOffset}set offset(e){this.uniforms.uOffset=e,this._updatePadding()}get offsetX(){return this.offset.x}set offsetX(e){this.offset.x=e,this._updatePadding()}get offsetY(){return this.offset.y}set offsetY(e){this.offset.y=e,this._updatePadding()}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,i]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=i}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}get blur(){return this._blurFilter.strength}set blur(e){this._blurFilter.strength=e,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(e){this._blurFilter.quality=e,this._updatePadding()}get kernels(){return this._blurFilter.kernels}set kernels(e){this._blurFilter.kernels=e}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(e){typeof e=="number"&&(e={x:e,y:e}),Array.isArray(e)&&(e={x:e[0],y:e[1]}),this._blurFilter.pixelSize=e}get pixelSizeX(){return this._blurFilter.pixelSizeX}set pixelSizeX(e){this._blurFilter.pixelSizeX=e}get pixelSizeY(){return this._blurFilter.pixelSizeY}set pixelSizeY(e){this._blurFilter.pixelSizeY=e}_updatePadding(){let e=Math.max(Math.abs(this.offsetX),Math.abs(this.offsetY));this.padding=e+this.blur*2+this.quality*4}};jd(pte,"DEFAULT_OPTIONS",{offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:void 0,blur:2,quality:3,pixelSize:{x:1,y:1},resolution:1});var qG=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform sampler2D uDisplacementMap;
uniform float uSeed;
uniform vec2 uDimensions;
uniform float uAspect;
uniform float uFillMode;
uniform float uOffset;
uniform float uDirection;
uniform vec2 uRed;
uniform vec2 uGreen;
uniform vec2 uBlue;

uniform vec4 uInputSize;
uniform vec4 uInputClamp;

const int TRANSPARENT = 0;
const int ORIGINAL = 1;
const int LOOP = 2;
const int CLAMP = 3;
const int MIRROR = 4;

void main(void)
{
    vec2 coord = (vTextureCoord * uInputSize.xy) / uDimensions;

    if (coord.x > 1.0 || coord.y > 1.0) {
        return;
    }

    float sinDir = sin(uDirection);
    float cosDir = cos(uDirection);

    float cx = coord.x - 0.5;
    float cy = (coord.y - 0.5) * uAspect;
    float ny = (-sinDir * cx + cosDir * cy) / uAspect + 0.5;

    // displacementMap: repeat
    // ny = ny > 1.0 ? ny - 1.0 : (ny < 0.0 ? 1.0 + ny : ny);

    // displacementMap: mirror
    ny = ny > 1.0 ? 2.0 - ny : (ny < 0.0 ? -ny : ny);

    vec4 dc = texture(uDisplacementMap, vec2(0.5, ny));

    float displacement = (dc.r - dc.g) * (uOffset / uInputSize.x);

    coord = vTextureCoord + vec2(cosDir * displacement, sinDir * displacement * uAspect);

    int fillMode = int(uFillMode);

    if (fillMode == CLAMP) {
        coord = clamp(coord, uInputClamp.xy, uInputClamp.zw);
    } else {
        if( coord.x > uInputClamp.z ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.x -= uInputClamp.z;
            } else if (fillMode == MIRROR) {
                coord.x = uInputClamp.z * 2.0 - coord.x;
            }
        } else if( coord.x < uInputClamp.x ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.x += uInputClamp.z;
            } else if (fillMode == MIRROR) {
                coord.x *= -uInputClamp.z;
            }
        }

        if( coord.y > uInputClamp.w ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.y -= uInputClamp.w;
            } else if (fillMode == MIRROR) {
                coord.y = uInputClamp.w * 2.0 - coord.y;
            }
        } else if( coord.y < uInputClamp.y ) {
            if (fillMode == TRANSPARENT) {
                discard;
            } else if (fillMode == LOOP) {
                coord.y += uInputClamp.w;
            } else if (fillMode == MIRROR) {
                coord.y *= -uInputClamp.w;
            }
        }
    }

    finalColor.r = texture(uTexture, coord + uRed * (1.0 - uSeed * 0.4) / uInputSize.xy).r;
    finalColor.g = texture(uTexture, coord + uGreen * (1.0 - uSeed * 0.3) / uInputSize.xy).g;
    finalColor.b = texture(uTexture, coord + uBlue * (1.0 - uSeed * 0.2) / uInputSize.xy).b;
    finalColor.a = texture(uTexture, coord).a;
}
`;var YG=`struct GlitchUniforms {
  uSeed: f32,
  uDimensions: vec2<f32>,
  uAspect: f32,
  uFillMode: f32,
  uOffset: f32,
  uDirection: f32,
  uRed: vec2<f32>,
  uGreen: vec2<f32>,
  uBlue: vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> glitchUniforms : GlitchUniforms;
@group(1) @binding(1) var uDisplacementMap: texture_2d<f32>; 
@group(1) @binding(2) var uDisplacementSampler: sampler; 

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uSeed: f32 = glitchUniforms.uSeed;
  let uDimensions: vec2<f32> = glitchUniforms.uDimensions;
  let uAspect: f32 = glitchUniforms.uAspect;
  let uOffset: f32 = glitchUniforms.uOffset;
  let uDirection: f32 = glitchUniforms.uDirection;
  let uRed: vec2<f32> = glitchUniforms.uRed;
  let uGreen: vec2<f32> = glitchUniforms.uGreen;
  let uBlue: vec2<f32> = glitchUniforms.uBlue;

  let uInputSize: vec4<f32> = gfu.uInputSize;
  let uInputClamp: vec4<f32> = gfu.uInputClamp;

  var discarded: bool = false;
  var coord: vec2<f32> = (uv * uInputSize.xy) / uDimensions;

    if (coord.x > 1.0 || coord.y > 1.0) {
      discarded = true;
    }

    let sinDir: f32 = sin(uDirection);
    let cosDir: f32 = cos(uDirection);

    let cx: f32 = coord.x - 0.5;
    let cy: f32 = (coord.y - 0.5) * uAspect;
    var ny: f32 = (-sinDir * cx + cosDir * cy) / uAspect + 0.5;

    ny = select(select(ny, -ny, ny < 0.0), 2.0 - ny, ny > 1.0);

    let dc: vec4<f32> = textureSample(uDisplacementMap, uDisplacementSampler, vec2<f32>(0.5, ny));

    let displacement: f32 = (dc.r - dc.g) * (uOffset / uInputSize.x);

    coord = uv + vec2<f32>(cosDir * displacement, sinDir * displacement * uAspect);

    let fillMode: i32 = i32(glitchUniforms.uFillMode);

    if (fillMode == CLAMP) {
      coord = clamp(coord, uInputClamp.xy, uInputClamp.zw);
    } else {
      if (coord.x > uInputClamp.z) {
        if (fillMode == TRANSPARENT) {
          discarded = true;
        } else if (fillMode == LOOP) {
          coord.x = coord.x - uInputClamp.z;
        } else if (fillMode == MIRROR) {
          coord.x = uInputClamp.z * 2.0 - coord.x;
        }
      } else if (coord.x < uInputClamp.x) {
        if (fillMode == TRANSPARENT) {
          discarded = true;
        } else if (fillMode == LOOP) {
          coord.x = coord.x + uInputClamp.z;
        } else if (fillMode == MIRROR) {
          coord.x = coord.x * -uInputClamp.z;
        }
      }

      if (coord.y > uInputClamp.w) {
        if (fillMode == TRANSPARENT) {
          discarded = true;
        } else if (fillMode == LOOP) {
          coord.y = coord.y - uInputClamp.w;
        } else if (fillMode == MIRROR) {
          coord.y = uInputClamp.w * 2.0 - coord.y;
        }
      } else if (coord.y < uInputClamp.y) {
        if (fillMode == TRANSPARENT) {
          discarded = true;
        } else if (fillMode == LOOP) {
          coord.y = coord.y + uInputClamp.w;
        } else if (fillMode == MIRROR) {
          coord.y = coord.y * -uInputClamp.w;
        }
      }
    }

    let seedR: f32 = 1.0 - uSeed * 0.4;
    let seedG: f32 = 1.0 - uSeed * 0.3;
    let seedB: f32 = 1.0 - uSeed * 0.2;

    let offsetR: vec2<f32> = vec2(uRed.x * seedR / uInputSize.x, uRed.y * seedR / uInputSize.y);
    let offsetG: vec2<f32> = vec2(uGreen.x * seedG / uInputSize.x, uGreen.y * seedG / uInputSize.y);
    let offsetB: vec2<f32> = vec2(uBlue.x * seedB / uInputSize.x, uBlue.y * seedB / uInputSize.y);

    let r = textureSample(uTexture, uSampler, coord + offsetR).r;
    let g = textureSample(uTexture, uSampler, coord + offsetG).g;
    let b = textureSample(uTexture, uSampler, coord + offsetB).b;
    let a = textureSample(uTexture, uSampler, coord).a;

    return select(vec4<f32>(r, g, b, a), vec4<f32>(0.0,0.0,0.0,0.0), discarded);
}

const TRANSPARENT: i32 = 0;
const ORIGINAL: i32 = 1;
const LOOP: i32 = 2;
const CLAMP: i32 = 3;
const MIRROR: i32 = 4;`;var mte=Object.defineProperty,gte=(n,e,t)=>e in n?mte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,qo=(n,e,t)=>(gte(n,typeof e!="symbol"?e+"":e,t),t),yte=class KG extends be{constructor(e){e={...KG.defaults,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:YG,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:qG,name:"glitch-filter"}),i=document.createElement("canvas");i.width=4,i.height=e.sampleSize??512;let s=new re({source:new An({resource:i})});super({gpuProgram:t,glProgram:r,resources:{glitchUniforms:{uSeed:{value:e?.seed??0,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"},uAspect:{value:1,type:"f32"},uFillMode:{value:e?.fillMode??0,type:"f32"},uOffset:{value:e?.offset??100,type:"f32"},uDirection:{value:e?.direction??0,type:"f32"},uRed:{value:e.red,type:"vec2<f32>"},uGreen:{value:e.green,type:"vec2<f32>"},uBlue:{value:e.blue,type:"vec2<f32>"}},uDisplacementMap:s.source,uDisplacementSampler:s.source.style}}),qo(this,"uniforms"),qo(this,"average",!1),qo(this,"minSize",8),qo(this,"sampleSize",512),qo(this,"_canvas"),qo(this,"texture"),qo(this,"_slices",0),qo(this,"_sizes",new Float32Array(1)),qo(this,"_offsets",new Float32Array(1)),this.uniforms=this.resources.glitchUniforms.uniforms,this._canvas=i,this.texture=s,Object.assign(this,e)}apply(e,t,r,i){let{width:s,height:o}=t.frame;this.uniforms.uDimensions[0]=s,this.uniforms.uDimensions[1]=o,this.uniforms.uAspect=o/s,e.applyFilter(this,t,r,i)}_randomizeSizes(){let e=this._sizes,t=this._slices-1,r=this.sampleSize,i=Math.min(this.minSize/r,.9/this._slices);if(this.average){let s=this._slices,o=1;for(let a=0;a<t;a++){let l=o/(s-a),c=Math.max(l*(1-Math.random()*.6),i);e[a]=c,o-=c}e[t]=o}else{let s=1,o=Math.sqrt(1/this._slices);for(let a=0;a<t;a++){let l=Math.max(o*s*Math.random(),i);e[a]=l,s-=l}e[t]=s}this.shuffle()}shuffle(){let e=this._sizes,t=this._slices-1;for(let r=t;r>0;r--){let i=Math.random()*r>>0,s=e[r];e[r]=e[i],e[i]=s}}_randomizeOffsets(){for(let e=0;e<this._slices;e++)this._offsets[e]=Math.random()*(Math.random()<.5?-1:1)}refresh(){this._randomizeSizes(),this._randomizeOffsets(),this.redraw()}redraw(){let e=this.sampleSize,t=this.texture,r=this._canvas.getContext("2d");r.clearRect(0,0,8,e);let i,s=0;for(let o=0;o<this._slices;o++){i=Math.floor(this._offsets[o]*256);let a=this._sizes[o]*e,l=i>0?i:0,c=i<0?-i:0;r.fillStyle=`rgba(${l}, ${c}, 0, 1)`,r.fillRect(0,s>>0,e,a+1>>0),s+=a}t.source.update()}set sizes(e){let t=Math.min(this._slices,e.length);for(let r=0;r<t;r++)this._sizes[r]=e[r]}get sizes(){return this._sizes}set offsets(e){let t=Math.min(this._slices,e.length);for(let r=0;r<t;r++)this._offsets[r]=e[r]}get offsets(){return this._offsets}get slices(){return this._slices}set slices(e){this._slices!==e&&(this._slices=e,this._sizes=new Float32Array(e),this._offsets=new Float32Array(e),this.refresh())}get offset(){return this.uniforms.uOffset}set offset(e){this.uniforms.uOffset=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}get fillMode(){return this.uniforms.uFillMode}set fillMode(e){this.uniforms.uFillMode=e}get direction(){return this.uniforms.uDirection/ds}set direction(e){this.uniforms.uDirection=e*ds}get red(){return this.uniforms.uRed}set red(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uRed=e}get green(){return this.uniforms.uGreen}set green(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uGreen=e}get blue(){return this.uniforms.uBlue}set blue(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uBlue=e}destroy(){this.texture?.destroy(!0),this.texture=this._canvas=this.red=this.green=this.blue=this._sizes=this._offsets=null}};qo(yte,"defaults",{slices:5,offset:100,direction:0,fillMode:0,average:!1,seed:0,red:{x:0,y:0},green:{x:0,y:0},blue:{x:0,y:0},minSize:8,sampleSize:512});var QG=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uStrength;
uniform vec3 uColor;
uniform float uKnockout;
uniform float uAlpha;

uniform vec4 uInputSize;
uniform vec4 uInputClamp;

const float PI = 3.14159265358979323846264;

// Hard-assignment of DIST and ANGLE_STEP_SIZE instead of using uDistance and uQuality to allow them to be use on GLSL loop conditions
const float DIST = __DIST__;
const float ANGLE_STEP_SIZE = min(__ANGLE_STEP_SIZE__, PI * 2.);
const float ANGLE_STEP_NUM = ceil(PI * 2. / ANGLE_STEP_SIZE);
const float MAX_TOTAL_ALPHA = ANGLE_STEP_NUM * DIST * (DIST + 1.) / 2.;

void main(void) {
    vec2 px = vec2(1.) / uInputSize.xy;

    float totalAlpha = 0.;

    vec2 direction;
    vec2 displaced;
    vec4 curColor;

    for (float angle = 0.; angle < PI * 2.; angle += ANGLE_STEP_SIZE) {
      direction = vec2(cos(angle), sin(angle)) * px;

      for (float curDistance = 0.; curDistance < DIST; curDistance++) {
          displaced = clamp(vTextureCoord + direction * (curDistance + 1.), uInputClamp.xy, uInputClamp.zw);
          curColor = texture(uTexture, displaced);
          totalAlpha += (DIST - curDistance) * curColor.a;
      }
    }
    
    curColor = texture(uTexture, vTextureCoord);

    vec4 glowColor = vec4(uColor, uAlpha);
    bool knockout = uKnockout > .5;
    float innerStrength = uStrength[0];
    float outerStrength = uStrength[1];

    float alphaRatio = totalAlpha / MAX_TOTAL_ALPHA;
    float innerGlowAlpha = (1. - alphaRatio) * innerStrength * curColor.a * uAlpha;
    float innerGlowStrength = min(1., innerGlowAlpha);
    
    vec4 innerColor = mix(curColor, glowColor, innerGlowStrength);
    float outerGlowAlpha = alphaRatio * outerStrength * (1. - curColor.a) * uAlpha;
    float outerGlowStrength = min(1. - innerColor.a, outerGlowAlpha);
    vec4 outerGlowColor = outerGlowStrength * glowColor.rgba;

    if (knockout) {
      float resultAlpha = outerGlowAlpha + innerGlowAlpha;
      finalColor = vec4(glowColor.rgb * resultAlpha, resultAlpha);
    }
    else {
      finalColor = innerColor + outerGlowColor;
    }
}
`;var ZG=`struct GlowUniforms {
  uDistance: f32,
  uStrength: vec2<f32>,
  uColor: vec3<f32>,
  uAlpha: f32,
  uQuality: f32,
  uKnockout: f32,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> glowUniforms : GlowUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let quality = glowUniforms.uQuality;
  let distance = glowUniforms.uDistance;

  let dist: f32 = glowUniforms.uDistance;
  let angleStepSize: f32 = min(1. / quality / distance, PI * 2.0);
  let angleStepNum: f32 = ceil(PI * 2.0 / angleStepSize);

  let px: vec2<f32> = vec2<f32>(1.0 / gfu.uInputSize.xy);

  var totalAlpha: f32 = 0.0;

  var direction: vec2<f32>;
  var displaced: vec2<f32>;
  var curColor: vec4<f32>;

  for (var angle = 0.0; angle < PI * 2.0; angle += angleStepSize) {
    direction = vec2<f32>(cos(angle), sin(angle)) * px;
    for (var curDistance = 0.0; curDistance < dist; curDistance+=1) {
      displaced = vec2<f32>(clamp(uv + direction * (curDistance + 1.0), gfu.uInputClamp.xy, gfu.uInputClamp.zw));
      curColor = textureSample(uTexture, uSampler, displaced);
      totalAlpha += (dist - curDistance) * curColor.a;
    }
  }
    
  curColor = textureSample(uTexture, uSampler, uv);

  let glowColorRGB = glowUniforms.uColor;
  let glowAlpha = glowUniforms.uAlpha;
  let glowColor = vec4<f32>(glowColorRGB, glowAlpha);
  let knockout: bool = glowUniforms.uKnockout > 0.5;
  let innerStrength = glowUniforms.uStrength[0];
  let outerStrength = glowUniforms.uStrength[1];

  let alphaRatio: f32 = (totalAlpha / (angleStepNum * dist * (dist + 1.0) / 2.0));
  let innerGlowAlpha: f32 = (1.0 - alphaRatio) * innerStrength * curColor.a * glowAlpha;
  let innerGlowStrength: f32 = min(1.0, innerGlowAlpha);
  
  let innerColor: vec4<f32> = mix(curColor, glowColor, innerGlowStrength);
  let outerGlowAlpha: f32 = alphaRatio * outerStrength * (1. - curColor.a) * glowAlpha;
  let outerGlowStrength: f32 = min(1.0 - innerColor.a, outerGlowAlpha);
  let outerGlowColor: vec4<f32> = outerGlowStrength * glowColor.rgba;
  
  if (knockout) {
    let resultAlpha: f32 = outerGlowAlpha + innerGlowAlpha;
    return vec4<f32>(glowColor.rgb * resultAlpha, resultAlpha);
  }
  else {
    return innerColor + outerGlowColor;
  }
}

const PI: f32 = 3.14159265358979323846264;`;var xte=Object.defineProperty,bte=(n,e,t)=>e in n?xte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Hk=(n,e,t)=>(bte(n,typeof e!="symbol"?e+"":e,t),t),JG=class e$ extends be{constructor(e){e={...e$.DEFAULT_OPTIONS,...e};let t=e.distance??10,r=e.quality??.1,i=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:ZG,entryPoint:"mainFragment"}}),s=he.from({vertex:Pe,fragment:QG.replace(/__ANGLE_STEP_SIZE__/gi,`${(1/r/t).toFixed(7)}`).replace(/__DIST__/gi,`${t.toFixed(0)}.0`),name:"glow-filter"});super({gpuProgram:i,glProgram:s,resources:{glowUniforms:{uDistance:{value:t,type:"f32"},uStrength:{value:[e.innerStrength,e.outerStrength],type:"vec2<f32>"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:e.alpha,type:"f32"},uQuality:{value:r,type:"f32"},uKnockout:{value:e?.knockout??!1?1:0,type:"f32"}}},padding:t}),Hk(this,"uniforms"),Hk(this,"_color"),this.uniforms=this.resources.glowUniforms.uniforms,this._color=new ce,this.color=e.color??16777215}get distance(){return this.uniforms.uDistance}set distance(e){this.uniforms.uDistance=this.padding=e}get innerStrength(){return this.uniforms.uStrength[0]}set innerStrength(e){this.uniforms.uStrength[0]=e}get outerStrength(){return this.uniforms.uStrength[1]}set outerStrength(e){this.uniforms.uStrength[1]=e}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,i]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=i}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}get quality(){return this.uniforms.uQuality}set quality(e){this.uniforms.uQuality=e}get knockout(){return this.uniforms.uKnockout===1}set knockout(e){this.uniforms.uKnockout=e?1:0}};Hk(JG,"DEFAULT_OPTIONS",{distance:10,outerStrength:4,innerStrength:0,color:16777215,alpha:1,quality:.1,knockout:!1});var Yo=JG;var t$=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uDimensions;
uniform float uParallel;
uniform vec2 uLight;
uniform float uAspect;
uniform float uTime;
uniform vec3 uRay;

uniform vec4 uInputSize;

\${PERLIN}

void main(void) {
    vec2 uDimensions = uDimensions;
    bool uParallel = uParallel > 0.5;
    vec2 uLight = uLight;
    float uAspect = uAspect;

    vec2 coord = vTextureCoord * uInputSize.xy / uDimensions;

    float d;

    if (uParallel) {
        float _cos = uLight.x;
        float _sin = uLight.y;
        d = (_cos * coord.x) + (_sin * coord.y * uAspect);
    } else {
        float dx = coord.x - uLight.x / uDimensions.x;
        float dy = (coord.y - uLight.y / uDimensions.y) * uAspect;
        float dis = sqrt(dx * dx + dy * dy) + 0.00001;
        d = dy / dis;
    }

    float uTime = uTime;
    vec3 uRay = uRay;

    float gain = uRay[0];
    float lacunarity = uRay[1];
    float alpha = uRay[2];

    vec3 dir = vec3(d, d, 0.0);
    float noise = turb(dir + vec3(uTime, 0.0, 62.1 + uTime) * 0.05, vec3(480.0, 320.0, 480.0), lacunarity, gain);
    noise = mix(noise, 0.0, 0.3);
    //fade vertically.
    vec4 mist = vec4(vec3(noise), 1.0) * (1.0 - coord.y);
    mist.a = 1.0;
    // apply user alpha
    mist *= alpha;

    finalColor = texture(uTexture, vTextureCoord) + mist;
}
`;var r$=`struct GodrayUniforms {
  uLight: vec2<f32>,
  uParallel: f32,
  uAspect: f32,
  uTime: f32,
  uRay: vec3<f32>,
  uDimensions: vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> godrayUniforms : GodrayUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uDimensions: vec2<f32> = godrayUniforms.uDimensions;
  let uParallel: bool = godrayUniforms.uParallel > 0.5;
  let uLight: vec2<f32> = godrayUniforms.uLight;
  let uAspect: f32 = godrayUniforms.uAspect;

  let coord: vec2<f32> = uv * gfu.uInputSize.xy / uDimensions;

  var d: f32;

  if (uParallel) {
    let _cos: f32 = uLight.x;
    let _sin: f32 = uLight.y;
    d = (_cos * coord.x) + (_sin * coord.y * uAspect);
  } else {
    let dx: f32 = coord.x - uLight.x / uDimensions.x;
    let dy: f32 = (coord.y - uLight.y / uDimensions.y) * uAspect;
    let dis: f32 = sqrt(dx * dx + dy * dy) + 0.00001;
    d = dy / dis;
  }

  let uTime: f32 = godrayUniforms.uTime;
  let uRay: vec3<f32> = godrayUniforms.uRay;
  
  let gain = uRay[0];
  let lacunarity = uRay[1];
  let alpha = uRay[2];

  let dir: vec3<f32> = vec3<f32>(d, d, 0.0);
  var noise: f32 = turb(dir + vec3<f32>(uTime, 0.0, 62.1 + uTime) * 0.05, vec3<f32>(480.0, 320.0, 480.0), lacunarity, gain);
  noise = mix(noise, 0.0, 0.3);
  //fade vertically.
  var mist: vec4<f32> = vec4<f32>(vec3<f32>(noise), 1.0) * (1.0 - coord.y);
  mist.a = 1.0;
  // apply user alpha
  mist *= alpha;
  return textureSample(uTexture, uSampler, uv) + mist;
}

\${PERLIN}`;var n$=`vec3 mod289(vec3 x)
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
vec4 mod289(vec4 x)
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
vec4 permute(vec4 x)
{
    return mod289(((x * 34.0) + 1.0) * x);
}
vec4 taylorInvSqrt(vec4 r)
{
    return 1.79284291400159 - 0.85373472095314 * r;
}
vec3 fade(vec3 t)
{
    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}
// Classic Perlin noise, periodic variant
float pnoise(vec3 P, vec3 rep)
{
    vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period
    vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period
    Pi0 = mod289(Pi0);
    Pi1 = mod289(Pi1);
    vec3 Pf0 = fract(P); // Fractional part for interpolation
    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
    vec4 iy = vec4(Pi0.yy, Pi1.yy);
    vec4 iz0 = Pi0.zzzz;
    vec4 iz1 = Pi1.zzzz;
    vec4 ixy = permute(permute(ix) + iy);
    vec4 ixy0 = permute(ixy + iz0);
    vec4 ixy1 = permute(ixy + iz1);
    vec4 gx0 = ixy0 * (1.0 / 7.0);
    vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
    gx0 = fract(gx0);
    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
    vec4 sz0 = step(gz0, vec4(0.0));
    gx0 -= sz0 * (step(0.0, gx0) - 0.5);
    gy0 -= sz0 * (step(0.0, gy0) - 0.5);
    vec4 gx1 = ixy1 * (1.0 / 7.0);
    vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
    gx1 = fract(gx1);
    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
    vec4 sz1 = step(gz1, vec4(0.0));
    gx1 -= sz1 * (step(0.0, gx1) - 0.5);
    gy1 -= sz1 * (step(0.0, gy1) - 0.5);
    vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);
    vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);
    vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);
    vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);
    vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);
    vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);
    vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);
    vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);
    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
    g000 *= norm0.x;
    g010 *= norm0.y;
    g100 *= norm0.z;
    g110 *= norm0.w;
    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
    g001 *= norm1.x;
    g011 *= norm1.y;
    g101 *= norm1.z;
    g111 *= norm1.w;
    float n000 = dot(g000, Pf0);
    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
    float n111 = dot(g111, Pf1);
    vec3 fade_xyz = fade(Pf0);
    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);
    return 2.2 * n_xyz;
}
float turb(vec3 P, vec3 rep, float lacunarity, float gain)
{
    float sum = 0.0;
    float sc = 1.0;
    float totalgain = 1.0;
    for (float i = 0.0; i < 6.0; i++)
    {
        sum += totalgain * pnoise(P * sc, rep);
        sc *= lacunarity;
        totalgain *= gain;
    }
    return abs(sum);
}
`;var i$=`// Taken from https://gist.github.com/munrocket/236ed5ba7e409b8bdf1ff6eca5dcdc39

fn moduloVec3(x: vec3<f32>, y: vec3<f32>) -> vec3<f32>
{
  return x - y * floor(x/y);
}
fn mod289Vec3(x: vec3<f32>) -> vec3<f32>
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
fn mod289Vec4(x: vec4<f32>) -> vec4<f32>
{
    return x - floor(x * (1.0 / 289.0)) * 289.0;
}
fn permute4(x: vec4<f32>) -> vec4<f32>
{
    return mod289Vec4(((x * 34.0) + 1.0) * x);
}
fn taylorInvSqrt(r: vec4<f32>) -> vec4<f32>
{
    return 1.79284291400159 - 0.85373472095314 * r;
}
fn fade3(t: vec3<f32>) -> vec3<f32>
{
    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}
fn fade2(t: vec2<f32>) -> vec2<f32> { return t * t * t * (t * (t * 6. - 15.) + 10.); }

fn perlinNoise2(P: vec2<f32>) -> f32 {
  var Pi: vec4<f32> = floor(P.xyxy) + vec4<f32>(0., 0., 1., 1.);
  let Pf = fract(P.xyxy) - vec4<f32>(0., 0., 1., 1.);
  Pi = Pi % vec4<f32>(289.); // To avoid truncation effects in permutation
  let ix = Pi.xzxz;
  let iy = Pi.yyww;
  let fx = Pf.xzxz;
  let fy = Pf.yyww;
  let i = permute4(permute4(ix) + iy);
  var gx: vec4<f32> = 2. * fract(i * 0.0243902439) - 1.; // 1/41 = 0.024...
  let gy = abs(gx) - 0.5;
  let tx = floor(gx + 0.5);
  gx = gx - tx;
  var g00: vec2<f32> = vec2<f32>(gx.x, gy.x);
  var g10: vec2<f32> = vec2<f32>(gx.y, gy.y);
  var g01: vec2<f32> = vec2<f32>(gx.z, gy.z);
  var g11: vec2<f32> = vec2<f32>(gx.w, gy.w);
  let norm = 1.79284291400159 - 0.85373472095314 *
      vec4<f32>(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));
  g00 = g00 * norm.x;
  g01 = g01 * norm.y;
  g10 = g10 * norm.z;
  g11 = g11 * norm.w;
  let n00 = dot(g00, vec2<f32>(fx.x, fy.x));
  let n10 = dot(g10, vec2<f32>(fx.y, fy.y));
  let n01 = dot(g01, vec2<f32>(fx.z, fy.z));
  let n11 = dot(g11, vec2<f32>(fx.w, fy.w));
  let fade_xy = fade2(Pf.xy);
  let n_x = mix(vec2<f32>(n00, n01), vec2<f32>(n10, n11), vec2<f32>(fade_xy.x));
  let n_xy = mix(n_x.x, n_x.y, fade_xy.y);
  return 2.3 * n_xy;
}

// Classic Perlin noise, periodic variant
fn perlinNoise3(P: vec3<f32>, rep: vec3<f32>) -> f32
{
    var Pi0: vec3<f32> = moduloVec3(floor(P), rep); // Integer part, modulo period
    var Pi1: vec3<f32> = moduloVec3(Pi0 + vec3<f32>(1.0), rep); // Integer part + 1, mod period
    Pi0 = mod289Vec3(Pi0);
    Pi1 = mod289Vec3(Pi1);
    let Pf0: vec3<f32> = fract(P); // Fractional part for interpolation
    let Pf1: vec3<f32> = Pf0 - vec3<f32>(1.0); // Fractional part - 1.0
    let ix: vec4<f32> = vec4<f32>(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
    let iy: vec4<f32> = vec4<f32>(Pi0.yy, Pi1.yy);
    let iz0: vec4<f32> = Pi0.zzzz;
    let iz1: vec4<f32> = Pi1.zzzz;
    let ixy: vec4<f32> = permute4(permute4(ix) + iy);
    let ixy0: vec4<f32> = permute4(ixy + iz0);
    let ixy1: vec4<f32> = permute4(ixy + iz1);
    var gx0: vec4<f32> = ixy0 * (1.0 / 7.0);
    var gy0: vec4<f32> = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
    gx0 = fract(gx0);
    let gz0: vec4<f32> = vec4<f32>(0.5) - abs(gx0) - abs(gy0);
    let sz0: vec4<f32> = step(gz0, vec4<f32>(0.0));
    gx0 -= sz0 * (step(vec4<f32>(0.0), gx0) - 0.5);
    gy0 -= sz0 * (step(vec4<f32>(0.0), gy0) - 0.5);
    var gx1: vec4<f32> = ixy1 * (1.0 / 7.0);
    var gy1: vec4<f32> = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
    gx1 = fract(gx1);
    let gz1: vec4<f32> = vec4<f32>(0.5) - abs(gx1) - abs(gy1);
    let sz1: vec4<f32> = step(gz1, vec4<f32>(0.0));
    gx1 -= sz1 * (step(vec4<f32>(0.0), gx1) - 0.5);
    gy1 -= sz1 * (step(vec4<f32>(0.0), gy1) - 0.5);
    var g000: vec3<f32> = vec3<f32>(gx0.x, gy0.x, gz0.x);
    var g100: vec3<f32> = vec3<f32>(gx0.y, gy0.y, gz0.y);
    var g010: vec3<f32> = vec3<f32>(gx0.z, gy0.z, gz0.z);
    var g110: vec3<f32> = vec3<f32>(gx0.w, gy0.w, gz0.w);
    var g001: vec3<f32> = vec3<f32>(gx1.x, gy1.x, gz1.x);
    var g101: vec3<f32> = vec3<f32>(gx1.y, gy1.y, gz1.y);
    var g011: vec3<f32> = vec3<f32>(gx1.z, gy1.z, gz1.z);
    var g111: vec3<f32> = vec3<f32>(gx1.w, gy1.w, gz1.w);
    let norm0: vec4<f32> = taylorInvSqrt(vec4<f32>(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
    g000 *= norm0.x;
    g010 *= norm0.y;
    g100 *= norm0.z;
    g110 *= norm0.w;
    let norm1: vec4<f32> = taylorInvSqrt(vec4<f32>(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
    g001 *= norm1.x;
    g011 *= norm1.y;
    g101 *= norm1.z;
    g111 *= norm1.w;
    let n000: f32 = dot(g000, Pf0);
    let n100: f32 = dot(g100, vec3<f32>(Pf1.x, Pf0.yz));
    let n010: f32 = dot(g010, vec3<f32>(Pf0.x, Pf1.y, Pf0.z));
    let n110: f32 = dot(g110, vec3<f32>(Pf1.xy, Pf0.z));
    let n001: f32 = dot(g001, vec3<f32>(Pf0.xy, Pf1.z));
    let n101: f32 = dot(g101, vec3<f32>(Pf1.x, Pf0.y, Pf1.z));
    let n011: f32 = dot(g011, vec3<f32>(Pf0.x, Pf1.yz));
    let n111: f32 = dot(g111, Pf1);
    let fade_xyz: vec3<f32> = fade3(Pf0);
    let n_z: vec4<f32> = mix(vec4<f32>(n000, n100, n010, n110), vec4<f32>(n001, n101, n011, n111), fade_xyz.z);
    let n_yz: vec2<f32> = mix(n_z.xy, n_z.zw, fade_xyz.y);
    let n_xyz: f32 = mix(n_yz.x, n_yz.y, fade_xyz.x);
    return 2.2 * n_xyz;
}
fn turb(P: vec3<f32>, rep: vec3<f32>, lacunarity: f32, gain: f32) -> f32
{
    var sum: f32 = 0.0;
    var sc: f32 = 1.0;
    var totalgain: f32 = 1.0;
    for (var i = 0.0; i < 6.0; i += 1)
    {
        sum += totalgain * perlinNoise3(P * sc, rep);
        sc *= lacunarity;
        totalgain *= gain;
    }
    return abs(sum);
}`;var _te=Object.defineProperty,vte=(n,e,t)=>e in n?_te(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Xd=(n,e,t)=>(vte(n,typeof e!="symbol"?e+"":e,t),t),wte=class s$ extends be{constructor(e){e={...s$.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:r$.replace("${PERLIN}",i$),entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:t$.replace("${PERLIN}",n$),name:"god-ray-filter"});super({gpuProgram:t,glProgram:r,resources:{godrayUniforms:{uLight:{value:new Float32Array(2),type:"vec2<f32>"},uParallel:{value:0,type:"f32"},uAspect:{value:0,type:"f32"},uTime:{value:e.time,type:"f32"},uRay:{value:new Float32Array(3),type:"vec3<f32>"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),Xd(this,"uniforms"),Xd(this,"time",0),Xd(this,"_angleLight",[0,0]),Xd(this,"_angle",0),Xd(this,"_center"),this.uniforms=this.resources.godrayUniforms.uniforms,Object.assign(this,e)}apply(e,t,r,i){let s=t.frame.width,o=t.frame.height;this.uniforms.uLight[0]=this.parallel?this._angleLight[0]:this._center.x,this.uniforms.uLight[1]=this.parallel?this._angleLight[1]:this._center.y,this.uniforms.uDimensions[0]=s,this.uniforms.uDimensions[1]=o,this.uniforms.uAspect=o/s,this.uniforms.uTime=this.time,e.applyFilter(this,t,r,i)}get angle(){return this._angle}set angle(e){this._angle=e;let t=e*ds;this._angleLight[0]=Math.cos(t),this._angleLight[1]=Math.sin(t)}get parallel(){return this.uniforms.uParallel>.5}set parallel(e){this.uniforms.uParallel=e?1:0}get center(){return this._center}set center(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this._center=e}get centerX(){return this.center.x}set centerX(e){this.center.x=e}get centerY(){return this.center.y}set centerY(e){this.center.y=e}get gain(){return this.uniforms.uRay[0]}set gain(e){this.uniforms.uRay[0]=e}get lacunarity(){return this.uniforms.uRay[1]}set lacunarity(e){this.uniforms.uRay[1]=e}get alpha(){return this.uniforms.uRay[2]}set alpha(e){this.uniforms.uRay[2]=e}};Xd(wte,"DEFAULT_OPTIONS",{angle:30,gain:.5,lacunarity:2.5,parallel:!0,time:0,center:{x:0,y:0},alpha:1});var o$=`in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec3 uHsl;
uniform float uAlpha;
uniform float uColorize;

// https://en.wikipedia.org/wiki/Luma_(video)
const vec3 weight = vec3(0.299, 0.587, 0.114);

float getWeightedAverage(vec3 rgb) {
    return rgb.r * weight.r + rgb.g * weight.g + rgb.b * weight.b;
}

// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243
const vec3 k = vec3(0.57735, 0.57735, 0.57735);

vec3 hueShift(vec3 color, float angle) {
    float cosAngle = cos(angle);
    return vec3(
    color * cosAngle +
    cross(k, color) * sin(angle) +
    k * dot(k, color) * (1.0 - cosAngle)
    );
}

void main()
{
    vec4 color = texture(uTexture, vTextureCoord);
    vec3 resultRGB = color.rgb;

    float hue = uHsl[0];
    float saturation = uHsl[1];
    float lightness = uHsl[2];

    // colorize
    if (uColorize > 0.5) {
        resultRGB = vec3(getWeightedAverage(resultRGB), 0., 0.);
    }

    // hue
    resultRGB = hueShift(resultRGB, hue);

    // saturation
    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js
    float average = (resultRGB.r + resultRGB.g + resultRGB.b) / 3.0;

    if (saturation > 0.) {
        resultRGB += (average - resultRGB) * (1. - 1. / (1.001 - saturation));
    } else {
        resultRGB -= (average - resultRGB) * saturation;
    }

    // lightness
    resultRGB = mix(resultRGB, vec3(ceil(lightness)) * color.a, abs(lightness));

    // alpha
    finalColor = mix(color, vec4(resultRGB, color.a), uAlpha);
}
`;var a$=`struct HslUniforms {
  uHsl:vec3<f32>,
  uColorize:f32,
  uAlpha:f32,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> hslUniforms : HslUniforms;

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
    let color: vec4<f32> = textureSample(uTexture, uSampler, uv);
    var resultRGB: vec3<f32> = color.rgb;

    let hue: f32 = hslUniforms.uHsl[0];
    let saturation: f32 = hslUniforms.uHsl[1];
    let lightness: f32 = hslUniforms.uHsl[2];

    // colorize
    if (hslUniforms.uColorize > 0.5) {
        resultRGB = vec3<f32>(dot(color.rgb, vec3<f32>(0.299, 0.587, 0.114)), 0., 0.);
    }

    // hue
    resultRGB = hueShift(resultRGB, hue);

    // saturation
    // https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/huesaturation.js
    let average: f32 = (resultRGB.r + resultRGB.g + resultRGB.b) / 3.0;

    if (saturation > 0.) {
        resultRGB += (average - resultRGB) * (1. - 1. / (1.001 - saturation));
    } else {
        resultRGB -= (average - resultRGB) * saturation;
    }

    // lightness
    resultRGB = mix(resultRGB, vec3<f32>(ceil(lightness)) * color.a, abs(lightness));

    // alpha
    return mix(color, vec4<f32>(resultRGB, color.a), hslUniforms.uAlpha);
}

// https://gist.github.com/mairod/a75e7b44f68110e1576d77419d608786?permalink_comment_id=3195243#gistcomment-3195243
const k: vec3<f32> = vec3(0.57735, 0.57735, 0.57735);

fn hueShift(color: vec3<f32>, angle: f32) -> vec3<f32> 
{
    let cosAngle: f32 = cos(angle);
    return vec3<f32>(
    color * cosAngle +
    cross(k, color) * sin(angle) +
    k * dot(k, color) * (1.0 - cosAngle)
    );
}`;var Ste=Object.defineProperty,Cte=(n,e,t)=>e in n?Ste(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Wk=(n,e,t)=>(Cte(n,typeof e!="symbol"?e+"":e,t),t),Ate=class l$ extends be{constructor(e){e={...l$.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:a$,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:o$,name:"hsl-adjustment-filter"});super({gpuProgram:t,glProgram:r,resources:{hslUniforms:{uHsl:{value:new Float32Array(3),type:"vec3<f32>"},uColorize:{value:e.colorize?1:0,type:"f32"},uAlpha:{value:e.alpha,type:"f32"}}}}),Wk(this,"uniforms"),Wk(this,"_hue"),this.uniforms=this.resources.hslUniforms.uniforms,Object.assign(this,e)}get hue(){return this._hue}set hue(e){this._hue=e,this.uniforms.uHsl[0]=e*(Math.PI/180)}get saturation(){return this.uniforms.uHsl[1]}set saturation(e){this.uniforms.uHsl[1]=e}get lightness(){return this.uniforms.uHsl[2]}set lightness(e){this.uniforms.uHsl[2]=e}get colorize(){return this.uniforms.uColorize===1}set colorize(e){this.uniforms.uColorize=e?1:0}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};Wk(Ate,"DEFAULT_OPTIONS",{hue:0,saturation:0,lightness:0,colorize:!1,alpha:1});var c$=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uVelocity;
uniform int uKernelSize;
uniform float uOffset;

uniform vec4 uInputSize;

const int MAX_KERNEL_SIZE = 2048;

// Notice:
// the perfect way:
//    int kernelSize = min(uKernelSize, MAX_KERNELSIZE);
// BUT in real use-case , uKernelSize < MAX_KERNELSIZE almost always.
// So use uKernelSize directly.

void main(void)
{
    vec4 color = texture(uTexture, vTextureCoord);

    if (uKernelSize == 0)
    {
        finalColor = color;
        return;
    }

    vec2 velocity = uVelocity / uInputSize.xy;
    float offset = -uOffset / length(uVelocity) - 0.5;
    int k = uKernelSize - 1;

    for(int i = 0; i < MAX_KERNEL_SIZE - 1; i++) {
        if (i == k) {
            break;
        }
        vec2 bias = velocity * (float(i) / float(k) + offset);
        color += texture(uTexture, vTextureCoord + bias);
    }
    finalColor = color / float(uKernelSize);
}
`;var u$=`struct MotionBlurUniforms {
  uVelocity: vec2<f32>,
  uKernelSize: f32,
  uOffset: f32,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> motionBlurUniforms : MotionBlurUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uVelocity = motionBlurUniforms.uVelocity;
  let uKernelSize = motionBlurUniforms.uKernelSize;
  let uOffset = motionBlurUniforms.uOffset;

  let velocity: vec2<f32> = uVelocity / gfu.uInputSize.xy;
  let offset: f32 = -uOffset / length(uVelocity) - 0.5;
  let k: i32 = i32(min(uKernelSize - 1, MAX_KERNEL_SIZE - 1));

  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);

  for(var i: i32 = 0; i < k; i += 1) {
    let bias: vec2<f32> = velocity * (f32(i) / f32(k) + offset);
    color += textureSample(uTexture, uSampler, uv + bias);
  }
  
  return select(color / f32(uKernelSize), textureSample(uTexture, uSampler, uv), uKernelSize == 0);
}

const MAX_KERNEL_SIZE: f32 = 2048;`;var Ete=Object.defineProperty,Tte=(n,e,t)=>e in n?Ete(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Vk=(n,e,t)=>(Tte(n,typeof e!="symbol"?e+"":e,t),t),kte=class d$ extends be{constructor(...e){let t=e[0]??{};if(Array.isArray(t)||"x"in t&&"y"in t||t instanceof Zt){oe("6.0.0","MotionBlurFilter constructor params are now options object. See params: { velocity, kernelSize, offset }");let s="x"in t?t.x:t[0],o="y"in t?t.y:t[1];t={velocity:{x:s,y:o}},e[1]!==void 0&&(t.kernelSize=e[1]),e[2]!==void 0&&(t.offset=e[2])}t={...d$.DEFAULT_OPTIONS,...t};let r=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:u$,entryPoint:"mainFragment"}}),i=he.from({vertex:Pe,fragment:c$,name:"motion-blur-filter"});super({gpuProgram:r,glProgram:i,resources:{motionBlurUniforms:{uVelocity:{value:t.velocity,type:"vec2<f32>"},uKernelSize:{value:Math.trunc(t.kernelSize??5),type:"i32"},uOffset:{value:t.offset,type:"f32"}}}}),Vk(this,"uniforms"),Vk(this,"_kernelSize"),this.uniforms=this.resources.motionBlurUniforms.uniforms,Object.assign(this,t)}get velocity(){return this.uniforms.uVelocity}set velocity(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uVelocity=e,this._updateDirty()}get velocityX(){return this.velocity.x}set velocityX(e){this.velocity.x=e,this._updateDirty()}get velocityY(){return this.velocity.y}set velocityY(e){this.velocity.y=e,this._updateDirty()}get kernelSize(){return this._kernelSize}set kernelSize(e){this._kernelSize=e,this._updateDirty()}get offset(){return this.uniforms.uOffset}set offset(e){this.uniforms.uOffset=e}_updateDirty(){this.padding=(Math.max(Math.abs(this.velocityX),Math.abs(this.velocityY))>>0)+1,this.uniforms.uKernelSize=this.velocityX!==0||this.velocityY!==0?this._kernelSize:0}};Vk(kte,"DEFAULT_OPTIONS",{velocity:{x:0,y:0},kernelSize:5,offset:0});var f$=`in vec2 vTextureCoord;
out vec4 finalColor;

const int MAX_COLORS = \${MAX_COLORS};

uniform sampler2D uTexture;
uniform vec3 uOriginalColors[MAX_COLORS];
uniform vec3 uTargetColors[MAX_COLORS];
uniform float uTolerance;

void main(void)
{
    finalColor = texture(uTexture, vTextureCoord);

    float alpha = finalColor.a;
    if (alpha < 0.0001)
    {
      return;
    }

    vec3 color = finalColor.rgb / alpha;

    for(int i = 0; i < MAX_COLORS; i++)
    {
      vec3 origColor = uOriginalColors[i];
      if (origColor.r < 0.0)
      {
        break;
      }
      vec3 colorDiff = origColor - color;
      if (length(colorDiff) < uTolerance)
      {
        vec3 targetColor = uTargetColors[i];
        finalColor = vec4((targetColor + colorDiff) * alpha, alpha);
        return;
      }
    }
}
`;var h$=`struct MultiColorReplaceUniforms {
  uOriginalColors: array<vec3<f32>, MAX_COLORS>,
  uTargetColors: array<vec3<f32>, MAX_COLORS>,
  uTolerance:f32,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> multiColorReplaceUniforms : MultiColorReplaceUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uOriginalColors = multiColorReplaceUniforms.uOriginalColors;
  let uTargetColors = multiColorReplaceUniforms.uTargetColors;
  let uTolerance = multiColorReplaceUniforms.uTolerance;

  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);

  let alpha: f32 = color.a;

  if (alpha > 0.0001)
  {
    var modColor: vec3<f32> = vec3<f32>(color.rgb) / alpha;

    for(var i: i32 = 0; i < MAX_COLORS; i += 1)
    {
      let origColor: vec3<f32> = uOriginalColors[i];
      if (origColor.r < 0.0)
      {
        break;
      }
      let colorDiff: vec3<f32> = origColor - modColor;
      
      if (length(colorDiff) < uTolerance)
      {
        let targetColor: vec3<f32> = uTargetColors[i];
        color = vec4((targetColor + colorDiff) * alpha, alpha);
        return color;
      }
    }
  }

  return color;
}

const MAX_COLORS: i32 = \${MAX_COLORS};`;var Ite=Object.defineProperty,Pte=(n,e,t)=>e in n?Ite(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ux=(n,e,t)=>(Pte(n,typeof e!="symbol"?e+"":e,t),t),Dte=class p$ extends be{constructor(...e){let t=e[0]??{};Array.isArray(t)&&(oe("6.0.0","MultiColorReplaceFilter constructor params are now options object. See params: { replacements, tolerance, maxColors }"),t={replacements:t},e[1]&&(t.tolerance=e[1]),e[2]&&(t.maxColors=e[2])),t={...p$.DEFAULT_OPTIONS,...t};let r=t.maxColors??t.replacements.length,i=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:h$.replace(/\$\{MAX_COLORS\}/g,r.toFixed(0)),entryPoint:"mainFragment"}}),s=he.from({vertex:Pe,fragment:f$.replace(/\$\{MAX_COLORS\}/g,r.toFixed(0)),name:"multi-color-replace-filter"});super({gpuProgram:i,glProgram:s,resources:{multiColorReplaceUniforms:{uOriginalColors:{value:new Float32Array(3*r),type:"vec3<f32>",size:r},uTargetColors:{value:new Float32Array(3*r),type:"vec3<f32>",size:r},uTolerance:{value:t.tolerance,type:"f32"}}}}),Ux(this,"uniforms"),Ux(this,"_replacements",[]),Ux(this,"_maxColors"),this._maxColors=r,this.uniforms=this.resources.multiColorReplaceUniforms.uniforms,this.replacements=t.replacements}set replacements(e){let t=this.uniforms.uOriginalColors,r=this.uniforms.uTargetColors,i=e.length,s=new ce;if(i>this._maxColors)throw new Error(`Length of replacements (${i}) exceeds the maximum colors length (${this._maxColors})`);t[i*3]=-1;let o,a,l;for(let c=0;c<i;c++){let u=e[c];s.setValue(u[0]),[o,a,l]=s.toArray(),t[c*3]=o,t[c*3+1]=a,t[c*3+2]=l,s.setValue(u[1]),[o,a,l]=s.toArray(),r[c*3]=o,r[c*3+1]=a,r[c*3+2]=l}this._replacements=e}get replacements(){return this._replacements}refresh(){this.replacements=this._replacements}get maxColors(){return this._maxColors}get tolerance(){return this.uniforms.uTolerance}set tolerance(e){this.uniforms.uTolerance=e}set epsilon(e){oe("6.0.0","MultiColorReplaceFilter.epsilon is deprecated, please use MultiColorReplaceFilter.tolerance instead"),this.tolerance=e}get epsilon(){return oe("6.0.0","MultiColorReplaceFilter.epsilon is deprecated, please use MultiColorReplaceFilter.tolerance instead"),this.tolerance}};Ux(Dte,"DEFAULT_OPTIONS",{replacements:[[16711680,255]],tolerance:.05,maxColors:void 0});var m$=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform float uSepia;
uniform vec2 uNoise;
uniform vec3 uScratch;
uniform vec3 uVignetting;
uniform float uSeed;
uniform vec2 uDimensions;

uniform vec4 uInputSize;

const float SQRT_2 = 1.414213;
const vec3 SEPIA_RGB = vec3(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

vec3 Overlay(vec3 src, vec3 dst)
{
    // if (dst <= 0.5) then: 2 * src * dst
    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)
    return vec3((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)),
                (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)),
                (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)));
}


void main()
{
    finalColor = texture(uTexture, vTextureCoord);
    vec3 color = finalColor.rgb;

    if (uSepia > 0.0)
    {
        float gray = (color.x + color.y + color.z) / 3.0;
        vec3 grayscale = vec3(gray);

        color = Overlay(SEPIA_RGB, grayscale);

        color = grayscale + uSepia * (color - grayscale);
    }

    vec2 coord = vTextureCoord * uInputSize.xy / uDimensions.xy;

    float vignette = uVignetting[0];
    float vignetteAlpha = uVignetting[1];
    float vignetteBlur = uVignetting[2];

    if (vignette > 0.0)
    {
        float outter = SQRT_2 - vignette * SQRT_2;
        vec2 dir = vec2(vec2(0.5, 0.5) - coord);
        dir.y *= uDimensions.y / uDimensions.x;
        float darker = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + vignetteBlur * SQRT_2), 0.0, 1.0);
        color.rgb *= darker + (1.0 - darker) * (1.0 - vignetteAlpha);
    }

    float scratch = uScratch[0];
    float scratchDensity = uScratch[1];
    float scratchWidth = uScratch[2];

    if (scratchDensity > uSeed && scratch != 0.0)
    {
        float phase = uSeed * 256.0;
        float s = mod(floor(phase), 2.0);
        float dist = 1.0 / scratchDensity;
        float d = distance(coord, vec2(uSeed * dist, abs(s - uSeed * dist)));
        if (d < uSeed * 0.6 + 0.4)
        {
            highp float period = scratchDensity * 10.0;

            float xx = coord.x * period + phase;
            float aa = abs(mod(xx, 0.5) * 4.0);
            float bb = mod(floor(xx / 0.5), 2.0);
            float yy = (1.0 - bb) * aa + bb * (2.0 - aa);

            float kk = 2.0 * period;
            float dw = scratchWidth / uDimensions.x * (0.75 + uSeed);
            float dh = dw * kk;

            float tine = (yy - (2.0 - dh));

            if (tine > 0.0) {
                float _sign = sign(scratch);

                tine = s * tine / period + scratch + 0.1;
                tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);

                color.rgb *= tine;
            }
        }
    }

    float noise = uNoise[0];
    float noiseSize = uNoise[1];

    if (noise > 0.0 && noiseSize > 0.0)
    {
        vec2 pixelCoord = vTextureCoord.xy * uInputSize.xy;
        pixelCoord.x = floor(pixelCoord.x / noiseSize);
        pixelCoord.y = floor(pixelCoord.y / noiseSize);
        // vec2 d = pixelCoord * noiseSize * vec2(1024.0 + uSeed * 512.0, 1024.0 - uSeed * 512.0);
        // float _noise = snoise(d) * 0.5;
        float _noise = rand(pixelCoord * noiseSize * uSeed) - 0.5;
        color += _noise * noise;
    }

    finalColor.rgb = color;
}`;var g$=`struct OldFilmUniforms {
    uSepia: f32,
    uNoise: vec2<f32>,
    uScratch: vec3<f32>,
    uVignetting: vec3<f32>,
    uSeed: f32,
    uDimensions: vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> oldFilmUniforms : OldFilmUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);

  if (oldFilmUniforms.uSepia > 0.)
  {
    color = vec4<f32>(sepia(color.rgb), color.a);
  }

  let coord: vec2<f32> = uv * gfu.uInputSize.xy / oldFilmUniforms.uDimensions;

  if (oldFilmUniforms.uVignetting[0] > 0.)
  {
    color *= vec4<f32>(vec3<f32>(vignette(color.rgb, coord)), color.a);
  }

  let uScratch = oldFilmUniforms.uScratch; 

  if (uScratch[1] > oldFilmUniforms.uSeed && uScratch[0] != 0.)
  {
    color = vec4<f32>(scratch(color.rgb, coord), color.a);
  }

  let uNoise = oldFilmUniforms.uNoise;

  if (uNoise[0] > 0.0 && uNoise[1] > 0.0)
  {
    color += vec4<f32>(vec3<f32>(noise(uv)), color.a);
  }

  return color;
}

const SQRT_2: f32 = 1.414213;
const SEPIA_RGB: vec3<f32> = vec3<f32>(112.0 / 255.0, 66.0 / 255.0, 20.0 / 255.0);

fn modulo(x: f32, y: f32) -> f32
{
  return x - y * floor(x/y);
}

fn rand(co: vec2<f32>) -> f32
{
  return fract(sin(dot(co, vec2<f32>(12.9898, 78.233))) * 43758.5453);
}

fn overlay(src: vec3<f32>, dst: vec3<f32>) -> vec3<f32>
{
    // if (dst <= 0.5) then: 2 * src * dst
    // if (dst > 0.5) then: 1 - 2 * (1 - dst) * (1 - src)

    return vec3<f32>(
      select((1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)), (2.0 * src.x * dst.x), (dst.x <= 0.5)), 
      select((1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)), (2.0 * src.y * dst.y), (dst.y <= 0.5)),
      select((1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)), (2.0 * src.z * dst.z), (dst.z <= 0.5))
    );
}

fn sepia(co: vec3<f32>) -> vec3<f32>
{
  let gray: f32 = (co.x + co.y + co.z) / 3.0;
  let grayscale: vec3<f32> = vec3<f32>(gray);
  let color = overlay(SEPIA_RGB, grayscale);
  return grayscale + oldFilmUniforms.uSepia * (color - grayscale);
}

fn vignette(co: vec3<f32>, coord: vec2<f32>) -> f32
{
  let uVignetting = oldFilmUniforms.uVignetting;
  let uDimensions = oldFilmUniforms.uDimensions;
  
  let outter: f32 = SQRT_2 - uVignetting[0] * SQRT_2;
  var dir: vec2<f32> = vec2<f32>(vec2<f32>(0.5) - coord);
  dir.y *= uDimensions.y / uDimensions.x;
  let darker: f32 = clamp((outter - length(dir) * SQRT_2) / ( 0.00001 + uVignetting[2] * SQRT_2), 0.0, 1.0);
  return darker + (1.0 - darker) * (1.0 - uVignetting[1]);
}

fn scratch(co: vec3<f32>, coord: vec2<f32>) -> vec3<f32>
{
  var color = co;
  let uScratch = oldFilmUniforms.uScratch;
  let uSeed = oldFilmUniforms.uSeed;
  let uDimensions = oldFilmUniforms.uDimensions;

  let phase: f32 = uSeed * 256.0;
  let s: f32 = modulo(floor(phase), 2.0);
  let dist: f32 = 1.0 / uScratch[1];
  let d: f32 = distance(coord, vec2<f32>(uSeed * dist, abs(s - uSeed * dist)));

  if (d < uSeed * 0.6 + 0.4)
  {
    let period: f32 = uScratch[1] * 10.0;

    let xx: f32 = coord.x * period + phase;
    let aa: f32 = abs(modulo(xx, 0.5) * 4.0);
    let bb: f32 = modulo(floor(xx / 0.5), 2.0);
    let yy: f32 = (1.0 - bb) * aa + bb * (2.0 - aa);

    let kk: f32 = 2.0 * period;
    let dw: f32 = uScratch[2] / uDimensions.x * (0.75 + uSeed);
    let dh: f32 = dw * kk;

    var tine: f32 = (yy - (2.0 - dh));

    if (tine > 0.0) {
        let _sign: f32 = sign(uScratch[0]);

        tine = s * tine / period + uScratch[0] + 0.1;
        tine = clamp(tine + 1.0, 0.5 + _sign * 0.5, 1.5 + _sign * 0.5);

        color *= tine;
    }
  }

  return color;
}

fn noise(coord: vec2<f32>) -> f32
{
  let uNoise = oldFilmUniforms.uNoise;
  let uSeed = oldFilmUniforms.uSeed;

  var pixelCoord: vec2<f32> = coord * gfu.uInputSize.xy;
  pixelCoord.x = floor(pixelCoord.x / uNoise[1]);
  pixelCoord.y = floor(pixelCoord.y / uNoise[1]);
  return (rand(pixelCoord * uNoise[1] * uSeed) - 0.5) * uNoise[0];
}`;var Mte=Object.defineProperty,Rte=(n,e,t)=>e in n?Mte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,jk=(n,e,t)=>(Rte(n,typeof e!="symbol"?e+"":e,t),t),Fte=class y$ extends be{constructor(e){e={...y$.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:g$,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:m$,name:"old-film-filter"});super({gpuProgram:t,glProgram:r,resources:{oldFilmUniforms:{uSepia:{value:e.sepia,type:"f32"},uNoise:{value:new Float32Array(2),type:"vec2<f32>"},uScratch:{value:new Float32Array(3),type:"vec3<f32>"},uVignetting:{value:new Float32Array(3),type:"vec3<f32>"},uSeed:{value:e.seed,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),jk(this,"uniforms"),jk(this,"seed"),this.uniforms=this.resources.oldFilmUniforms.uniforms,Object.assign(this,e)}apply(e,t,r,i){this.uniforms.uDimensions[0]=t.frame.width,this.uniforms.uDimensions[1]=t.frame.height,this.uniforms.uSeed=this.seed,e.applyFilter(this,t,r,i)}get sepia(){return this.uniforms.uSepia}set sepia(e){this.uniforms.uSepia=e}get noise(){return this.uniforms.uNoise[0]}set noise(e){this.uniforms.uNoise[0]=e}get noiseSize(){return this.uniforms.uNoise[1]}set noiseSize(e){this.uniforms.uNoise[1]=e}get scratch(){return this.uniforms.uScratch[0]}set scratch(e){this.uniforms.uScratch[0]=e}get scratchDensity(){return this.uniforms.uScratch[1]}set scratchDensity(e){this.uniforms.uScratch[1]=e}get scratchWidth(){return this.uniforms.uScratch[2]}set scratchWidth(e){this.uniforms.uScratch[2]=e}get vignetting(){return this.uniforms.uVignetting[0]}set vignetting(e){this.uniforms.uVignetting[0]=e}get vignettingAlpha(){return this.uniforms.uVignetting[1]}set vignettingAlpha(e){this.uniforms.uVignetting[1]=e}get vignettingBlur(){return this.uniforms.uVignetting[2]}set vignettingBlur(e){this.uniforms.uVignetting[2]=e}};jk(Fte,"DEFAULT_OPTIONS",{sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,seed:0});var x$=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uThickness;
uniform vec3 uColor;
uniform float uAlpha;
uniform float uKnockout;

uniform vec4 uInputClamp;

const float DOUBLE_PI = 2. * 3.14159265358979323846264;
const float ANGLE_STEP = \${ANGLE_STEP};

float outlineMaxAlphaAtPos(vec2 pos) {
    if (uThickness.x == 0. || uThickness.y == 0.) {
        return 0.;
    }

    vec4 displacedColor;
    vec2 displacedPos;
    float maxAlpha = 0.;

    for (float angle = 0.; angle <= DOUBLE_PI; angle += ANGLE_STEP) {
        displacedPos.x = vTextureCoord.x + uThickness.x * cos(angle);
        displacedPos.y = vTextureCoord.y + uThickness.y * sin(angle);
        displacedColor = texture(uTexture, clamp(displacedPos, uInputClamp.xy, uInputClamp.zw));
        maxAlpha = max(maxAlpha, displacedColor.a);
    }

    return maxAlpha;
}

void main(void) {
    vec4 sourceColor = texture(uTexture, vTextureCoord);
    vec4 contentColor = sourceColor * float(uKnockout < 0.5);
    float outlineAlpha = uAlpha * outlineMaxAlphaAtPos(vTextureCoord.xy) * (1.-sourceColor.a);
    vec4 outlineColor = vec4(vec3(uColor) * outlineAlpha, outlineAlpha);
    finalColor = contentColor + outlineColor;
}
`;var b$=`struct OutlineUniforms {
  uThickness:vec2<f32>,
  uColor:vec3<f32>,
  uAlpha:f32,
  uAngleStep:f32,
  uKnockout:f32,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> outlineUniforms : OutlineUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let sourceColor: vec4<f32> = textureSample(uTexture, uSampler, uv);
  let contentColor: vec4<f32> = sourceColor * (1. - outlineUniforms.uKnockout);
  
  let outlineAlpha: f32 = outlineUniforms.uAlpha * outlineMaxAlphaAtPos(uv) * (1. - sourceColor.a);
  let outlineColor: vec4<f32> = vec4<f32>(vec3<f32>(outlineUniforms.uColor) * outlineAlpha, outlineAlpha);
  
  return contentColor + outlineColor;
}

fn outlineMaxAlphaAtPos(uv: vec2<f32>) -> f32 {
  let thickness = outlineUniforms.uThickness;

  if (thickness.x == 0. || thickness.y == 0.) {
    return 0.;
  }
  
  let angleStep = outlineUniforms.uAngleStep;

  var displacedColor: vec4<f32>;
  var displacedPos: vec2<f32>;

  var maxAlpha: f32 = 0.;
  var displaced: vec2<f32>;
  var curColor: vec4<f32>;

  for (var angle = 0.; angle <= DOUBLE_PI; angle += angleStep)
  {
    displaced.x = uv.x + thickness.x * cos(angle);
    displaced.y = uv.y + thickness.y * sin(angle);
    curColor = textureSample(uTexture, uSampler, clamp(displaced, gfu.uInputClamp.xy, gfu.uInputClamp.zw));
    maxAlpha = max(maxAlpha, curColor.a);
  }

  return maxAlpha;
}

const DOUBLE_PI: f32 = 3.14159265358979323846264 * 2.;`;var Bte=Object.defineProperty,Nte=(n,e,t)=>e in n?Bte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,E1=(n,e,t)=>(Nte(n,typeof e!="symbol"?e+"":e,t),t),Xk=class A1 extends be{constructor(...e){let t=e[0]??{};typeof t=="number"&&(oe("6.0.0","OutlineFilter constructor params are now options object. See params: { thickness, color, quality, alpha, knockout }"),t={thickness:t},e[1]!==void 0&&(t.color=e[1]),e[2]!==void 0&&(t.quality=e[2]),e[3]!==void 0&&(t.alpha=e[3]),e[4]!==void 0&&(t.knockout=e[4])),t={...A1.DEFAULT_OPTIONS,...t};let r=t.quality??.1,i=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:b$,entryPoint:"mainFragment"}}),s=he.from({vertex:Pe,fragment:x$.replace(/\$\{ANGLE_STEP\}/,A1.getAngleStep(r).toFixed(7)),name:"outline-filter"});super({gpuProgram:i,glProgram:s,resources:{outlineUniforms:{uThickness:{value:new Float32Array(2),type:"vec2<f32>"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:t.alpha,type:"f32"},uAngleStep:{value:0,type:"f32"},uKnockout:{value:t.knockout?1:0,type:"f32"}}}}),E1(this,"uniforms"),E1(this,"_thickness"),E1(this,"_quality"),E1(this,"_color"),this.uniforms=this.resources.outlineUniforms.uniforms,this.uniforms.uAngleStep=A1.getAngleStep(r),this._color=new ce,this.color=t.color??0,Object.assign(this,t)}apply(e,t,r,i){this.uniforms.uThickness[0]=this.thickness/t.source.width,this.uniforms.uThickness[1]=this.thickness/t.source.height,e.applyFilter(this,t,r,i)}static getAngleStep(e){return parseFloat((Math.PI*2/Math.max(e*A1.MAX_SAMPLES,A1.MIN_SAMPLES)).toFixed(7))}get thickness(){return this._thickness}set thickness(e){this._thickness=this.padding=e}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,i]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=i}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}get quality(){return this._quality}set quality(e){this._quality=e,this.uniforms.uAngleStep=A1.getAngleStep(e)}get knockout(){return this.uniforms.uKnockout===1}set knockout(e){this.uniforms.uKnockout=e?1:0}};E1(Xk,"DEFAULT_OPTIONS",{thickness:1,color:0,alpha:1,quality:.1,knockout:!1});E1(Xk,"MIN_SAMPLES",1);E1(Xk,"MAX_SAMPLES",100);var _$=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform float uRadian;
uniform vec2 uCenter;
uniform float uRadius;
uniform int uKernelSize;

uniform vec4 uInputSize;

const int MAX_KERNEL_SIZE = 2048;

void main(void)
{
    vec4 color = texture(uTexture, vTextureCoord);

    if (uKernelSize == 0)
    {
        finalColor = color;
        return;
    }

    float aspect = uInputSize.y / uInputSize.x;
    vec2 center = uCenter.xy / uInputSize.xy;
    float gradient = uRadius / uInputSize.x * 0.3;
    float radius = uRadius / uInputSize.x - gradient * 0.5;
    int k = uKernelSize - 1;

    vec2 coord = vTextureCoord;
    vec2 dir = vec2(center - coord);
    float dist = length(vec2(dir.x, dir.y * aspect));

    float radianStep = uRadian;
    if (radius >= 0.0 && dist > radius) {
        float delta = dist - radius;
        float gap = gradient;
        float scale = 1.0 - abs(delta / gap);
        if (scale <= 0.0) {
            finalColor = color;
            return;
        }
        radianStep *= scale;
    }
    radianStep /= float(k);

    float s = sin(radianStep);
    float c = cos(radianStep);
    mat2 rotationMatrix = mat2(vec2(c, -s), vec2(s, c));

    for(int i = 0; i < MAX_KERNEL_SIZE - 1; i++) {
        if (i == k) {
            break;
        }

        coord -= center;
        coord.y *= aspect;
        coord = rotationMatrix * coord;
        coord.y /= aspect;
        coord += center;

        vec4 sample = texture(uTexture, coord);

        // switch to pre-multiplied alpha to correctly blur transparent images
        // sample.rgb *= sample.a;

        color += sample;
    }

    finalColor = color / float(uKernelSize);
}
`;var v$=`struct RadialBlurUniforms {
  uRadian: f32,
  uCenter: vec2<f32>,
  uKernelSize: f32,
  uRadius: f32,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> radialBlurUniforms : RadialBlurUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uRadian = radialBlurUniforms.uRadian;
  let uCenter = radialBlurUniforms.uCenter;
  let uKernelSize = radialBlurUniforms.uKernelSize;
  let uRadius = radialBlurUniforms.uRadius;
  
  var returnColorOnly = false;

  if (uKernelSize == 0)
  {
    returnColorOnly = true;
  }

  let aspect: f32 = gfu.uInputSize.y / gfu.uInputSize.x;
  let center: vec2<f32> = uCenter.xy / gfu.uInputSize.xy;
  let gradient: f32 = uRadius / gfu.uInputSize.x * 0.3;
  let radius: f32 = uRadius / gfu.uInputSize.x - gradient * 0.5;
  let k: i32 = i32(uKernelSize - 1);

  var coord: vec2<f32> = uv;
  let dir: vec2<f32> = vec2<f32>(center - coord);
  let dist: f32 = length(vec2<f32>(dir.x, dir.y * aspect));

  var radianStep: f32 = uRadian;
  
  if (radius >= 0.0 && dist > radius)
  {
    let delta: f32 = dist - radius;
    let gap: f32 = gradient;
    let scale: f32 = 1.0 - abs(delta / gap);
    if (scale <= 0.0) {
      returnColorOnly = true;
    }
    radianStep *= scale;
  }

  radianStep /= f32(k);

  let s: f32 = sin(radianStep);
  let c: f32 = cos(radianStep);
  let rotationMatrix: mat2x2<f32> = mat2x2<f32>(vec2<f32>(c, -s), vec2<f32>(s, c));
  
  var color: vec4<f32> = textureSample(uTexture, uSampler, uv);
  let baseColor = vec4<f32>(color);

  let minK: i32 = min(i32(uKernelSize) - 1, MAX_KERNEL_SIZE - 1);

  for(var i: i32 = 0; i < minK; i += 1) 
  {
    coord -= center;
    coord.y *= aspect;
    coord = rotationMatrix * coord;
    coord.y /= aspect;
    coord += center;
    let sample: vec4<f32> = textureSample(uTexture, uSampler, coord);
    // switch to pre-multiplied alpha to correctly blur transparent images
    // sample.rgb *= sample.a;
    color += sample;
  }

  return select(color / f32(uKernelSize), baseColor, returnColorOnly);
}

const MAX_KERNEL_SIZE: i32 = 2048;`;var Ote=Object.defineProperty,Lte=(n,e,t)=>e in n?Ote(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Gx=(n,e,t)=>(Lte(n,typeof e!="symbol"?e+"":e,t),t),Ute=class w$ extends be{constructor(...e){let t=e[0]??{};if(typeof t=="number"){if(oe("6.0.0","RadialBlurFilter constructor params are now options object. See params: { angle, center, kernelSize, radius }"),t={angle:t},e[1]){let s="x"in e[1]?e[1].x:e[1][0],o="y"in e[1]?e[1].y:e[1][1];t.center={x:s,y:o}}e[2]&&(t.kernelSize=e[2]),e[3]&&(t.radius=e[3])}t={...w$.DEFAULT_OPTIONS,...t};let r=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:v$,entryPoint:"mainFragment"}}),i=he.from({vertex:Pe,fragment:_$,name:"radial-blur-filter"});super({gpuProgram:r,glProgram:i,resources:{radialBlurUniforms:{uRadian:{value:0,type:"f32"},uCenter:{value:t.center,type:"vec2<f32>"},uKernelSize:{value:t.kernelSize,type:"i32"},uRadius:{value:t.radius,type:"f32"}}}}),Gx(this,"uniforms"),Gx(this,"_angle"),Gx(this,"_kernelSize"),this.uniforms=this.resources.radialBlurUniforms.uniforms,Object.assign(this,t)}_updateKernelSize(){this.uniforms.uKernelSize=this._angle!==0?this.kernelSize:0}get angle(){return this._angle}set angle(e){this._angle=e,this.uniforms.uRadian=e*Math.PI/180,this._updateKernelSize()}get center(){return this.uniforms.uCenter}set center(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uCenter=e}get centerX(){return this.center.x}set centerX(e){this.center.x=e}get centerY(){return this.center.y}set centerY(e){this.center.y=e}get kernelSize(){return this._kernelSize}set kernelSize(e){this._kernelSize=e,this._updateKernelSize()}get radius(){return this.uniforms.uRadius}set radius(e){this.uniforms.uRadius=e<0||e===1/0?-1:e}};Gx(Ute,"DEFAULT_OPTIONS",{angle:0,center:{x:0,y:0},kernelSize:5,radius:-1});var S$=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform float uMirror;
uniform float uBoundary;
uniform vec2 uAmplitude;
uniform vec2 uWavelength;
uniform vec2 uAlpha;
uniform float uTime;
uniform vec2 uDimensions;

uniform vec4 uInputSize;
uniform vec4 uInputClamp;

float rand(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main(void)
{
    vec2 pixelCoord = vTextureCoord.xy * uInputSize.xy;
    vec2 coord = pixelCoord / uDimensions;

    if (coord.y < uBoundary) {
        finalColor = texture(uTexture, vTextureCoord);
        return;
    }

    float k = (coord.y - uBoundary) / (1. - uBoundary + 0.0001);
    float areaY = uBoundary * uDimensions.y / uInputSize.y;
    float v = areaY + areaY - vTextureCoord.y;
    float y = uMirror > 0.5 ? v : vTextureCoord.y;

    float _amplitude = ((uAmplitude.y - uAmplitude.x) * k + uAmplitude.x ) / uInputSize.x;
    float _waveLength = ((uWavelength.y - uWavelength.x) * k + uWavelength.x) / uInputSize.y;
    float _alpha = (uAlpha.y - uAlpha.x) * k + uAlpha.x;

    float x = vTextureCoord.x + cos(v * 6.28 / _waveLength - uTime) * _amplitude;
    x = clamp(x, uInputClamp.x, uInputClamp.z);

    vec4 color = texture(uTexture, vec2(x, y));

    finalColor = color * _alpha;
}
`;var C$=`struct ReflectionUniforms {
  uMirror: f32,
  uBoundary: f32,
  uAmplitude: vec2<f32>,
  uWavelength: vec2<f32>,
  uAlpha: vec2<f32>,
  uTime: f32,
  uDimensions: vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> reflectionUniforms : ReflectionUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uDimensions: vec2<f32> = reflectionUniforms.uDimensions;
  let uBoundary: f32 = reflectionUniforms.uBoundary;
  let uMirror: bool = reflectionUniforms.uMirror > 0.5;
  let uAmplitude: vec2<f32> = reflectionUniforms.uAmplitude;
  let uWavelength: vec2<f32> = reflectionUniforms.uWavelength;
  let uAlpha: vec2<f32> = reflectionUniforms.uAlpha;
  let uTime: f32 = reflectionUniforms.uTime;

  let pixelCoord: vec2<f32> = uv * gfu.uInputSize.xy;
  let coord: vec2<f32> = pixelCoord /uDimensions;
  var returnColorOnly: bool = false;

  if (coord.y < uBoundary) {
    returnColorOnly = true;
  }

  let k: f32 = (coord.y - uBoundary) / (1. - uBoundary + 0.0001);
  let areaY: f32 = uBoundary * uDimensions.y / gfu.uInputSize.y;
  let v: f32 = areaY + areaY - uv.y;
  let y: f32 = select(uv.y, v, uMirror);

  let amplitude: f32 = ((uAmplitude.y - uAmplitude.x) * k + uAmplitude.x ) / gfu.uInputSize.x;
  let waveLength: f32 = ((uWavelength.y - uWavelength.x) * k + uWavelength.x) / gfu.uInputSize.y;
  let alpha: f32 = select((uAlpha.y - uAlpha.x) * k + uAlpha.x, 1., returnColorOnly);

  var x: f32 = uv.x + cos(v * 6.28 / waveLength - uTime) * amplitude;
  x = clamp(x, gfu.uInputClamp.x, gfu.uInputClamp.z);
  
  return textureSample(uTexture, uSampler, select(vec2<f32>(x, y), uv, returnColorOnly)) * alpha;
}

fn rand(co: vec2<f32>) -> f32 
{
  return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}`;var Gte=Object.defineProperty,$te=(n,e,t)=>e in n?Gte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,qk=(n,e,t)=>($te(n,typeof e!="symbol"?e+"":e,t),t),zte=class A$ extends be{constructor(e){e={...A$.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:C$,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:S$,name:"reflection-filter"});super({gpuProgram:t,glProgram:r,resources:{reflectionUniforms:{uMirror:{value:e.mirror?1:0,type:"f32"},uBoundary:{value:e.boundary,type:"f32"},uAmplitude:{value:e.amplitude,type:"vec2<f32>"},uWavelength:{value:e.waveLength,type:"vec2<f32>"},uAlpha:{value:e.alpha,type:"vec2<f32>"},uTime:{value:e.time,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}}}}),qk(this,"uniforms"),qk(this,"time",0),this.uniforms=this.resources.reflectionUniforms.uniforms,Object.assign(this,e)}apply(e,t,r,i){this.uniforms.uDimensions[0]=t.frame.width,this.uniforms.uDimensions[1]=t.frame.height,this.uniforms.uTime=this.time,e.applyFilter(this,t,r,i)}get mirror(){return this.uniforms.uMirror>.5}set mirror(e){this.uniforms.uMirror=e?1:0}get boundary(){return this.uniforms.uBoundary}set boundary(e){this.uniforms.uBoundary=e}get amplitude(){return Array.from(this.uniforms.uAmplitude)}set amplitude(e){this.uniforms.uAmplitude[0]=e[0],this.uniforms.uAmplitude[1]=e[1]}get amplitudeStart(){return this.uniforms.uAmplitude[0]}set amplitudeStart(e){this.uniforms.uAmplitude[0]=e}get amplitudeEnd(){return this.uniforms.uAmplitude[1]}set amplitudeEnd(e){this.uniforms.uAmplitude[1]=e}get waveLength(){return Array.from(this.uniforms.uWavelength)}set waveLength(e){this.uniforms.uWavelength[0]=e[0],this.uniforms.uWavelength[1]=e[1]}get wavelengthStart(){return this.uniforms.uWavelength[0]}set wavelengthStart(e){this.uniforms.uWavelength[0]=e}get wavelengthEnd(){return this.uniforms.uWavelength[1]}set wavelengthEnd(e){this.uniforms.uWavelength[1]=e}get alpha(){return Array.from(this.uniforms.uAlpha)}set alpha(e){this.uniforms.uAlpha[0]=e[0],this.uniforms.uAlpha[1]=e[1]}get alphaStart(){return this.uniforms.uAlpha[0]}set alphaStart(e){this.uniforms.uAlpha[0]=e}get alphaEnd(){return this.uniforms.uAlpha[1]}set alphaEnd(e){this.uniforms.uAlpha[1]=e}};qk(zte,"DEFAULT_OPTIONS",{mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0});var E$=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec4 uInputSize;
uniform vec2 uRed;
uniform vec2 uGreen;
uniform vec2 uBlue;

void main(void)
{
   float r = texture(uTexture, vTextureCoord + uRed/uInputSize.xy).r;
   float g = texture(uTexture, vTextureCoord + uGreen/uInputSize.xy).g;
   float b = texture(uTexture, vTextureCoord + uBlue/uInputSize.xy).b;
   float a = texture(uTexture, vTextureCoord).a;
   finalColor = vec4(r, g, b, a);
}
`;var T$=`struct RgbSplitUniforms {
    uRed: vec2<f32>,
    uGreen: vec2<f32>,
    uBlue: vec3<f32>,
};

struct GlobalFilterUniforms {
    uInputSize:vec4<f32>,
    uInputPixel:vec4<f32>,
    uInputClamp:vec4<f32>,
    uOutputFrame:vec4<f32>,
    uGlobalFrame:vec4<f32>,
    uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> rgbSplitUniforms : RgbSplitUniforms;

@fragment
fn mainFragment(
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
    let r = textureSample(uTexture, uSampler, uv + vec2<f32>(rgbSplitUniforms.uRed.x / gfu.uInputSize.x, rgbSplitUniforms.uRed.y / gfu.uInputSize.y)).r;
    let g = textureSample(uTexture, uSampler, uv + vec2<f32>(rgbSplitUniforms.uGreen.x / gfu.uInputSize.x, rgbSplitUniforms.uGreen.y / gfu.uInputSize.y)).g;
    let b = textureSample(uTexture, uSampler, uv + vec2<f32>(rgbSplitUniforms.uBlue.x / gfu.uInputSize.x, rgbSplitUniforms.uBlue.y / gfu.uInputSize.y)).b;
    let a = textureSample(uTexture, uSampler, uv).a;
    return vec4<f32>(r, g, b, a);
}
`;var Hte=Object.defineProperty,Wte=(n,e,t)=>e in n?Hte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,k$=(n,e,t)=>(Wte(n,typeof e!="symbol"?e+"":e,t),t),Vte=class I$ extends be{constructor(...e){let t=e[0]??{};(Array.isArray(t)||"x"in t&&"y"in t)&&(oe("6.0.0","RGBSplitFilter constructor params are now options object. See params: { red, green, blue }"),t={red:t},e[1]!==void 0&&(t.green=e[1]),e[2]!==void 0&&(t.blue=e[2])),t={...I$.DEFAULT_OPTIONS,...t};let r=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:T$,entryPoint:"mainFragment"}}),i=he.from({vertex:Pe,fragment:E$,name:"rgb-split-filter"});super({gpuProgram:r,glProgram:i,resources:{rgbSplitUniforms:{uRed:{value:t.red,type:"vec2<f32>"},uGreen:{value:t.green,type:"vec2<f32>"},uBlue:{value:t.blue,type:"vec2<f32>"}}}}),k$(this,"uniforms"),this.uniforms=this.resources.rgbSplitUniforms.uniforms,Object.assign(this,t)}get red(){return this.uniforms.uRed}set red(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uRed=e}get redX(){return this.red.x}set redX(e){this.red.x=e}get redY(){return this.red.y}set redY(e){this.red.y=e}get green(){return this.uniforms.uGreen}set green(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uGreen=e}get greenX(){return this.green.x}set greenX(e){this.green.x=e}get greenY(){return this.green.y}set greenY(e){this.green.y=e}get blue(){return this.uniforms.uBlue}set blue(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uBlue=e}get blueX(){return this.blue.x}set blueX(e){this.blue.x=e}get blueY(){return this.blue.y}set blueY(e){this.blue.y=e}};k$(Vte,"DEFAULT_OPTIONS",{red:{x:-10,y:0},green:{x:0,y:10},blue:{x:0,y:0}});var P$=`
precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uCenter;
uniform float uTime;
uniform float uSpeed;
uniform vec4 uWave;

uniform vec4 uInputSize;
uniform vec4 uInputClamp;

const float PI = 3.14159;

void main()
{
    float uAmplitude = uWave[0];
    float uWavelength = uWave[1];
    float uBrightness = uWave[2];
    float uRadius = uWave[3];

    float halfWavelength = uWavelength * 0.5 / uInputSize.x;
    float maxRadius = uRadius / uInputSize.x;
    float currentRadius = uTime * uSpeed / uInputSize.x;

    float fade = 1.0;

    if (maxRadius > 0.0) {
        if (currentRadius > maxRadius) {
            finalColor = texture(uTexture, vTextureCoord);
            return;
        }
        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);
    }

    vec2 dir = vec2(vTextureCoord - uCenter / uInputSize.xy);
    dir.y *= uInputSize.y / uInputSize.x;
    float dist = length(dir);

    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {
        finalColor = texture(uTexture, vTextureCoord);
        return;
    }

    vec2 diffUV = normalize(dir);

    float diff = (dist - currentRadius) / halfWavelength;

    float p = 1.0 - pow(abs(diff), 2.0);

    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );
    float powDiff = 1.25 * sin(diff * PI) * p * ( uAmplitude * fade );

    vec2 offset = diffUV * powDiff / uInputSize.xy;

    // Do clamp :
    vec2 coord = vTextureCoord + offset;
    vec2 clampedCoord = clamp(coord, uInputClamp.xy, uInputClamp.zw);
    vec4 color = texture(uTexture, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    // No clamp :
    // finalColor = texture(uTexture, vTextureCoord + offset);

    color.rgb *= 1.0 + (uBrightness - 1.0) * p * fade;

    finalColor = color;
}
`;var D$=`
struct ShockWaveUniforms {
    uTime: f32,
    uOffset: vec2<f32>,
    uSpeed: f32,
    uWave: vec4<f32>,
};

struct GlobalFilterUniforms {
    uInputSize:vec4<f32>,
    uInputPixel:vec4<f32>,
    uInputClamp:vec4<f32>,
    uOutputFrame:vec4<f32>,
    uGlobalFrame:vec4<f32>,
    uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> shockwaveUniforms : ShockWaveUniforms;

@fragment
fn mainFragment(
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {

    let uTime = shockwaveUniforms.uTime;
    let uOffset = shockwaveUniforms.uOffset;
    let uSpeed = shockwaveUniforms.uSpeed;
    let uAmplitude = shockwaveUniforms.uWave[0];
    let uWavelength = shockwaveUniforms.uWave[1];
    let uBrightness = shockwaveUniforms.uWave[2];
    let uRadius = shockwaveUniforms.uWave[3];
    let halfWavelength: f32 = uWavelength * 0.5 / gfu.uInputSize.x;
    let maxRadius: f32 = uRadius / gfu.uInputSize.x;
    let currentRadius: f32 = uTime * uSpeed / gfu.uInputSize.x;
    var fade: f32 = 1.0;
    var returnColorOnly: bool = false;
    
    if (maxRadius > 0.0) {
        if (currentRadius > maxRadius) {
            returnColorOnly = true;
        }
        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);
    }
    var dir: vec2<f32> = vec2<f32>(uv - uOffset / gfu.uInputSize.xy);
    dir.y *= gfu.uInputSize.y / gfu.uInputSize.x;

    let dist:f32 = length(dir);

    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {
        returnColorOnly = true;
    }

    let diffUV: vec2<f32> = normalize(dir);
    let diff: f32 = (dist - currentRadius) / halfWavelength;
    let p: f32 = 1.0 - pow(abs(diff), 2.0);
    let powDiff: f32 = 1.25 * sin(diff * PI) * p * ( uAmplitude * fade );
    let offset: vec2<f32> = diffUV * powDiff / gfu.uInputSize.xy;
    // Do clamp :
    let coord: vec2<f32> = uv + offset;
    let clampedCoord: vec2<f32> = clamp(coord, gfu.uInputClamp.xy, gfu.uInputClamp.zw);

    var clampedColor: vec4<f32> = textureSample(uTexture, uSampler, clampedCoord);
    
    if (boolVec2(coord, clampedCoord)) 
    {
        clampedColor *= max(0.0, 1.0 - length(coord - clampedCoord));
    }
    // No clamp :
    var finalColor = clampedColor;

    return select(finalColor, textureSample(uTexture, uSampler, uv), returnColorOnly);
}

fn boolVec2(x: vec2<f32>, y: vec2<f32>) -> bool
{
    if (x.x == y.x && x.y == y.y)
    {
        return true;
    }
    
    return false;
}

const PI: f32 = 3.14159265358979323846264;
`;var jte=Object.defineProperty,Xte=(n,e,t)=>e in n?jte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Yk=(n,e,t)=>(Xte(n,typeof e!="symbol"?e+"":e,t),t),qte=class M$ extends be{constructor(...e){let t=e[0]??{};(Array.isArray(t)||"x"in t&&"y"in t)&&(oe("6.0.0","ShockwaveFilter constructor params are now options object. See params: { center, speed, amplitude, wavelength, brightness, radius, time }"),t={center:t,...e[1]},e[2]!==void 0&&(t.time=e[2])),t={...M$.DEFAULT_OPTIONS,...t};let r=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:D$,entryPoint:"mainFragment"}}),i=he.from({vertex:Pe,fragment:P$,name:"shockwave-filter"});super({gpuProgram:r,glProgram:i,resources:{shockwaveUniforms:{uTime:{value:t.time,type:"f32"},uCenter:{value:t.center,type:"vec2<f32>"},uSpeed:{value:t.speed,type:"f32"},uWave:{value:new Float32Array(4),type:"vec4<f32>"}}}}),Yk(this,"uniforms"),Yk(this,"time"),this.time=0,this.uniforms=this.resources.shockwaveUniforms.uniforms,Object.assign(this,t)}apply(e,t,r,i){this.uniforms.uTime=this.time,e.applyFilter(this,t,r,i)}get center(){return this.uniforms.uCenter}set center(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uCenter=e}get centerX(){return this.uniforms.uCenter.x}set centerX(e){this.uniforms.uCenter.x=e}get centerY(){return this.uniforms.uCenter.y}set centerY(e){this.uniforms.uCenter.y=e}get speed(){return this.uniforms.uSpeed}set speed(e){this.uniforms.uSpeed=e}get amplitude(){return this.uniforms.uWave[0]}set amplitude(e){this.uniforms.uWave[0]=e}get wavelength(){return this.uniforms.uWave[1]}set wavelength(e){this.uniforms.uWave[1]=e}get brightness(){return this.uniforms.uWave[2]}set brightness(e){this.uniforms.uWave[2]=e}get radius(){return this.uniforms.uWave[3]}set radius(e){this.uniforms.uWave[3]=e}};Yk(qte,"DEFAULT_OPTIONS",{center:{x:0,y:0},speed:500,amplitude:30,wavelength:160,brightness:1,radius:-1});var R$=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform sampler2D uMapTexture;
uniform vec3 uColor;
uniform float uAlpha;
uniform vec2 uDimensions;

uniform vec4 uInputSize;

void main() {
    vec4 diffuseColor = texture(uTexture, vTextureCoord);
    vec2 lightCoord = (vTextureCoord * uInputSize.xy) / uDimensions;
    vec4 light = texture(uMapTexture, lightCoord);
    vec3 ambient = uColor.rgb * uAlpha;
    vec3 intensity = ambient + light.rgb;
    vec3 color = diffuseColor.rgb * intensity;
    finalColor = vec4(color, diffuseColor.a);
}
`;var F$=`struct SimpleLightmapUniforms {
  uColor: vec3<f32>,
  uAlpha: f32,
  uDimensions: vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> simpleLightmapUniforms : SimpleLightmapUniforms;
@group(1) @binding(1) var uMapTexture: texture_2d<f32>;
@group(1) @binding(2) var uMapSampler: sampler;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>,
) -> @location(0) vec4<f32> {
  let uColor = simpleLightmapUniforms.uColor;
  let uAlpha = simpleLightmapUniforms.uAlpha;
  let uDimensions = simpleLightmapUniforms.uDimensions;

  let diffuseColor: vec4<f32> = textureSample(uTexture, uSampler, uv);
  let lightCoord: vec2<f32> = (uv * gfu.uInputSize.xy) / simpleLightmapUniforms.uDimensions;
  let light: vec4<f32> = textureSample(uMapTexture, uMapSampler, lightCoord);
  let ambient: vec3<f32> = uColor * uAlpha;
  let intensity: vec3<f32> = ambient + light.rgb;
  let finalColor: vec3<f32> = diffuseColor.rgb * intensity;
  return vec4<f32>(finalColor, diffuseColor.a);
}`;var Yte=Object.defineProperty,Kte=(n,e,t)=>e in n?Yte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$x=(n,e,t)=>(Kte(n,typeof e!="symbol"?e+"":e,t),t),Qte=class B$ extends be{constructor(...e){let t=e[0]??{};if(t instanceof re&&(oe("6.0.0","SimpleLightmapFilter constructor params are now options object. See params: { lightMap, color, alpha }"),t={lightMap:t},e[1]!==void 0&&(t.color=e[1]),e[2]!==void 0&&(t.alpha=e[2])),t={...B$.DEFAULT_OPTIONS,...t},!t.lightMap)throw Error("No light map texture source was provided to SimpleLightmapFilter");let r=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:F$,entryPoint:"mainFragment"}}),i=he.from({vertex:Pe,fragment:R$,name:"simple-lightmap-filter"});super({gpuProgram:r,glProgram:i,resources:{simpleLightmapUniforms:{uColor:{value:new Float32Array(3),type:"vec3<f32>"},uAlpha:{value:t.alpha,type:"f32"},uDimensions:{value:new Float32Array(2),type:"vec2<f32>"}},uMapTexture:t.lightMap.source,uMapSampler:t.lightMap.source.style}}),$x(this,"uniforms"),$x(this,"_color"),$x(this,"_lightMap"),this.uniforms=this.resources.simpleLightmapUniforms.uniforms,this._color=new ce,this.color=t.color??0,Object.assign(this,t)}apply(e,t,r,i){this.uniforms.uDimensions[0]=t.frame.width,this.uniforms.uDimensions[1]=t.frame.height,e.applyFilter(this,t,r,i)}get lightMap(){return this._lightMap}set lightMap(e){this._lightMap=e,this.resources.uMapTexture=e.source,this.resources.uMapSampler=e.source.style}get color(){return this._color.value}set color(e){this._color.setValue(e);let[t,r,i]=this._color.toArray();this.uniforms.uColor[0]=t,this.uniforms.uColor[1]=r,this.uniforms.uColor[2]=i}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}};$x(Qte,"DEFAULT_OPTIONS",{lightMap:re.WHITE,color:0,alpha:1});var N$=`in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uBlur;
uniform vec2 uStart;
uniform vec2 uEnd;
uniform vec2 uDelta;
uniform vec2 uDimensions;

float random(vec3 scale, float seed)
{
    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}

void main(void)
{
    vec4 color = vec4(0.0);
    float total = 0.0;

    float blur = uBlur[0];
    float gradientBlur = uBlur[1];

    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
    vec2 normal = normalize(vec2(uStart.y - uEnd.y, uEnd.x - uStart.x));
    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * uDimensions - uStart, normal)) / gradientBlur) * blur;

    for (float t = -30.0; t <= 30.0; t++)
    {
        float percent = (t + offset - 0.5) / 30.0;
        float weight = 1.0 - abs(percent);
        vec4 sample = texture(uTexture, vTextureCoord + uDelta / uDimensions * percent * radius);
        sample.rgb *= sample.a;
        color += sample * weight;
        total += weight;
    }

    color /= total;
    color.rgb /= color.a + 0.00001;

    finalColor = color;
}
`;var O$=`struct TiltShiftUniforms {
  uBlur: vec2<f32>,
  uStart: vec2<f32>,
  uEnd: vec2<f32>,
  uDelta: vec2<f32>,
  uDimensions: vec2<f32>,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> tiltShiftUniforms : TiltShiftUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uBlur = tiltShiftUniforms.uBlur[0];
  let uBlurGradient = tiltShiftUniforms.uBlur[1];
  let uStart = tiltShiftUniforms.uStart;
  let uEnd = tiltShiftUniforms.uEnd;
  let uDelta = tiltShiftUniforms.uDelta;
  let uDimensions = tiltShiftUniforms.uDimensions;

  var color: vec4<f32> = vec4<f32>(0.0);
  var total: f32 = 0.0;

  let offset: f32 = random(position, vec3<f32>(12.9898, 78.233, 151.7182), 0.0);
  let normal: vec2<f32> = normalize(vec2<f32>(uStart.y - uEnd.y, uEnd.x - uStart.x));
  let radius: f32 = smoothstep(0.0, 1.0, abs(dot(uv * uDimensions - uStart, normal)) / uBlurGradient) * uBlur;

  for (var t: f32 = -30.0; t <= 30.0; t += 1.0)
  {
    var percent: f32 = (t + offset - 0.5) / 30.0;
    var weight: f32 = 1.0 - abs(percent);
    var sample: vec4<f32> = textureSample(uTexture, uSampler, uv + uDelta / uDimensions * percent * radius);
    sample = vec4<f32>(sample.xyz * sample.a, sample.a); // multiply sample.rgb with sample.a
    color += sample * weight;
    total += weight;
  }

  color /= total;
  color = vec4<f32>(color.xyz / (color.a + 0.00001), color.a); // divide color.rgb by color.a + 0.00001

  return color;
}


fn random(position: vec4<f32>, scale: vec3<f32>, seed: f32) -> f32
{
  return fract(sin(dot(position.xyz + seed, scale)) * 43758.5453 + seed);
}`;var Zte=Object.defineProperty,Jte=(n,e,t)=>e in n?Zte(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Kk=(n,e,t)=>(Jte(n,typeof e!="symbol"?e+"":e,t),t),ere=class L$ extends be{constructor(e){let{width:t,height:r}=W0.defaultOptions;e={...L$.DEFAULT_OPTIONS,start:{x:0,y:r/2},end:{x:t,y:r/2},...e};let i=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:O$,entryPoint:"mainFragment"}}),s=he.from({vertex:Pe,fragment:N$,name:"tilt-shift-axis-filter"});super({gpuProgram:i,glProgram:s,resources:{tiltShiftUniforms:{uBlur:{value:new Float32Array([e.blur,e.gradientBlur]),type:"vec2<f32>"},uStart:{value:e.start,type:"vec2<f32>"},uEnd:{value:e.end,type:"vec2<f32>"},uDelta:{value:new Float32Array([0,0]),type:"vec2<f32>"},uDimensions:{value:new Float32Array([t,r]),type:"vec2<f32>"}}}}),Kk(this,"uniforms"),Kk(this,"_tiltAxis"),this.uniforms=this.resources.tiltShiftUniforms.uniforms,this._tiltAxis=e.axis}updateDimensions(e){let{uDimensions:t}=this.uniforms;t[0]=e.frame.width,t[1]=e.frame.height}updateDelta(){if(this.uniforms.uDelta[0]=0,this.uniforms.uDelta[1]=0,this._tiltAxis===void 0)return;let e=this.uniforms.uEnd,t=this.uniforms.uStart,r=e.x-t.x,i=e.y-t.y,s=Math.sqrt(r*r+i*i),o=this._tiltAxis==="vertical";this.uniforms.uDelta[0]=o?-i/s:r/s,this.uniforms.uDelta[1]=o?r/s:i/s}};Kk(ere,"DEFAULT_OPTIONS",{blur:100,gradientBlur:600});var U$=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uTwist;
uniform vec2 uOffset;
uniform vec4 uInputSize;

vec2 mapCoord( vec2 coord )
{
    coord *= uInputSize.xy;
    coord += uInputSize.zw;

    return coord;
}

vec2 unmapCoord( vec2 coord )
{
    coord -= uInputSize.zw;
    coord /= uInputSize.xy;

    return coord;
}

vec2 twist(vec2 coord)
{
    coord -= uOffset;

    float dist = length(coord);
    float uRadius = uTwist[0];
    float uAngle = uTwist[1];

    if (dist < uRadius)
    {
        float ratioDist = (uRadius - dist) / uRadius;
        float angleMod = ratioDist * ratioDist * uAngle;
        float s = sin(angleMod);
        float c = cos(angleMod);
        coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);
    }

    coord += uOffset;

    return coord;
}

void main(void)
{
    vec2 coord = mapCoord(vTextureCoord);
    coord = twist(coord);
    coord = unmapCoord(coord);
    finalColor = texture(uTexture, coord);
}
`;var G$=`struct TwistUniforms {
  uTwist:vec2<f32>,
  uOffset:vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> twistUniforms : TwistUniforms;

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {
  return textureSample(uTexture, uSampler, unmapCoord(twist(mapCoord(uv))));
}

fn mapCoord(coord: vec2<f32> ) -> vec2<f32>
{
  var mappedCoord: vec2<f32> = coord;
  mappedCoord *= gfu.uInputSize.xy;
  mappedCoord += gfu.uOutputFrame.xy;
  return mappedCoord;
}

fn unmapCoord(coord: vec2<f32> ) -> vec2<f32>
{
  var mappedCoord: vec2<f32> = coord;
  mappedCoord -= gfu.uOutputFrame.xy;
  mappedCoord /= gfu.uInputSize.xy;
  return mappedCoord;
}

fn twist(coord: vec2<f32>) -> vec2<f32>
{
  var twistedCoord: vec2<f32> = coord;
  let uRadius = twistUniforms.uTwist[0];
  let uAngle = twistUniforms.uTwist[1];
  let uOffset = twistUniforms.uOffset;

  twistedCoord -= uOffset;
  
  let dist = length(twistedCoord);

  if (dist < uRadius)
  {
    let ratioDist: f32 = (uRadius - dist) / uRadius;
    let angleMod: f32 = ratioDist * ratioDist * uAngle;
    let s: f32 = sin(angleMod);
    let c: f32 = cos(angleMod);
    twistedCoord = vec2<f32>(twistedCoord.x * c - twistedCoord.y * s, twistedCoord.x * s + twistedCoord.y * c);
  }

  twistedCoord += uOffset;
  return twistedCoord;
}
`;var rre=Object.defineProperty,nre=(n,e,t)=>e in n?rre(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$$=(n,e,t)=>(nre(n,typeof e!="symbol"?e+"":e,t),t),ire=class z$ extends be{constructor(e){e={...z$.DEFAULT_OPTIONS,...e};let t=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:G$,entryPoint:"mainFragment"}}),r=he.from({vertex:Pe,fragment:U$,name:"twist-filter"});super({gpuProgram:t,glProgram:r,resources:{twistUniforms:{uTwist:{value:[e.radius??0,e.angle??0],type:"vec2<f32>"},uOffset:{value:e.offset,type:"vec2<f32>"}}},...e}),$$(this,"uniforms"),this.uniforms=this.resources.twistUniforms.uniforms}get radius(){return this.uniforms.uTwist[0]}set radius(e){this.uniforms.uTwist[0]=e}get angle(){return this.uniforms.uTwist[1]}set angle(e){this.uniforms.uTwist[1]=e}get offset(){return this.uniforms.uOffset}set offset(e){this.uniforms.uOffset=e}get offsetX(){return this.offset.x}set offsetX(e){this.offset.x=e}get offsetY(){return this.offset.y}set offsetY(e){this.offset.y=e}};$$(ire,"DEFAULT_OPTIONS",{padding:20,radius:200,angle:4,offset:{x:0,y:0}});var H$=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform float uStrength;
uniform vec2 uCenter;
uniform vec2 uRadii;

uniform vec4 uInputSize;

const float MAX_KERNEL_SIZE = \${MAX_KERNEL_SIZE};

// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand(vec2 co, float seed) {
    const highp float a = 12.9898, b = 78.233, c = 43758.5453;
    highp float dt = dot(co + seed, vec2(a, b)), sn = mod(dt, 3.14159);
    return fract(sin(sn) * c + seed);
}

void main() {
    float minGradient = uRadii[0] * 0.3;
    float innerRadius = (uRadii[0] + minGradient * 0.5) / uInputSize.x;

    float gradient = uRadii[1] * 0.3;
    float radius = (uRadii[1] - gradient * 0.5) / uInputSize.x;

    float countLimit = MAX_KERNEL_SIZE;

    vec2 dir = vec2(uCenter.xy / uInputSize.xy - vTextureCoord);
    float dist = length(vec2(dir.x, dir.y * uInputSize.y / uInputSize.x));

    float strength = uStrength;

    float delta = 0.0;
    float gap;
    if (dist < innerRadius) {
        delta = innerRadius - dist;
        gap = minGradient;
    } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity
        delta = dist - radius;
        gap = gradient;
    }

    if (delta > 0.0) {
        float normalCount = gap / uInputSize.x;
        delta = (normalCount - delta) / normalCount;
        countLimit *= delta;
        strength *= delta;
        if (countLimit < 1.0)
        {
            gl_FragColor = texture(uTexture, vTextureCoord);
            return;
        }
    }

    // randomize the lookup values to hide the fixed number of samples
    float offset = rand(vTextureCoord, 0.0);

    float total = 0.0;
    vec4 color = vec4(0.0);

    dir *= strength;

    for (float t = 0.0; t < MAX_KERNEL_SIZE; t++) {
        float percent = (t + offset) / MAX_KERNEL_SIZE;
        float weight = 4.0 * (percent - percent * percent);
        vec2 p = vTextureCoord + dir * percent;
        vec4 sample = texture(uTexture, p);

        // switch to pre-multiplied alpha to correctly blur transparent images
        // sample.rgb *= sample.a;

        color += sample * weight;
        total += weight;

        if (t > countLimit){
            break;
        }
    }

    color /= total;
    // switch back from pre-multiplied alpha
    // color.rgb /= color.a + 0.00001;

    gl_FragColor = color;
}
`;var W$=`struct ZoomBlurUniforms {
    uStrength:f32,
    uCenter:vec2<f32>,
    uRadii:vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> zoomBlurUniforms : ZoomBlurUniforms;

@fragment
fn mainFragment(
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uStrength = zoomBlurUniforms.uStrength;
  let uCenter = zoomBlurUniforms.uCenter;
  let uRadii = zoomBlurUniforms.uRadii;

  let minGradient: f32 = uRadii[0] * 0.3;
  let innerRadius: f32 = (uRadii[0] + minGradient * 0.5) / gfu.uInputSize.x;

  let gradient: f32 = uRadii[1] * 0.3;
  let radius: f32 = (uRadii[1] - gradient * 0.5) / gfu.uInputSize.x;

  let MAX_KERNEL_SIZE: f32 = \${MAX_KERNEL_SIZE};

  var countLimit: f32 = MAX_KERNEL_SIZE;

  var dir: vec2<f32> = vec2<f32>(uCenter / gfu.uInputSize.xy - uv);
  let dist: f32 = length(vec2<f32>(dir.x, dir.y * gfu.uInputSize.y / gfu.uInputSize.x));

  var strength: f32 = uStrength;

  var delta: f32 = 0.0;
  var gap: f32;

  if (dist < innerRadius) {
      delta = innerRadius - dist;
      gap = minGradient;
  } else if (radius >= 0.0 && dist > radius) { // radius < 0 means it's infinity
      delta = dist - radius;
      gap = gradient;
  }

  var returnColorOnly: bool = false;

  if (delta > 0.0) {
    let normalCount: f32 = gap / gfu.uInputSize.x;
    delta = (normalCount - delta) / normalCount;
    countLimit *= delta;
    strength *= delta;
    
    if (countLimit < 1.0)
    {
      returnColorOnly = true;;
    }
  }

  // randomize the lookup values to hide the fixed number of samples
  let offset: f32 = rand(uv, 0.0);

  var total: f32 = 0.0;
  var color: vec4<f32> = vec4<f32>(0.);

  dir *= strength;

  for (var t = 0.0; t < MAX_KERNEL_SIZE; t += 1.0) {
    let percent: f32 = (t + offset) / MAX_KERNEL_SIZE;
    let weight: f32 = 4.0 * (percent - percent * percent);
    let p: vec2<f32> = uv + dir * percent;
    let sample: vec4<f32> = textureSample(uTexture, uSampler, p);
    
    if (t < countLimit)
    {
      color += sample * weight;
      total += weight;
    }
  }

  color /= total;

  return select(color, textureSample(uTexture, uSampler, uv), returnColorOnly);
}

fn modulo(x: f32, y: f32) -> f32
{
  return x - y * floor(x/y);
}

// author: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
fn rand(co: vec2<f32>, seed: f32) -> f32
{
  let a: f32 = 12.9898;
  let b: f32 = 78.233;
  let c: f32 = 43758.5453;
  let dt: f32 = dot(co + seed, vec2<f32>(a, b));
  let sn: f32 = modulo(dt, 3.14159);
  return fract(sin(sn) * c + seed);
}`;var sre=Object.defineProperty,ore=(n,e,t)=>e in n?sre(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,V$=(n,e,t)=>(ore(n,typeof e!="symbol"?e+"":e,t),t),are=class j$ extends be{constructor(e){e={...j$.DEFAULT_OPTIONS,...e};let t=e.maxKernelSize??32,r=pe.from({vertex:{source:De,entryPoint:"mainVertex"},fragment:{source:W$.replace("${MAX_KERNEL_SIZE}",t.toFixed(1)),entryPoint:"mainFragment"}}),i=he.from({vertex:Pe,fragment:H$.replace("${MAX_KERNEL_SIZE}",t.toFixed(1)),name:"zoom-blur-filter"});super({gpuProgram:r,glProgram:i,resources:{zoomBlurUniforms:{uStrength:{value:e.strength,type:"f32"},uCenter:{value:e.center,type:"vec2<f32>"},uRadii:{value:new Float32Array(2),type:"vec2<f32>"}}}}),V$(this,"uniforms"),this.uniforms=this.resources.zoomBlurUniforms.uniforms,Object.assign(this,e)}get strength(){return this.uniforms.uStrength}set strength(e){this.uniforms.uStrength=e}get center(){return this.uniforms.uCenter}set center(e){Array.isArray(e)&&(e={x:e[0],y:e[1]}),this.uniforms.uCenter=e}get centerX(){return this.uniforms.uCenter.x}set centerX(e){this.uniforms.uCenter.x=e}get centerY(){return this.uniforms.uCenter.y}set centerY(e){this.uniforms.uCenter.y=e}get innerRadius(){return this.uniforms.uRadii[0]}set innerRadius(e){this.uniforms.uRadii[0]=e}get radius(){return this.uniforms.uRadii[1]}set radius(e){this.uniforms.uRadii[1]=e<0||e===1/0?-1:e}};V$(are,"DEFAULT_OPTIONS",{strength:.1,center:{x:0,y:0},innerRadius:0,radius:-1,maxKernelSize:32});function X$(n){return n instanceof Set?n:new Set(n!==void 0&&[].concat(n))}var St=class{constructor(e,t){this.scene=e,this.gfx=e.gfx,this.context=e.context,this.layerID=t,this._enabled=!1,this.features=new Map,this.retained=new Map,this._featureHasData=new Map,this._dataHasFeature=new Map,this._parentHasChildren=new Map,this._childHasParents=new Map,this._dataHasClass=new Map,this._classHasData=new Map}reset(){this._featureHasData.clear(),this._dataHasFeature.clear(),this._parentHasChildren.clear(),this._childHasParents.clear(),this._dataHasClass.clear(),this._classHasData.clear();for(let e of this.features.values())e.destroy();this.features.clear(),this.retained.clear()}render(){}cull(e){for(let[t,r]of this.features){let i=this.retained.get(t);i!==e&&(r.visible=!1,e-i>20&&r.destroy())}}addFeature(e){this.features.set(e.id,e)}removeFeature(e){this.unbindData(e.id),this.retained.delete(e.id),this.features.delete(e.id)}retainFeature(e,t){e.lod>0&&(e.visible=!0),this.retained.set(e.id,t)}bindData(e,t){this.unbindData(e);let r=this._dataHasFeature.get(t);r||(r=new Set,this._dataHasFeature.set(t,r)),r.add(e),this._featureHasData.set(e,t)}unbindData(e){let t=this._featureHasData.get(e);if(!t)return;let r=this._dataHasFeature.get(t);r&&(r.delete(e),r.size||(this._dataHasFeature.delete(t),this._parentHasChildren.delete(t),this._childHasParents.delete(t))),this._featureHasData.delete(e)}addChildData(e,t){let r=this._parentHasChildren.get(e);r||(r=new Set,this._parentHasChildren.set(e,r)),r.add(t);let i=this._childHasParents.get(t);i||(i=new Set,this._childHasParents.set(t,i)),i.add(e)}removeChildData(e,t){let r=this._parentHasChildren.get(e);r&&(r.delete(t),r.size||this._parentHasChildren.get(t)||this._parentHasChildren.delete(t));let i=this._childHasParents.get(t);i&&(i.delete(t),i.size||this._childHasParents.delete(t))}clearChildData(e){let t=this._parentHasChildren.get(e)??new Set;for(let r of t)this.removeChildData(e,r)}getSelfAndDescendants(e,t){t instanceof Set?t.add(e):t=new Set([e]);let r=this._parentHasChildren.get(e)??new Set;for(let i of r)t.has(i)||this.getSelfAndDescendants(i,t);return t}getSelfAndAncestors(e,t){t instanceof Set?t.add(e):t=new Set([e]);let r=this._childHasParents.get(e)??new Set;for(let i of r)t.has(i)||this.getSelfAndAncestors(i,t);return t}getSelfAndSiblings(e,t){t instanceof Set?t.add(e):t=new Set([e]);let r=this._childHasParents.get(e)??new Set;for(let i of r){let s=this._parentHasChildren.get(i)??new Set;for(let o of s)t.add(o)}return t}setClass(e,t){let r=this._dataHasClass.get(t);r||(r=new Set,this._dataHasClass.set(t,r)),r.add(e);let i=this._classHasData.get(e);i||(i=new Set,this._classHasData.set(e,i)),i.add(t)}unsetClass(e,t){let r=this._dataHasClass.get(t);r&&(r.delete(e),r.size||this._dataHasClass.delete(t));let i=this._classHasData.get(e);i&&(i.delete(t),i.size||this._classHasData.delete(e))}clearClass(e){let t=this._classHasData.get(e)??new Set;for(let r of t)this.unsetClass(e,r)}getDataWithClass(e){let t=this._classHasData.get(e)??new Set;return new Set(t)}syncFeatureClasses(e){let t=e.id,r=this._featureHasData.get(t);if(!r)return;let i=this._dataHasClass.get(r)??new Set,s=e._classes;for(let o of s)i.has(o)||e.unsetClass(o);for(let o of i)s.has(o)||e.setClass(o)}dirtyLayer(){for(let e of this.features.values())e.dirty=!0}dirtyFeatures(e){for(let t of X$(e)){let r=this.features.get(t);r&&(r.dirty=!0)}}dirtyData(e){for(let t of X$(e)){let r=this._dataHasFeature.get(t);r&&this.dirtyFeatures(r)}}get id(){return this.layerID}get supported(){return!0}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,this.dirtyLayer())}};var q$=16776960,lre=[0,-.0125,0,-.0125,.5,-.0125,0,-.0125,0],qd=class extends St{constructor(e,t,r){super(e,t),this.enabled=!0,this.isMinimap=r;let i=this.scene.groups.get("background");i.eventMode="none",this.filters={brightness:1,contrast:1,saturation:1,sharpness:1},this._tileMaps=new Map,this._failed=new Set,this._tiler=new or}reset(){super.reset(),this.destroyAll(),this._tileMaps.clear(),this._failed.clear()}render(e,t){let r=this.context.systems.imagery,i=this.scene.groups.get("background"),s=new Map,o=r.baseLayerSource(),a=o?.key;o&&a!=="none"&&s.set(a,o);for(let u of r.overlayLayerSources())s.set(u.id,u);let l=0;for(let[u,d]of s){let f=this.getSourceContainer(u);f.zIndex=d.isLocatorOverlay()?999:l++,!this.isMinimap&&d===o&&this.applyFilters(f);let h=this._tileMaps.get(u);h||(h=new Map,this._tileMaps.set(u,h));let p=window.performance.now();this.renderSource(p,t,d,f,h)}let c=new Set;for(let u of i.children){let d=u.label;s.has(d)||c.add(d)}for(let u of c)this.destroySource(u)}renderSource(e,t,r,i,s){let o=this.context,a=this.gfx.textures,l=o.services.osm,c=t.transform.props,u=r.key;if(isNaN(c.x)||isNaN(c.y))return;let d=!1,f;if(!this.isMinimap){d=o.getDebug("tile");let _=this.scene.layers.get("map-ui").tileDebug;_.visible=d}let h=r.tileSize||256,p=l2(c.k,h),m=yi(r.offset,Math.pow(2,p));i.position.set(m[0],m[1]);let g=new Map,y=Math.max(1,Math.ceil(p)),x=Math.max(1,y-r.zoomRange),b=!1;for(let _=y;!b&&_>=x;_--){if(!r.validZoom(_)||r.isLocatorOverlay()&&y>17)continue;let S=this._tiler.tileSize(h).skipNullIsland(!!r.overlay).zoomRange(_).getTiles(this.isMinimap?t:o.viewport),C=!1;for(let k of S.tiles){if(!this.isMinimap&&_>=10&&l&&r.isLocatorOverlay()){let v=k.wgs84Extent.center();if(l.isDataLoaded(v))continue}k.url=r.url(k.xyz),!k.url||this._failed.has(k.url)?C=!0:g.set(k.id,k)}b=!C}for(let[_,S]of g){if(s.has(_))continue;let C=`${u}-${_}`,k=new At;k.label=C,k.anchor.set(0,1),k.zIndex=S.xyz[2],k.alpha=r.alpha,i.addChild(k),S.sprite=k,s.set(_,S);let v=new Image;v.crossOrigin="anonymous",v.src=S.url,S.image=v,S.loaded=!1,v.onload=()=>{if(this._failed.delete(S.url),!S.sprite||!S.image)return;let w=S.image.naturalWidth,A=S.image.naturalHeight;S.sprite.texture=a.allocate("tile",S.sprite.label,w,A,S.image),S.loaded=!0,S.image=null,this.gfx.deferredRedraw()},v.onerror=()=>{S.image=null,this._failed.add(S.url),this.gfx.deferredRedraw()}}for(let[_,S]of s){let C=!1;if(g.has(_)?(C=!0,S.timestamp=e):r.overlay||(C=e-S.timestamp<3e3),C){let[k,v]=t.project(S.wgs84Extent.min);S.sprite.position.set(k,v);let w=h*Math.pow(2,p-S.xyz[2]);S.sprite.width=w,S.sprite.height=w,d&&f&&!r.overlay&&(S.debug||(S.debug=new ze,S.debug.label=`debug-${_}`,S.debug.eventMode="none",f.addChild(S.debug)),S.text||(S.text=new Wo({text:_,style:{fontFamily:"rapid-debug",fontSize:14}}),S.text.label=`label-${_}`,S.text.tint=q$,S.text.eventMode="none",f.addChild(S.text)),S.debug.position.set(k,v-w),S.text.position.set(k+2,v-w+2),S.debug.clear().rect(0,0,w,w).stroke({width:2,color:q$}))}else this.destroyTile(S),s.delete(_)}}destroyAll(){let e=this.scene.groups.get("background"),t=new Set;for(let r of e.children){let i=r.label;t.add(i)}for(let r of t)this.destroySource(r)}destroySource(e){let t=this._tileMaps.get(e);for(let[s,o]of t)this.destroyTile(o),t.delete(s);this._tileMaps.delete(e);let i=this.scene.groups.get("background").getChildByLabel(e);i&&i.destroy({children:!0})}destroyTile(e){let t=this.gfx.textures;e.sprite&&(e.loaded&&t.free("tile",e.sprite.label),e.sprite.destroy({texture:!0,textureSource:!1})),e.debug&&e.debug.destroy(),e.text&&e.text.destroy(),e.image=null,e.sprite=null,e.debug=null,e.text=null}getSourceContainer(e){let t=this.scene.groups.get("background"),r=t.getChildByLabel(e);return r||(r=new we,r.label=e,r.eventMode="none",r.sortableChildren=!0,t.addChild(r)),r}applyFilters(e){let t=new Nk({brightness:this.filters.brightness,contrast:this.filters.contrast,saturation:this.filters.saturation});if(e.filters=[t],this.filters.sharpness>1){let r=lre.map((i,s)=>{if(s===4){let o=wr(1,2)(this.filters.sharpness);return i*o}else return i});this.convolutionFilter=new zk(r),e.filters=[...e.filters,this.convolutionFilter]}else if(this.filters.sharpness<1){let r=wr(1,8)(1-this.filters.sharpness);this.blurFilter=new ic({strength:r,quality:4}),e.filters=[...e.filters,this.blurFilter]}}setBrightness(e){this.filters.brightness=e}setContrast(e){this.filters.contrast=e}setSaturation(e){this.filters.saturation=e}setSharpness(e){this.filters.sharpness=e}};function jn(n,e){return Array.from(n.getElementsByTagName(e))}function Hx(n){return n[0]==="#"?n:`#${n}`}function cre(n,e,t){return Array.from(n.getElementsByTagNameNS(t,e))}function kn(n){return n?.normalize(),n?.textContent||""}function ai(n,e,t){let r=n.getElementsByTagName(e),i=r.length?r[0]:null;return i&&t&&t(i),i}function Es(n,e,t){let r={};if(!n)return r;let i=n.getElementsByTagName(e),s=i.length?i[0]:null;return s&&t?t(s,r):r}function k1(n,e,t){let r=kn(ai(n,e));return r&&t?t(r)||{}:{}}function Y$(n,e,t){let r=Number.parseFloat(kn(ai(n,e)));if(!Number.isNaN(r))return r&&t?t(r)||{}:{}}function T1(n,e,t){let r=Number.parseFloat(kn(ai(n,e)));if(!Number.isNaN(r))return t&&t(r),r}function bp(n,e){let t={};for(let r of e)k1(n,r,i=>{t[r]=i});return t}function Jk(n){return n?.nodeType===1}function K$(n){let e=[];if(n===null)return e;for(let t of Array.from(n.childNodes)){if(!Jk(t))continue;let r=ure(t.nodeName);if(r==="gpxtpx:TrackPointExtension")e=e.concat(K$(t));else{let i=kn(t);e.push([r,dre(i)])}}return e}function ure(n){return["heart","gpxtpx:hr","hr"].includes(n)?"heart":n}function dre(n){let e=Number.parseFloat(n);return Number.isNaN(e)?n:e}function Q$(n){let e=[Number.parseFloat(n.getAttribute("lon")||""),Number.parseFloat(n.getAttribute("lat")||"")];if(Number.isNaN(e[0])||Number.isNaN(e[1]))return null;T1(n,"ele",r=>{e.push(r)});let t=ai(n,"time");return{coordinates:e,time:t?kn(t):null,extendedValues:K$(ai(n,"extensions"))}}function Z$(n){return Es(n,"line",e=>Object.assign({},k1(e,"color",r=>({stroke:`#${r}`})),Y$(e,"opacity",r=>({"stroke-opacity":r})),Y$(e,"width",r=>({"stroke-width":r*96/25.4}))))}function eI(n,e){let t=bp(e,["name","cmt","desc","type","time","keywords"]);for(let[i,s]of n)for(let o of Array.from(e.getElementsByTagNameNS(s,"*")))t[o.tagName.replace(":","_")]=kn(o)?.trim();let r=jn(e,"link");return r.length&&(t.links=r.map(i=>Object.assign({href:i.getAttribute("href")},bp(i,["text","type"])))),t}function J$(n,e){let t=jn(n,e),r=[],i=[],s={};for(let o=0;o<t.length;o++){let a=Q$(t[o]);if(a){r.push(a.coordinates),a.time&&i.push(a.time);for(let[l,c]of a.extendedValues){let u=l==="heart"?l:`${l.replace("gpxtpx:","")}s`;s[u]||(s[u]=Array(t.length).fill(null)),s[u][o]=c}}}if(!(r.length<2))return{line:r,times:i,extendedValues:s}}function fre(n,e){let t=J$(e,"rtept");if(t)return{type:"Feature",properties:Object.assign({_gpxType:"rte"},eI(n,e),Z$(ai(e,"extensions"))),geometry:{type:"LineString",coordinates:t.line}}}function hre(n,e){let t=jn(e,"trkseg"),r=[],i=[],s=[];for(let l of t){let c=J$(l,"trkpt");c&&(s.push(c),c.times?.length&&i.push(c.times))}if(s.length===0)return null;let o=s.length>1,a=Object.assign({_gpxType:"trk"},eI(n,e),Z$(ai(e,"extensions")),i.length?{coordinateProperties:{times:o?i:i[0]}}:{});for(let l of s){r.push(l.line),a.coordinateProperties||(a.coordinateProperties={});let c=a.coordinateProperties,u=Object.entries(l.extendedValues);for(let d=0;d<u.length;d++){let[f,h]=u[d];o?(c[f]||(c[f]=s.map(p=>new Array(p.line.length).fill(null))),c[f][d]=h):c[f]=h}}return{type:"Feature",properties:a,geometry:o?{type:"MultiLineString",coordinates:r}:{type:"LineString",coordinates:r[0]}}}function pre(n,e){let t=Object.assign(eI(n,e),bp(e,["sym"])),r=Q$(e);return r?{type:"Feature",properties:t,geometry:{type:"Point",coordinates:r.coordinates}}:null}function*mre(n){let e="gpxx",t="http://www.garmin.com/xmlschemas/GpxExtensions/v3",r=[[e,t]],i=n.getElementsByTagName("gpx")[0]?.attributes;if(i)for(let s of Array.from(i))s.name?.startsWith("xmlns:")&&s.value!==t&&r.push([s.name,s.value]);for(let s of jn(n,"trk")){let o=hre(r,s);o&&(yield o)}for(let s of jn(n,"rte")){let o=fre(r,s);o&&(yield o)}for(let s of jn(n,"wpt")){let o=pre(r,s);o&&(yield o)}}function Vx(n){return{type:"FeatureCollection",features:Array.from(mre(n))}}function ez(n,e){let t={},r=e==="stroke"||e==="fill"?e:`${e}-color`;return n[0]==="#"&&(n=n.substring(1)),n.length===6||n.length===3?t[r]=`#${n}`:n.length===8&&(t[`${e}-opacity`]=Number.parseInt(n.substring(0,2),16)/255,t[r]=`#${n.substring(6,8)}${n.substring(4,6)}${n.substring(2,4)}`),t}function Wx(n,e,t){let r={};return T1(n,e,i=>{r[t]=i}),r}function tI(n,e){return Es(n,"color",t=>ez(kn(t),e))}function tz(n){return Es(n,"Icon",(e,t)=>(k1(e,"href",r=>{t.icon=r}),t))}function gre(n){return Es(n,"IconStyle",e=>Object.assign(tI(e,"icon"),Wx(e,"scale","icon-scale"),Wx(e,"heading","icon-heading"),Es(e,"hotSpot",t=>{let r=Number.parseFloat(t.getAttribute("x")||""),i=Number.parseFloat(t.getAttribute("y")||""),s=t.getAttribute("xunits")||"",o=t.getAttribute("yunits")||"";return!Number.isNaN(r)&&!Number.isNaN(i)?{"icon-offset":[r,i],"icon-offset-units":[s,o]}:{}}),tz(e)))}function yre(n){return Es(n,"LabelStyle",e=>Object.assign(tI(e,"label"),Wx(e,"scale","label-scale")))}function xre(n){return Es(n,"LineStyle",e=>Object.assign(tI(e,"stroke"),Wx(e,"width","stroke-width")))}function bre(n){return Es(n,"PolyStyle",(e,t)=>Object.assign(t,Es(e,"color",r=>ez(kn(r),"fill")),k1(e,"fill",r=>{if(r==="0")return{"fill-opacity":0}}),k1(e,"outline",r=>{if(r==="0")return{"stroke-opacity":0}})))}function rI(n){return Object.assign({},bre(n),xre(n),yre(n),gre(n))}var _re=/\s*/g,vre=/^\s*|\s*$/g,wre=/\s+/;function rz(n){return n.replace(_re,"").split(",").map(Number.parseFloat).filter(e=>!Number.isNaN(e)).slice(0,3)}function Qk(n){return n.replace(vre,"").split(wre).map(rz).filter(e=>e.length>=2)}function Sre(n){let e=jn(n,"coord");e.length===0&&(e=cre(n,"coord","*"));let t=e.map(r=>kn(r).split(" ").map(Number.parseFloat));return t.length===0?null:{geometry:t.length>2?{type:"LineString",coordinates:t}:{type:"Point",coordinates:t[0]},times:jn(n,"when").map(r=>kn(r))}}function nz(n){if(n.length===0)return n;let e=n[0],t=n[n.length-1],r=!0;for(let i=0;i<Math.max(e.length,t.length);i++)if(e[i]!==t[i]){r=!1;break}return r?n:n.concat([n[0]])}function zx(n){return kn(ai(n,"coordinates"))}function iz(n){let e=[],t=[];for(let r=0;r<n.childNodes.length;r++){let i=n.childNodes.item(r);if(Jk(i))switch(i.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{let s=iz(i);e=e.concat(s.geometries),t=t.concat(s.coordTimes);break}case"Point":{let s=rz(zx(i));s.length>=2&&e.push({type:"Point",coordinates:s});break}case"LinearRing":case"LineString":{let s=Qk(zx(i));s.length>=2&&e.push({type:"LineString",coordinates:s});break}case"Polygon":{let s=[];for(let o of jn(i,"LinearRing")){let a=nz(Qk(zx(o)));a.length>=4&&s.push(a)}s.length&&e.push({type:"Polygon",coordinates:s});break}case"Track":case"gx:Track":{let s=Sre(i);if(!s)break;let{times:o,geometry:a}=s;e.push(a),o.length&&t.push(o);break}}}return{geometries:e,coordTimes:t}}var Yd=n=>Number(n),Zk={string:n=>n,int:Yd,uint:Yd,short:Yd,ushort:Yd,float:Yd,double:Yd,bool:n=>!!n};function sz(n,e){return Es(n,"ExtendedData",(t,r)=>{for(let i of jn(t,"Data"))r[i.getAttribute("name")||""]=kn(ai(i,"value"));for(let i of jn(t,"SimpleData")){let s=i.getAttribute("name")||"",o=e[s]||Zk.string;r[s]=o(kn(i))}return r})}function oz(n){let e=ai(n,"description");for(let t of Array.from(e?.childNodes||[]))if(t.nodeType===4)return{description:{"@type":"html",value:kn(t)}};return{}}function az(n){return Es(n,"TimeSpan",e=>({timespan:{begin:kn(ai(e,"begin")),end:kn(ai(e,"end"))}}))}function lz(n){return Es(n,"TimeStamp",e=>({timestamp:kn(ai(e,"when"))}))}function cz(n,e){return k1(n,"styleUrl",t=>(t=Hx(t),e[t]?Object.assign({styleUrl:t},e[t]):{styleUrl:t}))}function Cre(n){return ai(n,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[nz(Qk(zx(n)))]}}:Tre(n)}var Are=Math.PI/180;function Ere(n,e,t){let r=[(n[0]+n[2])/2,(n[1]+n[3])/2];return[e[0].map(i=>{let s=i[1]-r[1],o=i[0]-r[0],a=Math.sqrt(s**2+o**2),l=Math.atan2(s,o)+t*Are;return[r[0]+Math.cos(l)*a,r[1]+Math.sin(l)*a]})]}function Tre(n){let e=ai(n,"LatLonBox");if(e){let t=T1(e,"north"),r=T1(e,"west"),i=T1(e,"east"),s=T1(e,"south"),o=T1(e,"rotation");if(typeof t=="number"&&typeof s=="number"&&typeof r=="number"&&typeof i=="number"){let a=[r,s,i,t],l=[[[r,t],[i,t],[i,s],[r,s],[r,t]]];return typeof o=="number"&&(l=Ere(a,l,o)),{bbox:a,geometry:{type:"Polygon",coordinates:l}}}}return null}function kre(n,e,t,r){let i=Cre(n),s=i?.geometry||null;if(!s&&r.skipNullGeometry)return null;let o={type:"Feature",geometry:s,properties:Object.assign({"@geometry-type":"groundoverlay"},bp(n,["name","address","visibility","open","phoneNumber","description"]),oz(n),cz(n,e),rI(n),tz(n),sz(n,t),az(n),lz(n))};i?.bbox&&(o.bbox=i.bbox),o.properties?.visibility!==void 0&&(o.properties.visibility=o.properties.visibility!=="0");let a=n.getAttribute("id");return a!==null&&a!==""&&(o.id=a),o}function Ire(n){return n.length===0?null:n.length===1?n[0]:{type:"GeometryCollection",geometries:n}}function Pre(n,e,t,r){let{coordTimes:i,geometries:s}=iz(n),o=Ire(s);if(!o&&r.skipNullGeometry)return null;let a={type:"Feature",geometry:o,properties:Object.assign(bp(n,["name","address","visibility","open","phoneNumber","description"]),oz(n),cz(n,e),rI(n),sz(n,t),az(n),lz(n),i.length?{coordinateProperties:{times:i.length===1?i[0]:i}}:{})};a.properties?.visibility!==void 0&&(a.properties.visibility=a.properties.visibility!=="0");let l=n.getAttribute("id");return l!==null&&l!==""&&(a.id=l),a}function Dre(n){let e=n.getAttribute("id"),t=n.parentNode;return!e&&Jk(t)&&t.localName==="CascadingStyle"&&(e=t.getAttribute("kml:id")||t.getAttribute("id")),Hx(e||"")}function Mre(n){let e={};for(let t of jn(n,"Style"))e[Dre(t)]=rI(t);for(let t of jn(n,"StyleMap")){let r=Hx(t.getAttribute("id")||"");k1(t,"styleUrl",i=>{i=Hx(i),e[i]&&(e[r]=e[i])})}return e}function Rre(n){let e={};for(let t of jn(n,"SimpleField"))e[t.getAttribute("name")||""]=Zk[t.getAttribute("type")||""]||Zk.string;return e}function*Fre(n,e={skipNullGeometry:!1}){let t=Mre(n),r=Rre(n);for(let i of jn(n,"Placemark")){let s=Pre(i,t,r,e);s&&(yield s)}for(let i of jn(n,"GroundOverlay")){let s=kre(i,t,r,e);s&&(yield s)}}function uz(n,e={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(Fre(n,e))}}var Sz=Ot(_p(),1),Cz=Ot(xz(),1);var wz=Ot(vz(),1),Xx=class{constructor(){this.type=null,this.dirty=!0,this.reset()}destroy(){this.reset()}reset(){this.origCoords=null,this.origExtent=null,this.origHull=null,this.origCentroid=null,this.origPoi=null,this.origSsr=null,this.coords=null,this.flatCoords=null,this.extent=null,this.hull=null,this.centroid=null,this.poi=null,this.ssr=null,this.outer=null,this.flatOuter=null,this.holes=null,this.flatHoles=null,this.width=0,this.height=0,this.lod=0}update(e){if(!this.dirty||!this.origCoords||!this.origExtent)return;if(this.dirty=!1,this.coords=null,this.flatCoords=null,this.extent=null,this.outer=null,this.flatOuter=null,this.holes=null,this.flatHoles=null,this.hull=null,this.centroid=null,this.poi=null,this.ssr=null,this.type==="point"){this.coords=e.project(this.origCoords),this.extent=new le(this.coords),this.centroid=this.coords,this.width=0,this.height=0,this.lod=2;return}this.extent=new le,this.extent.min=e.project([this.origExtent.min[0],this.origExtent.max[1]]),this.extent.max=e.project([this.origExtent.max[0],this.origExtent.min[1]]);let[t,r]=this.extent.min,[i,s]=this.extent.max;if(this.width=i-t,this.height=s-r,this.width<4&&this.height<4){this.lod=0;return}let o=this.type==="line"?[this.origCoords]:this.origCoords,a=new Array(o.length),l=new Array(o.length);for(let c=0;c<o.length;++c){let u=o[c];a[c]=new Array(u.length),l[c]=new Array(u.length*2);for(let d=0;d<u.length;++d){let f=e.project(u[d]);a[c][d]=f,l[c][d*2]=f[0],l[c][d*2+1]=f[1]}}if(this.type==="line"?(this.coords=a[0],this.flatCoords=l[0],this.outer=a[0],this.flatOuter=l[0],this.holes=null,this.flatHoles=null):(this.coords=a,this.flatCoords=l,this.outer=a[0],this.flatOuter=l[0],this.holes=a.slice(1),this.flatHoles=l.slice(1)),this.outer.length!==0)if(this.outer.length===1)this.centroid=this.outer[0],this.origCentroid=e.unproject(this.centroid),this.poi=this.centroid,this.origPoi=this.origCentroid;else if(this.outer.length===2)this.centroid=at(this.outer[0],this.outer[1],.5),this.origCentroid=e.unproject(this.centroid),this.poi=this.centroid,this.origPoi=this.origCentroid;else{if(this.origHull){this.hull=new Array(this.origHull.length);for(let c=0;c<this.origHull.length;++c)this.hull[c]=e.project(this.origHull[c])}else if(this.hull=pi(this.outer),this.hull){this.origHull=new Array(this.hull.length);for(let c=0;c<this.origHull.length;++c)this.origHull[c]=e.unproject(this.hull[c])}if(this.origCentroid?this.centroid=e.project(this.origCentroid):this.hull&&(this.hull.length===2?this.centroid=at(this.hull[0],this.hull[1],.5):this.centroid=hi(this.hull),this.origCentroid=e.unproject(this.centroid)),this.origPoi?this.poi=e.project(this.origPoi):(this.poi=(0,wz.default)(this.coords),this.origPoi=e.unproject(this.poi)),this.origSsr){this.ssr={angle:this.origSsr.angle,poly:new Array(this.origSsr.poly.length)};for(let c=0;c<this.origSsr.poly.length;++c)this.ssr.poly[c]=e.project(this.origSsr.poly[c])}else if(this.hull&&(this.ssr=d2(this.hull),this.ssr)){this.origSsr={angle:this.ssr.angle,poly:new Array(this.ssr.poly.length)};for(let c=0;c<this.ssr.poly.length;++c)this.origSsr.poly[c]=e.unproject(this.ssr.poly[c])}}this.lod=2}setCoords(e){let t=this._inferType(e);if(t){if(this.reset(),this.type=t,this.origCoords=e,t==="point")this.origExtent=new le(e),this.origCentroid=e;else{this.origExtent=new le;let r=this.type==="line"?this.origCoords:this.origCoords[0];for(let i of r)this.origExtent.extendSelf(i)}this.dirty=!0}}_inferType(e){let t=Array.isArray(e)&&e[0];if(typeof t=="number")return"point";let r=Array.isArray(t)&&t[0];return typeof r=="number"?"line":typeof(Array.isArray(r)&&r[0])=="number"?"polygon":null}};var cc=class{constructor(e,t){this.type="unknown",this.layer=e,this.scene=e.scene,this.gfx=e.gfx,this.context=e.context,this.featureID=t;let r=new we;this.container=r,r.__feature__=this,r.label=t,r.sortableChildren=!1,r.visible=!0,this._allowInteraction=!0,r.eventMode="static",this.v=-1,this.lod=2,this.halo=null,this.geometry=new Xx,this._style=null,this._styleDirty=!0,this._label=null,this._labelDirty=!0,this._dataID=null,this._data=null,this._classes=new Set,this.sceneBounds=new $e,this.layer.addFeature(this),this.scene.addFeature(this)}destroy(){this.layer.removeFeature(this),this.scene.removeFeature(this),this.container.filters=null,this.container.__feature__=null,this.container.destroy({children:!0}),this.container=null,this.layer=null,this.scene=null,this.gfx=null,this.context=null,this.halo&&(this.halo.destroy(),this.halo=null),this.geometry.destroy(),this.geometry=null,this._style=null,this._label=null,this._dataID=null,this._data=null,this.sceneBounds=null}update(e,t){this.dirty&&(this.geometry.update(e,t),this._styleDirty=!1)}updateHalo(){}get id(){return this.featureID}get parentContainer(){return this.container.parent}set parentContainer(e){let t=this.container.parent;e&&e!==t?e.addChild(this.container):!e&&t&&t.removeChild(this.container)}get visible(){return this.container.visible}set visible(e){e!==this.container.visible&&(this.container.visible=e,this.updateHalo(),this._labelDirty=!0)}get dirty(){return this.geometry.dirty||this._styleDirty}set dirty(e){this.geometry.dirty=e,this._styleDirty=e,this._labelDirty=e}get allowInteraction(){return this._allowInteraction}set allowInteraction(e){e!==this._allowInteraction&&(this._allowInteraction=e,this.container&&(this.container.eventMode=this._allowInteraction?"static":"none"))}get style(){return this._style}set style(e){this._style=e,this._styleDirty=!0}get label(){return this._label}set label(e){e!==this._label&&(this._label=e,this._labelDirty=!0)}get data(){return this._data}get dataID(){return this._dataID}setClass(e){this._classes.has(e)||(this._classes.add(e),this._styleDirty=!0,this._labelDirty=!0)}unsetClass(e){this._classes.has(e)&&(this._classes.delete(e),this._styleDirty=!0,this._labelDirty=!0)}hasClass(e){return this._classes.has(e)}setData(e,t){this._dataID=e,this._data=t,this.layer.bindData(this.id,e),this.dirty=!0}addChildData(e,t){this.layer.addChildData(e,t),this.dirty=!0}clearChildData(e){this.layer.clearChildData(e),this.dirty=!0}};var zre={dash:[10,5],width:1,color:16777215,alpha:1,scale:1,useTexture:!0,alignment:.5},sI={},Ts=class{constructor(e,t={}){t={...zre,...t},this.options=t,this.lineLength=null,this.cursor=new Ve,this.start=null,this.graphics=e,this.dash=t.dash,this.dashSize=this.dash.reduce((r,i)=>r+i),this.scale=t.scale,this.useTexture=t.useTexture,this.useTexture?(this.activeTexture=this._getTexture(t,this.dashSize),this.strokeStyle={alignment:t.alignment,alpha:t.alpha,color:t.color,matrix:new ue,texture:this.activeTexture,width:t.width*t.scale}):(this.activeTexture=null,this.strokeStyle={alignment:t.alignment,alpha:t.alpha,cap:t.cap,color:t.color,join:t.join,width:t.width*t.scale})}moveTo(e,t){return this.lineLength=0,this.cursor.set(e,t),this.start=new Ve(e,t),this.graphics.moveTo(this.cursor.x,this.cursor.y),this}lineTo(e,t,r){this.lineLength===null&&this.moveTo(0,0);let[i,s]=[this.cursor.x,this.cursor.y],o=Ne([i,s],[e,t]);if(o<1)return this.lineLength+=o,this;let a=Math.atan2(t-s,e-i),l=Math.cos(a),c=Math.sin(a),u=r&&e===this.start.x&&t===this.start.y;if(this.useTexture){if(u&&this.dash.length%2===0){let h=Math.min(this.dash[this.dash.length-1],o);this.graphics.lineTo(e-l*h,t-c*h),this.graphics.closePath()}else this.graphics.lineTo(e,t);let d=this.strokeStyle.matrix;d.identity(),a&&d.rotate(a),this.scale!==1&&d.scale(this.scale,this.scale);let f=-this.lineLength;d.translate(this.cursor.x+f*l,this.cursor.y+f*c),this.lineLength+=o,this.cursor.set(e,t)}else{let d=this.lineLength%(this.dashSize*this.scale),f=0,h=0,p=0;for(let g=0;g<this.dash.length;g++){let y=this.dash[g]*this.scale;if(d<p+y){f=g,h=d-p;break}else p+=y}let m=o;for(;m>1;){let g=this.dash[f]*this.scale-h,y=m>g?g:m;if(u&&Ne([i+l*y,s+c*y],[this.start.x,this.start.y])<=y){if(f%2===0){let b=Ne([i,s],[this.start.x,this.start.y])-this.dash[this.dash.length-1]*this.scale;i+=l*b,s+=c*b,this.graphics.lineTo(i,s),this.lineLength+=b,this.cursor.set(i,s)}break}i+=l*y,s+=c*y,f%2?this.graphics.moveTo(i,s):this.graphics.lineTo(i,s),this.lineLength+=y,this.cursor.set(i,s),m-=y,f++,f=f===this.dash.length?0:f,h=0}}return this.graphics.stroke(this.strokeStyle),this}closePath(){this.lineTo(this.start.x,this.start.y,!0)}circle(e,t,r,i=80,s=null){let o=Math.PI*2/i,a=0,l=new Ve(e+Math.cos(a)*r,t+Math.sin(a)*r);s?(s.apply(l,l),this.moveTo(l[0],l[1])):this.moveTo(l.x,l.y),a+=o;for(let c=1;c<i+1;c++){let u=c===i?[l.x,l.y]:[e+Math.cos(a)*r,t+Math.sin(a)*r];this.lineTo(u[0],u[1]),a+=o}return this}ellipse(e,t,r,i,s=80,o=null){let a=Math.PI*2/s,l,c=new Ve;for(let u=0;u<Math.PI*2;u+=a){let d=e-r*Math.sin(u),f=t-i*Math.cos(u);o&&(c.set(d,f),o.apply(c,c),d=c.x,f=c.y),u===0?(this.moveTo(d,f),l={x:d,y:f}):this.lineTo(d,f)}return this.lineTo(l.x,l.y,!0),this}poly(e,t=null){let r=new Ve;if(typeof e[0]=="number")if(t){r.set(e[0],e[1]),t.apply(r,r),this.moveTo(r.x,r.y);for(let i=2;i<e.length;i+=2)r.set(e[i],e[i+1]),t.apply(r,r),this.lineTo(r.x,r.y,i===e.length-2)}else{this.moveTo(e[0],e[1]);for(let i=2;i<e.length;i+=2)this.lineTo(e[i],e[i+1],i===e.length-2)}else if(t){let i=e[0];r.copyFrom(i),t.apply(r,r),this.moveTo(r.x,r.y);for(let s=1;s<e.length;s++){let o=e[s];r.copyFrom(o),t.apply(r,r),this.lineTo(r.x,r.y,s===e.length-1)}}else{let i=e[0];this.moveTo(i.x,i.y);for(let s=1;s<e.length;s++){let o=e[s];this.lineTo(o.x,o.y,s===e.length-1)}}return this}rect(e,t,r,i,s=null){if(s){let o=new Ve;o.set(e,t),s.apply(o,o),this.moveTo(o.x,o.y),o.set(e+r,t),s.apply(o,o),this.lineTo(o.x,o.y),o.set(e+r,t+i),s.apply(o,o),this.lineTo(o.x,o.y),o.set(e,t+i),s.apply(o,o),this.lineTo(o.x,o.y),o.set(e,t),s.apply(o,o),this.lineTo(o.x,o.y,!0)}else this.moveTo(e,t).lineTo(e+r,t).lineTo(e+r,t+i).lineTo(e,t+i).lineTo(e,t,!0);return this}_getTexture(e,t){let r=e.dash.toString();if(sI[r])return sI[r];let i=document.createElement("canvas"),s=t,o=Math.ceil(e.width);i.width=wi(s),i.height=wi(o);let a=i.getContext("2d");if(!a)return console.warn("Did not get context from canvas"),null;let l=i.width/s,c=i.height/o;a.scale(l,c),a.strokeStyle="white",a.globalAlpha=e.alpha,a.lineWidth=e.width;let u=0,d=e.width/2;a.moveTo(u,d);for(let h=0;h<e.dash.length;h+=2)u+=e.dash[h],a.lineTo(u,d),e.dash.length!==h+1&&(u+=e.dash[h+1],a.moveTo(u,d));a.stroke();let f=sI[r]=re.from(i);return f.source.scaleMode="nearest",f}};function Kd(n,e={}){let r=[n[0],n[1]],i=[n[n.length-2],n[n.length-1]],s=He(r,i,1e-4),o=new Ai(n);e.native=!1,o.closeStroke=!1;let a={closePointEps:1e-4,indices:[],verts:[],uvs:[]};l0(n,e,!1,s,a.verts,a.indices);let l=a.verts,c=a.indices,u=new Map,d=[],f=[],h,p,m=0,g=0,y,x,b,_,S,C;for(let E=0;E<c.length;E+=3){let I=c[E],M=c[E+1],T=c[E+2],R=[l[I*2],l[I*2+1]],P=[l[M*2],l[M*2+1]],D=[l[T*2],l[T*2+1]];if(E===0)u.set(I,!0),u.set(M,!1),u.set(T,!0),d.push(R),f.push(P),d.push(D),p=P,h=D,m=Ne(R,D);else{let N=u.get(I),F=u.get(M),B=u.get(T);N===void 0&&He(R,y,1e-4)&&(N=u.get(_),u.set(I,N)),F===void 0&&He(P,x,1e-4)&&(F=u.get(S),u.set(M,F)),B===void 0&&He(D,b,1e-4)&&(B=u.get(C),u.set(T,B));let O,G,U;N===void 0&&(O=I,G=R,U=!B),F===void 0&&(O=M,G=P,U=!N),B===void 0&&(O=T,G=D,U=!F),O!==void 0&&(u.set(O,U),U===!0?(d.push(G),m+=Ne(h,G),h=G):(f.push(G),g+=Ne(p,G),p=G))}y=R,x=P,b=D,_=I,S=M,C=T}let k={},v=d.length+f.length+1,w=new Array(v*2),A=0;for(let E=0;E<d.length;++A,++E)w[A*2]=d[E][0],w[A*2+1]=d[E][1];f.reverse();for(let E=0;E<f.length;++A,++E)w[A*2]=f[E][0],w[A*2+1]=f[E][1];if(w[w.length-2]=w[0],w[w.length-1]=w[1],k.perimeter=w,s){let E=new Array((d.length+1)*2);for(let M=0;M<d.length;++M)E[M*2]=d[M][0],E[M*2+1]=d[M][1];E[E.length-2]=d[0][0],E[E.length-1]=d[0][1];let I=new Array((f.length+1)*2);for(let M=0;M<f.length;++M)I[M*2]=f[M][0],I[M*2+1]=f[M][1];I[I.length-2]=f[0][0],I[I.length-1]=f[0][1],m>g?(k.outer=E,k.inner=I):(k.outer=I,k.inner=E)}return k}function wp(n,e,t=!1,r=!1){let s=e,o,a=[];for(let l=0;l<n.length;l++){let c=n[l];if(o){let u=Ne(o,c)-s;if(u>=0){let d=sr(o,c),f=e*Math.cos(d),h=e*Math.sin(d),p=0,m=0;t&&(p=7*Math.cos(d+Math.PI/2),m=7*Math.sin(d+Math.PI/2));let g=[o[0]+s*Math.cos(d)+p,o[1]+s*Math.sin(d)+m],y=[o,g];for(r&&u>=e*100&&(e=Math.floor(u/100)),u-=e;u>=0;u-=e)g=bt(g,[f,h]),y.push(g);y.push(c),a.push({coords:y.slice(1,-1),angle:d+(t?Math.PI/2:0)})}s=-u}o=c}return a}var Hre=35,Wre=30,Xn=class extends cc{constructor(e,t){super(e,t),this.type="line",this._bufferdata=null;let r=new ze;r.label="casing",r.eventMode="none",r.sortableChildren=!1,this.casing=r;let i=new ze;i.label="stroke",i.eventMode="none",i.sortableChildren=!1,this.stroke=i,this.container.addChild(r,i)}destroy(){this.casing&&(this.casing.destroy(),this.casing=null),this.stroke&&(this.stroke.destroy(),this.stroke=null),this._bufferdata=null,super.destroy()}update(e,t){if(!this.dirty)return;let r=this.context.systems.map.wireframeMode,i=this.gfx.textures,s=this.container,o=this._style;if(this.geometry.dirty){this.geometry.update(e,t);let[l,c]=this.geometry.extent.min,[u,d]=this.geometry.extent.max,[f,h]=[u-l,d-c];this.sceneBounds.x=l,this.sceneBounds.y=c,this.sceneBounds.width=f,this.sceneBounds.height=h}if(this._styleDirty){let{width:l,height:c}=this.sceneBounds,u=!0;l<4&&c<4?(this.lod=0,this.visible=!1,this.stroke.renderable=!1,this.casing.renderable=!1,u=!1):(this.visible=!0,this.stroke.renderable=!0,t<16?(this.lod=1,this.casing.renderable=!1,u=!1):(this.lod=2,this.casing.renderable=!0,u=!0));let d=s.getChildByLabel("lineMarkers");if(u&&(o.lineMarkerTexture||o.lineMarkerName||o.sidedMarkerTexture||o.sidedMarkerName)){d||(d=new we,d.label="lineMarkers",d.eventMode="none",d.sortableChildren=!1,d.roundPixels=!1,s.addChild(d));let f=o.lineMarkerTexture||i.get(o.lineMarkerName)||re.WHITE,h=o.sidedMarkerTexture||i.get(o.sidedMarkerName)||re.WHITE,p=o.sidedMarkerName==="sided",m=o.lineMarkerName==="oneway";d.removeChildren(),m&&wp(this.geometry.coords,Hre,!1,!0).forEach(y=>{y.coords.forEach(([x,b])=>{let _=new At(f);_.eventMode="none",_.sortableChildren=!1,_.anchor.set(.5,.5),_.position.set(x,b),_.rotation=y.angle,_.tint=o.lineMarkerTint,d.addChild(_)})}),p&&wp(this.geometry.coords,Wre,!0,!0).forEach(y=>{y.coords.forEach(([x,b])=>{let _=new At(h);_.eventMode="none",_.sortableChildren=!1,_.anchor.set(.5,.5),_.position.set(x,b),_.rotation=y.angle,_.tint=o.stroke.color,d.addChild(_)})})}else d&&(s.removeChild(d),d.destroy({children:!0}));if(this.visible){let h=o.casing.width;t<16?h-=4:t<17&&(h-=2),h<3&&(h=3),r&&(h=1);let p={alpha:1,alignment:.5,color:0,width:h+10,cap:"butt",join:"bevel"};this._bufferdata=Kd(this.geometry.flatCoords,p),this.container.hitArea=new Ai(this._bufferdata.perimeter)}else this._bufferdata=null,this.container.hitArea=null;this._styleDirty=!1}this.casing.renderable&&a("casing",this.casing,this.geometry.coords,o,r),this.stroke.renderable&&a("stroke",this.stroke,this.geometry.coords,o,r),this.updateHalo();function a(l,c,u,d,f){let h=l==="casing"?3:2,p=d[l].width;t<16?p-=4:t<17&&(p-=2),p<h&&(p=h),f&&(p=1);let m=c.clear();if(d[l].alpha===0)return;let g={color:d[l].color,width:p,alpha:d[l].alpha||1,join:d[l].join,cap:d[l].cap};d[l].dash?(g.dash=d[l].dash,m=new Ts(m,g),y(u,m)):(y(u,m),m=m.stroke(g));function y(x,b){x.forEach(([_,S],C)=>{C===0?b.moveTo(_,S):b.lineTo(_,S)})}}}updateHalo(){let e=this.visible&&this._classes.has("hover"),t=this.visible&&this._classes.has("select"),r=this.visible&&this._classes.has("highlight");if(e){if(!this.container.filters){let i=new Yo({distance:15,outerStrength:3,color:16776960});i.resolution=2,this.container.filters=[i]}}else if(r){if(!this.container.filters){let i=new Yo({distance:15,outerStrength:3,color:7377663});i.resolution=2,this.container.filters=[i]}}else this.container.filters&&(this.container.filters=null);if(t){this.halo||(this.halo=new ze,this.halo.label=`${this.id}-halo`,this.scene.layers.get("map-ui").halo.addChild(this.halo));let i={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let s=new Ts(this.halo,i);this._bufferdata&&(this._bufferdata.outer&&this._bufferdata.inner?(s.poly(this._bufferdata.outer),s.poly(this._bufferdata.inner)):s.poly(this._bufferdata.perimeter))}else this.halo&&(this.halo.destroy(),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},Vre,e),this._styleDirty=!0}},Vre={lineMarkerName:"",lineMarkerTint:0,labelTint:15658734,fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:"round",join:"round"},stroke:{width:3,color:13421772,alpha:1,cap:"round",join:"round"}};var Lt=class extends cc{constructor(e,t){super(e,t),this.type="point",this._viewfieldCount=0,this._viewfieldName=null,this._isCircular=!1;let r=new At;r.label="marker",r.eventMode="none",r.sortableChildren=!1,r.visible=!0,this.marker=r;let i=new At;i.label="icon",i.eventMode="none",i.sortableChildren=!1,i.visible=!1,this.icon=i,this.viewfields=null,this.container.addChild(r,i)}destroy(){this.marker&&(this.marker.destroy(),this.marker=null),this.icon&&(this.icon.destroy(),this.icon=null),this.viewfields&&(this.viewfields.destroy({children:!0}),this.viewfields=null),super.destroy()}update(e,t){if(!this.dirty)return;this.updateGeometry(e,t),this.updateStyle(e,t);let r=this.container.position;this.sceneBounds=this.container.getBounds().clone(),this.sceneBounds.x+=r.x,this.sceneBounds.y+=r.y,this.updateHitArea(),this.updateHalo()}updateGeometry(e,t){if(!this.geometry.dirty)return;this.geometry.update(e,t);let[r,i]=this.geometry.coords;this.container.position.set(r,i);let s=-this.geometry.origCoords[1];this.container.zIndex=this._viewfieldCount>0?s+1e3:s}updateStyle(e,t){if(!this._styleDirty)return;let i=this.context.systems.map.wireframeMode,s=this.gfx.textures,o=this._style,a=["pin","boldPin","osmose"].includes(o.markerName),l=this.marker,c=this.icon,u=this.geometry.origCoords[1],d=e.transform.rotation;if(this.container.rotation=-d,o.markerTexture||o.markerName?(l.alpha=o.markerAlpha??1,l.tint=o.markerTint,l.visible=!0):l.visible=!1,o.iconTexture||o.iconName){c.texture=o.iconTexture||s.get(o.iconName),c.anchor.set(o.anchor?.x||.5,o.anchor?.y||.5);let y=o.iconSize||11;c.width=y,c.height=y,c.alpha=o.iconAlpha??1,c.tint=o.iconTint,c.visible=!0}else c.visible=!1;let f=o.viewfieldAngles||[],h=re.EMPTY;if(f.length>0){if(h=o.viewfieldTexture||s.get(o.viewfieldName)||re.WHITE,this.container.zIndex=-u+1e3,this.viewfields||(this.viewfields=new we,this.viewfields.label="viewfields",this.viewfields.eventMode="none",this.viewfields.sortableChildren=!1,this.viewfields.visible=!0,this.container.addChildAt(this.viewfields,0)),this._viewfieldCount!==f.length||this._viewfieldName!==o.viewfieldName){this.viewfields.removeChildren();for(let _=0;_<f.length;_++){let S=new At(h);S.eventMode="none",S.anchor.set(.5,.5),(this._classes.has("selectphoto")||this._classes.has("highlightphoto"))&&(this.container.zIndex=99e3),this.viewfields.addChild(S)}this._viewfieldCount=f.length}this.viewfields.rotation=d;let y=o.scale||1,x=y*(o.fovWidth||1),b=y*(o.fovLength||1);for(let _=0;_<f.length;_++){let S=this.viewfields.getChildAt(_);S.alpha=o.viewfieldAlpha??1,S.tint=o.viewfieldTint||3355443,S.scale.set(x,b),S.angle=f[_]}}else this.viewfields&&(this.viewfields.destroy({children:!0}),this.viewfields=null,this.container.zIndex=-u,this._viewfieldCount=0);if(t<16)this.lod=0,this.visible=!1;else if(t<17||i){this.lod=1,this.visible=!0,this.container.scale.set(.8,.8),this.viewfields&&(this.viewfields.renderable=!1);let y=a?"largeCircle":o.markerName;this._isCircular=!o.markerTexture&&/(circle|midpoint)$/i.test(y),l.texture=o.markerTexture||s.get(y),l.anchor.set(.5,.5),c.position.set(0,0)}else{this.lod=2,this.visible=!0,this.container.scale.set(1,1),this.viewfields&&(this.viewfields.renderable=!0);let y=a&&f.length?"largeCircle":o.markerName;this._isCircular=!o.markerTexture&&/(circle|midpoint)$/i.test(y),l.texture=o.markerTexture||s.get(y),a&&!this._isCircular?(l.anchor.set(.5,1),c.position.set(0,-14)):(l.anchor.set(.5,.5),c.position.set(0,0))}let p=l.visible&&l.texture===re.EMPTY,m=c.visible&&c.texture===re.EMPTY,g=this.viewfields&&h===re.EMPTY;this._styleDirty=p||m||g}updateHitArea(){if(!this.visible)return;if(this._classes.has("drawing")){this.container.hitArea=null;return}let e=20,t=this.marker.getLocalBounds().rectangle.clone();if(this._isCircular){let r=t.width/2;r<e/2&&(r=e/2),r=r+2;let i=new ka(0,0,r);this.container.hitArea=i}else t.width<e&&t.pad((e-t.width)/2,0),t.height<e&&t.pad(0,(e-t.height)/2),t.pad(4),this.container.hitArea=t}updateHalo(){let e=this.visible&&this._classes.has("hover"),t=this.visible&&this._classes.has("select")&&!this.virtual,r=this.visible&&this._classes.has("highlight");if(e){if(!this.container.filters){let i=new Yo({distance:15,outerStrength:3,color:16776960});i.resolution=2,this.container.filters=[i]}}else if(r){if(!this.container.filters){let i=new Yo({distance:15,outerStrength:3,color:7377663});i.resolution=2,this.container.filters=[i]}}else this.container.filters&&(this.container.filters=null);if(t){this.halo||(this.halo=new ze,this.halo.label=`${this.id}-halo`,this.scene.layers.get("map-ui").halo.addChild(this.halo));let i={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let s=this.container.hitArea,o=new Ts(this.halo,i);s instanceof ka?o.circle(s.x,s.y,s.radius,20):s instanceof $e&&o.rect(s.x,s.y,s.width,s.height),this.halo.position=this.container.position,this.halo.rotation=this.container.rotation}else this.halo&&(this.halo.destroy(),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},jre,e),this._styleDirty=!0}},jre={iconAlpha:1,iconName:"",iconTint:1118481,iconSize:11,labelTint:15658734,markerAlpha:1,markerName:"smallCircle",markerTint:16777215,viewfieldAlpha:.75,viewfieldAngles:[],viewfieldName:"viewfield",viewfieldTint:16777215};var qx=32,Ko=class extends cc{constructor(e,t){super(e,t),this.type="polygon",this._ssrdata=null,this._bufferdata=null,this._vertexCount=0;let r=new At;r.label="lowRes",r.anchor.set(.5,.5),r.interactive=!1,r.eventMode="static",r.visible=!1,this.lowRes=r;let i=new ze;i.label="fill",i.eventMode="static",i.sortableChildren=!1,i.visible=!1,this.fill=i;let s=new Tn({geometry:new en});s.label="mask",s.eventMode="static",s.visible=!1,this.mask=s,this.maskSource=new ze;let o=new we;o.label="strokes",o.eventMode="static",o.sortableChildren=!1,o.visible=!1,this.strokes=o,this.container.addChild(r,i,o,s)}destroy(){this.lowRes&&(this.lowRes.destroy(),this.lowRes=null),this.fill&&(this.fill.destroy(),this.fill=null),this.mask&&(this.mask.destroy(),this.mask=null),this.maskSource&&(this.maskSource.destroy(),this.maskSource=null),this.strokes&&(this.strokes.destroy({children:!0}),this.strokes=null),this.debugSSR&&(this.debugSSR.destroy(),this.debugSSR=null),this._ssrdata=null,this._bufferdata=null,super.destroy()}update(e,t){if(!this.dirty)return;let r=this.context,i=r.systems.storage,s=r.systems.map.wireframeMode,o=r.viewport.transform.rotation;if(this.geometry.dirty&&(this.geometry.update(e,t),this._ssrdata=null,this.geometry.ssr?.poly)){let T=this.geometry.ssr.poly,R=[(T[0][0]+T[1][0])/2,(T[0][1]+T[1][1])/2],P=[(T[2][0]+T[3][0])/2,(T[2][1]+T[3][1])/2],D=[(T[3][0]+T[0][0])/2,(T[3][1]+T[0][1])/2],N=[(T[1][0]+T[2][0])/2,(T[1][1]+T[2][1])/2],F=[R,P],B=[D,N],O=[(R[0]+P[0])/2,(R[1]+P[1])/2],G=.1,U,W,V,j;this.geometry.outer.forEach(Y=>{U||(U=He(Y,T[0],G)),W||(W=He(Y,T[1],G)),V||(V=He(Y,T[2],G)),j||(j=He(Y,T[3],G))});let Z=U||W||V||j;this._ssrdata={ssr:this.geometry.ssr,origSsr:this.geometry.origSsr,origAxis1:F.map(Y=>e.unproject(Y)),origAxis2:B.map(Y=>e.unproject(Y)),origCenter:e.unproject(O),shapeType:Z?"square":"circle"}}let[a,l]=this.geometry.extent.min,[c,u]=this.geometry.extent.max,[d,f]=[c-a,u-l];this.sceneBounds.x=a,this.sceneBounds.y=l,this.sceneBounds.width=d,this.sceneBounds.height=f;let h=this._style,p=this.gfx.textures,m=h.fill.color??11184810,g=h.fill.alpha??.3,y=h.fill.pattern,x=h.stroke.dash||null,b=this.lowRes,_=this.fill,S=this.mask,C=this.maskSource,k=this.strokes,v=y&&p.getPatternTexture(y)||re.WHITE,w=new ue().rotate(-o),A=i.getItem("area-fill")??"partial",E=h.requireFill||A==="full",I=2*qx+5;if((d<I||f<I)&&(E=!0),(d<qx||f<qx)&&(v=re.WHITE),d<4&&f<4)this.lod=0,this.visible=!1,b.visible=!1,_.visible=!1,S.visible=!1,k.visible=!1;else if(this._ssrdata&&d<20&&f<20){this.lod=1,this.visible=!0,b.visible=!0,_.visible=!1,S.visible=!1,k.visible=!1;let T=this._ssrdata,P=`lowres${s?"-unfilled":""}-${T.shapeType}`,[D,N]=e.project(T.origCenter),F=T.ssr.angle,B=T.origAxis1.map(W=>e.project(W)),O=T.origAxis2.map(W=>e.project(W)),G=Ne(B[0],B[1]),U=Ne(O[0],O[1]);b.texture=p.get(P)||re.WHITE,b.position.set(D,N),b.scale.set(G/10,U/10),b.rotation=F,b.tint=m}else this.lod=2,this.visible=!0,b.visible=!1,_.visible=!s,S.visible=!s,k.visible=!0;let M=this.geometry.flatCoords||[];if(this._bufferdata=null,k.removeChildren(),k.visible&&M.length){let T=s?1:h.fill.width||2,R={alpha:1,alignment:.5,color:m,width:T,cap:"butt",join:"miter"},P={alpha:1,alignment:.5,color:0,width:T+10,cap:"butt",join:"bevel"};for(let D=0;D<M.length;D++){let N=M[D],F=new ze;x?(R.dash=x,new Ts(F,R).poly(N)):F.poly(N).stroke(R);let B=Kd(N,P);D===0&&(this._bufferdata=B),F.hitArea=new Ai(B.perimeter),F.label=`stroke${D}`,F.eventMode="static",F.sortableChildren=!1,k.addChild(F)}}if(_.visible&&M.length){let T={color:m,alpha:g,texture:v,matrix:w};_.clear();for(let R=0;R<M.length;R++)_.poly(M[R]),R===0?_.fill(T):_.cut();if(E)S.visible=!1,_.mask=null;else{let R={alpha:1,color:16711680,width:qx,cap:"butt",join:"bevel"};C.clear();for(let B=0;B<M.length;B++)C.poly(M[B]),B===0?(R.alignment=1,C.stroke(R)):(R.alignment=0,C.stroke(R));let P=C.context,D=new su;D.context=P,D.isBatchable=!1,m0(P,D);let N=D.geometryData.vertices.length,F=this._vertexCount;(N>200&&F<=200||N<=200&&F>200)&&(this.container.removeChild(S),S.destroy(),S=new Tn({geometry:new en}),S.label="mask",S.eventMode="static",this.container.addChild(S),this.mask=S),this._vertexCount=N,S.geometry=new en({indices:new Uint32Array(D.geometryData.indices),positions:new Float32Array(D.geometryData.vertices),uvs:new Float32Array(D.geometryData.uvs)}),S.visible=!0,_.mask=S}}this._styleDirty=!1,this.updateHalo()}updateHalo(){let e=this.context.systems.map.wireframeMode,t=this.visible&&this._classes.has("hover"),r=this.visible&&this._classes.has("select"),i=this.visible&&this._classes.has("highlight");if(t){if(!this.container.filters){let s=new Yo({distance:15,outerStrength:3,color:16776960});s.resolution=2,this.container.filters=[s]}}else if(i){if(!this.container.filters){let s=new Yo({distance:15,outerStrength:3,color:7377663});s.resolution=2,this.container.filters=[s]}}else this.container.filters&&(this.container.filters=null);if(r){this.halo||(this.halo=new ze,this.halo.label=`${this.id}-halo`,this.scene.layers.get("map-ui").halo.addChild(this.halo));let s={alpha:.9,dash:[6,3],width:2,color:16776960};this.halo.clear();let o=new Ts(this.halo,s);this._bufferdata&&(o.poly(this._bufferdata.outer),e&&o.poly(this._bufferdata.inner))}else this.halo&&(this.halo.destroy(),this.halo=null)}get style(){return this._style}set style(e){this._style=Object.assign({},Xre,e),this._styleDirty=!0}},Xre={requireFill:!1,lineMarkerName:"",lineMarkerTint:0,labelTint:15658734,fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:"round",join:"round"},stroke:{width:3,color:13421772,alpha:1,cap:"round",join:"round"}};var I1=65535,Yx=class extends St{constructor(e,t){super(e,t),this._clear(),this._fileReader=new FileReader,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this._setFile=this._setFile.bind(this),this.setFileList=this.setFileList.bind(this);function r(i){i.stopPropagation(),i.preventDefault(),i.dataTransfer.dropEffect="copy"}this.context.container().attr("dropzone","copy").on("dragenter.draganddrop",r).on("dragexit.draganddrop",r).on("dragover.draganddrop",r).on("drop.draganddrop",i=>{i.stopPropagation(),i.preventDefault(),this.setFileList(i.dataTransfer.files)}),this.context.systems.urlhash.on("hashchange",this._hashchange),e.on("layerchange",this._updateHash)}render(e,t,r){if(!this.enabled||!this.hasData())return;let i=this.context.services.vectortile,s=[];this._template&&i?(r>=13&&i.loadTiles(this._template),s=i.getData(this._template).map(d=>d.geojson)):s=lm(this._geojson);let o=s.filter(d=>d.geometry.type==="Polygon"||d.geometry.type==="MultiPolygon"),a=s.filter(d=>d.geometry.type==="LineString"||d.geometry.type==="MultiLineString"),l=s.filter(d=>d.geometry.type==="Point"||d.geometry.type==="MultiPoint");this.renderPolygons(e,t,r,o),this.renderLines(e,t,r,a),this.renderPoints(e,t,r,l);let c=this.createGridLines(a),u={stroke:{width:.5,color:65535,alpha:.5,cap:"round"}};this.renderLines(e,t,r,c,u)}createGridLines(e){let t=this.context,r=t.systems.imagery,i=t.systems.rapid,s=r.numGridSplits,o=[];if(i.isTaskRectangular&&s>0){let a=e[0],l=a.geometry.coordinates.map(g=>g[0]),c=a.geometry.coordinates.map(g=>g[1]),u=Math.min(...l),d=Math.min(...c),f=Math.max(...l),h=Math.max(...c),p=(f-u)/s,m=(h-d)/s;for(let g=1;g<s;g++){let y=u+p*g,x=d+m*g;o.push({type:"Feature",geometry:{type:"LineString",coordinates:[[u,x],[f,x]]},id:s+"gridcol"+g}),o.push({type:"Feature",geometry:{type:"LineString",coordinates:[[y,d],[y,h]]},id:s+"gridrow"+g})}}return o}renderPolygons(e,t,r,i){let s=this.context.systems.l10n,o=this.scene.groups.get("basemap"),a={fill:{color:I1,alpha:.3},stroke:{width:2,color:I1,alpha:1,cap:"round"},labelTint:I1};for(let l of i){let c=l.__featurehash__,u=l.v||0,d=l.geometry.type==="Polygon"?[l.geometry.coordinates]:l.geometry.type==="MultiPolygon"?l.geometry.coordinates:[];for(let f=0;f<d.length;++f){let h=d[f],p=`${this.layerID}-${c}-${f}`,m=this.features.get(p);m&&m.type!=="polygon"&&(m.destroy(),m=null),m||(m=new Ko(this,p),m.style=a,m.parentContainer=o),m.v!==u&&(m.v=u,m.geometry.setCoords(h),m.label=s.displayName(l.properties),m.setData(c,l)),this.syncFeatureClasses(m),m.update(t,r),this.retainFeature(m,e)}}}renderLines(e,t,r,i,s){let o=this.context.systems.l10n,a=this.scene.groups.get("basemap"),l=s||{stroke:{width:2,color:I1,alpha:1,cap:"round"},labelTint:I1};for(let c of i){let u=c.__featurehash__,d=c.v||0,f=c.geometry.type==="LineString"?[c.geometry.coordinates]:c.geometry.type==="MultiLineString"?c.geometry.coordinates:[];for(let h=0;h<f.length;++h){let p=f[h],m=`${this.layerID}-${u}-${h}`,g=this.features.get(m);g&&g.type!=="line"&&(g.destroy(),g=null),g||(g=new Xn(this,m),g.style=l,g.parentContainer=a),g.v!==d&&(g.v=d,g.geometry.setCoords(p),g.label=o.displayName(c.properties),g.setData(u,c)),this.syncFeatureClasses(g),g.update(t,r),this.retainFeature(g,e)}}}renderPoints(e,t,r,i){let s=this.context.systems.l10n,o=this.scene.groups.get("points"),a={markerName:"largeCircle",markerTint:I1,iconName:"maki-circle-stroked",labelTint:I1};for(let l of i){let c=l.__featurehash__,u=l.v||0,d=l.geometry.type==="Point"?[l.geometry.coordinates]:l.geometry.type==="MultiPoint"?l.geometry.coordinates:[];for(let f=0;f<d.length;++f){let h=d[f],p=`${this.layerID}-${c}-${f}`,m=this.features.get(p);m&&m.type!=="point"&&(m.destroy(),m=null),m||(m=new Lt(this,p),m.style=a,m.parentContainer=o),m.v!==u&&(m.v=u,m.geometry.setCoords(h),m.label=s.displayName(l.properties),m.setData(c,l)),this.syncFeatureClasses(m),m.update(t,r),this.retainFeature(m,e)}}}hasData(){return!!(this._template||this._geojson)}dataUsed(){return this._dataUsed?[this._dataUsed]:[]}fitZoom(){let e=this._geojsonExtent;e&&this.context.systems.map.trimmedExtent(e)}getFileList(){return this._fileList}setFileList(e){if(this._clear(),this._fileList=e,this.scene.disableLayers(this.layerID),!e||!e.length)return;let t=e[0],r=this._getExtension(t.name);this._fileReader.onload=i=>{this._fileReader.onload=null,this._setFile(i.target.result,r)},this._fileReader.readAsText(t)}setUrl(e){if(this._clear(),this._url=e,this.scene.disableLayers(this.layerID),!e)return;let t=e.toLowerCase().split(/[?#]/)[0],r=t.includes("project")&&t.includes("task")&&t.includes("gpx"),i=r?".gpx":this._getExtension(t);i?fetch(e).then(Ae).then(s=>{this._setFile(s,i),r&&(this._dataUsed=null,this.context.systems.rapid.setTaskExtentByGpxData(s))}).catch(s=>console.error(s)):this._setUrlTemplate(e)}_setUrlTemplate(e){let t=this.context.services.osm;if(t){let r=t.imageryBlocklists??[],i=!1,s=0,o;for(o of r)if(i=o.test(e),s++,i)return;if(!s&&(o=/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/,i=o.test(e),i))return}this._template=e,this._dataUsed="vectortile:"+e.split(/[?#]/)[0],this.scene.enableLayers(this.layerID)}_setFile(e,t){if(!e)return;let r;switch(t){case".gpx":r=Vx(e instanceof Document?e:i(e));break;case".kml":r=uz(e instanceof Document?e:i(e));break;case".geojson":case".json":r=e instanceof Object?e:JSON.parse(e);break}r=r||{},Object.keys(r).length&&(this._dataUsed=`${t} data file`,this._geojson=this._ensureIDs(r),(0,Sz.default)(this._geojson),this._geojsonExtent=cm(r),this.fitZoom(),this.scene.enableLayers(this.layerID));function i(s){return new DOMParser().parseFromString(s,"text/xml")}}_ensureIDs(e){if(!e)return null;for(let t of lm(e))this._ensureFeatureID(t);return e}_ensureFeatureID(e){if(!e)return;let r=this.context.services.vectortile.getNextID();return e.id=r,e.__featurehash__=r,e}_getExtension(e){if(!e)return;let t=/\.(gpx|kml|(geo)?json)$/i,r=e.match(t);return r&&r.length&&r[0]}_hashchange(e,t){let r=e.get("data")||e.get("gpx"),i=t.get("data")||t.get("gpx");if(r!==i&&(this._clear(),typeof r=="string")){let s=this._parseAsWkt(r);s?(this._wkt=r.toUpperCase(),this._setFile(s,".geojson"),this._dataUsed=null):this.setUrl(r)}}_updateHash(){let e=this.context.systems.urlhash;e.setParam("gpx",null),e.setParam("data",null),this.enabled&&(typeof this._wkt=="string"?e.setParam("data",this._wkt):typeof this._url=="string"&&(/gpx/i.test(this._url)?e.setParam("gpx",this._url):e.setParam("data",this._url)))}_parseAsWkt(e){let t=(0,Cz.parse)(e);return!t||t.type!=="Polygon"&&t.type!=="MultiPolygon"?null:{type:"Feature",geometry:{type:t.type,coordinates:t.coordinates},id:"customWktPoly",properties:{}}}_clear(){this._dataUsed=null,this._fileList=null,this._template=null,this._wkt=null,this._url=null,this._geojson=null,this._geojsonExtent=null}};var qre=4,Kx=class extends St{constructor(e,t){super(e,t),this.enabled=!0,this._lastv=null}get enabled(){return!0}set enabled(e){this._enabled=!0}render(e,t){let r=this.context,i=r.systems.locations,s=r.viewport,o=s.transform.zoom;if(this._lastv===s.v)return;this._lastv=s.v;let a=[];if(o>=qre){let u=s.visibleExtent().rectangle();a=i.wpblocks().bbox(u),this.renderEditBlocks(e,t,o,a)}let l=r.container().select(".main-content > .map-footer").selectAll(".api-status.blocks").data(a,u=>u.id);l.exit().remove();let c=l.enter().insert("div",".api-status").attr("class","api-status blocks error");c.append("span").attr("class","explanation-item").text(u=>u.text),c.append("a").attr("target","_blank").attr("href",u=>u.url).text("More Info")}renderEditBlocks(e,t,r,i){let s=this.context.systems.locations,o=this.scene.groups.get("blocks"),a={requireFill:!0,fill:{pattern:"construction",color:1,alpha:.7}};for(let l of i){let c=s.feature(l.locationSetID).geometry;if(!c)continue;let u=c.type==="Polygon"?[c.coordinates]:c.type==="MultiPolygon"?c.coordinates:[];for(let d=0;d<u.length;++d){let f=u[d],h=`${this.layerID}-${l.locationSetID}-${d}`,p=this.features.get(h);p||(p=new Ko(this,h),p.geometry.setCoords(f),p.style=a,p.parentContainer=o,p.container.cursor="not-allowed",p.setData(l.locationSetID,l)),this.syncFeatureClasses(p),p.update(t,r),this.retainFeature(p,e)}}}};var Yre=12,oI=2147583,Qx=16772608,Kre={casing:{alpha:0},stroke:{alpha:.7,width:4,color:oI}},Qre={markerAlpha:.8,markerName:"mediumCircle",markerTint:oI,viewfieldAlpha:.7,viewfieldName:"viewfield",viewfieldTint:oI,scale:1,fovWidth:1,fovLength:1},Zx=class extends St{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.kartaview}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.kartaview;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}filterImages(e){let t=this.context.systems.photos,r=t.fromDate,i=r&&new Date(r).getTime(),s=t.toDate,o=s&&new Date(s).getTime(),a=t.usernames,l=t.showsPhotoType("flat"),c=t.showsPhotoType("panoramic");return e.filter(u=>{if(u.id===t.currPhotoID)return!0;if(!l&&!u.isPano||!c&&u.isPano)return!1;let d=new Date(u.captured_at).getTime();return!(i&&i>d||o&&o<d||a&&!a.includes(u.captured_by))})}filterSequences(e){let t=this.context.systems.photos,r=t.fromDate,i=r&&new Date(r).getTime(),s=t.toDate,o=s&&new Date(s).getTime(),a=t.usernames,l=t.showsPhotoType("flat"),c=t.showsPhotoType("panoramic");return e.filter(u=>{if(!l&&!u.properties.is_pano||!c&&u.properties.is_pano)return!1;let d=new Date(u.properties.captured_at).getTime();return!(i&&i>d||o&&o<d||a&&!a.includes(u.properties.captured_by))})}renderMarkers(e,t,r){let i=this.context.services.kartaview;if(!i?.started)return;let s=this.scene.groups.get("streetview"),o=i.getImages(),a=i.getSequences();a=this.filterSequences(a),o=this.filterImages(o);for(let l of a){let c=`${this.layerID}-sequence-${l.properties.id}`,u=l.properties.v||0,d=this.features.get(c);d||(d=new Xn(this,c),d.style=Kre,d.parentContainer=s,d.container.zIndex=-100),d.v!==u&&(d.v=u,d.geometry.setCoords(l.coordinates),d.setData(l.properties.id,l)),this.syncFeatureClasses(d),d.update(t,r),this.retainFeature(d,e)}for(let l of o){let c=`${this.layerID}-photo-${l.id}`,u=this.features.get(c);if(u||(u=new Lt(this,c),u.geometry.setCoords(l.loc),u.parentContainer=s,u.setData(l.id,l),l.sequenceID&&u.addChildData(l.sequenceID,l.id)),this.syncFeatureClasses(u),u.dirty){let d=Object.assign({},Qre);u.hasClass("selectphoto")?(d.viewfieldAngles=Number.isFinite(l.ca)?[l.ca]:[],d.viewfieldName="viewfield",d.viewfieldAlpha=1,d.viewfieldTint=Qx,d.markerTint=Qx,d.scale=2):(d.viewfieldAngles=Number.isFinite(l.ca)?[l.ca]:[],d.viewfieldName=l.isPano?"pano":"viewfield",u.hasClass("highlightphoto")&&(d.viewfieldAlpha=1,d.viewfieldTint=Qx,d.markerTint=Qx)),u.style=d}u.update(t,r),this.retainFeature(u,e)}}render(e,t,r){let i=this.context.services.kartaview;!this.enabled||!i?.started||r<Yre||(i.loadTiles(),this.renderMarkers(e,t,r))}};var Zre=12,Jx=class extends St{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.keepRight}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.keepRight;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}renderMarkers(e,t,r){let i=this.context.services.keepRight;if(!i?.started)return;let s=this.scene.groups.get("qa"),o=i.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let u={markerName:"keepright",markerTint:i.getColor(a.parentIssueType)};c=new Lt(this,l),c.geometry.setCoords(a.loc),c.style=u,c.parentContainer=s,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(t,r),this.retainFeature(c,e)}}render(e,t,r){let i=this.context.services.keepRight;!this.enabled||!i?.started||r<Zre||(i.loadTiles(),this.renderMarkers(e,t,r))}};var Jre=12,aI={fill:{color:3355443},fontFamily:"Arial, Helvetica, sans-serif",fontSize:12,fontWeight:600,stroke:{color:16777215,width:3,join:"round"}},Az={fill:{color:3355443},fontFamily:"Arial, Helvetica, sans-serif",fontSize:12,fontStyle:"italic",fontWeight:600,stroke:{color:16777215,width:3,join:"round"}},eb=class{constructor(e,t,r){this.id=e,this.type=t,this.options=r,this.dObjID=null}},tb=class extends St{constructor(e,t){super(e,t),this.enabled=!0;let r=this.scene.groups.get("labels");r.eventMode="none";let i=new we;i.label="labelorigin",i.eventMode="none",this.labelOriginContainer=i;let s=new we;s.label="debug",s.eventMode="none",s.roundPixels=!1,s.sortableChildren=!1,this.debugContainer=s;let o=new we;o.label="labels",o.eventMode="none",o.sortableChildren=!0,this.labelContainer=o,r.addChild(i),i.addChild(s,o),this._rbush=new Tt,this._avoidBoxes=new Map,this._labelBoxes=new Map,this._labels=new Map,this._dObjs=new Map,this._textureIDs=new Map,this._tPrev={x:0,y:0,k:256/Math.PI,r:0},this._labelOffset=new Ve,ro.install({name:"label-normal",style:aI,chars:Qi.ASCII,resolution:2}),this._textStyleNormal=new dr(aI),this._textStyleItalic=new dr(Az)}reset(){super.reset(),this.labelContainer.removeChildren(),this.debugContainer.removeChildren();for(let e of this._dObjs.values())e.destroy();for(let e of this._labels.values())e.dObjID=null;this._avoidBoxes.clear(),this._labelBoxes.clear(),this._dObjs.clear(),this._labels.clear(),this._rbush.clear();for(let e of this.scene.features.values())e._labelDirty=!1}resetFeature(e){let t=new Set,r=new Set,i=new Set;(this._avoidBoxes.get(e)||[]).forEach(s=>t.add(s)),(this._labelBoxes.get(e)||[]).forEach(s=>t.add(s));for(let s of t)this._rbush.remove(s),s.labelID&&(r.add(s.labelID),s.labelID=null),s.dObjID&&(i.add(s.dObjID),s.dObjID=null);this._avoidBoxes.delete(e),this._labelBoxes.delete(e);for(let s of r){let o=this._labels.get(s);o?.dObjID&&(i.add(o.dObjID),o.dObjID=null),this._labels.delete(s)}for(let s of i){let o=this._dObjs.get(s);o&&o.destroy(),this._dObjs.delete(s)}}render(e,t,r){if(this.enabled&&r>=Jre){this.labelContainer.visible=!0,this.debugContainer.visible=!0;let i=this._tPrev,s=t.transform.props;if(s.k!==i.k||s.r!==i.r)this.reset();else for(let[m,g]of this.scene.features)g._labelDirty&&(this.resetFeature(m),g._labelDirty=!1);this._tPrev=s;let o=this.gfx.stage.position,a=this.gfx.origin.position,l=t.transform.rotation,c=this._labelOffset;this.gfx.origin.toGlobal({x:0,y:0},c);let u=this.scene.groups.get("labels");u.position.set(-a.x,-a.y),u.rotation=-l,this.labelOriginContainer.position.set(-o.x+c.x,-o.y+c.y),this.gatherAvoids();let f=[],h=[],p=[];for(let[m,g]of this.scene.features)g.label&&g.visible&&!this._labelBoxes.has(m)&&(g.type==="point"?f.push(g):g.type==="line"?h.push(g):g.type==="polygon"&&p.push(g));this.labelPoints(f),this.labelLines(h),this.labelPolygons(p),this.renderObjects()}else this.labelContainer.visible=!1,this.debugContainer.visible=!1}getLabelSprite(e,t="normal"){let r=`${e}-${t}`,i=this.gfx.textures,s=i.getTexture("text",r);if(!s){let a=0,l=e.match(/\p{M}/gu);l&&l.length>0&&(a=10),l&&l.length>20&&(a=50);let c;if(a){let u=Object.assign({},t==="normal"?aI:Az,{padding:a});c=new dr(u)}else c=t==="normal"?this._textStyleNormal:this._textStyleItalic;s=i.textToTexture(r,e,c),this._textureIDs.set(e,r)}let o=new At({texture:s});return o.label=e,o.anchor.set(.5,.5),o}gatherAvoids(){let e=o.bind(this),t=[],r=this.scene.layers.get("map-ui").selected;r&&t.push(r);let i=this.scene.groups.get("points");i&&t.push(i);let s=[];for(let a of t)for(let l of a.children)e(l);s.length&&this._rbush.load(s);function o(a){if(!a.visible||!a.renderable)return;let l=a.label;if(this._avoidBoxes.has(l))return;let c=a.getBounds().rectangle;c.x-=this._labelOffset.x,c.y-=this._labelOffset.y;let u=.01,d=`${l}-avoid`,f={type:"avoid",boxID:d,dObjID:d,featureID:l,minX:c.x+u,minY:c.y+u,maxX:c.x+c.width-u,maxY:c.y+c.height-u};this._avoidBoxes.set(l,[f]),s.push(f);let h=this._rbush.search(f);for(let p of h)if(p.type==="label"){let m=this.scene.features.get(p.featureID);m&&(m._labelDirty=!0)}}}labelPoints(e){e.sort((t,r)=>r.geometry.origCoords[1]-t.geometry.origCoords[1]);for(let t of e){if(this._labelBoxes.has(t.id)||(this._labelBoxes.set(t.id,[]),!t.label))continue;let r;/^[\x20-\x7E]*$/.test(t.label)?(r=new Wo({text:t.label,style:{fontFamily:"label-normal",fontSize:12}}),r.label=t.label,r.anchor.set(.5,.5)):r=this.getLabelSprite(t.label,"normal"),r&&this.placeTextLabel(t,r)}}labelLines(e){function t(r){let i=parseInt(r.container.parent.label,10);return isNaN(i)?999:i}e.sort((r,i)=>t(i)-t(r));for(let r of e){let i=r.id;if(this._labelBoxes.has(i)||(this._labelBoxes.set(i,[]),!r.label)||!r.geometry.coords||!r.container.visible||!r.container.renderable||r.geometry.width<40&&r.geometry.height<40)continue;let s=this.getLabelSprite(r.label,"normal");this.placeRopeLabel(r,s,r.geometry.coords)}}labelPolygons(e){for(let t of e){let r=t.id;if(this._labelBoxes.has(r)||(this._labelBoxes.set(r,[]),!t.label)||!t.geometry.flatOuter||!t.container.visible||!t.container.renderable||t.geometry.width<600&&t.geometry.height<600)continue;let i=this.getLabelSprite(t.label,"italic"),s={alignment:.5,color:0,width:24,alpha:1,join:"bevel",cap:"butt"},o=Kd(t.geometry.flatOuter,s);if(!o.inner)continue;let a=new Array(o.inner.length/2);for(let l=0;l<o.inner.length/2;++l)a[l]=[o.inner[l*2],o.inner[l*2+1]];this.placeRopeLabel(t,i,a)}}placeTextLabel(e,t){if(!e||!e.sceneBounds)return;let r=e.id,i=e.container;if(!i.visible||!i.renderable)return;let s=i.getBounds().clone().pad(1,0);s.x-=this._labelOffset.x,s.y-=this._labelOffset.y;let o=s.x,a=s.y,l=s.width,c=s.height,u=s.x+l,d=s.x+l*.5,f=s.y+c,h=e.type==="point"?s.y+c-14:s.y+c*.5,p=t.getLocalBounds().clone().pad(0,-1),m=5,g=10,y=p.width,x=p.height,b=y*.5,_=x*.5,S={t1:[d-g,a-_],t2:[d-m,a-_],t3:[d,a-_],t4:[d+m,a-_],t5:[d+g,a-_],b1:[d-g,f+_],b2:[d-m,f+_],b3:[d,f+_],b4:[d+m,f+_],b5:[d+g,f+_],r1:[u+b,h-g],r2:[u+b,h-m],r3:[u+b,h],r4:[u+b,h+m],r5:[u+b,h+g],l1:[o-b,h-g],l2:[o-b,h-m],l3:[o-b,h],l4:[o-b,h+m],l5:[o-b,h+g]},C;this.context.systems.l10n.isRTL()?C=["l3","l4","l2","b3","b2","b4","b1","b5","t3","t2","t4","t1","t5","r3","r4","r2","l5","l1","r5","r1"]:C=["r3","r4","r2","b3","b4","b2","b5","b1","l3","l4","l2","t3","t4","t2","t5","t1","r5","r1","l5","l1"];for(let v of C){let[w,A]=S[v],E=.01,I={type:"label",boxID:`${r}-${v}`,featureID:r,labelID:r,minX:w-b+E,minY:A-_+E,maxX:w+b-E,maxY:A+_-E};if(!this._rbush.collides(I)){let M=new eb(r,"text",{str:e.label,labelObj:t,box:I,x:w,y:A,tint:e.style.labelTint||15658734});this._labels.set(r,M),this._labelBoxes.get(r).push(I),this._rbush.insert(I);break}}}placeRopeLabel(e,t,r){if(!e||!t||!r||!e.container.visible||!e.container.renderable)return;let i=e.id,s=t.getLocalBounds(),o=s.width,a=s.height,l=Math.PI/8,c=a+4,u=c*.5,d=Math.ceil(o/c)+1,f=o/((d-1)*c),h=d+15,p=this.gfx.origin,m=this._labelOffset,g=new Ve,y=r.map(([v,w])=>(p.toGlobal({x:v,y:w},g),[g.x-m.x,g.y-m.y])),x=wp(y,c),b=[],_=[],S=[],C=null;function k(){let v=S.length>=d;v&&_.push(S),S.forEach(w=>{w.box.candidate=v,b.push(w.box)}),S=[]}x.forEach((v,w)=>{let A=Qt(v.angle,0,Kt);v.coords.forEach((E,I)=>{let M=`${i}-${w}-${I}`,[T,R]=E,P=.01,D={type:"label",boxID:M,dObjID:M,featureID:i,minX:T-u+P,minY:R-u+P,maxX:T+u-P,maxY:R+u-P},N=!1;if(C!==null){let F=Math.abs(A-C);N=Math.min(Kt-F,F)>l}C=A,N?(k(),D.bendy=!0,b.push(D)):this._rbush.collides(D)?(k(),D.collides=!0,b.push(D)):(S.push({box:D,coord:E,angle:A}),S.length===h&&k())})}),k(),_.forEach((v,w)=>{let A=Math.floor((v.length-d)/2),E=`${i}-rope-${w}`,I=[];for(let D=A;D<A+d;D++){I.push(v[D].coord);let N=v[D].box;N.labelID=E,this._rbush.insert(N),this._labelBoxes.get(i).push(N)}if(!I.length)return;let M=I.reduce((D,N)=>bt(D,N),[0,0]),T=yi(M,1/I.length),R=sr(I.at(0),I.at(-1));R=Qt(R,0,Kt),R>Us&&R<3*Us&&(R-=Math.PI,I.reverse()),I=I.map(D=>Me(D,T)),I=_o(I,-R,[0,0]),I=I.map(([D,N])=>[D*f,N]),I=_o(I,R,[0,0]),I=I.map(D=>bt(D,T));let P=new eb(E,"rope",{str:e.label,coords:I,labelObj:t,tint:e.style.labelTint||15658734});this._labels.set(E,P)})}renderObjects(){let e=this.gfx.pixi.screen,t=this._labelOffset,r={minX:e.x-t.x,minY:e.y-t.y,maxX:e.width-t.x,maxY:e.height-t.y},i=new Set,s=new Set,o=this._rbush.search(r);for(let l of o)l.labelID&&i.add(l.labelID);for(let l of i){let c=this._labels.get(l);if(!c)continue;let u=c.options;if(s.add(u.str),c.dObjID)continue;let d=l;if(c.type==="text"){let f=u.labelObj;f.tint=u.tint||16777215,f.position.set(u.x,u.y),this._dObjs.set(d,f),c.dObjID=d,this.labelContainer.addChild(f)}else if(c.type==="rope"){let f=u.labelObj,h=u.coords.map(([m,g])=>new Ve(m,g)),p=new xx({texture:f.texture,points:h});p.label=l,p.autoUpdate=!1,p.sortableChildren=!1,p.tint=u.tint||16777215,this._dObjs.set(d,p),c.dObjID=d,this.labelContainer.addChild(p)}}let a=this.gfx.textures;for(let[l,c]of this._textureIDs)s.has(l)||(a.free("text",c),this._textureIDs.delete(l))}};var ene=12,tne=379747,rne=16772608,rb=class extends St{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.mapillary;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}filterDetections(e){let t=this.context.systems.photos,r=t.fromDate,i=r&&new Date(r).getTime(),s=t.toDate,o=s&&new Date(s).getTime();return e.filter(a=>{let l=new Date(a.first_seen_at).getTime();return!(i&&i>l||o&&o<l)})}renderMarkers(e,t,r){let i=this.context,s=i.systems.presets,o=i.services.mapillary;if(!o?.started)return;let a=this.scene.groups.get("qa"),l=o.getData("detections");l=this.filterDetections(l);for(let c of l){let u=`${this.layerID}-${c.id}`,d=this.features.get(u);if(d||(d=new Lt(this,u),d.geometry.setCoords(c.loc),d.parentContainer=a,d.setData(c.id,c)),this.syncFeatureClasses(d),d.dirty){let f=d.hasClass("selectdetection"),h=o.getDetectionPresetID(c.value),m={markerName:"xlargeCircle",markerTint:"#000000",iconName:(h&&s.item(h))?.icon||"fas-question",iconSize:16,iconTint:f?rne:tne};d.style=m}d.update(t,r),this.retainFeature(d,e)}}render(e,t,r){let i=this.context.services.mapillary;!this.enabled||!i?.started||r<ene||(i.loadTiles("detections"),this.renderMarkers(e,t,r))}};function Ez(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function lI(n){return function(){return n}}function cI(n){return+n}var Tz=[0,1];function Qd(n){return n}function uI(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:lI(isNaN(e)?NaN:.5)}function nne(n,e){var t;return n>e&&(t=n,n=e,e=t),function(r){return Math.max(n,Math.min(e,r))}}function ine(n,e,t){var r=n[0],i=n[1],s=e[0],o=e[1];return i<r?(r=uI(i,r),s=t(o,s)):(r=uI(r,i),s=t(s,o)),function(a){return s(r(a))}}function sne(n,e,t){var r=Math.min(n.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=uI(n[o],n[o+1]),s[o]=t(e[o],e[o+1]);return function(a){var l=yv(n,a,1,r)-1;return s[l](i[l](a))}}function kz(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function one(){var n=Tz,e=Tz,t=v1,r,i,s,o=Qd,a,l,c;function u(){var f=Math.min(n.length,e.length);return o!==Qd&&(o=nne(n[0],n[f-1])),a=f>2?sne:ine,l=c=null,d}function d(f){return f==null||isNaN(f=+f)?s:(l||(l=a(n.map(r),e,t)))(r(o(f)))}return d.invert=function(f){return o(i((c||(c=a(e,n.map(r),wr)))(f)))},d.domain=function(f){return arguments.length?(n=Array.from(f,cI),u()):n.slice()},d.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},d.rangeRound=function(f){return e=Array.from(f),t=Dk,u()},d.clamp=function(f){return arguments.length?(o=f?!0:Qd,u()):o!==Qd},d.interpolate=function(f){return arguments.length?(t=f,u()):t},d.unknown=function(f){return arguments.length?(s=f,d):s},function(f,h){return r=f,i=h,u()}}function dI(){return one()(Qd,Qd)}function Iz(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function P1(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,r=n.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+n.slice(t+1)]}function Qo(n){return n=P1(Math.abs(n)),n?n[1]:NaN}function Pz(n,e){return function(t,r){for(var i=t.length,s=[],o=0,a=n[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(t.substring(i-=a,i+a)),!((l+=a+1)>r));)a=n[o=(o+1)%n.length];return s.reverse().join(e)}}function Dz(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var ane=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function uc(n){if(!(e=ane.exec(n)))throw new Error("invalid format: "+n);var e;return new nb({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}uc.prototype=nb.prototype;function nb(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}nb.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Mz(n){e:for(var e=n.length,t=1,r=-1,i;t<e;++t)switch(n[t]){case".":r=i=t;break;case"0":r===0&&(r=t),i=t;break;default:if(!+n[t])break e;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(i+1):n}var fI;function Rz(n,e){var t=P1(n,e);if(!t)return n+"";var r=t[0],i=t[1],s=i-(fI=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+P1(n,Math.max(0,e+s-1))[0]}function hI(n,e){var t=P1(n,e);if(!t)return n+"";var r=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}var pI={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:Iz,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>hI(n*100,e),r:hI,s:Rz,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function mI(n){return n}var Fz=Array.prototype.map,Bz=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Nz(n){var e=n.grouping===void 0||n.thousands===void 0?mI:Pz(Fz.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",s=n.numerals===void 0?mI:Dz(Fz.call(n.numerals,String)),o=n.percent===void 0?"%":n.percent+"",a=n.minus===void 0?"\u2212":n.minus+"",l=n.nan===void 0?"NaN":n.nan+"";function c(d){d=uc(d);var f=d.fill,h=d.align,p=d.sign,m=d.symbol,g=d.zero,y=d.width,x=d.comma,b=d.precision,_=d.trim,S=d.type;S==="n"?(x=!0,S="g"):pI[S]||(b===void 0&&(b=12),_=!0,S="g"),(g||f==="0"&&h==="=")&&(g=!0,f="0",h="=");var C=m==="$"?t:m==="#"&&/[boxX]/.test(S)?"0"+S.toLowerCase():"",k=m==="$"?r:/[%p]/.test(S)?o:"",v=pI[S],w=/[defgprs%]/.test(S);b=b===void 0?6:/[gprs]/.test(S)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function A(E){var I=C,M=k,T,R,P;if(S==="c")M=v(E)+M,E="";else{E=+E;var D=E<0||1/E<0;if(E=isNaN(E)?l:v(Math.abs(E),b),_&&(E=Mz(E)),D&&+E==0&&p!=="+"&&(D=!1),I=(D?p==="("?p:a:p==="-"||p==="("?"":p)+I,M=(S==="s"?Bz[8+fI/3]:"")+M+(D&&p==="("?")":""),w){for(T=-1,R=E.length;++T<R;)if(P=E.charCodeAt(T),48>P||P>57){M=(P===46?i+E.slice(T+1):E.slice(T))+M,E=E.slice(0,T);break}}}x&&!g&&(E=e(E,1/0));var N=I.length+E.length+M.length,F=N<y?new Array(y-N+1).join(f):"";switch(x&&g&&(E=e(F+E,F.length?y-M.length:1/0),F=""),h){case"<":E=I+E+M+F;break;case"=":E=I+F+E+M;break;case"^":E=F.slice(0,N=F.length>>1)+I+E+M+F.slice(N);break;default:E=F+I+E+M;break}return s(E)}return A.toString=function(){return d+""},A}function u(d,f){var h=c((d=uc(d),d.type="f",d)),p=Math.max(-8,Math.min(8,Math.floor(Qo(f)/3)))*3,m=Math.pow(10,-p),g=Bz[8+p/3];return function(y){return h(m*y)+g}}return{format:c,formatPrefix:u}}var ib,sb,ob;gI({thousands:",",grouping:[3],currency:["$",""]});function gI(n){return ib=Nz(n),sb=ib.format,ob=ib.formatPrefix,ib}function yI(n){return Math.max(0,-Qo(Math.abs(n)))}function xI(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Qo(e)/3)))*3-Qo(Math.abs(n)))}function bI(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,Qo(e)-Qo(n))+1}function _I(n,e,t,r){var i=bv(n,e,t),s;switch(r=uc(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(n),Math.abs(e));return r.precision==null&&!isNaN(s=xI(i,o))&&(r.precision=s),ob(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=bI(i,Math.max(Math.abs(n),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=yI(i))&&(r.precision=s-(r.type==="%")*2);break}}return sb(r)}function lne(n){var e=n.domain;return n.ticks=function(t){var r=e();return M6(r[0],r[r.length-1],t??10)},n.tickFormat=function(t,r){var i=e();return _I(i[0],i[i.length-1],t??10,r)},n.nice=function(t){t==null&&(t=10);var r=e(),i=0,s=r.length-1,o=r[i],a=r[s],l,c,u=10;for(a<o&&(c=o,o=a,a=c,c=i,i=s,s=c);u-- >0;){if(c=hh(o,a,t),c===l)return r[i]=o,r[s]=a,e(r);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;l=c}return n},n}function Ua(){var n=dI();return n.copy=function(){return kz(n,Ua())},Ez.apply(n,arguments),lne(n)}var cne=12,vI=379747,ab=16772608,une={casing:{alpha:0},stroke:{alpha:.7,width:4,color:vI}},dne={markerAlpha:.8,markerName:"mediumCircle",markerTint:vI,viewfieldAlpha:.7,viewfieldName:"viewfield",viewfieldTint:vI,scale:1,fovWidth:1,fovLength:1},fne=Ua([90,10],[1.3,.7]),hne=Ua([90,10],[.7,1.5]),lb=class extends St{constructor(e,t){if(super(e,t),this._viewerBearing=null,this._viewerFov=55,this._bearingchanged=this._bearingchanged.bind(this),this._fovchanged=this._fovchanged.bind(this),this.supported){let r=this.context.services.mapillary;r.on("bearingChanged",this._bearingchanged),r.on("fovChanged",this._fovchanged),r.on("imageChanged",()=>{this._viewerFov=55})}}_bearingchanged(e){this._viewerBearing=e,this._dirtyCurrentPhoto()}_fovchanged(e){this._viewerFov=e,this._dirtyCurrentPhoto()}_dirtyCurrentPhoto(){let e=this.context,t=e.systems.gfx,i=e.systems.photos.currPhotoID;if(!i)return;let s=this._dataHasFeature.get(i)??new Set;for(let o of s){let a=this.features.get(o);a&&(a._styleDirty=!0)}t.immediateRedraw()}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.mapillary;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}filterImages(e){let t=this.context.systems.photos,r=t.fromDate,i=r&&new Date(r).getTime(),s=t.toDate,o=s&&new Date(s).getTime(),a=t.usernames,l=t.showsPhotoType("flat"),c=t.showsPhotoType("panoramic");return e.filter(u=>{if(u.id===t.currPhotoID)return!0;if(!l&&!u.isPano||!c&&u.isPano)return!1;let d=new Date(u.captured_at).getTime();return!(i&&i>d||o&&o<d||a&&!a.includes(u.captured_by))})}filterSequences(e){let t=this.context.systems.photos,r=t.fromDate,i=r&&new Date(r).getTime(),s=t.toDate,o=s&&new Date(s).getTime(),a=t.usernames,l=t.showsPhotoType("flat"),c=t.showsPhotoType("panoramic");return e.filter(u=>{let d=u.features[0];if(!d||!l&&!d.properties.is_pano||!c&&d.properties.is_pano)return!1;let f=new Date(d.properties.captured_at).getTime();return!(i&&i>f||o&&o<f||a&&!a.includes(d.properties.captured_by))})}renderMarkers(e,t,r){let i=this.context.services.mapillary;if(!i?.started)return;let s=this.scene.groups.get("streetview"),o=i.getSequences(),a=i.getData("images");o=this.filterSequences(o),a=this.filterImages(a);for(let l of o){let c=l.id,u=l.v||0;for(let d=0;d<l.features.length;++d){let f=l.features[d],h=f.geometry.type==="LineString"?[f.geometry.coordinates]:f.geometry.type==="MultiLineString"?f.geometry.coordinates:[];for(let p=0;p<h.length;++p){let m=h[p],g=`${this.layerID}-sequence-${c}-${d}-${p}`,y=this.features.get(g);y||(y=new Xn(this,g),y.style=une,y.parentContainer=s,y.container.zIndex=-100),y.v!==u&&(y.v=u,y.geometry.setCoords(m),y.setData(c,f)),this.syncFeatureClasses(y),y.update(t,r),this.retainFeature(y,e)}}}for(let l of a){let c=`${this.layerID}-photo-${l.id}`,u=this.features.get(c);if(u||(u=new Lt(this,c),u.geometry.setCoords(l.loc),u.parentContainer=s,u.setData(l.id,l),l.sequenceID&&u.addChildData(l.sequenceID,l.id)),this.syncFeatureClasses(u),u.dirty){let d=Object.assign({},dne);u.hasClass("selectphoto")?(d.viewfieldAngles=[this._viewerBearing??l.ca],d.viewfieldName="viewfield",d.viewfieldAlpha=1,d.viewfieldTint=ab,d.markerTint=ab,d.scale=2,d.fovWidth=fne(this._viewerFov??55),d.fovLength=hne(this._viewerFov??55)):(d.viewfieldAngles=Number.isFinite(l.ca)?[l.ca]:[],d.viewfieldName=l.isPano?"pano":"viewfield",u.hasClass("highlightphoto")&&(d.viewfieldAlpha=1,d.viewfieldTint=ab,d.markerTint=ab)),u.style=d}u.update(t,r),this.retainFeature(u,e)}}render(e,t,r){let i=this.context.services.mapillary;!this.enabled||!i?.started||r<cne||(i.loadTiles("images"),this.renderMarkers(e,t,r))}};var pne=12,cb=class extends St{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.mapillary}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.mapillary;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}filterDetections(e){let t=this.context.systems.photos,r=t.fromDate,i=t.toDate;if(r){let s=new Date(r).getTime();e=e.filter(o=>new Date(o.last_seen_at).getTime()>=s)}if(i){let s=new Date(i).getTime();e=e.filter(o=>new Date(o.first_seen_at).getTime()>=s)}return e}renderMarkers(e,t,r){let i=this.context,s=i.services.mapillary;if(!s?.started)return;let o=i.container(),a=this.scene.groups.get("qa"),l=s.getData("signs");l=this.filterDetections(l);for(let c of l){let u=`${this.layerID}-${c.id}`,d=this.features.get(u);if(!d){let f=o.selectAll(`#rapid-defs #${c.value}`).size(),h;f?h={markerName:c.value}:h={markerName:"xlargeSquare",iconName:"fas-question",iconSize:16},d=new Lt(this,u),d.geometry.setCoords(c.loc),d.style=h,d.parentContainer=a,d.setData(c.id,c)}this.syncFeatureClasses(d),d.update(t,r),this.retainFeature(d,e)}}render(e,t,r){let i=this.context.services.mapillary;!this.enabled||!i?.started||r<pne||(i.loadTiles("signs"),this.renderMarkers(e,t,r))}};var mne=12,ub=class extends St{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.maproulette}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.maproulette;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}renderMarkers(e,t,r){let i=this.context.services.maproulette;if(!i?.started)return;let s=this.scene.groups.get("qa"),o=i.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let u={markerName:"osmose",markerTint:65280,iconName:a.icon};c=new Lt(this,l),c.geometry.setCoords(a.loc),c.style=u,c.parentContainer=s,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(t,r),c._isCircular||c.icon.position.set(0,-17),this.retainFeature(c,e)}}render(e,t,r){let i=this.context.services.maproulette;!this.enabled||!i?.started||r<mne||(i.loadTiles(),this.renderMarkers(e,t,r))}};var db=class extends St{constructor(e,t){super(e,t),this.enabled=!0,this._oldk=0,this._geolocationData=null,this._geolocationDirty=!1;let r=new we;r.label="geolocation",r.eventMode="none",r.sortableChildren=!1,r.visible=!1,this.geolocation=r;let i=new we;i.label="tile-debug",i.eventMode="none",i.sortableChildren=!1,i.visible=!1,this.tileDebug=i;let s=new we;s.label="selected",s.sortableChildren=!0,s.visible=!0,this.selected=s;let o=new we;o.label="halo",o.sortableChildren=!0,o.visible=!0,this.halo=o,this._lassoData=null,this._lassoDirty=!1,this._lassoLine=new ze,this._lassoFill=new ze;let a=new we;a.label="lasso",a.eventMode="none",a.sortableChildren=!1,a.visible=!1,this.lasso=a,this.scene.groups.get("ui").addChild(r,i,s,o,a)}reset(){super.reset(),this._lassoData=null,this.lasso.removeChildren()}get enabled(){return!0}set enabled(e){this._enabled=!0}get geolocationData(){return this._geolocationData}set geolocationData(e){this._geolocationData=e,this._geolocationDirty=!0}get lassoData(){return this._lassoData}set lassoData(e){this._lassoData=e,this._lassoDirty=!0}render(e,t){let r=t.transform.scale;r!==this._oldk&&(this._geolocationDirty=!0,this._lassoDirty=!0,this._oldk=r),this._geolocationDirty&&this.renderGeolocation(e,t),this._lassoDirty&&this.renderLasso(e,t)}renderLasso(e,t){if(!this._lassoDirty)return;let r=this.lasso,i=this._lassoLine,s=this._lassoFill,o=this._lassoData;if(Array.isArray(o)&&o.length>1){r.visible=!0,r.children.length||r.addChild(i,s);let a=o.slice(),l=a.at(0),c=a.at(-1);He(l,c)||a.push(l);let u=a.map(h=>t.project(h)).flat(),d={alpha:.7,dash:[6,3],width:1,color:16777215};i.clear(),new Ts(i,d).poly(u);let f={alpha:.5,color:11184810};s.clear().poly(u).fill(f)}else r.visible=!1,r.children.length&&r.removeChildren();this._lassoDirty=!1}renderGeolocation(e,t){if(!this._geolocationDirty)return;let r=this.geolocation;if(r.removeChildren(),this.geolocationData&&this.geolocationData.coords){r.visible=!0;let i=this.geolocationData.coords,s=[i.longitude,i.latitude],[o,a]=t.project(s),l=Gr(i.accuracy,s[1]),c=[i.longitude+l,i.latitude],u=t.project(c)[0],d=Math.max(Math.abs(u-o),15),f=942335,h=new ze().circle(o,a,d).fill({color:f,alpha:.4});if(h.label="aura",r.addChild(h),i.heading!==null&&!isNaN(i.heading)){let m=this.gfx.textures,g=new At(m.get("viewfieldDark"));g.anchor.set(.5,1),g.angle=i.heading,g.label="heading",g.position.set(o,a),r.addChild(g)}let p=new ze().circle(o,a,6.5).stroke(1.5,16777215,1).fill({color:f,alpha:1});p.label="position",r.addChild(p)}else r.visible=!1;this._geolocationDirty=!1}};var Oz=Ot(_p(),1);var gne=12,fb=class extends St{constructor(e,t){super(e,t),this.enabled=!0;let r=this.scene.groups.get("basemap");this._resolved=new Map;let i=new we;i.label=`${this.layerID}-areas`,i.sortableChildren=!0,this.areaContainer=i;let s=new we;s.label=`${this.layerID}-lines`,s.sortableChildren=!0,this.lineContainer=s,r.addChild(i,s)}get supported(){return!!this.context.services.osm}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.osm;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}reset(){super.reset(),this._resolved.clear()}render(e,t,r){let i=this.context,s=i.services.osm;if(!this.enabled||!s?.started||r<gne)return;let o=i.systems.editor,a=i.systems.filters,l=o.staging.graph;i.loadTiles();let c=o.intersects(i.viewport.visibleExtent());c=a.filterScene(c,l);let u={polygons:new Map,lines:new Map,points:new Map,vertices:new Map};for(let y of c){let x=y.geometry(l);x==="point"?u.points.set(y.id,y):x==="vertex"?u.vertices.set(y.id,y):x==="line"?u.lines.set(y.id,y):x==="area"&&u.polygons.set(y.id,y)}this.renderPolygons(e,t,r,u),this.renderLines(e,t,r,u),this.renderPoints(e,t,r,u);let d=this.getDataWithClass("select"),f=this.getDataWithClass("hover"),h=this.getDataWithClass("drawing"),p=new Set([...d,...f,...h]);for(let y of p){if(l.hasEntity(y)?.type==="node")continue;let b=this._dataHasFeature.get(y)??new Set,_=!1;for(let S of b){let C=this.features.get(S)?.geometry;if(!(!C||C.type==="point")&&C.width<25&&C.height<25){_=!0;break}}_&&p.delete(y)}let m=new Set(p);for(let y of p){let x=l.hasEntity(y);if(x?.type==="node")for(let b of l.parentWays(x))m.add(b.id)}let g={descendantIDs:new Set,siblingIDs:new Set};for(let y of m)this.getSelfAndDescendants(y,g.descendantIDs),this.getSelfAndSiblings(y,g.siblingIDs);this.renderVertices(e,t,r,u,g),i.mode?.id==="select-osm"&&this.renderMidpoints(e,t,r,u,g)}renderPolygons(e,t,r,i){let s=i.polygons,o=this.context,a=o.systems.editor.staging.graph,l=o.systems.filters,c=o.systems.l10n,u=o.systems.presets,d=o.systems.styles,f=this.scene.groups.get("points"),h=l.isEnabled("points");function p(m){return!m||m.isFallback()||/^(address|building|indoor|landuse|man_made|military|natural|playground)/.test(m.id)?!1:!!(/^(attraction|club|craft|emergency|healthcare|office|power|shop|telecom|tourism)/.test(m.id)||/^amenity\/(?!parking|shelter)/.test(m.id)||/^leisure\/(?!garden|firepit|picnic_table|pitch|swimming_pool)/.test(m.id))}for(let[m,g]of s){let y=g.v||0,x=this._resolved.get(m);x?.v!==y&&(x=null),x||(x=(0,Oz.default)(g.asGeoJSON(a),!0),x.v=y,this._resolved.set(m,x));let b=x.type==="Polygon"?[x.coordinates]:x.type==="MultiPolygon"?x.coordinates:[];for(let _=0;_<b.length;++_){let S=b[_],C=`${this.layerID}-${m}-${_}`,k=this.features.get(C);if(k&&k.type!=="polygon"&&(k.destroy(),k=null),k||(k=new Ko(this,C),k.parentContainer=this.areaContainer),k.v!==y){k.v=y,k.geometry.setCoords(S);let v=k.geometry.origExtent.area();k.container.zIndex=-v,k.setData(m,g),k.clearChildData(m),g.type==="relation"&&g.members.forEach(w=>k.addChildData(m,w.id)),g.type==="way"&&g.nodes.forEach(w=>k.addChildData(m,w))}if(this.syncFeatureClasses(k),k.dirty){let v=u.match(g,a),w=d.styleMatch(g.tags);w.labelTint=w.fill.color??w.stroke.color??15658734,k.style=w;let A=c.displayPOIName(g.tags);k.label=A,h&&(A||p(v))?(k.poiFeatureID=`${this.layerID}-${m}-poi-${_}`,k.poiPreset=v):(k.poiFeatureID=null,k.poiPreset=null)}if(k.update(t,r),this.retainFeature(k,e),k.poiFeatureID&&k.poiPreset&&k.geometry.origPoi){let v=this.features.get(k.poiFeatureID);if(v||(v=new Lt(this,k.poiFeatureID),v.virtual=!0,v.parentContainer=f),v.v!==y&&(v.v=y,v.geometry.setCoords(k.geometry.origPoi),v.setData(m,g)),this.syncFeatureClasses(v),v.dirty){let w={iconName:k.poiPreset.icon,iconTint:1118481,markerName:"pin",markerTint:16777215};wI(g)&&(w.iconTint=4473924,w.labelTint=14540253,w.markerName="boldPin",w.markerTint=14540253),v.style=w,v.label=k.label}v.update(t,r),this.retainFeature(v,e)}}}}renderLines(e,t,r,i){let s=i.lines,o=this.context,a=o.systems.editor.staging.graph,l=o.systems.l10n,c=o.systems.styles,u=this.lineContainer;for(let[f,h]of s){let p=typeof h.layer=="function"?h.layer():0,m=d(p.toString()),g=xne(h.tags),y=h.v||0,x=this._resolved.get(f);x?.v!==y&&(x=null),x||(x=h.asGeoJSON(a),x.v=y,x.type==="LineString"&&h.tags.oneway==="-1"&&x.coordinates.reverse(),this._resolved.set(f,x));let b=x.type==="LineString"?[[x.coordinates]]:x.type==="Polygon"?[x.coordinates]:x.type==="MultiPolygon"?x.coordinates:[];for(let _=0;_<b.length;++_){let S=b[_];for(let C=0;C<S.length;++C){let k=S[C],v=`${this.layerID}-${f}-${_}-${C}`,w=this.features.get(v);if(w&&w.type!=="line"&&(w.destroy(),w=null),w||(w=new Xn(this,v)),w.v!==y&&(w.v=y,w.geometry.setCoords(k),w.parentContainer=m,w.container.zIndex=g,w.setData(f,h),w.clearChildData(f),h.type==="relation"&&h.members.forEach(A=>w.addChildData(f,A.id)),h.type==="way"&&h.nodes.forEach(A=>w.addChildData(f,A))),this.syncFeatureClasses(w),w.dirty){let A=h.tags,E=h.geometry(a);if(!h.hasInterestingTags()){let M=a.parentRelations(h).find(T=>T.isMultipolygon());M&&(A=M.tags,E="area")}let I=c.styleMatch(A);E==="line"?(I.lineMarkerName=h.isOneWay()?"oneway":"",I.sidedMarkerName=h.isSided()?"sided":""):(I.casing.width=0,I.stroke.color=I.fill.color,I.stroke.width=2,I.stroke.alpha=1),w.style=I,w.label=l.displayName(h.tags)}w.update(t,r),this.retainFeature(w,e)}}}function d(f){let h=u.getChildByLabel(f);return h||(h=new we,h.label=f.toString(),h.sortableChildren=!0,h.zIndex=f,u.addChild(h)),h}}renderVertices(e,t,r,i,s){let o=i.vertices,a=this.context,l=a.systems.editor.staging.graph,c=a.systems.l10n,u=a.systems.presets,d=this.scene.layers.get("map-ui").selected,f=this.scene.groups.get("points");function h(m){return m.hasInterestingTags()||m.isEndpoint(l)||m.isIntersection(l)}function p(m){return s.descendantIDs.has(m)||s.siblingIDs.has(m)}for(let[m,g]of o){let y=null;if(r>=16&&h(g)&&(y=f),p(m)&&(y=d),!y)continue;let x=`${this.layerID}-${m}`,b=g.v||0,_=this.features.get(x);if(_&&_.type!=="point"&&(_.destroy(),_=null),_||(_=new Lt(this,x)),_.v!==b&&(_.v=b,_.geometry.setCoords(g.loc),_.setData(m,g)),this.syncFeatureClasses(_),_.parentContainer=y,_.dirty){let C=u.match(g,l)?.icon,k=g.directions(l,a.viewport),v={iconName:C,iconTint:1118481,labelTint:15658734,markerName:"smallCircle",markerTint:16777215,viewfieldAngles:k,viewfieldName:"viewfieldDark",viewfieldTint:16777215};C?(v.markerName="largeCircle",v.iconName=C):g.hasInterestingTags()&&(v.markerName="taggedCircle"),wI(g)&&(v.iconTint=4473924,v.labelTint=14540253,v.markerTint=14540253),l.isShared(g)&&(v.iconTint=1118481,v.labelTint=12303291,v.markerTint=12303291),_.style=v,_.label=c.displayName(g.tags)}_.update(t,r),this.retainFeature(_,e)}}renderPoints(e,t,r,i){let s=i.points,o=this.context,a=o.systems.editor.staging.graph,l=o.systems.l10n,c=o.systems.presets,u=this.scene.groups.get("points");for(let[d,f]of s){let h=`${this.layerID}-${d}`,p=f.v||0,m=this.features.get(h);if(m&&m.type!=="point"&&(m.destroy(),m=null),m||(m=new Lt(this,h),m.parentContainer=u),m.v!==p&&(m.v=p,m.geometry.setCoords(f.loc),m.setData(d,f)),this.syncFeatureClasses(m),m.dirty){let g=c.match(f,a),y=g?.icon;y||(g=c.matchTags(f.tags,"vertex"),y=g?.icon);let x=f.directions(a,o.viewport),b={iconName:y,iconTint:1118481,markerName:"pin",markerTint:16777215,viewfieldAngles:x,viewfieldName:"viewfieldDark",viewfieldTint:16777215};wI(f)&&(b.iconTint=4473924,b.labelTint=14540253,b.markerName="boldPin",b.markerTint=14540253),g.id==="address"&&(b.iconName="maki-circle-stroked",b.markerName="largeCircle"),m.style=b,m.label=l.displayName(f.tags)}m.update(t,r),this.retainFeature(m,e)}}renderMidpoints(e,t,r,i,s){let l=this.context.systems.editor.staging.graph,c=new Map([...i.lines,...i.polygons]),u=this.scene.layers.get("map-ui").selected,d=new Map,f={markerName:"midpoint"};for(let[p,m]of c){if(!s.descendantIDs.has(p))continue;let g=l.childNodes(m);if(!g.length)continue;let y=g.map(x=>({id:x.id,point:t.project(x.loc)}));m.tags.oneway==="-1"&&y.reverse();for(let x=0;x<y.length-1;x++){let b=y[x],_=y[x+1],S=[b.id,_.id].sort().join("-");if(Ne(b.point,_.point)<40)continue;let k=at(b.point,_.point,.5),v=sr(b.point,_.point)+t.transform.rotation,w=t.unproject(k),A={type:"midpoint",id:S,a:b,b:_,way:m,loc:w,rot:v};d.has(S)||d.set(S,A)}}for(let[p,m]of d){let g=`${this.layerID}-${p}`,y=this.features.get(g);y||(y=new Lt(this,g),y.style=f,y.parentContainer=u);let x=h(m);y.v!==x&&(y.v=x,y.geometry.setCoords(m.loc),y.marker.rotation=m.rot,y.setData(p,m),y.addChildData(m.way.id,p)),this.syncFeatureClasses(y),y.update(t,r),this.retainFeature(y,e)}function h(p){return p.loc[0]+p.loc[1]+p.rot}}},yne={motorway:0,motorway_link:-1,trunk:-2,trunk_link:-3,primary:-4,primary_link:-5,secondary:-6,tertiary:-7,unclassified:-8,residential:-9,service:-10,busway:-11,track:-12,footway:-20};function xne(n){return yne[n.highway]||0}function wI(n){return n.tags.wikidata||n.tags["flag:wikidata"]||n.tags["brand:wikidata"]||n.tags["network:wikidata"]||n.tags["operator:wikidata"]}var bne=12,hb=class extends St{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.osm}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.osm;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}renderMarkers(e,t,r){let i=this.context.services.osm;if(!i?.started)return;let s=this.scene.groups.get("qa"),o=i.getNotes();for(let a of o){let l=`${this.layerID}-${a.id}`,c=a.v||0,u=this.features.get(l);if(u||(u=new Lt(this,l),u.parentContainer=s),u.v!==c&&(u.v=c,u.geometry.setCoords(a.loc),u.setData(a.id,a)),this.syncFeatureClasses(u),u.dirty){let d=16724736,f="rapid-icon-close";a.status==="closed"&&(d=5627136,f="rapid-icon-apply"),a.isNew()&&(d=16772608,f="rapid-icon-plus");let h={markerName:"osmnote",markerTint:d,iconName:f,anchor:{y:.65}};u.style=h}u.update(t,r),this.retainFeature(u,e)}}render(e,t,r){let i=this.context.services.osm;!this.enabled||!i?.started||r<bne||(i.loadNotes(this.context.viewport),this.renderMarkers(e,t,r))}};var _ne=12,pb=class extends St{constructor(e,t){super(e,t)}get supported(){return!!this.context.services.osmose}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.osmose;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}renderMarkers(e,t,r){let i=this.context.services.osmose;if(!i?.started)return;let s=this.scene.groups.get("qa"),o=i.getData();for(let a of o){let l=`${this.layerID}-${a.id}`,c=this.features.get(l);if(!c){let u={markerName:"osmose",markerTint:i.getColor(a.item),iconName:a.icon};c=new Lt(this,l),c.geometry.setCoords(a.loc),c.style=u,c.parentContainer=s,c.setData(a.id,a)}this.syncFeatureClasses(c),c.update(t,r),c._isCircular||c.icon.position.set(0,-17),this.retainFeature(c,e)}}render(e,t,r){let i=this.context.services.osmose;!this.enabled||!i?.started||r<_ne||(i.loadTiles(),this.renderMarkers(e,t,r))}};var Lz=Ot(_p(),1);var vne=12,mb=class extends St{constructor(e,t){super(e,t),this.enabled=!0,this._resolved=new Map}get supported(){let e=this.context.services;return!!(e.mapwithai||e.esri||e.overture)}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.esri,s=t.services.mapwithai,o=t.services.overture,a=[];i&&a.push(i),s&&a.push(s),o&&a.push(o),e&&a.length&&Promise.all(a.map(l=>l.startAsync())).then(()=>r.immediateRedraw())}reset(){super.reset(),this._resolved.clear()}render(e,t,r){let i=this.context.systems.rapid;if(!(!this.enabled||!i.datasets.size||r<vne))for(let s of i.datasets.values())this.renderDataset(s,e,t,r)}renderDataset(e,t,r,i){let s=this.context,o=s.systems.rapid;if(!(e.added&&e.enabled))return;let l=s.services[e.service];if(!l?.started)return;let c=sa(window.location.hash).conflation,u=e.conflated;(c==="false"||c==="no")&&(u=!1);let d=e.id+(u?"-conflated":""),f=null;e.service!=="overture"&&(f=l.graph(d));function h(S){return o.acceptIDs.has(S.id)||o.ignoreIDs.has(S.id)}let p={points:[],vertices:new Set,lines:[],polygons:[]};if(e.service==="mapwithai"){i>=15&&l.loadTiles(d);let S=l.getData(d).filter(C=>C.type==="way"&&!h(C));if(e.id==="fbRoads"||e.id==="omdFootways"||e.id==="rapid_intro_graph"){p.lines=S.filter(C=>C.geometry(f)==="line"&&!!C.tags.highway);for(let C of p.lines){let k=f.entity(C.first()),v=f.entity(C.last());p.vertices.add(k),p.vertices.add(v)}}else p.polygons=S.filter(C=>C.geometry(f)==="area")}else if(e.service==="esri"){i>=14&&l.loadTiles(d);let S=l.getData(d);for(let C of S){if(h(C))continue;let k=C.geometry(f);k==="point"&&C.__fbid__?p.points.push(C):k==="line"?p.lines.push(C):k==="area"&&p.polygons.push(C)}}else if(e.service==="overture"){i>=16&&l.loadTiles(d);let S=l.getData(d);for(let C of S)C.overture=!0,C.__datasetid__=d,p.points.push(C)}let m=this.scene.groups.get("points"),g=this.scene.groups.get("basemap"),y=`${this.layerID}-${e.id}-areas`,x=`${this.layerID}-${e.id}-lines`,b=g.getChildByLabel(y);b||(b=new we,b.label=y,b.sortableChildren=!0,g.addChild(b));let _=g.getChildByLabel(x);_||(_=new we,_.label=x,_.sortableChildren=!0,g.addChild(_)),this.renderPolygons(b,e,f,t,r,i,p),this.renderLines(_,e,f,t,r,i,p),this.renderPoints(m,e,f,t,r,i,p)}renderPolygons(e,t,r,i,s,o,a){let l=new ce(t.color),c=this.context.systems.l10n;for(let u of a.polygons){let d=this._resolved.get(u.id);d||(d=(0,Lz.default)(u.asGeoJSON(r),!0),this._resolved.set(u.id,d));let f=d.type==="Polygon"?[d.coordinates]:d.type==="MultiPolygon"?d.coordinates:[];for(let h=0;h<f.length;++h){let p=f[h],m=`${this.layerID}-${t.id}-${u.id}-${h}`,g=this.features.get(m);if(!g){g=new Ko(this,m),g.geometry.setCoords(p);let y=g.geometry.origExtent.area();g.container.zIndex=-y,g.parentContainer=e,g.rapidFeature=!0,g.setData(u.id,u)}if(this.syncFeatureClasses(g),g.dirty){let y={labelTint:l,fill:{width:2,color:l,alpha:.3}};g.style=y,g.label=c.displayName(u.tags),g.update(s,o)}this.retainFeature(g,i)}}}renderLines(e,t,r,i,s,o,a){let l=new ce(t.color),c=this.context.systems.l10n;for(let u of a.lines){let d=`${this.layerID}-${t.id}-${u.id}`,f=this.features.get(d);if(!f){let p=u.asGeoJSON(r).coordinates;u.tags.oneway==="-1"&&p.reverse(),f=new Xn(this,d),f.geometry.setCoords(p),f.parentContainer=e,f.rapidFeature=!0,f.setData(u.id,u)}if(this.syncFeatureClasses(f),f.dirty){let h={labelTint:l,casing:{width:5,color:4473924},stroke:{width:3,color:l}};h.lineMarkerName=u.isOneWay()?"oneway":"",f.style=h,f.label=c.displayName(u.tags),f.update(s,o)}this.retainFeature(f,i)}}renderPoints(e,t,r,i,s,o,a){let l=new ce(t.color),c=this.context.systems.l10n,u={markerName:"largeCircle",markerTint:l,iconName:"maki-circle-stroked",labelTint:l},d={markerName:"smallCircle",markerTint:l,labelTint:l};for(let f of a.points){let h=`${this.layerID}-${t.id}-${f.id}`,p=this.features.get(h);if(p||(p=new Lt(this,h),p.geometry.setCoords(f.loc||f.geojson.geometry.coordinates),p.parentContainer=e,p.rapidFeature=!0,p.setData(f.id,f)),this.syncFeatureClasses(p),p.dirty){if(p.style=u,f.geojson)p.label=f.geojson.properties["@name"];else{p.label=c.displayName(f.tags);let m=f.tags["addr:housenumber"];!p.label&&m&&(p.label=m)}p.update(s,o)}this.retainFeature(p,i)}for(let f of a.vertices){let h=`${this.layerID}-${f.id}`,p=this.features.get(h);if(p||(p=new Lt(this,h),p.geometry.setCoords(f.loc),p.parentContainer=e,p.rapidFeature=!0,p.allowInteraction=!1,p.setData(f.id,f)),this.syncFeatureClasses(p),p.dirty){p.style=d,p.label=c.displayName(f.tags);let m=f.tags["addr:housenumber"];!p.label&&m&&(p.label=m),p.update(s,o)}this.retainFeature(p,i)}}};var gb=class extends St{constructor(e,t){super(e,t),this._clear(),this._enabled=!0;let r=new we;r.label=`${this.layerID}`,r.sortableChildren=!1,r.interactiveChildren=!0,this.overlaysContainer=r,this._overlaysDefined=null,this.scene.groups.get("basemap").addChild(r)}render(e,t,r){if(!this.enabled||!this.hasData())return;let i=this.context.services.vectortile,s=this.context.systems.rapid.datasets;this.overlaysContainer.removeChildren();for(let a of s.values())if(a.overlay&&a.enabled){let l=new ce(a.color),c=a.overlay;if(i){r>=c.minZoom&&r<=c.maxZoom&&i.loadTiles(c.url);let d=i.getData(c.url).map(f=>f.geojson).filter(f=>f.geometry.type==="Point"||f.geometry.type==="MultiPoint");this.renderPoints(e,t,r,d,l)}}}renderPoints(e,t,r,i,s){let o=this.overlaysContainer;for(let a of i){let l=a.geometry.type==="Point"?[a.geometry.coordinates]:a.geometry.type==="MultiPoint"?a.geometry.coordinates:[];for(let c=0;c<l.length;++c){let u=l[c],d=t.project(u),f=new ze().circle(0,0,40).fill({color:s,alpha:.05});f.x=d[0],f.y=d[1],o.addChild(f)}}}hasData(){if(this._overlaysDefined===null){let e=this.context.systems.rapid.datasets;this._overlaysDefined=!1;for(let t of e.values())t.overlay&&(this._overlaysDefined=!0)}return this._overlaysDefined}_clear(){this._overlaysDefined=null}};var wne=12,SI=1048516,yb=16772608,Sne={casing:{alpha:0},stroke:{alpha:.7,width:4,color:SI}},Cne={markerAlpha:.8,markerName:"mediumCircle",markerTint:SI,viewfieldAlpha:.7,viewfieldName:"viewfield",viewfieldTint:SI,scale:1,fovWidth:1,fovLength:1},Ane=Ua([90,10],[1.3,.7]),Ene=Ua([90,10],[.7,1.5]),xb=class extends St{constructor(e,t){if(super(e,t),this._dirtyCurrentPhoto=this._dirtyCurrentPhoto.bind(this),this.supported){let r=this.context.services.streetside;r.on("bearingChanged",this._dirtyCurrentPhoto),r.on("fovChanged",this._dirtyCurrentPhoto)}}_dirtyCurrentPhoto(){let e=this.context,t=e.systems.gfx,i=e.systems.photos.currPhotoID;if(!i)return;let s=this._dataHasFeature.get(i)??new Set;for(let o of s){let a=this.features.get(o);a&&(a._styleDirty=!0)}t.immediateRedraw()}get supported(){return!!this.context.services.streetside}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.streetside;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}filterImages(e){let t=this.context.systems.photos,r=t.fromDate,i=r&&new Date(r).getTime(),s=t.toDate,o=s&&new Date(s).getTime(),a=t.usernames,l=t.showsPhotoType("flat"),c=t.showsPhotoType("panoramic");return e.filter(u=>{if(u.id===t.currPhotoID)return!0;if(!l&&!u.isPano||!c&&u.isPano)return!1;let d=new Date(u.captured_at).getTime();return!(i&&i>d||o&&o<d||a&&!a.includes(u.captured_by))})}filterSequences(e){let t=this.context.systems.photos,r=t.fromDate,i=r&&new Date(r).getTime(),s=t.toDate,o=s&&new Date(s).getTime(),a=t.usernames,l=t.showsPhotoType("flat"),c=t.showsPhotoType("panoramic");return e.filter(u=>{if(!l&&!u.isPano||!c&&u.isPano)return!1;let d=new Date(u.captured_at).getTime();return!(i&&i>d||o&&o<d||a&&!a.includes(u.captured_by))})}renderMarkers(e,t,r){let i=this.context.services.streetside;if(!i?.started)return;let s=this.scene.groups.get("streetview"),o=i.getImages(),a=i.getSequences();a=this.filterSequences(a),o=this.filterImages(o);for(let l of a){let c=l.id,u=`${this.layerID}-sequence-${c}`,d=l.v||0,f=this.features.get(u);f||(f=new Xn(this,u),f.style=Sne,f.parentContainer=s,f.container.zIndex=-100),f.v!==d&&(f.v=d,f.geometry.setCoords(l.coordinates),f.setData(c,l),f.clearChildData(c),l.bubbleIDs.forEach(h=>f.addChildData(c,h))),this.syncFeatureClasses(f),f.update(t,r),this.retainFeature(f,e)}for(let l of o){let c=l.id,u=`${this.layerID}-photo-${c}`,d=this.features.get(u);if(d||(d=new Lt(this,u),d.geometry.setCoords(l.loc),d.parentContainer=s,d.setData(c,l)),this.syncFeatureClasses(d),d.dirty){let f=Object.assign({},Cne);if(d.hasClass("selectphoto")){let h=i._viewer,p=h?.getYaw()??0,m=h?.getHfov()??45;f.viewfieldAngles=[l.ca+p],f.viewfieldName="viewfield",f.viewfieldAlpha=1,f.viewfieldTint=yb,f.markerTint=yb,f.scale=2,f.fovWidth=Ane(m),f.fovLength=Ene(m)}else f.viewfieldAngles=Number.isFinite(l.ca)?[l.ca]:[],f.viewfieldName=l.isPano?"pano":"viewfield",d.hasClass("highlightphoto")&&(f.viewfieldAlpha=1,f.viewfieldTint=yb,f.markerTint=yb);d.style=f}d.update(t,r),this.retainFeature(d,e)}}render(e,t,r){let i=this.context.services.streetside;!this.enabled||!i?.started||r<wne||(i.loadTiles(),this.renderMarkers(e,t,r))}};var Sp=3079982,bb=class extends St{constructor(e,t){super(e,t);let r=new we;r.label=`${this.layerID}-geoscribbles`,r.sortableChildren=!1,r.interactiveChildren=!0,this.scribblesContainer=r,this.scene.groups.get("basemap").addChild(r)}get supported(){return!!this.context.services.geoScribble}get enabled(){return this._enabled}set enabled(e){if(this.supported||(e=!1),e===this._enabled)return;this._enabled=e;let t=this.context,r=t.systems.gfx,i=t.services.geoScribble;e&&i&&i.startAsync().then(()=>r.immediateRedraw())}render(e,t,r){if(!this.enabled)return;let i=this.context.services.geoScribble;i.loadTiles();let s=i.getData(),o=s.filter(l=>l.geometry.type==="LineString"||l.geometry.type==="MultiLineString"),a=s.filter(l=>l.geometry.type==="Point"||l.geometry.type==="MultiPoint");this.renderLines(e,t,r,o),this.renderPoints(e,t,r,a)}getLineStyle(e,t){let r=e||{stroke:{width:2,color:Sp,alpha:1,cap:"round"},labelTint:Sp},i=t.properties.color?new ce(t.properties.color):Sp,s=t.properties.thin,o=t.properties.dashed;return r.stroke.alpha=.7,r.stroke.color=i,r.stroke.width=s?4:8,o&&(r.stroke.dash=s?[12,6]:[24,12]),r}renderLines(e,t,r,i,s){let o=this.scribblesContainer;for(let a of i){let l=a.__featurehash__,c=a.v||0,u=a.geometry.type==="LineString"?[a.geometry.coordinates]:a.geometry.type==="MultiLineString"?a.geometry.coordinates:[];for(let d=0;d<u.length;++d){let f=u[d],h=`${this.layerID}-${l}-${d}`,p=this.features.get(h);p&&p.type!=="line"&&(p.destroy(),p=null);let m=this.getLineStyle(s,a);p||(p=new Xn(this,h),p.style=m,p.parentContainer=o),p.v!==c&&(p.v=c,p.geometry.setCoords(f),p.label=a.properties.text,p.setData(l,a)),this.syncFeatureClasses(p),p.update(t,r),this.retainFeature(p,e)}}}renderPoints(e,t,r,i){let s=this.scribblesContainer,o={markerName:"largeCircle",markerTint:Sp,iconName:"maki-circle-stroked",labelTint:Sp};for(let a of i){let l=a.__featurehash__,c=a.v||0,u=a.geometry.type==="Point"?[a.geometry.coordinates]:a.geometry.type==="MultiPoint"?a.geometry.coordinates:[];for(let d=0;d<u.length;++d){let f=u[d],h=`${this.layerID}-${l}-${d}`,p=this.features.get(h);p&&p.type!=="point"&&(p.destroy(),p=null),p||(p=new Lt(this,h),p.style=o,p.parentContainer=s),p.v!==c&&(p.v=c,p.geometry.setCoords(f),p.label=a.properties.text,p.setData(l,a)),this.syncFeatureClasses(p),p.update(t,r),this.retainFeature(p,e)}}}};function Zd(n){return n instanceof Set?n:new Set(n!==void 0&&[].concat(n))}var _b=class extends st{constructor(e){super(),this.gfx=e,this.context=e.context,this.groups=new Map,this.layers=new Map,this.features=new Map,["background","basemap","points","streetview","qa","labels","blocks","ui"].forEach((t,r)=>{let i=new we;i.label=t,i.sortableChildren=!0,i.zIndex=r,e.origin.addChild(i),this.groups.set(t,i)}),[new qd(this,"background"),new bb(this,"geoScribble"),new fb(this,"osm"),new mb(this,"rapid"),new gb(this,"rapid-overlay"),new rb(this,"mapillary-detections"),new cb(this,"mapillary-signs"),new Yx(this,"custom-data"),new ub(this,"maproulette"),new hb(this,"notes"),new Jx(this,"keepRight"),new pb(this,"osmose"),new lb(this,"mapillary"),new Zx(this,"kartaview"),new xb(this,"streetside"),new tb(this,"labels"),new Kx(this,"edit-blocks"),new db(this,"map-ui")].forEach(t=>this.layers.set(t.id,t))}reset(){for(let e of this.layers.values())e.reset()}render(e,t,r){for(let i of this.layers.values())i.render(e,t,r),i.cull(e)}enableLayers(e){for(let t of Zd(e)){let r=this.layers.get(t);r&&(r.enabled=!0)}this.emit("layerchange")}disableLayers(e){for(let t of Zd(e)){let r=this.layers.get(t);r&&(r.enabled=!1)}this.emit("layerchange")}toggleLayers(e){for(let t of Zd(e)){let r=this.layers.get(t);r&&(r.enabled=!r.enabled)}this.emit("layerchange")}onlyLayers(e){let t=Zd(e);for(let r of this.layers.values())r.enabled=t.has(r.id);this.emit("layerchange")}addFeature(e){this.features.set(e.id,e)}removeFeature(e){this.features.delete(e.id)}setClass(e,t,r){this.layers.get(t)?.setClass(e,r)}unsetClass(e,t,r){this.layers.get(t)?.unsetClass(e,r)}clearClass(e){for(let t of this.layers.values())t.clearClass(e)}dirtyScene(){for(let e of this.features.values())e.dirty=!0}dirtyLayers(e){for(let t of Zd(e))this.layers.get(t)?.dirtyLayer()}dirtyFeatures(e){for(let t of Zd(e)){let r=this.features.get(t);r&&(r.dirty=!0)}}dirtyData(e,t){this.layers.get(e)?.dirtyData(t)}};var ao={HORIZONTAL:0,VERTICAL:1},dc={HOR:0,VERT:1,NONE:2},Or=class n{static makeArea(e,t,r){return e|t<<15|r<<30}static getOpenOffset(e){return e&32767}static getCloseOffset(e){return e>>15&32767}static getOrientation(e){return e>>30&1}static setOpenOffset(e,t){return n.makeArea(t,n.getCloseOffset(e),n.getOrientation(e))}static setCloseOffset(e,t){return n.makeArea(n.getOpenOffset(t),t,n.getOrientation(e))}},vb=class{constructor(e,t){this._tempRect=new $e,this._width=e,this._height=t,this._root=[null,Or.makeArea(0,this._height,ao.HORIZONTAL),!1]}allocate(e,t){let r=this.findArea(e,t);if(!r)return null;let i=new $e;this.getFrame(r,i);let s=new $e(i.x,i.y,e,t),o=this.split(r,i,s);return i.copyFrom(s),i.__mem_area=o,i}free(e){let t=e.__mem_area;t[2]=!1,this._merge(t)}get width(){return this._width}get height(){return this._height}getParent(e){return e[0]}getAreaField(e){return e[1]}getFrame(e,t){t||(t=new $e);let r=this.getAreaField(e),i=this.getParent(e),s=Or.getOrientation(r),o=Or.getOpenOffset(r),a=Or.getCloseOffset(r),l=i?Or.getOpenOffset(i[1]):0,c=i?Or.getCloseOffset(i[1]):this._width;return s?(t.x=o,t.y=l,t.width=a-t.x,t.height=c-l):(t.x=l,t.y=o,t.width=c-t.x,t.height=a-t.y),t}hasChildren(e){return Array.isArray(e[2])&&e[2].length!==0}getChildren(e){if(!Array.isArray(e[2]))throw new Error("Children do not exist");return e[2]}addChild(e,...t){e[2]=Array.isArray(e[2])?e[2]:[],e[2].push(...t)}findArea(e,t){return this.findAreaRecursive(this._root,e,t)}findAreaRecursive(e,t,r){let i=this.getFrame(e,this._tempRect);if(i.width<t||i.height<r)return null;if(!this.hasChildren(e)){let l=i.width-t,c=i.height-r;return l<0||c<0||e[2]?null:e}let s=this.getChildren(e),o=null,a=1/0;for(let l of s){let c=this.findAreaRecursive(l,t,r);if(!c)continue;let u=this.getFrame(c,this._tempRect),d=u.width-t,f=u.height-r;if(d<0||f<0)continue;if(!d&&!f)return c;let h=Math.min(d,f);a>h&&(o=c,a=h)}return o}splitOrientation(e,t){if(t.width===e.width&&t.height===e.height)return dc.NONE;if(t.width===e.width)return dc.VERT;if(t.height===e.height)return dc.HOR;let r=Math.abs((e.width-t.width)*e.height-t.width*(e.height-t.height)),i=Math.abs(e.width*(e.height-t.height)-(e.width-t.width)*t.height);return r>i?dc.HOR:dc.VERT}split(e,t,r,i){if(i||(i=this.getParent(e)?this.splitOrientation(t,r):dc.HOR),e[2]===!0)throw new Error("Cannot deallocate");return i===dc.NONE?(e[2]=!0,e):i===dc.HOR?this._splitPrimaryHorizontal(e,t,r):this._splitPrimaryVertical(e,t,r)}_splitPrimaryHorizontal(e,t,r){let i=this.getAreaField(e),s=Or.getOrientation(i),o=this.getParent(e);if(this.hasChildren(e))throw new Error("Cannot split non-leaf node");let a=[e,Or.makeArea(t.left,t.x+r.width,ao.VERTICAL),[]],l=[e,Or.makeArea(t.x+r.width,t.right,ao.VERTICAL),!1];if(s===ao.HORIZONTAL)this.addChild(e,a,l);else{let c=this.getChildren(o).indexOf(e);a[0]=o,l[0]=o,this.getChildren(o).splice(c,1,a,l)}if(r.height!==t.height){let c=[a,Or.makeArea(t.top,t.y+r.height,ao.HORIZONTAL),!0],u=[a,Or.makeArea(t.y+r.height,t.bottom,ao.HORIZONTAL),!1];return this.addChild(a,c,u),c}else a[2]=!0;return a}_splitPrimaryVertical(e,t,r){let i=this.getAreaField(e),s=Or.getOrientation(i),o=this.getParent(e);if(this.hasChildren(e))throw new Error("Cannot split non-leaf node");let a=[e,Or.makeArea(t.top,t.y+r.height,ao.HORIZONTAL),[]],l=[e,Or.makeArea(t.y+r.height,t.bottom,ao.HORIZONTAL),!1];if(s===ao.VERTICAL)this.addChild(e,a,l);else{let c=this.getChildren(o).indexOf(e);a[0]=o,l[0]=o,this.getChildren(o).splice(c,1,a,l)}if(r.width!==t.height){let c=[a,Or.makeArea(t.left,t.x+r.width,ao.VERTICAL),!0],u=[a,Or.makeArea(t.x+r.width,t.right,ao.VERTICAL),!1];return this.addChild(a,c,u),c}else a[2]=!0;return a}_merge(e){if(this.hasChildren(e))throw new Error("Cannot merge a non-leaf node");let t=this.getParent(e);if(!t)return;let r=this.getChildren(t),i=r.indexOf(e),s=r[i-1],o=r[i+1];o&&o[2]===!1&&(e[1]=Or.setCloseOffset(e[1],Or.getCloseOffset(o[1])),r.splice(i+1,1)),s&&s[2]===!1&&(e[1]=Or.setOpenOffset(e[1],Or.getOpenOffset(s[1])),r.splice(i-1,1)),r.length===1&&(t[2]=!1,this._merge(t))}printState(e){this.hasChildren(e)?this.getChildren(e).forEach(t=>this.printState(t)):console.log({...this.getFrame(e)},e[2])}};var Jd=class{constructor(e="",t=2048){this.label=e,this.size=t,this.slabs=[]}_allocateTexture(e,t,r=0){if(e+2*r>this.size||t+2*r>this.size)throw new Error(`Texture can not exceed slab size of ${this.size}x${this.size}`);for(let s of this.slabs){let o=this._issueTexture(s,e,t,r);if(o)return o}let i=new CI(this.label,this.size);return this.slabs.push(i),this._issueTexture(i,e,t,r)}_issueTexture(e,t,r,i=0){let s=e._binPacker.allocate(t+2*i,r+2*i);if(!s)return null;s.pad(-i);let o=new re({source:e,frame:s});return o.__bin=s,o}allocate(e,t,r,i){if(!(i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof ImageBitmap||i instanceof ImageData||ArrayBuffer.isView(i)))throw new Error("Unsupported asset type");let s=this._allocateTexture(e,t,r),o=s.uid,a=s.source,l={uid:o,texture:s,asset:i,dirtyId:i instanceof HTMLImageElement&&!i.complete?-1:0,updateId:-1};return a._items.set(o,l),i instanceof HTMLImageElement&&!i.complete&&i.addEventListener("load",()=>{!s.destroyed&&a._items.has(o)?(l.dirtyId++,a.update(),s.update()):console.warn("Image loaded after texture was destroyed")}),a.update(),s}free(e){let t=this.slabs.find(o=>o===e.source),r=e.uid;if(!t)throw new Error("Texture is not managed by this AtlasAllocator");let i=e.__bin;if(!i)throw new Error("Texture bin has been lost.");t._binPacker.free(i);let s=t._items.get(r);if(!s)throw new Error("Texture not found on slab.");s.texture.destroy(!1),s.asset=null,s.texture=null,t._items.delete(r)}},CI=class extends ot{constructor(e,t){super({antialias:!1,autoGarbageCollect:!1,autoGenerateMipmaps:!1,dimensions:"2d",height:t,label:e,resolution:1,width:t}),this.uploadMethodId="atlas",this._items=new Map,this._binPacker=new vb(t,t)}},Tne={id:"atlas",upload(n,e,t,r){let{width:i,height:s}=n,o=n.alphaMode==="premultiply-alpha-on-upload";t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),(e.width!==i||e.height!==s)&&(e.width=i,e.height=s,t.texImage2D(e.target,0,e.format,i,s,0,e.format,e.type,void 0));for(let a of n._items.values()){if(a.updateId===a.dirtyId)continue;let l=a.texture.__bin,c=a.asset;if(r===1){if(c instanceof ImageData)c=c.data;else if(c instanceof HTMLCanvasElement){let[u,d]=[l.width,l.height];c=c.getContext("2d").getImageData(0,0,u,d).data}else if(c instanceof HTMLImageElement){let[u,d]=[c.naturalWidth,c.naturalHeight],f=document.createElement("canvas");f.width=u,f.height=d;let h=f.getContext("2d");h.drawImage(c,0,0),c=h.getImageData(0,0,u,d).data}}t.texSubImage2D(e.target,0,l.x,l.y,l.width,l.height,e.format,e.type,c),a.updateId=a.dirtyId}}},kne={type:"atlas",upload(n,e,t){let r=n.alphaMode==="premultiply-alpha-on-upload";for(let i of n._items.values()){if(i.updateId===i.dirtyId)continue;let s=i.texture.__bin,o=i.asset;if(o instanceof ImageData&&(o=o.data),o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof ImageBitmap)t.device.queue.copyExternalImageToTexture({source:o},{origin:{x:s.x,y:s.y},premultipliedAlpha:r,texture:e},{height:s.height,width:s.width});else if(ArrayBuffer.isView(o))t.device.queue.writeTexture({origin:{x:s.x,y:s.y},texture:e},o,{bytesPerRow:o.byteLength/s.height},{height:s.height,width:s.width});else throw new Error("Unsupported source type");i.updateId=i.dirtyId}}};function Uz(n){n.type===Bt.WEBGL?n.texture._uploads.atlas=Tne:n.texture._uploads.atlas=kne}var wb=class{constructor(e){this.gfx=e,this.context=e.context,this.loaded=!1;let t=this.context.systems.assets,r=e.pixi.renderer;Uz(r);let i=2048;if(r.type===Bt.WEBGL){let c=r.gl;i=c.getParameter(c.MAX_TEXTURE_SIZE)}else r.type===Bt.WEBGPU&&(i=r.gpu.adapter.limits.maxTextureDimension2D);let o=Math.min(8192,i);this._atlas={symbol:new Jd("symbol",o),text:new Jd("text",o),tile:new Jd("tile",o)},this._textureData=new Map,this._svgIcons=new Map;let a=["bushes","cemetery","cemetery_buddhist","cemetery_christian","cemetery_jewish","cemetery_muslim","construction","dots","farmland","farmyard","forest","forest_broadleaved","forest_leafless","forest_needleleaved","grass","landfill","lines","orchard","pond","quarry","vineyard","waves","wetland","wetland_bog","wetland_marsh","wetland_reedbed","wetland_swamp"],l={};for(let c of a)l[c]=t.getFileURL(`img/pattern/${c}.png`);Ra.addBundle("patterns",l),Ra.loadBundle(["patterns"]).then(c=>{for(let[u,d]of Object.entries(c.patterns))this._textureData.set(u,{texture:d,refcount:1});this.loaded=!0}).catch(c=>console.error(c)),this._cacheGraphics()}get(e){return this.getTexture("symbol",e)}getTexture(e,t){let r=`${e}-${t}`,i=this._textureData.get(r);return i?i.texture:this._svgIcons.has(t)?(this._svgIconToTexture(t),re.EMPTY):null}getPatternTexture(e){return this._textureData.get(e)?.texture}getDebugTexture(e){let t=this._atlas[e];if(!t)return null;let r=t.slabs[0];return r?new re({source:r}):null}allocate(e,t,r,i,s){let o=this._atlas[e];if(!o)return null;let a=`${e}-${t}`,l=this._textureData.get(a);if(l)return l.refcount++,l.texture;let c=e==="symbol"?1:0,u=o.allocate(r,i,c,s);if(!u)throw new Error(`Couldn't allocate texture ${a}`);if(u.label=a,e==="tile"){let d=u.frame.clone().pad(-.5);u.frame=d,u.update()}return this._textureData.set(a,{texture:u,refcount:1}),u}free(e,t){let r=this._atlas[e];if(!r)return;let i=`${e}-${t}`,s=this._textureData.get(i);s&&(s.refcount--,s.refcount===0&&(r.free(s.texture),s.texture.destroy(!1),s.texture=null,this._textureData.delete(i)))}graphicToTexture(e,t,r={}){r.antialias=!1,r.target=t;let i=this.gfx.pixi.renderer,s=i.generateTexture(r),{pixels:o,width:a,height:l}=i.texture.getPixels(s),c=this.allocate("symbol",e,a,l,o);return c.orig=s.orig.clone(),s.destroy(),t.destroy({context:!0}),c}textToTexture(e,t,r){let i={text:t,style:r,resolution:2},o=this.gfx.pixi.renderer.canvasText.createTextureAndCanvas(i),a=o.canvasAndContext.canvas,l=o.texture,c=l.frame.width*l.source.resolution,u=l.frame.height*l.source.resolution,d=this.allocate("text",e,c,u,a);return d.orig=l.orig.clone(),l.destroy(),d}registerSvgIcon(e,t){this._svgIcons.set(e,t)}_svgIconToTexture(e){let t=this._svgIcons.get(e);if(!t)return;this._svgIcons.set(e,null);let r=t.getAttribute("viewBox"),i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),i.setAttribute("width","32"),i.setAttribute("height","32"),i.setAttribute("color","#fff"),i.setAttribute("viewBox",r);for(let a of t.childNodes)i.appendChild(a.cloneNode(!0));let s=new XMLSerializer().serializeToString(i);i=null;let o=new Image;o.src=`data:image/svg+xml,${encodeURIComponent(s)}`,o.onload=()=>{let a=o.naturalWidth,l=o.naturalHeight;this.allocate("symbol",e,a,l,o),this._svgIcons.delete(e),this.gfx.deferredRedraw(),o=null}}_cacheGraphics(){let t={frame:new $e(-13,0,26,52)},r=new ze().moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().fill({color:16777215,alpha:1}).stroke({color:4473924,width:1}),i=new ze().moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().fill({color:3355443,alpha:1}).stroke({color:13421772,width:1}),s=new ze().moveTo(-2,26).lineTo(2,26).lineTo(12,4).bezierCurveTo(12,0,-12,0,-12,4).closePath().stroke({color:13421772,width:1});this.graphicToTexture("viewfield",r,t),this.graphicToTexture("viewfieldDark",i,t),this.graphicToTexture("viewfieldOutline",s,t);let o=new ze().circle(0,0,20).fill({color:16777215,alpha:1}).stroke({color:4473924,width:1}),a=new ze().circle(0,0,20).fill({color:3355443,alpha:1}).stroke({color:13421772,width:1}),l=new ze().circle(0,0,20).stroke({color:13421772,width:1});this.graphicToTexture("pano",o),this.graphicToTexture("panoDark",a),this.graphicToTexture("panoOutline",l);let c=new ze().moveTo(0,0).bezierCurveTo(-2,-2,-8,-10,-8,-15).bezierCurveTo(-8,-19,-4,-23,0,-23).bezierCurveTo(4,-23,8,-19,8,-15).bezierCurveTo(8,-10,2,-2,0,0).closePath().fill({color:16777215,alpha:1}).stroke({color:4473924,width:1}),u=new ze().moveTo(0,0).bezierCurveTo(-2,-2,-8,-10,-8,-15).bezierCurveTo(-8,-19,-4,-23,0,-23).bezierCurveTo(4,-23,8,-19,8,-15).bezierCurveTo(8,-10,2,-2,0,0).closePath().fill({color:14540253,alpha:1}).stroke({color:6710886,width:1.5}),d=new ze().rect(-12,-12,24,24).fill({color:16777215,alpha:1}).stroke({color:4473924,width:2}),f=new ze().rect(-8,-8,16,16).fill({color:16777215,alpha:1}).stroke({color:4473924,width:2}),h=new ze().circle(0,0,12).fill({color:16777215,alpha:1}).stroke({color:4473924,width:2}),p=new ze().circle(0,0,8).fill({color:16777215,alpha:1}).stroke({color:4473924,width:1}),m=new ze().circle(0,0,6).fill({color:16777215,alpha:1}).stroke({color:4473924,width:1}),g=new ze().circle(0,0,4.5).fill({color:16777215,alpha:1}).stroke({color:4473924,width:1}),y=new ze().circle(0,0,4.5).fill({color:16777215,alpha:1}).stroke({color:4473924,width:1}).circle(0,0,2).fill({color:0,alpha:1});this.graphicToTexture("pin",c),this.graphicToTexture("boldPin",u),this.graphicToTexture("xlargeSquare",d),this.graphicToTexture("largeSquare",f),this.graphicToTexture("xlargeCircle",h),this.graphicToTexture("largeCircle",p),this.graphicToTexture("mediumCircle",m),this.graphicToTexture("smallCircle",g),this.graphicToTexture("taggedCircle",y);let x=new ze().moveTo(15,6.5).lineTo(10.8,6.5).bezierCurveTo(12.2,1.3,11.7,.8,11.2,.8).lineTo(6.2,.8).bezierCurveTo(5.8,.7,5.4,1,5.4,1.5).lineTo(4.2,10.2).bezierCurveTo(4.1,10.8,4.6,11.2,5,11.2).lineTo(9.3,11.2).lineTo(7.6,18.3).bezierCurveTo(7.5,18.8,8,19.3,8.5,19.3).bezierCurveTo(8.8,19.3,9.1,19.1,9.2,18.8).lineTo(15.6,7.8).bezierCurveTo(16,7.2,15.6,6.5,15,6.5).closePath().stroke({color:3355443,width:1}).fill({color:16777215}),b=new ze().moveTo(17.5,0).lineTo(2.5,0).bezierCurveTo(1.13,0,0,1.12,0,2.5).lineTo(0,13.75).bezierCurveTo(0,15.12,1.12,16.25,2.5,16.25).lineTo(6.25,16.25).lineTo(6.25,19.53).bezierCurveTo(6.25,19.91,6.68,20.13,7,19.9).lineTo(11.87,16.25).lineTo(17.49,16.25).bezierCurveTo(18.86,16.25,20,15.12,20,13.75).lineTo(20,2.5).bezierCurveTo(20,1.13,18.87,0,17.5,0).closePath().stroke({color:3355443,width:1.5}).fill({color:16777215,alpha:1}),_=new ze().poly([16,3,4,3,1,6,1,17,4,20,7,20,10,27,13,20,16,20,19,17.033,19,6]).closePath().fill({color:16777215}).stroke({color:3355443,width:1});this.graphicToTexture("keepright",x),this.graphicToTexture("osmnote",b),this.graphicToTexture("osmose",_);let S=new ze().poly([-3,4,7,0,-3,-4]).fill({color:16777215,alpha:1}).stroke({color:4473924,width:1}),C=new ze().poly([5,3,0,3,0,2,5,2,5,0,10,2.5,5,5]).fill({color:16777215,alpha:1}),k=new ze().poly([0,5,5,0,0,-5]).fill({color:16777215,alpha:1});this.graphicToTexture("midpoint",S),this.graphicToTexture("oneway",C),this.graphicToTexture("sided",k);let v=new ze().rect(-5,-5,10,10).fill({color:16777215,alpha:.6}).stroke({color:16777215,width:1}),w=new ze().poly([-5,-5,5,-5,5,5,1,5,1,1,-5,1,-5,-5]).fill({color:16777215,alpha:.6}).stroke({color:16777215,width:1}),A=new ze().circle(0,0,5).fill({color:16777215,alpha:.6}).stroke({color:16777215,width:1});this.graphicToTexture("lowres-square",v),this.graphicToTexture("lowres-ell",w),this.graphicToTexture("lowres-circle",A);let E=new ze().rect(-5,-5,10,10).stroke({color:16777215,width:1}),I=new ze().poly([-5,-5,5,-5,5,5,1,5,1,1,-5,1,-5,-5]).stroke({color:16777215,width:1}),M=new ze().circle(0,0,5).stroke({color:16777215,width:1});this.graphicToTexture("lowres-unfilled-square",E),this.graphicToTexture("lowres-unfilled-ell",I),this.graphicToTexture("lowres-unfilled-circle",M)}};var AI,Ine=250,Cp=class extends Se{constructor(e){super(e),this.id="gfx",this.dependencies=new Set(["assets","map","urlhash"]),this.supersurface=document.createElement("div"),this.surface=document.createElement("canvas"),this.overlay=document.createElement("div"),this.pixi=null,this.stage=null,this.origin=null,this.scene=null,this.events=null,this.textures=null,this.pixiViewport=new Rn,this._prevTransform={x:0,y:0,k:256/Math.PI,r:0},this._isTempTransformed=!1,this._transformEase=null,this._frame=0,this._timeToNextRender=0,this._appPending=!1,this._drawPending=!1,this._initPromise=null,this._startPromise=null,this.deferredRedraw=this.deferredRedraw.bind(this),this.immediateRedraw=this.immediateRedraw.bind(this),this._tick=this._tick.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context,t=e.systems.assets,r=e.systems.urlhash,i=Promise.all([t.initAsync(),r.initAsync()]);return this._initPromise=i.then(()=>this._initPixiAsync()).then(()=>this._afterPixiInit())}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,t=e.systems.map,r=e.systems.ui,i=Promise.all([t.startAsync(),r.startAsync()]);return this._startPromise=i.then(()=>{this._started=!0,this.pixi.ticker.start()})}resetAsync(){return this.immediateRedraw(),Promise.resolve()}pause(){this._paused=!0}resume(){this._paused=!1,this.immediateRedraw()}_tick(){if(!this._started||this._paused)return;let e=this.pixi.ticker;if(this._drawPending){let t=this._frame,r=`draw-${t}-start`,i=`draw-${t}-end`;window.performance.mark(r),this._draw(),window.performance.mark(i),window.performance.measure(`draw-${t}`,r,i);return}if(this._tform(),this._appPending){if(this._timeToNextRender-=e.deltaMS,this._timeToNextRender>=0)return;{let t=this._frame,r=`app-${t}-start`,i=`app-${t}-end`;window.performance.mark(r),this._app(),window.performance.mark(i),window.performance.measure(`app-${t}`,r,i);return}}}deferredRedraw(){this._appPending=!0}immediateRedraw(){this._timeToNextRender=0,this._appPending=!0}setTransformAsync(e,t=0){let r=window.performance.now(),s=this.context.viewport,o=s.transform.props,a;if(this._transformEase&&(s.transform=o,this._transformEase.resolve(o),this._transformEase=null),t>0){let l;a=new Promise(c=>{l=c}),this._transformEase={time0:r,time1:r+t,xform0:o,xform1:e,promise:a,resolve:l}}else s.transform.props=e,a=Promise.resolve(e);return this._appPending=!0,a}_tform(){if(this._drawPending)return;let e=this.context,t=e.viewport,r=this.pixiViewport;if(this._transformEase){let u=window.performance.now(),{time0:d,time1:f,xform0:h,xform1:p,resolve:m}=this._transformEase,[g,y,x]=[h.x,h.y,h.k],[b,_,S]=[p.x,p.y,p.k],C=Qt(h.r,0,Kt),k=Qt(p.r,0,Kt);Math.abs(k-C)>Math.PI&&(k+=k<C?Kt:-Kt);let v=Math.max(0,Math.min(1,(u-d)/(f-d))),w=g+(b-g)*v,A=y+(_-y)*v,E=x+(S-x)*v,I=C+(k-C)*v,M={x:w,y:A,k:E,r:I};t.transform=M,v===1&&(m(M),this._transformEase=null),this._appPending=!0}let i=t.dimensions,s=r.dimensions,o=He(s,[0,0]);if(!He(i,s)&&!e.container().classed("resizing")){if(r.dimensions=i,!o){let[d,f]=yi(Me(i,s),.5),h=t.transform;t.transform={x:h.x+d,y:h.y+f,k:h.k,r:h.r}}this._appPending=!0,this._timeToNextRender=0;return}let a=t.transform.props,l=this._prevTransform;if(this._isTempTransformed||l.x!==a.x||l.y!==a.y||l.k!==a.k||l.r!==a.r){let u=t.center(),d=Me([a.x,a.y],u),f=Me([l.x,l.y],u),h=a.k/l.k,p=(d[0]/h-f[0])*h,m=(d[1]/h-f[1])*h,g=a.r-l.r;[p,m]=lr([p,m],a.r,[0,0]),fa(this.supersurface,p,m,h,g),fa(this.overlay,-p,-m,1,-g),this._isTempTransformed=!0,this.emit("move")}}_app(){if(!this.textures?.loaded||!this._started||this._paused)return;let e=this.context,t=e.systems.map;if(e.container().classed("resizing"))return;let r=e.viewport,i=this.pixiViewport,s=r.transform,o=i.transform,a=o.translation,l=s.translation,c=Ne(a,l),u;o.k!==s.k||c>1e5?(u=[0,0],i.transform=s,this.scene.dirtyScene()):u=Me(a,l),o.r!==s.r&&(o.rotation=s.r,this.scene.dirtyScene());let d=i.center();this.stage.pivot.set(0,0),this.stage.position.set(d[0],d[1]),this.stage.rotation=s.r,this.origin.position.set(-u[0]-d[0],-u[1]-d[1]);let f=t.effectiveZoom();this.scene.render(this._frame,i,f),this._appPending=!1,this._drawPending=!0}_draw(){let e=this.pixiViewport.dimensions,t=[this.pixi.screen.width,this.pixi.screen.height];if(!He(e,t)){let[r,i]=e,s=this.supersurface;s.style.width=`${r}px`,s.style.height=`${i}px`;let o=this.overlay;o.style.width=`${r}px`,o.style.height=`${i}px`,this.pixi.renderer.resize(r,i)}this.pixi.render(),this._isTempTransformed&&(fa(this.supersurface,0,0,1,0),fa(this.overlay,0,0,1,0),this._isTempTransformed=!1,this.emit("move")),this._prevTransform=this.context.viewport.transform.props,this._timeToNextRender=Ine,this._drawPending=!1,this.emit("draw"),this._frame++}_renderDebug(){let e=this.stage,t=e.getChildByLabel("screen");t||(t=new ze().rect(-5,-5,522,522).fill({color:0,alpha:1}),t.label="screen",t.eventMode="none",t.sortableChildren=!1,t.zIndex=100,e.addChild(t));let r=e.getChildByLabel("debug");r||(r=new At,r.label="debug",r.eventMode="none",r.sortableChildren=!1,r.zIndex=101,r.height=512,r.width=512,e.addChild(r)),r.texture&&r.texture.destroy(),r.texture=this.textures.getDebugTexture("text"),r.position.set(50,-200),t.position.set(50,-200)}_initPixiAsync(){if(this.pixi)return Promise.resolve();let e=this.context.systems.urlhash,t="webgl",r=2;switch(e.initialHashParams.get("renderer")){case"webgpu":t="webgpu";break;case"webgl1":r=1;break}Object.assign(ot.defaultOptions,{autoGarbageCollect:!1,autoGenerateMipmaps:!1,resolution:1}),Object.assign($0.defaultOptions,{renderableGCActive:!1}),Object.assign(Lo.defaultOptions,{hello:!0});let i={antialias:!0,autoDensity:!0,autoStart:!1,canvas:this.surface,events:{move:!1,globalMove:!1,click:!0,wheel:!1},multiView:!0,powerPreference:"high-performance",preference:t,preferWebGLVersion:r,preserveDrawingBuffer:!0,resolution:window.devicePixelRatio,sharedLoader:!0,sharedTicker:!0,textureGCActive:!0,useBackBuffer:!1};return this.pixi=new x3,this.pixi.init(i)}_afterPixiInit(){if(this.scene)return;ro.install({name:"rapid-debug",style:{fill:{color:16777215},fontSize:14,stroke:{color:3355443}},chars:Qi.ASCII,resolution:2}),window.Rapid.isDebug&&(globalThis.__PIXI_APP__=this.pixi,window.__PIXI_DEVTOOLS__={pixi:ir,app:this.pixi});let e=this.pixi.stage;e.label="stage",e.sortableChildren=!0,e.eventMode="static",e.hitArea=new $e(-1e7,-1e7,2e7,2e7),this.stage=e;let t=new we;t.label="origin",t.sortableChildren=!0,t.eventMode="passive",e.addChild(t),this.origin=t;let r=this.pixi.ticker,i=r._head.next;r.remove(i._fn,i._context),r.add(this._tick,this),this.scene=new _b(this),this.events=new Ex(this),AI||(AI=new wb(this)),this.textures=AI}};var Kz=Ot(kp(),1);var Ip=class extends Se{constructor(e){super(e),this.id="imagery",this.dependencies=new Set(["assets","editor","gfx","l10n","map","storage","urlhash"]),this._initPromise=null,this._imageryIndex=null,this._baseLayer=null,this._overlayLayers=new Map,this._checkedBlocklists=[],this._isValid=!0,this._brightness=1,this._contrast=1,this._saturation=1,this._sharpness=1,this._numGridSplits=0,this._hashchange=this._hashchange.bind(this),this._imageryChanged=this._imageryChanged.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let l of this.dependencies)if(!this.context.systems[l])return Promise.reject(`Cannot init:  ${this.id} requires ${l}`);let e=this.context,t=e.systems.assets,r=e.systems.gfx,i=e.systems.map,s=e.systems.storage,o=e.systems.urlhash,a=Promise.all([t.initAsync(),r.initAsync(),i.initAsync(),s.initAsync(),o.initAsync()]);return this._initPromise=a.then(()=>{o.on("hashchange",this._hashchange),r.scene.on("layerchange",this._imageryChanged)}).then(()=>t.loadAssetAsync("imagery")).then(l=>this._initImageryIndex(l)).then(()=>this._initWaybackAsync())}_initImageryIndex(e){let t=this.context,r=e.imagery||[];this._imageryIndex={features:new Map,sources:new Map,query:null};let i=r.map(c=>{if(!c.polygon)return null;let u=c.polygon.map(f=>[f]),d={type:"Feature",properties:{id:c.id},geometry:{type:"MultiPolygon",coordinates:u}};return this._imageryIndex.features.set(c.id.toLowerCase(),d),d}).filter(Boolean);this._imageryIndex.query=(0,Kz.default)({type:"FeatureCollection",features:i});for(let c of r){let u;if(c.type==="bing"?u=new I2(t,c):/^EsriWorldImagery/.test(c.id)?u=new Mc(t,c):u=new $i(t,c),this._imageryIndex.sources.set(c.id.toLowerCase(),u),c.id==="EsriWorldImagery"){let d=Object.assign({},c);d.id="EsriWayback",d.name="Esri Wayback",d.description="Esri Wayback contains archived snapshots of Esri World Imagery created over time.",d.startDate=null,d.endDate=null;let f=new Rm(t,d);this._imageryIndex.sources.set(d.id.toLowerCase(),f)}}let s=new T2(t);this._imageryIndex.sources.set(s.id.toLowerCase(),s);let o=new k2(t),a=this.context.systems.storage;o.template=a.getItem("background-custom-template")||"",this._imageryIndex.sources.set(o.id.toLowerCase(),o);let l=this._imageryIndex.sources.get("mapbox_locator_overlay");l&&this.toggleOverlayLayer(l)}_initWaybackAsync(){let e=this.getSourceByID("EsriWayback");return e?e.initWaybackAsync():Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}_hashchange(e,t){let r=e.get("background"),i=t.get("background");if(!r||r!==i){let c;typeof r=="string"&&(c=this.getSourceByID(r)),c?this.setSourceByID(r):this.baseLayerSource(this.chooseDefaultSource())}let s=e.get("overlays"),o=t.get("overlays");if(s!==o){let c=new Set;if(typeof s=="string"){let u=s.split(",").map(d=>d.trim().toLowerCase()).filter(Boolean);c=new Set(u)}this.enableOverlayLayers(c)}let a=e.get("offset"),l=t.get("offset");if(a!==l){let c,u;typeof a=="string"&&([c,u]=a.replace(/;/g,",").split(",").map(d=>d.trim()).map(Number)),(isNaN(c)||!isFinite(c))&&(c=0),(isNaN(u)||!isFinite(u))&&(u=0),this.offset=rm([c,u])}}_imageryChanged(){let e=this._baseLayer;if(this.context.inIntro||!e)return;let t=e.key;t==="custom"&&(t=`custom:${e.template}`);let r=[];for(let c of this._overlayLayers.values())c.isLocatorOverlay()||r.push(c.id);let i=this.context.systems.urlhash;i.setParam("background",t),i.setParam("overlays",r.length?r.join(","):null);let s=nm(e.offset),o=.01,a=+s[0].toFixed(2),l=+s[1].toFixed(2);i.setParam("offset",Math.abs(a)>o||Math.abs(l)>o?`${a},${l}`:null)}imageryUsed(){let e=new Set,t=this._baseLayer?.imageryUsed;t&&this._isValid&&e.add(t);for(let r of this._overlayLayers.values())r.isLocatorOverlay()||r.imageryUsed&&e.add(r.imageryUsed);return Array.from(e)}visibleSources(){if(!this._imageryIndex)return[];let e=this.context,t=e.viewport,r=t.visibleExtent(),i=t.transform.zoom,s=new Set;(this._imageryIndex.query.bbox(r.rectangle(),!0)||[]).forEach(d=>s.add(d.id));let o=this._baseLayer,a=[...this._imageryIndex.sources.values()],c=e.services.osm?.imageryBlocklists??[];if(c.length!==this._checkedBlocklists.length||c.some((d,f)=>String(d)!==this._checkedBlocklists[f])){for(let d of a)d.isBlocked=c.some(f=>f.test(d.template));this._checkedBlocklists=c.map(d=>String(d))}return a.filter(d=>o===d?!0:d.isBlocked?!1:d.polygon?i&&i<6?!1:s.has(d.id):!0)}baseLayerSource(e){if(!arguments.length)return this._baseLayer;let t=this.context.services.osm;if(!t)return this;let r=t?.imageryBlocklists??[],i=e.template,s=!1,o=0,a;for(a of r)if(s=a.test(i),o++,s)break;return o||(a=/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/,s=a.test(i)),this._baseLayer=s?this.getSourceByID("none"):e,this._imageryChanged(),this.emit("imagerychange"),this}chooseDefaultSource(){let t=this.context.systems.storage,r=this.visibleSources(),i=r[0],s=r.find(l=>l.best),o=t.getItem("background-last-used")||"none",a=o!=="none"&&this.getSourceByID(o);return s||a||this.getSourceByID("Bing")||i||this.getSourceByID("none")}getSourceByID(e){return this._imageryIndex?(/^EsriWayback/i.test(e)&&(e="EsriWayback"),this._imageryIndex.sources.get(e.toLowerCase())):null}setSourceByID(e){if(!this._imageryIndex)return null;let t,r=e.match(/^EsriWayback\_?(.*)$/i);r&&(e="EsriWayback",t=r[1]);let i=this.getSourceByID(e);i&&(t&&(i.date=t),this.baseLayerSource(i))}showsLayer(e){let t=this._baseLayer;return!e||!t?!1:e.id===t.id||this._overlayLayers.has(e.id)}overlayLayerSources(){return[...this._overlayLayers.values()]}toggleOverlayLayer(e){this._overlayLayers.has(e.id)?this._overlayLayers.delete(e.id):this._overlayLayers.set(e.id,e),this._imageryChanged(),this.emit("imagerychange")}enableOverlayLayers(e){for(let[t,r]of this._overlayLayers)r.isLocatorOverlay()||this._overlayLayers.delete(t);for(let t of e){let r=this.getSourceByID(t);r&&this._overlayLayers.set(r.id,r)}this._imageryChanged(),this.emit("imagerychange")}nudge(e,t){if(this._baseLayer){let r=this.context.viewport.transform.zoom;this._baseLayer.nudge(e,r),this._imageryChanged(),this.emit("imagerychange")}}get offset(){return this._baseLayer?.offset||[0,0]}set offset([e,t]=[0,0]){let[r,i]=this._baseLayer?.offset||[0,0];e===r&&t===i||this._baseLayer&&(this._baseLayer.offset=[e,t],this._imageryChanged(),this.emit("imagerychange"))}get brightness(){return this._brightness}set brightness(e=1){if(e===this._brightness)return;this._brightness=e,this.context.systems.gfx.scene.layers.get("background")?.setBrightness(e),this.emit("imagerychange")}get contrast(){return this._contrast}set contrast(e=1){if(e===this._contrast)return;this._contrast=e,this.context.systems.gfx.scene.layers.get("background")?.setContrast(e),this.emit("imagerychange")}get saturation(){return this._saturation}set saturation(e=1){if(e===this._saturation)return;this._saturation=e,this.context.systems.gfx.scene.layers.get("background")?.setSaturation(e),this.emit("imagerychange")}get sharpness(){return this._sharpness}set sharpness(e=1){if(e===this._sharpness)return;this._sharpness=e,this.context.systems.gfx.scene.layers.get("background")?.setSharpness(e),this.emit("imagerychange")}get numGridSplits(){return this._numGridSplits}set numGridSplits(e=0){e!==this._numGridSplits&&(this._numGridSplits=e,this.emit("imagerychange"))}};var Pp=class extends Se{constructor(e){super(e),this.id="l10n",this.dependencies=new Set(["assets","presets","urlhash"]),this._scopes=new Set(["core","tagging","imagery","community"]),this._initPromise=null,this._preferredLocaleCodes=[],this._currLocaleCode="en-US",this._currLocaleCodes=["en-US","en"],this._currLanguageCode="en",this._currTextDirection="ltr",this._currIsMetric=!1,this._currLanguageNames={},this._currScriptNames={},this._languages={},this._locales={},this._cache={},this._hashchange=this._hashchange.bind(this),this._localeChanged=this._localeChanged.bind(this),this.t=this.t.bind(this),this.tHtml=this.tHtml.bind(this),this.tAppend=this.tAppend.bind(this)}localeCode(){return this._currLocaleCode}localeCodes(){return this._currLocaleCodes}languageCode(){return this._currLanguageCode}textDirection(){return this._currTextDirection}isMetric(){return this._currIsMetric}languageNames(){return this._currLanguageNames}scriptNames(){return this._currScriptNames}isRTL(){return this._currTextDirection==="rtl"}set preferredLocaleCodes(e){typeof e=="string"?this._preferredLocaleCodes=e.split(/,|;| /gi).filter(Boolean):this._preferredLocaleCodes=e||[]}get preferredLocaleCodes(){return this._preferredLocaleCodes}initAsync(){if(this._initPromise)return this._initPromise;for(let i of this.dependencies)if(!this.context.systems[i])return Promise.reject(`Cannot init:  ${this.id} requires ${i}`);let e=this.context.systems.assets,t=this.context.systems.urlhash,r=Promise.all([e.initAsync(),t.initAsync()]);return this._initPromise=r.then(()=>Promise.all([e.loadAssetAsync("languages"),e.loadAssetAsync("locales")])).then(i=>(this._languages=i[0].languages,this._locales=i[1].locales,t.on("hashchange",this._hashchange),this.selectLocaleAsync())).catch(i=>console.error(i))}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}selectLocaleAsync(){let t=this.context.systems.urlhash.getParam("locale"),r=[];typeof t=="string"&&(r=t.split(",").map(o=>o.trim()).filter(Boolean));let i=(this._preferredLocaleCodes||[]).concat(r).concat(Et().locales).concat(["en"]);this._currLocaleCodes=this._getSupportedLocales(i),this._currLocaleCode=this._currLocaleCodes[0];let s=this._currLocaleCodes.map(o=>this._loadStringsAsync(o));return Promise.all(s).then(()=>this._localeChanged())}_loadStringsAsync(e){e.toLowerCase()==="en-us"&&(e="en");let t=this._cache;if(t[e])return Promise.resolve();t[e]={};let r=this.context.systems.assets,i=r.origin,s=r.sources[i];if(!s)return Promise.reject(`Unknown origin "${i}"`);let o=[];for(let a of this._scopes){let l=`l10n_${a}_${e}`;s[l]||(s[l]=`data/l10n/${a}.${e}.min.json`);let c=r.loadAssetAsync(l).then(u=>{t[e][a]=u[e]});o.push(c)}return Promise.allSettled(o)}_hashchange(e,t){let r=this.context.systems.urlhash,i=e.get("rtl"),s=t.get("rtl");if(i!==s){let l=null;typeof i=="string"&&(l=i.trim().toLowerCase(),l!=="true"&&l!=="false"&&(l=null)),r.setParam("rtl",l),this._localeChanged()}let o=e.get("locale"),a=t.get("locale");if(o!==a){let l=[];if(typeof o=="string"){let c=o.split(",").map(u=>u.trim()).filter(Boolean);l=this._getSupportedLocales(c)}r.setParam("locale",l.length?l.join(","):null),this.selectLocaleAsync()}}pluralRule(e,t=this._currLocaleCode){let r="Intl"in window&&Intl.PluralRules&&new Intl.PluralRules(t);return r?r.select(e):e===1?"one":"other"}_resolveString(e,t,r){Array.isArray(r)||(r=this._currLocaleCodes.slice());let i=r.shift(),s=i;i.toLowerCase()==="en-us"&&(s="en");let o=e.trim(),a="core";if(o[0]==="_"){let d=o.split(".");a=d[0].slice(1),o=d.slice(1).join(".")}let l=o.split(".").map(d=>d.replace(/<TX_DOT>/g,".")).reverse(),c=this._cache[s]&&this._cache[s][a];for(;c!==void 0&&l.length;)c=c[l.pop()];if(c!==void 0){if(t){if(typeof c=="object"&&Object.keys(c).length){let d=Object.values(t).find(f=>typeof f=="number");if(d!==void 0){let f=this.pluralRule(d,i);c[f]?c=c[f]:c=Object.values(c)[0]}}if(typeof c=="string")for(let d in t){let f=t[d];typeof f=="number"&&(f.toLocaleString?f=f.toLocaleString(i,{style:"decimal",useGrouping:!0,minimumFractionDigits:0}):f=f.toString());let h=`{${d}}`,p=new RegExp(h,"g");c=c.replace(p,f)}}if(typeof c=="string")return{text:c,locale:i}}if(r.length)return this._resolveString(e,t,r);if(t&&"default"in t)return{text:t.default,locale:null};let u=`Missing ${i} translation: ${e}`;return typeof console<"u"&&console.error(u),{text:u,locale:"en"}}hasTextForStringID(e){return!!this._resolveString(e,{default:"nothing found"}).locale}t(e,t,r){let i=null;return typeof r=="string"?i=[r]:Array.isArray(r)&&(i=r),this._resolveString(e,t,i).text}tHtml(e,t,r){let i=null;typeof r=="string"?i=[r]:Array.isArray(r)&&(i=r);let s=this._resolveString(e,t,i);return s.text?this.htmlForLocalizedText(s.text,s.locale):""}tAppend(e,t,r){let i=null;typeof r=="string"?i=[r]:Array.isArray(r)&&(i=r);let s=function(o){let a=this._resolveString(e,t,i);return o.append("span").attr("class","localized-text").attr("lang",a.locale||"und").text((t?.prefix||"")+a.text+(t?.suffix||""))};return s.stringID=e,s}htmlForLocalizedText(e,t){return`<span class="localized-text" lang="${t||"unknown"}">${e}</span>`}languageName(e,t){if(this._currLanguageNames[e])return this._currLanguageNames[e];if(t&&t.localOnly)return null;let r=this._languages[e];if(r){if(r.nativeName)return this.t("translate.language_and_code",{language:r.nativeName,code:e});if(r.base&&r.script){let i=r.base;if(this._currLanguageNames[i]){let s=r.script,o=this._currScriptNames[s]||s;return this.t("translate.language_and_code",{language:this._currLanguageNames[i],code:o})}else if(this._languages[i]&&this._languages[i].nativeName)return this.t("translate.language_and_code",{language:this._languages[i].nativeName,code:e})}}return e}displayName(e,t){let r=this._currLanguageCode.toLowerCase(),i=e.route,s=e[`name:${r}`]??e.name??"",o={name:s,direction:e.direction,from:e.from,network:t?void 0:e.cycle_network??e.network,ref:e.ref,to:e.to,via:e.via};if(i&&o.ref&&o.name)return o.network?this.t("inspector.display_name.network_ref_name",o):this.t("inspector.display_name.ref_name",o);if(s)return s;let a=[];return o.network&&a.push("network"),o.ref&&a.push("ref"),i&&(o.direction?a.push("direction"):o.from&&o.to&&(a.push("from"),a.push("to"),o.via&&a.push("via"))),a.length?this.t("inspector.display_name."+a.join("_"),o):""}displayPOIName(e){let t=this._currLanguageCode.toLowerCase();return e[`name:${t}`]??e.name??e[`brand:${t}`]??e.brand??e[`operator:${t}`]??e.operator??""}displayType(e){return{n:this.t("inspector.node"),w:this.t("inspector.way"),r:this.t("inspector.relation")}[e.charAt(0)]}displayLabel(e,t,r){let i=this.displayName(e.tags),s=this.context.systems.presets,o=typeof t=="string"?s.matchTags(e.tags,t):s.match(e,t),a=o&&(o.suggestion?o.subtitle():o.name()),l;return r?l=[a,i].filter(Boolean).join(" "):l=i||a,l??this.displayType(e.id)}displayLength(e,t){let r=this._currLocaleCode,i=e*(t?3.28084:1),s;return t?i>=5280?(i/=5280,s="miles"):s="feet":i>=1e3?(i/=1e3,s="kilometers"):s="meters",this.t(`units.${s}`,{quantity:i.toLocaleString(r,{maximumSignificantDigits:4})})}displayArea(e,t){let r=this._currLocaleCode,i=e*(t?10.7639111056:1),s,o,a,l;t?(i>=6969600?(s=i/27878400,a="square_miles"):(s=i,a="square_feet"),i>4356&&i<4356e4&&(o=i/43560,l="acres")):(i>=25e4?(s=i/1e6,a="square_kilometers"):(s=i,a="square_meters"),i>1e3&&i<1e7&&(o=i/1e4,l="hectares"));let c=this.t(`units.${a}`,{quantity:s.toLocaleString(r,{maximumSignificantDigits:4})});if(l){let u=this.t(`units.${l}`,{quantity:o.toLocaleString(r,{maximumSignificantDigits:2})});return this.t("units.area_pair",{area1:c,area2:u})}else return c}dmsCoordinatePair(e){return this.t("units.coordinate_pair",{latitude:this._displayCoordinate(dt(e[1],-90,90),"north","south"),longitude:this._displayCoordinate(Qt(e[0],-180,180),"east","west")})}dmsMatcher(e){let t,r=/^\s*(-?)\s*(\d+)\s+(\d+)\s+(\d+\.?\d*)\s*\,\s*(-?)\s*(\d+)\s+(\d+)\s+(\d+\.?\d*)\s*$/;if(t=e.match(r),t){let s=+t[2]+ +t[3]/60+ +t[4]/3600,o=+t[6]+ +t[7]/60+ +t[8]/3600;return t[1]==="-"&&(s*=-1),t[5]==="-"&&(o*=-1),[s,o]}let i=/^\s*(-?)\s*(\d+)\s+(\d+\.?\d*)\s*\,\s*(-?)\s*(\d+)\s+(\d+\.?\d*)\s*$/;if(t=e.match(i),t){let s=+t[2]+ +t[3]/60,o=+t[5]+ +t[6]/60;return t[1]==="-"&&(s*=-1),t[4]==="-"&&(o*=-1),[s,o]}return null}decimalCoordinatePair(e){return this.t("units.coordinate_pair",{latitude:dt(e[1],-90,90).toFixed(7),longitude:Qt(e[0],-180,180).toFixed(7)})}_displayCoordinate(e,t,r){let s=this._currLocaleCode,o=(Math.abs(e)-Math.floor(Math.abs(e)))*60,a=(o-Math.floor(o))*60;a=+a.toFixed(8);let l=this.t("units.arcdegrees",{quantity:Math.floor(Math.abs(e)).toLocaleString(s)}),c;return Math.abs(a)>.01?c=l+this.t("units.arcminutes",{quantity:Math.floor(o).toLocaleString(s)})+this.t("units.arcseconds",{quantity:Math.round(a).toLocaleString(s)}):Math.abs(o)>.01?c=l+this.t("units.arcminutes",{quantity:Math.round(o).toLocaleString(s)}):c=l,e===0?c:this.t("units.coordinate",{coordinate:c,direction:this.t("units."+(e>0?t:r))})}_getSupportedLocales(e){let t=new Set;for(let r of e){if(!r)continue;let i=r.replace(/_/g,"-"),[s,o]=i.split("-",2);s=s.toLowerCase(),i=s,o&&(o=o.toUpperCase(),i=i+"-"+o),(this._locales[i]||i==="en-US")&&t.add(i),o&&this._locales[s]&&t.add(s)}return Array.from(t)}_localeChanged(){this._currLocaleCode||(this._currLocaleCode="en-US",this._currLocaleCodes=["en-US","en"]);let[e,t]=this._currLocaleCode.toLowerCase().split("-",2);this._currLanguageCode=e,this._currIsMetric=t!=="us";let i=this.context.systems.urlhash.getParam("rtl");if(i==="true")this._currTextDirection="rtl";else if(i==="false")this._currTextDirection="ltr";else{let f=this._locales[this._currLocaleCode]||this._locales[this._currLanguageCode];this._currTextDirection=f&&f.rtl?"rtl":"ltr"}let s=this._currLocaleCode;s.toLowerCase()==="en-us"&&(s="en");let o=this._cache[s].core.languageNames??{},a=this._cache[e].core.languageNames??{},l=this._cache.en.core.languageNames??{};this._currLanguageNames=Object.assign({},l,a,o);let c=this._cache[s].core.scriptNames??{},u=this._cache[e].core.scriptNames??{},d=this._cache.en.core.scriptNames??{};this._currScriptNames=Object.assign({},d,u,c),this.emit("localechange")}};var Qz=Ot(kp(),1),Gne={type:"FeatureCollection",features:[{type:"Feature",properties:{wikidata:"Q21",nameEn:"England",aliases:["GB-ENG"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-6.03913,51.13217],[-7.74976,48.64773],[1.17405,50.74239],[2.18458,51.52087],[2.56575,51.85301],[.792,57.56437],[-2.30613,55.62698],[-2.17058,55.45916],[-2.6095,55.28488],[-2.63532,55.19452],[-3.02906,55.04606],[-3.09361,54.94924],[-3.38407,54.94278],[-4.1819,54.57861],[-3.5082,53.54318],[-3.08228,53.25526],[-3.03675,53.25092],[-2.92329,53.19383],[-2.92022,53.17685],[-2.98598,53.15589],[-2.90649,53.10964],[-2.87469,53.12337],[-2.89131,53.09374],[-2.83133,52.99184],[-2.7251,52.98389],[-2.72221,52.92969],[-2.80549,52.89428],[-2.85897,52.94487],[-2.92401,52.93836],[-2.97243,52.9651],[-3.13576,52.895],[-3.15744,52.84947],[-3.16105,52.79599],[-3.08734,52.77504],[-3.01001,52.76636],[-2.95581,52.71794],[-3.01724,52.72083],[-3.04398,52.65435],[-3.13648,52.58208],[-3.12926,52.5286],[-3.09746,52.53077],[-3.08662,52.54811],[-3.00929,52.57774],[-2.99701,52.551],[-3.03603,52.49969],[-3.13359,52.49174],[-3.22971,52.45344],[-3.22754,52.42526],[-3.04687,52.34504],[-2.95364,52.3501],[-2.99701,52.323],[-3.00785,52.2753],[-3.09289,52.20546],[-3.12638,52.08114],[-2.97111,51.90456],[-2.8818,51.93196],[-2.78742,51.88833],[-2.74277,51.84367],[-2.66234,51.83555],[-2.66336,51.59504],[-3.20563,51.31615],[-6.03913,51.13217]]]]}},{type:"Feature",properties:{wikidata:"Q22",nameEn:"Scotland",aliases:["GB-SCT"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[.792,57.56437],[-.3751,61.32236],[-14.78497,57.60709],[-6.82333,55.83103],[-4.69044,54.3629],[-3.38407,54.94278],[-3.09361,54.94924],[-3.02906,55.04606],[-2.63532,55.19452],[-2.6095,55.28488],[-2.17058,55.45916],[-2.30613,55.62698],[.792,57.56437]]]]}},{type:"Feature",properties:{wikidata:"Q25",nameEn:"Wales",aliases:["GB-WLS"],country:"GB",groups:["Q23666","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-3.5082,53.54318],[-5.37267,53.63269],[-6.03913,51.13217],[-3.20563,51.31615],[-2.66336,51.59504],[-2.66234,51.83555],[-2.74277,51.84367],[-2.78742,51.88833],[-2.8818,51.93196],[-2.97111,51.90456],[-3.12638,52.08114],[-3.09289,52.20546],[-3.00785,52.2753],[-2.99701,52.323],[-2.95364,52.3501],[-3.04687,52.34504],[-3.22754,52.42526],[-3.22971,52.45344],[-3.13359,52.49174],[-3.03603,52.49969],[-2.99701,52.551],[-3.00929,52.57774],[-3.08662,52.54811],[-3.09746,52.53077],[-3.12926,52.5286],[-3.13648,52.58208],[-3.04398,52.65435],[-3.01724,52.72083],[-2.95581,52.71794],[-3.01001,52.76636],[-3.08734,52.77504],[-3.16105,52.79599],[-3.15744,52.84947],[-3.13576,52.895],[-2.97243,52.9651],[-2.92401,52.93836],[-2.85897,52.94487],[-2.80549,52.89428],[-2.72221,52.92969],[-2.7251,52.98389],[-2.83133,52.99184],[-2.89131,53.09374],[-2.87469,53.12337],[-2.90649,53.10964],[-2.98598,53.15589],[-2.92022,53.17685],[-2.92329,53.19383],[-3.03675,53.25092],[-3.08228,53.25526],[-3.5082,53.54318]]]]}},{type:"Feature",properties:{wikidata:"Q26",nameEn:"Northern Ireland",aliases:["GB-NIR"],country:"GB",groups:["Q22890","Q3336843","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44"]},geometry:{type:"MultiPolygon",coordinates:[[[[-6.34755,55.49206],[-7.2471,55.06933],[-7.34464,55.04688],[-7.4033,55.00391],[-7.40004,54.94498],[-7.44404,54.9403],[-7.4473,54.87003],[-7.47626,54.83084],[-7.54508,54.79401],[-7.54671,54.74606],[-7.64449,54.75265],[-7.75041,54.7103],[-7.83352,54.73854],[-7.93293,54.66603],[-7.70315,54.62077],[-7.8596,54.53671],[-7.99812,54.54427],[-8.04538,54.48941],[-8.179,54.46763],[-8.04555,54.36292],[-7.87101,54.29299],[-7.8596,54.21779],[-7.81397,54.20159],[-7.69501,54.20731],[-7.55812,54.12239],[-7.4799,54.12239],[-7.44567,54.1539],[-7.32834,54.11475],[-7.30553,54.11869],[-7.34005,54.14698],[-7.29157,54.17191],[-7.28017,54.16714],[-7.29687,54.1354],[-7.29493,54.12013],[-7.26316,54.13863],[-7.25012,54.20063],[-7.14908,54.22732],[-7.19145,54.31296],[-7.02034,54.4212],[-6.87775,54.34682],[-6.85179,54.29176],[-6.81583,54.22791],[-6.74575,54.18788],[-6.70175,54.20218],[-6.6382,54.17071],[-6.66264,54.0666],[-6.62842,54.03503],[-6.47849,54.06947],[-6.36605,54.07234],[-6.36279,54.11248],[-6.32694,54.09337],[-6.29003,54.11278],[-6.26218,54.09785],[-5.83481,53.87749],[-4.69044,54.3629],[-6.34755,55.49206]]]]}},{type:"Feature",properties:{wikidata:"Q35",nameEn:"Denmark",country:"DK",groups:["EU","154","150","UN"],callingCodes:["45"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.16597,56.60205],[10.40861,58.38489],[7.28637,57.35913],[8.02459,55.09613],[8.45719,55.06747],[8.55769,54.91837],[8.63979,54.91069],[8.76387,54.8948],[8.81178,54.90518],[8.92795,54.90452],[9.04629,54.87249],[9.14275,54.87421],[9.20571,54.85841],[9.24631,54.84726],[9.23445,54.83432],[9.2474,54.8112],[9.32771,54.80602],[9.33849,54.80233],[9.36496,54.81749],[9.38532,54.83968],[9.41213,54.84254],[9.43155,54.82586],[9.4659,54.83131],[9.58937,54.88785],[9.62734,54.88057],[9.61187,54.85548],[9.73563,54.8247],[9.89314,54.84171],[10.16755,54.73883],[10.31111,54.65968],[11.00303,54.63689],[11.90309,54.38543],[12.85844,54.82438],[13.93395,54.84044],[15.36991,54.73263],[15.79951,55.54655],[14.89259,55.5623],[14.28399,55.1553],[12.84405,55.13257],[12.60345,55.42675],[12.88472,55.63369],[12.6372,55.91371],[12.65312,56.04345],[12.07466,56.29488],[12.16597,56.60205]]]]}},{type:"Feature",properties:{wikidata:"Q55",nameEn:"Netherlands",country:"NL",groups:["EU","155","150","UN"],callingCodes:["31"]},geometry:{type:"MultiPolygon",coordinates:[[[[5.45168,54.20039],[2.56575,51.85301],[3.36263,51.37112],[3.38696,51.33436],[3.35847,51.31572],[3.38289,51.27331],[3.41704,51.25933],[3.43488,51.24135],[3.52698,51.2458],[3.51502,51.28697],[3.58939,51.30064],[3.78999,51.25766],[3.78783,51.2151],[3.90125,51.20371],[3.97889,51.22537],[4.01957,51.24504],[4.05165,51.24171],[4.16721,51.29348],[4.24024,51.35371],[4.21923,51.37443],[4.33265,51.37687],[4.34086,51.35738],[4.39292,51.35547],[4.43777,51.36989],[4.38064,51.41965],[4.39747,51.43316],[4.38122,51.44905],[4.47736,51.4778],[4.5388,51.48184],[4.54675,51.47265],[4.52846,51.45002],[4.53521,51.4243],[4.57489,51.4324],[4.65442,51.42352],[4.72935,51.48424],[4.74578,51.48937],[4.77321,51.50529],[4.78803,51.50284],[4.84139,51.4799],[4.82409,51.44736],[4.82946,51.4213],[4.78314,51.43319],[4.76577,51.43046],[4.77229,51.41337],[4.78941,51.41102],[4.84988,51.41502],[4.90016,51.41404],[4.92152,51.39487],[5.00393,51.44406],[5.0106,51.47167],[5.03281,51.48679],[5.04774,51.47022],[5.07891,51.4715],[5.10456,51.43163],[5.07102,51.39469],[5.13105,51.34791],[5.13377,51.31592],[5.16222,51.31035],[5.2002,51.32243],[5.24244,51.30495],[5.22542,51.26888],[5.23814,51.26064],[5.26461,51.26693],[5.29716,51.26104],[5.33886,51.26314],[5.347,51.27502],[5.41672,51.26248],[5.4407,51.28169],[5.46519,51.2849],[5.48476,51.30053],[5.515,51.29462],[5.5569,51.26544],[5.5603,51.22249],[5.65145,51.19788],[5.65528,51.18736],[5.70344,51.1829],[5.74617,51.18928],[5.77735,51.17845],[5.77697,51.1522],[5.82564,51.16753],[5.85508,51.14445],[5.80798,51.11661],[5.8109,51.10861],[5.83226,51.10585],[5.82921,51.09328],[5.79903,51.09371],[5.79835,51.05834],[5.77258,51.06196],[5.75961,51.03113],[5.77688,51.02483],[5.76242,50.99703],[5.71864,50.96092],[5.72875,50.95428],[5.74752,50.96202],[5.75927,50.95601],[5.74644,50.94723],[5.72545,50.92312],[5.72644,50.91167],[5.71626,50.90796],[5.69858,50.91046],[5.67886,50.88142],[5.64504,50.87107],[5.64009,50.84742],[5.65259,50.82309],[5.70118,50.80764],[5.68995,50.79641],[5.70107,50.7827],[5.68091,50.75804],[5.69469,50.75529],[5.72216,50.76398],[5.73904,50.75674],[5.74356,50.7691],[5.76533,50.78159],[5.77513,50.78308],[5.80673,50.7558],[5.84548,50.76542],[5.84888,50.75448],[5.88734,50.77092],[5.89129,50.75125],[5.89132,50.75124],[5.95942,50.7622],[5.97545,50.75441],[6.01976,50.75398],[6.02624,50.77453],[5.97497,50.79992],[5.98404,50.80988],[6.00462,50.80065],[6.02328,50.81694],[6.01921,50.84435],[6.05623,50.8572],[6.05702,50.85179],[6.07431,50.84674],[6.07693,50.86025],[6.08805,50.87223],[6.07486,50.89307],[6.09297,50.92066],[6.01615,50.93367],[6.02697,50.98303],[5.95282,50.98728],[5.90296,50.97356],[5.90493,51.00198],[5.87849,51.01969],[5.86735,51.05182],[5.9134,51.06736],[5.9541,51.03496],[5.98292,51.07469],[6.16706,51.15677],[6.17384,51.19589],[6.07889,51.17038],[6.07889,51.24432],[6.16977,51.33169],[6.22674,51.36135],[6.22641,51.39948],[6.20654,51.40049],[6.21724,51.48568],[6.18017,51.54096],[6.09055,51.60564],[6.11759,51.65609],[6.02767,51.6742],[6.04091,51.71821],[5.95003,51.7493],[5.98665,51.76944],[5.94568,51.82786],[5.99848,51.83195],[6.06705,51.86136],[6.10337,51.84829],[6.16902,51.84094],[6.11551,51.89769],[6.15349,51.90439],[6.21443,51.86801],[6.29872,51.86801],[6.30593,51.84998],[6.40704,51.82771],[6.38815,51.87257],[6.47179,51.85395],[6.50231,51.86313],[6.58556,51.89386],[6.68386,51.91861],[6.72319,51.89518],[6.82357,51.96711],[6.83035,51.9905],[6.68128,52.05052],[6.76117,52.11895],[6.83984,52.11728],[6.97189,52.20329],[6.9897,52.2271],[7.03729,52.22695],[7.06365,52.23789],[7.02703,52.27941],[7.07044,52.37805],[7.03417,52.40237],[6.99041,52.47235],[6.94293,52.43597],[6.69507,52.488],[6.71641,52.62905],[6.77307,52.65375],[7.04557,52.63318],[7.07253,52.81083],[7.21694,53.00742],[7.17898,53.13817],[7.22681,53.18165],[7.21679,53.20058],[7.19052,53.31866],[7.00198,53.32672],[6.91025,53.44221],[5.45168,54.20039]],[[4.93295,51.44945],[4.95244,51.45207],[4.9524,51.45014],[4.93909,51.44632],[4.93295,51.44945]],[[4.91493,51.4353],[4.91935,51.43634],[4.92227,51.44252],[4.91811,51.44621],[4.92287,51.44741],[4.92811,51.4437],[4.92566,51.44273],[4.92815,51.43856],[4.92879,51.44161],[4.93544,51.44634],[4.94025,51.44193],[4.93416,51.44185],[4.93471,51.43861],[4.94265,51.44003],[4.93986,51.43064],[4.92952,51.42984],[4.92652,51.43329],[4.91493,51.4353]]]]}},{type:"Feature",properties:{wikidata:"Q782",nameEn:"Hawaii",aliases:["US-HI"],country:"US",groups:["Q35657","061","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-177.8563,29.18961],[-179.49839,27.86265],[-151.6784,9.55515],[-154.05867,45.51124],[-177.5224,27.7635],[-177.8563,29.18961]]]]}},{type:"Feature",properties:{wikidata:"Q797",nameEn:"Alaska",aliases:["US-AK"],country:"US",groups:["Q35657","021","003","019","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.34848,52.47228],[180,51.0171],[179.84401,55.10087],[169.34848,52.47228]]],[[[-168.95635,65.98512],[-169.03888,65.48473],[-172.76104,63.77445],[-179.55295,57.62081],[-179.55295,50.81807],[-133.92876,54.62289],[-130.61931,54.70835],[-130.64499,54.76912],[-130.44184,54.85377],[-130.27203,54.97174],[-130.18765,55.07744],[-130.08035,55.21556],[-129.97513,55.28029],[-130.15373,55.74895],[-130.00857,55.91344],[-130.00093,56.00325],[-130.10173,56.12178],[-130.33965,56.10849],[-130.77769,56.36185],[-131.8271,56.62247],[-133.38523,58.42773],[-133.84645,58.73543],[-134.27175,58.8634],[-134.48059,59.13231],[-134.55699,59.1297],[-134.7047,59.2458],[-135.00267,59.28745],[-135.03069,59.56208],[-135.48007,59.79937],[-136.31566,59.59083],[-136.22381,59.55526],[-136.33727,59.44466],[-136.47323,59.46617],[-136.52365,59.16752],[-136.82619,59.16198],[-137.4925,58.89415],[-137.60623,59.24465],[-138.62145,59.76431],[-138.71149,59.90728],[-139.05365,59.99655],[-139.20603,60.08896],[-139.05831,60.35205],[-139.68991,60.33693],[-139.98024,60.18027],[-140.45648,60.30919],[-140.5227,60.22077],[-141.00116,60.30648],[-140.97446,84.39275],[-168.25765,71.99091],[-168.95635,65.98512]]]]}},{type:"Feature",properties:{wikidata:"Q3492",nameEn:"Sumatra",aliases:["ID-SM"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[109.82788,2.86812],[110.90339,7.52694],[105.01437,3.24936],[104.56723,1.44271],[104.34728,1.33529],[104.12282,1.27714],[104.03085,1.26954],[103.74084,1.12902],[103.66049,1.18825],[103.56591,1.19719],[103.03657,1.30383],[96.11174,6.69841],[74.28481,-3.17525],[102.92489,-8.17146],[106.32259,-5.50116],[106.38511,-5.16715],[109.17017,-4.07401],[109.3962,-2.07276],[108.50935,-2.01066],[107.94791,1.06924],[109.82788,2.86812]]]]}},{type:"Feature",properties:{wikidata:"Q3757",nameEn:"Java",aliases:["ID-JW"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[109.17017,-4.07401],[106.38511,-5.16715],[106.32259,-5.50116],[102.92489,-8.17146],[116.22542,-10.49172],[114.39575,-8.2889],[114.42235,-8.09762],[114.92859,-7.49253],[116.33992,-7.56171],[116.58433,-5.30385],[109.17017,-4.07401]]]]}},{type:"Feature",properties:{wikidata:"Q3795",nameEn:"Kalimantan",aliases:["ID-KA"],country:"ID",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[120.02464,2.83703],[118.06469,4.16638],[117.67641,4.16535],[117.47313,4.18857],[117.25801,4.35108],[115.90217,4.37708],[115.58276,3.93499],[115.53713,3.14776],[115.11343,2.82879],[115.1721,2.49671],[114.80706,2.21665],[114.80706,1.92351],[114.57892,1.5],[114.03788,1.44787],[113.64677,1.23933],[113.01448,1.42832],[113.021,1.57819],[112.48648,1.56516],[112.2127,1.44135],[112.15679,1.17004],[111.94553,1.12016],[111.82846,.99349],[111.55434,.97864],[111.22979,1.08326],[110.62374,.873],[110.49182,.88088],[110.35354,.98869],[109.66397,1.60425],[109.66397,1.79972],[109.57923,1.80624],[109.53794,1.91771],[109.62558,1.99182],[109.82788,2.86812],[107.94791,1.06924],[108.50935,-2.01066],[109.3962,-2.07276],[109.17017,-4.07401],[116.58433,-5.30385],[120.02464,2.83703]]]]}},{type:"Feature",properties:{wikidata:"Q3803",nameEn:"Lesser Sunda Islands",aliases:["ID-NU"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[116.96967,-8.01483],[114.92859,-7.49253],[114.42235,-8.09762],[114.39575,-8.2889],[116.22542,-10.49172],[122.14954,-11.52517],[125.68138,-9.85176],[125.09025,-9.46406],[124.97892,-9.19281],[125.04044,-9.17093],[125.09434,-9.19669],[125.18907,-9.16434],[125.18632,-9.03142],[125.11764,-8.96359],[124.97742,-9.08128],[124.94011,-8.85617],[124.46701,-9.13002],[124.45971,-9.30263],[124.38554,-9.3582],[124.35258,-9.43002],[124.3535,-9.48493],[124.28115,-9.50453],[124.28115,-9.42189],[124.21247,-9.36904],[124.14517,-9.42324],[124.10539,-9.41206],[124.04286,-9.34243],[124.04628,-9.22671],[124.33472,-9.11416],[124.92337,-8.75859],[125.87688,-7.49892],[116.96967,-8.01483]]]]}},{type:"Feature",properties:{wikidata:"Q3812",nameEn:"Sulawesi",aliases:["ID-SL"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[128.34321,3.90322],[126.69413,6.02692],[119.56457,.90759],[116.58433,-5.30385],[116.33992,-7.56171],[116.96967,-8.01483],[125.87688,-7.49892],[123.78965,-.86805],[128.34321,3.90322]]]]}},{type:"Feature",properties:{wikidata:"Q3827",nameEn:"Maluku Islands",aliases:["ID-ML"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[129.63187,2.21409],[128.34321,3.90322],[123.78965,-.86805],[125.87688,-7.49892],[125.58506,-7.95311],[125.87691,-8.31789],[127.42116,-8.22471],[127.55165,-9.05052],[135.49042,-9.2276],[135.35517,-5.01442],[132.8312,-4.70282],[130.8468,-2.61103],[128.40647,-2.30349],[129.71519,-.24692],[129.63187,2.21409]]]]}},{type:"Feature",properties:{wikidata:"Q3845",nameEn:"Western New Guinea",aliases:["ID-PP"],country:"ID",groups:["035","142","UN"],driveSide:"left",callingCodes:["62"]},geometry:{type:"MultiPolygon",coordinates:[[[[135.49042,-9.2276],[141.01842,-9.35091],[141.01763,-6.90181],[140.90448,-6.85033],[140.85295,-6.72996],[140.99813,-6.3233],[141.02352,.08993],[129.63187,2.21409],[129.71519,-.24692],[128.40647,-2.30349],[130.8468,-2.61103],[132.8312,-4.70282],[135.35517,-5.01442],[135.49042,-9.2276]]]]}},{type:"Feature",properties:{wikidata:"Q5765",nameEn:"Balearic Islands",aliases:["ES-IB"],country:"ES",groups:["EU","039","150","UN"],callingCodes:["34 971"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.27707,35.35051],[5.10072,39.89531],[3.75438,42.33445],[-2.27707,35.35051]]]]}},{type:"Feature",properties:{wikidata:"Q5823",nameEn:"Ceuta",aliases:["ES-CE"],country:"ES",groups:["EA","EU","015","002","UN"],level:"subterritory",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.38491,35.92591],[-5.37338,35.88417],[-5.35844,35.87375],[-5.34379,35.8711],[-5.21179,35.90091],[-5.38491,35.92591]]]]}},{type:"Feature",properties:{wikidata:"Q5831",nameEn:"Melilla",aliases:["ES-ML"],country:"ES",groups:["EA","EU","015","002","UN"],level:"subterritory",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.91909,35.33927],[-2.96038,35.31609],[-2.96648,35.30475],[-2.96978,35.29459],[-2.97035,35.28852],[-2.96507,35.28801],[-2.96826,35.28296],[-2.96516,35.27967],[-2.95431,35.2728],[-2.95065,35.26576],[-2.93893,35.26737],[-2.92272,35.27509],[-2.91909,35.33927]]]]}},{type:"Feature",properties:{wikidata:"Q7835",nameEn:"Crimea",country:"RU",groups:["151","150","UN"],level:"subterritory",callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.5,44],[36.4883,45.0488],[36.475,45.2411],[36.5049,45.3136],[36.6545,45.3417],[36.6645,45.4514],[35.0498,45.7683],[34.9601,45.7563],[34.7991,45.8101],[34.8015,45.9005],[34.7548,45.907],[34.6668,45.9714],[34.6086,45.9935],[34.5589,45.9935],[34.5201,45.951],[34.4873,45.9427],[34.4415,45.9599],[34.4122,46.0025],[34.3391,46.0611],[34.2511,46.0532],[34.181,46.068],[34.1293,46.1049],[34.0731,46.1177],[34.0527,46.1084],[33.9155,46.1594],[33.8523,46.1986],[33.7972,46.2048],[33.7405,46.1855],[33.646,46.2303],[33.6152,46.2261],[33.6385,46.1415],[33.6147,46.1356],[33.5732,46.1032],[33.5909,46.0601],[33.5597,46.0307],[31.5,45.5],[33.5,44]]]]}},{type:"Feature",properties:{wikidata:"Q12837",nameEn:"Iberia",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q14056",nameEn:"Jan Mayen",aliases:["NO-22"],country:"NO",groups:["SJ","154","150","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-9.18243,72.23144],[-10.71459,70.09565],[-5.93364,70.76368],[-9.18243,72.23144]]]]}},{type:"Feature",properties:{wikidata:"Q19188",nameEn:"Mainland China",country:"CN",groups:["030","142","UN"],callingCodes:["86"]},geometry:{type:"MultiPolygon",coordinates:[[[[125.6131,53.07229],[125.17522,53.20225],[124.46078,53.21881],[123.86158,53.49391],[123.26989,53.54843],[122.85966,53.47395],[122.35063,53.49565],[121.39213,53.31888],[120.85633,53.28499],[120.0451,52.7359],[120.04049,52.58773],[120.46454,52.63811],[120.71673,52.54099],[120.61346,52.32447],[120.77337,52.20805],[120.65907,51.93544],[120.10963,51.671],[119.13553,50.37412],[119.38598,50.35162],[119.27996,50.13348],[119.11003,50.00276],[118.61623,49.93809],[117.82343,49.52696],[117.48208,49.62324],[117.27597,49.62544],[116.71193,49.83813],[116.03781,48.87014],[116.06565,48.81716],[115.78876,48.51781],[115.811,48.25699],[115.52082,48.15367],[115.57128,47.91988],[115.94296,47.67741],[116.21879,47.88505],[116.4465,47.83662],[116.67405,47.89039],[116.9723,47.87285],[117.37875,47.63627],[117.50181,47.77216],[117.80196,48.01661],[118.03676,48.00982],[118.11009,48.04],[118.22677,48.03853],[118.29654,48.00246],[118.55766,47.99277],[118.7564,47.76947],[119.12343,47.66458],[119.13995,47.53997],[119.35892,47.48104],[119.31964,47.42617],[119.54918,47.29505],[119.56019,47.24874],[119.62403,47.24575],[119.71209,47.19192],[119.85518,46.92196],[119.91242,46.90091],[119.89261,46.66423],[119.80455,46.67631],[119.77373,46.62947],[119.68127,46.59015],[119.65265,46.62342],[119.42827,46.63783],[119.32827,46.61433],[119.24978,46.64761],[119.10448,46.65516],[119.00541,46.74273],[118.92616,46.72765],[118.89974,46.77139],[118.8337,46.77742],[118.78747,46.68689],[118.30534,46.73519],[117.69554,46.50991],[117.60748,46.59771],[117.41782,46.57862],[117.36609,46.36335],[116.83166,46.38637],[116.75551,46.33083],[116.58612,46.30211],[116.26678,45.96479],[116.24012,45.8778],[116.27366,45.78637],[116.16989,45.68603],[115.60329,45.44717],[114.94546,45.37377],[114.74612,45.43585],[114.54801,45.38337],[114.5166,45.27189],[113.70918,44.72891],[112.74662,44.86297],[112.4164,45.06858],[111.98695,45.09074],[111.76275,44.98032],[111.40498,44.3461],[111.96289,43.81596],[111.93776,43.68709],[111.79758,43.6637],[111.59087,43.51207],[111.0149,43.3289],[110.4327,42.78293],[110.08401,42.6411],[109.89402,42.63111],[109.452,42.44842],[109.00679,42.45302],[108.84489,42.40246],[107.57258,42.40898],[107.49681,42.46221],[107.29755,42.41395],[107.24774,42.36107],[106.76517,42.28741],[105.0123,41.63188],[104.51667,41.66113],[104.52258,41.8706],[103.92804,41.78246],[102.72403,42.14675],[102.07645,42.22519],[101.80515,42.50074],[100.84979,42.67087],[100.33297,42.68231],[99.50671,42.56535],[97.1777,42.7964],[96.37926,42.72055],[96.35658,42.90363],[95.89543,43.2528],[95.52594,43.99353],[95.32891,44.02407],[95.39772,44.2805],[95.01191,44.25274],[94.71959,44.35284],[94.10003,44.71016],[93.51161,44.95964],[91.64048,45.07408],[90.89169,45.19667],[90.65114,45.49314],[90.70907,45.73437],[91.03026,46.04194],[90.99672,46.14207],[90.89639,46.30711],[91.07696,46.57315],[91.0147,46.58171],[91.03649,46.72916],[90.84035,46.99525],[90.76108,46.99399],[90.48542,47.30438],[90.48854,47.41826],[90.33598,47.68303],[90.10871,47.7375],[90.06512,47.88177],[89.76624,47.82745],[89.55453,48.0423],[89.0711,47.98528],[88.93186,48.10263],[88.8011,48.11302],[88.58316,48.21893],[88.58939,48.34531],[87.96361,48.58478],[88.0788,48.71436],[87.73822,48.89582],[87.88171,48.95853],[87.81333,49.17354],[87.48983,49.13794],[87.478,49.07403],[87.28386,49.11626],[86.87238,49.12432],[86.73568,48.99918],[86.75343,48.70331],[86.38069,48.46064],[85.73581,48.3939],[85.5169,48.05493],[85.61067,47.49753],[85.69696,47.2898],[85.54294,47.06171],[85.22443,47.04816],[84.93995,46.87399],[84.73077,47.01394],[83.92184,46.98912],[83.04622,47.19053],[82.21792,45.56619],[82.58474,45.40027],[82.51374,45.1755],[81.73278,45.3504],[80.11169,45.03352],[79.8987,44.89957],[80.38384,44.63073],[80.40229,44.23319],[80.40031,44.10986],[80.75156,43.44948],[80.69718,43.32589],[80.77771,43.30065],[80.78817,43.14235],[80.62913,43.141],[80.3735,43.01557],[80.58999,42.9011],[80.38169,42.83142],[80.26886,42.8366],[80.16892,42.61137],[80.26841,42.23797],[80.17807,42.21166],[80.17842,42.03211],[79.92977,42.04113],[78.3732,41.39603],[78.15757,41.38565],[78.12873,41.23091],[77.81287,41.14307],[77.76206,41.01574],[77.52723,41.00227],[77.3693,41.0375],[77.28004,41.0033],[76.99302,41.0696],[76.75681,40.95354],[76.5261,40.46114],[76.33659,40.3482],[75.96168,40.38064],[75.91361,40.2948],[75.69663,40.28642],[75.5854,40.66874],[75.22834,40.45382],[75.08243,40.43945],[74.82013,40.52197],[74.78168,40.44886],[74.85996,40.32857],[74.69875,40.34668],[74.35063,40.09742],[74.25533,40.13191],[73.97049,40.04378],[73.83006,39.76136],[73.9051,39.75073],[73.92354,39.69565],[73.94683,39.60733],[73.87018,39.47879],[73.59831,39.46425],[73.59241,39.40843],[73.5004,39.38402],[73.55396,39.3543],[73.54572,39.27567],[73.60638,39.24534],[73.75823,39.023],[73.81728,39.04007],[73.82964,38.91517],[73.7445,38.93867],[73.7033,38.84782],[73.80656,38.66449],[73.79806,38.61106],[73.97933,38.52945],[74.17022,38.65504],[74.51217,38.47034],[74.69619,38.42947],[74.69894,38.22155],[74.80331,38.19889],[74.82665,38.07359],[74.9063,38.03033],[74.92416,37.83428],[75.00935,37.77486],[74.8912,37.67576],[74.94338,37.55501],[75.06011,37.52779],[75.15899,37.41443],[75.09719,37.37297],[75.12328,37.31839],[74.88887,37.23275],[74.80605,37.21565],[74.49981,37.24518],[74.56453,37.03023],[75.13839,37.02622],[75.40481,36.95382],[75.45562,36.71971],[75.72737,36.7529],[75.92391,36.56986],[76.0324,36.41198],[76.00906,36.17511],[75.93028,36.13136],[76.15325,35.9264],[76.14913,35.82848],[76.33453,35.84296],[76.50961,35.8908],[76.77323,35.66062],[76.84539,35.67356],[76.96624,35.5932],[77.44277,35.46132],[77.70232,35.46244],[77.80532,35.52058],[78.11664,35.48022],[78.03466,35.3785],[78.00033,35.23954],[78.22692,34.88771],[78.18435,34.7998],[78.27781,34.61484],[78.54964,34.57283],[78.56475,34.50835],[78.74465,34.45174],[79.05364,34.32482],[78.99802,34.3027],[78.91769,34.15452],[78.66225,34.08858],[78.65657,34.03195],[78.73367,34.01121],[78.77349,33.73871],[78.67599,33.66445],[78.73636,33.56521],[79.15252,33.17156],[79.14016,33.02545],[79.46562,32.69668],[79.26768,32.53277],[79.13174,32.47766],[79.0979,32.38051],[78.99322,32.37948],[78.96713,32.33655],[78.7831,32.46873],[78.73916,32.69438],[78.38897,32.53938],[78.4645,32.45367],[78.49609,32.2762],[78.68754,32.10256],[78.74404,32.00384],[78.78036,31.99478],[78.69933,31.78723],[78.84516,31.60631],[78.71032,31.50197],[78.77898,31.31209],[78.89344,31.30481],[79.01931,31.42817],[79.14016,31.43403],[79.30694,31.17357],[79.59884,30.93943],[79.93255,30.88288],[80.20721,30.58541],[80.54504,30.44936],[80.83343,30.32023],[81.03953,30.20059],[81.12842,30.01395],[81.24362,30.0126],[81.29032,30.08806],[81.2623,30.14596],[81.33355,30.15303],[81.39928,30.21862],[81.41018,30.42153],[81.5459,30.37688],[81.62033,30.44703],[81.99082,30.33423],[82.10135,30.35439],[82.10757,30.23745],[82.19475,30.16884],[82.16984,30.0692],[82.38622,30.02608],[82.5341,29.9735],[82.73024,29.81695],[83.07116,29.61957],[83.28131,29.56813],[83.44787,29.30513],[83.63156,29.16249],[83.82303,29.30513],[83.97559,29.33091],[84.18107,29.23451],[84.24801,29.02783],[84.2231,28.89571],[84.47528,28.74023],[84.62317,28.73887],[84.85511,28.58041],[85.06059,28.68562],[85.19135,28.62825],[85.18668,28.54076],[85.10729,28.34092],[85.38127,28.28336],[85.4233,28.32996],[85.59765,28.30529],[85.60854,28.25045],[85.69105,28.38475],[85.71907,28.38064],[85.74864,28.23126],[85.84672,28.18187],[85.90743,28.05144],[85.97813,27.99023],[85.94946,27.9401],[86.06309,27.90021],[86.12069,27.93047],[86.08333,28.02121],[86.088,28.09264],[86.18607,28.17364],[86.22966,27.9786],[86.42736,27.91122],[86.51609,27.96623],[86.56265,28.09569],[86.74181,28.10638],[86.75582,28.04182],[87.03757,27.94835],[87.11696,27.84104],[87.56996,27.84517],[87.72718,27.80938],[87.82681,27.95248],[88.13378,27.88015],[88.1278,27.95417],[88.25332,27.9478],[88.54858,28.06057],[88.63235,28.12356],[88.83559,28.01936],[88.88091,27.85192],[88.77517,27.45415],[88.82981,27.38814],[88.91901,27.32483],[88.93678,27.33777],[88.96947,27.30319],[89.00216,27.32532],[88.95355,27.4106],[88.97213,27.51671],[89.0582,27.60985],[89.12825,27.62502],[89.59525,28.16433],[89.79762,28.23979],[90.13387,28.19178],[90.58842,28.02838],[90.69894,28.07784],[91.20019,27.98715],[91.25779,28.07509],[91.46327,28.0064],[91.48973,27.93903],[91.5629,27.84823],[91.6469,27.76358],[91.84722,27.76325],[91.87057,27.7195],[92.27432,27.89077],[92.32101,27.79363],[92.42538,27.80092],[92.7275,27.98662],[92.73025,28.05814],[92.65472,28.07632],[92.67486,28.15018],[92.93075,28.25671],[93.14635,28.37035],[93.18069,28.50319],[93.44621,28.67189],[93.72797,28.68821],[94.35897,29.01965],[94.2752,29.11687],[94.69318,29.31739],[94.81353,29.17804],[95.0978,29.14446],[95.11291,29.09527],[95.2214,29.10727],[95.26122,29.07727],[95.3038,29.13847],[95.41091,29.13007],[95.50842,29.13487],[95.72086,29.20797],[95.75149,29.32063],[95.84899,29.31464],[96.05361,29.38167],[96.31316,29.18643],[96.18682,29.11087],[96.20467,29.02325],[96.3626,29.10607],[96.61391,28.72742],[96.40929,28.51526],[96.48895,28.42955],[96.6455,28.61657],[96.85561,28.4875],[96.88445,28.39452],[96.98882,28.32564],[97.1289,28.3619],[97.34547,28.21385],[97.41729,28.29783],[97.47085,28.2688],[97.50518,28.49716],[97.56835,28.55628],[97.70705,28.5056],[97.79632,28.33168],[97.90069,28.3776],[98.15337,28.12114],[98.13964,27.9478],[98.32641,27.51385],[98.42529,27.55404],[98.43353,27.67086],[98.69582,27.56499],[98.7333,26.85615],[98.77547,26.61994],[98.72741,26.36183],[98.67797,26.24487],[98.7329,26.17218],[98.66884,26.09165],[98.63128,26.15492],[98.57085,26.11547],[98.60763,26.01512],[98.70818,25.86241],[98.63128,25.79937],[98.54064,25.85129],[98.40606,25.61129],[98.31268,25.55307],[98.25774,25.6051],[98.16848,25.62739],[98.18084,25.56298],[98.12591,25.50722],[98.14925,25.41547],[97.92541,25.20815],[97.83614,25.2715],[97.77023,25.11492],[97.72216,25.08508],[97.72903,24.91332],[97.79949,24.85655],[97.76481,24.8289],[97.73127,24.83015],[97.70181,24.84557],[97.64354,24.79171],[97.56648,24.76475],[97.56383,24.75535],[97.5542,24.74943],[97.54675,24.74202],[97.56525,24.72838],[97.56286,24.54535],[97.52757,24.43748],[97.60029,24.4401],[97.66998,24.45288],[97.7098,24.35658],[97.65624,24.33781],[97.66723,24.30027],[97.71941,24.29652],[97.76799,24.26365],[97.72998,24.2302],[97.72799,24.18883],[97.75305,24.16902],[97.72903,24.12606],[97.62363,24.00506],[97.5247,23.94032],[97.64667,23.84574],[97.72302,23.89288],[97.79456,23.94836],[97.79416,23.95663],[97.84328,23.97603],[97.86545,23.97723],[97.88811,23.97446],[97.8955,23.97758],[97.89676,23.97931],[97.89683,23.98389],[97.88814,23.98605],[97.88414,23.99405],[97.88616,24.00463],[97.90998,24.02094],[97.93951,24.01953],[97.98691,24.03897],[97.99583,24.04932],[98.04709,24.07616],[98.05302,24.07408],[98.05671,24.07961],[98.0607,24.07812],[98.06703,24.08028],[98.07806,24.07988],[98.20666,24.11406],[98.54476,24.13119],[98.59256,24.08371],[98.85319,24.13042],[98.87998,24.15624],[98.89632,24.10612],[98.67797,23.9644],[98.68209,23.80492],[98.79607,23.77947],[98.82933,23.72921],[98.81775,23.694],[98.88396,23.59555],[98.80294,23.5345],[98.82877,23.47908],[98.87683,23.48995],[98.92104,23.36946],[98.87573,23.33038],[98.93958,23.31414],[98.92515,23.29535],[98.88597,23.18656],[99.05975,23.16382],[99.04601,23.12215],[99.25741,23.09025],[99.34127,23.13099],[99.52214,23.08218],[99.54218,22.90014],[99.43537,22.94086],[99.45654,22.85726],[99.31243,22.73893],[99.38247,22.57544],[99.37972,22.50188],[99.28771,22.4105],[99.17318,22.18025],[99.19176,22.16983],[99.1552,22.15874],[99.33166,22.09656],[99.47585,22.13345],[99.85351,22.04183],[99.96612,22.05965],[99.99084,21.97053],[99.94003,21.82782],[99.98654,21.71064],[100.04956,21.66843],[100.12679,21.70539],[100.17486,21.65306],[100.10757,21.59945],[100.12542,21.50365],[100.1625,21.48704],[100.18447,21.51898],[100.25863,21.47043],[100.35201,21.53176],[100.42892,21.54325],[100.4811,21.46148],[100.57861,21.45637],[100.72143,21.51898],[100.87265,21.67396],[101.11744,21.77659],[101.15156,21.56129],[101.2124,21.56422],[101.19349,21.41959],[101.26912,21.36482],[101.2229,21.23271],[101.29326,21.17254],[101.54563,21.25668],[101.6068,21.23329],[101.59491,21.18621],[101.60886,21.17947],[101.66977,21.20004],[101.70548,21.14911],[101.7622,21.14813],[101.79266,21.19025],[101.76745,21.21571],[101.83887,21.20983],[101.84412,21.25291],[101.74014,21.30967],[101.74224,21.48276],[101.7727,21.51794],[101.7475,21.5873],[101.80001,21.57461],[101.83257,21.61562],[101.74555,21.72852],[101.7791,21.83019],[101.62566,21.96574],[101.57525,22.13026],[101.60675,22.13513],[101.53638,22.24794],[101.56789,22.28876],[101.61306,22.27515],[101.68973,22.46843],[101.7685,22.50337],[101.86828,22.38397],[101.90714,22.38688],[101.91344,22.44417],[101.98487,22.42766],[102.03633,22.46164],[102.1245,22.43372],[102.14099,22.40092],[102.16621,22.43336],[102.26428,22.41321],[102.25339,22.4607],[102.41061,22.64184],[102.38415,22.67919],[102.42618,22.69212],[102.46665,22.77108],[102.51802,22.77969],[102.57095,22.7036],[102.60675,22.73376],[102.8636,22.60735],[102.9321,22.48659],[103.0722,22.44775],[103.07843,22.50097],[103.17961,22.55705],[103.15782,22.59873],[103.18895,22.64471],[103.28079,22.68063],[103.32282,22.8127],[103.43179,22.75816],[103.43646,22.70648],[103.52675,22.59155],[103.57812,22.65764],[103.56255,22.69499],[103.64506,22.79979],[103.87904,22.56683],[103.93286,22.52703],[103.94513,22.52553],[103.95191,22.5134],[103.96352,22.50584],[103.96783,22.51173],[103.97384,22.50634],[103.99247,22.51958],[104.01088,22.51823],[104.03734,22.72945],[104.11384,22.80363],[104.27084,22.8457],[104.25683,22.76534],[104.35593,22.69353],[104.47225,22.75813],[104.58122,22.85571],[104.60457,22.81841],[104.65283,22.83419],[104.72755,22.81984],[104.77114,22.90017],[104.84942,22.93631],[104.86765,22.95178],[104.8334,23.01484],[104.79478,23.12934],[104.87382,23.12854],[104.87992,23.17141],[104.91435,23.18666],[104.9486,23.17235],[104.96532,23.20463],[104.98712,23.19176],[105.07002,23.26248],[105.11672,23.25247],[105.17276,23.28679],[105.22569,23.27249],[105.32376,23.39684],[105.40782,23.28107],[105.42805,23.30824],[105.49966,23.20669],[105.56037,23.16806],[105.57594,23.075],[105.72382,23.06641],[105.8726,22.92756],[105.90119,22.94168],[105.99568,22.94178],[106.00179,22.99049],[106.19705,22.98475],[106.27022,22.87722],[106.34961,22.86718],[106.49749,22.91164],[106.51306,22.94891],[106.55976,22.92311],[106.60179,22.92884],[106.6516,22.86862],[106.6734,22.89587],[106.71387,22.88296],[106.71128,22.85982],[106.78422,22.81532],[106.81271,22.8226],[106.83685,22.8098],[106.82404,22.7881],[106.76293,22.73491],[106.72321,22.63606],[106.71698,22.58432],[106.65316,22.5757],[106.61269,22.60301],[106.58395,22.474],[106.55665,22.46498],[106.57221,22.37],[106.55976,22.34841],[106.6516,22.33977],[106.69986,22.22309],[106.67495,22.1885],[106.6983,22.15102],[106.70142,22.02409],[106.68274,21.99811],[106.69276,21.96013],[106.72551,21.97923],[106.74345,22.00965],[106.81038,21.97934],[106.9178,21.97357],[106.92714,21.93459],[106.97228,21.92592],[106.99252,21.95191],[107.05634,21.92303],[107.06101,21.88982],[107.00964,21.85948],[107.02615,21.81981],[107.10771,21.79879],[107.20734,21.71493],[107.24625,21.7077],[107.29296,21.74674],[107.35834,21.6672],[107.35989,21.60063],[107.38636,21.59774],[107.41593,21.64839],[107.47197,21.6672],[107.49532,21.62958],[107.49065,21.59774],[107.54047,21.5934],[107.56537,21.61945],[107.66967,21.60787],[107.80355,21.66141],[107.86114,21.65128],[107.90006,21.5905],[107.92652,21.58906],[107.95232,21.5388],[107.96774,21.53601],[107.97074,21.54072],[107.97383,21.53961],[107.97932,21.54503],[108.02926,21.54997],[108.0569,21.53604],[108.10003,21.47338],[108.00365,17.98159],[111.60491,13.57105],[118.41371,24.06775],[118.11703,24.39734],[118.28244,24.51231],[118.35291,24.51645],[118.42453,24.54644],[118.6333,24.46259],[119.42295,25.0886],[119.98511,25.37624],[119.78816,26.2348],[120.0693,26.3959],[120.5128,26.536],[121.03532,26.8787],[123.5458,31.01942],[122.29378,31.76513],[122.80525,33.30571],[123.85601,37.49093],[123.90497,38.79949],[124.17532,39.8232],[124.23201,39.9248],[124.35029,39.95639],[124.37089,40.03004],[124.3322,40.05573],[124.38556,40.11047],[124.40719,40.13655],[124.86913,40.45387],[125.71172,40.85223],[125.76869,40.87908],[126.00335,40.92835],[126.242,41.15454],[126.53189,41.35206],[126.60631,41.65565],[126.90729,41.79955],[127.17841,41.59714],[127.29712,41.49473],[127.92943,41.44291],[128.02633,41.42103],[128.03311,41.39232],[128.12967,41.37931],[128.18546,41.41279],[128.20061,41.40895],[128.30716,41.60322],[128.15119,41.74568],[128.04487,42.01769],[128.94007,42.03537],[128.96068,42.06657],[129.15178,42.17224],[129.22285,42.26491],[129.22423,42.3553],[129.28541,42.41574],[129.42882,42.44702],[129.54701,42.37254],[129.60482,42.44461],[129.72541,42.43739],[129.75294,42.59409],[129.77183,42.69435],[129.7835,42.76521],[129.80719,42.79218],[129.83277,42.86746],[129.85261,42.96494],[129.8865,43.00395],[129.95082,43.01051],[129.96409,42.97306],[130.12957,42.98361],[130.09764,42.91425],[130.26095,42.9027],[130.23068,42.80125],[130.2385,42.71127],[130.41826,42.6011],[130.44361,42.54849],[130.50123,42.61636],[130.55143,42.52158],[130.62107,42.58413],[130.56576,42.68925],[130.40213,42.70788],[130.44361,42.76205],[130.66524,42.84753],[131.02438,42.86518],[131.02668,42.91246],[131.135,42.94114],[131.10274,43.04734],[131.20414,43.13654],[131.19031,43.21385],[131.30324,43.39498],[131.29402,43.46695],[131.19492,43.53047],[131.21105,43.82383],[131.26176,43.94011],[131.23583,43.96085],[131.25484,44.03131],[131.30365,44.04262],[131.1108,44.70266],[130.95639,44.85154],[131.48415,44.99513],[131.68466,45.12374],[131.66852,45.2196],[131.76532,45.22609],[131.86903,45.33636],[131.99417,45.2567],[132.83978,45.05916],[132.96373,45.0212],[133.12293,45.1332],[133.09279,45.25693],[133.19419,45.51913],[133.41083,45.57723],[133.48457,45.86203],[133.60442,45.90053],[133.67569,45.9759],[133.72695,46.05576],[133.68047,46.14697],[133.88097,46.25066],[133.91496,46.4274],[133.84104,46.46681],[134.03538,46.75668],[134.20016,47.33458],[134.50898,47.4812],[134.7671,47.72051],[134.55508,47.98651],[134.67098,48.1564],[134.75328,48.36763],[134.49516,48.42884],[132.66989,47.96491],[132.57309,47.71741],[131.90448,47.68011],[131.2635,47.73325],[131.09871,47.6852],[130.95985,47.6957],[130.90915,47.90623],[130.65103,48.10052],[130.84462,48.30942],[130.52147,48.61745],[130.66946,48.88251],[130.43232,48.90844],[130.2355,48.86741],[129.85416,49.11067],[129.67598,49.29596],[129.50685,49.42398],[129.40398,49.44194],[129.35317,49.3481],[129.23232,49.40353],[129.11153,49.36813],[128.72896,49.58676],[127.83476,49.5748],[127.53516,49.84306],[127.49299,50.01251],[127.60515,50.23503],[127.37384,50.28393],[127.36009,50.43787],[127.28765,50.46585],[127.36335,50.58306],[127.28165,50.72075],[127.14586,50.91152],[126.93135,51.0841],[126.90369,51.3238],[126.68349,51.70607],[126.44606,51.98254],[126.558,52.13738],[125.6131,53.07229]],[[113.56865,22.20973],[113.57123,22.20416],[113.60504,22.20464],[113.63011,22.10782],[113.57191,22.07696],[113.54839,22.10909],[113.54942,22.14519],[113.54093,22.15497],[113.52659,22.18271],[113.53552,22.20607],[113.53301,22.21235],[113.53591,22.21369],[113.54093,22.21314],[113.54333,22.21688],[113.5508,22.21672],[113.56865,22.20973]],[[114.50148,22.15017],[113.92195,22.13873],[113.83338,22.1826],[113.81621,22.2163],[113.86771,22.42972],[114.03113,22.5065],[114.05438,22.5026],[114.05729,22.51104],[114.06272,22.51617],[114.07267,22.51855],[114.07817,22.52997],[114.08606,22.53276],[114.09048,22.53716],[114.09692,22.53435],[114.1034,22.5352],[114.11181,22.52878],[114.11656,22.53415],[114.12665,22.54003],[114.13823,22.54319],[114.1482,22.54091],[114.15123,22.55163],[114.1597,22.56041],[114.17247,22.55944],[114.18338,22.55444],[114.20655,22.55706],[114.22185,22.55343],[114.22888,22.5436],[114.25154,22.55977],[114.44998,22.55977],[114.50148,22.15017]]]]}},{type:"Feature",properties:{wikidata:"Q22890",nameEn:"Ireland",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q23666",nameEn:"Great Britain",country:"GB",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q23681",nameEn:"Northern Cyprus",groups:["Q644636","145","142"],driveSide:"left",callingCodes:["90 392"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.67678,35.03866],[33.67742,35.05963],[33.68474,35.06602],[33.69095,35.06237],[33.70861,35.07644],[33.7161,35.07279],[33.70209,35.04882],[33.71482,35.03722],[33.73824,35.05321],[33.76106,35.04253],[33.78581,35.05104],[33.82067,35.07826],[33.84168,35.06823],[33.8541,35.07201],[33.87479,35.08881],[33.87097,35.09389],[33.87622,35.10457],[33.87224,35.12293],[33.88561,35.12449],[33.88943,35.12007],[33.88737,35.11408],[33.89853,35.11377],[33.91789,35.08688],[33.90247,35.07686],[33.92495,35.06789],[33.94869,35.07277],[33.99999,35.07016],[34.23164,35.1777],[35.51152,36.10954],[32.82353,35.70297],[32.46489,35.48584],[32.60361,35.16647],[32.64864,35.19967],[32.70947,35.18328],[32.70779,35.14127],[32.85733,35.07742],[32.86406,35.1043],[32.94471,35.09422],[33.01192,35.15639],[33.08249,35.17319],[33.11105,35.15639],[33.15138,35.19504],[33.27068,35.16815],[33.3072,35.16816],[33.31955,35.18096],[33.35056,35.18328],[33.34964,35.17803],[33.35596,35.17942],[33.35612,35.17402],[33.36569,35.17479],[33.3717,35.1788],[33.37248,35.18698],[33.38575,35.2018],[33.4076,35.20062],[33.41675,35.16325],[33.46813,35.10564],[33.48136,35.0636],[33.47825,35.04103],[33.45178,35.02078],[33.45256,35.00288],[33.47666,35.00701],[33.48915,35.06594],[33.53975,35.08151],[33.57478,35.06049],[33.567,35.04803],[33.59658,35.03635],[33.61215,35.0527],[33.63765,35.03869],[33.67678,35.03866]]]]}},{type:"Feature",properties:{wikidata:"Q25231",nameEn:"Svalbard",aliases:["NO-21"],country:"NO",groups:["SJ","154","150","UN"],level:"subterritory",callingCodes:["47 79"]},geometry:{type:"MultiPolygon",coordinates:[[[[-7.49892,77.24208],[32.07813,72.01005],[36.85549,84.09565],[-7.49892,77.24208]]]]}},{type:"Feature",properties:{wikidata:"Q25263",nameEn:"Azores",aliases:["PT-20"],country:"PT",groups:["Q3320166","Q2914565","Q105472","EU","039","150","UN"],callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-23.12984,40.26428],[-36.43765,41.39418],[-22.54767,33.34416],[-23.12984,40.26428]]]]}},{type:"Feature",properties:{wikidata:"Q25359",nameEn:"Navassa Island",aliases:["UM-76"],country:"US",groups:["UM","Q1352230","029","003","419","019","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-74.7289,18.71009],[-75.71816,18.46438],[-74.76465,18.06252],[-74.7289,18.71009]]]]}},{type:"Feature",properties:{wikidata:"Q25396",nameEn:"Bonaire",aliases:["BQ-BO","NL-BQ1"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 7"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.89186,12.4116],[-68.90012,12.62309],[-68.33524,11.78151],[-68.01417,11.77722],[-67.89186,12.4116]]]]}},{type:"Feature",properties:{wikidata:"Q25528",nameEn:"Saba",aliases:["BQ-SA","NL-BQ2"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 4"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.07669,17.79659],[-63.81314,17.95045],[-63.22932,17.32592],[-63.07669,17.79659]]]]}},{type:"Feature",properties:{wikidata:"Q26180",nameEn:"Sint Eustatius",aliases:["BQ-SE","NL-BQ3"],country:"NL",groups:["Q1451600","BQ","029","003","419","019","UN"],level:"subterritory",callingCodes:["599 3"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.07669,17.79659],[-63.34999,16.94218],[-62.76692,17.64353],[-63.07669,17.79659]]]]}},{type:"Feature",properties:{wikidata:"Q26253",nameEn:"Madeira",aliases:["PT-30"],country:"PT",groups:["Q3320166","Q2914565","Q105472","EU","039","150","UN"],callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-19.30302,33.65304],[-16.04789,29.65076],[-11.68307,33.12333],[-19.30302,33.65304]]]]}},{type:"Feature",properties:{wikidata:"Q26927",nameEn:"Lakshadweep",aliases:["IN-LD"],country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[67.64074,11.57295],[76.59015,5.591],[72.67494,13.58102],[67.64074,11.57295]]]]}},{type:"Feature",properties:{wikidata:"Q27329",nameEn:"Asian Russia",country:"RU",groups:["142","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[-179.99933,64.74703],[-172.76104,63.77445],[-169.03888,65.48473],[-168.95635,65.98512],[-168.25765,71.99091],[-179.9843,71.90735],[-179.99933,64.74703]]],[[[59.99809,51.98263],[60.19925,51.99173],[60.48915,52.15175],[60.72581,52.15538],[60.78201,52.22067],[61.05417,52.35096],[60.98021,52.50068],[60.84709,52.52228],[60.84118,52.63912],[60.71693,52.66245],[60.71989,52.75923],[61.05842,52.92217],[61.23462,53.03227],[62.0422,52.96105],[62.12799,52.99133],[62.14574,53.09626],[61.19024,53.30536],[61.14291,53.41481],[61.29082,53.50992],[61.37957,53.45887],[61.57185,53.50112],[61.55706,53.57144],[60.90626,53.62937],[61.22574,53.80268],[61.14283,53.90063],[60.99796,53.93699],[61.26863,53.92797],[61.3706,54.08464],[61.47603,54.08048],[61.56941,53.95703],[61.65318,54.02445],[62.03913,53.94768],[62.00966,54.04134],[62.38535,54.03961],[62.45931,53.90737],[62.56876,53.94047],[62.58651,54.05871],[63.80604,54.27079],[63.91224,54.20013],[64.02715,54.22679],[63.97686,54.29763],[64.97216,54.4212],[65.11033,54.33028],[65.24663,54.35721],[65.20174,54.55216],[68.21308,54.98645],[68.26661,55.09226],[68.19206,55.18823],[68.90865,55.38148],[69.34224,55.36344],[69.74917,55.35545],[70.19179,55.1476],[70.76493,55.3027],[70.96009,55.10558],[71.08288,54.71253],[71.24185,54.64965],[71.08706,54.33376],[71.10379,54.13326],[71.96141,54.17736],[72.17477,54.36303],[72.43415,53.92685],[72.71026,54.1161],[73.37963,53.96132],[73.74778,54.07194],[73.68921,53.86522],[73.25412,53.61532],[73.39218,53.44623],[75.07405,53.80831],[75.43398,53.98652],[75.3668,54.07439],[76.91052,54.4677],[76.82266,54.1798],[76.44076,54.16017],[76.54243,53.99329],[77.90383,53.29807],[79.11255,52.01171],[80.08138,50.77658],[80.4127,50.95581],[80.44819,51.20855],[80.80318,51.28262],[81.16999,51.15662],[81.06091,50.94833],[81.41248,50.97524],[81.46581,50.77658],[81.94999,50.79307],[82.55443,50.75412],[83.14607,51.00796],[83.8442,50.87375],[84.29385,50.27257],[84.99198,50.06793],[85.24047,49.60239],[86.18709,49.50259],[86.63674,49.80136],[86.79056,49.74787],[86.61307,49.60239],[86.82606,49.51796],[87.03071,49.25142],[87.31465,49.23603],[87.28386,49.11626],[87.478,49.07403],[87.48983,49.13794],[87.81333,49.17354],[87.98977,49.18147],[88.15543,49.30314],[88.17223,49.46934],[88.42449,49.48821],[88.82499,49.44808],[89.70687,49.72535],[89.59711,49.90851],[91.86048,50.73734],[92.07173,50.69585],[92.44714,50.78762],[93.01109,50.79001],[92.99595,50.63183],[94.30823,50.57498],[94.39258,50.22193],[94.49477,50.17832],[94.6121,50.04239],[94.97166,50.04725],[95.02465,49.96941],[95.74757,49.97915],[95.80056,50.04239],[96.97388,49.88413],[97.24639,49.74737],[97.56811,49.84265],[97.56432,49.92801],[97.76871,49.99861],[97.85197,49.91339],[98.29481,50.33561],[98.31373,50.4996],[98.06393,50.61262],[97.9693,50.78044],[98.01472,50.86652],[97.83305,51.00248],[98.05257,51.46696],[98.22053,51.46579],[98.33222,51.71832],[98.74142,51.8637],[98.87768,52.14563],[99.27888,51.96876],[99.75578,51.90108],[99.89203,51.74903],[100.61116,51.73028],[101.39085,51.45753],[101.5044,51.50467],[102.14032,51.35566],[102.32194,50.67982],[102.71178,50.38873],[103.70343,50.13952],[105.32528,50.4648],[106.05562,50.40582],[106.07865,50.33474],[106.47156,50.31909],[106.49628,50.32436],[106.51122,50.34408],[106.58373,50.34044],[106.80326,50.30177],[107.00007,50.1977],[107.1174,50.04239],[107.36407,49.97612],[107.96116,49.93191],[107.95387,49.66659],[108.27937,49.53167],[108.53969,49.32325],[109.18017,49.34709],[109.51325,49.22859],[110.24373,49.16676],[110.39891,49.25083],[110.64493,49.1816],[113.02647,49.60772],[113.20216,49.83356],[114.325,50.28098],[114.9703,50.19254],[115.26068,49.97367],[115.73602,49.87688],[116.22402,50.04477],[116.62502,49.92919],[116.71193,49.83813],[117.27597,49.62544],[117.48208,49.62324],[117.82343,49.52696],[118.61623,49.93809],[119.11003,50.00276],[119.27996,50.13348],[119.38598,50.35162],[119.13553,50.37412],[120.10963,51.671],[120.65907,51.93544],[120.77337,52.20805],[120.61346,52.32447],[120.71673,52.54099],[120.46454,52.63811],[120.04049,52.58773],[120.0451,52.7359],[120.85633,53.28499],[121.39213,53.31888],[122.35063,53.49565],[122.85966,53.47395],[123.26989,53.54843],[123.86158,53.49391],[124.46078,53.21881],[125.17522,53.20225],[125.6131,53.07229],[126.558,52.13738],[126.44606,51.98254],[126.68349,51.70607],[126.90369,51.3238],[126.93135,51.0841],[127.14586,50.91152],[127.28165,50.72075],[127.36335,50.58306],[127.28765,50.46585],[127.36009,50.43787],[127.37384,50.28393],[127.60515,50.23503],[127.49299,50.01251],[127.53516,49.84306],[127.83476,49.5748],[128.72896,49.58676],[129.11153,49.36813],[129.23232,49.40353],[129.35317,49.3481],[129.40398,49.44194],[129.50685,49.42398],[129.67598,49.29596],[129.85416,49.11067],[130.2355,48.86741],[130.43232,48.90844],[130.66946,48.88251],[130.52147,48.61745],[130.84462,48.30942],[130.65103,48.10052],[130.90915,47.90623],[130.95985,47.6957],[131.09871,47.6852],[131.2635,47.73325],[131.90448,47.68011],[132.57309,47.71741],[132.66989,47.96491],[134.49516,48.42884],[134.75328,48.36763],[134.67098,48.1564],[134.55508,47.98651],[134.7671,47.72051],[134.50898,47.4812],[134.20016,47.33458],[134.03538,46.75668],[133.84104,46.46681],[133.91496,46.4274],[133.88097,46.25066],[133.68047,46.14697],[133.72695,46.05576],[133.67569,45.9759],[133.60442,45.90053],[133.48457,45.86203],[133.41083,45.57723],[133.19419,45.51913],[133.09279,45.25693],[133.12293,45.1332],[132.96373,45.0212],[132.83978,45.05916],[131.99417,45.2567],[131.86903,45.33636],[131.76532,45.22609],[131.66852,45.2196],[131.68466,45.12374],[131.48415,44.99513],[130.95639,44.85154],[131.1108,44.70266],[131.30365,44.04262],[131.25484,44.03131],[131.23583,43.96085],[131.26176,43.94011],[131.21105,43.82383],[131.19492,43.53047],[131.29402,43.46695],[131.30324,43.39498],[131.19031,43.21385],[131.20414,43.13654],[131.10274,43.04734],[131.135,42.94114],[131.02668,42.91246],[131.02438,42.86518],[130.66524,42.84753],[130.44361,42.76205],[130.40213,42.70788],[130.56576,42.68925],[130.62107,42.58413],[130.55143,42.52158],[130.56835,42.43281],[130.60805,42.4317],[130.64181,42.41422],[130.66367,42.38024],[130.65022,42.32281],[131.95041,41.5445],[140.9182,45.92937],[145.82343,44.571],[145.23667,43.76813],[153.94307,38.42848],[180,62.52334],[180,71.53642],[155.31937,81.93282],[76.13964,83.37843],[64.18965,69.94255],[66.1708,67.61252],[61.98014,65.72191],[60.74386,64.95767],[59.63945,64.78384],[59.80579,64.13948],[59.24834,63.01859],[59.61398,62.44915],[59.36223,61.3882],[59.50685,60.91162],[58.3853,59.487],[59.15636,59.14682],[59.40376,58.45822],[58.71104,58.07475],[58.81412,57.71602],[58.13789,57.68097],[58.07604,57.08308],[57.28024,56.87898],[57.51527,56.08729],[59.28419,56.15739],[59.49035,55.60486],[58.81825,55.03378],[57.25137,55.26262],[57.14829,54.84204],[57.95234,54.39672],[59.95217,54.85853],[59.70487,54.14846],[58.94336,53.953],[58.79644,52.43392],[59.22409,52.28437],[59.25033,52.46803],[60.17516,52.39457],[60.17253,52.25814],[59.91279,52.06924],[59.99809,51.98263]]]]}},{type:"Feature",properties:{wikidata:"Q34366",nameEn:"Tasmania",aliases:["AU-TAS"],country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[123.64533,-39.13605],[159.69067,-56.28945],[159.74028,-39.1978],[123.64533,-39.13605]]]]}},{type:"Feature",properties:{wikidata:"Q34497",nameEn:"Saint Helena",aliases:["SH-HL"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["290"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.3824,-13.9131],[-6.17428,-19.07236],[-3.29308,-15.22647],[-8.3824,-13.9131]]]]}},{type:"Feature",properties:{wikidata:"Q35657",nameEn:"US States",country:"US",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q36117",nameEn:"Borneo",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q36678",nameEn:"West Bank",country:"PS",groups:["145","142"],callingCodes:["970"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.47672,31.49578],[35.55941,31.76535],[35.52758,31.9131],[35.54375,31.96587],[35.52012,32.04076],[35.57111,32.21877],[35.55807,32.38674],[35.42078,32.41562],[35.41048,32.43706],[35.41598,32.45593],[35.42034,32.46009],[35.40224,32.50136],[35.35212,32.52047],[35.30685,32.51024],[35.29306,32.50947],[35.25049,32.52453],[35.2244,32.55289],[35.15937,32.50466],[35.10882,32.4757],[35.10024,32.47856],[35.09236,32.47614],[35.08564,32.46948],[35.07059,32.4585],[35.05423,32.41754],[35.05311,32.4024],[35.0421,32.38242],[35.05142,32.3667],[35.04243,32.35008],[35.01772,32.33863],[35.01119,32.28684],[35.02939,32.2671],[35.01841,32.23981],[34.98885,32.20758],[34.95703,32.19522],[34.96009,32.17503],[34.99039,32.14626],[34.98507,32.12606],[34.99437,32.10962],[34.9863,32.09551],[35.00261,32.027],[34.98682,31.96935],[35.00124,31.93264],[35.03489,31.92448],[35.03978,31.89276],[35.03489,31.85919],[34.99712,31.85569],[34.9724,31.83352],[35.01978,31.82944],[35.05617,31.85685],[35.07677,31.85627],[35.14174,31.81325],[35.18603,31.80901],[35.18169,31.82542],[35.19461,31.82687],[35.21469,31.81835],[35.216,31.83894],[35.21128,31.863],[35.20381,31.86716],[35.20673,31.88151],[35.20791,31.8821],[35.20945,31.8815],[35.21016,31.88237],[35.21276,31.88153],[35.2136,31.88241],[35.22014,31.88264],[35.22294,31.87889],[35.22567,31.86745],[35.22817,31.8638],[35.2249,31.85433],[35.2304,31.84222],[35.24816,31.8458],[35.25753,31.8387],[35.251,31.83085],[35.26404,31.82567],[35.25573,31.81362],[35.26058,31.79064],[35.25225,31.7678],[35.26319,31.74846],[35.25182,31.73945],[35.24981,31.72543],[35.2438,31.7201],[35.24315,31.71244],[35.23972,31.70896],[35.22392,31.71899],[35.21937,31.71578],[35.20538,31.72388],[35.18023,31.72067],[35.16478,31.73242],[35.15474,31.73352],[35.15119,31.73634],[35.13931,31.73012],[35.12933,31.7325],[35.11895,31.71454],[35.10782,31.71594],[35.08226,31.69107],[35.00879,31.65426],[34.95249,31.59813],[34.9415,31.55601],[34.94356,31.50743],[34.93258,31.47816],[34.89756,31.43891],[34.87833,31.39321],[34.88932,31.37093],[34.92571,31.34337],[35.02459,31.35979],[35.13033,31.3551],[35.22921,31.37445],[35.39675,31.49572],[35.47672,31.49578]]]]}},{type:"Feature",properties:{wikidata:"Q37362",nameEn:"Akrotiri and Dhekelia",aliases:["SBA"],country:"GB"},geometry:null},{type:"Feature",properties:{wikidata:"Q38095",nameEn:"Gal\xE1pagos Islands",aliases:["EC-W"],country:"EC",groups:["005","419","019","UN"],callingCodes:["593"]},geometry:{type:"MultiPolygon",coordinates:[[[[-93.12365,2.64343],[-92.46744,-2.52874],[-87.07749,-.8849],[-93.12365,2.64343]]]]}},{type:"Feature",properties:{wikidata:"Q39760",nameEn:"Gaza Strip",country:"PS",groups:["145","142"],callingCodes:["970"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.052,31.46619],[34.21853,31.32363],[34.23572,31.2966],[34.24012,31.29591],[34.26742,31.21998],[34.29417,31.24194],[34.36523,31.28963],[34.37381,31.30598],[34.36505,31.36404],[34.40077,31.40926],[34.48892,31.48365],[34.56797,31.54197],[34.48681,31.59711],[34.29262,31.70393],[34.052,31.46619]]]]}},{type:"Feature",properties:{wikidata:"Q40888",nameEn:"Andaman and Nicobar Islands",aliases:["IN-AN"],country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[94.42132,5.96581],[94.6371,13.81803],[86.7822,13.41052],[94.42132,5.96581]]]]}},{type:"Feature",properties:{wikidata:"Q41684",nameEn:"Stewart Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[166.59185,-47.61313],[169.70504,-47.56021],[167.52103,-46.41337],[166.59185,-47.61313]]]]}},{type:"Feature",properties:{wikidata:"Q43296",nameEn:"Wake Island",aliases:["WK","WAK","WKUM","872","UM-79"],country:"US",groups:["UM","Q1352230","057","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[167.34779,18.97692],[166.67967,20.14834],[165.82549,18.97692],[167.34779,18.97692]]]]}},{type:"Feature",properties:{wikidata:"Q46275",nameEn:"New Zealand Subantarctic Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[164.30551,-47.88072],[161.96603,-56.07661],[179.49541,-50.04657],[179.49541,-47.2902],[169.91032,-47.66283],[164.30551,-47.88072]]]]}},{type:"Feature",properties:{wikidata:"Q46395",nameEn:"British Overseas Territories",aliases:["BOTS","UKOTS"],country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q46772",nameEn:"Kerguelen Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[61.9216,-49.39746],[70.67507,-51.14192],[74.25129,-45.45074],[61.9216,-49.39746]]]]}},{type:"Feature",properties:{wikidata:"Q46879",nameEn:"Baker Island",aliases:["UM-81"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-175.33482,-1.40631],[-175.31323,.5442],[-177.91421,.39582],[-175.33482,-1.40631]]]]}},{type:"Feature",properties:{wikidata:"Q47863",nameEn:"Midway Atoll",aliases:["MI","MID","MIUM","488","UM-71"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-176.29741,29.09786],[-177.77531,29.29793],[-177.5224,27.7635],[-176.29741,29.09786]]]]}},{type:"Feature",properties:{wikidata:"Q62218",nameEn:"Jarvis Island",aliases:["UM-86"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-160.42921,-1.4364],[-159.12443,.19975],[-160.38779,.30331],[-160.42921,-1.4364]]]]}},{type:"Feature",properties:{wikidata:"Q105472",nameEn:"Macaronesia",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q114935",nameEn:"Kermadec Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-174.40891,-29.09438],[-180,-24.21376],[-179.96512,-35.00791],[-174.40891,-29.09438]]]]}},{type:"Feature",properties:{wikidata:"Q115459",nameEn:"Chatham Islands",aliases:["NZ-CIT"],country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-179.93224,-45.18423],[-172.47015,-45.17912],[-176.30998,-41.38382],[-179.93224,-45.18423]]]]}},{type:"Feature",properties:{wikidata:"Q118863",nameEn:"North Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[179.49541,-47.2902],[179.49541,-36.79303],[174.17679,-32.62487],[170.27492,-36.38133],[174.58663,-40.80446],[174.46634,-41.55028],[179.49541,-47.2902]]]]}},{type:"Feature",properties:{wikidata:"Q120755",nameEn:"South Island",country:"NZ",groups:["053","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.70504,-47.56021],[179.49541,-47.2902],[174.46634,-41.55028],[174.58663,-40.80446],[170.27492,-36.38133],[166.56976,-39.94841],[164.8365,-46.0205],[167.52103,-46.41337],[169.70504,-47.56021]]]]}},{type:"Feature",properties:{wikidata:"Q123076",nameEn:"Palmyra Atoll",aliases:["UM-95"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-161.06795,5.2462],[-161.0731,7.1291],[-163.24478,5.24198],[-161.06795,5.2462]]]]}},{type:"Feature",properties:{wikidata:"Q130574",nameEn:"Chafarinas Islands",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-2.40316,35.16893],[-2.43262,35.20652],[-2.45965,35.16527],[-2.40316,35.16893]]]]}},{type:"Feature",properties:{wikidata:"Q130895",nameEn:"Kingman Reef",aliases:["UM-89"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-161.0731,7.1291],[-163.16627,7.15036],[-163.24478,5.24198],[-161.0731,7.1291]]]]}},{type:"Feature",properties:{wikidata:"Q131008",nameEn:"Johnston Atoll",aliases:["JT","JTN","JTUM","396","UM-67"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-170.65691,16.57199],[-168.87689,16.01159],[-169.2329,17.4933],[-170.65691,16.57199]]]]}},{type:"Feature",properties:{wikidata:"Q131305",nameEn:"Howland Island",aliases:["UM-84"],country:"US",groups:["UM","Q1352230","061","009","UN"],level:"subterritory",roadSpeedUnit:"mph",roadHeightUnit:"ft"},geometry:{type:"MultiPolygon",coordinates:[[[[-177.91421,.39582],[-175.31323,.5442],[-176.74464,2.28109],[-177.91421,.39582]]]]}},{type:"Feature",properties:{wikidata:"Q133888",nameEn:"Ashmore and Cartier Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[123.7463,-11.1783],[120.6877,-13.59408],[125.29076,-12.33139],[123.7463,-11.1783]]]]}},{type:"Feature",properties:{wikidata:"Q153732",nameEn:"Mariana Islands",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q172216",nameEn:"Coral Sea Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[159.77159,-28.41151],[156.73836,-14.50464],[145.2855,-9.62524],[147.69992,-17.5933],[152.93188,-20.92631],[154.02855,-24.43238],[159.77159,-28.41151]]]]}},{type:"Feature",properties:{wikidata:"Q179313",nameEn:"Alderney",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.36485,49.48223],[-2.09454,49.46288],[-2.02963,49.91866],[-2.49556,49.79012],[-2.36485,49.48223]]]]}},{type:"Feature",properties:{wikidata:"Q185086",nameEn:"Crown Dependencies",country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q190571",nameEn:"Scattered Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[53.53458,-16.36909],[54.96649,-16.28353],[54.61476,-15.02273],[53.53458,-16.36909]]],[[[38.55969,-20.75596],[40.68027,-23.38889],[43.52893,-15.62903],[38.55969,-20.75596]]],[[[47.03092,-11.05648],[47.11593,-12.08552],[47.96702,-11.46447],[47.03092,-11.05648]]]]}},{type:"Feature",properties:{wikidata:"Q191011",nameEn:"Plazas de soberan\xEDa",country:"ES"},geometry:null},{type:"Feature",properties:{wikidata:"Q191146",nameEn:"Pe\xF1\xF3n de V\xE9lez de la Gomera",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-4.30191,35.17419],[-4.30112,35.17058],[-4.29436,35.17149],[-4.30191,35.17419]]]]}},{type:"Feature",properties:{wikidata:"Q201698",nameEn:"Crozet Islands",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[55.03425,-43.65017],[46.31615,-46.28749],[54.5587,-47.93013],[55.03425,-43.65017]]]]}},{type:"Feature",properties:{wikidata:"Q578170",nameEn:"Contiguous United States",aliases:["CONUS"],country:"US",groups:["Q35657","021","003","019","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-97.13927,25.96583],[-96.92418,25.97377],[-80.57035,24.0565],[-78.91214,27.76553],[-61.98255,37.34815],[-67.16117,44.20069],[-66.93432,44.82597],[-66.96824,44.83078],[-66.98249,44.87071],[-66.96824,44.90965],[-67.0216,44.95333],[-67.11316,45.11176],[-67.15965,45.16179],[-67.19603,45.16771],[-67.20349,45.1722],[-67.22751,45.16344],[-67.27039,45.1934],[-67.29748,45.18173],[-67.29754,45.14865],[-67.34927,45.122],[-67.48201,45.27351],[-67.42394,45.37969],[-67.50578,45.48971],[-67.42144,45.50584],[-67.43815,45.59162],[-67.6049,45.60725],[-67.80705,45.69528],[-67.80653,45.80022],[-67.75654,45.82324],[-67.80961,45.87531],[-67.75196,45.91814],[-67.78111,45.9392],[-67.78578,47.06473],[-67.87993,47.10377],[-67.94843,47.1925],[-68.23244,47.35712],[-68.37458,47.35851],[-68.38332,47.28723],[-68.57914,47.28431],[-68.60575,47.24659],[-68.70125,47.24399],[-68.89222,47.1807],[-69.05039,47.2456],[-69.05073,47.30076],[-69.05148,47.42012],[-69.22119,47.46461],[-69.99966,46.69543],[-70.05812,46.41768],[-70.18547,46.35357],[-70.29078,46.18832],[-70.23855,46.1453],[-70.31025,45.96424],[-70.24694,45.95138],[-70.25976,45.89675],[-70.41523,45.79497],[-70.38934,45.73215],[-70.54019,45.67291],[-70.68516,45.56964],[-70.72651,45.49771],[-70.62518,45.42286],[-70.65383,45.37592],[-70.78372,45.43269],[-70.82638,45.39828],[-70.80236,45.37444],[-70.84816,45.22698],[-70.89864,45.2398],[-70.91169,45.29849],[-70.95193,45.33895],[-71.0107,45.34819],[-71.01866,45.31573],[-71.08364,45.30623],[-71.14568,45.24128],[-71.19723,45.25438],[-71.22338,45.25184],[-71.29371,45.29996],[-71.37133,45.24624],[-71.44252,45.2361],[-71.40364,45.21382],[-71.42778,45.12624],[-71.48735,45.07784],[-71.50067,45.01357],[-73.35025,45.00942],[-74.32699,44.99029],[-74.66689,45.00646],[-74.8447,45.00606],[-74.99101,44.98051],[-75.01363,44.95608],[-75.2193,44.87821],[-75.41441,44.76614],[-75.76813,44.51537],[-75.8217,44.43176],[-75.95947,44.34463],[-76.00018,44.34896],[-76.16285,44.28262],[-76.1664,44.23051],[-76.244,44.19643],[-76.31222,44.19894],[-76.35324,44.13493],[-76.43859,44.09393],[-76.79706,43.63099],[-79.25796,43.54052],[-79.06921,43.26183],[-79.05512,43.25375],[-79.05544,43.21224],[-79.05002,43.20133],[-79.05384,43.17418],[-79.04652,43.16396],[-79.0427,43.13934],[-79.06881,43.12029],[-79.05671,43.10937],[-79.07486,43.07845],[-79.01055,43.06659],[-78.99941,43.05612],[-79.02424,43.01983],[-79.02074,42.98444],[-78.98126,42.97],[-78.96312,42.95509],[-78.93224,42.95229],[-78.90905,42.93022],[-78.90712,42.89733],[-78.93684,42.82887],[-82.67862,41.67615],[-83.11184,41.95671],[-83.14962,42.04089],[-83.12724,42.2376],[-83.09837,42.28877],[-83.07837,42.30978],[-83.02253,42.33045],[-82.82964,42.37355],[-82.64242,42.55594],[-82.58873,42.54984],[-82.57583,42.5718],[-82.51858,42.611],[-82.51063,42.66025],[-82.46613,42.76615],[-82.4826,42.8068],[-82.45331,42.93139],[-82.4253,42.95423],[-82.4146,42.97626],[-82.42469,42.992],[-82.48419,45.30225],[-83.59589,45.82131],[-83.43746,45.99749],[-83.57017,46.105],[-83.83329,46.12169],[-83.90453,46.05922],[-83.95399,46.05634],[-84.1096,46.23987],[-84.09756,46.25512],[-84.11615,46.2681],[-84.11254,46.32329],[-84.13451,46.39218],[-84.11196,46.50248],[-84.12885,46.53068],[-84.17723,46.52753],[-84.1945,46.54061],[-84.2264,46.53337],[-84.26351,46.49508],[-84.29893,46.49127],[-84.34174,46.50683],[-84.42101,46.49853],[-84.4481,46.48972],[-84.47607,46.45225],[-84.55635,46.45974],[-84.85871,46.88881],[-88.37033,48.30586],[-89.48837,48.01412],[-89.57972,48.00023],[-89.77248,48.02607],[-89.89974,47.98109],[-90.07418,48.11043],[-90.56312,48.09488],[-90.56444,48.12184],[-90.75045,48.09143],[-90.87588,48.2484],[-91.08016,48.18096],[-91.25025,48.08522],[-91.43248,48.04912],[-91.45829,48.07454],[-91.58025,48.04339],[-91.55649,48.10611],[-91.70451,48.11805],[-91.71231,48.19875],[-91.86125,48.21278],[-91.98929,48.25409],[-92.05339,48.35958],[-92.14732,48.36578],[-92.202,48.35252],[-92.26662,48.35651],[-92.30939,48.31251],[-92.27167,48.25046],[-92.37185,48.22259],[-92.48147,48.36609],[-92.45588,48.40624],[-92.50712,48.44921],[-92.65606,48.43471],[-92.71323,48.46081],[-92.69927,48.49573],[-92.62747,48.50278],[-92.6342,48.54133],[-92.7287,48.54005],[-92.94973,48.60866],[-93.25391,48.64266],[-93.33946,48.62787],[-93.3712,48.60599],[-93.39758,48.60364],[-93.40693,48.60948],[-93.44472,48.59147],[-93.47022,48.54357],[-93.66382,48.51845],[-93.79267,48.51631],[-93.80939,48.52439],[-93.80676,48.58232],[-93.83288,48.62745],[-93.85769,48.63284],[-94.23215,48.65202],[-94.25104,48.65729],[-94.25172,48.68404],[-94.27153,48.70232],[-94.4174,48.71049],[-94.44258,48.69223],[-94.53826,48.70216],[-94.54885,48.71543],[-94.58903,48.71803],[-94.69335,48.77883],[-94.69669,48.80918],[-94.70486,48.82365],[-94.70087,48.8339],[-94.687,48.84077],[-94.75017,49.09931],[-94.77355,49.11998],[-94.82487,49.29483],[-94.8159,49.32299],[-94.85381,49.32492],[-94.95681,49.37035],[-94.99532,49.36579],[-95.01419,49.35647],[-95.05825,49.35311],[-95.12903,49.37056],[-95.15357,49.384],[-95.15355,48.9996],[-123.32163,49.00419],[-123.0093,48.83186],[-123.0093,48.76586],[-123.26565,48.6959],[-123.15614,48.35395],[-123.50039,48.21223],[-125.03842,48.53282],[-133.98258,38.06389],[-118.48109,32.5991],[-117.1243,32.53427],[-115.88053,32.63624],[-114.71871,32.71894],[-114.76736,32.64094],[-114.80584,32.62028],[-114.81141,32.55543],[-114.79524,32.55731],[-114.82011,32.49609],[-111.07523,31.33232],[-108.20979,31.33316],[-108.20899,31.78534],[-106.529,31.784],[-106.52266,31.77509],[-106.51251,31.76922],[-106.50962,31.76155],[-106.50111,31.75714],[-106.48815,31.74769],[-106.47298,31.75054],[-106.46726,31.75998],[-106.45244,31.76523],[-106.43419,31.75478],[-106.41773,31.75196],[-106.38003,31.73151],[-106.3718,31.71165],[-106.34864,31.69663],[-106.33419,31.66303],[-106.30305,31.62154],[-106.28084,31.56173],[-106.24612,31.54193],[-106.23711,31.51262],[-106.20346,31.46305],[-106.09025,31.40569],[-106.00363,31.39181],[-104.77674,30.4236],[-104.5171,29.64671],[-104.3969,29.57105],[-104.39363,29.55396],[-104.37752,29.54255],[-103.15787,28.93865],[-102.60596,29.8192],[-101.47277,29.7744],[-101.05686,29.44738],[-101.01128,29.36947],[-100.96725,29.3477],[-100.94579,29.34523],[-100.94056,29.33371],[-100.87982,29.296],[-100.79696,29.24688],[-100.67294,29.09744],[-100.63689,28.90812],[-100.59809,28.88197],[-100.52313,28.75598],[-100.5075,28.74066],[-100.51222,28.70679],[-100.50029,28.66117],[-99.55409,27.61314],[-99.51478,27.55836],[-99.52955,27.49747],[-99.50208,27.50021],[-99.48045,27.49016],[-99.482,27.47128],[-99.49744,27.43746],[-99.53573,27.30926],[-99.08477,26.39849],[-99.03053,26.41249],[-99.00546,26.3925],[-98.35126,26.15129],[-98.30491,26.10475],[-98.27075,26.09457],[-98.24603,26.07191],[-97.97017,26.05232],[-97.95155,26.0625],[-97.66511,26.01708],[-97.52025,25.88518],[-97.49828,25.89877],[-97.45669,25.86874],[-97.42511,25.83969],[-97.37332,25.83854],[-97.35946,25.92189],[-97.13927,25.96583]]]]}},{type:"Feature",properties:{wikidata:"Q620634",nameEn:"Bir Tawil",groups:["015","002"],level:"territory"},geometry:{type:"MultiPolygon",coordinates:[[[[33.17563,22.00405],[33.57251,21.72406],[33.99686,21.76784],[34.0765,22.00501],[33.17563,22.00405]]]]}},{type:"Feature",properties:{wikidata:"Q639185",nameEn:"Peros Banhos",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[72.12587,-4.02588],[70.1848,-6.37445],[72.09518,-5.61768],[72.12587,-4.02588]]]]}},{type:"Feature",properties:{wikidata:"Q644636",nameEn:"Cyprus",level:"sharedLandform"},geometry:null},{type:"Feature",properties:{wikidata:"Q851132",nameEn:"New Zealand Outlying Islands",country:"NZ",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q875134",nameEn:"European Russia",country:"RU",groups:["151","150","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.57853,55.25302],[19.64312,54.45423],[19.8038,54.44203],[20.63871,54.3706],[21.41123,54.32395],[22.79705,54.36264],[22.7253,54.41732],[22.70208,54.45312],[22.67788,54.532],[22.71293,54.56454],[22.68021,54.58486],[22.7522,54.63525],[22.74225,54.64339],[22.75467,54.6483],[22.73397,54.66604],[22.73631,54.72952],[22.87317,54.79492],[22.85083,54.88711],[22.76422,54.92521],[22.68723,54.9811],[22.65451,54.97037],[22.60075,55.01863],[22.58907,55.07085],[22.47688,55.04408],[22.31562,55.0655],[22.14267,55.05345],[22.11697,55.02131],[22.06087,55.02935],[22.02582,55.05078],[22.03984,55.07888],[21.99543,55.08691],[21.96505,55.07353],[21.85521,55.09493],[21.64954,55.1791],[21.55605,55.20311],[21.51095,55.18507],[21.46766,55.21115],[21.38446,55.29348],[21.35465,55.28427],[21.26425,55.24456],[20.95181,55.27994],[20.60454,55.40986],[18.57853,55.25302]]],[[[26.32936,60.00121],[26.90044,59.63819],[27.85643,59.58538],[28.04187,59.47017],[28.19061,59.39962],[28.21137,59.38058],[28.20537,59.36491],[28.19284,59.35791],[28.14215,59.28934],[28.00689,59.28351],[27.90911,59.24353],[27.87978,59.18097],[27.80482,59.1116],[27.74429,58.98351],[27.36366,58.78381],[27.55489,58.39525],[27.48541,58.22615],[27.62393,58.09462],[27.67282,57.92627],[27.81841,57.89244],[27.78526,57.83963],[27.56689,57.83356],[27.50171,57.78842],[27.52615,57.72843],[27.3746,57.66834],[27.40393,57.62125],[27.31919,57.57672],[27.34698,57.52242],[27.56832,57.53728],[27.52453,57.42826],[27.86101,57.29402],[27.66511,56.83921],[27.86101,56.88204],[28.04768,56.59004],[28.13526,56.57989],[28.10069,56.524],[28.19057,56.44637],[28.16599,56.37806],[28.23716,56.27588],[28.15217,56.16964],[28.30571,56.06035],[28.36888,56.05805],[28.37987,56.11399],[28.43068,56.09407],[28.5529,56.11705],[28.68337,56.10173],[28.63668,56.07262],[28.73418,55.97131],[29.08299,56.03427],[29.21717,55.98971],[29.44692,55.95978],[29.3604,55.75862],[29.51283,55.70294],[29.61446,55.77716],[29.80672,55.79569],[29.97975,55.87281],[30.12136,55.8358],[30.27776,55.86819],[30.30987,55.83592],[30.48257,55.81066],[30.51346,55.78982],[30.51037,55.76568],[30.63344,55.73079],[30.67464,55.64176],[30.72957,55.66268],[30.7845,55.58514],[30.86003,55.63169],[30.93419,55.6185],[30.95204,55.50667],[30.90123,55.46621],[30.93144,55.3914],[30.8257,55.3313],[30.81946,55.27931],[30.87944,55.28223],[30.97369,55.17134],[31.02071,55.06167],[31.00972,55.02783],[30.94243,55.03964],[30.9081,55.02232],[30.95754,54.98609],[30.93144,54.9585],[30.81759,54.94064],[30.8264,54.90062],[30.75165,54.80699],[30.95479,54.74346],[30.97127,54.71967],[31.0262,54.70698],[30.98226,54.68872],[30.99187,54.67046],[31.19339,54.66947],[31.21399,54.63113],[31.08543,54.50361],[31.22945,54.46585],[31.3177,54.34067],[31.30791,54.25315],[31.57002,54.14535],[31.89599,54.0837],[31.88744,54.03653],[31.85019,53.91801],[31.77028,53.80015],[31.89137,53.78099],[32.12621,53.81586],[32.36663,53.7166],[32.45717,53.74039],[32.50112,53.68594],[32.40499,53.6656],[32.47777,53.5548],[32.74968,53.45597],[32.73257,53.33494],[32.51725,53.28431],[32.40773,53.18856],[32.15368,53.07594],[31.82373,53.10042],[31.787,53.18033],[31.62496,53.22886],[31.56316,53.19432],[31.40523,53.21406],[31.36403,53.13504],[31.3915,53.09712],[31.33519,53.08805],[31.32283,53.04101],[31.24147,53.031],[31.35667,52.97854],[31.592,52.79011],[31.57277,52.71613],[31.50406,52.69707],[31.63869,52.55361],[31.56316,52.51518],[31.61397,52.48843],[31.62084,52.33849],[31.57971,52.32146],[31.70735,52.26711],[31.6895,52.1973],[31.77877,52.18636],[31.7822,52.11406],[31.81722,52.09955],[31.85018,52.11305],[31.96141,52.08015],[31.92159,52.05144],[32.08813,52.03319],[32.23331,52.08085],[32.2777,52.10266],[32.34044,52.1434],[32.33083,52.23685],[32.38988,52.24946],[32.3528,52.32842],[32.54781,52.32423],[32.69475,52.25535],[32.85405,52.27888],[32.89937,52.2461],[33.18913,52.3754],[33.51323,52.35779],[33.48027,52.31499],[33.55718,52.30324],[33.78789,52.37204],[34.05239,52.20132],[34.11199,52.14087],[34.09413,52.00835],[34.41136,51.82793],[34.42922,51.72852],[34.07765,51.67065],[34.17599,51.63253],[34.30562,51.5205],[34.22048,51.4187],[34.33446,51.363],[34.23009,51.26429],[34.31661,51.23936],[34.38802,51.2746],[34.6613,51.25053],[34.6874,51.18],[34.82472,51.17483],[34.97304,51.2342],[35.14058,51.23162],[35.12685,51.16191],[35.20375,51.04723],[35.31774,51.08434],[35.40837,51.04119],[35.32598,50.94524],[35.39307,50.92145],[35.41367,50.80227],[35.47704,50.77274],[35.48116,50.66405],[35.39464,50.64751],[35.47463,50.49247],[35.58003,50.45117],[35.61711,50.35707],[35.73659,50.35489],[35.80388,50.41356],[35.8926,50.43829],[36.06893,50.45205],[36.20763,50.3943],[36.30101,50.29088],[36.47817,50.31457],[36.58371,50.28563],[36.56655,50.2413],[36.64571,50.218],[36.69377,50.26982],[36.91762,50.34963],[37.08468,50.34935],[37.48204,50.46079],[37.47243,50.36277],[37.62486,50.29966],[37.62879,50.24481],[37.61113,50.21976],[37.75807,50.07896],[37.79515,50.08425],[37.90776,50.04194],[38.02999,49.94482],[38.02999,49.90592],[38.21675,49.98104],[38.18517,50.08161],[38.32524,50.08866],[38.35408,50.00664],[38.65688,49.97176],[38.68677,50.00904],[38.73311,49.90238],[38.90477,49.86787],[38.9391,49.79524],[39.1808,49.88911],[39.27968,49.75976],[39.44496,49.76067],[39.59142,49.73758],[39.65047,49.61761],[39.84548,49.56064],[40.13249,49.61672],[40.16683,49.56865],[40.03636,49.52321],[40.03087,49.45452],[40.1141,49.38798],[40.14912,49.37681],[40.18331,49.34996],[40.22176,49.25683],[40.01988,49.1761],[39.93437,49.05709],[39.6836,49.05121],[39.6683,48.99454],[39.71353,48.98959],[39.72649,48.9754],[39.74874,48.98675],[39.78368,48.91596],[39.98967,48.86901],[40.03636,48.91957],[40.08168,48.87443],[39.97182,48.79398],[39.79466,48.83739],[39.73104,48.7325],[39.71765,48.68673],[39.67226,48.59368],[39.79764,48.58668],[39.84548,48.57821],[39.86196,48.46633],[39.88794,48.44226],[39.94847,48.35055],[39.84136,48.33321],[39.84273,48.30947],[39.90041,48.3049],[39.91465,48.26743],[39.95248,48.29972],[39.9693,48.29904],[39.97325,48.31399],[39.99241,48.31768],[40.00752,48.22445],[39.94847,48.22811],[39.83724,48.06501],[39.88256,48.04482],[39.77544,48.04206],[39.82213,47.96396],[39.73935,47.82876],[38.87979,47.87719],[38.79628,47.81109],[38.76379,47.69346],[38.35062,47.61631],[38.28679,47.53552],[38.28954,47.39255],[38.22225,47.30788],[38.33074,47.30508],[38.32112,47.2585],[38.23049,47.2324],[38.22955,47.12069],[38.3384,46.98085],[38.12112,46.86078],[37.62608,46.82615],[35.23066,45.79231],[35.04991,45.76827],[36.6645,45.4514],[36.6545,45.3417],[36.5049,45.3136],[36.475,45.2411],[36.4883,45.0488],[33.5943,44.03313],[39.81147,43.06294],[40.0078,43.38551],[40.00853,43.40578],[40.01552,43.42025],[40.01007,43.42411],[40.03312,43.44262],[40.04445,43.47776],[40.10657,43.57344],[40.65957,43.56212],[41.64935,43.22331],[42.40563,43.23226],[42.66667,43.13917],[42.75889,43.19651],[43.03322,43.08883],[43.0419,43.02413],[43.81453,42.74297],[43.73119,42.62043],[43.95517,42.55396],[44.54202,42.75699],[44.70002,42.74679],[44.80941,42.61277],[44.88754,42.74934],[45.15318,42.70598],[45.36501,42.55268],[45.78692,42.48358],[45.61676,42.20768],[46.42738,41.91323],[46.5332,41.87389],[46.58924,41.80547],[46.75269,41.8623],[46.8134,41.76252],[47.00955,41.63583],[46.99554,41.59743],[47.03757,41.55434],[47.10762,41.59044],[47.34579,41.27884],[47.49004,41.26366],[47.54504,41.20275],[47.62288,41.22969],[47.75831,41.19455],[47.87973,41.21798],[48.07587,41.49957],[48.22064,41.51472],[48.2878,41.56221],[48.40277,41.60441],[48.42301,41.65444],[48.55078,41.77917],[48.5867,41.84306],[48.80971,41.95365],[49.2134,44.84989],[49.88945,46.04554],[49.32259,46.26944],[49.16518,46.38542],[48.54988,46.56267],[48.51142,46.69268],[49.01136,46.72716],[48.52326,47.4102],[48.45173,47.40818],[48.15348,47.74545],[47.64973,47.76559],[47.41689,47.83687],[47.38731,47.68176],[47.12107,47.83687],[47.11516,48.27188],[46.49011,48.43019],[46.78392,48.95352],[47.00857,49.04921],[47.04658,49.19834],[46.78398,49.34026],[46.9078,49.86707],[47.18319,49.93721],[47.34589,50.09308],[47.30448,50.30894],[47.58551,50.47867],[48.10044,50.09242],[48.24519,49.86099],[48.42564,49.82283],[48.68352,49.89546],[48.90782,50.02281],[48.57946,50.63278],[48.86936,50.61589],[49.12673,50.78639],[49.41959,50.85927],[49.39001,51.09396],[49.76866,51.11067],[49.97277,51.2405],[50.26859,51.28677],[50.59695,51.61859],[51.26254,51.68466],[51.301,51.48799],[51.77431,51.49536],[51.8246,51.67916],[52.36119,51.74161],[52.54329,51.48444],[53.46165,51.49445],[53.69299,51.23466],[54.12248,51.11542],[54.46331,50.85554],[54.41894,50.61214],[54.55797,50.52006],[54.71476,50.61214],[54.56685,51.01958],[54.72067,51.03261],[55.67774,50.54508],[56.11398,50.7471],[56.17906,50.93204],[57.17302,51.11253],[57.44221,50.88354],[57.74986,50.93017],[57.75578,51.13852],[58.3208,51.15151],[58.87974,50.70852],[59.48928,50.64216],[59.51886,50.49937],[59.81172,50.54451],[60.01288,50.8163],[60.17262,50.83312],[60.31914,50.67705],[60.81833,50.6629],[61.4431,50.80679],[61.56889,51.23679],[61.6813,51.25716],[61.55114,51.32746],[61.50677,51.40687],[60.95655,51.48615],[60.92401,51.61124],[60.5424,51.61675],[60.36787,51.66815],[60.50986,51.7964],[60.09867,51.87135],[59.99809,51.98263],[59.91279,52.06924],[60.17253,52.25814],[60.17516,52.39457],[59.25033,52.46803],[59.22409,52.28437],[58.79644,52.43392],[58.94336,53.953],[59.70487,54.14846],[59.95217,54.85853],[57.95234,54.39672],[57.14829,54.84204],[57.25137,55.26262],[58.81825,55.03378],[59.49035,55.60486],[59.28419,56.15739],[57.51527,56.08729],[57.28024,56.87898],[58.07604,57.08308],[58.13789,57.68097],[58.81412,57.71602],[58.71104,58.07475],[59.40376,58.45822],[59.15636,59.14682],[58.3853,59.487],[59.50685,60.91162],[59.36223,61.3882],[59.61398,62.44915],[59.24834,63.01859],[59.80579,64.13948],[59.63945,64.78384],[60.74386,64.95767],[61.98014,65.72191],[66.1708,67.61252],[64.18965,69.94255],[76.13964,83.37843],[36.85549,84.09565],[32.07813,72.01005],[31.59909,70.16571],[30.84095,69.80584],[30.95011,69.54699],[30.52662,69.54699],[30.16363,69.65244],[29.97205,69.41623],[29.27631,69.2811],[29.26623,69.13794],[29.0444,69.0119],[28.91738,69.04774],[28.45957,68.91417],[28.78224,68.86696],[28.43941,68.53366],[28.62982,68.19816],[29.34179,68.06655],[29.66955,67.79872],[30.02041,67.67523],[29.91155,67.51507],[28.9839,66.94139],[29.91155,66.13863],[30.16363,65.66935],[29.97205,65.70256],[29.74013,65.64025],[29.84096,65.56945],[29.68972,65.31803],[29.61914,65.23791],[29.8813,65.22101],[29.84096,65.1109],[29.61914,65.05993],[29.68972,64.80789],[30.05271,64.79072],[30.12329,64.64862],[30.01238,64.57513],[30.06279,64.35782],[30.4762,64.25728],[30.55687,64.09036],[30.25437,63.83364],[29.98213,63.75795],[30.49637,63.46666],[31.23244,63.22239],[31.29294,63.09035],[31.58535,62.91642],[31.38369,62.66284],[31.10136,62.43042],[29.01829,61.17448],[28.82816,61.1233],[28.47974,60.93365],[27.77352,60.52722],[27.71177,60.3893],[27.44953,60.22766],[26.32936,60.00121]]]]}},{type:"Feature",properties:{wikidata:"Q1083368",nameEn:"Mainland Finland",country:"FI",groups:["EU","154","150","UN"],callingCodes:["358"]},geometry:{type:"MultiPolygon",coordinates:[[[[29.12697,69.69193],[28.36883,69.81658],[28.32849,69.88605],[27.97558,69.99671],[27.95542,70.0965],[27.57226,70.06215],[27.05802,69.92069],[26.64461,69.96565],[26.40261,69.91377],[25.96904,69.68397],[25.69679,69.27039],[25.75729,68.99383],[25.61613,68.89602],[25.42455,68.90328],[25.12206,68.78684],[25.10189,68.63307],[24.93048,68.61102],[24.90023,68.55579],[24.74898,68.65143],[24.18432,68.73936],[24.02299,68.81601],[23.781,68.84514],[23.68017,68.70276],[23.13064,68.64684],[22.53321,68.74393],[22.38367,68.71561],[22.27276,68.89514],[21.63833,69.27485],[21.27827,69.31281],[21.00732,69.22755],[20.98641,69.18809],[21.11099,69.10291],[21.05775,69.0356],[20.72171,69.11874],[20.55258,69.06069],[20.78802,69.03087],[20.91658,68.96764],[20.85104,68.93142],[20.90649,68.89696],[21.03001,68.88969],[22.00429,68.50692],[22.73028,68.40881],[23.10336,68.26551],[23.15377,68.14759],[23.26469,68.15134],[23.40081,68.05545],[23.65793,67.9497],[23.45627,67.85297],[23.54701,67.59306],[23.39577,67.46974],[23.75372,67.43688],[23.75372,67.29914],[23.54701,67.25435],[23.58735,67.20752],[23.56214,67.17038],[23.98563,66.84149],[23.98059,66.79585],[23.89488,66.772],[23.85959,66.56434],[23.63776,66.43568],[23.67591,66.3862],[23.64982,66.30603],[23.71339,66.21299],[23.90497,66.15802],[24.15791,65.85385],[24.14798,65.83466],[24.15107,65.81427],[24.14112,65.39731],[20.15877,63.06556],[19.23413,60.61414],[20.96741,60.71528],[21.15143,60.54555],[21.08159,60.20167],[21.02509,60.12142],[21.35468,59.67511],[20.5104,59.15546],[26.32936,60.00121],[27.44953,60.22766],[27.71177,60.3893],[27.77352,60.52722],[28.47974,60.93365],[28.82816,61.1233],[29.01829,61.17448],[31.10136,62.43042],[31.38369,62.66284],[31.58535,62.91642],[31.29294,63.09035],[31.23244,63.22239],[30.49637,63.46666],[29.98213,63.75795],[30.25437,63.83364],[30.55687,64.09036],[30.4762,64.25728],[30.06279,64.35782],[30.01238,64.57513],[30.12329,64.64862],[30.05271,64.79072],[29.68972,64.80789],[29.61914,65.05993],[29.84096,65.1109],[29.8813,65.22101],[29.61914,65.23791],[29.68972,65.31803],[29.84096,65.56945],[29.74013,65.64025],[29.97205,65.70256],[30.16363,65.66935],[29.91155,66.13863],[28.9839,66.94139],[29.91155,67.51507],[30.02041,67.67523],[29.66955,67.79872],[29.34179,68.06655],[28.62982,68.19816],[28.43941,68.53366],[28.78224,68.86696],[28.45957,68.91417],[28.91738,69.04774],[28.81248,69.11997],[28.8629,69.22395],[29.31664,69.47994],[29.12697,69.69193]]]]}},{type:"Feature",properties:{wikidata:"Q1184963",nameEn:"Alhucemas Islands",country:"ES",groups:["EU","Q191011","015","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[-3.90602,35.21494],[-3.88372,35.20767],[-3.89343,35.22728],[-3.90602,35.21494]]]]}},{type:"Feature",properties:{wikidata:"Q1298289",nameEn:"Egmont Islands",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[70.1848,-6.37445],[70.67958,-8.2663],[72.17991,-6.68509],[70.1848,-6.37445]]]]}},{type:"Feature",properties:{wikidata:"Q1352230",nameEn:"US Territories",country:"US",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q1451600",nameEn:"Overseas Countries and Territories of the EU",aliases:["OCT"],level:"subunion"},geometry:null},{type:"Feature",properties:{wikidata:"Q1544253",nameEn:"Great Chagos Bank",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[70.1848,-6.37445],[72.17991,-6.68509],[73.20573,-5.20727],[70.1848,-6.37445]]]]}},{type:"Feature",properties:{wikidata:"Q1585511",nameEn:"Salomon Atoll",country:"GB",groups:["IO","BOTS","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[72.09518,-5.61768],[73.20573,-5.20727],[72.12587,-4.02588],[72.09518,-5.61768]]]]}},{type:"Feature",properties:{wikidata:"Q1681727",nameEn:"Saint-Paul and Amsterdam",country:"FR",groups:["EU","TF","Q1451600","014","202","002","UN"],level:"subterritory"},geometry:{type:"MultiPolygon",coordinates:[[[[76.31747,-42.16264],[80.15867,-36.04977],[71.22311,-38.75287],[76.31747,-42.16264]]]]}},{type:"Feature",properties:{wikidata:"Q1901211",nameEn:"East Malaysia",country:"MY",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["60"]},geometry:{type:"MultiPolygon",coordinates:[[[[110.90339,7.52694],[109.82788,2.86812],[109.62558,1.99182],[109.53794,1.91771],[109.57923,1.80624],[109.66397,1.79972],[109.66397,1.60425],[110.35354,.98869],[110.49182,.88088],[110.62374,.873],[111.22979,1.08326],[111.55434,.97864],[111.82846,.99349],[111.94553,1.12016],[112.15679,1.17004],[112.2127,1.44135],[112.48648,1.56516],[113.021,1.57819],[113.01448,1.42832],[113.64677,1.23933],[114.03788,1.44787],[114.57892,1.5],[114.80706,1.92351],[114.80706,2.21665],[115.1721,2.49671],[115.11343,2.82879],[115.53713,3.14776],[115.58276,3.93499],[115.90217,4.37708],[117.25801,4.35108],[117.47313,4.18857],[117.67641,4.16535],[118.06469,4.16638],[118.93936,4.09009],[119.52945,5.35672],[117.98544,6.27477],[117.93857,6.89845],[117.17735,7.52841],[116.79524,7.43869],[115.02521,5.35005],[115.16236,5.01011],[115.15092,4.87604],[115.20737,4.8256],[115.27819,4.63661],[115.2851,4.42295],[115.36346,4.33563],[115.31275,4.30806],[115.09978,4.39123],[115.07737,4.53418],[115.04064,4.63706],[115.02278,4.74137],[115.02955,4.82087],[115.05038,4.90275],[114.99417,4.88201],[114.96982,4.81146],[114.88841,4.81905],[114.8266,4.75062],[114.77303,4.72871],[114.83189,4.42387],[114.88039,4.4257],[114.78539,4.12205],[114.64211,4.00694],[114.49922,4.13108],[114.4416,4.27588],[114.32176,4.2552],[114.32176,4.34942],[114.26876,4.49878],[114.15813,4.57],[114.07448,4.58441],[114.10166,4.76112],[110.90339,7.52694]]]]}},{type:"Feature",properties:{wikidata:"Q1973345",nameEn:"Peninsular Malaysia",country:"MY",groups:["035","142","UN"],driveSide:"left",callingCodes:["60"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.46318,7.22462],[102.09086,6.23546],[102.08127,6.22679],[102.07732,6.193],[102.09182,6.14161],[102.01835,6.05407],[101.99209,6.04075],[101.97114,6.01992],[101.9714,6.00575],[101.94712,5.98421],[101.92819,5.85511],[101.91776,5.84269],[101.89188,5.8386],[101.80144,5.74505],[101.75074,5.79091],[101.69773,5.75881],[101.58019,5.93534],[101.25524,5.78633],[101.25755,5.71065],[101.14062,5.61613],[100.98815,5.79464],[101.02708,5.91013],[101.087,5.9193],[101.12388,6.11411],[101.06165,6.14161],[101.12618,6.19431],[101.10313,6.25617],[100.85884,6.24929],[100.81045,6.45086],[100.74822,6.46231],[100.74361,6.50811],[100.66986,6.45086],[100.43027,6.52389],[100.42351,6.51762],[100.41791,6.5189],[100.41152,6.52299],[100.35413,6.54932],[100.31929,6.65413],[100.32607,6.65933],[100.32671,6.66526],[100.31884,6.66423],[100.31618,6.66781],[100.30828,6.66462],[100.29651,6.68439],[100.19511,6.72559],[100.12,6.42105],[100.0756,6.4045],[99.91873,6.50233],[99.50117,6.44501],[99.31854,5.99868],[99.75778,3.86466],[103.03657,1.30383],[103.56591,1.19719],[103.62738,1.35255],[103.67468,1.43166],[103.7219,1.46108],[103.74161,1.4502],[103.76395,1.45183],[103.81181,1.47953],[103.86383,1.46288],[103.89565,1.42841],[103.93384,1.42926],[104.00131,1.42405],[104.02277,1.4438],[104.04622,1.44691],[104.07348,1.43322],[104.08871,1.42015],[104.09162,1.39694],[104.08072,1.35998],[104.12282,1.27714],[104.34728,1.33529],[104.56723,1.44271],[105.01437,3.24936],[102.46318,7.22462]]]]}},{type:"Feature",properties:{wikidata:"Q2093907",nameEn:"Three Kings Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[174.17679,-32.62487],[170.93268,-32.97889],[171.97383,-34.64644],[174.17679,-32.62487]]]]}},{type:"Feature",properties:{wikidata:"Q2298216",nameEn:"Solander Islands",country:"NZ",groups:["Q851132","053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[167.39068,-46.49187],[166.5534,-46.39484],[166.84561,-46.84889],[167.39068,-46.49187]]]]}},{type:"Feature",properties:{wikidata:"Q2872203",nameEn:"Mainland Australia",country:"AU",groups:["053","009","UN"],level:"subcountryGroup",driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[88.16419,-23.49578],[123.64533,-39.13605],[159.74028,-39.1978],[159.76765,-29.76946],[154.02855,-24.43238],[152.93188,-20.92631],[147.69992,-17.5933],[145.2855,-9.62524],[143.87386,-9.02382],[143.29772,-9.33993],[142.48658,-9.36754],[142.19246,-9.15378],[141.88934,-9.36111],[141.01842,-9.35091],[135.49042,-9.2276],[127.55165,-9.05052],[125.29076,-12.33139],[88.16419,-23.49578]]]]}},{type:"Feature",properties:{wikidata:"Q2914565",nameEn:"Autonomous Regions of Portugal",country:"PT",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q2915956",nameEn:"Mainland Portugal",country:"PT",groups:["Q12837","EU","039","150","UN"],level:"subcountryGroup",callingCodes:["351"]},geometry:{type:"MultiPolygon",coordinates:[[[[-10.39881,36.12218],[-7.37282,36.96896],[-7.39769,37.16868],[-7.41133,37.20314],[-7.41854,37.23813],[-7.43227,37.25152],[-7.43974,37.38913],[-7.46878,37.47127],[-7.51759,37.56119],[-7.41981,37.75729],[-7.33441,37.81193],[-7.27314,37.90145],[-7.24544,37.98884],[-7.12648,38.00296],[-7.10366,38.04404],[-7.05966,38.01966],[-7.00375,38.01914],[-6.93418,38.21454],[-7.09389,38.17227],[-7.15581,38.27597],[-7.32529,38.44336],[-7.265,38.61674],[-7.26174,38.72107],[-7.03848,38.87221],[-7.051,38.907],[-6.95211,39.0243],[-6.97004,39.07619],[-7.04011,39.11919],[-7.10692,39.10275],[-7.14929,39.11287],[-7.12811,39.17101],[-7.23566,39.20132],[-7.23403,39.27579],[-7.3149,39.34857],[-7.2927,39.45847],[-7.49477,39.58794],[-7.54121,39.66717],[-7.33507,39.64569],[-7.24707,39.66576],[-7.01613,39.66877],[-6.97492,39.81488],[-6.91463,39.86618],[-6.86737,40.01986],[-6.94233,40.10716],[-7.00589,40.12087],[-7.02544,40.18564],[-7.00426,40.23169],[-6.86085,40.26776],[-6.86085,40.2976],[-6.80218,40.33239],[-6.78426,40.36468],[-6.84618,40.42177],[-6.84944,40.46394],[-6.7973,40.51723],[-6.80218,40.55067],[-6.84292,40.56801],[-6.79567,40.65955],[-6.82826,40.74603],[-6.82337,40.84472],[-6.79892,40.84842],[-6.80707,40.88047],[-6.84292,40.89771],[-6.8527,40.93958],[-6.9357,41.02888],[-6.913,41.03922],[-6.88843,41.03027],[-6.84781,41.02692],[-6.80942,41.03629],[-6.79241,41.05397],[-6.75655,41.10187],[-6.77319,41.13049],[-6.69711,41.1858],[-6.68286,41.21641],[-6.65046,41.24725],[-6.55937,41.24417],[-6.38551,41.35274],[-6.38553,41.38655],[-6.3306,41.37677],[-6.26777,41.48796],[-6.19128,41.57638],[-6.29863,41.66432],[-6.44204,41.68258],[-6.49907,41.65823],[-6.54633,41.68623],[-6.56426,41.74219],[-6.51374,41.8758],[-6.56752,41.88429],[-6.5447,41.94371],[-6.58544,41.96674],[-6.61967,41.94008],[-6.75004,41.94129],[-6.76959,41.98734],[-6.81196,41.99097],[-6.82174,41.94493],[-6.94396,41.94403],[-6.95537,41.96553],[-6.98144,41.9728],[-7.01078,41.94977],[-7.07596,41.94977],[-7.08574,41.97401],[-7.14115,41.98855],[-7.18549,41.97515],[-7.18677,41.88793],[-7.32366,41.8406],[-7.37092,41.85031],[-7.42864,41.80589],[-7.42854,41.83262],[-7.44759,41.84451],[-7.45566,41.86488],[-7.49803,41.87095],[-7.52737,41.83939],[-7.62188,41.83089],[-7.58603,41.87944],[-7.65774,41.88308],[-7.69848,41.90977],[-7.84188,41.88065],[-7.88055,41.84571],[-7.88751,41.92553],[-7.90707,41.92432],[-7.92336,41.8758],[-7.9804,41.87337],[-8.01136,41.83453],[-8.0961,41.81024],[-8.16455,41.81753],[-8.16944,41.87944],[-8.19551,41.87459],[-8.2185,41.91237],[-8.16232,41.9828],[-8.08796,42.01398],[-8.08847,42.05767],[-8.11729,42.08537],[-8.18178,42.06436],[-8.19406,42.12141],[-8.18947,42.13853],[-8.1986,42.15402],[-8.22406,42.1328],[-8.24681,42.13993],[-8.2732,42.12396],[-8.29809,42.106],[-8.32161,42.10218],[-8.33912,42.08358],[-8.36353,42.09065],[-8.38323,42.07683],[-8.40143,42.08052],[-8.42512,42.07199],[-8.44123,42.08218],[-8.48185,42.0811],[-8.52837,42.07658],[-8.5252,42.06264],[-8.54563,42.0537],[-8.58086,42.05147],[-8.59493,42.05708],[-8.63791,42.04691],[-8.64626,42.03668],[-8.65832,42.02972],[-8.6681,41.99703],[-8.69071,41.98862],[-8.7478,41.96282],[-8.74606,41.9469],[-8.75712,41.92833],[-8.81794,41.90375],[-8.87157,41.86488],[-11.19304,41.83075],[-10.39881,36.12218]]]]}},{type:"Feature",properties:{wikidata:"Q3311985",nameEn:"Guernsey",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.49556,49.79012],[-3.28154,49.57329],[-2.65349,49.15373],[-2.36485,49.48223],[-2.49556,49.79012]]]]}},{type:"Feature",properties:{wikidata:"Q3320166",nameEn:"Outermost Regions of the EU",aliases:["OMR"],level:"subunion"},geometry:null},{type:"Feature",properties:{wikidata:"Q3336843",nameEn:"Countries of the United Kingdom",aliases:["GB-UKM"],country:"GB",level:"subcountryGroup"},geometry:null},{type:"Feature",properties:{wikidata:"Q6736667",nameEn:"Mainland India",country:"IN",groups:["034","142","UN"],driveSide:"left",callingCodes:["91"]},geometry:{type:"MultiPolygon",coordinates:[[[[89.08044,21.41871],[89.07114,22.15335],[88.9367,22.58527],[88.94614,22.66941],[88.9151,22.75228],[88.96713,22.83346],[88.87063,22.95235],[88.88327,23.03885],[88.86377,23.08759],[88.99148,23.21134],[88.71133,23.2492],[88.79254,23.46028],[88.79351,23.50535],[88.74841,23.47361],[88.56507,23.64044],[88.58087,23.87105],[88.66189,23.87607],[88.73743,23.91751],[88.6976,24.14703],[88.74841,24.1959],[88.68801,24.31464],[88.50934,24.32474],[88.12296,24.51301],[88.08786,24.63232],[88.00683,24.66477],[88.15515,24.85806],[88.14004,24.93529],[88.21832,24.96642],[88.27325,24.88796],[88.33917,24.86803],[88.46277,25.07468],[88.44766,25.20149],[88.94067,25.18534],[89.00463,25.26583],[89.01105,25.30303],[88.85278,25.34679],[88.81296,25.51546],[88.677,25.46959],[88.4559,25.59227],[88.45103,25.66245],[88.242,25.80811],[88.13138,25.78773],[88.08804,25.91334],[88.16581,26.0238],[88.1844,26.14417],[88.34757,26.22216],[88.35153,26.29123],[88.51649,26.35923],[88.48749,26.45855],[88.36938,26.48683],[88.35153,26.45241],[88.33093,26.48929],[88.41196,26.63837],[88.4298,26.54489],[88.62144,26.46783],[88.69485,26.38353],[88.67837,26.26291],[88.78961,26.31093],[88.85004,26.23211],[89.05328,26.2469],[88.91321,26.37984],[88.92357,26.40711],[88.95612,26.4564],[89.08899,26.38845],[89.15869,26.13708],[89.35953,26.0077],[89.53515,26.00382],[89.57101,25.9682],[89.63968,26.22595],[89.70201,26.15138],[89.73581,26.15818],[89.77865,26.08387],[89.77728,26.04254],[89.86592,25.93115],[89.80585,25.82489],[89.84388,25.70042],[89.86129,25.61714],[89.81208,25.37244],[89.84086,25.31854],[89.83371,25.29548],[89.87629,25.28337],[89.90478,25.31038],[90.1155,25.22686],[90.40034,25.1534],[90.65042,25.17788],[90.87427,25.15799],[91.25517,25.20677],[91.63648,25.12846],[92.0316,25.1834],[92.33957,25.07593],[92.39147,25.01471],[92.49887,24.88796],[92.38626,24.86055],[92.25854,24.9191],[92.15796,24.54435],[92.11662,24.38997],[91.96603,24.3799],[91.89258,24.14674],[91.82596,24.22345],[91.76004,24.23848],[91.73257,24.14703],[91.65292,24.22095],[91.63782,24.1132],[91.55542,24.08687],[91.37414,24.10693],[91.35741,23.99072],[91.29587,24.0041],[91.22308,23.89616],[91.25192,23.83463],[91.15579,23.6599],[91.28293,23.37538],[91.36453,23.06612],[91.40848,23.07117],[91.4035,23.27522],[91.46615,23.2328],[91.54993,23.01051],[91.61571,22.93929],[91.7324,23.00043],[91.81634,23.08001],[91.76417,23.26619],[91.84789,23.42235],[91.95642,23.47361],[91.95093,23.73284],[92.04706,23.64229],[92.15417,23.73409],[92.26541,23.70392],[92.38214,23.28705],[92.37665,22.9435],[92.5181,22.71441],[92.60029,22.1522],[92.56616,22.13554],[92.60949,21.97638],[92.67532,22.03547],[92.70416,22.16017],[92.86208,22.05456],[92.89504,21.95143],[92.93899,22.02656],[92.99804,21.98964],[92.99255,22.05965],[93.04885,22.20595],[93.15734,22.18687],[93.14224,22.24535],[93.19991,22.25425],[93.18206,22.43716],[93.13537,22.45873],[93.11477,22.54374],[93.134,22.59573],[93.09417,22.69459],[93.134,22.92498],[93.12988,23.05772],[93.2878,23.00464],[93.38478,23.13698],[93.36862,23.35426],[93.38781,23.36139],[93.39981,23.38828],[93.38805,23.4728],[93.43475,23.68299],[93.3908,23.7622],[93.3908,23.92925],[93.36059,23.93176],[93.32351,24.04468],[93.34735,24.10151],[93.41415,24.07854],[93.46633,23.97067],[93.50616,23.94432],[93.62871,24.00922],[93.75952,24.0003],[93.80279,23.92549],[93.92089,23.95812],[94.14081,23.83333],[94.30215,24.23752],[94.32362,24.27692],[94.45279,24.56656],[94.50729,24.59281],[94.5526,24.70764],[94.60204,24.70889],[94.73937,25.00545],[94.74212,25.13606],[94.57458,25.20318],[94.68032,25.47003],[94.80117,25.49359],[95.18556,26.07338],[95.11428,26.1019],[95.12801,26.38397],[95.05798,26.45408],[95.23513,26.68499],[95.30339,26.65372],[95.437,26.7083],[95.81603,27.01335],[95.93002,27.04149],[96.04949,27.19428],[96.15591,27.24572],[96.40779,27.29818],[96.55761,27.29928],[96.73888,27.36638],[96.88445,27.25046],[96.85287,27.2065],[96.89132,27.17474],[97.14675,27.09041],[97.17422,27.14052],[96.91431,27.45752],[96.90112,27.62149],[97.29919,27.92233],[97.35824,27.87256],[97.38845,28.01329],[97.35412,28.06663],[97.31292,28.06784],[97.34547,28.21385],[97.1289,28.3619],[96.98882,28.32564],[96.88445,28.39452],[96.85561,28.4875],[96.6455,28.61657],[96.48895,28.42955],[96.40929,28.51526],[96.61391,28.72742],[96.3626,29.10607],[96.20467,29.02325],[96.18682,29.11087],[96.31316,29.18643],[96.05361,29.38167],[95.84899,29.31464],[95.75149,29.32063],[95.72086,29.20797],[95.50842,29.13487],[95.41091,29.13007],[95.3038,29.13847],[95.26122,29.07727],[95.2214,29.10727],[95.11291,29.09527],[95.0978,29.14446],[94.81353,29.17804],[94.69318,29.31739],[94.2752,29.11687],[94.35897,29.01965],[93.72797,28.68821],[93.44621,28.67189],[93.18069,28.50319],[93.14635,28.37035],[92.93075,28.25671],[92.67486,28.15018],[92.65472,28.07632],[92.73025,28.05814],[92.7275,27.98662],[92.42538,27.80092],[92.32101,27.79363],[92.27432,27.89077],[91.87057,27.7195],[91.84722,27.76325],[91.6469,27.76358],[91.55819,27.6144],[91.65007,27.48287],[92.01132,27.47352],[92.12019,27.27829],[92.04702,27.26861],[92.03457,27.07334],[92.11863,26.893],[92.05523,26.8692],[91.83181,26.87318],[91.50067,26.79223],[90.67715,26.77215],[90.48504,26.8594],[90.39271,26.90704],[90.30402,26.85098],[90.04535,26.72422],[89.86124,26.73307],[89.63369,26.74402],[89.42349,26.83727],[89.3901,26.84225],[89.38319,26.85963],[89.37913,26.86224],[89.1926,26.81329],[89.12825,26.81661],[89.09554,26.89089],[88.95807,26.92668],[88.92301,26.99286],[88.8714,26.97488],[88.86984,27.10937],[88.74219,27.144],[88.91901,27.32483],[88.82981,27.38814],[88.77517,27.45415],[88.88091,27.85192],[88.83559,28.01936],[88.63235,28.12356],[88.54858,28.06057],[88.25332,27.9478],[88.1278,27.95417],[88.13378,27.88015],[88.1973,27.85067],[88.19107,27.79285],[88.04008,27.49223],[88.07277,27.43007],[88.01646,27.21612],[88.01587,27.21388],[87.9887,27.11045],[88.11719,26.98758],[88.13422,26.98705],[88.12302,26.95324],[88.19107,26.75516],[88.1659,26.68177],[88.16452,26.64111],[88.09963,26.54195],[88.09414,26.43732],[88.00895,26.36029],[87.90115,26.44923],[87.89085,26.48565],[87.84193,26.43663],[87.7918,26.46737],[87.76004,26.40711],[87.67893,26.43501],[87.66803,26.40294],[87.59175,26.38342],[87.55274,26.40596],[87.51571,26.43106],[87.46566,26.44058],[87.37314,26.40815],[87.34568,26.34787],[87.26568,26.37294],[87.26587,26.40592],[87.24682,26.4143],[87.18863,26.40558],[87.14751,26.40542],[87.09147,26.45039],[87.0707,26.58571],[87.04691,26.58685],[87.01559,26.53228],[86.95912,26.52076],[86.94543,26.52076],[86.82898,26.43919],[86.76797,26.45892],[86.74025,26.42386],[86.69124,26.45169],[86.62686,26.46891],[86.61313,26.48658],[86.57073,26.49825],[86.54258,26.53819],[86.49726,26.54218],[86.31564,26.61925],[86.26235,26.61886],[86.22513,26.58863],[86.13596,26.60651],[86.02729,26.66756],[85.8492,26.56667],[85.85126,26.60866],[85.83126,26.61134],[85.76907,26.63076],[85.72315,26.67471],[85.73483,26.79613],[85.66239,26.84822],[85.61621,26.86721],[85.59461,26.85161],[85.5757,26.85955],[85.56471,26.84133],[85.47752,26.79292],[85.34302,26.74954],[85.21159,26.75933],[85.18046,26.80519],[85.19291,26.86909],[85.15883,26.86966],[85.02635,26.85381],[85.05592,26.88991],[85.00536,26.89523],[84.97186,26.9149],[84.96687,26.95599],[84.85754,26.98984],[84.82913,27.01989],[84.793,26.9968],[84.64496,27.04669],[84.69166,27.21294],[84.62161,27.33885],[84.29315,27.39],[84.25735,27.44941],[84.21376,27.45218],[84.10791,27.52399],[84.02229,27.43836],[83.93306,27.44939],[83.86182,27.4241],[83.85595,27.35797],[83.61288,27.47013],[83.39495,27.4798],[83.38872,27.39276],[83.35136,27.33885],[83.29999,27.32778],[83.2673,27.36235],[83.27197,27.38309],[83.19413,27.45632],[82.94938,27.46036],[82.93261,27.50328],[82.74119,27.49838],[82.70378,27.72122],[82.46405,27.6716],[82.06554,27.92222],[81.97214,27.93322],[81.91223,27.84995],[81.47867,28.08303],[81.48179,28.12148],[81.38683,28.17638],[81.32923,28.13521],[81.19847,28.36284],[81.03471,28.40054],[80.55142,28.69182],[80.50575,28.6706],[80.52443,28.54897],[80.44504,28.63098],[80.37188,28.63371],[80.12125,28.82346],[80.06957,28.82763],[80.05743,28.91479],[80.18085,29.13649],[80.23178,29.11626],[80.26602,29.13938],[80.24112,29.21414],[80.28626,29.20327],[80.31428,29.30784],[80.24322,29.44299],[80.37939,29.57098],[80.41858,29.63581],[80.38428,29.68513],[80.36803,29.73865],[80.41554,29.79451],[80.43458,29.80466],[80.48997,29.79566],[80.56247,29.86661],[80.57179,29.91422],[80.60226,29.95732],[80.67076,29.95732],[80.8778,30.13384],[80.86673,30.17321],[80.91143,30.22173],[80.92547,30.17193],[81.03953,30.20059],[80.83343,30.32023],[80.54504,30.44936],[80.20721,30.58541],[79.93255,30.88288],[79.59884,30.93943],[79.30694,31.17357],[79.14016,31.43403],[79.01931,31.42817],[78.89344,31.30481],[78.77898,31.31209],[78.71032,31.50197],[78.84516,31.60631],[78.69933,31.78723],[78.78036,31.99478],[78.74404,32.00384],[78.68754,32.10256],[78.49609,32.2762],[78.4645,32.45367],[78.38897,32.53938],[78.73916,32.69438],[78.7831,32.46873],[78.96713,32.33655],[78.99322,32.37948],[79.0979,32.38051],[79.13174,32.47766],[79.26768,32.53277],[79.46562,32.69668],[79.14016,33.02545],[79.15252,33.17156],[78.73636,33.56521],[78.67599,33.66445],[78.77349,33.73871],[78.73367,34.01121],[78.65657,34.03195],[78.66225,34.08858],[78.91769,34.15452],[78.99802,34.3027],[79.05364,34.32482],[78.74465,34.45174],[78.56475,34.50835],[78.54964,34.57283],[78.27781,34.61484],[78.18435,34.7998],[78.22692,34.88771],[78.00033,35.23954],[78.03466,35.3785],[78.11664,35.48022],[77.80532,35.52058],[77.70232,35.46244],[77.44277,35.46132],[76.96624,35.5932],[76.84539,35.67356],[76.77323,35.66062],[76.75475,35.52617],[76.85088,35.39754],[76.93465,35.39866],[77.11796,35.05419],[76.99251,34.93349],[76.87193,34.96906],[76.74514,34.92488],[76.74377,34.84039],[76.67648,34.76371],[76.47186,34.78965],[76.15463,34.6429],[76.04614,34.67566],[75.75438,34.51827],[75.38009,34.55021],[75.01479,34.64629],[74.6663,34.703],[74.58083,34.77386],[74.31239,34.79626],[74.12897,34.70073],[73.96423,34.68244],[73.93401,34.63386],[73.93951,34.57169],[73.89419,34.54568],[73.88732,34.48911],[73.74999,34.3781],[73.74862,34.34183],[73.8475,34.32935],[73.90517,34.35317],[73.98208,34.2522],[73.90677,34.10504],[73.88732,34.05105],[73.91341,34.01235],[74.21554,34.03853],[74.25262,34.01577],[74.26086,33.92237],[74.14001,33.83002],[74.05898,33.82089],[74.00891,33.75437],[73.96423,33.73071],[73.98968,33.66155],[73.97367,33.64061],[74.03576,33.56718],[74.10115,33.56392],[74.18121,33.4745],[74.17983,33.3679],[74.08782,33.26232],[74.01366,33.25199],[74.02144,33.18908],[74.15374,33.13477],[74.17571,33.07495],[74.31854,33.02891],[74.34875,32.97823],[74.31227,32.92795],[74.41467,32.90563],[74.45312,32.77755],[74.6289,32.75561],[74.64675,32.82604],[74.7113,32.84219],[74.65345,32.71225],[74.69542,32.66792],[74.64424,32.60985],[74.65251,32.56416],[74.67431,32.56676],[74.68362,32.49298],[74.84725,32.49075],[74.97634,32.45367],[75.03265,32.49538],[75.28259,32.36556],[75.38046,32.26836],[75.25649,32.10187],[75.00793,32.03786],[74.9269,32.0658],[74.86236,32.04485],[74.79919,31.95983],[74.58907,31.87824],[74.47771,31.72227],[74.57498,31.60382],[74.61517,31.55698],[74.59319,31.50197],[74.64713,31.45605],[74.59773,31.4136],[74.53223,31.30321],[74.51629,31.13829],[74.56023,31.08303],[74.60281,31.10419],[74.60006,31.13711],[74.6852,31.12771],[74.67971,31.05479],[74.5616,31.04153],[73.88993,30.36305],[73.95736,30.28466],[73.97225,30.19829],[73.80299,30.06969],[73.58665,30.01848],[73.3962,29.94707],[73.28094,29.56646],[73.05886,29.1878],[73.01337,29.16422],[72.94272,29.02487],[72.40402,28.78283],[72.29495,28.66367],[72.20329,28.3869],[71.9244,28.11555],[71.89921,27.96035],[70.79054,27.68423],[70.60927,28.02178],[70.37307,28.01208],[70.12502,27.8057],[70.03136,27.56627],[69.58519,27.18109],[69.50904,26.74892],[69.88555,26.56836],[70.05584,26.60398],[70.17532,26.55362],[70.17532,26.24118],[70.08193,26.08094],[70.0985,25.93238],[70.2687,25.71156],[70.37444,25.67443],[70.53649,25.68928],[70.60378,25.71898],[70.67382,25.68186],[70.66695,25.39314],[70.89148,25.15064],[70.94002,24.92843],[71.09405,24.69017],[70.97594,24.60904],[71.00341,24.46038],[71.12838,24.42662],[71.04461,24.34657],[70.94985,24.3791],[70.85784,24.30903],[70.88393,24.27398],[70.71502,24.23517],[70.57906,24.27774],[70.5667,24.43787],[70.11712,24.30915],[70.03428,24.172],[69.73335,24.17007],[69.59579,24.29777],[69.29778,24.28712],[69.19341,24.25646],[69.07806,24.29777],[68.97781,24.26021],[68.90914,24.33156],[68.7416,24.31904],[68.74643,23.97027],[68.39339,23.96838],[68.20763,23.85849],[68.11329,23.53945],[76.59015,5.591],[79.50447,8.91876],[79.42124,9.80115],[80.48418,10.20786],[89.08044,21.41871]]]]}},{type:"Feature",properties:{wikidata:"Q9143535",nameEn:"Akrotiri",country:"GB",groups:["Q644636","Q37362","BOTS","145","142","UN"],level:"subterritory",driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.86014,34.70585],[32.82717,34.70622],[32.79433,34.67883],[32.76136,34.68318],[32.75515,34.64985],[32.74412,34.43926],[33.26744,34.49942],[33.0138,34.64424],[32.96968,34.64046],[32.96718,34.63446],[32.96312,34.63236],[32.95516,34.63541],[32.95323,34.64075],[32.95471,34.64528],[32.95277,34.65104],[32.96154,34.65587],[32.9639,34.65866],[32.969,34.6549],[32.98046,34.65336],[32.99014,34.65518],[32.98668,34.67268],[32.98967,34.67981],[32.95567,34.6839],[32.94127,34.67426],[32.93989,34.67034],[32.93756,34.67072],[32.93535,34.66317],[32.92824,34.66821],[32.93043,34.67091],[32.91398,34.67343],[32.9068,34.66102],[32.86167,34.68734],[32.86014,34.70585]]]]}},{type:"Feature",properties:{wikidata:"Q9206745",nameEn:"Dhekelia",country:"GB",groups:["Q644636","Q37362","BOTS","145","142","UN"],level:"subterritory",driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.70575,34.97947],[33.83531,34.73974],[33.98684,34.76642],[33.90146,34.96458],[33.86018,34.97381],[33.84741,34.97167],[33.84028,34.97179],[33.83459,34.97448],[33.84616,34.98511],[33.85488,34.98462],[33.85891,35.001],[33.85216,35.00579],[33.84045,35.00616],[33.82875,35.01685],[33.83055,35.02865],[33.81524,35.04192],[33.8012,35.04786],[33.82051,35.0667],[33.8355,35.05777],[33.85261,35.0574],[33.87438,35.08118],[33.89322,35.06789],[33.90247,35.07686],[33.91789,35.08688],[33.89853,35.11377],[33.88737,35.11408],[33.88943,35.12007],[33.88561,35.12449],[33.87224,35.12293],[33.87622,35.10457],[33.87097,35.09389],[33.87479,35.08881],[33.8541,35.07201],[33.84168,35.06823],[33.82067,35.07826],[33.78581,35.05104],[33.76106,35.04253],[33.73824,35.05321],[33.71482,35.03722],[33.70209,35.04882],[33.7161,35.07279],[33.70861,35.07644],[33.69095,35.06237],[33.68474,35.06602],[33.67742,35.05963],[33.67678,35.03866],[33.69938,35.03123],[33.69731,35.01754],[33.71514,35.00294],[33.70639,34.99303],[33.70575,34.97947]],[[33.77312,34.9976],[33.77553,34.99518],[33.78516,34.99582],[33.79191,34.98914],[33.78917,34.98854],[33.78571,34.98951],[33.78318,34.98699],[33.78149,34.98854],[33.77843,34.988],[33.7778,34.98981],[33.76738,34.99188],[33.76605,34.99543],[33.75682,34.99916],[33.75994,35.00113],[33.77312,34.9976]],[[33.74144,35.01053],[33.7343,35.01178],[33.73781,35.02181],[33.74265,35.02329],[33.74983,35.02274],[33.7492,35.01319],[33.74144,35.01053]]]]}},{type:"Feature",properties:{wikidata:"Q16390686",nameEn:"Peninsular Spain",country:"ES",groups:["Q12837","EU","039","150","UN"],callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[3.75438,42.33445],[3.17156,42.43545],[3.11379,42.43646],[3.10027,42.42621],[3.08167,42.42748],[3.03734,42.47363],[2.96518,42.46692],[2.94283,42.48174],[2.92107,42.4573],[2.88413,42.45938],[2.86983,42.46843],[2.85675,42.45444],[2.84335,42.45724],[2.77464,42.41046],[2.75497,42.42578],[2.72056,42.42298],[2.65311,42.38771],[2.6747,42.33974],[2.57934,42.35808],[2.55516,42.35351],[2.54382,42.33406],[2.48457,42.33933],[2.43508,42.37568],[2.43299,42.39423],[2.38504,42.39977],[2.25551,42.43757],[2.20578,42.41633],[2.16599,42.42314],[2.12789,42.41291],[2.11621,42.38393],[2.06241,42.35906],[2.00488,42.35399],[1.96482,42.37787],[1.9574,42.42401],[1.94084,42.43039],[1.94061,42.43333],[1.94292,42.44316],[1.93663,42.45439],[1.88853,42.4501],[1.83037,42.48395],[1.76335,42.48863],[1.72515,42.50338],[1.70571,42.48867],[1.66826,42.50779],[1.65674,42.47125],[1.58933,42.46275],[1.57953,42.44957],[1.55937,42.45808],[1.55073,42.43299],[1.5127,42.42959],[1.44529,42.43724],[1.43838,42.47848],[1.41648,42.48315],[1.46661,42.50949],[1.44759,42.54431],[1.41245,42.53539],[1.4234,42.55959],[1.44529,42.56722],[1.42512,42.58292],[1.44197,42.60217],[1.35562,42.71944],[1.15928,42.71407],[1.0804,42.78569],[.98292,42.78754],[.96166,42.80629],[.93089,42.79154],[.711,42.86372],[.66121,42.84021],[.65421,42.75872],[.67873,42.69458],[.40214,42.69779],[.36251,42.72282],[.29407,42.67431],[.25336,42.7174],[.17569,42.73424],[-.02468,42.68513],[-.10519,42.72761],[-.16141,42.79535],[-.17939,42.78974],[-.3122,42.84788],[-.38833,42.80132],[-.41319,42.80776],[-.44334,42.79939],[-.50863,42.82713],[-.55497,42.77846],[-.67637,42.88303],[-.69837,42.87945],[-.72608,42.89318],[-.73422,42.91228],[-.72037,42.92541],[-.75478,42.96916],[-.81652,42.95166],[-.97133,42.96239],[-1.00963,42.99279],[-1.10333,43.0059],[-1.22881,43.05534],[-1.25244,43.04164],[-1.30531,43.06859],[-1.30052,43.09581],[-1.27118,43.11961],[-1.32209,43.1127],[-1.34419,43.09665],[-1.35272,43.02658],[-1.44067,43.047],[-1.47555,43.08372],[-1.41562,43.12815],[-1.3758,43.24511],[-1.40942,43.27272],[-1.45289,43.27049],[-1.50992,43.29481],[-1.55963,43.28828],[-1.57674,43.25269],[-1.61341,43.25269],[-1.63052,43.28591],[-1.62481,43.30726],[-1.69407,43.31378],[-1.73074,43.29481],[-1.7397,43.32979],[-1.75079,43.3317],[-1.75334,43.34107],[-1.77068,43.34396],[-1.78714,43.35476],[-1.78332,43.36399],[-1.79319,43.37497],[-1.77289,43.38957],[-1.81005,43.59738],[-10.14298,44.17365],[-11.19304,41.83075],[-8.87157,41.86488],[-8.81794,41.90375],[-8.75712,41.92833],[-8.74606,41.9469],[-8.7478,41.96282],[-8.69071,41.98862],[-8.6681,41.99703],[-8.65832,42.02972],[-8.64626,42.03668],[-8.63791,42.04691],[-8.59493,42.05708],[-8.58086,42.05147],[-8.54563,42.0537],[-8.5252,42.06264],[-8.52837,42.07658],[-8.48185,42.0811],[-8.44123,42.08218],[-8.42512,42.07199],[-8.40143,42.08052],[-8.38323,42.07683],[-8.36353,42.09065],[-8.33912,42.08358],[-8.32161,42.10218],[-8.29809,42.106],[-8.2732,42.12396],[-8.24681,42.13993],[-8.22406,42.1328],[-8.1986,42.15402],[-8.18947,42.13853],[-8.19406,42.12141],[-8.18178,42.06436],[-8.11729,42.08537],[-8.08847,42.05767],[-8.08796,42.01398],[-8.16232,41.9828],[-8.2185,41.91237],[-8.19551,41.87459],[-8.16944,41.87944],[-8.16455,41.81753],[-8.0961,41.81024],[-8.01136,41.83453],[-7.9804,41.87337],[-7.92336,41.8758],[-7.90707,41.92432],[-7.88751,41.92553],[-7.88055,41.84571],[-7.84188,41.88065],[-7.69848,41.90977],[-7.65774,41.88308],[-7.58603,41.87944],[-7.62188,41.83089],[-7.52737,41.83939],[-7.49803,41.87095],[-7.45566,41.86488],[-7.44759,41.84451],[-7.42854,41.83262],[-7.42864,41.80589],[-7.37092,41.85031],[-7.32366,41.8406],[-7.18677,41.88793],[-7.18549,41.97515],[-7.14115,41.98855],[-7.08574,41.97401],[-7.07596,41.94977],[-7.01078,41.94977],[-6.98144,41.9728],[-6.95537,41.96553],[-6.94396,41.94403],[-6.82174,41.94493],[-6.81196,41.99097],[-6.76959,41.98734],[-6.75004,41.94129],[-6.61967,41.94008],[-6.58544,41.96674],[-6.5447,41.94371],[-6.56752,41.88429],[-6.51374,41.8758],[-6.56426,41.74219],[-6.54633,41.68623],[-6.49907,41.65823],[-6.44204,41.68258],[-6.29863,41.66432],[-6.19128,41.57638],[-6.26777,41.48796],[-6.3306,41.37677],[-6.38553,41.38655],[-6.38551,41.35274],[-6.55937,41.24417],[-6.65046,41.24725],[-6.68286,41.21641],[-6.69711,41.1858],[-6.77319,41.13049],[-6.75655,41.10187],[-6.79241,41.05397],[-6.80942,41.03629],[-6.84781,41.02692],[-6.88843,41.03027],[-6.913,41.03922],[-6.9357,41.02888],[-6.8527,40.93958],[-6.84292,40.89771],[-6.80707,40.88047],[-6.79892,40.84842],[-6.82337,40.84472],[-6.82826,40.74603],[-6.79567,40.65955],[-6.84292,40.56801],[-6.80218,40.55067],[-6.7973,40.51723],[-6.84944,40.46394],[-6.84618,40.42177],[-6.78426,40.36468],[-6.80218,40.33239],[-6.86085,40.2976],[-6.86085,40.26776],[-7.00426,40.23169],[-7.02544,40.18564],[-7.00589,40.12087],[-6.94233,40.10716],[-6.86737,40.01986],[-6.91463,39.86618],[-6.97492,39.81488],[-7.01613,39.66877],[-7.24707,39.66576],[-7.33507,39.64569],[-7.54121,39.66717],[-7.49477,39.58794],[-7.2927,39.45847],[-7.3149,39.34857],[-7.23403,39.27579],[-7.23566,39.20132],[-7.12811,39.17101],[-7.14929,39.11287],[-7.10692,39.10275],[-7.04011,39.11919],[-6.97004,39.07619],[-6.95211,39.0243],[-7.051,38.907],[-7.03848,38.87221],[-7.26174,38.72107],[-7.265,38.61674],[-7.32529,38.44336],[-7.15581,38.27597],[-7.09389,38.17227],[-6.93418,38.21454],[-7.00375,38.01914],[-7.05966,38.01966],[-7.10366,38.04404],[-7.12648,38.00296],[-7.24544,37.98884],[-7.27314,37.90145],[-7.33441,37.81193],[-7.41981,37.75729],[-7.51759,37.56119],[-7.46878,37.47127],[-7.43974,37.38913],[-7.43227,37.25152],[-7.41854,37.23813],[-7.41133,37.20314],[-7.39769,37.16868],[-7.37282,36.96896],[-7.2725,35.73269],[-5.10878,36.05227],[-2.27707,35.35051],[3.75438,42.33445]],[[-5.27801,36.14942],[-5.34064,36.03744],[-5.40526,36.15488],[-5.34536,36.15501],[-5.33822,36.15272],[-5.27801,36.14942]]],[[[1.99838,42.44682],[2.01564,42.45171],[1.99216,42.46208],[1.98579,42.47486],[1.99766,42.4858],[1.98916,42.49351],[1.98022,42.49569],[1.97697,42.48568],[1.97227,42.48487],[1.97003,42.48081],[1.96215,42.47854],[1.95606,42.45785],[1.96125,42.45364],[1.98378,42.44697],[1.99838,42.44682]]]]}},{type:"Feature",properties:{wikidata:"Q98059339",nameEn:"Mainland Norway",country:"NO",groups:["154","150","UN"],callingCodes:["47"]},geometry:{type:"MultiPolygon",coordinates:[[[[10.40861,58.38489],[10.64958,58.89391],[11.08911,58.98745],[11.15367,59.07862],[11.34459,59.11672],[11.4601,58.99022],[11.45199,58.89604],[11.65732,58.90177],[11.8213,59.24985],[11.69297,59.59442],[11.92112,59.69531],[11.87121,59.86039],[12.15641,59.8926],[12.36317,59.99259],[12.52003,60.13846],[12.59133,60.50559],[12.2277,61.02442],[12.69115,61.06584],[12.86939,61.35427],[12.57707,61.56547],[12.40595,61.57226],[12.14746,61.7147],[12.29187,62.25699],[12.07085,62.6297],[12.19919,63.00104],[11.98529,63.27487],[12.19919,63.47935],[12.14928,63.59373],[12.74105,64.02171],[13.23411,64.09087],[13.98222,64.00953],[14.16051,64.18725],[14.11117,64.46674],[13.64276,64.58402],[14.50926,65.31786],[14.53778,66.12399],[15.05113,66.15572],[15.49318,66.28509],[15.37197,66.48217],[16.35589,67.06419],[16.39154,67.21653],[16.09922,67.4364],[16.12774,67.52106],[16.38441,67.52923],[16.7409,67.91037],[17.30416,68.11591],[17.90787,67.96537],[18.13836,68.20874],[18.1241,68.53721],[18.39503,68.58672],[18.63032,68.50849],[18.97255,68.52416],[19.93508,68.35911],[20.22027,68.48759],[19.95647,68.55546],[20.22027,68.67246],[20.33435,68.80174],[20.28444,68.93283],[20.0695,69.04469],[20.55258,69.06069],[20.72171,69.11874],[21.05775,69.0356],[21.11099,69.10291],[20.98641,69.18809],[21.00732,69.22755],[21.27827,69.31281],[21.63833,69.27485],[22.27276,68.89514],[22.38367,68.71561],[22.53321,68.74393],[23.13064,68.64684],[23.68017,68.70276],[23.781,68.84514],[24.02299,68.81601],[24.18432,68.73936],[24.74898,68.65143],[24.90023,68.55579],[24.93048,68.61102],[25.10189,68.63307],[25.12206,68.78684],[25.42455,68.90328],[25.61613,68.89602],[25.75729,68.99383],[25.69679,69.27039],[25.96904,69.68397],[26.40261,69.91377],[26.64461,69.96565],[27.05802,69.92069],[27.57226,70.06215],[27.95542,70.0965],[27.97558,69.99671],[28.32849,69.88605],[28.36883,69.81658],[29.12697,69.69193],[29.31664,69.47994],[28.8629,69.22395],[28.81248,69.11997],[28.91738,69.04774],[29.0444,69.0119],[29.26623,69.13794],[29.27631,69.2811],[29.97205,69.41623],[30.16363,69.65244],[30.52662,69.54699],[30.95011,69.54699],[30.84095,69.80584],[31.59909,70.16571],[32.07813,72.01005],[-11.60274,67.73467],[7.28637,57.35913],[10.40861,58.38489]]]]}},{type:"Feature",properties:{wikidata:"Q98543636",nameEn:"Mainland Ecuador",country:"EC",groups:["005","419","019","UN"],callingCodes:["593"]},geometry:{type:"MultiPolygon",coordinates:[[[[-84.52388,-3.36941],[-80.30602,-3.39149],[-80.20647,-3.431],[-80.24123,-3.46124],[-80.24586,-3.48677],[-80.23651,-3.48652],[-80.22629,-3.501],[-80.20535,-3.51667],[-80.21642,-3.5888],[-80.19848,-3.59249],[-80.18741,-3.63994],[-80.19926,-3.68894],[-80.13232,-3.90317],[-80.46386,-4.01342],[-80.4822,-4.05477],[-80.45023,-4.20938],[-80.32114,-4.21323],[-80.46386,-4.41516],[-80.39256,-4.48269],[-80.13945,-4.29786],[-79.79722,-4.47558],[-79.59402,-4.46848],[-79.26248,-4.95167],[-79.1162,-4.97774],[-79.01659,-5.01481],[-78.85149,-4.66795],[-78.68394,-4.60754],[-78.34362,-3.38633],[-78.24589,-3.39907],[-78.22642,-3.51113],[-78.14324,-3.47653],[-78.19369,-3.36431],[-77.94147,-3.05454],[-76.6324,-2.58397],[-76.05203,-2.12179],[-75.57429,-1.55961],[-75.3872,-.9374],[-75.22862,-.95588],[-75.22862,-.60048],[-75.53615,-.19213],[-75.60169,-.18708],[-75.61997,-.10012],[-75.40192,-.17196],[-75.25764,-.11943],[-75.82927,.09578],[-76.23441,.42294],[-76.41215,.38228],[-76.4094,.24015],[-76.89177,.24736],[-77.52001,.40782],[-77.49984,.64476],[-77.67815,.73863],[-77.66416,.81604],[-77.68613,.83029],[-77.7148,.85003],[-77.85677,.80197],[-78.42749,1.15389],[-78.87137,1.47457],[-82.12561,4.00341],[-84.52388,-3.36941]]]]}},{type:"Feature",properties:{m49:"001",wikidata:"Q2",nameEn:"World",aliases:["Earth","Planet"],level:"world"},geometry:null},{type:"Feature",properties:{m49:"002",wikidata:"Q15",nameEn:"Africa",level:"region"},geometry:null},{type:"Feature",properties:{m49:"003",wikidata:"Q49",nameEn:"North America",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"005",wikidata:"Q18",nameEn:"South America",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"009",wikidata:"Q538",nameEn:"Oceania",level:"region"},geometry:null},{type:"Feature",properties:{m49:"011",wikidata:"Q4412",nameEn:"Western Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"013",wikidata:"Q27611",nameEn:"Central America",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"014",wikidata:"Q27407",nameEn:"Eastern Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"015",wikidata:"Q27381",nameEn:"Northern Africa",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"017",wikidata:"Q27433",nameEn:"Middle Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"018",wikidata:"Q27394",nameEn:"Southern Africa",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"019",wikidata:"Q828",nameEn:"Americas",level:"region"},geometry:null},{type:"Feature",properties:{m49:"021",wikidata:"Q2017699",nameEn:"Northern America",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"029",wikidata:"Q664609",nameEn:"Caribbean",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{m49:"030",wikidata:"Q27231",nameEn:"Eastern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"034",wikidata:"Q771405",nameEn:"Southern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"035",wikidata:"Q11708",nameEn:"South-eastern Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"039",wikidata:"Q27449",nameEn:"Southern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"053",wikidata:"Q45256",nameEn:"Australia and New Zealand",aliases:["Australasia"],level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"054",wikidata:"Q37394",nameEn:"Melanesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"057",wikidata:"Q3359409",nameEn:"Micronesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"061",wikidata:"Q35942",nameEn:"Polynesia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"142",wikidata:"Q48",nameEn:"Asia",level:"region"},geometry:null},{type:"Feature",properties:{m49:"143",wikidata:"Q27275",nameEn:"Central Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"145",wikidata:"Q27293",nameEn:"Western Asia",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"150",wikidata:"Q46",nameEn:"Europe",level:"region"},geometry:null},{type:"Feature",properties:{m49:"151",wikidata:"Q27468",nameEn:"Eastern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"154",wikidata:"Q27479",nameEn:"Northern Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"155",wikidata:"Q27496",nameEn:"Western Europe",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"202",wikidata:"Q132959",nameEn:"Sub-Saharan Africa",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"419",wikidata:"Q72829598",nameEn:"Latin America and the Caribbean",level:"subregion"},geometry:null},{type:"Feature",properties:{m49:"830",wikidata:"Q42314",nameEn:"Channel Islands",level:"intermediateRegion"},geometry:null},{type:"Feature",properties:{iso1A2:"AC",iso1A3:"ASC",wikidata:"Q46197",nameEn:"Ascension Island",aliases:["SH-AC"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],isoStatus:"excRes",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["247"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.82771,-8.70814],[-13.33271,-8.07391],[-14.91926,-6.63386],[-14.82771,-8.70814]]]]}},{type:"Feature",properties:{iso1A2:"AD",iso1A3:"AND",iso1N3:"020",wikidata:"Q228",nameEn:"Andorra",groups:["Q12837","039","150","UN"],callingCodes:["376"]},geometry:{type:"MultiPolygon",coordinates:[[[[1.72515,42.50338],[1.73683,42.55492],[1.7858,42.57698],[1.72588,42.59098],[1.73452,42.61515],[1.68267,42.62533],[1.6625,42.61982],[1.63485,42.62957],[1.60085,42.62703],[1.55418,42.65669],[1.50867,42.64483],[1.48043,42.65203],[1.46718,42.63296],[1.47986,42.61346],[1.44197,42.60217],[1.42512,42.58292],[1.44529,42.56722],[1.4234,42.55959],[1.41245,42.53539],[1.44759,42.54431],[1.46661,42.50949],[1.41648,42.48315],[1.43838,42.47848],[1.44529,42.43724],[1.5127,42.42959],[1.55073,42.43299],[1.55937,42.45808],[1.57953,42.44957],[1.58933,42.46275],[1.65674,42.47125],[1.66826,42.50779],[1.70571,42.48867],[1.72515,42.50338]]]]}},{type:"Feature",properties:{iso1A2:"AE",iso1A3:"ARE",iso1N3:"784",wikidata:"Q878",nameEn:"United Arab Emirates",groups:["145","142","UN"],callingCodes:["971"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.26534,25.62825],[56.25341,25.61443],[56.26636,25.60643],[56.25365,25.60211],[56.20473,25.61119],[56.18363,25.65508],[56.14826,25.66351],[56.13579,25.73524],[56.17416,25.77239],[56.13963,25.82765],[56.19334,25.9795],[56.15498,26.06828],[56.08666,26.05038],[55.81777,26.18798],[55.14145,25.62624],[53.97892,24.64436],[52.82259,25.51697],[52.35509,25.00368],[52.02277,24.75635],[51.83108,24.71675],[51.58834,24.66608],[51.41644,24.39615],[51.58871,24.27256],[51.59617,24.12041],[52.56622,22.94341],[55.13599,22.63334],[55.2137,22.71065],[55.22634,23.10378],[55.57358,23.669],[55.48677,23.94946],[55.73301,24.05994],[55.8308,24.01633],[56.01799,24.07426],[55.95472,24.2172],[55.83367,24.20193],[55.77658,24.23476],[55.76558,24.23227],[55.75257,24.23466],[55.75382,24.2466],[55.75939,24.26114],[55.76781,24.26209],[55.79145,24.27914],[55.80747,24.31069],[55.83395,24.32776],[55.83271,24.41521],[55.76461,24.5287],[55.83271,24.68567],[55.83408,24.77858],[55.81348,24.80102],[55.81116,24.9116],[55.85094,24.96858],[55.90849,24.96771],[55.96316,25.00857],[56.05715,24.95727],[56.05106,24.87461],[55.97467,24.89639],[55.97836,24.87673],[56.03535,24.81161],[56.06128,24.74457],[56.13684,24.73699],[56.20062,24.78565],[56.20568,24.85063],[56.30269,24.88334],[56.34873,24.93205],[56.3227,24.97284],[56.86325,25.03856],[56.82555,25.7713],[56.26534,25.62825]],[[56.26062,25.33108],[56.3005,25.31815],[56.3111,25.30107],[56.35172,25.30681],[56.34438,25.26653],[56.27628,25.23404],[56.24341,25.22867],[56.20872,25.24104],[56.20838,25.25668],[56.24465,25.27505],[56.25008,25.28843],[56.23362,25.31253],[56.26062,25.33108]]],[[[56.28423,25.26344],[56.29379,25.2754],[56.28102,25.28486],[56.2716,25.27916],[56.27086,25.26128],[56.28423,25.26344]]]]}},{type:"Feature",properties:{iso1A2:"AF",iso1A3:"AFG",iso1N3:"004",wikidata:"Q889",nameEn:"Afghanistan",groups:["034","142","UN"],callingCodes:["93"]},geometry:{type:"MultiPolygon",coordinates:[[[[70.61526,38.34774],[70.60407,38.28046],[70.54673,38.24541],[70.4898,38.12546],[70.17206,37.93276],[70.1863,37.84296],[70.27694,37.81258],[70.28243,37.66706],[70.15015,37.52519],[69.95971,37.5659],[69.93362,37.61378],[69.84435,37.60616],[69.80041,37.5746],[69.51888,37.5844],[69.44954,37.4869],[69.36645,37.40462],[69.45022,37.23315],[69.39529,37.16752],[69.25152,37.09426],[69.03274,37.25174],[68.96407,37.32603],[68.88168,37.33368],[68.91189,37.26704],[68.80889,37.32494],[68.81438,37.23862],[68.6798,37.27906],[68.61851,37.19815],[68.41888,37.13906],[68.41201,37.10402],[68.29253,37.10621],[68.27605,37.00977],[68.18542,37.02074],[68.02194,36.91923],[67.87917,37.0591],[67.7803,37.08978],[67.78329,37.1834],[67.51868,37.26102],[67.2581,37.17216],[67.2224,37.24545],[67.13039,37.27168],[67.08232,37.35469],[66.95598,37.40162],[66.64699,37.32958],[66.55743,37.35409],[66.30993,37.32409],[65.72274,37.55438],[65.64137,37.45061],[65.64263,37.34388],[65.51778,37.23881],[64.97945,37.21913],[64.61141,36.6351],[64.62514,36.44311],[64.57295,36.34362],[64.43288,36.24401],[64.05385,36.10433],[63.98519,36.03773],[63.56496,35.95106],[63.53475,35.90881],[63.29579,35.85985],[63.12276,35.86208],[63.10318,35.81782],[63.23262,35.67487],[63.10079,35.63024],[63.12276,35.53196],[63.0898,35.43131],[62.90853,35.37086],[62.74098,35.25432],[62.62288,35.22067],[62.48006,35.28796],[62.29878,35.13312],[62.29191,35.25964],[62.15871,35.33278],[62.05709,35.43803],[61.97743,35.4604],[61.77693,35.41341],[61.58742,35.43803],[61.27371,35.61482],[61.18187,35.30249],[61.0991,35.27845],[61.12831,35.09938],[61.06926,34.82139],[61.00197,34.70631],[60.99922,34.63064],[60.72316,34.52857],[60.91321,34.30411],[60.66502,34.31539],[60.50209,34.13992],[60.5838,33.80793],[60.5485,33.73422],[60.57762,33.59772],[60.69573,33.56054],[60.91133,33.55596],[60.88908,33.50219],[60.56485,33.12944],[60.86191,32.22565],[60.84541,31.49561],[61.70929,31.37391],[61.80569,31.16167],[61.80957,31.12576],[61.83257,31.0452],[61.8335,30.97669],[61.78268,30.92724],[61.80829,30.84224],[60.87231,29.86514],[62.47751,29.40782],[63.5876,29.50456],[64.12966,29.39157],[64.19796,29.50407],[64.62116,29.58903],[65.04005,29.53957],[66.24175,29.85181],[66.36042,29.9583],[66.23609,30.06321],[66.34869,30.404],[66.28413,30.57001],[66.39194,30.9408],[66.42645,30.95309],[66.58175,30.97532],[66.68166,31.07597],[66.72561,31.20526],[66.83273,31.26867],[67.04147,31.31561],[67.03323,31.24519],[67.29964,31.19586],[67.78854,31.33203],[67.7748,31.4188],[67.62374,31.40473],[67.58323,31.52772],[67.72056,31.52304],[67.86887,31.63536],[68.00071,31.6564],[68.1655,31.82691],[68.25614,31.80357],[68.27605,31.75863],[68.44222,31.76446],[68.57475,31.83158],[68.6956,31.75687],[68.79997,31.61665],[68.91078,31.59687],[68.95995,31.64822],[69.00939,31.62249],[69.11514,31.70782],[69.20577,31.85957],[69.3225,31.93186],[69.27032,32.14141],[69.27932,32.29119],[69.23599,32.45946],[69.2868,32.53938],[69.38155,32.56601],[69.44747,32.6678],[69.43649,32.7302],[69.38018,32.76601],[69.47082,32.85834],[69.5436,32.8768],[69.49854,32.88843],[69.49004,33.01509],[69.57656,33.09911],[69.71526,33.09911],[69.79766,33.13247],[69.85259,33.09451],[70.02563,33.14282],[70.07369,33.22557],[70.13686,33.21064],[70.32775,33.34496],[70.17062,33.53535],[70.20141,33.64387],[70.14785,33.6553],[70.14236,33.71701],[70.00503,33.73528],[69.85671,33.93719],[69.87307,33.9689],[69.90203,34.04194],[70.54336,33.9463],[70.88119,33.97933],[71.07345,34.06242],[71.06933,34.10564],[71.09307,34.11961],[71.09453,34.13524],[71.13078,34.16503],[71.12815,34.26619],[71.17662,34.36769],[71.02401,34.44835],[71.0089,34.54568],[71.11602,34.63047],[71.08718,34.69034],[71.28356,34.80882],[71.29472,34.87728],[71.50329,34.97328],[71.49917,35.00478],[71.55273,35.02615],[71.52938,35.09023],[71.67495,35.21262],[71.5541,35.28776],[71.54294,35.31037],[71.65435,35.4479],[71.49917,35.6267],[71.55273,35.71483],[71.37969,35.95865],[71.19505,36.04134],[71.60491,36.39429],[71.80267,36.49924],[72.18135,36.71838],[72.6323,36.84601],[73.82685,36.91421],[74.04856,36.82648],[74.43389,37.00977],[74.53739,36.96224],[74.56453,37.03023],[74.49981,37.24518],[74.80605,37.21565],[74.88887,37.23275],[74.8294,37.3435],[74.68383,37.3948],[74.56161,37.37734],[74.41055,37.3948],[74.23339,37.41116],[74.20308,37.34208],[73.8564,37.26158],[73.82552,37.22659],[73.64974,37.23643],[73.61129,37.27469],[73.76647,37.33913],[73.77197,37.4417],[73.29633,37.46495],[73.06884,37.31729],[72.79693,37.22222],[72.66381,37.02014],[72.54095,37.00007],[72.31676,36.98115],[71.83229,36.68084],[71.67083,36.67346],[71.57195,36.74943],[71.51502,36.89128],[71.48481,36.93218],[71.46923,36.99925],[71.45578,37.03094],[71.43097,37.05855],[71.44127,37.11856],[71.4494,37.18137],[71.4555,37.21418],[71.47386,37.2269],[71.48339,37.23937],[71.4824,37.24921],[71.48536,37.26017],[71.50674,37.31502],[71.49821,37.31975],[71.4862,37.33405],[71.47685,37.40281],[71.49612,37.4279],[71.5256,37.47971],[71.50616,37.50733],[71.49693,37.53527],[71.5065,37.60912],[71.51972,37.61945],[71.54186,37.69691],[71.55234,37.73209],[71.53053,37.76534],[71.54324,37.77104],[71.55752,37.78677],[71.59255,37.79956],[71.58843,37.92425],[71.51565,37.95349],[71.32871,37.88564],[71.296,37.93403],[71.2809,37.91995],[71.24969,37.93031],[71.27278,37.96496],[71.27622,37.99946],[71.28922,38.01272],[71.29878,38.04429],[71.36444,38.15358],[71.37803,38.25641],[71.33869,38.27335],[71.33114,38.30339],[71.21291,38.32797],[71.1451,38.40106],[71.10957,38.40671],[71.10592,38.42077],[71.09542,38.42517],[71.0556,38.40176],[71.03545,38.44779],[70.98693,38.48862],[70.92728,38.43021],[70.88719,38.46826],[70.84376,38.44688],[70.82538,38.45394],[70.81697,38.44507],[70.80521,38.44447],[70.79766,38.44944],[70.78702,38.45031],[70.78581,38.45502],[70.77132,38.45548],[70.75455,38.4252],[70.72485,38.4131],[70.69807,38.41861],[70.67438,38.40597],[70.6761,38.39144],[70.69189,38.37031],[70.64966,38.34999],[70.61526,38.34774]]]]}},{type:"Feature",properties:{iso1A2:"AG",iso1A3:"ATG",iso1N3:"028",wikidata:"Q781",nameEn:"Antigua and Barbuda",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 268"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.66959,18.6782],[-62.58307,16.68909],[-62.1023,16.97277],[-61.23098,16.62484],[-61.66959,18.6782]]]]}},{type:"Feature",properties:{iso1A2:"AI",iso1A3:"AIA",iso1N3:"660",wikidata:"Q25228",nameEn:"Anguilla",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 264"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.79029,19.11219],[-63.35989,18.06012],[-62.62718,18.26185],[-63.79029,19.11219]]]]}},{type:"Feature",properties:{iso1A2:"AL",iso1A3:"ALB",iso1N3:"008",wikidata:"Q222",nameEn:"Albania",groups:["039","150","UN"],callingCodes:["355"]},geometry:{type:"MultiPolygon",coordinates:[[[[20.07761,42.55582],[20.01834,42.54622],[20.00842,42.5109],[19.9324,42.51699],[19.82333,42.46581],[19.76549,42.50237],[19.74731,42.57422],[19.77375,42.58517],[19.73244,42.66299],[19.65972,42.62774],[19.4836,42.40831],[19.42352,42.36546],[19.42,42.33019],[19.28623,42.17745],[19.40687,42.10024],[19.37548,42.06835],[19.36867,42.02564],[19.37691,41.96977],[19.34601,41.95675],[19.33812,41.90669],[19.37451,41.8842],[19.37597,41.84849],[19.26406,41.74971],[19.0384,40.35325],[19.95905,39.82857],[19.97622,39.78684],[19.92466,39.69533],[19.98042,39.6504],[20.00957,39.69227],[20.05189,39.69112],[20.12956,39.65805],[20.15988,39.652],[20.22376,39.64532],[20.22707,39.67459],[20.27412,39.69884],[20.31961,39.72799],[20.29152,39.80421],[20.30804,39.81563],[20.38572,39.78516],[20.41475,39.81437],[20.41546,39.82832],[20.31135,39.99438],[20.37911,39.99058],[20.42373,40.06777],[20.48487,40.06271],[20.51297,40.08168],[20.55593,40.06524],[20.61081,40.07866],[20.62566,40.0897],[20.67162,40.09433],[20.71789,40.27739],[20.78234,40.35803],[20.7906,40.42726],[20.83688,40.47882],[20.94925,40.46625],[20.96908,40.51526],[21.03932,40.56299],[21.05833,40.66586],[20.98134,40.76046],[20.95752,40.76982],[20.98396,40.79109],[20.97887,40.85475],[20.97693,40.90103],[20.94305,40.92399],[20.83671,40.92752],[20.81567,40.89662],[20.73504,40.9081],[20.71634,40.91781],[20.65558,41.08009],[20.63454,41.0889],[20.59832,41.09066],[20.58546,41.11179],[20.59715,41.13644],[20.51068,41.2323],[20.49432,41.33679],[20.52119,41.34381],[20.55976,41.4087],[20.51301,41.442],[20.49039,41.49277],[20.45331,41.51436],[20.45809,41.5549],[20.52103,41.56473],[20.55508,41.58113],[20.51769,41.65975],[20.52937,41.69292],[20.51301,41.72433],[20.53405,41.78099],[20.57144,41.7897],[20.55976,41.87068],[20.59524,41.8818],[20.57946,41.91593],[20.63069,41.94913],[20.59434,42.03879],[20.55633,42.08173],[20.56955,42.12097],[20.48857,42.25444],[20.3819,42.3029],[20.34479,42.32656],[20.24399,42.32168],[20.21797,42.41237],[20.17127,42.50469],[20.07761,42.55582]]]]}},{type:"Feature",properties:{iso1A2:"AM",iso1A3:"ARM",iso1N3:"051",wikidata:"Q399",nameEn:"Armenia",groups:["145","142","UN"],callingCodes:["374"]},geometry:{type:"MultiPolygon",coordinates:[[[[45.0133,41.29747],[44.93493,41.25685],[44.81437,41.30371],[44.80053,41.25949],[44.81749,41.23488],[44.84358,41.23088],[44.89911,41.21366],[44.87887,41.20195],[44.82084,41.21513],[44.72814,41.20338],[44.61462,41.24018],[44.59322,41.1933],[44.46791,41.18204],[44.34417,41.2382],[44.34337,41.20312],[44.32139,41.2079],[44.18148,41.24644],[44.16591,41.19141],[43.84835,41.16329],[43.74717,41.1117],[43.67712,41.13398],[43.4717,41.12611],[43.44984,41.0988],[43.47319,41.02251],[43.58683,40.98961],[43.67712,40.93084],[43.67712,40.84846],[43.74872,40.7365],[43.7425,40.66805],[43.63664,40.54159],[43.54791,40.47413],[43.60862,40.43267],[43.59928,40.34019],[43.71136,40.16673],[43.65221,40.14889],[43.65688,40.11199],[43.92307,40.01787],[44.1057,40.03555],[44.1778,40.02845],[44.26973,40.04866],[44.46635,39.97733],[44.61845,39.8281],[44.75779,39.7148],[44.88354,39.74432],[44.92869,39.72157],[45.06604,39.79277],[45.18554,39.67846],[45.17464,39.58614],[45.21784,39.58074],[45.23535,39.61373],[45.30385,39.61373],[45.29606,39.57654],[45.46992,39.49888],[45.70547,39.60174],[45.80804,39.56716],[45.83,39.46487],[45.79225,39.3695],[45.99774,39.28931],[46.02303,39.09978],[46.06973,39.0744],[46.14785,38.84206],[46.20601,38.85262],[46.34059,38.92076],[46.53497,38.86548],[46.51805,38.94982],[46.54296,39.07078],[46.44022,39.19636],[46.52584,39.18912],[46.54141,39.15895],[46.58032,39.21204],[46.63481,39.23013],[46.56476,39.24942],[46.50093,39.33736],[46.43244,39.35181],[46.37795,39.42039],[46.4013,39.45405],[46.53051,39.47809],[46.51027,39.52373],[46.57721,39.54414],[46.57098,39.56694],[46.52117,39.58734],[46.42465,39.57534],[46.40286,39.63651],[46.18493,39.60533],[45.96543,39.78859],[45.82533,39.82925],[45.7833,39.9475],[45.60895,39.97733],[45.59806,40.0131],[45.78642,40.03218],[45.83779,39.98925],[45.97944,40.181],[45.95609,40.27846],[45.65098,40.37696],[45.42994,40.53804],[45.45484,40.57707],[45.35366,40.65979],[45.4206,40.7424],[45.55914,40.78366],[45.60584,40.87436],[45.40814,40.97904],[45.44083,41.01663],[45.39725,41.02603],[45.35677,40.99784],[45.28859,41.03757],[45.26162,41.0228],[45.25897,41.0027],[45.1994,41.04518],[45.16493,41.05068],[45.1634,41.08082],[45.1313,41.09369],[45.12923,41.06059],[45.06784,41.05379],[45.08028,41.10917],[45.19942,41.13299],[45.1969,41.168],[45.11811,41.19967],[45.05201,41.19211],[45.02932,41.2101],[45.05497,41.2464],[45.0133,41.29747]],[[45.21324,40.9817],[45.21219,40.99001],[45.20518,40.99348],[45.19312,40.98998],[45.18382,41.0066],[45.20625,41.01484],[45.23487,41.00226],[45.23095,40.97828],[45.21324,40.9817]],[[45.00864,41.03411],[44.9903,41.05657],[44.96031,41.06345],[44.95383,41.07553],[44.97169,41.09176],[45.00864,41.09407],[45.03406,41.07931],[45.04517,41.06653],[45.03792,41.03938],[45.00864,41.03411]]],[[[45.50279,40.58424],[45.56071,40.64765],[45.51825,40.67382],[45.47927,40.65023],[45.50279,40.58424]]]]}},{type:"Feature",properties:{iso1A2:"AO",iso1A3:"AGO",iso1N3:"024",wikidata:"Q916",nameEn:"Angola",groups:["017","202","002","UN"],callingCodes:["244"]},geometry:{type:"MultiPolygon",coordinates:[[[[16.55507,-5.85631],[13.04371,-5.87078],[12.42245,-6.07585],[11.95767,-5.94705],[12.20376,-5.76338],[12.26557,-5.74031],[12.52318,-5.74353],[12.52301,-5.17481],[12.53599,-5.1618],[12.53586,-5.14658],[12.51589,-5.1332],[12.49815,-5.14058],[12.46297,-5.09408],[12.60251,-5.01715],[12.63465,-4.94632],[12.70868,-4.95505],[12.8733,-4.74346],[13.11195,-4.67745],[13.09648,-4.63739],[12.91489,-4.47907],[12.87096,-4.40315],[12.76844,-4.38709],[12.64835,-4.55937],[12.40964,-4.60609],[12.32324,-4.78415],[12.25587,-4.79437],[12.20901,-4.75642],[12.16068,-4.90089],[12.00924,-5.02627],[11.50888,-5.33417],[10.5065,-17.25284],[11.75063,-17.25013],[12.07076,-17.15165],[12.52111,-17.24495],[12.97145,-16.98567],[13.36212,-16.98048],[13.95896,-17.43141],[14.28743,-17.38814],[18.39229,-17.38927],[18.84226,-17.80375],[21.14283,-17.94318],[21.42741,-18.02787],[23.47474,-17.62877],[23.20038,-17.47563],[22.17217,-16.50269],[22.00323,-16.18028],[21.97988,-13.00148],[24.03339,-12.99091],[23.90937,-12.844],[24.06672,-12.29058],[23.98804,-12.13149],[24.02603,-11.15368],[24.00027,-10.89356],[23.86868,-11.02856],[23.45631,-10.946],[23.16602,-11.10577],[22.54205,-11.05784],[22.25951,-11.24911],[22.17954,-10.85884],[22.32604,-10.76291],[22.19039,-9.94628],[21.84856,-9.59871],[21.79824,-7.29628],[20.56263,-7.28566],[20.61689,-6.90876],[20.31846,-6.91953],[20.30218,-6.98955],[19.5469,-7.00195],[19.33698,-7.99743],[18.33635,-8.00126],[17.5828,-8.13784],[16.96282,-7.21787],[16.55507,-5.85631]]]]}},{type:"Feature",properties:{iso1A2:"AQ",iso1A3:"ATA",iso1N3:"010",wikidata:"Q51",nameEn:"Antarctica",level:"region",callingCodes:["672"]},geometry:{type:"MultiPolygon",coordinates:[[[[180,-60],[-180,-60],[-180,-90],[180,-90],[180,-60]]]]}},{type:"Feature",properties:{iso1A2:"AR",iso1A3:"ARG",iso1N3:"032",wikidata:"Q414",nameEn:"Argentina",aliases:["RA"],groups:["005","419","019","UN"],callingCodes:["54"]},geometry:{type:"MultiPolygon",coordinates:[[[[-72.31343,-50.58411],[-72.33873,-51.59954],[-71.99889,-51.98018],[-69.97824,-52.00845],[-68.41683,-52.33516],[-68.60702,-52.65781],[-68.60733,-54.9125],[-68.01394,-54.8753],[-67.46182,-54.92205],[-67.11046,-54.94199],[-66.07313,-55.19618],[-63.67376,-55.11859],[-54.78916,-36.21945],[-57.83001,-34.69099],[-58.34425,-34.15035],[-58.44442,-33.84033],[-58.40475,-33.11777],[-58.1224,-32.98842],[-58.22362,-32.52416],[-58.10036,-32.25338],[-58.20252,-31.86966],[-58.00076,-31.65016],[-58.0023,-31.53084],[-58.07569,-31.44916],[-57.98127,-31.3872],[-57.9908,-31.34924],[-57.86729,-31.06352],[-57.89476,-30.95994],[-57.8024,-30.77193],[-57.89115,-30.49572],[-57.64859,-30.35095],[-57.61478,-30.25165],[-57.65132,-30.19229],[-57.09386,-29.74211],[-56.81251,-29.48154],[-56.62789,-29.18073],[-56.57295,-29.11357],[-56.54171,-29.11447],[-56.05265,-28.62651],[-56.00458,-28.60421],[-56.01729,-28.51223],[-55.65418,-28.18304],[-55.6262,-28.17124],[-55.33303,-27.94661],[-55.16872,-27.86224],[-55.1349,-27.89759],[-54.90805,-27.73149],[-54.90159,-27.63132],[-54.67657,-27.57214],[-54.50416,-27.48232],[-54.41888,-27.40882],[-54.19268,-27.30751],[-54.19062,-27.27639],[-54.15978,-27.2889],[-53.80144,-27.09844],[-53.73372,-26.6131],[-53.68269,-26.33359],[-53.64505,-26.28089],[-53.64186,-26.25976],[-53.64632,-26.24798],[-53.63881,-26.25075],[-53.63739,-26.2496],[-53.65237,-26.23289],[-53.65018,-26.19501],[-53.73968,-26.10012],[-53.73391,-26.07006],[-53.7264,-26.0664],[-53.73086,-26.05842],[-53.73511,-26.04211],[-53.83691,-25.94849],[-53.90831,-25.55513],[-54.52926,-25.62846],[-54.5502,-25.58915],[-54.59398,-25.59224],[-54.62063,-25.91213],[-54.60664,-25.9691],[-54.67359,-25.98607],[-54.69333,-26.37705],[-54.70732,-26.45099],[-54.80868,-26.55669],[-55.00584,-26.78754],[-55.06351,-26.80195],[-55.16948,-26.96068],[-55.25243,-26.93808],[-55.39611,-26.97679],[-55.62322,-27.1941],[-55.59094,-27.32444],[-55.74475,-27.44485],[-55.89195,-27.3467],[-56.18313,-27.29851],[-56.85337,-27.5165],[-58.04205,-27.2387],[-58.59549,-27.29973],[-58.65321,-27.14028],[-58.3198,-26.83443],[-58.1188,-26.16704],[-57.87176,-25.93604],[-57.57431,-25.47269],[-57.80821,-25.13863],[-58.25492,-24.92528],[-58.33055,-24.97099],[-59.33886,-24.49935],[-59.45482,-24.34787],[-60.03367,-24.00701],[-60.28163,-24.04436],[-60.99754,-23.80934],[-61.0782,-23.62932],[-61.9756,-23.0507],[-62.22768,-22.55807],[-62.51761,-22.37684],[-62.64455,-22.25091],[-62.8078,-22.12534],[-62.81124,-21.9987],[-63.66482,-21.99918],[-63.68113,-22.0544],[-63.70963,-21.99934],[-63.93287,-21.99934],[-64.22918,-22.55807],[-64.31489,-22.88824],[-64.35108,-22.73282],[-64.4176,-22.67692],[-64.58888,-22.25035],[-64.67174,-22.18957],[-64.90014,-22.12136],[-64.99524,-22.08255],[-65.47435,-22.08908],[-65.57743,-22.07675],[-65.58694,-22.09794],[-65.61166,-22.09504],[-65.7467,-22.10105],[-65.9261,-21.93335],[-66.04832,-21.9187],[-66.03836,-21.84829],[-66.24077,-21.77837],[-66.29714,-22.08741],[-66.7298,-22.23644],[-67.18382,-22.81525],[-66.99632,-22.99839],[-67.33563,-24.04237],[-68.24825,-24.42596],[-68.56909,-24.69831],[-68.38372,-25.08636],[-68.57622,-25.32505],[-68.38372,-26.15353],[-68.56909,-26.28146],[-68.59048,-26.49861],[-68.27677,-26.90626],[-68.43363,-27.08414],[-68.77586,-27.16029],[-69.22504,-27.95042],[-69.66709,-28.44055],[-69.80969,-29.07185],[-69.99507,-29.28351],[-69.8596,-30.26131],[-70.14479,-30.36595],[-70.55832,-31.51559],[-69.88099,-33.34489],[-69.87386,-34.13344],[-70.49416,-35.24145],[-70.38008,-36.02375],[-70.95047,-36.4321],[-71.24279,-37.20264],[-70.89532,-38.6923],[-71.37826,-38.91474],[-71.92726,-40.72714],[-71.74901,-42.11711],[-72.15541,-42.15941],[-72.14828,-42.85321],[-71.64206,-43.64774],[-71.81318,-44.38097],[-71.16436,-44.46244],[-71.26418,-44.75684],[-72.06985,-44.81756],[-71.35687,-45.22075],[-71.75614,-45.61611],[-71.68577,-46.55385],[-71.94152,-47.13595],[-72.50478,-47.80586],[-72.27662,-48.28727],[-72.54042,-48.52392],[-72.56894,-48.81116],[-73.09655,-49.14342],[-73.45156,-49.79461],[-73.55259,-49.92488],[-73.15765,-50.78337],[-72.31343,-50.58411]]]]}},{type:"Feature",properties:{iso1A2:"AS",iso1A3:"ASM",iso1N3:"016",wikidata:"Q16641",nameEn:"American Samoa",aliases:["US-AS"],country:"US",groups:["Q1352230","061","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 684"]},geometry:{type:"MultiPolygon",coordinates:[[[[-171.39864,-10.21587],[-170.99605,-15.1275],[-166.32598,-15.26169],[-171.39864,-10.21587]]]]}},{type:"Feature",properties:{iso1A2:"AT",iso1A3:"AUT",iso1N3:"040",wikidata:"Q40",nameEn:"Austria",groups:["EU","155","150","UN"],callingCodes:["43"]},geometry:{type:"MultiPolygon",coordinates:[[[[15.34823,48.98444],[15.28305,48.98831],[15.26177,48.95766],[15.16358,48.94278],[15.15534,48.99056],[14.99878,49.01444],[14.97612,48.96983],[14.98917,48.90082],[14.95072,48.79101],[14.98032,48.77959],[14.9782,48.7766],[14.98112,48.77524],[14.9758,48.76857],[14.95641,48.75915],[14.94773,48.76268],[14.81545,48.7874],[14.80821,48.77711],[14.80584,48.73489],[14.72756,48.69502],[14.71794,48.59794],[14.66762,48.58215],[14.60808,48.62881],[14.56139,48.60429],[14.4587,48.64695],[14.43076,48.58855],[14.33909,48.55852],[14.20691,48.5898],[14.09104,48.5943],[14.01482,48.63788],[14.06151,48.66873],[13.84023,48.76988],[13.82266,48.75544],[13.81863,48.73257],[13.79337,48.71375],[13.81791,48.69832],[13.81283,48.68426],[13.81901,48.6761],[13.82609,48.62345],[13.80038,48.59487],[13.80519,48.58026],[13.76921,48.55324],[13.7513,48.5624],[13.74816,48.53058],[13.72802,48.51208],[13.66113,48.53558],[13.65186,48.55092],[13.62508,48.55501],[13.59705,48.57013],[13.57535,48.55912],[13.51291,48.59023],[13.50131,48.58091],[13.50663,48.57506],[13.46967,48.55157],[13.45214,48.56472],[13.43695,48.55776],[13.45727,48.51092],[13.42527,48.45711],[13.43929,48.43386],[13.40709,48.37292],[13.30897,48.31575],[13.26039,48.29422],[13.18093,48.29577],[13.126,48.27867],[13.0851,48.27711],[13.02083,48.25689],[12.95306,48.20629],[12.87126,48.20318],[12.84475,48.16556],[12.836,48.1647],[12.8362,48.15876],[12.82673,48.15245],[12.80676,48.14979],[12.78595,48.12445],[12.7617,48.12796],[12.74973,48.10885],[12.76141,48.07373],[12.8549,48.01122],[12.87476,47.96195],[12.91683,47.95647],[12.9211,47.95135],[12.91985,47.94069],[12.92668,47.93879],[12.93419,47.94063],[12.93642,47.94436],[12.93886,47.94046],[12.94163,47.92927],[13.00588,47.84374],[12.98543,47.82896],[12.96311,47.79957],[12.93202,47.77302],[12.94371,47.76281],[12.9353,47.74788],[12.91711,47.74026],[12.90274,47.72513],[12.91333,47.7178],[12.92969,47.71094],[12.98578,47.7078],[13.01382,47.72116],[13.07692,47.68814],[13.09562,47.63304],[13.06407,47.60075],[13.06641,47.58577],[13.04537,47.58183],[13.05355,47.56291],[13.03252,47.53373],[13.04537,47.49426],[12.9998,47.46267],[12.98344,47.48716],[12.9624,47.47452],[12.85256,47.52741],[12.84672,47.54556],[12.80699,47.54477],[12.77427,47.58025],[12.82101,47.61493],[12.76492,47.64485],[12.77777,47.66689],[12.7357,47.6787],[12.6071,47.6741],[12.57438,47.63238],[12.53816,47.63553],[12.50076,47.62293],[12.44117,47.6741],[12.43883,47.6977],[12.37222,47.68433],[12.336,47.69534],[12.27991,47.68827],[12.26004,47.67725],[12.24017,47.69534],[12.26238,47.73544],[12.2542,47.7433],[12.22571,47.71776],[12.18303,47.70065],[12.16217,47.70105],[12.16769,47.68167],[12.18347,47.66663],[12.18507,47.65984],[12.19895,47.64085],[12.20801,47.61082],[12.20398,47.60667],[12.18568,47.6049],[12.17737,47.60121],[12.18145,47.61019],[12.17824,47.61506],[12.13734,47.60639],[12.05788,47.61742],[12.02282,47.61033],[12.0088,47.62451],[11.85572,47.60166],[11.84052,47.58354],[11.63934,47.59202],[11.60681,47.57881],[11.58811,47.55515],[11.58578,47.52281],[11.52618,47.50939],[11.4362,47.51413],[11.38128,47.47465],[11.4175,47.44621],[11.33804,47.44937],[11.29597,47.42566],[11.27844,47.39956],[11.22002,47.3964],[11.25157,47.43277],[11.20482,47.43198],[11.12536,47.41222],[11.11835,47.39719],[10.97111,47.39561],[10.97111,47.41617],[10.98513,47.42882],[10.92437,47.46991],[10.93839,47.48018],[10.90918,47.48571],[10.87061,47.4786],[10.86945,47.5015],[10.91268,47.51334],[10.88814,47.53701],[10.77596,47.51729],[10.7596,47.53228],[10.6965,47.54253],[10.68832,47.55752],[10.63456,47.5591],[10.60337,47.56755],[10.56912,47.53584],[10.48849,47.54057],[10.47329,47.58552],[10.43473,47.58394],[10.44992,47.5524],[10.4324,47.50111],[10.44291,47.48453],[10.46278,47.47901],[10.47446,47.43318],[10.4359,47.41183],[10.4324,47.38494],[10.39851,47.37623],[10.33424,47.30813],[10.23257,47.27088],[10.17531,47.27167],[10.17648,47.29149],[10.2147,47.31014],[10.19998,47.32832],[10.23757,47.37609],[10.22774,47.38904],[10.2127,47.38019],[10.17648,47.38889],[10.16362,47.36674],[10.11805,47.37228],[10.09819,47.35724],[10.06897,47.40709],[10.1052,47.4316],[10.09001,47.46005],[10.07131,47.45531],[10.03859,47.48927],[10.00003,47.48216],[9.96029,47.53899],[9.92407,47.53111],[9.87733,47.54688],[9.87499,47.52953],[9.8189,47.54688],[9.82591,47.58158],[9.80254,47.59419],[9.76748,47.5934],[9.72736,47.53457],[9.55125,47.53629],[9.56312,47.49495],[9.58208,47.48344],[9.59482,47.46305],[9.60205,47.46165],[9.60484,47.46358],[9.60841,47.47178],[9.62158,47.45858],[9.62475,47.45685],[9.6423,47.45599],[9.65728,47.45383],[9.65863,47.44847],[9.64483,47.43842],[9.6446,47.43233],[9.65043,47.41937],[9.65136,47.40504],[9.6629,47.39591],[9.67334,47.39191],[9.67445,47.38429],[9.6711,47.37824],[9.66243,47.37136],[9.65427,47.36824],[9.62476,47.36639],[9.59978,47.34671],[9.58513,47.31334],[9.55857,47.29919],[9.54773,47.2809],[9.53116,47.27029],[9.56766,47.24281],[9.55176,47.22585],[9.56981,47.21926],[9.58264,47.20673],[9.56539,47.17124],[9.62623,47.14685],[9.63395,47.08443],[9.61216,47.07732],[9.60717,47.06091],[9.87935,47.01337],[9.88266,46.93343],[9.98058,46.91434],[10.10715,46.84296],[10.22675,46.86942],[10.24128,46.93147],[10.30031,46.92093],[10.36933,47.00212],[10.48376,46.93891],[10.47197,46.85698],[10.54783,46.84505],[10.66405,46.87614],[10.75753,46.82258],[10.72974,46.78972],[11.00764,46.76896],[11.10618,46.92966],[11.33355,46.99862],[11.50739,47.00644],[11.74789,46.98484],[12.19254,47.09331],[12.21781,47.03996],[12.11675,47.01241],[12.2006,46.88854],[12.27591,46.88651],[12.38708,46.71529],[12.59992,46.6595],[12.94445,46.60401],[13.27627,46.56059],[13.64088,46.53438],[13.7148,46.5222],[13.89837,46.52331],[14.00422,46.48474],[14.04002,46.49117],[14.12097,46.47724],[14.15989,46.43327],[14.28326,46.44315],[14.314,46.43327],[14.42608,46.44614],[14.45877,46.41717],[14.52176,46.42617],[14.56463,46.37208],[14.5942,46.43434],[14.66892,46.44936],[14.72185,46.49974],[14.81836,46.51046],[14.83549,46.56614],[14.86419,46.59411],[14.87129,46.61],[14.92283,46.60848],[14.96002,46.63459],[14.98024,46.6009],[15.01451,46.641],[15.14215,46.66131],[15.23711,46.63994],[15.41235,46.65556],[15.45514,46.63697],[15.46906,46.61321],[15.54431,46.6312],[15.55333,46.64988],[15.54533,46.66985],[15.59826,46.68908],[15.62317,46.67947],[15.63255,46.68069],[15.6365,46.6894],[15.6543,46.69228],[15.6543,46.70616],[15.67411,46.70735],[15.69523,46.69823],[15.72279,46.69548],[15.73823,46.70011],[15.76771,46.69863],[15.78518,46.70712],[15.8162,46.71897],[15.87691,46.7211],[15.94864,46.68769],[15.98512,46.68463],[15.99988,46.67947],[16.04036,46.6549],[16.04347,46.68694],[16.02808,46.71094],[15.99769,46.7266],[15.98432,46.74991],[15.99126,46.78199],[15.99054,46.82772],[16.05786,46.83927],[16.10983,46.867],[16.19904,46.94134],[16.22403,46.939],[16.27594,46.9643],[16.28202,47.00159],[16.51369,47.00084],[16.43936,47.03548],[16.52176,47.05747],[16.46134,47.09395],[16.52863,47.13974],[16.44932,47.14418],[16.46442,47.16845],[16.4523,47.18812],[16.42801,47.18422],[16.41739,47.20649],[16.43663,47.21127],[16.44142,47.25079],[16.47782,47.25918],[16.45104,47.41181],[16.49908,47.39416],[16.52414,47.41007],[16.57152,47.40868],[16.6718,47.46139],[16.64821,47.50155],[16.71059,47.52692],[16.64193,47.63114],[16.58699,47.61772],[16.4222,47.66537],[16.55129,47.72268],[16.53514,47.73837],[16.54779,47.75074],[16.61183,47.76171],[16.65679,47.74197],[16.72089,47.73469],[16.7511,47.67878],[16.82938,47.68432],[16.86509,47.72268],[16.87538,47.68895],[17.08893,47.70928],[17.05048,47.79377],[17.07039,47.81129],[17.00997,47.86245],[17.08275,47.87719],[17.11022,47.92461],[17.09786,47.97336],[17.16001,48.00636],[17.07039,48.0317],[17.09168,48.09366],[17.05735,48.14179],[17.02919,48.13996],[16.97701,48.17385],[16.89461,48.31332],[16.90903,48.32519],[16.84243,48.35258],[16.83317,48.38138],[16.83588,48.3844],[16.8497,48.38321],[16.85204,48.44968],[16.94611,48.53614],[16.93955,48.60371],[16.90354,48.71541],[16.79779,48.70998],[16.71883,48.73806],[16.68518,48.7281],[16.67008,48.77699],[16.46134,48.80865],[16.40915,48.74576],[16.37345,48.729],[16.06034,48.75436],[15.84404,48.86921],[15.78087,48.87644],[15.75341,48.8516],[15.6921,48.85973],[15.61622,48.89541],[15.51357,48.91549],[15.48027,48.94481],[15.34823,48.98444]]]]}},{type:"Feature",properties:{iso1A2:"AU",iso1A3:"AUS",iso1N3:"036",wikidata:"Q408",nameEn:"Australia"},geometry:null},{type:"Feature",properties:{iso1A2:"AW",iso1A3:"ABW",iso1N3:"533",wikidata:"Q21203",nameEn:"Aruba",aliases:["NL-AW"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["297"]},geometry:{type:"MultiPolygon",coordinates:[[[[-70.00823,12.98375],[-70.35625,12.58277],[-69.60231,12.17],[-70.00823,12.98375]]]]}},{type:"Feature",properties:{iso1A2:"AX",iso1A3:"ALA",iso1N3:"248",wikidata:"Q5689",nameEn:"\xC5land Islands",country:"FI",groups:["EU","154","150","UN"],callingCodes:["358 18","358 457"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.08191,60.19152],[20.5104,59.15546],[21.35468,59.67511],[21.02509,60.12142],[21.08159,60.20167],[21.15143,60.54555],[20.96741,60.71528],[19.23413,60.61414],[19.08191,60.19152]]]]}},{type:"Feature",properties:{iso1A2:"AZ",iso1A3:"AZE",iso1N3:"031",wikidata:"Q227",nameEn:"Azerbaijan",groups:["145","142","UN"],callingCodes:["994"]},geometry:{type:"MultiPolygon",coordinates:[[[[46.42738,41.91323],[46.3984,41.84399],[46.30863,41.79133],[46.23962,41.75811],[46.20538,41.77205],[46.17891,41.72094],[46.19759,41.62327],[46.24429,41.59883],[46.26531,41.63339],[46.28182,41.60089],[46.3253,41.60912],[46.34039,41.5947],[46.34126,41.57454],[46.29794,41.5724],[46.33925,41.4963],[46.40307,41.48464],[46.4669,41.43331],[46.63658,41.37727],[46.72375,41.28609],[46.66148,41.20533],[46.63969,41.09515],[46.55096,41.1104],[46.48558,41.0576],[46.456,41.09984],[46.37661,41.10805],[46.27698,41.19011],[46.13221,41.19479],[45.95786,41.17956],[45.80842,41.2229],[45.69946,41.29545],[45.75705,41.35157],[45.71035,41.36208],[45.68389,41.3539],[45.45973,41.45898],[45.4006,41.42402],[45.31352,41.47168],[45.26285,41.46433],[45.1797,41.42231],[45.09867,41.34065],[45.0133,41.29747],[45.05497,41.2464],[45.02932,41.2101],[45.05201,41.19211],[45.11811,41.19967],[45.1969,41.168],[45.19942,41.13299],[45.08028,41.10917],[45.06784,41.05379],[45.12923,41.06059],[45.1313,41.09369],[45.1634,41.08082],[45.16493,41.05068],[45.1994,41.04518],[45.25897,41.0027],[45.26162,41.0228],[45.28859,41.03757],[45.35677,40.99784],[45.39725,41.02603],[45.44083,41.01663],[45.40814,40.97904],[45.60584,40.87436],[45.55914,40.78366],[45.4206,40.7424],[45.35366,40.65979],[45.45484,40.57707],[45.42994,40.53804],[45.65098,40.37696],[45.95609,40.27846],[45.97944,40.181],[45.83779,39.98925],[45.78642,40.03218],[45.59806,40.0131],[45.60895,39.97733],[45.7833,39.9475],[45.82533,39.82925],[45.96543,39.78859],[46.18493,39.60533],[46.40286,39.63651],[46.42465,39.57534],[46.52117,39.58734],[46.57098,39.56694],[46.57721,39.54414],[46.51027,39.52373],[46.53051,39.47809],[46.4013,39.45405],[46.37795,39.42039],[46.43244,39.35181],[46.50093,39.33736],[46.56476,39.24942],[46.63481,39.23013],[46.58032,39.21204],[46.54141,39.15895],[46.52584,39.18912],[46.44022,39.19636],[46.54296,39.07078],[46.51805,38.94982],[46.53497,38.86548],[46.75752,39.03231],[46.83822,39.13143],[46.92539,39.16644],[46.95341,39.13505],[47.05771,39.20143],[47.05927,39.24846],[47.31301,39.37492],[47.38978,39.45999],[47.50099,39.49615],[47.84774,39.66285],[47.98977,39.70999],[48.34264,39.42935],[48.37385,39.37584],[48.15984,39.30028],[48.12404,39.25208],[48.15361,39.19419],[48.31239,39.09278],[48.33884,39.03022],[48.28437,38.97186],[48.08627,38.94434],[48.07734,38.91616],[48.01409,38.90333],[48.02581,38.82705],[48.24773,38.71883],[48.3146,38.59958],[48.45084,38.61013],[48.58793,38.45076],[48.62217,38.40198],[48.70001,38.40564],[48.78979,38.45026],[48.81072,38.44853],[48.84969,38.45015],[48.88288,38.43975],[52.39847,39.43556],[48.80971,41.95365],[48.5867,41.84306],[48.55078,41.77917],[48.42301,41.65444],[48.40277,41.60441],[48.2878,41.56221],[48.22064,41.51472],[48.07587,41.49957],[47.87973,41.21798],[47.75831,41.19455],[47.62288,41.22969],[47.54504,41.20275],[47.49004,41.26366],[47.34579,41.27884],[47.10762,41.59044],[47.03757,41.55434],[46.99554,41.59743],[47.00955,41.63583],[46.8134,41.76252],[46.75269,41.8623],[46.58924,41.80547],[46.5332,41.87389],[46.42738,41.91323]],[[45.50279,40.58424],[45.47927,40.65023],[45.51825,40.67382],[45.56071,40.64765],[45.50279,40.58424]]],[[[45.00864,41.03411],[45.03792,41.03938],[45.04517,41.06653],[45.03406,41.07931],[45.00864,41.09407],[44.97169,41.09176],[44.95383,41.07553],[44.96031,41.06345],[44.9903,41.05657],[45.00864,41.03411]]],[[[45.21324,40.9817],[45.23095,40.97828],[45.23487,41.00226],[45.20625,41.01484],[45.18382,41.0066],[45.19312,40.98998],[45.20518,40.99348],[45.21219,40.99001],[45.21324,40.9817]]],[[[45.46992,39.49888],[45.29606,39.57654],[45.30385,39.61373],[45.23535,39.61373],[45.21784,39.58074],[45.17464,39.58614],[45.18554,39.67846],[45.06604,39.79277],[44.92869,39.72157],[44.88354,39.74432],[44.75779,39.7148],[44.80977,39.65768],[44.81043,39.62677],[44.88916,39.59653],[44.96746,39.42998],[45.05932,39.36435],[45.08751,39.35052],[45.16168,39.21952],[45.30489,39.18333],[45.40148,39.09007],[45.40452,39.07224],[45.44811,39.04927],[45.44966,38.99243],[45.6131,38.964],[45.6155,38.94304],[45.65172,38.95199],[45.83883,38.90768],[45.90266,38.87739],[45.94624,38.89072],[46.00228,38.87376],[46.06766,38.87861],[46.14785,38.84206],[46.06973,39.0744],[46.02303,39.09978],[45.99774,39.28931],[45.79225,39.3695],[45.83,39.46487],[45.80804,39.56716],[45.70547,39.60174],[45.46992,39.49888]]]]}},{type:"Feature",properties:{iso1A2:"BA",iso1A3:"BIH",iso1N3:"070",wikidata:"Q225",nameEn:"Bosnia and Herzegovina",groups:["039","150","UN"],callingCodes:["387"]},geometry:{type:"MultiPolygon",coordinates:[[[[17.84826,45.04489],[17.66571,45.13408],[17.59104,45.10816],[17.51469,45.10791],[17.47589,45.12656],[17.45615,45.12523],[17.4498,45.16119],[17.41229,45.13335],[17.33573,45.14521],[17.32092,45.16246],[17.26815,45.18444],[17.25131,45.14957],[17.24325,45.146],[17.18438,45.14764],[17.0415,45.20759],[16.9385,45.22742],[16.92405,45.27607],[16.83804,45.18951],[16.81137,45.18434],[16.78219,45.19002],[16.74845,45.20393],[16.64962,45.20714],[16.60194,45.23042],[16.56559,45.22307],[16.5501,45.2212],[16.52982,45.22713],[16.49155,45.21153],[16.4634,45.14522],[16.40023,45.1147],[16.38309,45.05955],[16.38219,45.05139],[16.3749,45.05206],[16.35863,45.03529],[16.35404,45.00241],[16.29036,44.99732],[16.12153,45.09616],[15.98412,45.23088],[15.83512,45.22459],[15.76371,45.16508],[15.78842,45.11519],[15.74585,45.0638],[15.78568,44.97401],[15.74723,44.96818],[15.76096,44.87045],[15.79472,44.8455],[15.72584,44.82334],[15.8255,44.71501],[15.89348,44.74964],[16.05828,44.61538],[16.00884,44.58605],[16.03012,44.55572],[16.10566,44.52586],[16.16814,44.40679],[16.12969,44.38275],[16.21346,44.35231],[16.18688,44.27012],[16.36864,44.08263],[16.43662,44.07523],[16.43629,44.02826],[16.50528,44.0244],[16.55472,43.95326],[16.70922,43.84887],[16.75316,43.77157],[16.80736,43.76011],[17.00585,43.58037],[17.15828,43.49376],[17.24411,43.49376],[17.29699,43.44542],[17.25579,43.40353],[17.286,43.33065],[17.46986,43.16559],[17.64268,43.08595],[17.70879,42.97223],[17.5392,42.92787],[17.6444,42.88641],[17.68151,42.92725],[17.7948,42.89556],[17.80854,42.9182],[17.88201,42.83668],[18.24318,42.6112],[18.36197,42.61423],[18.43735,42.55921],[18.49778,42.58409],[18.53751,42.57376],[18.55504,42.58409],[18.52232,42.62279],[18.57373,42.64429],[18.54841,42.68328],[18.54603,42.69171],[18.55221,42.69045],[18.56789,42.72074],[18.47324,42.74992],[18.45921,42.81682],[18.47633,42.85829],[18.4935,42.86433],[18.49661,42.89306],[18.49076,42.95553],[18.52232,43.01451],[18.66254,43.03928],[18.64735,43.14766],[18.66605,43.2056],[18.71747,43.2286],[18.6976,43.25243],[18.76538,43.29838],[18.85342,43.32426],[18.84794,43.33735],[18.83912,43.34795],[18.90911,43.36383],[18.95819,43.32899],[18.95001,43.29327],[19.00844,43.24988],[19.04233,43.30008],[19.08206,43.29668],[19.08673,43.31453],[19.04071,43.397],[19.01078,43.43854],[18.96053,43.45042],[18.95469,43.49367],[18.91379,43.50299],[19.01078,43.55806],[19.04934,43.50384],[19.13933,43.5282],[19.15685,43.53943],[19.22807,43.5264],[19.24774,43.53061],[19.2553,43.5938],[19.33426,43.58833],[19.36653,43.60921],[19.41941,43.54056],[19.42696,43.57987],[19.50455,43.58385],[19.5176,43.71403],[19.3986,43.79668],[19.23465,43.98764],[19.24363,44.01502],[19.38439,43.96611],[19.52515,43.95573],[19.56498,43.99922],[19.61836,44.01464],[19.61991,44.05254],[19.57467,44.04716],[19.55999,44.06894],[19.51167,44.08158],[19.47321,44.1193],[19.48386,44.14332],[19.47338,44.15034],[19.43905,44.13088],[19.40927,44.16722],[19.3588,44.18353],[19.34773,44.23244],[19.32464,44.27185],[19.26945,44.26957],[19.23306,44.26097],[19.20508,44.2917],[19.18328,44.28383],[19.16741,44.28648],[19.13332,44.31492],[19.13556,44.338],[19.11547,44.34218],[19.1083,44.3558],[19.11865,44.36712],[19.10298,44.36924],[19.10365,44.37795],[19.10704,44.38249],[19.10749,44.39421],[19.11785,44.40313],[19.14681,44.41463],[19.14837,44.45253],[19.12278,44.50132],[19.13369,44.52521],[19.16699,44.52197],[19.26388,44.65412],[19.32543,44.74058],[19.36722,44.88164],[19.18183,44.92055],[19.01994,44.85493],[18.8704,44.85097],[18.76347,44.90669],[18.76369,44.93707],[18.80661,44.93561],[18.78357,44.97741],[18.65723,45.07544],[18.47939,45.05871],[18.41896,45.11083],[18.32077,45.1021],[18.24387,45.13699],[18.1624,45.07654],[18.03121,45.12632],[18.01594,45.15163],[17.99479,45.14958],[17.97834,45.13831],[17.97336,45.12245],[17.93706,45.08016],[17.87148,45.04645],[17.84826,45.04489]]]]}},{type:"Feature",properties:{iso1A2:"BB",iso1A3:"BRB",iso1N3:"052",wikidata:"Q244",nameEn:"Barbados",groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 246"]},geometry:{type:"MultiPolygon",coordinates:[[[[-58.56442,13.24471],[-59.80731,13.87556],[-59.82929,12.70644],[-58.56442,13.24471]]]]}},{type:"Feature",properties:{iso1A2:"BD",iso1A3:"BGD",iso1N3:"050",wikidata:"Q902",nameEn:"Bangladesh",groups:["034","142","UN"],driveSide:"left",callingCodes:["880"]},geometry:{type:"MultiPolygon",coordinates:[[[[89.15869,26.13708],[89.08899,26.38845],[88.95612,26.4564],[88.92357,26.40711],[88.91321,26.37984],[89.05328,26.2469],[88.85004,26.23211],[88.78961,26.31093],[88.67837,26.26291],[88.69485,26.38353],[88.62144,26.46783],[88.4298,26.54489],[88.41196,26.63837],[88.33093,26.48929],[88.35153,26.45241],[88.36938,26.48683],[88.48749,26.45855],[88.51649,26.35923],[88.35153,26.29123],[88.34757,26.22216],[88.1844,26.14417],[88.16581,26.0238],[88.08804,25.91334],[88.13138,25.78773],[88.242,25.80811],[88.45103,25.66245],[88.4559,25.59227],[88.677,25.46959],[88.81296,25.51546],[88.85278,25.34679],[89.01105,25.30303],[89.00463,25.26583],[88.94067,25.18534],[88.44766,25.20149],[88.46277,25.07468],[88.33917,24.86803],[88.27325,24.88796],[88.21832,24.96642],[88.14004,24.93529],[88.15515,24.85806],[88.00683,24.66477],[88.08786,24.63232],[88.12296,24.51301],[88.50934,24.32474],[88.68801,24.31464],[88.74841,24.1959],[88.6976,24.14703],[88.73743,23.91751],[88.66189,23.87607],[88.58087,23.87105],[88.56507,23.64044],[88.74841,23.47361],[88.79351,23.50535],[88.79254,23.46028],[88.71133,23.2492],[88.99148,23.21134],[88.86377,23.08759],[88.88327,23.03885],[88.87063,22.95235],[88.96713,22.83346],[88.9151,22.75228],[88.94614,22.66941],[88.9367,22.58527],[89.07114,22.15335],[89.08044,21.41871],[92.47409,20.38654],[92.26071,21.05697],[92.17752,21.17445],[92.20087,21.337],[92.37939,21.47764],[92.43158,21.37025],[92.55105,21.3856],[92.60187,21.24615],[92.68152,21.28454],[92.59775,21.6092],[92.62187,21.87037],[92.60949,21.97638],[92.56616,22.13554],[92.60029,22.1522],[92.5181,22.71441],[92.37665,22.9435],[92.38214,23.28705],[92.26541,23.70392],[92.15417,23.73409],[92.04706,23.64229],[91.95093,23.73284],[91.95642,23.47361],[91.84789,23.42235],[91.76417,23.26619],[91.81634,23.08001],[91.7324,23.00043],[91.61571,22.93929],[91.54993,23.01051],[91.46615,23.2328],[91.4035,23.27522],[91.40848,23.07117],[91.36453,23.06612],[91.28293,23.37538],[91.15579,23.6599],[91.25192,23.83463],[91.22308,23.89616],[91.29587,24.0041],[91.35741,23.99072],[91.37414,24.10693],[91.55542,24.08687],[91.63782,24.1132],[91.65292,24.22095],[91.73257,24.14703],[91.76004,24.23848],[91.82596,24.22345],[91.89258,24.14674],[91.96603,24.3799],[92.11662,24.38997],[92.15796,24.54435],[92.25854,24.9191],[92.38626,24.86055],[92.49887,24.88796],[92.39147,25.01471],[92.33957,25.07593],[92.0316,25.1834],[91.63648,25.12846],[91.25517,25.20677],[90.87427,25.15799],[90.65042,25.17788],[90.40034,25.1534],[90.1155,25.22686],[89.90478,25.31038],[89.87629,25.28337],[89.83371,25.29548],[89.84086,25.31854],[89.81208,25.37244],[89.86129,25.61714],[89.84388,25.70042],[89.80585,25.82489],[89.86592,25.93115],[89.77728,26.04254],[89.77865,26.08387],[89.73581,26.15818],[89.70201,26.15138],[89.63968,26.22595],[89.57101,25.9682],[89.53515,26.00382],[89.35953,26.0077],[89.15869,26.13708]]]]}},{type:"Feature",properties:{iso1A2:"BE",iso1A3:"BEL",iso1N3:"056",wikidata:"Q31",nameEn:"Belgium",groups:["EU","155","150","UN"],callingCodes:["32"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.93295,51.44945],[4.93909,51.44632],[4.9524,51.45014],[4.95244,51.45207],[4.93295,51.44945]]],[[[4.91493,51.4353],[4.92652,51.43329],[4.92952,51.42984],[4.93986,51.43064],[4.94265,51.44003],[4.93471,51.43861],[4.93416,51.44185],[4.94025,51.44193],[4.93544,51.44634],[4.92879,51.44161],[4.92815,51.43856],[4.92566,51.44273],[4.92811,51.4437],[4.92287,51.44741],[4.91811,51.44621],[4.92227,51.44252],[4.91935,51.43634],[4.91493,51.4353]]],[[[4.82946,51.4213],[4.82409,51.44736],[4.84139,51.4799],[4.78803,51.50284],[4.77321,51.50529],[4.74578,51.48937],[4.72935,51.48424],[4.65442,51.42352],[4.57489,51.4324],[4.53521,51.4243],[4.52846,51.45002],[4.54675,51.47265],[4.5388,51.48184],[4.47736,51.4778],[4.38122,51.44905],[4.39747,51.43316],[4.38064,51.41965],[4.43777,51.36989],[4.39292,51.35547],[4.34086,51.35738],[4.33265,51.37687],[4.21923,51.37443],[4.24024,51.35371],[4.16721,51.29348],[4.05165,51.24171],[4.01957,51.24504],[3.97889,51.22537],[3.90125,51.20371],[3.78783,51.2151],[3.78999,51.25766],[3.58939,51.30064],[3.51502,51.28697],[3.52698,51.2458],[3.43488,51.24135],[3.41704,51.25933],[3.38289,51.27331],[3.35847,51.31572],[3.38696,51.33436],[3.36263,51.37112],[2.56575,51.85301],[2.18458,51.52087],[2.55904,51.07014],[2.57551,51.00326],[2.63074,50.94746],[2.59093,50.91751],[2.63331,50.81457],[2.71165,50.81295],[2.81056,50.71773],[2.8483,50.72276],[2.86985,50.7033],[2.87937,50.70298],[2.88504,50.70656],[2.90069,50.69263],[2.91036,50.6939],[2.90873,50.702],[2.95019,50.75138],[2.96778,50.75242],[3.00537,50.76588],[3.04314,50.77674],[3.09163,50.77717],[3.10614,50.78303],[3.11206,50.79416],[3.11987,50.79188],[3.1257,50.78603],[3.15017,50.79031],[3.16476,50.76843],[3.18339,50.74981],[3.18811,50.74025],[3.20064,50.73547],[3.19017,50.72569],[3.20845,50.71662],[3.22042,50.71019],[3.24593,50.71389],[3.26063,50.70086],[3.26141,50.69151],[3.2536,50.68977],[3.264,50.67668],[3.23951,50.6585],[3.2729,50.60718],[3.28575,50.52724],[3.37693,50.49538],[3.44629,50.51009],[3.47385,50.53397],[3.51564,50.5256],[3.49509,50.48885],[3.5683,50.50192],[3.58361,50.49049],[3.61014,50.49568],[3.64426,50.46275],[3.66153,50.45165],[3.67494,50.40239],[3.67262,50.38663],[3.65709,50.36873],[3.66976,50.34563],[3.71009,50.30305],[3.70987,50.3191],[3.73911,50.34809],[3.84314,50.35219],[3.90781,50.32814],[3.96771,50.34989],[4.0268,50.35793],[4.0689,50.3254],[4.10237,50.31247],[4.10957,50.30234],[4.11954,50.30425],[4.13665,50.25609],[4.16808,50.25786],[4.15524,50.2833],[4.17347,50.28838],[4.17861,50.27443],[4.20651,50.27333],[4.21945,50.25539],[4.15524,50.21103],[4.16014,50.19239],[4.13561,50.13078],[4.20147,50.13535],[4.23101,50.06945],[4.16294,50.04719],[4.13508,50.01976],[4.14239,49.98034],[4.20532,49.95803],[4.31963,49.97043],[4.35051,49.95315],[4.43488,49.94122],[4.51098,49.94659],[4.5414,49.96911],[4.68695,49.99685],[4.70064,50.09384],[4.75237,50.11314],[4.82438,50.16878],[4.83279,50.15331],[4.88602,50.15182],[4.8382,50.06738],[4.78827,49.95609],[4.88529,49.9236],[4.85134,49.86457],[4.86965,49.82271],[4.85464,49.78995],[4.96714,49.79872],[5.09249,49.76193],[5.14545,49.70287],[5.26232,49.69456],[5.31465,49.66846],[5.33039,49.6555],[5.30214,49.63055],[5.3137,49.61225],[5.33851,49.61599],[5.34837,49.62889],[5.3974,49.61596],[5.43713,49.5707],[5.46734,49.52648],[5.46541,49.49825],[5.55001,49.52729],[5.60909,49.51228],[5.64505,49.55146],[5.75649,49.54321],[5.7577,49.55915],[5.77435,49.56298],[5.79195,49.55228],[5.81838,49.54777],[5.84143,49.5533],[5.84692,49.55663],[5.8424,49.56082],[5.87256,49.57539],[5.86986,49.58756],[5.84971,49.58674],[5.84826,49.5969],[5.8762,49.60898],[5.87609,49.62047],[5.88393,49.62802],[5.88552,49.63507],[5.90599,49.63853],[5.90164,49.6511],[5.9069,49.66377],[5.86175,49.67862],[5.86527,49.69291],[5.88677,49.70951],[5.86503,49.72739],[5.84193,49.72161],[5.82562,49.72395],[5.83149,49.74729],[5.82245,49.75048],[5.78871,49.7962],[5.75409,49.79239],[5.74953,49.81428],[5.74364,49.82058],[5.74844,49.82435],[5.7404,49.83452],[5.74076,49.83823],[5.74975,49.83933],[5.74953,49.84709],[5.75884,49.84811],[5.74567,49.85368],[5.75861,49.85631],[5.75269,49.8711],[5.78415,49.87922],[5.73621,49.89796],[5.77314,49.93646],[5.77291,49.96056],[5.80833,49.96451],[5.81163,49.97142],[5.83467,49.97823],[5.83968,49.9892],[5.82331,49.99662],[5.81866,50.01286],[5.8551,50.02683],[5.86904,50.04614],[5.85474,50.06342],[5.8857,50.07824],[5.89488,50.11476],[5.95929,50.13295],[5.96453,50.17259],[6.02488,50.18283],[6.03093,50.16362],[6.06406,50.15344],[6.08577,50.17246],[6.12028,50.16374],[6.1137,50.13668],[6.1379,50.12964],[6.15298,50.14126],[6.14132,50.14971],[6.14588,50.17106],[6.18739,50.1822],[6.18364,50.20815],[6.16853,50.2234],[6.208,50.25179],[6.28797,50.27458],[6.29949,50.30887],[6.32488,50.32333],[6.35701,50.31139],[6.40641,50.32425],[6.40785,50.33557],[6.3688,50.35898],[6.34406,50.37994],[6.36852,50.40776],[6.37219,50.45397],[6.34005,50.46083],[6.3465,50.48833],[6.30809,50.50058],[6.26637,50.50272],[6.22335,50.49578],[6.20599,50.52089],[6.19193,50.5212],[6.18716,50.52653],[6.19579,50.5313],[6.19735,50.53576],[6.17802,50.54179],[6.17739,50.55875],[6.20281,50.56952],[6.22581,50.5907],[6.24005,50.58732],[6.24888,50.59869],[6.2476,50.60392],[6.26957,50.62444],[6.17852,50.6245],[6.11707,50.72231],[6.04428,50.72861],[6.0406,50.71848],[6.0326,50.72647],[6.03889,50.74618],[6.01976,50.75398],[5.97545,50.75441],[5.95942,50.7622],[5.89132,50.75124],[5.89129,50.75125],[5.88734,50.77092],[5.84888,50.75448],[5.84548,50.76542],[5.80673,50.7558],[5.77513,50.78308],[5.76533,50.78159],[5.74356,50.7691],[5.73904,50.75674],[5.72216,50.76398],[5.69469,50.75529],[5.68091,50.75804],[5.70107,50.7827],[5.68995,50.79641],[5.70118,50.80764],[5.65259,50.82309],[5.64009,50.84742],[5.64504,50.87107],[5.67886,50.88142],[5.69858,50.91046],[5.71626,50.90796],[5.72644,50.91167],[5.72545,50.92312],[5.74644,50.94723],[5.75927,50.95601],[5.74752,50.96202],[5.72875,50.95428],[5.71864,50.96092],[5.76242,50.99703],[5.77688,51.02483],[5.75961,51.03113],[5.77258,51.06196],[5.79835,51.05834],[5.79903,51.09371],[5.82921,51.09328],[5.83226,51.10585],[5.8109,51.10861],[5.80798,51.11661],[5.85508,51.14445],[5.82564,51.16753],[5.77697,51.1522],[5.77735,51.17845],[5.74617,51.18928],[5.70344,51.1829],[5.65528,51.18736],[5.65145,51.19788],[5.5603,51.22249],[5.5569,51.26544],[5.515,51.29462],[5.48476,51.30053],[5.46519,51.2849],[5.4407,51.28169],[5.41672,51.26248],[5.347,51.27502],[5.33886,51.26314],[5.29716,51.26104],[5.26461,51.26693],[5.23814,51.26064],[5.22542,51.26888],[5.24244,51.30495],[5.2002,51.32243],[5.16222,51.31035],[5.13377,51.31592],[5.13105,51.34791],[5.07102,51.39469],[5.10456,51.43163],[5.07891,51.4715],[5.04774,51.47022],[5.03281,51.48679],[5.0106,51.47167],[5.00393,51.44406],[4.92152,51.39487],[4.90016,51.41404],[4.84988,51.41502],[4.78941,51.41102],[4.77229,51.41337],[4.76577,51.43046],[4.78314,51.43319],[4.82946,51.4213]]]]}},{type:"Feature",properties:{iso1A2:"BF",iso1A3:"BFA",iso1N3:"854",wikidata:"Q965",nameEn:"Burkina Faso",groups:["011","202","002","UN"],callingCodes:["226"]},geometry:{type:"MultiPolygon",coordinates:[[[[.23859,15.00135],[.06588,14.96961],[-.24673,15.07805],[-.72004,15.08655],[-1.05875,14.7921],[-1.32166,14.72774],[-1.68083,14.50023],[-1.97945,14.47709],[-1.9992,14.19011],[-2.10223,14.14878],[-2.47587,14.29671],[-2.66175,14.14713],[-2.84667,14.05532],[-2.90831,13.81174],[-2.88189,13.64921],[-3.26407,13.70699],[-3.28396,13.5422],[-3.23599,13.29035],[-3.43507,13.27272],[-3.4313,13.1588],[-3.54454,13.1781],[-3.7911,13.36665],[-3.96282,13.38164],[-3.90558,13.44375],[-3.96501,13.49778],[-4.34477,13.12927],[-4.21819,12.95722],[-4.238,12.71467],[-4.47356,12.71252],[-4.41412,12.31922],[-4.57703,12.19875],[-4.54841,12.1385],[-4.62546,12.13204],[-4.62987,12.06531],[-4.70692,12.06746],[-4.72893,12.01579],[-5.07897,11.97918],[-5.26389,11.84778],[-5.40258,11.8327],[-5.26389,11.75728],[-5.29251,11.61715],[-5.22867,11.60421],[-5.20665,11.43811],[-5.25509,11.36905],[-5.25949,11.24816],[-5.32553,11.21578],[-5.32994,11.13371],[-5.49284,11.07538],[-5.41579,10.84628],[-5.47083,10.75329],[-5.46643,10.56074],[-5.51058,10.43177],[-5.39602,10.2929],[-5.12465,10.29788],[-4.96453,9.99923],[-4.96621,9.89132],[-4.6426,9.70696],[-4.31392,9.60062],[-4.25999,9.76012],[-3.69703,9.94279],[-3.31779,9.91125],[-3.27228,9.84981],[-3.19306,9.93781],[-3.16609,9.85147],[-3.00765,9.74019],[-2.93012,9.57403],[-2.76494,9.40778],[-2.68802,9.49343],[-2.76534,9.56589],[-2.74174,9.83172],[-2.83108,10.40252],[-2.94232,10.64281],[-2.83373,11.0067],[-.67143,10.99811],[-.61937,10.91305],[-.44298,11.04292],[-.42391,11.11661],[-.38219,11.12596],[-.35955,11.07801],[-.28566,11.12713],[-.27374,11.17157],[-.13493,11.14075],[.50388,11.01011],[.48852,10.98561],[.50521,10.98035],[.4958,10.93269],[.66104,10.99964],[.91245,10.99597],[.9813,11.08876],[1.03409,11.04719],[1.42823,11.46822],[2.00988,11.42227],[2.29983,11.68254],[2.39723,11.89473],[2.05785,12.35539],[2.26349,12.41915],[.99167,13.10727],[.99253,13.37515],[1.18873,13.31771],[1.21217,13.37853],[1.24516,13.33968],[1.28509,13.35488],[1.24429,13.39373],[1.20088,13.38951],[1.02813,13.46635],[.99514,13.5668],[.77637,13.64442],[.77377,13.6866],[.61924,13.68491],[.38051,14.05575],[.16936,14.51654],[.23859,15.00135]]]]}},{type:"Feature",properties:{iso1A2:"BG",iso1A3:"BGR",iso1N3:"100",wikidata:"Q219",nameEn:"Bulgaria",groups:["EU","151","150","UN"],callingCodes:["359"]},geometry:{type:"MultiPolygon",coordinates:[[[[23.05288,43.79494],[22.85314,43.84452],[22.83753,43.88055],[22.87873,43.9844],[23.01674,44.01946],[23.04988,44.07694],[22.67173,44.21564],[22.61711,44.16938],[22.61688,44.06534],[22.41449,44.00514],[22.35558,43.81281],[22.41043,43.69566],[22.47582,43.6558],[22.53397,43.47225],[22.82036,43.33665],[22.89727,43.22417],[23.00806,43.19279],[22.98104,43.11199],[22.89521,43.03625],[22.78397,42.98253],[22.74826,42.88701],[22.54302,42.87774],[22.43309,42.82057],[22.4997,42.74144],[22.43983,42.56851],[22.55669,42.50144],[22.51961,42.3991],[22.47498,42.3915],[22.45919,42.33822],[22.34773,42.31725],[22.38136,42.30339],[22.47251,42.20393],[22.50289,42.19527],[22.51224,42.15457],[22.67701,42.06614],[22.86749,42.02275],[22.90254,41.87587],[22.96682,41.77137],[23.01239,41.76527],[23.03342,41.71034],[22.95513,41.63265],[22.96331,41.35782],[22.93334,41.34104],[23.1833,41.31755],[23.21953,41.33773],[23.22771,41.37106],[23.31301,41.40525],[23.33639,41.36317],[23.40416,41.39999],[23.52453,41.40262],[23.63203,41.37632],[23.67644,41.41139],[23.76525,41.40175],[23.80148,41.43943],[23.89613,41.45257],[23.91483,41.47971],[23.96975,41.44118],[24.06908,41.46132],[24.06323,41.53222],[24.10063,41.54796],[24.18126,41.51735],[24.27124,41.57682],[24.30513,41.51297],[24.52599,41.56808],[24.61129,41.42278],[24.71529,41.41928],[24.8041,41.34913],[24.82514,41.4035],[24.86136,41.39298],[24.90928,41.40876],[24.942,41.38685],[25.11611,41.34212],[25.28322,41.23411],[25.48187,41.28506],[25.52394,41.2798],[25.55082,41.31667],[25.61042,41.30614],[25.66183,41.31316],[25.70507,41.29209],[25.8266,41.34563],[25.87919,41.30526],[26.12926,41.35878],[26.16548,41.42278],[26.20288,41.43943],[26.14796,41.47533],[26.176,41.50072],[26.17951,41.55409],[26.14328,41.55496],[26.15146,41.60828],[26.07083,41.64584],[26.06148,41.70345],[26.16841,41.74858],[26.21325,41.73223],[26.22888,41.74139],[26.2654,41.71544],[26.30255,41.70925],[26.35957,41.71149],[26.32952,41.73637],[26.33589,41.76802],[26.36952,41.82265],[26.53968,41.82653],[26.57961,41.90024],[26.56051,41.92995],[26.62996,41.97644],[26.79143,41.97386],[26.95638,42.00741],[27.03277,42.0809],[27.08486,42.08735],[27.19251,42.06028],[27.22376,42.10152],[27.27411,42.10409],[27.45478,41.96591],[27.52379,41.93756],[27.55191,41.90928],[27.69949,41.97515],[27.81235,41.94803],[27.83492,41.99709],[27.91479,41.97902],[28.02971,41.98066],[28.32297,41.98371],[29.24336,43.70874],[28.23293,43.76],[27.99558,43.84193],[27.92008,44.00761],[27.73468,43.95326],[27.64542,44.04958],[27.60834,44.01206],[27.39757,44.0141],[27.26845,44.12602],[26.95141,44.13555],[26.62712,44.05698],[26.38764,44.04356],[26.10115,43.96908],[26.05584,43.90925],[25.94911,43.85745],[25.72792,43.69263],[25.39528,43.61866],[25.17144,43.70261],[25.10718,43.6831],[24.96682,43.72693],[24.73542,43.68523],[24.62281,43.74082],[24.50264,43.76314],[24.35364,43.70211],[24.18149,43.68218],[23.73978,43.80627],[23.61687,43.79289],[23.4507,43.84936],[23.26772,43.84843],[23.05288,43.79494]]]]}},{type:"Feature",properties:{iso1A2:"BH",iso1A3:"BHR",iso1N3:"048",wikidata:"Q398",nameEn:"Bahrain",groups:["145","142","UN"],callingCodes:["973"]},geometry:{type:"MultiPolygon",coordinates:[[[[50.93865,26.30758],[50.71771,26.73086],[50.38162,26.53976],[50.26923,26.08243],[50.302,25.87592],[50.57069,25.57887],[50.80824,25.54641],[50.7801,25.595],[50.86149,25.6965],[50.81266,25.88946],[50.93865,26.30758]]]]}},{type:"Feature",properties:{iso1A2:"BI",iso1A3:"BDI",iso1N3:"108",wikidata:"Q967",nameEn:"Burundi",groups:["014","202","002","UN"],callingCodes:["257"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.54501,-2.41404],[30.42933,-2.31064],[30.14034,-2.43626],[29.95911,-2.33348],[29.88237,-2.75105],[29.36805,-2.82933],[29.32234,-2.6483],[29.0562,-2.58632],[29.04081,-2.7416],[29.00167,-2.78523],[29.00404,-2.81978],[29.0505,-2.81774],[29.09119,-2.87871],[29.09797,-2.91935],[29.16037,-2.95457],[29.17258,-2.99385],[29.25633,-3.05471],[29.21463,-3.3514],[29.23708,-3.75856],[29.43673,-4.44845],[29.63827,-4.44681],[29.75109,-4.45836],[29.77289,-4.41733],[29.82885,-4.36153],[29.88172,-4.35743],[30.03323,-4.26631],[30.22042,-4.01738],[30.45915,-3.56532],[30.84165,-3.25152],[30.83823,-2.97837],[30.6675,-2.98987],[30.57926,-2.89791],[30.4987,-2.9573],[30.40662,-2.86151],[30.52747,-2.65841],[30.41789,-2.66266],[30.54501,-2.41404]]]]}},{type:"Feature",properties:{iso1A2:"BJ",iso1A3:"BEN",iso1N3:"204",wikidata:"Q962",nameEn:"Benin",aliases:["DY"],groups:["011","202","002","UN"],callingCodes:["229"]},geometry:{type:"MultiPolygon",coordinates:[[[[3.59375,11.70269],[3.48187,11.86092],[3.31613,11.88495],[3.25352,12.01467],[2.83978,12.40585],[2.6593,12.30631],[2.37783,12.24804],[2.39657,12.10952],[2.45824,11.98672],[2.39723,11.89473],[2.29983,11.68254],[2.00988,11.42227],[1.42823,11.46822],[1.03409,11.04719],[.9813,11.08876],[.91245,10.99597],[.8804,10.803],[.80358,10.71459],[.77666,10.37665],[1.35507,9.99525],[1.36624,9.5951],[1.33675,9.54765],[1.41746,9.3226],[1.5649,9.16941],[1.61838,9.0527],[1.64249,6.99562],[1.55877,6.99737],[1.61812,6.74843],[1.58105,6.68619],[1.76906,6.43189],[1.79826,6.28221],[1.62913,6.24075],[1.67336,6.02702],[2.74181,6.13349],[2.70566,6.38038],[2.70464,6.50831],[2.74334,6.57291],[2.7325,6.64057],[2.78204,6.70514],[2.78823,6.76356],[2.73405,6.78508],[2.74024,6.92802],[2.71702,6.95722],[2.76965,7.13543],[2.74489,7.42565],[2.79442,7.43486],[2.78668,7.5116],[2.73405,7.5423],[2.73095,7.7755],[2.67523,7.87825],[2.77907,9.06924],[3.08017,9.10006],[3.14147,9.28375],[3.13928,9.47167],[3.25093,9.61632],[3.34726,9.70696],[3.32099,9.78032],[3.35383,9.83641],[3.54429,9.87739],[3.66908,10.18136],[3.57275,10.27185],[3.6844,10.46351],[3.78292,10.40538],[3.84243,10.59316],[3.71505,11.13015],[3.49175,11.29765],[3.59375,11.70269]]]]}},{type:"Feature",properties:{iso1A2:"BL",iso1A3:"BLM",iso1N3:"652",wikidata:"Q25362",nameEn:"Saint-Barth\xE9lemy",country:"FR",groups:["EU","Q1451600","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.62718,18.26185],[-63.1055,17.86651],[-62.34423,17.49165],[-62.62718,18.26185]]]]}},{type:"Feature",properties:{iso1A2:"BM",iso1A3:"BMU",iso1N3:"060",wikidata:"Q23635",nameEn:"Bermuda",country:"GB",groups:["BOTS","021","003","019","UN"],driveSide:"left",callingCodes:["1 441"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.20987,32.6953],[-65.31453,32.68437],[-65.63955,31.43417],[-63.20987,32.6953]]]]}},{type:"Feature",properties:{iso1A2:"BN",iso1A3:"BRN",iso1N3:"096",wikidata:"Q921",nameEn:"Brunei",groups:["Q36117","035","142","UN"],driveSide:"left",callingCodes:["673"]},geometry:{type:"MultiPolygon",coordinates:[[[[115.16236,5.01011],[115.02521,5.35005],[114.10166,4.76112],[114.07448,4.58441],[114.15813,4.57],[114.26876,4.49878],[114.32176,4.34942],[114.32176,4.2552],[114.4416,4.27588],[114.49922,4.13108],[114.64211,4.00694],[114.78539,4.12205],[114.88039,4.4257],[114.83189,4.42387],[114.77303,4.72871],[114.8266,4.75062],[114.88841,4.81905],[114.96982,4.81146],[114.99417,4.88201],[115.05038,4.90275],[115.02955,4.82087],[115.02278,4.74137],[115.04064,4.63706],[115.07737,4.53418],[115.09978,4.39123],[115.31275,4.30806],[115.36346,4.33563],[115.2851,4.42295],[115.27819,4.63661],[115.20737,4.8256],[115.15092,4.87604],[115.16236,5.01011]]]]}},{type:"Feature",properties:{iso1A2:"BO",iso1A3:"BOL",iso1N3:"068",wikidata:"Q750",nameEn:"Bolivia",groups:["005","419","019","UN"],callingCodes:["591"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.90248,-12.52544],[-64.22539,-12.45267],[-64.30708,-12.46398],[-64.99778,-11.98604],[-65.30027,-11.48749],[-65.28141,-10.86289],[-65.35402,-10.78685],[-65.37923,-10.35141],[-65.29019,-9.86253],[-65.40615,-9.63894],[-65.56244,-9.84266],[-65.68343,-9.75323],[-67.17784,-10.34016],[-68.71533,-11.14749],[-68.7651,-11.0496],[-68.75179,-11.03688],[-68.75265,-11.02383],[-68.74802,-11.00891],[-69.42792,-10.93451],[-69.47839,-10.95254],[-69.57156,-10.94555],[-68.98115,-11.8979],[-68.65044,-12.50689],[-68.85615,-12.87769],[-68.8864,-13.40792],[-69.05265,-13.68546],[-68.88135,-14.18639],[-69.36254,-14.94634],[-69.14856,-15.23478],[-69.40336,-15.61358],[-69.20291,-16.16668],[-69.09986,-16.22693],[-68.96238,-16.194],[-68.79464,-16.33272],[-68.98358,-16.42165],[-69.04027,-16.57214],[-69.00853,-16.66769],[-69.16896,-16.72233],[-69.62883,-17.28142],[-69.46863,-17.37466],[-69.46897,-17.4988],[-69.46623,-17.60518],[-69.34126,-17.72753],[-69.28671,-17.94844],[-69.07496,-18.03715],[-69.14807,-18.16893],[-69.07432,-18.28259],[-68.94987,-18.93302],[-68.87082,-19.06003],[-68.80602,-19.08355],[-68.61989,-19.27584],[-68.41218,-19.40499],[-68.66761,-19.72118],[-68.54611,-19.84651],[-68.57132,-20.03134],[-68.74273,-20.08817],[-68.7276,-20.46178],[-68.44023,-20.62701],[-68.55383,-20.7355],[-68.53957,-20.91542],[-68.40403,-20.94562],[-68.18816,-21.28614],[-67.85114,-22.87076],[-67.54284,-22.89771],[-67.18382,-22.81525],[-66.7298,-22.23644],[-66.29714,-22.08741],[-66.24077,-21.77837],[-66.03836,-21.84829],[-66.04832,-21.9187],[-65.9261,-21.93335],[-65.7467,-22.10105],[-65.61166,-22.09504],[-65.58694,-22.09794],[-65.57743,-22.07675],[-65.47435,-22.08908],[-64.99524,-22.08255],[-64.90014,-22.12136],[-64.67174,-22.18957],[-64.58888,-22.25035],[-64.4176,-22.67692],[-64.35108,-22.73282],[-64.31489,-22.88824],[-64.22918,-22.55807],[-63.93287,-21.99934],[-63.70963,-21.99934],[-63.68113,-22.0544],[-63.66482,-21.99918],[-62.81124,-21.9987],[-62.8078,-22.12534],[-62.64455,-22.25091],[-62.2757,-21.06657],[-62.26883,-20.55311],[-61.93912,-20.10053],[-61.73723,-19.63958],[-60.00638,-19.2981],[-59.06965,-19.29148],[-58.23216,-19.80058],[-58.16225,-20.16193],[-57.8496,-19.98346],[-58.14215,-19.76276],[-57.78463,-19.03259],[-57.71113,-19.03161],[-57.69134,-19.00544],[-57.71995,-18.97546],[-57.71995,-18.89573],[-57.76764,-18.90087],[-57.56807,-18.25655],[-57.48237,-18.24219],[-57.69877,-17.8431],[-57.73949,-17.56095],[-57.90082,-17.44555],[-57.99661,-17.5273],[-58.32935,-17.28195],[-58.5058,-16.80958],[-58.30918,-16.3699],[-58.32431,-16.25861],[-58.41506,-16.32636],[-60.16069,-16.26479],[-60.23797,-15.50267],[-60.58224,-15.09887],[-60.23968,-15.09515],[-60.27887,-14.63021],[-60.46037,-14.22496],[-60.48053,-13.77981],[-61.05527,-13.50054],[-61.81151,-13.49564],[-63.76259,-12.42952],[-63.90248,-12.52544]]]]}},{type:"Feature",properties:{iso1A2:"BQ",iso1A3:"BES",iso1N3:"535",wikidata:"Q27561",nameEn:"Caribbean Netherlands",country:"NL"},geometry:null},{type:"Feature",properties:{iso1A2:"BR",iso1A3:"BRA",iso1N3:"076",wikidata:"Q155",nameEn:"Brazil",groups:["005","419","019","UN"],callingCodes:["55"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.69361,4.34069],[-59.78878,4.45637],[-60.15953,4.53456],[-60.04189,4.69801],[-59.98129,5.07097],[-60.20944,5.28754],[-60.32352,5.21299],[-60.73204,5.20931],[-60.5802,4.94312],[-60.86539,4.70512],[-60.98303,4.54167],[-61.15703,4.49839],[-61.31457,4.54167],[-61.29675,4.44216],[-61.48569,4.43149],[-61.54629,4.2822],[-62.13094,4.08309],[-62.44822,4.18621],[-62.57656,4.04754],[-62.74411,4.03331],[-62.7655,3.73099],[-62.98296,3.59935],[-63.21111,3.96219],[-63.4464,3.9693],[-63.42233,3.89995],[-63.50611,3.83592],[-63.67099,4.01731],[-63.70218,3.91417],[-63.86082,3.94796],[-63.99183,3.90172],[-64.14512,4.12932],[-64.57648,4.12576],[-64.72977,4.28931],[-64.84028,4.24665],[-64.48379,3.7879],[-64.02908,2.79797],[-64.0257,2.48156],[-63.39114,2.4317],[-63.39827,2.16098],[-64.06135,1.94722],[-64.08274,1.64792],[-64.34654,1.35569],[-64.38932,1.5125],[-65.11657,1.12046],[-65.57288,.62856],[-65.50158,.92086],[-65.6727,1.01353],[-66.28507,.74585],[-66.85795,1.22998],[-67.08222,1.17441],[-67.15784,1.80439],[-67.299,1.87494],[-67.40488,2.22258],[-67.9292,1.82455],[-68.18632,2.00091],[-68.26699,1.83463],[-68.18128,1.72881],[-69.38621,1.70865],[-69.53746,1.76408],[-69.83491,1.69353],[-69.82987,1.07864],[-69.26017,1.06856],[-69.14422,.84172],[-69.20976,.57958],[-69.47696,.71065],[-70.04162,.55437],[-70.03658,-.19681],[-69.603,-.51947],[-69.59796,-.75136],[-69.4215,-1.01853],[-69.43395,-1.42219],[-69.94708,-4.2431],[-70.00888,-4.37833],[-70.11305,-4.27281],[-70.19582,-4.3607],[-70.33236,-4.15214],[-70.77601,-4.15717],[-70.96814,-4.36915],[-71.87003,-4.51661],[-72.64391,-5.0391],[-72.83973,-5.14765],[-73.24579,-6.05764],[-73.12983,-6.43852],[-73.73986,-6.87919],[-73.77011,-7.28944],[-73.96938,-7.58465],[-73.65485,-7.77897],[-73.76576,-7.89884],[-72.92886,-9.04074],[-73.21498,-9.40904],[-72.72216,-9.41397],[-72.31883,-9.5184],[-72.14742,-9.98049],[-71.23394,-9.9668],[-70.53373,-9.42628],[-70.58453,-9.58303],[-70.55429,-9.76692],[-70.62487,-9.80666],[-70.64134,-11.0108],[-70.51395,-10.92249],[-70.38791,-11.07096],[-69.90896,-10.92744],[-69.57835,-10.94051],[-69.57156,-10.94555],[-69.47839,-10.95254],[-69.42792,-10.93451],[-68.74802,-11.00891],[-68.75265,-11.02383],[-68.75179,-11.03688],[-68.7651,-11.0496],[-68.71533,-11.14749],[-67.17784,-10.34016],[-65.68343,-9.75323],[-65.56244,-9.84266],[-65.40615,-9.63894],[-65.29019,-9.86253],[-65.37923,-10.35141],[-65.35402,-10.78685],[-65.28141,-10.86289],[-65.30027,-11.48749],[-64.99778,-11.98604],[-64.30708,-12.46398],[-64.22539,-12.45267],[-63.90248,-12.52544],[-63.76259,-12.42952],[-61.81151,-13.49564],[-61.05527,-13.50054],[-60.48053,-13.77981],[-60.46037,-14.22496],[-60.27887,-14.63021],[-60.23968,-15.09515],[-60.58224,-15.09887],[-60.23797,-15.50267],[-60.16069,-16.26479],[-58.41506,-16.32636],[-58.32431,-16.25861],[-58.30918,-16.3699],[-58.5058,-16.80958],[-58.32935,-17.28195],[-57.99661,-17.5273],[-57.90082,-17.44555],[-57.73949,-17.56095],[-57.69877,-17.8431],[-57.48237,-18.24219],[-57.56807,-18.25655],[-57.76764,-18.90087],[-57.71995,-18.89573],[-57.71995,-18.97546],[-57.69134,-19.00544],[-57.71113,-19.03161],[-57.78463,-19.03259],[-58.14215,-19.76276],[-57.8496,-19.98346],[-58.16225,-20.16193],[-57.84536,-20.93155],[-57.93492,-21.65505],[-57.88239,-21.6868],[-57.94642,-21.73799],[-57.98625,-22.09157],[-56.6508,-22.28387],[-56.5212,-22.11556],[-56.45893,-22.08072],[-56.23206,-22.25347],[-55.8331,-22.29008],[-55.74941,-22.46436],[-55.741,-22.52018],[-55.72366,-22.5519],[-55.6986,-22.56268],[-55.68742,-22.58407],[-55.62493,-22.62765],[-55.63849,-22.95122],[-55.5446,-23.22811],[-55.52288,-23.2595],[-55.5555,-23.28237],[-55.43585,-23.87157],[-55.44117,-23.9185],[-55.41784,-23.9657],[-55.12292,-23.99669],[-55.0518,-23.98666],[-55.02691,-23.97317],[-54.6238,-23.83078],[-54.32807,-24.01865],[-54.28207,-24.07305],[-54.4423,-25.13381],[-54.62033,-25.46026],[-54.60196,-25.48397],[-54.59509,-25.53696],[-54.59398,-25.59224],[-54.5502,-25.58915],[-54.52926,-25.62846],[-53.90831,-25.55513],[-53.83691,-25.94849],[-53.73511,-26.04211],[-53.73086,-26.05842],[-53.7264,-26.0664],[-53.73391,-26.07006],[-53.73968,-26.10012],[-53.65018,-26.19501],[-53.65237,-26.23289],[-53.63739,-26.2496],[-53.63881,-26.25075],[-53.64632,-26.24798],[-53.64186,-26.25976],[-53.64505,-26.28089],[-53.68269,-26.33359],[-53.73372,-26.6131],[-53.80144,-27.09844],[-54.15978,-27.2889],[-54.19062,-27.27639],[-54.19268,-27.30751],[-54.41888,-27.40882],[-54.50416,-27.48232],[-54.67657,-27.57214],[-54.90159,-27.63132],[-54.90805,-27.73149],[-55.1349,-27.89759],[-55.16872,-27.86224],[-55.33303,-27.94661],[-55.6262,-28.17124],[-55.65418,-28.18304],[-56.01729,-28.51223],[-56.00458,-28.60421],[-56.05265,-28.62651],[-56.54171,-29.11447],[-56.57295,-29.11357],[-56.62789,-29.18073],[-56.81251,-29.48154],[-57.09386,-29.74211],[-57.65132,-30.19229],[-57.22502,-30.26121],[-56.90236,-30.02578],[-56.49267,-30.39471],[-56.4795,-30.3899],[-56.4619,-30.38457],[-55.87388,-31.05053],[-55.58866,-30.84117],[-55.5634,-30.8686],[-55.55373,-30.8732],[-55.55218,-30.88193],[-55.54572,-30.89051],[-55.53431,-30.89714],[-55.53276,-30.90218],[-55.52712,-30.89997],[-55.51862,-30.89828],[-55.50841,-30.9027],[-55.50821,-30.91349],[-54.17384,-31.86168],[-53.76024,-32.0751],[-53.39572,-32.58596],[-53.37671,-32.57005],[-53.1111,-32.71147],[-53.53459,-33.16843],[-53.52794,-33.68908],[-53.44031,-33.69344],[-53.39593,-33.75169],[-53.37138,-33.74313],[-52.83257,-34.01481],[-28.34015,-20.99094],[-28.99601,1.86593],[-51.35485,4.8383],[-51.63798,4.51394],[-51.61983,4.14596],[-51.79599,3.89336],[-51.82312,3.85825],[-51.85573,3.83427],[-52.31787,3.17896],[-52.6906,2.37298],[-52.96539,2.1881],[-53.78743,2.34412],[-54.16286,2.10779],[-54.6084,2.32856],[-55.01919,2.564],[-55.71493,2.40342],[-55.96292,2.53188],[-56.13054,2.27723],[-55.92159,2.05236],[-55.89863,1.89861],[-55.99278,1.83137],[-56.47045,1.95135],[-56.7659,1.89509],[-57.07092,1.95304],[-57.09109,2.01854],[-57.23981,1.95808],[-57.35073,1.98327],[-57.55743,1.69605],[-57.77281,1.73344],[-57.97336,1.64566],[-58.01873,1.51966],[-58.33887,1.58014],[-58.4858,1.48399],[-58.53571,1.29154],[-58.84229,1.17749],[-58.92072,1.31293],[-59.25583,1.40559],[-59.74066,1.87596],[-59.7264,2.27497],[-59.91177,2.36759],[-59.99733,2.92312],[-59.79769,3.37162],[-59.86899,3.57089],[-59.51963,3.91951],[-59.73353,4.20399],[-59.69361,4.34069]]]]}},{type:"Feature",properties:{iso1A2:"BS",iso1A3:"BHS",iso1N3:"044",wikidata:"Q778",nameEn:"The Bahamas",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 242"]},geometry:{type:"MultiPolygon",coordinates:[[[[-72.98446,20.4801],[-71.70065,25.7637],[-78.91214,27.76553],[-80.65727,23.71953],[-72.98446,20.4801]]]]}},{type:"Feature",properties:{iso1A2:"BT",iso1A3:"BTN",iso1N3:"064",wikidata:"Q917",nameEn:"Bhutan",groups:["034","142","UN"],driveSide:"left",callingCodes:["975"]},geometry:{type:"MultiPolygon",coordinates:[[[[91.6469,27.76358],[91.5629,27.84823],[91.48973,27.93903],[91.46327,28.0064],[91.25779,28.07509],[91.20019,27.98715],[90.69894,28.07784],[90.58842,28.02838],[90.13387,28.19178],[89.79762,28.23979],[89.59525,28.16433],[89.12825,27.62502],[89.0582,27.60985],[88.97213,27.51671],[88.95355,27.4106],[89.00216,27.32532],[88.96947,27.30319],[88.93678,27.33777],[88.91901,27.32483],[88.74219,27.144],[88.86984,27.10937],[88.8714,26.97488],[88.92301,26.99286],[88.95807,26.92668],[89.09554,26.89089],[89.12825,26.81661],[89.1926,26.81329],[89.37913,26.86224],[89.38319,26.85963],[89.3901,26.84225],[89.42349,26.83727],[89.63369,26.74402],[89.86124,26.73307],[90.04535,26.72422],[90.30402,26.85098],[90.39271,26.90704],[90.48504,26.8594],[90.67715,26.77215],[91.50067,26.79223],[91.83181,26.87318],[92.05523,26.8692],[92.11863,26.893],[92.03457,27.07334],[92.04702,27.26861],[92.12019,27.27829],[92.01132,27.47352],[91.65007,27.48287],[91.55819,27.6144],[91.6469,27.76358]]]]}},{type:"Feature",properties:{iso1A2:"BV",iso1A3:"BVT",iso1N3:"074",wikidata:"Q23408",nameEn:"Bouvet Island",country:"NO",groups:["005","419","019","UN"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.54042,-54.0949],[2.28941,-54.13089],[3.35353,-55.17558],[4.54042,-54.0949]]]]}},{type:"Feature",properties:{iso1A2:"BW",iso1A3:"BWA",iso1N3:"072",wikidata:"Q963",nameEn:"Botswana",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["267"]},geometry:{type:"MultiPolygon",coordinates:[[[[25.26433,-17.79571],[25.16882,-17.78253],[25.05895,-17.84452],[24.95586,-17.79674],[24.73364,-17.89338],[24.71887,-17.9218],[24.6303,-17.9863],[24.57485,-18.07151],[24.40577,-17.95726],[24.19416,-18.01919],[23.61088,-18.4881],[23.29618,-17.99855],[23.0996,-18.00075],[21.45556,-18.31795],[20.99904,-18.31743],[20.99751,-22.00026],[19.99912,-21.99991],[19.99817,-24.76768],[20.02809,-24.78725],[20.03678,-24.81004],[20.29826,-24.94869],[20.64795,-25.47827],[20.86081,-26.14892],[20.61754,-26.4692],[20.63275,-26.78181],[20.68596,-26.9039],[20.87031,-26.80047],[21.13353,-26.86661],[21.37869,-26.82083],[21.69322,-26.86152],[21.7854,-26.79199],[21.77114,-26.69015],[21.83291,-26.65959],[21.90703,-26.66808],[22.06192,-26.61882],[22.21206,-26.3773],[22.41921,-26.23078],[22.56365,-26.19668],[22.70808,-25.99186],[22.86012,-25.50572],[23.03497,-25.29971],[23.47588,-25.29971],[23.9244,-25.64286],[24.18287,-25.62916],[24.36531,-25.773],[24.44703,-25.73021],[24.67319,-25.81749],[24.8946,-25.80723],[25.01718,-25.72507],[25.12266,-25.75931],[25.33076,-25.76616],[25.58543,-25.6343],[25.6643,-25.4491],[25.69661,-25.29284],[25.72702,-25.25503],[25.88571,-24.87802],[25.84295,-24.78661],[25.8515,-24.75727],[26.39409,-24.63468],[26.46346,-24.60358],[26.51667,-24.47219],[26.84165,-24.24885],[26.99749,-23.65486],[27.33768,-23.40917],[27.52393,-23.37952],[27.6066,-23.21894],[27.74154,-23.2137],[27.93539,-23.04941],[27.93729,-22.96194],[28.04752,-22.90243],[28.04562,-22.8394],[28.34874,-22.5694],[28.63287,-22.55887],[28.91889,-22.44299],[29.0151,-22.22907],[29.10881,-22.21202],[29.15268,-22.21399],[29.18974,-22.18599],[29.21955,-22.17771],[29.37703,-22.19581],[29.3533,-22.18363],[29.24648,-22.05967],[29.1974,-22.07472],[29.14501,-22.07275],[29.08495,-22.04867],[29.04108,-22.00563],[29.02191,-21.95665],[29.02191,-21.90647],[29.04023,-21.85864],[29.07763,-21.81877],[28.58114,-21.63455],[28.49942,-21.66634],[28.29416,-21.59037],[28.01669,-21.57624],[27.91407,-21.31621],[27.69171,-21.08409],[27.72972,-20.51735],[27.69361,-20.48531],[27.28865,-20.49873],[27.29831,-20.28935],[27.21278,-20.08244],[26.72246,-19.92707],[26.17227,-19.53709],[25.96226,-19.08152],[25.99837,-19.02943],[25.94326,-18.90362],[25.82353,-18.82808],[25.79217,-18.6355],[25.68859,-18.56165],[25.53465,-18.39041],[25.39972,-18.12691],[25.31799,-18.07091],[25.23909,-17.90832],[25.26433,-17.79571]]]]}},{type:"Feature",properties:{iso1A2:"BY",iso1A3:"BLR",iso1N3:"112",wikidata:"Q184",nameEn:"Belarus",groups:["151","150","UN"],callingCodes:["375"]},geometry:{type:"MultiPolygon",coordinates:[[[[28.15217,56.16964],[27.97865,56.11849],[27.63065,55.89687],[27.61683,55.78558],[27.3541,55.8089],[27.27804,55.78299],[27.1559,55.85032],[26.97153,55.8102],[26.87448,55.7172],[26.76872,55.67658],[26.71802,55.70645],[26.64888,55.70515],[26.63231,55.67968],[26.63167,55.57887],[26.55094,55.5093],[26.5522,55.40277],[26.44937,55.34832],[26.5709,55.32572],[26.6714,55.33902],[26.80929,55.31642],[26.83266,55.30444],[26.835,55.28182],[26.73017,55.24226],[26.72983,55.21788],[26.68075,55.19787],[26.69243,55.16718],[26.54753,55.14181],[26.51481,55.16051],[26.46249,55.12814],[26.35121,55.1525],[26.30628,55.12536],[26.23202,55.10439],[26.26941,55.08032],[26.20397,54.99729],[26.13386,54.98924],[26.05907,54.94631],[25.99129,54.95705],[25.89462,54.93438],[25.74122,54.80108],[25.75977,54.57252],[25.68045,54.5321],[25.64813,54.48704],[25.62203,54.4656],[25.63371,54.42075],[25.5376,54.33158],[25.55425,54.31591],[25.68513,54.31727],[25.78553,54.23327],[25.78563,54.15747],[25.71084,54.16704],[25.64875,54.1259],[25.54724,54.14925],[25.51452,54.17799],[25.56823,54.25212],[25.509,54.30267],[25.35559,54.26544],[25.22705,54.26271],[25.19199,54.219],[25.0728,54.13419],[24.991,54.14241],[24.96894,54.17589],[24.77131,54.11091],[24.85311,54.02862],[24.74279,53.96663],[24.69185,53.96543],[24.69652,54.01901],[24.62275,54.00217],[24.44411,53.90076],[24.34128,53.90076],[24.19638,53.96405],[23.98837,53.92554],[23.95098,53.9613],[23.81309,53.94205],[23.80543,53.89558],[23.71726,53.93379],[23.61677,53.92691],[23.51284,53.95052],[23.62004,53.60942],[23.81995,53.24131],[23.85657,53.22923],[23.91393,53.16469],[23.87548,53.0831],[23.92184,53.02079],[23.94689,52.95919],[23.91805,52.94016],[23.93763,52.71332],[23.73615,52.6149],[23.58296,52.59868],[23.45112,52.53774],[23.34141,52.44845],[23.18196,52.28812],[23.20071,52.22848],[23.47859,52.18215],[23.54314,52.12148],[23.61,52.11264],[23.64066,52.07626],[23.68733,51.9906],[23.61523,51.92066],[23.62691,51.78208],[23.53198,51.74298],[23.57053,51.55938],[23.56236,51.53673],[23.62751,51.50512],[23.6736,51.50255],[23.60906,51.62122],[23.7766,51.66809],[23.91118,51.63316],[23.8741,51.59734],[23.99907,51.58369],[24.13075,51.66979],[24.3163,51.75063],[24.29021,51.80841],[24.37123,51.88222],[24.98784,51.91273],[25.20228,51.97143],[25.46163,51.92205],[25.73673,51.91973],[25.80574,51.94556],[25.83217,51.92587],[26.00408,51.92967],[26.19084,51.86781],[26.39367,51.87315],[26.46962,51.80501],[26.69759,51.82284],[26.80043,51.75777],[26.9489,51.73788],[26.99422,51.76933],[27.20602,51.77291],[27.20948,51.66713],[27.26613,51.65957],[27.24828,51.60161],[27.47212,51.61184],[27.51058,51.5854],[27.55727,51.63486],[27.71932,51.60672],[27.67125,51.50854],[27.76052,51.47604],[27.85253,51.62293],[27.91844,51.61952],[27.95827,51.56065],[28.10658,51.57857],[28.23452,51.66988],[28.37592,51.54505],[28.47051,51.59734],[28.64429,51.5664],[28.69161,51.44695],[28.73143,51.46236],[28.75615,51.41442],[28.78224,51.45294],[28.76027,51.48802],[28.81795,51.55552],[28.95528,51.59222],[28.99098,51.56833],[29.1187,51.65872],[29.16402,51.64679],[29.20659,51.56918],[29.25603,51.57089],[29.25191,51.49828],[29.32881,51.37843],[29.42357,51.4187],[29.49773,51.39814],[29.54372,51.48372],[29.7408,51.53417],[29.77376,51.4461],[30.17888,51.51025],[30.34642,51.42555],[30.36153,51.33984],[30.56203,51.25655],[30.64992,51.35014],[30.51946,51.59649],[30.68804,51.82806],[30.76443,51.89739],[30.90897,52.00699],[30.95589,52.07775],[31.13332,52.1004],[31.25142,52.04131],[31.38326,52.12991],[31.7822,52.11406],[31.77877,52.18636],[31.6895,52.1973],[31.70735,52.26711],[31.57971,52.32146],[31.62084,52.33849],[31.61397,52.48843],[31.56316,52.51518],[31.63869,52.55361],[31.50406,52.69707],[31.57277,52.71613],[31.592,52.79011],[31.35667,52.97854],[31.24147,53.031],[31.32283,53.04101],[31.33519,53.08805],[31.3915,53.09712],[31.36403,53.13504],[31.40523,53.21406],[31.56316,53.19432],[31.62496,53.22886],[31.787,53.18033],[31.82373,53.10042],[32.15368,53.07594],[32.40773,53.18856],[32.51725,53.28431],[32.73257,53.33494],[32.74968,53.45597],[32.47777,53.5548],[32.40499,53.6656],[32.50112,53.68594],[32.45717,53.74039],[32.36663,53.7166],[32.12621,53.81586],[31.89137,53.78099],[31.77028,53.80015],[31.85019,53.91801],[31.88744,54.03653],[31.89599,54.0837],[31.57002,54.14535],[31.30791,54.25315],[31.3177,54.34067],[31.22945,54.46585],[31.08543,54.50361],[31.21399,54.63113],[31.19339,54.66947],[30.99187,54.67046],[30.98226,54.68872],[31.0262,54.70698],[30.97127,54.71967],[30.95479,54.74346],[30.75165,54.80699],[30.8264,54.90062],[30.81759,54.94064],[30.93144,54.9585],[30.95754,54.98609],[30.9081,55.02232],[30.94243,55.03964],[31.00972,55.02783],[31.02071,55.06167],[30.97369,55.17134],[30.87944,55.28223],[30.81946,55.27931],[30.8257,55.3313],[30.93144,55.3914],[30.90123,55.46621],[30.95204,55.50667],[30.93419,55.6185],[30.86003,55.63169],[30.7845,55.58514],[30.72957,55.66268],[30.67464,55.64176],[30.63344,55.73079],[30.51037,55.76568],[30.51346,55.78982],[30.48257,55.81066],[30.30987,55.83592],[30.27776,55.86819],[30.12136,55.8358],[29.97975,55.87281],[29.80672,55.79569],[29.61446,55.77716],[29.51283,55.70294],[29.3604,55.75862],[29.44692,55.95978],[29.21717,55.98971],[29.08299,56.03427],[28.73418,55.97131],[28.63668,56.07262],[28.68337,56.10173],[28.5529,56.11705],[28.43068,56.09407],[28.37987,56.11399],[28.36888,56.05805],[28.30571,56.06035],[28.15217,56.16964]]]]}},{type:"Feature",properties:{iso1A2:"BZ",iso1A3:"BLZ",iso1N3:"084",wikidata:"Q242",nameEn:"Belize",groups:["013","003","419","019","UN"],roadSpeedUnit:"mph",callingCodes:["501"]},geometry:{type:"MultiPolygon",coordinates:[[[[-88.3268,18.49048],[-88.48242,18.49164],[-88.71505,18.0707],[-88.8716,17.89535],[-89.03839,18.0067],[-89.15105,17.95104],[-89.14985,17.81563],[-89.15025,17.04813],[-89.22683,15.88619],[-89.17418,15.90898],[-89.02415,15.9063],[-88.95358,15.88698],[-88.40779,16.09624],[-86.92368,17.61462],[-87.84815,18.18511],[-87.85693,18.18266],[-87.86657,18.19971],[-87.87604,18.18313],[-87.90671,18.15213],[-88.03165,18.16657],[-88.03238,18.41778],[-88.26593,18.47617],[-88.29909,18.47591],[-88.3268,18.49048]]]]}},{type:"Feature",properties:{iso1A2:"CA",iso1A3:"CAN",iso1N3:"124",wikidata:"Q16",nameEn:"Canada",groups:["021","003","019","UN"],callingCodes:["1"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.20349,45.1722],[-67.19603,45.16771],[-67.15965,45.16179],[-67.11316,45.11176],[-67.0216,44.95333],[-66.96824,44.90965],[-66.98249,44.87071],[-66.96824,44.83078],[-66.93432,44.82597],[-67.16117,44.20069],[-61.98255,37.34815],[-56.27503,47.39728],[-53.12387,41.40385],[-46.37635,57.3249],[-77.52957,77.23408],[-68.21821,80.48551],[-49.33696,84.57952],[-140.97446,84.39275],[-141.00116,60.30648],[-140.5227,60.22077],[-140.45648,60.30919],[-139.98024,60.18027],[-139.68991,60.33693],[-139.05831,60.35205],[-139.20603,60.08896],[-139.05365,59.99655],[-138.71149,59.90728],[-138.62145,59.76431],[-137.60623,59.24465],[-137.4925,58.89415],[-136.82619,59.16198],[-136.52365,59.16752],[-136.47323,59.46617],[-136.33727,59.44466],[-136.22381,59.55526],[-136.31566,59.59083],[-135.48007,59.79937],[-135.03069,59.56208],[-135.00267,59.28745],[-134.7047,59.2458],[-134.55699,59.1297],[-134.48059,59.13231],[-134.27175,58.8634],[-133.84645,58.73543],[-133.38523,58.42773],[-131.8271,56.62247],[-130.77769,56.36185],[-130.33965,56.10849],[-130.10173,56.12178],[-130.00093,56.00325],[-130.00857,55.91344],[-130.15373,55.74895],[-129.97513,55.28029],[-130.08035,55.21556],[-130.18765,55.07744],[-130.27203,54.97174],[-130.44184,54.85377],[-130.64499,54.76912],[-130.61931,54.70835],[-133.92876,54.62289],[-133.36909,48.51151],[-125.03842,48.53282],[-123.50039,48.21223],[-123.15614,48.35395],[-123.26565,48.6959],[-123.0093,48.76586],[-123.0093,48.83186],[-123.32163,49.00419],[-95.15355,48.9996],[-95.15357,49.384],[-95.12903,49.37056],[-95.05825,49.35311],[-95.01419,49.35647],[-94.99532,49.36579],[-94.95681,49.37035],[-94.85381,49.32492],[-94.8159,49.32299],[-94.82487,49.29483],[-94.77355,49.11998],[-94.75017,49.09931],[-94.687,48.84077],[-94.70087,48.8339],[-94.70486,48.82365],[-94.69669,48.80918],[-94.69335,48.77883],[-94.58903,48.71803],[-94.54885,48.71543],[-94.53826,48.70216],[-94.44258,48.69223],[-94.4174,48.71049],[-94.27153,48.70232],[-94.25172,48.68404],[-94.25104,48.65729],[-94.23215,48.65202],[-93.85769,48.63284],[-93.83288,48.62745],[-93.80676,48.58232],[-93.80939,48.52439],[-93.79267,48.51631],[-93.66382,48.51845],[-93.47022,48.54357],[-93.44472,48.59147],[-93.40693,48.60948],[-93.39758,48.60364],[-93.3712,48.60599],[-93.33946,48.62787],[-93.25391,48.64266],[-92.94973,48.60866],[-92.7287,48.54005],[-92.6342,48.54133],[-92.62747,48.50278],[-92.69927,48.49573],[-92.71323,48.46081],[-92.65606,48.43471],[-92.50712,48.44921],[-92.45588,48.40624],[-92.48147,48.36609],[-92.37185,48.22259],[-92.27167,48.25046],[-92.30939,48.31251],[-92.26662,48.35651],[-92.202,48.35252],[-92.14732,48.36578],[-92.05339,48.35958],[-91.98929,48.25409],[-91.86125,48.21278],[-91.71231,48.19875],[-91.70451,48.11805],[-91.55649,48.10611],[-91.58025,48.04339],[-91.45829,48.07454],[-91.43248,48.04912],[-91.25025,48.08522],[-91.08016,48.18096],[-90.87588,48.2484],[-90.75045,48.09143],[-90.56444,48.12184],[-90.56312,48.09488],[-90.07418,48.11043],[-89.89974,47.98109],[-89.77248,48.02607],[-89.57972,48.00023],[-89.48837,48.01412],[-88.37033,48.30586],[-84.85871,46.88881],[-84.55635,46.45974],[-84.47607,46.45225],[-84.4481,46.48972],[-84.42101,46.49853],[-84.34174,46.50683],[-84.29893,46.49127],[-84.26351,46.49508],[-84.2264,46.53337],[-84.1945,46.54061],[-84.17723,46.52753],[-84.12885,46.53068],[-84.11196,46.50248],[-84.13451,46.39218],[-84.11254,46.32329],[-84.11615,46.2681],[-84.09756,46.25512],[-84.1096,46.23987],[-83.95399,46.05634],[-83.90453,46.05922],[-83.83329,46.12169],[-83.57017,46.105],[-83.43746,45.99749],[-83.59589,45.82131],[-82.48419,45.30225],[-82.42469,42.992],[-82.4146,42.97626],[-82.4253,42.95423],[-82.45331,42.93139],[-82.4826,42.8068],[-82.46613,42.76615],[-82.51063,42.66025],[-82.51858,42.611],[-82.57583,42.5718],[-82.58873,42.54984],[-82.64242,42.55594],[-82.82964,42.37355],[-83.02253,42.33045],[-83.07837,42.30978],[-83.09837,42.28877],[-83.12724,42.2376],[-83.14962,42.04089],[-83.11184,41.95671],[-82.67862,41.67615],[-78.93684,42.82887],[-78.90712,42.89733],[-78.90905,42.93022],[-78.93224,42.95229],[-78.96312,42.95509],[-78.98126,42.97],[-79.02074,42.98444],[-79.02424,43.01983],[-78.99941,43.05612],[-79.01055,43.06659],[-79.07486,43.07845],[-79.05671,43.10937],[-79.06881,43.12029],[-79.0427,43.13934],[-79.04652,43.16396],[-79.05384,43.17418],[-79.05002,43.20133],[-79.05544,43.21224],[-79.05512,43.25375],[-79.06921,43.26183],[-79.25796,43.54052],[-76.79706,43.63099],[-76.43859,44.09393],[-76.35324,44.13493],[-76.31222,44.19894],[-76.244,44.19643],[-76.1664,44.23051],[-76.16285,44.28262],[-76.00018,44.34896],[-75.95947,44.34463],[-75.8217,44.43176],[-75.76813,44.51537],[-75.41441,44.76614],[-75.2193,44.87821],[-75.01363,44.95608],[-74.99101,44.98051],[-74.8447,45.00606],[-74.66689,45.00646],[-74.32699,44.99029],[-73.35025,45.00942],[-71.50067,45.01357],[-71.48735,45.07784],[-71.42778,45.12624],[-71.40364,45.21382],[-71.44252,45.2361],[-71.37133,45.24624],[-71.29371,45.29996],[-71.22338,45.25184],[-71.19723,45.25438],[-71.14568,45.24128],[-71.08364,45.30623],[-71.01866,45.31573],[-71.0107,45.34819],[-70.95193,45.33895],[-70.91169,45.29849],[-70.89864,45.2398],[-70.84816,45.22698],[-70.80236,45.37444],[-70.82638,45.39828],[-70.78372,45.43269],[-70.65383,45.37592],[-70.62518,45.42286],[-70.72651,45.49771],[-70.68516,45.56964],[-70.54019,45.67291],[-70.38934,45.73215],[-70.41523,45.79497],[-70.25976,45.89675],[-70.24694,45.95138],[-70.31025,45.96424],[-70.23855,46.1453],[-70.29078,46.18832],[-70.18547,46.35357],[-70.05812,46.41768],[-69.99966,46.69543],[-69.22119,47.46461],[-69.05148,47.42012],[-69.05073,47.30076],[-69.05039,47.2456],[-68.89222,47.1807],[-68.70125,47.24399],[-68.60575,47.24659],[-68.57914,47.28431],[-68.38332,47.28723],[-68.37458,47.35851],[-68.23244,47.35712],[-67.94843,47.1925],[-67.87993,47.10377],[-67.78578,47.06473],[-67.78111,45.9392],[-67.75196,45.91814],[-67.80961,45.87531],[-67.75654,45.82324],[-67.80653,45.80022],[-67.80705,45.69528],[-67.6049,45.60725],[-67.43815,45.59162],[-67.42144,45.50584],[-67.50578,45.48971],[-67.42394,45.37969],[-67.48201,45.27351],[-67.34927,45.122],[-67.29754,45.14865],[-67.29748,45.18173],[-67.27039,45.1934],[-67.22751,45.16344],[-67.20349,45.1722]]]]}},{type:"Feature",properties:{iso1A2:"CC",iso1A3:"CCK",iso1N3:"166",wikidata:"Q36004",nameEn:"Cocos (Keeling) Islands",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[96.61846,-10.82438],[96.02343,-12.68334],[97.93979,-12.33309],[96.61846,-10.82438]]]]}},{type:"Feature",properties:{iso1A2:"CD",iso1A3:"COD",iso1N3:"180",wikidata:"Q974",nameEn:"Democratic Republic of the Congo",aliases:["ZR"],groups:["017","202","002","UN"],callingCodes:["243"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.44012,5.07349],[27.09575,5.22305],[26.93064,5.13535],[26.85579,5.03887],[26.74572,5.10685],[26.48595,5.04984],[26.13371,5.25594],[25.86073,5.19455],[25.53271,5.37431],[25.34558,5.29101],[25.31256,5.03668],[24.71816,4.90509],[24.46719,5.0915],[23.38847,4.60013],[22.94817,4.82392],[22.89094,4.79321],[22.84691,4.69887],[22.78526,4.71423],[22.6928,4.47285],[22.60915,4.48821],[22.5431,4.22041],[22.45504,4.13039],[22.27682,4.11347],[22.10721,4.20723],[21.6405,4.317],[21.55904,4.25553],[21.25744,4.33676],[21.21341,4.29285],[21.11214,4.33895],[21.08793,4.39603],[20.90383,4.44877],[20.60184,4.42394],[18.62755,3.47564],[18.63857,3.19342],[18.10683,2.26876],[18.08034,1.58553],[17.85887,1.04327],[17.86989,.58873],[17.95255,.48128],[17.93877,.32424],[17.81204,.23884],[17.66051,-.26535],[17.72112,-.52707],[17.32438,-.99265],[16.97999,-1.12762],[16.70724,-1.45815],[16.50336,-1.8795],[16.16173,-2.16586],[16.22785,-2.59528],[16.1755,-3.25014],[16.21407,-3.2969],[15.89448,-3.9513],[15.53081,-4.042],[15.48121,-4.22062],[15.41785,-4.28381],[15.32693,-4.27282],[15.25411,-4.31121],[15.1978,-4.32388],[14.83101,-4.80838],[14.67948,-4.92093],[14.5059,-4.84956],[14.41499,-4.8825],[14.37366,-4.56125],[14.47284,-4.42941],[14.3957,-4.36623],[14.40672,-4.28381],[13.9108,-4.50906],[13.81162,-4.41842],[13.71794,-4.44864],[13.70417,-4.72601],[13.50305,-4.77818],[13.41764,-4.89897],[13.11182,-4.5942],[13.09648,-4.63739],[13.11195,-4.67745],[12.8733,-4.74346],[12.70868,-4.95505],[12.63465,-4.94632],[12.60251,-5.01715],[12.46297,-5.09408],[12.49815,-5.14058],[12.51589,-5.1332],[12.53586,-5.14658],[12.53599,-5.1618],[12.52301,-5.17481],[12.52318,-5.74353],[12.26557,-5.74031],[12.20376,-5.76338],[11.95767,-5.94705],[12.42245,-6.07585],[13.04371,-5.87078],[16.55507,-5.85631],[16.96282,-7.21787],[17.5828,-8.13784],[18.33635,-8.00126],[19.33698,-7.99743],[19.5469,-7.00195],[20.30218,-6.98955],[20.31846,-6.91953],[20.61689,-6.90876],[20.56263,-7.28566],[21.79824,-7.29628],[21.84856,-9.59871],[22.19039,-9.94628],[22.32604,-10.76291],[22.17954,-10.85884],[22.25951,-11.24911],[22.54205,-11.05784],[23.16602,-11.10577],[23.45631,-10.946],[23.86868,-11.02856],[24.00027,-10.89356],[24.34528,-11.06816],[24.42612,-11.44975],[25.34069,-11.19707],[25.33058,-11.65767],[26.01777,-11.91488],[26.88687,-12.01868],[27.04351,-11.61312],[27.22541,-11.60323],[27.21025,-11.76157],[27.59932,-12.22123],[28.33199,-12.41375],[29.01918,-13.41353],[29.60531,-13.21685],[29.65078,-13.41844],[29.81551,-13.44683],[29.8139,-12.14898],[29.48404,-12.23604],[29.4992,-12.43843],[29.18592,-12.37921],[28.48357,-11.87532],[28.37241,-11.57848],[28.65032,-10.65133],[28.62795,-9.92942],[28.68532,-9.78],[28.56208,-9.49122],[28.51627,-9.44726],[28.52636,-9.35379],[28.36562,-9.30091],[28.38526,-9.23393],[28.9711,-8.66935],[28.88917,-8.4831],[30.79243,-8.27382],[30.2567,-7.14121],[29.52552,-6.2731],[29.43673,-4.44845],[29.23708,-3.75856],[29.21463,-3.3514],[29.25633,-3.05471],[29.17258,-2.99385],[29.16037,-2.95457],[29.09797,-2.91935],[29.09119,-2.87871],[29.0505,-2.81774],[29.00404,-2.81978],[29.00167,-2.78523],[29.04081,-2.7416],[29.00357,-2.70596],[28.94346,-2.69124],[28.89793,-2.66111],[28.90226,-2.62385],[28.89288,-2.55848],[28.87943,-2.55165],[28.86193,-2.53185],[28.86209,-2.5231],[28.87497,-2.50887],[28.88846,-2.50493],[28.89342,-2.49017],[28.89132,-2.47557],[28.86846,-2.44866],[28.86826,-2.41888],[28.89601,-2.37321],[28.95642,-2.37321],[29.00051,-2.29001],[29.105,-2.27043],[29.17562,-2.12278],[29.11847,-1.90576],[29.24458,-1.69663],[29.24323,-1.66826],[29.36322,-1.50887],[29.45038,-1.5054],[29.53062,-1.40499],[29.59061,-1.39016],[29.58388,-.89821],[29.63006,-.8997],[29.62708,-.71055],[29.67176,-.55714],[29.67474,-.47969],[29.65091,-.46777],[29.72687,-.08051],[29.7224,.07291],[29.77454,.16675],[29.81922,.16824],[29.87284,.39166],[29.97413,.52124],[29.95477,.64486],[29.98307,.84295],[30.1484,.89805],[30.22139,.99635],[30.24671,1.14974],[30.48503,1.21675],[31.30127,2.11006],[31.28042,2.17853],[31.20148,2.2217],[31.1985,2.29462],[31.12104,2.27676],[31.07934,2.30207],[31.06593,2.35862],[30.96911,2.41071],[30.91102,2.33332],[30.83059,2.42559],[30.74271,2.43601],[30.75612,2.5863],[30.8857,2.83923],[30.8574,2.9508],[30.77101,3.04897],[30.84251,3.26908],[30.93486,3.40737],[30.94081,3.50847],[30.85153,3.48867],[30.85997,3.5743],[30.80713,3.60506],[30.78512,3.67097],[30.56277,3.62703],[30.57378,3.74567],[30.55396,3.84451],[30.47691,3.83353],[30.27658,3.95653],[30.22374,3.93896],[30.1621,4.10586],[30.06964,4.13221],[29.79666,4.37809],[29.82087,4.56246],[29.49726,4.7007],[29.43341,4.50101],[29.22207,4.34297],[29.03054,4.48784],[28.8126,4.48784],[28.6651,4.42638],[28.20719,4.35614],[27.79551,4.59976],[27.76469,4.79284],[27.65462,4.89375],[27.56656,4.89375],[27.44012,5.07349]]]]}},{type:"Feature",properties:{iso1A2:"CF",iso1A3:"CAF",iso1N3:"140",wikidata:"Q929",nameEn:"Central African Republic",groups:["017","202","002","UN"],callingCodes:["236"]},geometry:{type:"MultiPolygon",coordinates:[[[[22.87758,10.91915],[22.45889,11.00246],[21.72139,10.64136],[21.71479,10.29932],[21.63553,10.217],[21.52766,10.2105],[21.34934,9.95907],[21.26348,9.97642],[20.82979,9.44696],[20.36748,9.11019],[19.06421,9.00367],[18.86388,8.87971],[19.11044,8.68172],[18.79783,8.25929],[18.67455,8.22226],[18.62612,8.14163],[18.64153,8.08714],[18.6085,8.05009],[18.02731,8.01085],[17.93926,7.95853],[17.67288,7.98905],[16.8143,7.53971],[16.6668,7.67281],[16.658,7.75353],[16.59415,7.76444],[16.58315,7.88657],[16.41583,7.77971],[16.40703,7.68809],[15.79942,7.44149],[15.73118,7.52006],[15.49743,7.52179],[15.23397,7.25135],[15.04717,6.77085],[14.96311,6.75693],[14.79966,6.39043],[14.80122,6.34866],[14.74206,6.26356],[14.56149,6.18928],[14.43073,6.08867],[14.42917,6.00508],[14.49455,5.91683],[14.60974,5.91838],[14.62375,5.70466],[14.58951,5.59777],[14.62531,5.51411],[14.52724,5.28319],[14.57083,5.23979],[14.65489,5.21343],[14.73383,4.6135],[15.00825,4.41458],[15.08609,4.30282],[15.10644,4.1362],[15.17482,4.05131],[15.07686,4.01805],[15.73522,3.24348],[15.77725,3.26835],[16.05449,3.02306],[16.08252,2.45708],[16.19357,2.21537],[16.50126,2.84739],[16.46701,2.92512],[16.57598,3.47999],[16.68283,3.54257],[17.01746,3.55136],[17.35649,3.63045],[17.46876,3.70515],[17.60966,3.63705],[17.83421,3.61068],[17.85842,3.53378],[18.05656,3.56893],[18.14902,3.54476],[18.17323,3.47665],[18.24148,3.50302],[18.2723,3.57992],[18.39558,3.58212],[18.49245,3.63924],[18.58711,3.49423],[18.62755,3.47564],[20.60184,4.42394],[20.90383,4.44877],[21.08793,4.39603],[21.11214,4.33895],[21.21341,4.29285],[21.25744,4.33676],[21.55904,4.25553],[21.6405,4.317],[22.10721,4.20723],[22.27682,4.11347],[22.45504,4.13039],[22.5431,4.22041],[22.60915,4.48821],[22.6928,4.47285],[22.78526,4.71423],[22.84691,4.69887],[22.89094,4.79321],[22.94817,4.82392],[23.38847,4.60013],[24.46719,5.0915],[24.71816,4.90509],[25.31256,5.03668],[25.34558,5.29101],[25.53271,5.37431],[25.86073,5.19455],[26.13371,5.25594],[26.48595,5.04984],[26.74572,5.10685],[26.85579,5.03887],[26.93064,5.13535],[27.09575,5.22305],[27.44012,5.07349],[27.26886,5.25876],[27.23017,5.37167],[27.28621,5.56382],[27.22705,5.62889],[27.22705,5.71254],[26.51721,6.09655],[26.58259,6.1987],[26.32729,6.36272],[26.38022,6.63493],[25.90076,7.09549],[25.37461,7.33024],[25.35281,7.42595],[25.20337,7.50312],[25.20649,7.61115],[25.29214,7.66675],[25.25319,7.8487],[24.98855,7.96588],[24.85156,8.16933],[24.35965,8.26177],[24.13238,8.36959],[24.25691,8.69288],[23.51905,8.71749],[23.59065,8.99743],[23.44744,8.99128],[23.4848,9.16959],[23.56263,9.19418],[23.64358,9.28637],[23.64981,9.44303],[23.62179,9.53823],[23.69155,9.67566],[23.67164,9.86923],[23.3128,10.45214],[23.02221,10.69235],[22.87758,10.91915]]]]}},{type:"Feature",properties:{iso1A2:"CG",iso1A3:"COG",iso1N3:"178",wikidata:"Q971",nameEn:"Republic of the Congo",groups:["017","202","002","UN"],callingCodes:["242"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.62755,3.47564],[18.58711,3.49423],[18.49245,3.63924],[18.39558,3.58212],[18.2723,3.57992],[18.24148,3.50302],[18.17323,3.47665],[18.14902,3.54476],[18.05656,3.56893],[17.85842,3.53378],[17.83421,3.61068],[17.60966,3.63705],[17.46876,3.70515],[17.35649,3.63045],[17.01746,3.55136],[16.68283,3.54257],[16.57598,3.47999],[16.46701,2.92512],[16.50126,2.84739],[16.19357,2.21537],[16.15568,2.18955],[16.08563,2.19733],[16.05294,1.9811],[16.14634,1.70259],[16.02647,1.65591],[16.02959,1.76483],[15.48942,1.98265],[15.34776,1.91264],[15.22634,2.03243],[15.00996,1.98887],[14.61145,2.17866],[13.29457,2.16106],[13.13461,1.57238],[13.25447,1.32339],[13.15519,1.23368],[13.89582,1.4261],[14.25186,1.39842],[14.48179,.9152],[14.26066,.57255],[14.10909,.58563],[13.88648,.26652],[13.90632,-.2287],[14.06862,-.20826],[14.2165,-.38261],[14.41887,-.44799],[14.52569,-.57818],[14.41838,-1.89412],[14.25932,-1.97624],[14.23518,-2.15671],[14.16202,-2.23916],[14.23829,-2.33715],[14.10442,-2.49268],[13.85846,-2.46935],[13.92073,-2.35581],[13.75884,-2.09293],[13.47977,-2.43224],[13.02759,-2.33098],[12.82172,-1.91091],[12.61312,-1.8129],[12.44656,-1.92025],[12.47925,-2.32626],[12.04895,-2.41704],[11.96866,-2.33559],[11.74605,-2.39936],[11.57637,-2.33379],[11.64487,-2.61865],[11.5359,-2.85654],[11.64798,-2.81146],[11.80365,-3.00424],[11.70558,-3.0773],[11.70227,-3.17465],[11.96554,-3.30267],[11.8318,-3.5812],[11.92719,-3.62768],[11.87083,-3.71571],[11.68608,-3.68942],[11.57949,-3.52798],[11.48764,-3.51089],[11.22301,-3.69888],[11.12647,-3.94169],[10.75913,-4.39519],[11.50888,-5.33417],[12.00924,-5.02627],[12.16068,-4.90089],[12.20901,-4.75642],[12.25587,-4.79437],[12.32324,-4.78415],[12.40964,-4.60609],[12.64835,-4.55937],[12.76844,-4.38709],[12.87096,-4.40315],[12.91489,-4.47907],[13.09648,-4.63739],[13.11182,-4.5942],[13.41764,-4.89897],[13.50305,-4.77818],[13.70417,-4.72601],[13.71794,-4.44864],[13.81162,-4.41842],[13.9108,-4.50906],[14.40672,-4.28381],[14.3957,-4.36623],[14.47284,-4.42941],[14.37366,-4.56125],[14.41499,-4.8825],[14.5059,-4.84956],[14.67948,-4.92093],[14.83101,-4.80838],[15.1978,-4.32388],[15.25411,-4.31121],[15.32693,-4.27282],[15.41785,-4.28381],[15.48121,-4.22062],[15.53081,-4.042],[15.89448,-3.9513],[16.21407,-3.2969],[16.1755,-3.25014],[16.22785,-2.59528],[16.16173,-2.16586],[16.50336,-1.8795],[16.70724,-1.45815],[16.97999,-1.12762],[17.32438,-.99265],[17.72112,-.52707],[17.66051,-.26535],[17.81204,.23884],[17.93877,.32424],[17.95255,.48128],[17.86989,.58873],[17.85887,1.04327],[18.08034,1.58553],[18.10683,2.26876],[18.63857,3.19342],[18.62755,3.47564]]]]}},{type:"Feature",properties:{iso1A2:"CH",iso1A3:"CHE",iso1N3:"756",wikidata:"Q39",nameEn:"Switzerland",groups:["155","150","UN"],callingCodes:["41"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.72809,47.69282],[8.72617,47.69651],[8.73671,47.7169],[8.70543,47.73121],[8.74251,47.75168],[8.71778,47.76571],[8.68985,47.75686],[8.68022,47.78599],[8.65292,47.80066],[8.64425,47.76398],[8.62408,47.7626],[8.61657,47.79998],[8.56415,47.80633],[8.56814,47.78001],[8.48868,47.77215],[8.45771,47.7493],[8.44807,47.72426],[8.40569,47.69855],[8.4211,47.68407],[8.40473,47.67499],[8.41346,47.66676],[8.42264,47.66667],[8.44711,47.65379],[8.4667,47.65747],[8.46605,47.64103],[8.49656,47.64709],[8.5322,47.64687],[8.52801,47.66059],[8.56141,47.67088],[8.57683,47.66158],[8.6052,47.67258],[8.61113,47.66332],[8.62884,47.65098],[8.62049,47.63757],[8.60412,47.63735],[8.61471,47.64514],[8.60701,47.65271],[8.59545,47.64298],[8.60348,47.61204],[8.57586,47.59537],[8.55756,47.62394],[8.51686,47.63476],[8.50747,47.61897],[8.45578,47.60121],[8.46637,47.58389],[8.48949,47.588],[8.49431,47.58107],[8.43235,47.56617],[8.39477,47.57826],[8.38273,47.56608],[8.35512,47.57014],[8.32735,47.57133],[8.30277,47.58607],[8.29524,47.5919],[8.29722,47.60603],[8.2824,47.61225],[8.26313,47.6103],[8.25863,47.61571],[8.23809,47.61204],[8.22577,47.60385],[8.22011,47.6181],[8.20617,47.62141],[8.19378,47.61636],[8.1652,47.5945],[8.14947,47.59558],[8.13823,47.59147],[8.13662,47.58432],[8.11543,47.5841],[8.10395,47.57918],[8.10002,47.56504],[8.08557,47.55768],[8.06663,47.56374],[8.04383,47.55443],[8.02136,47.55096],[8.00113,47.55616],[7.97581,47.55493],[7.95682,47.55789],[7.94494,47.54511],[7.91251,47.55031],[7.90673,47.57674],[7.88664,47.58854],[7.84412,47.5841],[7.81901,47.58798],[7.79486,47.55691],[7.75261,47.54599],[7.71961,47.54219],[7.69642,47.53297],[7.68101,47.53232],[7.6656,47.53752],[7.66174,47.54554],[7.65083,47.54662],[7.63338,47.56256],[7.67655,47.56435],[7.68904,47.57133],[7.67115,47.5871],[7.68486,47.59601],[7.69385,47.60099],[7.68229,47.59905],[7.67395,47.59212],[7.64599,47.59695],[7.64213,47.5944],[7.64309,47.59151],[7.61929,47.57683],[7.60459,47.57869],[7.60523,47.58519],[7.58945,47.59017],[7.58386,47.57536],[7.56684,47.57785],[7.56548,47.57617],[7.55689,47.57232],[7.55652,47.56779],[7.53634,47.55553],[7.52831,47.55347],[7.51723,47.54578],[7.50873,47.54546],[7.49691,47.53821],[7.50588,47.52856],[7.51904,47.53515],[7.53199,47.5284],[7.5229,47.51644],[7.49804,47.51798],[7.51076,47.49651],[7.47534,47.47932],[7.43356,47.49712],[7.42923,47.48628],[7.4583,47.47216],[7.4462,47.46264],[7.43088,47.45846],[7.40308,47.43638],[7.35603,47.43432],[7.33526,47.44186],[7.24669,47.4205],[7.17026,47.44312],[7.19583,47.49455],[7.16249,47.49025],[7.12781,47.50371],[7.07425,47.48863],[7.0231,47.50522],[6.98425,47.49432],[7.0024,47.45264],[6.93953,47.43388],[6.93744,47.40714],[6.88542,47.37262],[6.87959,47.35335],[7.03125,47.36996],[7.0564,47.35134],[7.05305,47.33304],[6.94316,47.28747],[6.95108,47.26428],[6.9508,47.24338],[6.8489,47.15933],[6.76788,47.1208],[6.68823,47.06616],[6.71531,47.0494],[6.43341,46.92703],[6.46456,46.88865],[6.43216,46.80336],[6.45209,46.77502],[6.38351,46.73171],[6.27135,46.68251],[6.11084,46.57649],[6.1567,46.54402],[6.07269,46.46244],[6.08427,46.44305],[6.06407,46.41676],[6.09926,46.40768],[6.15016,46.3778],[6.15985,46.37721],[6.16987,46.36759],[6.15738,46.3491],[6.13876,46.33844],[6.1198,46.31157],[6.11697,46.29547],[6.1013,46.28512],[6.11926,46.2634],[6.12446,46.25059],[6.10071,46.23772],[6.08563,46.24651],[6.07072,46.24085],[6.0633,46.24583],[6.05029,46.23518],[6.04602,46.23127],[6.03342,46.2383],[6.02461,46.23313],[5.97542,46.21525],[5.96515,46.19638],[5.99573,46.18587],[5.98846,46.17046],[5.98188,46.17392],[5.97508,46.15863],[5.9641,46.14412],[5.95781,46.12925],[5.97893,46.13303],[5.9871,46.14499],[6.01791,46.14228],[6.03614,46.13712],[6.04564,46.14031],[6.05203,46.15191],[6.07491,46.14879],[6.09199,46.15191],[6.09926,46.14373],[6.13397,46.1406],[6.15305,46.15194],[6.18116,46.16187],[6.18871,46.16644],[6.18707,46.17999],[6.19552,46.18401],[6.19807,46.18369],[6.20539,46.19163],[6.21114,46.1927],[6.21273,46.19409],[6.21603,46.19507],[6.21844,46.19837],[6.22222,46.19888],[6.22175,46.20045],[6.23544,46.20714],[6.23913,46.20511],[6.24821,46.20531],[6.26007,46.21165],[6.27694,46.21566],[6.29663,46.22688],[6.31041,46.24417],[6.29474,46.26221],[6.26749,46.24745],[6.24952,46.26255],[6.23775,46.27822],[6.25137,46.29014],[6.24826,46.30175],[6.21981,46.31304],[6.25432,46.3632],[6.53358,46.45431],[6.82312,46.42661],[6.8024,46.39171],[6.77152,46.34784],[6.86052,46.28512],[6.78968,46.14058],[6.89321,46.12548],[6.87868,46.03855],[6.93862,46.06502],[7.00946,45.9944],[7.04151,45.92435],[7.10685,45.85653],[7.56343,45.97421],[7.85949,45.91485],[7.9049,45.99945],[7.98881,45.99867],[8.02906,46.10331],[8.11383,46.11577],[8.16866,46.17817],[8.08814,46.26692],[8.31162,46.38044],[8.30648,46.41587],[8.42464,46.46367],[8.46317,46.43712],[8.45032,46.26869],[8.62242,46.12112],[8.75697,46.10395],[8.80778,46.10085],[8.85617,46.0748],[8.79414,46.00913],[8.78585,45.98973],[8.79362,45.99207],[8.8319,45.9879],[8.85121,45.97239],[8.86688,45.96135],[8.88904,45.95465],[8.93649,45.86775],[8.94372,45.86587],[8.93504,45.86245],[8.91129,45.8388],[8.94737,45.84285],[8.9621,45.83707],[8.99663,45.83466],[9.00324,45.82055],[9.0298,45.82127],[9.03279,45.82865],[9.03793,45.83548],[9.03505,45.83976],[9.04059,45.8464],[9.04546,45.84968],[9.06642,45.8761],[9.09065,45.89906],[8.99257,45.9698],[9.01618,46.04928],[9.24503,46.23616],[9.29226,46.32717],[9.25502,46.43743],[9.28136,46.49685],[9.36128,46.5081],[9.40487,46.46621],[9.45936,46.50873],[9.46117,46.37481],[9.57015,46.2958],[9.71273,46.29266],[9.73086,46.35071],[9.95249,46.38045],[10.07055,46.21668],[10.14439,46.22992],[10.17862,46.25626],[10.10506,46.3372],[10.165,46.41051],[10.03715,46.44479],[10.10307,46.61003],[10.23674,46.63484],[10.25309,46.57432],[10.46136,46.53164],[10.49375,46.62049],[10.44686,46.64162],[10.40475,46.63671],[10.38659,46.67847],[10.47197,46.85698],[10.48376,46.93891],[10.36933,47.00212],[10.30031,46.92093],[10.24128,46.93147],[10.22675,46.86942],[10.10715,46.84296],[9.98058,46.91434],[9.88266,46.93343],[9.87935,47.01337],[9.60717,47.06091],[9.55721,47.04762],[9.54041,47.06495],[9.47548,47.05257],[9.47139,47.06402],[9.51362,47.08505],[9.52089,47.10019],[9.51044,47.13727],[9.48774,47.17402],[9.4891,47.19346],[9.50318,47.22153],[9.52406,47.24959],[9.53116,47.27029],[9.54773,47.2809],[9.55857,47.29919],[9.58513,47.31334],[9.59978,47.34671],[9.62476,47.36639],[9.65427,47.36824],[9.66243,47.37136],[9.6711,47.37824],[9.67445,47.38429],[9.67334,47.39191],[9.6629,47.39591],[9.65136,47.40504],[9.65043,47.41937],[9.6446,47.43233],[9.64483,47.43842],[9.65863,47.44847],[9.65728,47.45383],[9.6423,47.45599],[9.62475,47.45685],[9.62158,47.45858],[9.60841,47.47178],[9.60484,47.46358],[9.60205,47.46165],[9.59482,47.46305],[9.58208,47.48344],[9.56312,47.49495],[9.55125,47.53629],[9.25619,47.65939],[9.18203,47.65598],[9.17593,47.65399],[9.1755,47.65584],[9.1705,47.65513],[9.15181,47.66904],[9.13845,47.66389],[9.09891,47.67801],[9.02093,47.6868],[8.94093,47.65596],[8.89946,47.64769],[8.87625,47.65441],[8.87383,47.67045],[8.85065,47.68209],[8.86989,47.70504],[8.82002,47.71458],[8.80663,47.73821],[8.77309,47.72059],[8.76965,47.7075],[8.79966,47.70222],[8.79511,47.67462],[8.75856,47.68969],[8.72809,47.69282]],[[8.95861,45.96485],[8.96668,45.98436],[8.97741,45.98317],[8.97604,45.96151],[8.95861,45.96485]],[[8.70847,47.68904],[8.68985,47.69552],[8.66837,47.68437],[8.65769,47.68928],[8.67508,47.6979],[8.66416,47.71367],[8.70237,47.71453],[8.71773,47.69088],[8.70847,47.68904]]]]}},{type:"Feature",properties:{iso1A2:"CI",iso1A3:"CIV",iso1N3:"384",wikidata:"Q1008",nameEn:"C\xF4te d'Ivoire",groups:["011","202","002","UN"],callingCodes:["225"]},geometry:{type:"MultiPolygon",coordinates:[[[[-7.52774,3.7105],[-3.34019,4.17519],[-3.10675,5.08515],[-3.11073,5.12675],[-3.063,5.13665],[-2.96554,5.10397],[-2.95261,5.12477],[-2.75502,5.10657],[-2.73074,5.1364],[-2.77625,5.34621],[-2.72737,5.34789],[-2.76614,5.60963],[-2.85378,5.65156],[-2.93132,5.62137],[-2.96671,5.6415],[-2.95323,5.71865],[-3.01896,5.71697],[-3.25999,6.62521],[-3.21954,6.74407],[-3.23327,6.81744],[-2.95438,7.23737],[-2.97822,7.27165],[-2.92339,7.60847],[-2.79467,7.86002],[-2.78395,7.94974],[-2.74819,7.92613],[-2.67787,8.02055],[-2.61232,8.02645],[-2.62901,8.11495],[-2.49037,8.20872],[-2.58243,8.7789],[-2.66357,9.01771],[-2.77799,9.04949],[-2.69814,9.22717],[-2.68802,9.49343],[-2.76494,9.40778],[-2.93012,9.57403],[-3.00765,9.74019],[-3.16609,9.85147],[-3.19306,9.93781],[-3.27228,9.84981],[-3.31779,9.91125],[-3.69703,9.94279],[-4.25999,9.76012],[-4.31392,9.60062],[-4.6426,9.70696],[-4.96621,9.89132],[-4.96453,9.99923],[-5.12465,10.29788],[-5.39602,10.2929],[-5.51058,10.43177],[-5.65135,10.46767],[-5.78124,10.43952],[-5.99478,10.19694],[-6.18851,10.24244],[-6.1731,10.46983],[-6.24795,10.74248],[-6.325,10.68624],[-6.40646,10.69922],[-6.42847,10.5694],[-6.52974,10.59104],[-6.63541,10.66893],[-6.68164,10.35074],[-6.93921,10.35291],[-7.01186,10.25111],[-6.97444,10.21644],[-7.00966,10.15794],[-7.0603,10.14711],[-7.13331,10.24877],[-7.3707,10.24677],[-7.44555,10.44602],[-7.52261,10.4655],[-7.54462,10.40921],[-7.63048,10.46334],[-7.92107,10.15577],[-7.97971,10.17117],[-8.01225,10.1021],[-8.11921,10.04577],[-8.15652,9.94288],[-8.09434,9.86936],[-8.14657,9.55062],[-8.03463,9.39604],[-7.85056,9.41812],[-7.90777,9.20456],[-7.73862,9.08422],[-7.92518,8.99332],[-7.95503,8.81146],[-7.69882,8.66148],[-7.65653,8.36873],[-7.92518,8.50652],[-8.22991,8.48438],[-8.2411,8.24196],[-8.062,8.16071],[-7.98675,8.20134],[-7.99919,8.11023],[-7.94695,8.00925],[-8.06449,8.04989],[-8.13414,7.87991],[-8.09931,7.78626],[-8.21374,7.54466],[-8.4003,7.6285],[-8.47114,7.55676],[-8.41935,7.51203],[-8.37458,7.25794],[-8.29249,7.1691],[-8.31736,6.82837],[-8.59456,6.50612],[-8.48652,6.43797],[-8.45666,6.49977],[-8.38453,6.35887],[-8.3298,6.36381],[-8.17557,6.28222],[-8.00642,6.31684],[-7.90692,6.27728],[-7.83478,6.20309],[-7.8497,6.08932],[-7.79747,6.07696],[-7.78254,5.99037],[-7.70294,5.90625],[-7.67309,5.94337],[-7.48155,5.80974],[-7.46165,5.84934],[-7.43677,5.84687],[-7.43926,5.74787],[-7.37209,5.61173],[-7.43428,5.42355],[-7.36463,5.32944],[-7.46165,5.26256],[-7.48901,5.14118],[-7.55369,5.08667],[-7.53876,4.94294],[-7.59349,4.8909],[-7.53259,4.35145],[-7.52774,3.7105]]]]}},{type:"Feature",properties:{iso1A2:"CK",iso1A3:"COK",iso1N3:"184",wikidata:"Q26988",nameEn:"Cook Islands",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["682"]},geometry:{type:"MultiPolygon",coordinates:[[[[-168.15106,-10.26955],[-156.45576,-31.75456],[-156.48634,-15.52824],[-156.50903,-7.4975],[-168.15106,-10.26955]]]]}},{type:"Feature",properties:{iso1A2:"CL",iso1A3:"CHL",iso1N3:"152",wikidata:"Q298",nameEn:"Chile",groups:["005","419","019","UN"],callingCodes:["56"]},geometry:{type:"MultiPolygon",coordinates:[[[[-68.60702,-52.65781],[-68.41683,-52.33516],[-69.97824,-52.00845],[-71.99889,-51.98018],[-72.33873,-51.59954],[-72.31343,-50.58411],[-73.15765,-50.78337],[-73.55259,-49.92488],[-73.45156,-49.79461],[-73.09655,-49.14342],[-72.56894,-48.81116],[-72.54042,-48.52392],[-72.27662,-48.28727],[-72.50478,-47.80586],[-71.94152,-47.13595],[-71.68577,-46.55385],[-71.75614,-45.61611],[-71.35687,-45.22075],[-72.06985,-44.81756],[-71.26418,-44.75684],[-71.16436,-44.46244],[-71.81318,-44.38097],[-71.64206,-43.64774],[-72.14828,-42.85321],[-72.15541,-42.15941],[-71.74901,-42.11711],[-71.92726,-40.72714],[-71.37826,-38.91474],[-70.89532,-38.6923],[-71.24279,-37.20264],[-70.95047,-36.4321],[-70.38008,-36.02375],[-70.49416,-35.24145],[-69.87386,-34.13344],[-69.88099,-33.34489],[-70.55832,-31.51559],[-70.14479,-30.36595],[-69.8596,-30.26131],[-69.99507,-29.28351],[-69.80969,-29.07185],[-69.66709,-28.44055],[-69.22504,-27.95042],[-68.77586,-27.16029],[-68.43363,-27.08414],[-68.27677,-26.90626],[-68.59048,-26.49861],[-68.56909,-26.28146],[-68.38372,-26.15353],[-68.57622,-25.32505],[-68.38372,-25.08636],[-68.56909,-24.69831],[-68.24825,-24.42596],[-67.33563,-24.04237],[-66.99632,-22.99839],[-67.18382,-22.81525],[-67.54284,-22.89771],[-67.85114,-22.87076],[-68.18816,-21.28614],[-68.40403,-20.94562],[-68.53957,-20.91542],[-68.55383,-20.7355],[-68.44023,-20.62701],[-68.7276,-20.46178],[-68.74273,-20.08817],[-68.57132,-20.03134],[-68.54611,-19.84651],[-68.66761,-19.72118],[-68.41218,-19.40499],[-68.61989,-19.27584],[-68.80602,-19.08355],[-68.87082,-19.06003],[-68.94987,-18.93302],[-69.07432,-18.28259],[-69.14807,-18.16893],[-69.07496,-18.03715],[-69.28671,-17.94844],[-69.34126,-17.72753],[-69.46623,-17.60518],[-69.46897,-17.4988],[-69.66483,-17.65083],[-69.79087,-17.65563],[-69.82868,-17.72048],[-69.75305,-17.94605],[-69.81607,-18.12582],[-69.96732,-18.25992],[-70.16394,-18.31737],[-70.31267,-18.31258],[-70.378,-18.3495],[-70.59118,-18.35072],[-113.52687,-26.52828],[-68.11646,-58.14883],[-66.07313,-55.19618],[-67.11046,-54.94199],[-67.46182,-54.92205],[-68.01394,-54.8753],[-68.60733,-54.9125],[-68.60702,-52.65781]]]]}},{type:"Feature",properties:{iso1A2:"CM",iso1A3:"CMR",iso1N3:"120",wikidata:"Q1009",nameEn:"Cameroon",groups:["017","202","002","UN"],callingCodes:["237"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.83314,12.62963],[14.55058,12.78256],[14.56101,12.91036],[14.46881,13.08259],[14.08251,13.0797],[14.20204,12.53405],[14.17523,12.41916],[14.22215,12.36533],[14.4843,12.35223],[14.6474,12.17466],[14.61612,11.7798],[14.55207,11.72001],[14.64591,11.66166],[14.6124,11.51283],[14.17821,11.23831],[13.97489,11.30258],[13.78945,11.00154],[13.7403,11.00593],[13.70753,10.94451],[13.73434,10.9255],[13.54964,10.61236],[13.5705,10.53183],[13.43644,10.13326],[13.34111,10.12299],[13.25025,10.03647],[13.25323,10.00127],[13.286,9.9822],[13.27409,9.93232],[13.24132,9.91031],[13.25025,9.86042],[13.29941,9.8296],[13.25472,9.76795],[13.22642,9.57266],[13.02385,9.49334],[12.85628,9.36698],[12.91958,9.33905],[12.90022,9.11411],[12.81085,8.91992],[12.79,8.75361],[12.71701,8.7595],[12.68722,8.65938],[12.44146,8.6152],[12.4489,8.52536],[12.26123,8.43696],[12.24782,8.17904],[12.19271,8.10826],[12.20909,7.97553],[11.99908,7.67302],[12.01844,7.52981],[11.93205,7.47812],[11.84864,7.26098],[11.87396,7.09398],[11.63117,6.9905],[11.55818,6.86186],[11.57755,6.74059],[11.51499,6.60892],[11.42264,6.5882],[11.42041,6.53789],[11.09495,6.51717],[11.09644,6.68437],[10.94302,6.69325],[10.8179,6.83377],[10.83727,6.9358],[10.60789,7.06885],[10.59746,7.14719],[10.57214,7.16345],[10.53639,6.93432],[10.21466,6.88996],[10.15135,7.03781],[9.86314,6.77756],[9.77824,6.79088],[9.70674,6.51717],[9.51757,6.43874],[8.84209,5.82562],[8.88156,5.78857],[8.83687,5.68483],[8.92029,5.58403],[8.78027,5.1243],[8.60302,4.87353],[8.34397,4.30689],[9.22018,3.72052],[9.81162,2.33797],[9.82123,2.35097],[9.83754,2.32428],[9.83238,2.29079],[9.84716,2.24676],[9.89012,2.20457],[9.90749,2.20049],[9.991,2.16561],[11.3561,2.17217],[11.37116,2.29975],[13.28534,2.25716],[13.29457,2.16106],[14.61145,2.17866],[15.00996,1.98887],[15.22634,2.03243],[15.34776,1.91264],[15.48942,1.98265],[16.02959,1.76483],[16.02647,1.65591],[16.14634,1.70259],[16.05294,1.9811],[16.08563,2.19733],[16.15568,2.18955],[16.19357,2.21537],[16.08252,2.45708],[16.05449,3.02306],[15.77725,3.26835],[15.73522,3.24348],[15.07686,4.01805],[15.17482,4.05131],[15.10644,4.1362],[15.08609,4.30282],[15.00825,4.41458],[14.73383,4.6135],[14.65489,5.21343],[14.57083,5.23979],[14.52724,5.28319],[14.62531,5.51411],[14.58951,5.59777],[14.62375,5.70466],[14.60974,5.91838],[14.49455,5.91683],[14.42917,6.00508],[14.43073,6.08867],[14.56149,6.18928],[14.74206,6.26356],[14.80122,6.34866],[14.79966,6.39043],[14.96311,6.75693],[15.04717,6.77085],[15.23397,7.25135],[15.49743,7.52179],[15.56964,7.58936],[15.59272,7.7696],[15.50743,7.79302],[15.20426,8.50892],[15.09484,8.65982],[14.83566,8.80557],[14.35707,9.19611],[14.37094,9.2954],[13.97544,9.6365],[14.01793,9.73169],[14.1317,9.82413],[14.20411,10.00055],[14.4673,10.00264],[14.80082,9.93818],[14.95722,9.97926],[15.05999,9.94845],[15.14043,9.99246],[15.24618,9.99246],[15.41408,9.92876],[15.68761,9.99344],[15.50535,10.1098],[15.30874,10.31063],[15.23724,10.47764],[15.14936,10.53915],[15.15532,10.62846],[15.06737,10.80921],[15.09127,10.87431],[15.04957,11.02347],[15.10021,11.04101],[15.0585,11.40481],[15.13149,11.5537],[15.06595,11.71126],[15.11579,11.79313],[15.04808,11.8731],[15.05786,12.0608],[15.0349,12.10698],[15.00146,12.1223],[14.96952,12.0925],[14.89019,12.16593],[14.90827,12.3269],[14.83314,12.62963]]]]}},{type:"Feature",properties:{iso1A2:"CN",iso1A3:"CHN",iso1N3:"156",wikidata:"Q148",nameEn:"People's Republic of China"},geometry:null},{type:"Feature",properties:{iso1A2:"CO",iso1A3:"COL",iso1N3:"170",wikidata:"Q739",nameEn:"Colombia",groups:["005","419","019","UN"],callingCodes:["57"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.19849,12.65801],[-81.58685,18.0025],[-82.06974,14.49418],[-82.56142,11.91792],[-78.79327,9.93766],[-77.58292,9.22278],[-77.32389,8.81247],[-77.45064,8.49991],[-77.17257,7.97422],[-77.57185,7.51147],[-77.72514,7.72348],[-77.72157,7.47612],[-77.81426,7.48319],[-77.89178,7.22681],[-78.06168,7.07793],[-82.12561,4.00341],[-78.87137,1.47457],[-78.42749,1.15389],[-77.85677,.80197],[-77.7148,.85003],[-77.68613,.83029],[-77.66416,.81604],[-77.67815,.73863],[-77.49984,.64476],[-77.52001,.40782],[-76.89177,.24736],[-76.4094,.24015],[-76.41215,.38228],[-76.23441,.42294],[-75.82927,.09578],[-75.25764,-.11943],[-75.18513,-.0308],[-74.42701,-.50218],[-74.26675,-.97229],[-73.65312,-1.26222],[-72.92587,-2.44514],[-71.75223,-2.15058],[-70.94377,-2.23142],[-70.04609,-2.73906],[-70.71396,-3.7921],[-70.52393,-3.87553],[-70.3374,-3.79505],[-69.94708,-4.2431],[-69.43395,-1.42219],[-69.4215,-1.01853],[-69.59796,-.75136],[-69.603,-.51947],[-70.03658,-.19681],[-70.04162,.55437],[-69.47696,.71065],[-69.20976,.57958],[-69.14422,.84172],[-69.26017,1.06856],[-69.82987,1.07864],[-69.83491,1.69353],[-69.53746,1.76408],[-69.38621,1.70865],[-68.18128,1.72881],[-68.26699,1.83463],[-68.18632,2.00091],[-67.9292,1.82455],[-67.40488,2.22258],[-67.299,1.87494],[-67.15784,1.80439],[-67.08222,1.17441],[-66.85795,1.22998],[-67.21967,2.35778],[-67.65696,2.81691],[-67.85862,2.79173],[-67.85862,2.86727],[-67.30945,3.38393],[-67.50067,3.75812],[-67.62671,3.74303],[-67.85358,4.53249],[-67.83341,5.31104],[-67.59141,5.5369],[-67.63914,5.64963],[-67.58558,5.84537],[-67.43513,5.98835],[-67.4625,6.20625],[-67.60654,6.2891],[-69.41843,6.1072],[-70.10716,6.96516],[-70.7596,7.09799],[-71.03941,6.98163],[-71.37234,7.01588],[-71.42212,7.03854],[-71.44118,7.02116],[-71.82441,7.04314],[-72.04895,7.03837],[-72.19437,7.37034],[-72.43132,7.40034],[-72.47415,7.48928],[-72.45321,7.57232],[-72.47827,7.65604],[-72.46763,7.79518],[-72.44454,7.86031],[-72.46183,7.90682],[-72.45806,7.91141],[-72.47042,7.92306],[-72.48183,7.92909],[-72.48801,7.94329],[-72.47213,7.96106],[-72.39137,8.03534],[-72.35163,8.01163],[-72.36987,8.19976],[-72.4042,8.36513],[-72.65474,8.61428],[-72.77415,9.10165],[-72.94052,9.10663],[-73.02119,9.27584],[-73.36905,9.16636],[-72.98085,9.85253],[-72.88002,10.44309],[-72.4767,11.1117],[-72.24983,11.14138],[-71.9675,11.65536],[-71.3275,11.85],[-70.92579,11.96275],[-71.19849,12.65801]]]]}},{type:"Feature",properties:{iso1A2:"CP",iso1A3:"CPT",wikidata:"Q161258",nameEn:"Clipperton Island",country:"FR",groups:["EU","013","003","019","UN"],isoStatus:"excRes"},geometry:{type:"MultiPolygon",coordinates:[[[[-110.36279,9.79626],[-108.755,9.84085],[-109.04145,11.13245],[-110.36279,9.79626]]]]}},{type:"Feature",properties:{iso1A2:"CQ",iso1A3:"CRQ",iso1N3:"680",m49:"680",wikidata:"Q3405693",ccTLD:null,nameEn:"Sark",country:"GB",groups:["GG","830","Q185086","154","150","UN"],level:"subterritory",isoStatus:"excRes",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01481"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.36485,49.48223],[-2.65349,49.15373],[-2.09454,49.46288],[-2.36485,49.48223]]]]}},{type:"Feature",properties:{iso1A2:"CR",iso1A3:"CRI",iso1N3:"188",wikidata:"Q800",nameEn:"Costa Rica",groups:["013","003","419","019","UN"],callingCodes:["506"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.68276,11.01562],[-83.66597,10.79916],[-83.90838,10.71161],[-84.68197,11.07568],[-84.92439,10.9497],[-85.60529,11.22607],[-85.71223,11.06868],[-86.14524,11.09059],[-87.41779,5.02401],[-82.94503,7.93865],[-82.89978,8.04083],[-82.89137,8.05755],[-82.88641,8.10219],[-82.9388,8.26634],[-83.05209,8.33394],[-82.93056,8.43465],[-82.8679,8.44042],[-82.8382,8.48117],[-82.83322,8.52464],[-82.83975,8.54755],[-82.82739,8.60153],[-82.8794,8.6981],[-82.92068,8.74832],[-82.91377,8.774],[-82.88253,8.83331],[-82.72126,8.97125],[-82.93516,9.07687],[-82.93516,9.46741],[-82.84871,9.4973],[-82.87919,9.62645],[-82.77206,9.59573],[-82.66667,9.49746],[-82.61345,9.49881],[-82.56507,9.57279],[-82.51044,9.65379],[-83.54024,10.96805],[-83.68276,11.01562]]]]}},{type:"Feature",properties:{iso1A2:"CU",iso1A3:"CUB",iso1N3:"192",wikidata:"Q241",nameEn:"Cuba",groups:["029","003","419","019","UN"],callingCodes:["53"]},geometry:{type:"MultiPolygon",coordinates:[[[[-73.62304,20.6935],[-82.02215,24.23074],[-85.77883,21.92705],[-74.81171,18.82201],[-73.62304,20.6935]]]]}},{type:"Feature",properties:{iso1A2:"CV",iso1A3:"CPV",iso1N3:"132",wikidata:"Q1011",nameEn:"Cape Verde",groups:["Q105472","011","202","002","UN"],callingCodes:["238"]},geometry:{type:"MultiPolygon",coordinates:[[[[-28.81604,14.57305],[-20.39702,14.12816],[-23.37101,19.134],[-28.81604,14.57305]]]]}},{type:"Feature",properties:{iso1A2:"CW",iso1A3:"CUW",iso1N3:"531",wikidata:"Q25279",nameEn:"Cura\xE7ao",aliases:["NL-CW"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["599"]},geometry:{type:"MultiPolygon",coordinates:[[[[-68.90012,12.62309],[-69.59009,12.46019],[-68.99639,11.79035],[-68.33524,11.78151],[-68.90012,12.62309]]]]}},{type:"Feature",properties:{iso1A2:"CX",iso1A3:"CXR",iso1N3:"162",wikidata:"Q31063",nameEn:"Christmas Island",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["61"]},geometry:{type:"MultiPolygon",coordinates:[[[[105.66835,-9.31927],[104.67494,-11.2566],[106.66176,-11.14349],[105.66835,-9.31927]]]]}},{type:"Feature",properties:{iso1A2:"CY",iso1A3:"CYP",iso1N3:"196",wikidata:"Q229",nameEn:"Republic of Cyprus",groups:["Q644636","EU","145","142","UN"],driveSide:"left",callingCodes:["357"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.60361,35.16647],[32.46489,35.48584],[30.15137,34.08517],[32.74412,34.43926],[32.75515,34.64985],[32.76136,34.68318],[32.79433,34.67883],[32.82717,34.70622],[32.86014,34.70585],[32.86167,34.68734],[32.9068,34.66102],[32.91398,34.67343],[32.93043,34.67091],[32.92824,34.66821],[32.93535,34.66317],[32.93756,34.67072],[32.93989,34.67034],[32.94127,34.67426],[32.95567,34.6839],[32.98967,34.67981],[32.98668,34.67268],[32.99014,34.65518],[32.98046,34.65336],[32.969,34.6549],[32.9639,34.65866],[32.96154,34.65587],[32.95277,34.65104],[32.95471,34.64528],[32.95323,34.64075],[32.95516,34.63541],[32.96312,34.63236],[32.96718,34.63446],[32.96968,34.64046],[33.0138,34.64424],[33.26744,34.49942],[33.83531,34.73974],[33.70575,34.97947],[33.70639,34.99303],[33.71514,35.00294],[33.69731,35.01754],[33.69938,35.03123],[33.67678,35.03866],[33.63765,35.03869],[33.61215,35.0527],[33.59658,35.03635],[33.567,35.04803],[33.57478,35.06049],[33.53975,35.08151],[33.48915,35.06594],[33.47666,35.00701],[33.45256,35.00288],[33.45178,35.02078],[33.47825,35.04103],[33.48136,35.0636],[33.46813,35.10564],[33.41675,35.16325],[33.4076,35.20062],[33.38575,35.2018],[33.37248,35.18698],[33.3717,35.1788],[33.36569,35.17479],[33.35612,35.17402],[33.35596,35.17942],[33.34964,35.17803],[33.35056,35.18328],[33.31955,35.18096],[33.3072,35.16816],[33.27068,35.16815],[33.15138,35.19504],[33.11105,35.15639],[33.08249,35.17319],[33.01192,35.15639],[32.94471,35.09422],[32.86406,35.1043],[32.85733,35.07742],[32.70779,35.14127],[32.70947,35.18328],[32.64864,35.19967],[32.60361,35.16647]]],[[[33.7343,35.01178],[33.74144,35.01053],[33.7492,35.01319],[33.74983,35.02274],[33.74265,35.02329],[33.73781,35.02181],[33.7343,35.01178]]],[[[33.77553,34.99518],[33.77312,34.9976],[33.75994,35.00113],[33.75682,34.99916],[33.76605,34.99543],[33.76738,34.99188],[33.7778,34.98981],[33.77843,34.988],[33.78149,34.98854],[33.78318,34.98699],[33.78571,34.98951],[33.78917,34.98854],[33.79191,34.98914],[33.78516,34.99582],[33.77553,34.99518]]],[[[33.82051,35.0667],[33.8012,35.04786],[33.81524,35.04192],[33.83055,35.02865],[33.82875,35.01685],[33.84045,35.00616],[33.85216,35.00579],[33.85891,35.001],[33.85488,34.98462],[33.84616,34.98511],[33.83459,34.97448],[33.84028,34.97179],[33.84741,34.97167],[33.86018,34.97381],[33.90146,34.96458],[33.98684,34.76642],[35.48515,34.70851],[35.51152,36.10954],[34.23164,35.1777],[33.99999,35.07016],[33.94869,35.07277],[33.92495,35.06789],[33.90247,35.07686],[33.89322,35.06789],[33.87438,35.08118],[33.85261,35.0574],[33.8355,35.05777],[33.82051,35.0667]]]]}},{type:"Feature",properties:{iso1A2:"CZ",iso1A3:"CZE",iso1N3:"203",wikidata:"Q213",nameEn:"Czechia",groups:["EU","151","150","UN"],callingCodes:["420"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.82803,50.86966],[14.79139,50.81438],[14.70661,50.84096],[14.61993,50.86049],[14.63434,50.8883],[14.65259,50.90513],[14.64802,50.93241],[14.58024,50.91443],[14.56374,50.922],[14.59702,50.96148],[14.59908,50.98685],[14.58215,50.99306],[14.56432,51.01008],[14.53438,51.00374],[14.53321,51.01679],[14.49873,51.02242],[14.50809,51.0427],[14.49991,51.04692],[14.49154,51.04382],[14.49202,51.02286],[14.45827,51.03712],[14.41335,51.02086],[14.30098,51.05515],[14.25665,50.98935],[14.28776,50.97718],[14.32353,50.98556],[14.32793,50.97379],[14.30251,50.96606],[14.31422,50.95243],[14.39848,50.93866],[14.38691,50.89907],[14.30098,50.88448],[14.27123,50.89386],[14.24314,50.88761],[14.22331,50.86049],[14.02982,50.80662],[13.98864,50.8177],[13.89113,50.78533],[13.89444,50.74142],[13.82942,50.7251],[13.76316,50.73487],[13.70204,50.71771],[13.65977,50.73096],[13.52474,50.70394],[13.53748,50.67654],[13.5226,50.64721],[13.49742,50.63133],[13.46413,50.60102],[13.42189,50.61243],[13.37485,50.64931],[13.37805,50.627],[13.32264,50.60317],[13.32594,50.58009],[13.29454,50.57904],[13.25158,50.59268],[13.19043,50.50237],[13.13424,50.51709],[13.08301,50.50132],[13.0312,50.50944],[13.02038,50.4734],[13.02147,50.44763],[12.98433,50.42016],[12.94058,50.40944],[12.82465,50.45738],[12.73476,50.43237],[12.73044,50.42268],[12.70731,50.39948],[12.67261,50.41949],[12.51356,50.39694],[12.48747,50.37278],[12.49214,50.35228],[12.48256,50.34784],[12.46643,50.35527],[12.43722,50.33774],[12.43371,50.32506],[12.39924,50.32302],[12.40158,50.29521],[12.36594,50.28289],[12.35425,50.23993],[12.33263,50.24367],[12.32445,50.20442],[12.33847,50.19432],[12.32596,50.17146],[12.29232,50.17524],[12.28063,50.19544],[12.28755,50.22429],[12.23943,50.24594],[12.24791,50.25525],[12.26953,50.25189],[12.25119,50.27079],[12.20823,50.2729],[12.18013,50.32146],[12.10907,50.32041],[12.13716,50.27396],[12.09287,50.25032],[12.19335,50.19997],[12.21484,50.16399],[12.1917,50.13434],[12.2073,50.10315],[12.23709,50.10213],[12.27433,50.0771],[12.26111,50.06331],[12.30798,50.05719],[12.49908,49.97305],[12.47264,49.94222],[12.55197,49.92094],[12.48256,49.83575],[12.46603,49.78882],[12.40489,49.76321],[12.4462,49.70233],[12.52553,49.68415],[12.53544,49.61888],[12.56188,49.6146],[12.60155,49.52887],[12.64782,49.52565],[12.64121,49.47628],[12.669,49.42935],[12.71227,49.42363],[12.75854,49.3989],[12.78168,49.34618],[12.88414,49.33541],[12.88249,49.35479],[12.94859,49.34079],[13.03618,49.30417],[13.02957,49.27399],[13.05883,49.26259],[13.17665,49.16713],[13.17019,49.14339],[13.20405,49.12303],[13.23689,49.11412],[13.28242,49.1228],[13.39479,49.04812],[13.40802,48.98851],[13.50221,48.93752],[13.50552,48.97441],[13.58319,48.96899],[13.61624,48.9462],[13.67739,48.87886],[13.73854,48.88538],[13.76994,48.83537],[13.78977,48.83319],[13.8096,48.77877],[13.84023,48.76988],[14.06151,48.66873],[14.01482,48.63788],[14.09104,48.5943],[14.20691,48.5898],[14.33909,48.55852],[14.43076,48.58855],[14.4587,48.64695],[14.56139,48.60429],[14.60808,48.62881],[14.66762,48.58215],[14.71794,48.59794],[14.72756,48.69502],[14.80584,48.73489],[14.80821,48.77711],[14.81545,48.7874],[14.94773,48.76268],[14.95641,48.75915],[14.9758,48.76857],[14.98112,48.77524],[14.9782,48.7766],[14.98032,48.77959],[14.95072,48.79101],[14.98917,48.90082],[14.97612,48.96983],[14.99878,49.01444],[15.15534,48.99056],[15.16358,48.94278],[15.26177,48.95766],[15.28305,48.98831],[15.34823,48.98444],[15.48027,48.94481],[15.51357,48.91549],[15.61622,48.89541],[15.6921,48.85973],[15.75341,48.8516],[15.78087,48.87644],[15.84404,48.86921],[16.06034,48.75436],[16.37345,48.729],[16.40915,48.74576],[16.46134,48.80865],[16.67008,48.77699],[16.68518,48.7281],[16.71883,48.73806],[16.79779,48.70998],[16.90354,48.71541],[16.93955,48.60371],[17.00215,48.70887],[17.11202,48.82925],[17.19355,48.87602],[17.29054,48.85546],[17.3853,48.80936],[17.45671,48.85004],[17.5295,48.81117],[17.7094,48.86721],[17.73126,48.87885],[17.77944,48.92318],[17.87831,48.92679],[17.91814,49.01784],[18.06885,49.03157],[18.1104,49.08624],[18.15022,49.24518],[18.18456,49.28909],[18.36446,49.3267],[18.4139,49.36517],[18.4084,49.40003],[18.44686,49.39467],[18.54848,49.47059],[18.53063,49.49022],[18.57183,49.51162],[18.6144,49.49824],[18.67757,49.50895],[18.74761,49.492],[18.84521,49.51672],[18.84786,49.5446],[18.80479,49.6815],[18.72838,49.68163],[18.69817,49.70473],[18.62676,49.71983],[18.62943,49.74603],[18.62645,49.75002],[18.61368,49.75426],[18.61278,49.7618],[18.57183,49.83334],[18.60341,49.86256],[18.57045,49.87849],[18.57697,49.91565],[18.54299,49.92537],[18.54495,49.9079],[18.53423,49.89906],[18.41604,49.93498],[18.33562,49.94747],[18.33278,49.92415],[18.31914,49.91565],[18.27794,49.93863],[18.27107,49.96779],[18.21752,49.97309],[18.20241,49.99958],[18.10628,50.00223],[18.07898,50.04535],[18.03212,50.06574],[18.00396,50.04954],[18.04585,50.03311],[18.04585,50.01194],[18.00191,50.01723],[17.86886,49.97452],[17.77669,50.02253],[17.7506,50.07896],[17.6888,50.12037],[17.66683,50.10275],[17.59404,50.16437],[17.70528,50.18812],[17.76296,50.23382],[17.72176,50.25665],[17.74648,50.29966],[17.69292,50.32859],[17.67764,50.28977],[17.58889,50.27837],[17.3702,50.28123],[17.34548,50.2628],[17.34273,50.32947],[17.27681,50.32246],[17.19991,50.3654],[17.19579,50.38817],[17.14498,50.38117],[17.1224,50.39494],[16.89229,50.45117],[16.85933,50.41093],[16.90877,50.38642],[16.94448,50.31281],[16.99803,50.30316],[17.02138,50.27772],[16.99803,50.25753],[17.02825,50.23118],[17.00353,50.21449],[16.98018,50.24172],[16.8456,50.20834],[16.7014,50.09659],[16.63137,50.1142],[16.55446,50.16613],[16.56407,50.21009],[16.42674,50.32509],[16.39379,50.3207],[16.3622,50.34875],[16.36495,50.37679],[16.30289,50.38292],[16.28118,50.36891],[16.22821,50.41054],[16.21585,50.40627],[16.19526,50.43291],[16.31413,50.50274],[16.34572,50.49575],[16.44597,50.58041],[16.33611,50.66579],[16.23174,50.67101],[16.20839,50.63096],[16.10265,50.66405],[16.02437,50.60046],[15.98317,50.61528],[16.0175,50.63009],[15.97219,50.69799],[15.87331,50.67188],[15.81683,50.75666],[15.73186,50.73885],[15.43798,50.80833],[15.3803,50.77187],[15.36656,50.83956],[15.2773,50.8907],[15.27043,50.97724],[15.2361,50.99886],[15.1743,50.9833],[15.16744,51.01959],[15.11937,50.99021],[15.10152,51.01095],[15.06218,51.02269],[15.03895,51.0123],[15.02433,51.0242],[14.96419,50.99108],[15.01088,50.97984],[14.99852,50.86817],[14.82803,50.86966]]]]}},{type:"Feature",properties:{iso1A2:"DE",iso1A3:"DEU",iso1N3:"276",wikidata:"Q183",nameEn:"Germany",groups:["EU","155","150","UN"],callingCodes:["49"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.70847,47.68904],[8.71773,47.69088],[8.70237,47.71453],[8.66416,47.71367],[8.67508,47.6979],[8.65769,47.68928],[8.66837,47.68437],[8.68985,47.69552],[8.70847,47.68904]]],[[[8.72617,47.69651],[8.72809,47.69282],[8.75856,47.68969],[8.79511,47.67462],[8.79966,47.70222],[8.76965,47.7075],[8.77309,47.72059],[8.80663,47.73821],[8.82002,47.71458],[8.86989,47.70504],[8.85065,47.68209],[8.87383,47.67045],[8.87625,47.65441],[8.89946,47.64769],[8.94093,47.65596],[9.02093,47.6868],[9.09891,47.67801],[9.13845,47.66389],[9.15181,47.66904],[9.1705,47.65513],[9.1755,47.65584],[9.17593,47.65399],[9.18203,47.65598],[9.25619,47.65939],[9.55125,47.53629],[9.72736,47.53457],[9.76748,47.5934],[9.80254,47.59419],[9.82591,47.58158],[9.8189,47.54688],[9.87499,47.52953],[9.87733,47.54688],[9.92407,47.53111],[9.96029,47.53899],[10.00003,47.48216],[10.03859,47.48927],[10.07131,47.45531],[10.09001,47.46005],[10.1052,47.4316],[10.06897,47.40709],[10.09819,47.35724],[10.11805,47.37228],[10.16362,47.36674],[10.17648,47.38889],[10.2127,47.38019],[10.22774,47.38904],[10.23757,47.37609],[10.19998,47.32832],[10.2147,47.31014],[10.17648,47.29149],[10.17531,47.27167],[10.23257,47.27088],[10.33424,47.30813],[10.39851,47.37623],[10.4324,47.38494],[10.4359,47.41183],[10.47446,47.43318],[10.46278,47.47901],[10.44291,47.48453],[10.4324,47.50111],[10.44992,47.5524],[10.43473,47.58394],[10.47329,47.58552],[10.48849,47.54057],[10.56912,47.53584],[10.60337,47.56755],[10.63456,47.5591],[10.68832,47.55752],[10.6965,47.54253],[10.7596,47.53228],[10.77596,47.51729],[10.88814,47.53701],[10.91268,47.51334],[10.86945,47.5015],[10.87061,47.4786],[10.90918,47.48571],[10.93839,47.48018],[10.92437,47.46991],[10.98513,47.42882],[10.97111,47.41617],[10.97111,47.39561],[11.11835,47.39719],[11.12536,47.41222],[11.20482,47.43198],[11.25157,47.43277],[11.22002,47.3964],[11.27844,47.39956],[11.29597,47.42566],[11.33804,47.44937],[11.4175,47.44621],[11.38128,47.47465],[11.4362,47.51413],[11.52618,47.50939],[11.58578,47.52281],[11.58811,47.55515],[11.60681,47.57881],[11.63934,47.59202],[11.84052,47.58354],[11.85572,47.60166],[12.0088,47.62451],[12.02282,47.61033],[12.05788,47.61742],[12.13734,47.60639],[12.17824,47.61506],[12.18145,47.61019],[12.17737,47.60121],[12.18568,47.6049],[12.20398,47.60667],[12.20801,47.61082],[12.19895,47.64085],[12.18507,47.65984],[12.18347,47.66663],[12.16769,47.68167],[12.16217,47.70105],[12.18303,47.70065],[12.22571,47.71776],[12.2542,47.7433],[12.26238,47.73544],[12.24017,47.69534],[12.26004,47.67725],[12.27991,47.68827],[12.336,47.69534],[12.37222,47.68433],[12.43883,47.6977],[12.44117,47.6741],[12.50076,47.62293],[12.53816,47.63553],[12.57438,47.63238],[12.6071,47.6741],[12.7357,47.6787],[12.77777,47.66689],[12.76492,47.64485],[12.82101,47.61493],[12.77427,47.58025],[12.80699,47.54477],[12.84672,47.54556],[12.85256,47.52741],[12.9624,47.47452],[12.98344,47.48716],[12.9998,47.46267],[13.04537,47.49426],[13.03252,47.53373],[13.05355,47.56291],[13.04537,47.58183],[13.06641,47.58577],[13.06407,47.60075],[13.09562,47.63304],[13.07692,47.68814],[13.01382,47.72116],[12.98578,47.7078],[12.92969,47.71094],[12.91333,47.7178],[12.90274,47.72513],[12.91711,47.74026],[12.9353,47.74788],[12.94371,47.76281],[12.93202,47.77302],[12.96311,47.79957],[12.98543,47.82896],[13.00588,47.84374],[12.94163,47.92927],[12.93886,47.94046],[12.93642,47.94436],[12.93419,47.94063],[12.92668,47.93879],[12.91985,47.94069],[12.9211,47.95135],[12.91683,47.95647],[12.87476,47.96195],[12.8549,48.01122],[12.76141,48.07373],[12.74973,48.10885],[12.7617,48.12796],[12.78595,48.12445],[12.80676,48.14979],[12.82673,48.15245],[12.8362,48.15876],[12.836,48.1647],[12.84475,48.16556],[12.87126,48.20318],[12.95306,48.20629],[13.02083,48.25689],[13.0851,48.27711],[13.126,48.27867],[13.18093,48.29577],[13.26039,48.29422],[13.30897,48.31575],[13.40709,48.37292],[13.43929,48.43386],[13.42527,48.45711],[13.45727,48.51092],[13.43695,48.55776],[13.45214,48.56472],[13.46967,48.55157],[13.50663,48.57506],[13.50131,48.58091],[13.51291,48.59023],[13.57535,48.55912],[13.59705,48.57013],[13.62508,48.55501],[13.65186,48.55092],[13.66113,48.53558],[13.72802,48.51208],[13.74816,48.53058],[13.7513,48.5624],[13.76921,48.55324],[13.80519,48.58026],[13.80038,48.59487],[13.82609,48.62345],[13.81901,48.6761],[13.81283,48.68426],[13.81791,48.69832],[13.79337,48.71375],[13.81863,48.73257],[13.82266,48.75544],[13.84023,48.76988],[13.8096,48.77877],[13.78977,48.83319],[13.76994,48.83537],[13.73854,48.88538],[13.67739,48.87886],[13.61624,48.9462],[13.58319,48.96899],[13.50552,48.97441],[13.50221,48.93752],[13.40802,48.98851],[13.39479,49.04812],[13.28242,49.1228],[13.23689,49.11412],[13.20405,49.12303],[13.17019,49.14339],[13.17665,49.16713],[13.05883,49.26259],[13.02957,49.27399],[13.03618,49.30417],[12.94859,49.34079],[12.88249,49.35479],[12.88414,49.33541],[12.78168,49.34618],[12.75854,49.3989],[12.71227,49.42363],[12.669,49.42935],[12.64121,49.47628],[12.64782,49.52565],[12.60155,49.52887],[12.56188,49.6146],[12.53544,49.61888],[12.52553,49.68415],[12.4462,49.70233],[12.40489,49.76321],[12.46603,49.78882],[12.48256,49.83575],[12.55197,49.92094],[12.47264,49.94222],[12.49908,49.97305],[12.30798,50.05719],[12.26111,50.06331],[12.27433,50.0771],[12.23709,50.10213],[12.2073,50.10315],[12.1917,50.13434],[12.21484,50.16399],[12.19335,50.19997],[12.09287,50.25032],[12.13716,50.27396],[12.10907,50.32041],[12.18013,50.32146],[12.20823,50.2729],[12.25119,50.27079],[12.26953,50.25189],[12.24791,50.25525],[12.23943,50.24594],[12.28755,50.22429],[12.28063,50.19544],[12.29232,50.17524],[12.32596,50.17146],[12.33847,50.19432],[12.32445,50.20442],[12.33263,50.24367],[12.35425,50.23993],[12.36594,50.28289],[12.40158,50.29521],[12.39924,50.32302],[12.43371,50.32506],[12.43722,50.33774],[12.46643,50.35527],[12.48256,50.34784],[12.49214,50.35228],[12.48747,50.37278],[12.51356,50.39694],[12.67261,50.41949],[12.70731,50.39948],[12.73044,50.42268],[12.73476,50.43237],[12.82465,50.45738],[12.94058,50.40944],[12.98433,50.42016],[13.02147,50.44763],[13.02038,50.4734],[13.0312,50.50944],[13.08301,50.50132],[13.13424,50.51709],[13.19043,50.50237],[13.25158,50.59268],[13.29454,50.57904],[13.32594,50.58009],[13.32264,50.60317],[13.37805,50.627],[13.37485,50.64931],[13.42189,50.61243],[13.46413,50.60102],[13.49742,50.63133],[13.5226,50.64721],[13.53748,50.67654],[13.52474,50.70394],[13.65977,50.73096],[13.70204,50.71771],[13.76316,50.73487],[13.82942,50.7251],[13.89444,50.74142],[13.89113,50.78533],[13.98864,50.8177],[14.02982,50.80662],[14.22331,50.86049],[14.24314,50.88761],[14.27123,50.89386],[14.30098,50.88448],[14.38691,50.89907],[14.39848,50.93866],[14.31422,50.95243],[14.30251,50.96606],[14.32793,50.97379],[14.32353,50.98556],[14.28776,50.97718],[14.25665,50.98935],[14.30098,51.05515],[14.41335,51.02086],[14.45827,51.03712],[14.49202,51.02286],[14.49154,51.04382],[14.49991,51.04692],[14.50809,51.0427],[14.49873,51.02242],[14.53321,51.01679],[14.53438,51.00374],[14.56432,51.01008],[14.58215,50.99306],[14.59908,50.98685],[14.59702,50.96148],[14.56374,50.922],[14.58024,50.91443],[14.64802,50.93241],[14.65259,50.90513],[14.63434,50.8883],[14.61993,50.86049],[14.70661,50.84096],[14.79139,50.81438],[14.82803,50.86966],[14.81664,50.88148],[14.89681,50.9422],[14.89252,50.94999],[14.92942,50.99744],[14.95529,51.04552],[14.97938,51.07742],[14.98229,51.11354],[14.99689,51.12205],[14.99079,51.14284],[14.99646,51.14365],[15.00083,51.14974],[14.99414,51.15813],[14.99311,51.16249],[15.0047,51.16874],[15.01242,51.21285],[15.04288,51.28387],[14.98008,51.33449],[14.96899,51.38367],[14.9652,51.44793],[14.94749,51.47155],[14.73219,51.52922],[14.72652,51.53902],[14.73047,51.54606],[14.71125,51.56209],[14.7727,51.61263],[14.75759,51.62318],[14.75392,51.67445],[14.69065,51.70842],[14.66386,51.73282],[14.64625,51.79472],[14.60493,51.80473],[14.59089,51.83302],[14.6588,51.88359],[14.6933,51.9044],[14.70601,51.92944],[14.7177,51.94048],[14.72163,51.95188],[14.71836,51.95606],[14.7139,51.95643],[14.70488,51.97679],[14.71339,52.00337],[14.76026,52.06624],[14.72971,52.09167],[14.6917,52.10283],[14.67683,52.13936],[14.70616,52.16927],[14.68344,52.19612],[14.71319,52.22144],[14.70139,52.25038],[14.58149,52.28007],[14.56378,52.33838],[14.55228,52.35264],[14.54423,52.42568],[14.63056,52.48993],[14.60081,52.53116],[14.6289,52.57136],[14.61073,52.59847],[14.22071,52.81175],[14.13806,52.82392],[14.12256,52.84311],[14.15873,52.87715],[14.14056,52.95786],[14.25954,53.00264],[14.35044,53.05829],[14.38679,53.13669],[14.36696,53.16444],[14.37853,53.20405],[14.40662,53.21098],[14.45125,53.26241],[14.44133,53.27427],[14.4215,53.27724],[14.35209,53.49506],[14.3273,53.50587],[14.30416,53.55499],[14.31904,53.61581],[14.2853,53.63392],[14.28477,53.65955],[14.27133,53.66613],[14.2836,53.67721],[14.26782,53.69866],[14.27249,53.74464],[14.21323,53.8664],[14.20823,53.90776],[14.18544,53.91258],[14.20647,53.91671],[14.22634,53.9291],[14.20811,54.12784],[13.93395,54.84044],[12.85844,54.82438],[11.90309,54.38543],[11.00303,54.63689],[10.31111,54.65968],[10.16755,54.73883],[9.89314,54.84171],[9.73563,54.8247],[9.61187,54.85548],[9.62734,54.88057],[9.58937,54.88785],[9.4659,54.83131],[9.43155,54.82586],[9.41213,54.84254],[9.38532,54.83968],[9.36496,54.81749],[9.33849,54.80233],[9.32771,54.80602],[9.2474,54.8112],[9.23445,54.83432],[9.24631,54.84726],[9.20571,54.85841],[9.14275,54.87421],[9.04629,54.87249],[8.92795,54.90452],[8.81178,54.90518],[8.76387,54.8948],[8.63979,54.91069],[8.55769,54.91837],[8.45719,55.06747],[8.02459,55.09613],[5.45168,54.20039],[6.91025,53.44221],[7.00198,53.32672],[7.19052,53.31866],[7.21679,53.20058],[7.22681,53.18165],[7.17898,53.13817],[7.21694,53.00742],[7.07253,52.81083],[7.04557,52.63318],[6.77307,52.65375],[6.71641,52.62905],[6.69507,52.488],[6.94293,52.43597],[6.99041,52.47235],[7.03417,52.40237],[7.07044,52.37805],[7.02703,52.27941],[7.06365,52.23789],[7.03729,52.22695],[6.9897,52.2271],[6.97189,52.20329],[6.83984,52.11728],[6.76117,52.11895],[6.68128,52.05052],[6.83035,51.9905],[6.82357,51.96711],[6.72319,51.89518],[6.68386,51.91861],[6.58556,51.89386],[6.50231,51.86313],[6.47179,51.85395],[6.38815,51.87257],[6.40704,51.82771],[6.30593,51.84998],[6.29872,51.86801],[6.21443,51.86801],[6.15349,51.90439],[6.11551,51.89769],[6.16902,51.84094],[6.10337,51.84829],[6.06705,51.86136],[5.99848,51.83195],[5.94568,51.82786],[5.98665,51.76944],[5.95003,51.7493],[6.04091,51.71821],[6.02767,51.6742],[6.11759,51.65609],[6.09055,51.60564],[6.18017,51.54096],[6.21724,51.48568],[6.20654,51.40049],[6.22641,51.39948],[6.22674,51.36135],[6.16977,51.33169],[6.07889,51.24432],[6.07889,51.17038],[6.17384,51.19589],[6.16706,51.15677],[5.98292,51.07469],[5.9541,51.03496],[5.9134,51.06736],[5.86735,51.05182],[5.87849,51.01969],[5.90493,51.00198],[5.90296,50.97356],[5.95282,50.98728],[6.02697,50.98303],[6.01615,50.93367],[6.09297,50.92066],[6.07486,50.89307],[6.08805,50.87223],[6.07693,50.86025],[6.07431,50.84674],[6.05702,50.85179],[6.05623,50.8572],[6.01921,50.84435],[6.02328,50.81694],[6.00462,50.80065],[5.98404,50.80988],[5.97497,50.79992],[6.02624,50.77453],[6.01976,50.75398],[6.03889,50.74618],[6.0326,50.72647],[6.0406,50.71848],[6.04428,50.72861],[6.11707,50.72231],[6.17852,50.6245],[6.26957,50.62444],[6.2476,50.60392],[6.24888,50.59869],[6.24005,50.58732],[6.22581,50.5907],[6.20281,50.56952],[6.17739,50.55875],[6.17802,50.54179],[6.19735,50.53576],[6.19579,50.5313],[6.18716,50.52653],[6.19193,50.5212],[6.20599,50.52089],[6.22335,50.49578],[6.26637,50.50272],[6.30809,50.50058],[6.3465,50.48833],[6.34005,50.46083],[6.37219,50.45397],[6.36852,50.40776],[6.34406,50.37994],[6.3688,50.35898],[6.40785,50.33557],[6.40641,50.32425],[6.35701,50.31139],[6.32488,50.32333],[6.29949,50.30887],[6.28797,50.27458],[6.208,50.25179],[6.16853,50.2234],[6.18364,50.20815],[6.18739,50.1822],[6.14588,50.17106],[6.14132,50.14971],[6.15298,50.14126],[6.1379,50.12964],[6.12055,50.09171],[6.11274,50.05916],[6.13458,50.04141],[6.13044,50.02929],[6.14666,50.02207],[6.13794,50.01466],[6.13273,50.02019],[6.1295,50.01849],[6.13806,50.01056],[6.14948,50.00908],[6.14147,49.99563],[6.1701,49.98518],[6.16466,49.97086],[6.17872,49.9537],[6.18554,49.95622],[6.18045,49.96611],[6.19089,49.96991],[6.19856,49.95053],[6.22094,49.94955],[6.22608,49.929],[6.21882,49.92403],[6.22926,49.92096],[6.23496,49.89972],[6.26146,49.88203],[6.28874,49.87592],[6.29692,49.86685],[6.30963,49.87021],[6.32303,49.85133],[6.32098,49.83728],[6.33585,49.83785],[6.34267,49.84974],[6.36576,49.85032],[6.40022,49.82029],[6.42521,49.81591],[6.42905,49.81091],[6.44131,49.81443],[6.45425,49.81164],[6.47111,49.82263],[6.48718,49.81267],[6.50647,49.80916],[6.51215,49.80124],[6.52121,49.81338],[6.53122,49.80666],[6.52169,49.79787],[6.50534,49.78952],[6.51669,49.78336],[6.51056,49.77515],[6.51828,49.76855],[6.51646,49.75961],[6.50174,49.75292],[6.50193,49.73291],[6.51805,49.72425],[6.51397,49.72058],[6.50261,49.72718],[6.49535,49.72645],[6.49694,49.72205],[6.5042,49.71808],[6.50647,49.71353],[6.49785,49.71118],[6.48014,49.69767],[6.46048,49.69092],[6.44654,49.67799],[6.42937,49.66857],[6.42726,49.66078],[6.43768,49.66021],[6.4413,49.65722],[6.41861,49.61723],[6.39822,49.60081],[6.385,49.59946],[6.37464,49.58886],[6.38342,49.5799],[6.38024,49.57593],[6.36676,49.57813],[6.35825,49.57053],[6.38228,49.55855],[6.38072,49.55171],[6.35666,49.52931],[6.36788,49.50377],[6.36907,49.48931],[6.36778,49.46937],[6.38352,49.46463],[6.39168,49.4667],[6.40274,49.46546],[6.42432,49.47683],[6.55404,49.42464],[6.533,49.40748],[6.60091,49.36864],[6.58807,49.35358],[6.572,49.35027],[6.60186,49.31055],[6.66583,49.28065],[6.69274,49.21661],[6.71843,49.2208],[6.73256,49.20486],[6.71137,49.18808],[6.73765,49.16375],[6.78265,49.16793],[6.83385,49.15162],[6.84703,49.15734],[6.86225,49.18185],[6.85016,49.19354],[6.85119,49.20038],[6.83555,49.21249],[6.85939,49.22376],[6.89298,49.20863],[6.91875,49.22261],[6.93831,49.2223],[6.94028,49.21641],[6.95963,49.203],[6.97273,49.2099],[7.01318,49.19018],[7.03459,49.19096],[7.0274,49.17042],[7.03178,49.15734],[7.04662,49.13724],[7.04409,49.12123],[7.04843,49.11422],[7.05548,49.11185],[7.06642,49.11415],[7.07162,49.1255],[7.09007,49.13094],[7.07859,49.15031],[7.10715,49.15631],[7.10384,49.13787],[7.12504,49.14253],[7.1358,49.1282],[7.1593,49.1204],[7.23473,49.12971],[7.29514,49.11426],[7.3195,49.14231],[7.35995,49.14399],[7.3662,49.17308],[7.44052,49.18354],[7.44455,49.16765],[7.49473,49.17],[7.49172,49.13915],[7.53012,49.09818],[7.56416,49.08136],[7.62575,49.07654],[7.63618,49.05428],[7.75948,49.04562],[7.79557,49.06583],[7.86386,49.03499],[7.93641,49.05544],[7.97783,49.03161],[8.14189,48.97833],[8.22604,48.97352],[8.20031,48.95856],[8.19989,48.95825],[8.12813,48.87985],[8.10253,48.81829],[8.06802,48.78957],[8.0326,48.79017],[8.01534,48.76085],[7.96994,48.75606],[7.96812,48.72491],[7.89002,48.66317],[7.84098,48.64217],[7.80057,48.5857],[7.80167,48.54758],[7.80647,48.51239],[7.76833,48.48945],[7.73109,48.39192],[7.74562,48.32736],[7.69022,48.30018],[7.6648,48.22219],[7.57137,48.12292],[7.56966,48.03265],[7.62302,47.97898],[7.55673,47.87371],[7.52921,47.77747],[7.54761,47.72912],[7.53722,47.71635],[7.51266,47.70197],[7.51915,47.68335],[7.52067,47.66437],[7.53384,47.65115],[7.5591,47.63849],[7.57423,47.61628],[7.58851,47.60794],[7.59301,47.60058],[7.58945,47.59017],[7.60523,47.58519],[7.60459,47.57869],[7.61929,47.57683],[7.64309,47.59151],[7.64213,47.5944],[7.64599,47.59695],[7.67395,47.59212],[7.68229,47.59905],[7.69385,47.60099],[7.68486,47.59601],[7.67115,47.5871],[7.68904,47.57133],[7.67655,47.56435],[7.63338,47.56256],[7.65083,47.54662],[7.66174,47.54554],[7.6656,47.53752],[7.68101,47.53232],[7.69642,47.53297],[7.71961,47.54219],[7.75261,47.54599],[7.79486,47.55691],[7.81901,47.58798],[7.84412,47.5841],[7.88664,47.58854],[7.90673,47.57674],[7.91251,47.55031],[7.94494,47.54511],[7.95682,47.55789],[7.97581,47.55493],[8.00113,47.55616],[8.02136,47.55096],[8.04383,47.55443],[8.06663,47.56374],[8.08557,47.55768],[8.10002,47.56504],[8.10395,47.57918],[8.11543,47.5841],[8.13662,47.58432],[8.13823,47.59147],[8.14947,47.59558],[8.1652,47.5945],[8.19378,47.61636],[8.20617,47.62141],[8.22011,47.6181],[8.22577,47.60385],[8.23809,47.61204],[8.25863,47.61571],[8.26313,47.6103],[8.2824,47.61225],[8.29722,47.60603],[8.29524,47.5919],[8.30277,47.58607],[8.32735,47.57133],[8.35512,47.57014],[8.38273,47.56608],[8.39477,47.57826],[8.43235,47.56617],[8.49431,47.58107],[8.48949,47.588],[8.46637,47.58389],[8.45578,47.60121],[8.50747,47.61897],[8.51686,47.63476],[8.55756,47.62394],[8.57586,47.59537],[8.60348,47.61204],[8.59545,47.64298],[8.60701,47.65271],[8.61471,47.64514],[8.60412,47.63735],[8.62049,47.63757],[8.62884,47.65098],[8.61113,47.66332],[8.6052,47.67258],[8.57683,47.66158],[8.56141,47.67088],[8.52801,47.66059],[8.5322,47.64687],[8.49656,47.64709],[8.46605,47.64103],[8.4667,47.65747],[8.44711,47.65379],[8.42264,47.66667],[8.41346,47.66676],[8.40473,47.67499],[8.4211,47.68407],[8.40569,47.69855],[8.44807,47.72426],[8.45771,47.7493],[8.48868,47.77215],[8.56814,47.78001],[8.56415,47.80633],[8.61657,47.79998],[8.62408,47.7626],[8.64425,47.76398],[8.65292,47.80066],[8.68022,47.78599],[8.68985,47.75686],[8.71778,47.76571],[8.74251,47.75168],[8.70543,47.73121],[8.73671,47.7169],[8.72617,47.69651]]]]}},{type:"Feature",properties:{iso1A2:"DG",iso1A3:"DGA",wikidata:"Q184851",nameEn:"Diego Garcia",country:"GB",groups:["IO","BOTS","014","202","002","UN"],isoStatus:"excRes",callingCodes:["246"]},geometry:{type:"MultiPolygon",coordinates:[[[[73.14823,-7.76302],[73.09982,-6.07324],[71.43792,-7.73904],[73.14823,-7.76302]]]]}},{type:"Feature",properties:{iso1A2:"DJ",iso1A3:"DJI",iso1N3:"262",wikidata:"Q977",nameEn:"Djibouti",groups:["014","202","002","UN"],callingCodes:["253"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.90659,12.3823],[43.90659,12.3823],[43.32909,12.59711],[43.29075,12.79154],[42.86195,12.58747],[42.7996,12.42629],[42.6957,12.36201],[42.46941,12.52661],[42.4037,12.46478],[41.95461,11.81157],[41.82878,11.72361],[41.77727,11.49902],[41.8096,11.33606],[41.80056,10.97127],[42.06302,10.92599],[42.13691,10.97586],[42.42669,10.98493],[42.62989,11.09711],[42.75111,11.06992],[42.79037,10.98493],[42.95776,10.98533],[43.90659,12.3823]]]]}},{type:"Feature",properties:{iso1A2:"DK",iso1A3:"DNK",iso1N3:"208",wikidata:"Q756617",nameEn:"Kingdom of Denmark"},geometry:null},{type:"Feature",properties:{iso1A2:"DM",iso1A3:"DMA",iso1N3:"212",wikidata:"Q784",nameEn:"Dominica",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 767"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.32485,14.91445],[-60.86656,15.82603],[-61.95646,15.5094],[-61.32485,14.91445]]]]}},{type:"Feature",properties:{iso1A2:"DO",iso1A3:"DOM",iso1N3:"214",wikidata:"Q786",nameEn:"Dominican Republic",groups:["029","003","419","019","UN"],callingCodes:["1 809","1 829","1 849"]},geometry:{type:"MultiPolygon",coordinates:[[[[-67.87844,21.7938],[-72.38946,20.27111],[-71.77419,19.73128],[-71.75865,19.70231],[-71.7429,19.58445],[-71.71449,19.55364],[-71.71268,19.53374],[-71.6802,19.45008],[-71.69448,19.37866],[-71.77766,19.33823],[-71.73229,19.26686],[-71.62642,19.21212],[-71.65337,19.11759],[-71.69938,19.10916],[-71.71088,19.08353],[-71.74088,19.0437],[-71.88102,18.95007],[-71.77766,18.95007],[-71.72624,18.87802],[-71.71885,18.78423],[-71.82556,18.62551],[-71.95412,18.64939],[-72.00201,18.62312],[-71.88102,18.50125],[-71.90875,18.45821],[-71.69952,18.34101],[-71.78271,18.18302],[-71.75465,18.14405],[-71.74994,18.11115],[-71.73783,18.07177],[-71.75671,18.03456],[-72.29523,17.48026],[-68.39466,16.14167],[-67.87844,21.7938]]]]}},{type:"Feature",properties:{iso1A2:"DZ",iso1A3:"DZA",iso1N3:"012",wikidata:"Q262",nameEn:"Algeria",groups:["015","002","UN"],callingCodes:["213"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.59123,37.14286],[5.10072,39.89531],[-2.27707,35.35051],[-2.21248,35.08532],[-2.21445,35.04378],[-2.04734,34.93218],[-1.97833,34.93218],[-1.97469,34.886],[-1.73707,34.74226],[-1.84569,34.61907],[-1.69788,34.48056],[-1.78042,34.39018],[-1.64666,34.10405],[-1.73494,33.71721],[-1.59508,33.59929],[-1.67067,33.27084],[-1.46249,33.0499],[-1.54244,32.95499],[-1.37794,32.73628],[-.9912,32.52467],[-1.24998,32.32993],[-1.24453,32.1917],[-1.15735,32.12096],[-1.22829,32.07832],[-2.46166,32.16603],[-2.93873,32.06557],[-2.82784,31.79459],[-3.66314,31.6339],[-3.66386,31.39202],[-3.77647,31.31912],[-3.77103,31.14984],[-3.54944,31.0503],[-3.65418,30.85566],[-3.64735,30.67539],[-4.31774,30.53229],[-4.6058,30.28343],[-5.21671,29.95253],[-5.58831,29.48103],[-5.72121,29.52322],[-5.75616,29.61407],[-6.69965,29.51623],[-6.78351,29.44634],[-6.95824,29.50924],[-7.61585,29.36252],[-8.6715,28.71194],[-8.66879,27.6666],[-8.66674,27.31569],[-4.83423,24.99935],[1.15698,21.12843],[1.20992,20.73533],[3.24648,19.81703],[3.12501,19.1366],[3.36082,18.9745],[4.26651,19.14224],[5.8153,19.45101],[7.38361,20.79165],[7.48273,20.87258],[11.96886,23.51735],[11.62498,24.26669],[11.41061,24.21456],[10.85323,24.5595],[10.33159,24.5465],[10.02432,24.98124],[10.03146,25.35635],[9.38834,26.19288],[9.51696,26.39148],[9.89569,26.57696],[9.78136,29.40961],[9.3876,30.16738],[9.55544,30.23971],[9.07483,32.07865],[8.35999,32.50101],[8.31895,32.83483],[8.1179,33.05086],[8.11433,33.10175],[7.83028,33.18851],[7.73687,33.42114],[7.54088,33.7726],[7.52851,34.06493],[7.66174,34.20167],[7.74207,34.16492],[7.81242,34.21841],[7.86264,34.3987],[8.20482,34.57575],[8.29655,34.72798],[8.25189,34.92009],[8.30727,34.95378],[8.3555,35.10007],[8.47318,35.23376],[8.30329,35.29884],[8.36086,35.47774],[8.35371,35.66373],[8.26472,35.73669],[8.2626,35.91733],[8.40731,36.42208],[8.18936,36.44939],[8.16167,36.48817],[8.47609,36.66607],[8.46537,36.7706],[8.57613,36.78062],[8.67706,36.8364],[8.62972,36.86499],[8.64044,36.9401],[8.59123,37.14286]]]]}},{type:"Feature",properties:{iso1A2:"EA",wikidata:"Q28868874",nameEn:"Ceuta, Melilla",country:"ES",level:"territory",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"EC",iso1A3:"ECU",iso1N3:"218",wikidata:"Q736",nameEn:"Ecuador"},geometry:null},{type:"Feature",properties:{iso1A2:"EE",iso1A3:"EST",iso1N3:"233",wikidata:"Q191",nameEn:"Estonia",aliases:["EW"],groups:["EU","154","150","UN"],callingCodes:["372"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.32936,60.00121],[20.5104,59.15546],[19.84909,57.57876],[22.80496,57.87798],[23.20055,57.56697],[24.26221,57.91787],[24.3579,57.87471],[25.19484,58.0831],[25.28237,57.98539],[25.29581,58.08288],[25.73499,57.90193],[26.05949,57.84744],[26.0324,57.79037],[26.02456,57.78342],[26.027,57.78158],[26.0266,57.77441],[26.02069,57.77169],[26.02415,57.76865],[26.03332,57.7718],[26.0543,57.76105],[26.08098,57.76619],[26.2029,57.7206],[26.1866,57.6849],[26.29253,57.59244],[26.46527,57.56885],[26.54675,57.51813],[26.90364,57.62823],[27.34698,57.52242],[27.31919,57.57672],[27.40393,57.62125],[27.3746,57.66834],[27.52615,57.72843],[27.50171,57.78842],[27.56689,57.83356],[27.78526,57.83963],[27.81841,57.89244],[27.67282,57.92627],[27.62393,58.09462],[27.48541,58.22615],[27.55489,58.39525],[27.36366,58.78381],[27.74429,58.98351],[27.80482,59.1116],[27.87978,59.18097],[27.90911,59.24353],[28.00689,59.28351],[28.14215,59.28934],[28.19284,59.35791],[28.20537,59.36491],[28.21137,59.38058],[28.19061,59.39962],[28.04187,59.47017],[27.85643,59.58538],[26.90044,59.63819],[26.32936,60.00121]]]]}},{type:"Feature",properties:{iso1A2:"EG",iso1A3:"EGY",iso1N3:"818",wikidata:"Q79",nameEn:"Egypt",groups:["015","002","UN"],callingCodes:["20"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.62659,31.82938],[26.92891,33.39516],[24.8458,31.39877],[25.01077,30.73861],[24.71117,30.17441],[24.99968,29.24574],[24.99885,21.99535],[33.17563,22.00405],[34.0765,22.00501],[37.8565,22.00903],[34.4454,27.91479],[34.8812,29.36878],[34.92298,29.45305],[34.26742,31.21998],[34.24012,31.29591],[34.23572,31.2966],[34.21853,31.32363],[34.052,31.46619],[33.62659,31.82938]]]]}},{type:"Feature",properties:{iso1A2:"EH",iso1A3:"ESH",iso1N3:"732",wikidata:"Q6250",nameEn:"Western Sahara",groups:["015","002"],callingCodes:["212"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.66879,27.6666],[-8.77527,27.66663],[-8.71787,26.9898],[-9.08698,26.98639],[-9.56957,26.90042],[-9.81998,26.71379],[-10.68417,26.90984],[-11.35695,26.8505],[-11.23622,26.72023],[-11.38635,26.611],[-11.62052,26.05229],[-12.06001,26.04442],[-12.12281,25.13682],[-12.92147,24.39502],[-13.00628,24.01923],[-13.75627,23.77231],[-14.10361,22.75501],[-14.1291,22.41636],[-14.48112,22.00886],[-14.47329,21.63839],[-14.78487,21.36587],[-16.44269,21.39745],[-16.9978,21.36239],[-17.02707,21.34022],[-17.21511,21.34226],[-17.35589,20.80492],[-17.0471,20.76408],[-17.0695,20.85742],[-17.06781,20.92697],[-17.0396,20.9961],[-17.0357,21.05368],[-16.99806,21.12142],[-16.95474,21.33997],[-13.01525,21.33343],[-13.08438,22.53866],[-13.15313,22.75649],[-13.10753,22.89493],[-13.00412,23.02297],[-12.5741,23.28975],[-12.36213,23.3187],[-12.14969,23.41935],[-12.00251,23.4538],[-12.0002,25.9986],[-8.66721,25.99918],[-8.66674,27.31569],[-8.66879,27.6666]]]]}},{type:"Feature",properties:{iso1A2:"ER",iso1A3:"ERI",iso1N3:"232",wikidata:"Q986",nameEn:"Eritrea",groups:["014","202","002","UN"],callingCodes:["291"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.99158,15.81743],[39.63762,18.37348],[38.57727,17.98125],[38.45916,17.87167],[38.37133,17.66269],[38.13362,17.53906],[37.50967,17.32199],[37.42694,17.04041],[36.99777,17.07172],[36.92193,16.23451],[36.76371,15.80831],[36.69761,15.75323],[36.54276,15.23478],[36.44337,15.14963],[36.54376,14.25597],[36.56536,14.26177],[36.55659,14.28237],[36.63364,14.31172],[36.85787,14.32201],[37.01622,14.2561],[37.09486,14.27155],[37.13206,14.40746],[37.3106,14.44657],[37.47319,14.2149],[37.528,14.18413],[37.91287,14.89447],[38.0364,14.72745],[38.25562,14.67287],[38.3533,14.51323],[38.45748,14.41445],[38.78306,14.4754],[38.98058,14.54895],[39.02834,14.63717],[39.16074,14.65187],[39.14772,14.61827],[39.19547,14.56996],[39.23888,14.56365],[39.26927,14.48801],[39.2302,14.44598],[39.2519,14.40393],[39.37685,14.54402],[39.52756,14.49011],[39.50585,14.55735],[39.58182,14.60987],[39.76632,14.54264],[39.9443,14.41024],[40.07236,14.54264],[40.14649,14.53969],[40.21128,14.39342],[40.25686,14.41445],[40.9167,14.11152],[41.25097,13.60787],[41.62864,13.38626],[42.05841,12.80912],[42.21469,12.75832],[42.2798,12.6355],[42.4037,12.46478],[42.46941,12.52661],[42.6957,12.36201],[42.7996,12.42629],[42.86195,12.58747],[43.29075,12.79154],[40.99158,15.81743]]]]}},{type:"Feature",properties:{iso1A2:"ES",iso1A3:"ESP",iso1N3:"724",wikidata:"Q29",nameEn:"Spain"},geometry:null},{type:"Feature",properties:{iso1A2:"ET",iso1A3:"ETH",iso1N3:"231",wikidata:"Q115",nameEn:"Ethiopia",groups:["014","202","002","UN"],callingCodes:["251"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.4037,12.46478],[42.2798,12.6355],[42.21469,12.75832],[42.05841,12.80912],[41.62864,13.38626],[41.25097,13.60787],[40.9167,14.11152],[40.25686,14.41445],[40.21128,14.39342],[40.14649,14.53969],[40.07236,14.54264],[39.9443,14.41024],[39.76632,14.54264],[39.58182,14.60987],[39.50585,14.55735],[39.52756,14.49011],[39.37685,14.54402],[39.2519,14.40393],[39.2302,14.44598],[39.26927,14.48801],[39.23888,14.56365],[39.19547,14.56996],[39.14772,14.61827],[39.16074,14.65187],[39.02834,14.63717],[38.98058,14.54895],[38.78306,14.4754],[38.45748,14.41445],[38.3533,14.51323],[38.25562,14.67287],[38.0364,14.72745],[37.91287,14.89447],[37.528,14.18413],[37.47319,14.2149],[37.3106,14.44657],[37.13206,14.40746],[37.09486,14.27155],[37.01622,14.2561],[36.85787,14.32201],[36.63364,14.31172],[36.55659,14.28237],[36.56536,14.26177],[36.54376,14.25597],[36.44653,13.95666],[36.48824,13.83954],[36.38993,13.56459],[36.24545,13.36759],[36.13374,12.92665],[36.16651,12.88019],[36.14268,12.70879],[36.01458,12.72478],[35.70476,12.67101],[35.24302,11.91132],[35.11492,11.85156],[35.05832,11.71158],[35.09556,11.56278],[34.95704,11.24448],[35.01215,11.19626],[34.93172,10.95946],[34.97789,10.91559],[34.97491,10.86147],[34.86916,10.78832],[34.86618,10.74588],[34.77532,10.69027],[34.77383,10.74588],[34.59062,10.89072],[34.4372,10.781],[34.2823,10.53508],[34.34783,10.23914],[34.32102,10.11599],[34.22718,10.02506],[34.20484,9.9033],[34.13186,9.7492],[34.08717,9.55243],[34.10229,9.50238],[34.14304,9.04654],[34.14453,8.60204],[34.01346,8.50041],[33.89579,8.4842],[33.87195,8.41938],[33.71407,8.3678],[33.66938,8.44442],[33.54575,8.47094],[33.3119,8.45474],[33.19721,8.40317],[33.1853,8.29264],[33.18083,8.13047],[33.08401,8.05822],[33.0006,7.90333],[33.04944,7.78989],[33.24637,7.77939],[33.32531,7.71297],[33.44745,7.7543],[33.71407,7.65983],[33.87642,7.5491],[34.02984,7.36449],[34.03878,7.27437],[34.01495,7.25664],[34.19369,7.12807],[34.19369,7.04382],[34.35753,6.91963],[34.47669,6.91076],[34.53925,6.82794],[34.53776,6.74808],[34.65096,6.72589],[34.77459,6.5957],[34.87736,6.60161],[35.01738,6.46991],[34.96227,6.26415],[35.00546,5.89387],[35.12611,5.68937],[35.13058,5.62118],[35.31188,5.50106],[35.29938,5.34042],[35.50792,5.42431],[35.8576,5.33413],[35.81968,5.10757],[35.82118,4.77382],[35.9419,4.61933],[35.95449,4.53244],[36.03924,4.44406],[36.84474,4.44518],[37.07724,4.33503],[38.14168,3.62487],[38.45812,3.60445],[38.52336,3.62551],[38.91938,3.51198],[39.07736,3.5267],[39.19954,3.47834],[39.49444,3.45521],[39.51551,3.40895],[39.55132,3.39634],[39.58339,3.47434],[39.76808,3.67058],[39.86043,3.86974],[40.77498,4.27683],[41.1754,3.94079],[41.89488,3.97375],[42.07619,4.17667],[42.55853,4.20518],[42.84526,4.28357],[42.97746,4.44032],[43.04177,4.57923],[43.40263,4.79289],[44.02436,4.9451],[44.98104,4.91821],[47.97917,8.00124],[47.92477,8.00111],[46.99339,7.9989],[44.19222,8.93028],[43.32613,9.59205],[43.23518,9.84605],[43.0937,9.90579],[42.87643,10.18441],[42.69452,10.62672],[42.95776,10.98533],[42.79037,10.98493],[42.75111,11.06992],[42.62989,11.09711],[42.42669,10.98493],[42.13691,10.97586],[42.06302,10.92599],[41.80056,10.97127],[41.8096,11.33606],[41.77727,11.49902],[41.82878,11.72361],[41.95461,11.81157],[42.4037,12.46478]]]]}},{type:"Feature",properties:{iso1A2:"EU",iso1A3:"EUE",wikidata:"Q458",nameEn:"European Union",level:"union",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"FI",iso1A3:"FIN",iso1N3:"246",wikidata:"Q33",nameEn:"Finland",aliases:["SF"]},geometry:null},{type:"Feature",properties:{iso1A2:"FJ",iso1A3:"FJI",iso1N3:"242",wikidata:"Q712",nameEn:"Fiji",groups:["054","009","UN"],driveSide:"left",callingCodes:["679"]},geometry:{type:"MultiPolygon",coordinates:[[[[174.245,-23.1974],[179.99999,-22.5],[179.99999,-11.5],[174,-11.5],[174.245,-23.1974]]],[[[-176.76826,-14.95183],[-180,-14.96041],[-180,-22.90585],[-176.74538,-22.89767],[-176.76826,-14.95183]]]]}},{type:"Feature",properties:{iso1A2:"FK",iso1A3:"FLK",iso1N3:"238",wikidata:"Q9648",nameEn:"Falkland Islands",country:"GB",groups:["BOTS","005","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["500"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.67376,-55.11859],[-54.56126,-51.26248],[-61.26735,-50.63919],[-63.67376,-55.11859]]]]}},{type:"Feature",properties:{iso1A2:"FM",iso1A3:"FSM",iso1N3:"583",wikidata:"Q702",nameEn:"Federated States of Micronesia",groups:["057","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["691"]},geometry:{type:"MultiPolygon",coordinates:[[[[138.20583,13.3783],[136.27107,6.73747],[156.88247,-1.39237],[165.19726,6.22546],[138.20583,13.3783]]]]}},{type:"Feature",properties:{iso1A2:"FO",iso1A3:"FRO",iso1N3:"234",wikidata:"Q4628",nameEn:"Faroe Islands",country:"DK",groups:["154","150","UN"],callingCodes:["298"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.51774,62.35338],[-6.51083,60.95272],[-5.70102,62.77194],[-8.51774,62.35338]]]]}},{type:"Feature",properties:{iso1A2:"FR",iso1A3:"FRA",iso1N3:"250",wikidata:"Q142",nameEn:"France"},geometry:null},{type:"Feature",properties:{iso1A2:"FX",iso1A3:"FXX",iso1N3:"249",wikidata:"Q212429",nameEn:"Metropolitan France",country:"FR",groups:["EU","155","150","UN"],isoStatus:"excRes",callingCodes:["33"]},geometry:{type:"MultiPolygon",coordinates:[[[[2.55904,51.07014],[2.18458,51.52087],[1.17405,50.74239],[-2.02963,49.91866],[-2.09454,49.46288],[-1.83944,49.23037],[-2.00491,48.86706],[-2.65349,49.15373],[-6.28985,48.93406],[-1.81005,43.59738],[-1.77289,43.38957],[-1.79319,43.37497],[-1.78332,43.36399],[-1.78714,43.35476],[-1.77068,43.34396],[-1.75334,43.34107],[-1.75079,43.3317],[-1.7397,43.32979],[-1.73074,43.29481],[-1.69407,43.31378],[-1.62481,43.30726],[-1.63052,43.28591],[-1.61341,43.25269],[-1.57674,43.25269],[-1.55963,43.28828],[-1.50992,43.29481],[-1.45289,43.27049],[-1.40942,43.27272],[-1.3758,43.24511],[-1.41562,43.12815],[-1.47555,43.08372],[-1.44067,43.047],[-1.35272,43.02658],[-1.34419,43.09665],[-1.32209,43.1127],[-1.27118,43.11961],[-1.30052,43.09581],[-1.30531,43.06859],[-1.25244,43.04164],[-1.22881,43.05534],[-1.10333,43.0059],[-1.00963,42.99279],[-.97133,42.96239],[-.81652,42.95166],[-.75478,42.96916],[-.72037,42.92541],[-.73422,42.91228],[-.72608,42.89318],[-.69837,42.87945],[-.67637,42.88303],[-.55497,42.77846],[-.50863,42.82713],[-.44334,42.79939],[-.41319,42.80776],[-.38833,42.80132],[-.3122,42.84788],[-.17939,42.78974],[-.16141,42.79535],[-.10519,42.72761],[-.02468,42.68513],[.17569,42.73424],[.25336,42.7174],[.29407,42.67431],[.36251,42.72282],[.40214,42.69779],[.67873,42.69458],[.65421,42.75872],[.66121,42.84021],[.711,42.86372],[.93089,42.79154],[.96166,42.80629],[.98292,42.78754],[1.0804,42.78569],[1.15928,42.71407],[1.35562,42.71944],[1.44197,42.60217],[1.47986,42.61346],[1.46718,42.63296],[1.48043,42.65203],[1.50867,42.64483],[1.55418,42.65669],[1.60085,42.62703],[1.63485,42.62957],[1.6625,42.61982],[1.68267,42.62533],[1.73452,42.61515],[1.72588,42.59098],[1.7858,42.57698],[1.73683,42.55492],[1.72515,42.50338],[1.76335,42.48863],[1.83037,42.48395],[1.88853,42.4501],[1.93663,42.45439],[1.94292,42.44316],[1.94061,42.43333],[1.94084,42.43039],[1.9574,42.42401],[1.96482,42.37787],[2.00488,42.35399],[2.06241,42.35906],[2.11621,42.38393],[2.12789,42.41291],[2.16599,42.42314],[2.20578,42.41633],[2.25551,42.43757],[2.38504,42.39977],[2.43299,42.39423],[2.43508,42.37568],[2.48457,42.33933],[2.54382,42.33406],[2.55516,42.35351],[2.57934,42.35808],[2.6747,42.33974],[2.65311,42.38771],[2.72056,42.42298],[2.75497,42.42578],[2.77464,42.41046],[2.84335,42.45724],[2.85675,42.45444],[2.86983,42.46843],[2.88413,42.45938],[2.92107,42.4573],[2.94283,42.48174],[2.96518,42.46692],[3.03734,42.47363],[3.08167,42.42748],[3.10027,42.42621],[3.11379,42.43646],[3.17156,42.43545],[3.75438,42.33445],[7.60802,41.05927],[10.09675,41.44089],[9.56115,43.20816],[7.50102,43.51859],[7.42422,43.72209],[7.40903,43.7296],[7.41113,43.73156],[7.41291,43.73168],[7.41298,43.73311],[7.41233,43.73439],[7.42062,43.73977],[7.42299,43.74176],[7.42443,43.74087],[7.42809,43.74396],[7.43013,43.74895],[7.43624,43.75014],[7.43708,43.75197],[7.4389,43.75151],[7.4379,43.74963],[7.47823,43.73341],[7.53006,43.78405],[7.50423,43.84345],[7.49355,43.86551],[7.51162,43.88301],[7.56075,43.89932],[7.56858,43.94506],[7.60771,43.95772],[7.65266,43.9763],[7.66848,43.99943],[7.6597,44.03009],[7.72508,44.07578],[7.66878,44.12795],[7.68694,44.17487],[7.63245,44.17877],[7.62155,44.14881],[7.36364,44.11882],[7.34547,44.14359],[7.27827,44.1462],[7.16929,44.20352],[7.00764,44.23736],[6.98221,44.28289],[6.89171,44.36637],[6.88784,44.42043],[6.94504,44.43112],[6.86233,44.49834],[6.85507,44.53072],[6.96042,44.62129],[6.95133,44.66264],[7.00582,44.69364],[7.07484,44.68073],[7.00401,44.78782],[7.02217,44.82519],[6.93499,44.8664],[6.90774,44.84322],[6.75518,44.89915],[6.74519,44.93661],[6.74791,45.01939],[6.66981,45.02324],[6.62803,45.11175],[6.7697,45.16044],[6.85144,45.13226],[6.96706,45.20841],[7.07074,45.21228],[7.13115,45.25386],[7.10572,45.32924],[7.18019,45.40071],[7.00037,45.509],[6.98948,45.63869],[6.80785,45.71864],[6.80785,45.83265],[6.95315,45.85163],[7.04151,45.92435],[7.00946,45.9944],[6.93862,46.06502],[6.87868,46.03855],[6.89321,46.12548],[6.78968,46.14058],[6.86052,46.28512],[6.77152,46.34784],[6.8024,46.39171],[6.82312,46.42661],[6.53358,46.45431],[6.25432,46.3632],[6.21981,46.31304],[6.24826,46.30175],[6.25137,46.29014],[6.23775,46.27822],[6.24952,46.26255],[6.26749,46.24745],[6.29474,46.26221],[6.31041,46.24417],[6.29663,46.22688],[6.27694,46.21566],[6.26007,46.21165],[6.24821,46.20531],[6.23913,46.20511],[6.23544,46.20714],[6.22175,46.20045],[6.22222,46.19888],[6.21844,46.19837],[6.21603,46.19507],[6.21273,46.19409],[6.21114,46.1927],[6.20539,46.19163],[6.19807,46.18369],[6.19552,46.18401],[6.18707,46.17999],[6.18871,46.16644],[6.18116,46.16187],[6.15305,46.15194],[6.13397,46.1406],[6.09926,46.14373],[6.09199,46.15191],[6.07491,46.14879],[6.05203,46.15191],[6.04564,46.14031],[6.03614,46.13712],[6.01791,46.14228],[5.9871,46.14499],[5.97893,46.13303],[5.95781,46.12925],[5.9641,46.14412],[5.97508,46.15863],[5.98188,46.17392],[5.98846,46.17046],[5.99573,46.18587],[5.96515,46.19638],[5.97542,46.21525],[6.02461,46.23313],[6.03342,46.2383],[6.04602,46.23127],[6.05029,46.23518],[6.0633,46.24583],[6.07072,46.24085],[6.08563,46.24651],[6.10071,46.23772],[6.12446,46.25059],[6.11926,46.2634],[6.1013,46.28512],[6.11697,46.29547],[6.1198,46.31157],[6.13876,46.33844],[6.15738,46.3491],[6.16987,46.36759],[6.15985,46.37721],[6.15016,46.3778],[6.09926,46.40768],[6.06407,46.41676],[6.08427,46.44305],[6.07269,46.46244],[6.1567,46.54402],[6.11084,46.57649],[6.27135,46.68251],[6.38351,46.73171],[6.45209,46.77502],[6.43216,46.80336],[6.46456,46.88865],[6.43341,46.92703],[6.71531,47.0494],[6.68823,47.06616],[6.76788,47.1208],[6.8489,47.15933],[6.9508,47.24338],[6.95108,47.26428],[6.94316,47.28747],[7.05305,47.33304],[7.0564,47.35134],[7.03125,47.36996],[6.87959,47.35335],[6.88542,47.37262],[6.93744,47.40714],[6.93953,47.43388],[7.0024,47.45264],[6.98425,47.49432],[7.0231,47.50522],[7.07425,47.48863],[7.12781,47.50371],[7.16249,47.49025],[7.19583,47.49455],[7.17026,47.44312],[7.24669,47.4205],[7.33526,47.44186],[7.35603,47.43432],[7.40308,47.43638],[7.43088,47.45846],[7.4462,47.46264],[7.4583,47.47216],[7.42923,47.48628],[7.43356,47.49712],[7.47534,47.47932],[7.51076,47.49651],[7.49804,47.51798],[7.5229,47.51644],[7.53199,47.5284],[7.51904,47.53515],[7.50588,47.52856],[7.49691,47.53821],[7.50873,47.54546],[7.51723,47.54578],[7.52831,47.55347],[7.53634,47.55553],[7.55652,47.56779],[7.55689,47.57232],[7.56548,47.57617],[7.56684,47.57785],[7.58386,47.57536],[7.58945,47.59017],[7.59301,47.60058],[7.58851,47.60794],[7.57423,47.61628],[7.5591,47.63849],[7.53384,47.65115],[7.52067,47.66437],[7.51915,47.68335],[7.51266,47.70197],[7.53722,47.71635],[7.54761,47.72912],[7.52921,47.77747],[7.55673,47.87371],[7.62302,47.97898],[7.56966,48.03265],[7.57137,48.12292],[7.6648,48.22219],[7.69022,48.30018],[7.74562,48.32736],[7.73109,48.39192],[7.76833,48.48945],[7.80647,48.51239],[7.80167,48.54758],[7.80057,48.5857],[7.84098,48.64217],[7.89002,48.66317],[7.96812,48.72491],[7.96994,48.75606],[8.01534,48.76085],[8.0326,48.79017],[8.06802,48.78957],[8.10253,48.81829],[8.12813,48.87985],[8.19989,48.95825],[8.20031,48.95856],[8.22604,48.97352],[8.14189,48.97833],[7.97783,49.03161],[7.93641,49.05544],[7.86386,49.03499],[7.79557,49.06583],[7.75948,49.04562],[7.63618,49.05428],[7.62575,49.07654],[7.56416,49.08136],[7.53012,49.09818],[7.49172,49.13915],[7.49473,49.17],[7.44455,49.16765],[7.44052,49.18354],[7.3662,49.17308],[7.35995,49.14399],[7.3195,49.14231],[7.29514,49.11426],[7.23473,49.12971],[7.1593,49.1204],[7.1358,49.1282],[7.12504,49.14253],[7.10384,49.13787],[7.10715,49.15631],[7.07859,49.15031],[7.09007,49.13094],[7.07162,49.1255],[7.06642,49.11415],[7.05548,49.11185],[7.04843,49.11422],[7.04409,49.12123],[7.04662,49.13724],[7.03178,49.15734],[7.0274,49.17042],[7.03459,49.19096],[7.01318,49.19018],[6.97273,49.2099],[6.95963,49.203],[6.94028,49.21641],[6.93831,49.2223],[6.91875,49.22261],[6.89298,49.20863],[6.85939,49.22376],[6.83555,49.21249],[6.85119,49.20038],[6.85016,49.19354],[6.86225,49.18185],[6.84703,49.15734],[6.83385,49.15162],[6.78265,49.16793],[6.73765,49.16375],[6.71137,49.18808],[6.73256,49.20486],[6.71843,49.2208],[6.69274,49.21661],[6.66583,49.28065],[6.60186,49.31055],[6.572,49.35027],[6.58807,49.35358],[6.60091,49.36864],[6.533,49.40748],[6.55404,49.42464],[6.42432,49.47683],[6.40274,49.46546],[6.39168,49.4667],[6.38352,49.46463],[6.36778,49.46937],[6.3687,49.4593],[6.28818,49.48465],[6.27875,49.503],[6.25029,49.50609],[6.2409,49.51408],[6.19543,49.50536],[6.17386,49.50934],[6.15366,49.50226],[6.16115,49.49297],[6.14321,49.48796],[6.12814,49.49365],[6.12346,49.4735],[6.10325,49.4707],[6.09845,49.46351],[6.10072,49.45268],[6.08373,49.45594],[6.07887,49.46399],[6.05553,49.46663],[6.04176,49.44801],[6.02743,49.44845],[6.02648,49.45451],[5.97693,49.45513],[5.96876,49.49053],[5.94224,49.49608],[5.94128,49.50034],[5.86571,49.50015],[5.83389,49.52152],[5.83467,49.52717],[5.84466,49.53027],[5.83648,49.5425],[5.81664,49.53775],[5.80871,49.5425],[5.81838,49.54777],[5.79195,49.55228],[5.77435,49.56298],[5.7577,49.55915],[5.75649,49.54321],[5.64505,49.55146],[5.60909,49.51228],[5.55001,49.52729],[5.46541,49.49825],[5.46734,49.52648],[5.43713,49.5707],[5.3974,49.61596],[5.34837,49.62889],[5.33851,49.61599],[5.3137,49.61225],[5.30214,49.63055],[5.33039,49.6555],[5.31465,49.66846],[5.26232,49.69456],[5.14545,49.70287],[5.09249,49.76193],[4.96714,49.79872],[4.85464,49.78995],[4.86965,49.82271],[4.85134,49.86457],[4.88529,49.9236],[4.78827,49.95609],[4.8382,50.06738],[4.88602,50.15182],[4.83279,50.15331],[4.82438,50.16878],[4.75237,50.11314],[4.70064,50.09384],[4.68695,49.99685],[4.5414,49.96911],[4.51098,49.94659],[4.43488,49.94122],[4.35051,49.95315],[4.31963,49.97043],[4.20532,49.95803],[4.14239,49.98034],[4.13508,50.01976],[4.16294,50.04719],[4.23101,50.06945],[4.20147,50.13535],[4.13561,50.13078],[4.16014,50.19239],[4.15524,50.21103],[4.21945,50.25539],[4.20651,50.27333],[4.17861,50.27443],[4.17347,50.28838],[4.15524,50.2833],[4.16808,50.25786],[4.13665,50.25609],[4.11954,50.30425],[4.10957,50.30234],[4.10237,50.31247],[4.0689,50.3254],[4.0268,50.35793],[3.96771,50.34989],[3.90781,50.32814],[3.84314,50.35219],[3.73911,50.34809],[3.70987,50.3191],[3.71009,50.30305],[3.66976,50.34563],[3.65709,50.36873],[3.67262,50.38663],[3.67494,50.40239],[3.66153,50.45165],[3.64426,50.46275],[3.61014,50.49568],[3.58361,50.49049],[3.5683,50.50192],[3.49509,50.48885],[3.51564,50.5256],[3.47385,50.53397],[3.44629,50.51009],[3.37693,50.49538],[3.28575,50.52724],[3.2729,50.60718],[3.23951,50.6585],[3.264,50.67668],[3.2536,50.68977],[3.26141,50.69151],[3.26063,50.70086],[3.24593,50.71389],[3.22042,50.71019],[3.20845,50.71662],[3.19017,50.72569],[3.20064,50.73547],[3.18811,50.74025],[3.18339,50.74981],[3.16476,50.76843],[3.15017,50.79031],[3.1257,50.78603],[3.11987,50.79188],[3.11206,50.79416],[3.10614,50.78303],[3.09163,50.77717],[3.04314,50.77674],[3.00537,50.76588],[2.96778,50.75242],[2.95019,50.75138],[2.90873,50.702],[2.91036,50.6939],[2.90069,50.69263],[2.88504,50.70656],[2.87937,50.70298],[2.86985,50.7033],[2.8483,50.72276],[2.81056,50.71773],[2.71165,50.81295],[2.63331,50.81457],[2.59093,50.91751],[2.63074,50.94746],[2.57551,51.00326],[2.55904,51.07014]],[[1.99838,42.44682],[1.98378,42.44697],[1.96125,42.45364],[1.95606,42.45785],[1.96215,42.47854],[1.97003,42.48081],[1.97227,42.48487],[1.97697,42.48568],[1.98022,42.49569],[1.98916,42.49351],[1.99766,42.4858],[1.98579,42.47486],[1.99216,42.46208],[2.01564,42.45171],[1.99838,42.44682]]]]}},{type:"Feature",properties:{iso1A2:"GA",iso1A3:"GAB",iso1N3:"266",wikidata:"Q1000",nameEn:"Gabon",groups:["017","202","002","UN"],callingCodes:["241"]},geometry:{type:"MultiPolygon",coordinates:[[[[13.29457,2.16106],[13.28534,2.25716],[11.37116,2.29975],[11.3561,2.17217],[11.35307,1.00251],[9.79648,1.0019],[9.75065,1.06753],[9.66433,1.06723],[7.24416,-.64092],[10.75913,-4.39519],[11.12647,-3.94169],[11.22301,-3.69888],[11.48764,-3.51089],[11.57949,-3.52798],[11.68608,-3.68942],[11.87083,-3.71571],[11.92719,-3.62768],[11.8318,-3.5812],[11.96554,-3.30267],[11.70227,-3.17465],[11.70558,-3.0773],[11.80365,-3.00424],[11.64798,-2.81146],[11.5359,-2.85654],[11.64487,-2.61865],[11.57637,-2.33379],[11.74605,-2.39936],[11.96866,-2.33559],[12.04895,-2.41704],[12.47925,-2.32626],[12.44656,-1.92025],[12.61312,-1.8129],[12.82172,-1.91091],[13.02759,-2.33098],[13.47977,-2.43224],[13.75884,-2.09293],[13.92073,-2.35581],[13.85846,-2.46935],[14.10442,-2.49268],[14.23829,-2.33715],[14.16202,-2.23916],[14.23518,-2.15671],[14.25932,-1.97624],[14.41838,-1.89412],[14.52569,-.57818],[14.41887,-.44799],[14.2165,-.38261],[14.06862,-.20826],[13.90632,-.2287],[13.88648,.26652],[14.10909,.58563],[14.26066,.57255],[14.48179,.9152],[14.25186,1.39842],[13.89582,1.4261],[13.15519,1.23368],[13.25447,1.32339],[13.13461,1.57238],[13.29457,2.16106]]]]}},{type:"Feature",properties:{iso1A2:"GB",iso1A3:"GBR",iso1N3:"826",wikidata:"Q145",ccTLD:".uk",nameEn:"United Kingdom",aliases:["UK"]},geometry:null},{type:"Feature",properties:{iso1A2:"GD",iso1A3:"GRD",iso1N3:"308",wikidata:"Q769",nameEn:"Grenada",aliases:["WG"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 473"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.64026,12.69984],[-61.77886,11.36496],[-59.94058,12.34011],[-62.64026,12.69984]]]]}},{type:"Feature",properties:{iso1A2:"GE",iso1A3:"GEO",iso1N3:"268",wikidata:"Q230",nameEn:"Georgia",groups:["145","142","UN"],callingCodes:["995"]},geometry:{type:"MultiPolygon",coordinates:[[[[46.42738,41.91323],[45.61676,42.20768],[45.78692,42.48358],[45.36501,42.55268],[45.15318,42.70598],[44.88754,42.74934],[44.80941,42.61277],[44.70002,42.74679],[44.54202,42.75699],[43.95517,42.55396],[43.73119,42.62043],[43.81453,42.74297],[43.0419,43.02413],[43.03322,43.08883],[42.75889,43.19651],[42.66667,43.13917],[42.40563,43.23226],[41.64935,43.22331],[40.65957,43.56212],[40.10657,43.57344],[40.04445,43.47776],[40.03312,43.44262],[40.01007,43.42411],[40.01552,43.42025],[40.00853,43.40578],[40.0078,43.38551],[39.81147,43.06294],[40.89217,41.72528],[41.54366,41.52185],[41.7148,41.4932],[41.7124,41.47417],[41.81939,41.43621],[41.95134,41.52466],[42.26387,41.49346],[42.51772,41.43606],[42.59202,41.58183],[42.72794,41.59714],[42.84471,41.58912],[42.78995,41.50126],[42.84899,41.47265],[42.8785,41.50516],[43.02956,41.37891],[43.21707,41.30331],[43.13373,41.25503],[43.1945,41.25242],[43.23096,41.17536],[43.36118,41.2028],[43.44973,41.17666],[43.4717,41.12611],[43.67712,41.13398],[43.74717,41.1117],[43.84835,41.16329],[44.16591,41.19141],[44.18148,41.24644],[44.32139,41.2079],[44.34337,41.20312],[44.34417,41.2382],[44.46791,41.18204],[44.59322,41.1933],[44.61462,41.24018],[44.72814,41.20338],[44.82084,41.21513],[44.87887,41.20195],[44.89911,41.21366],[44.84358,41.23088],[44.81749,41.23488],[44.80053,41.25949],[44.81437,41.30371],[44.93493,41.25685],[45.0133,41.29747],[45.09867,41.34065],[45.1797,41.42231],[45.26285,41.46433],[45.31352,41.47168],[45.4006,41.42402],[45.45973,41.45898],[45.68389,41.3539],[45.71035,41.36208],[45.75705,41.35157],[45.69946,41.29545],[45.80842,41.2229],[45.95786,41.17956],[46.13221,41.19479],[46.27698,41.19011],[46.37661,41.10805],[46.456,41.09984],[46.48558,41.0576],[46.55096,41.1104],[46.63969,41.09515],[46.66148,41.20533],[46.72375,41.28609],[46.63658,41.37727],[46.4669,41.43331],[46.40307,41.48464],[46.33925,41.4963],[46.29794,41.5724],[46.34126,41.57454],[46.34039,41.5947],[46.3253,41.60912],[46.28182,41.60089],[46.26531,41.63339],[46.24429,41.59883],[46.19759,41.62327],[46.17891,41.72094],[46.20538,41.77205],[46.23962,41.75811],[46.30863,41.79133],[46.3984,41.84399],[46.42738,41.91323]]]]}},{type:"Feature",properties:{iso1A2:"GF",iso1A3:"GUF",iso1N3:"254",wikidata:"Q3769",nameEn:"French Guiana",country:"FR",groups:["Q3320166","EU","005","419","019","UN"],callingCodes:["594"]},geometry:{type:"MultiPolygon",coordinates:[[[[-51.35485,4.8383],[-53.7094,6.2264],[-54.01074,5.68785],[-54.01877,5.52789],[-54.26916,5.26909],[-54.4717,4.91964],[-54.38444,4.13222],[-54.19367,3.84387],[-54.05128,3.63557],[-53.98914,3.627],[-53.9849,3.58697],[-54.28534,2.67798],[-54.42864,2.42442],[-54.6084,2.32856],[-54.16286,2.10779],[-53.78743,2.34412],[-52.96539,2.1881],[-52.6906,2.37298],[-52.31787,3.17896],[-51.85573,3.83427],[-51.82312,3.85825],[-51.79599,3.89336],[-51.61983,4.14596],[-51.63798,4.51394],[-51.35485,4.8383]]]]}},{type:"Feature",properties:{iso1A2:"GG",iso1A3:"GGY",iso1N3:"831",wikidata:"Q25230",nameEn:"Bailiwick of Guernsey",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"GH",iso1A3:"GHA",iso1N3:"288",wikidata:"Q117",nameEn:"Ghana",groups:["011","202","002","UN"],callingCodes:["233"]},geometry:{type:"MultiPolygon",coordinates:[[[[-.13493,11.14075],[-.27374,11.17157],[-.28566,11.12713],[-.35955,11.07801],[-.38219,11.12596],[-.42391,11.11661],[-.44298,11.04292],[-.61937,10.91305],[-.67143,10.99811],[-2.83373,11.0067],[-2.94232,10.64281],[-2.83108,10.40252],[-2.74174,9.83172],[-2.76534,9.56589],[-2.68802,9.49343],[-2.69814,9.22717],[-2.77799,9.04949],[-2.66357,9.01771],[-2.58243,8.7789],[-2.49037,8.20872],[-2.62901,8.11495],[-2.61232,8.02645],[-2.67787,8.02055],[-2.74819,7.92613],[-2.78395,7.94974],[-2.79467,7.86002],[-2.92339,7.60847],[-2.97822,7.27165],[-2.95438,7.23737],[-3.23327,6.81744],[-3.21954,6.74407],[-3.25999,6.62521],[-3.01896,5.71697],[-2.95323,5.71865],[-2.96671,5.6415],[-2.93132,5.62137],[-2.85378,5.65156],[-2.76614,5.60963],[-2.72737,5.34789],[-2.77625,5.34621],[-2.73074,5.1364],[-2.75502,5.10657],[-2.95261,5.12477],[-2.96554,5.10397],[-3.063,5.13665],[-3.11073,5.12675],[-3.10675,5.08515],[-3.34019,4.17519],[1.07031,5.15655],[1.27574,5.93551],[1.19771,6.11522],[1.19966,6.17069],[1.09187,6.17074],[1.05969,6.22998],[1.03108,6.24064],[.99652,6.33779],[.89283,6.33779],[.71048,6.53083],[.74862,6.56517],[.63659,6.63857],[.6497,6.73682],[.58176,6.76049],[.57406,6.80348],[.52853,6.82921],[.56508,6.92971],[.52098,6.94391],[.52217,6.9723],[.59606,7.01252],[.65327,7.31643],[.62943,7.41099],[.57223,7.39326],[.52455,7.45354],[.51979,7.58706],[.58295,7.62368],[.62943,7.85751],[.58891,8.12779],[.6056,8.13959],[.61156,8.18324],[.5913,8.19622],[.63897,8.25873],[.73432,8.29529],[.64731,8.48866],[.47211,8.59945],[.37319,8.75262],[.52455,8.87746],[.45424,9.04581],[.56388,9.40697],[.49118,9.48339],[.36485,9.49749],[.33148,9.44812],[.25758,9.42696],[.2254,9.47869],[.31241,9.50337],[.30406,9.521],[.2409,9.52335],[.23851,9.57389],[.38153,9.58682],[.36008,9.6256],[.29334,9.59387],[.26712,9.66437],[.28261,9.69022],[.32313,9.6491],[.34816,9.66907],[.34816,9.71607],[.32075,9.72781],[.36366,10.03309],[.41252,10.02018],[.41371,10.06361],[.35293,10.09412],[.39584,10.31112],[.33028,10.30408],[.29453,10.41546],[.18846,10.4096],[.12886,10.53149],[-.05945,10.63458],[-.09141,10.7147],[-.07327,10.71845],[-.07183,10.76794],[-.0228,10.81916],[-.02685,10.8783],[-.00908,10.91644],[-.0063,10.96417],[.03355,10.9807],[.02395,11.06229],[.00342,11.08317],[-.00514,11.10763],[-.0275,11.11202],[-.05733,11.08628],[-.14462,11.10811],[-.13493,11.14075]]]]}},{type:"Feature",properties:{iso1A2:"GI",iso1A3:"GIB",iso1N3:"292",wikidata:"Q1410",nameEn:"Gibraltar",country:"GB",groups:["Q12837","BOTS","039","150","UN"],callingCodes:["350"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.34064,36.03744],[-5.27801,36.14942],[-5.33822,36.15272],[-5.34536,36.15501],[-5.40526,36.15488],[-5.34064,36.03744]]]]}},{type:"Feature",properties:{iso1A2:"GL",iso1A3:"GRL",iso1N3:"304",wikidata:"Q223",nameEn:"Greenland",country:"DK",groups:["Q1451600","021","003","019","UN"],callingCodes:["299"]},geometry:{type:"MultiPolygon",coordinates:[[[[-49.33696,84.57952],[-68.21821,80.48551],[-77.52957,77.23408],[-46.37635,57.3249],[-9.68082,72.73731],[-5.7106,84.28058],[-49.33696,84.57952]]]]}},{type:"Feature",properties:{iso1A2:"GM",iso1A3:"GMB",iso1N3:"270",wikidata:"Q1005",nameEn:"The Gambia",groups:["011","202","002","UN"],callingCodes:["220"]},geometry:{type:"MultiPolygon",coordinates:[[[[-15.14917,13.57989],[-14.36795,13.23033],[-13.79409,13.34472],[-13.8955,13.59126],[-14.34721,13.46578],[-14.93719,13.80173],[-15.36504,13.79313],[-15.47902,13.58758],[-17.43598,13.59273],[-17.43966,13.04579],[-16.74676,13.06025],[-16.69343,13.16791],[-15.80355,13.16729],[-15.80478,13.34832],[-15.26908,13.37768],[-15.14917,13.57989]]]]}},{type:"Feature",properties:{iso1A2:"GN",iso1A3:"GIN",iso1N3:"324",wikidata:"Q1006",nameEn:"Guinea",groups:["011","202","002","UN"],callingCodes:["224"]},geometry:{type:"MultiPolygon",coordinates:[[[[-11.37536,12.40788],[-11.46267,12.44559],[-11.91331,12.42008],[-12.35415,12.32758],[-12.87336,12.51892],[-13.06603,12.49342],[-13.05296,12.64003],[-13.70523,12.68013],[-13.7039,12.60313],[-13.65089,12.49515],[-13.64168,12.42764],[-13.70851,12.24978],[-13.92745,12.24077],[-13.94589,12.16869],[-13.7039,12.00869],[-13.7039,11.70195],[-14.09799,11.63649],[-14.26623,11.67486],[-14.31513,11.60713],[-14.51173,11.49708],[-14.66677,11.51188],[-14.77786,11.36323],[-14.95993,10.99244],[-15.07174,10.89557],[-15.96748,10.162],[-14.36218,8.64107],[-13.29911,9.04245],[-13.18586,9.0925],[-13.08953,9.0409],[-12.94095,9.26335],[-12.76788,9.3133],[-12.47254,9.86834],[-12.24262,9.92386],[-12.12634,9.87203],[-11.91023,9.93927],[-11.89624,9.99763],[-11.2118,10.00098],[-10.6534,9.29919],[-10.74484,9.07998],[-10.5783,9.06386],[-10.56197,8.81225],[-10.47707,8.67669],[-10.61422,8.5314],[-10.70565,8.29235],[-10.63934,8.35326],[-10.54891,8.31174],[-10.37257,8.48941],[-10.27575,8.48711],[-10.203,8.47991],[-10.14579,8.52665],[-10.05375,8.50697],[-10.05873,8.42578],[-9.77763,8.54633],[-9.47415,8.35195],[-9.50898,8.18455],[-9.41445,8.02448],[-9.44928,7.9284],[-9.35724,7.74111],[-9.37465,7.62032],[-9.48161,7.37122],[-9.41943,7.41809],[-9.305,7.42056],[-9.20798,7.38109],[-9.18311,7.30461],[-9.09107,7.1985],[-8.93435,7.2824],[-8.85724,7.26019],[-8.8448,7.35149],[-8.72789,7.51429],[-8.67814,7.69428],[-8.55874,7.70167],[-8.55874,7.62525],[-8.47114,7.55676],[-8.4003,7.6285],[-8.21374,7.54466],[-8.09931,7.78626],[-8.13414,7.87991],[-8.06449,8.04989],[-7.94695,8.00925],[-7.99919,8.11023],[-7.98675,8.20134],[-8.062,8.16071],[-8.2411,8.24196],[-8.22991,8.48438],[-7.92518,8.50652],[-7.65653,8.36873],[-7.69882,8.66148],[-7.95503,8.81146],[-7.92518,8.99332],[-7.73862,9.08422],[-7.90777,9.20456],[-7.85056,9.41812],[-8.03463,9.39604],[-8.14657,9.55062],[-8.09434,9.86936],[-8.15652,9.94288],[-8.11921,10.04577],[-8.01225,10.1021],[-7.97971,10.17117],[-7.9578,10.2703],[-8.10207,10.44649],[-8.22711,10.41722],[-8.32614,10.69273],[-8.2667,10.91762],[-8.35083,11.06234],[-8.66923,10.99397],[-8.40058,11.37466],[-8.80854,11.66715],[-8.94784,12.34842],[-9.13689,12.50875],[-9.38067,12.48446],[-9.32097,12.29009],[-9.63938,12.18312],[-9.714,12.0226],[-10.30604,12.24634],[-10.71897,11.91552],[-10.80355,12.1053],[-10.99758,12.24634],[-11.24136,12.01286],[-11.50006,12.17826],[-11.37536,12.40788]]]]}},{type:"Feature",properties:{iso1A2:"GP",iso1A3:"GLP",iso1N3:"312",wikidata:"Q17012",nameEn:"Guadeloupe",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-60.03183,16.1129],[-61.60296,16.73066],[-63.00549,15.26166],[-60.03183,16.1129]]]]}},{type:"Feature",properties:{iso1A2:"GQ",iso1A3:"GNQ",iso1N3:"226",wikidata:"Q983",nameEn:"Equatorial Guinea",groups:["017","202","002","UN"],callingCodes:["240"]},geometry:{type:"MultiPolygon",coordinates:[[[[9.22018,3.72052],[8.34397,4.30689],[7.71762,.6674],[3.35016,-3.29031],[9.66433,1.06723],[9.75065,1.06753],[9.79648,1.0019],[11.35307,1.00251],[11.3561,2.17217],[9.991,2.16561],[9.90749,2.20049],[9.89012,2.20457],[9.84716,2.24676],[9.83238,2.29079],[9.83754,2.32428],[9.82123,2.35097],[9.81162,2.33797],[9.22018,3.72052]]]]}},{type:"Feature",properties:{iso1A2:"GR",iso1A3:"GRC",iso1N3:"300",wikidata:"Q41",nameEn:"Greece",aliases:["EL"],groups:["EU","039","150","UN"],callingCodes:["30"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.03489,40.73051],[26.0754,40.72772],[26.08638,40.73214],[26.12495,40.74283],[26.12854,40.77339],[26.15685,40.80709],[26.21351,40.83298],[26.20856,40.86048],[26.26169,40.9168],[26.29441,40.89119],[26.28623,40.93005],[26.32259,40.94042],[26.35894,40.94292],[26.33297,40.98388],[26.3606,41.02027],[26.31928,41.07386],[26.32259,41.24929],[26.39861,41.25053],[26.5209,41.33993],[26.5837,41.32131],[26.62997,41.34613],[26.61767,41.42281],[26.59742,41.48058],[26.59196,41.60491],[26.5209,41.62592],[26.47958,41.67037],[26.35957,41.71149],[26.30255,41.70925],[26.2654,41.71544],[26.22888,41.74139],[26.21325,41.73223],[26.16841,41.74858],[26.06148,41.70345],[26.07083,41.64584],[26.15146,41.60828],[26.14328,41.55496],[26.17951,41.55409],[26.176,41.50072],[26.14796,41.47533],[26.20288,41.43943],[26.16548,41.42278],[26.12926,41.35878],[25.87919,41.30526],[25.8266,41.34563],[25.70507,41.29209],[25.66183,41.31316],[25.61042,41.30614],[25.55082,41.31667],[25.52394,41.2798],[25.48187,41.28506],[25.28322,41.23411],[25.11611,41.34212],[24.942,41.38685],[24.90928,41.40876],[24.86136,41.39298],[24.82514,41.4035],[24.8041,41.34913],[24.71529,41.41928],[24.61129,41.42278],[24.52599,41.56808],[24.30513,41.51297],[24.27124,41.57682],[24.18126,41.51735],[24.10063,41.54796],[24.06323,41.53222],[24.06908,41.46132],[23.96975,41.44118],[23.91483,41.47971],[23.89613,41.45257],[23.80148,41.43943],[23.76525,41.40175],[23.67644,41.41139],[23.63203,41.37632],[23.52453,41.40262],[23.40416,41.39999],[23.33639,41.36317],[23.31301,41.40525],[23.22771,41.37106],[23.21953,41.33773],[23.1833,41.31755],[22.93334,41.34104],[22.81199,41.3398],[22.76408,41.32225],[22.74538,41.16321],[22.71266,41.13945],[22.65306,41.18168],[22.62852,41.14385],[22.58295,41.11568],[22.5549,41.13065],[22.42285,41.11921],[22.26744,41.16409],[22.17629,41.15969],[22.1424,41.12449],[22.06527,41.15617],[21.90869,41.09191],[21.91102,41.04786],[21.7556,40.92525],[21.69601,40.9429],[21.57448,40.86076],[21.53007,40.90759],[21.41555,40.9173],[21.35595,40.87578],[21.25779,40.86165],[21.21105,40.8855],[21.15262,40.85546],[20.97887,40.85475],[20.98396,40.79109],[20.95752,40.76982],[20.98134,40.76046],[21.05833,40.66586],[21.03932,40.56299],[20.96908,40.51526],[20.94925,40.46625],[20.83688,40.47882],[20.7906,40.42726],[20.78234,40.35803],[20.71789,40.27739],[20.67162,40.09433],[20.62566,40.0897],[20.61081,40.07866],[20.55593,40.06524],[20.51297,40.08168],[20.48487,40.06271],[20.42373,40.06777],[20.37911,39.99058],[20.31135,39.99438],[20.41546,39.82832],[20.41475,39.81437],[20.38572,39.78516],[20.30804,39.81563],[20.29152,39.80421],[20.31961,39.72799],[20.27412,39.69884],[20.22707,39.67459],[20.22376,39.64532],[20.15988,39.652],[20.12956,39.65805],[20.05189,39.69112],[20.00957,39.69227],[19.98042,39.6504],[19.92466,39.69533],[19.97622,39.78684],[19.95905,39.82857],[19.0384,40.35325],[19.20409,39.7532],[22.5213,33.45682],[29.73302,35.92555],[29.69611,36.10365],[29.61805,36.14179],[29.61002,36.1731],[29.48192,36.18377],[29.30783,36.01033],[28.23708,36.56812],[27.95037,36.46155],[27.89482,36.69898],[27.46117,36.53789],[27.24613,36.71622],[27.45627,36.9008],[27.20312,36.94571],[27.14757,37.32],[26.95583,37.64989],[26.99377,37.69034],[27.16428,37.72343],[27.05537,37.9131],[26.21136,38.17558],[26.24183,38.44695],[26.32173,38.48731],[26.21136,38.65436],[26.61814,38.81372],[26.70773,39.0312],[26.43357,39.43096],[25.94257,39.39358],[25.61285,40.17161],[26.04292,40.3958],[25.94795,40.72797],[26.03489,40.73051]]]]}},{type:"Feature",properties:{iso1A2:"GS",iso1A3:"SGS",iso1N3:"239",wikidata:"Q35086",nameEn:"South Georgia and South Sandwich Islands",country:"GB",groups:["BOTS","005","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["500"]},geometry:{type:"MultiPolygon",coordinates:[[[[-35.26394,-43.68272],[-53.39656,-59.87088],[-22.31757,-59.85974],[-35.26394,-43.68272]]]]}},{type:"Feature",properties:{iso1A2:"GT",iso1A3:"GTM",iso1N3:"320",wikidata:"Q774",nameEn:"Guatemala",groups:["013","003","419","019","UN"],callingCodes:["502"]},geometry:{type:"MultiPolygon",coordinates:[[[[-89.14985,17.81563],[-90.98678,17.81655],[-90.99199,17.25192],[-91.43809,17.25373],[-91.04436,16.92175],[-90.69064,16.70697],[-90.61212,16.49832],[-90.40499,16.40524],[-90.44567,16.07573],[-91.73182,16.07371],[-92.20983,15.26077],[-92.0621,15.07406],[-92.1454,14.98143],[-92.1423,14.88647],[-92.18161,14.84147],[-92.1454,14.6804],[-92.2261,14.53423],[-92.37213,14.39277],[-90.55276,12.8866],[-90.11344,13.73679],[-90.10505,13.85104],[-89.88937,14.0396],[-89.81807,14.07073],[-89.76103,14.02923],[-89.73251,14.04133],[-89.75569,14.07073],[-89.70756,14.1537],[-89.61844,14.21937],[-89.52397,14.22628],[-89.50614,14.26084],[-89.58814,14.33165],[-89.57441,14.41637],[-89.39028,14.44561],[-89.34776,14.43013],[-89.35189,14.47553],[-89.23719,14.58046],[-89.15653,14.57802],[-89.13132,14.71582],[-89.23467,14.85596],[-89.15149,14.97775],[-89.18048,14.99967],[-89.15149,15.07392],[-88.97343,15.14039],[-88.32467,15.63665],[-88.31459,15.66942],[-88.24022,15.69247],[-88.22552,15.72294],[-88.20359,16.03858],[-88.40779,16.09624],[-88.95358,15.88698],[-89.02415,15.9063],[-89.17418,15.90898],[-89.22683,15.88619],[-89.15025,17.04813],[-89.14985,17.81563]]]]}},{type:"Feature",properties:{iso1A2:"GU",iso1A3:"GUM",iso1N3:"316",wikidata:"Q16635",nameEn:"Guam",aliases:["US-GU"],country:"US",groups:["Q1352230","Q153732","057","009","UN"],roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 671"]},geometry:{type:"MultiPolygon",coordinates:[[[[146.25931,13.85876],[143.82485,13.92273],[144.61642,12.82462],[146.25931,13.85876]]]]}},{type:"Feature",properties:{iso1A2:"GW",iso1A3:"GNB",iso1N3:"624",wikidata:"Q1007",nameEn:"Guinea-Bissau",groups:["011","202","002","UN"],callingCodes:["245"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.31513,11.60713],[-14.26623,11.67486],[-14.09799,11.63649],[-13.7039,11.70195],[-13.7039,12.00869],[-13.94589,12.16869],[-13.92745,12.24077],[-13.70851,12.24978],[-13.64168,12.42764],[-13.65089,12.49515],[-13.7039,12.60313],[-13.70523,12.68013],[-15.17582,12.6847],[-15.67302,12.42974],[-16.20591,12.46157],[-16.38191,12.36449],[-16.70562,12.34803],[-17.4623,11.92379],[-15.96748,10.162],[-15.07174,10.89557],[-14.95993,10.99244],[-14.77786,11.36323],[-14.66677,11.51188],[-14.51173,11.49708],[-14.31513,11.60713]]]]}},{type:"Feature",properties:{iso1A2:"GY",iso1A3:"GUY",iso1N3:"328",wikidata:"Q734",nameEn:"Guyana",groups:["005","419","019","UN"],driveSide:"left",callingCodes:["592"]},geometry:{type:"MultiPolygon",coordinates:[[[[-56.84822,6.73257],[-59.54058,8.6862],[-59.98508,8.53046],[-59.85562,8.35213],[-59.80661,8.28906],[-59.83156,8.23261],[-59.97059,8.20791],[-60.02407,8.04557],[-60.38056,7.8302],[-60.51959,7.83373],[-60.64793,7.56877],[-60.71923,7.55817],[-60.59802,7.33194],[-60.63367,7.25061],[-60.54098,7.14804],[-60.44116,7.20817],[-60.28074,7.1162],[-60.39419,6.94847],[-60.54873,6.8631],[-61.13632,6.70922],[-61.20762,6.58174],[-61.15058,6.19558],[-61.4041,5.95304],[-60.73204,5.20931],[-60.32352,5.21299],[-60.20944,5.28754],[-59.98129,5.07097],[-60.04189,4.69801],[-60.15953,4.53456],[-59.78878,4.45637],[-59.69361,4.34069],[-59.73353,4.20399],[-59.51963,3.91951],[-59.86899,3.57089],[-59.79769,3.37162],[-59.99733,2.92312],[-59.91177,2.36759],[-59.7264,2.27497],[-59.74066,1.87596],[-59.25583,1.40559],[-58.92072,1.31293],[-58.84229,1.17749],[-58.53571,1.29154],[-58.4858,1.48399],[-58.33887,1.58014],[-58.01873,1.51966],[-57.97336,1.64566],[-57.77281,1.73344],[-57.55743,1.69605],[-57.35073,1.98327],[-57.23981,1.95808],[-57.09109,2.01854],[-57.07092,1.95304],[-56.7659,1.89509],[-56.47045,1.95135],[-56.55439,2.02003],[-56.70519,2.02964],[-57.35891,3.32121],[-58.0307,3.95513],[-57.8699,4.89394],[-57.37442,5.0208],[-57.22536,5.15605],[-57.31629,5.33714],[-56.84822,6.73257]]]]}},{type:"Feature",properties:{iso1A2:"HK",iso1A3:"HKG",iso1N3:"344",wikidata:"Q8646",nameEn:"Hong Kong",country:"CN",groups:["030","142","UN"],driveSide:"left",callingCodes:["852"]},geometry:{type:"MultiPolygon",coordinates:[[[[113.92195,22.13873],[114.50148,22.15017],[114.44998,22.55977],[114.25154,22.55977],[114.22888,22.5436],[114.22185,22.55343],[114.20655,22.55706],[114.18338,22.55444],[114.17247,22.55944],[114.1597,22.56041],[114.15123,22.55163],[114.1482,22.54091],[114.13823,22.54319],[114.12665,22.54003],[114.11656,22.53415],[114.11181,22.52878],[114.1034,22.5352],[114.09692,22.53435],[114.09048,22.53716],[114.08606,22.53276],[114.07817,22.52997],[114.07267,22.51855],[114.06272,22.51617],[114.05729,22.51104],[114.05438,22.5026],[114.03113,22.5065],[113.86771,22.42972],[113.81621,22.2163],[113.83338,22.1826],[113.92195,22.13873]]]]}},{type:"Feature",properties:{iso1A2:"HM",iso1A3:"HMD",iso1N3:"334",wikidata:"Q131198",nameEn:"Heard Island and McDonald Islands",country:"AU",groups:["053","009","UN"],driveSide:"left"},geometry:{type:"MultiPolygon",coordinates:[[[[71.08716,-53.87687],[75.44182,-53.99822],[72.87012,-51.48322],[71.08716,-53.87687]]]]}},{type:"Feature",properties:{iso1A2:"HN",iso1A3:"HND",iso1N3:"340",wikidata:"Q783",nameEn:"Honduras",groups:["013","003","419","019","UN"],callingCodes:["504"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.86109,17.73736],[-88.20359,16.03858],[-88.22552,15.72294],[-88.24022,15.69247],[-88.31459,15.66942],[-88.32467,15.63665],[-88.97343,15.14039],[-89.15149,15.07392],[-89.18048,14.99967],[-89.15149,14.97775],[-89.23467,14.85596],[-89.13132,14.71582],[-89.15653,14.57802],[-89.23719,14.58046],[-89.35189,14.47553],[-89.34776,14.43013],[-89.04187,14.33644],[-88.94608,14.20207],[-88.85785,14.17763],[-88.815,14.11652],[-88.73182,14.10919],[-88.70661,14.04317],[-88.49738,13.97224],[-88.48982,13.86458],[-88.25791,13.91108],[-88.23018,13.99915],[-88.07641,13.98447],[-88.00331,13.86948],[-87.7966,13.91353],[-87.68821,13.80829],[-87.73106,13.75443],[-87.78148,13.52906],[-87.71657,13.50577],[-87.72115,13.46083],[-87.73841,13.44169],[-87.77354,13.45767],[-87.83467,13.44655],[-87.84675,13.41078],[-87.80177,13.35689],[-87.73714,13.32715],[-87.69751,13.25228],[-87.55124,13.12523],[-87.37107,12.98646],[-87.06306,13.00892],[-87.03785,12.98682],[-86.93197,13.05313],[-86.93383,13.18677],[-86.87066,13.30641],[-86.71267,13.30348],[-86.76812,13.79605],[-86.35219,13.77157],[-86.14801,14.04317],[-86.00685,14.08474],[-86.03458,13.99181],[-85.75477,13.8499],[-85.73964,13.9698],[-85.45762,14.11304],[-85.32149,14.2562],[-85.18602,14.24929],[-85.1575,14.53934],[-84.90082,14.80489],[-84.82596,14.82212],[-84.70119,14.68078],[-84.48373,14.63249],[-84.10584,14.76353],[-83.89551,14.76697],[-83.62101,14.89448],[-83.49268,15.01158],[-83.13724,15.00002],[-83.04763,15.03256],[-82.06974,14.49418],[-81.58685,18.0025],[-83.86109,17.73736]]]]}},{type:"Feature",properties:{iso1A2:"HR",iso1A3:"HRV",iso1N3:"191",wikidata:"Q224",nameEn:"Croatia",groups:["EU","039","150","UN"],callingCodes:["385"]},geometry:{type:"MultiPolygon",coordinates:[[[[17.6444,42.88641],[17.5392,42.92787],[17.70879,42.97223],[17.64268,43.08595],[17.46986,43.16559],[17.286,43.33065],[17.25579,43.40353],[17.29699,43.44542],[17.24411,43.49376],[17.15828,43.49376],[17.00585,43.58037],[16.80736,43.76011],[16.75316,43.77157],[16.70922,43.84887],[16.55472,43.95326],[16.50528,44.0244],[16.43629,44.02826],[16.43662,44.07523],[16.36864,44.08263],[16.18688,44.27012],[16.21346,44.35231],[16.12969,44.38275],[16.16814,44.40679],[16.10566,44.52586],[16.03012,44.55572],[16.00884,44.58605],[16.05828,44.61538],[15.89348,44.74964],[15.8255,44.71501],[15.72584,44.82334],[15.79472,44.8455],[15.76096,44.87045],[15.74723,44.96818],[15.78568,44.97401],[15.74585,45.0638],[15.78842,45.11519],[15.76371,45.16508],[15.83512,45.22459],[15.98412,45.23088],[16.12153,45.09616],[16.29036,44.99732],[16.35404,45.00241],[16.35863,45.03529],[16.3749,45.05206],[16.38219,45.05139],[16.38309,45.05955],[16.40023,45.1147],[16.4634,45.14522],[16.49155,45.21153],[16.52982,45.22713],[16.5501,45.2212],[16.56559,45.22307],[16.60194,45.23042],[16.64962,45.20714],[16.74845,45.20393],[16.78219,45.19002],[16.81137,45.18434],[16.83804,45.18951],[16.92405,45.27607],[16.9385,45.22742],[17.0415,45.20759],[17.18438,45.14764],[17.24325,45.146],[17.25131,45.14957],[17.26815,45.18444],[17.32092,45.16246],[17.33573,45.14521],[17.41229,45.13335],[17.4498,45.16119],[17.45615,45.12523],[17.47589,45.12656],[17.51469,45.10791],[17.59104,45.10816],[17.66571,45.13408],[17.84826,45.04489],[17.87148,45.04645],[17.93706,45.08016],[17.97336,45.12245],[17.97834,45.13831],[17.99479,45.14958],[18.01594,45.15163],[18.03121,45.12632],[18.1624,45.07654],[18.24387,45.13699],[18.32077,45.1021],[18.41896,45.11083],[18.47939,45.05871],[18.65723,45.07544],[18.78357,44.97741],[18.80661,44.93561],[18.76369,44.93707],[18.76347,44.90669],[18.8704,44.85097],[19.01994,44.85493],[18.98957,44.90645],[19.02871,44.92541],[19.06853,44.89915],[19.15573,44.95409],[19.05205,44.97692],[19.1011,45.01191],[19.07952,45.14668],[19.14063,45.12972],[19.19144,45.17863],[19.43589,45.17137],[19.41941,45.23475],[19.28208,45.23813],[19.10774,45.29547],[18.97446,45.37528],[18.99918,45.49333],[19.08364,45.48804],[19.07471,45.53086],[18.94562,45.53712],[18.88776,45.57253],[18.96691,45.66731],[18.90305,45.71863],[18.85783,45.85493],[18.81394,45.91329],[18.80211,45.87995],[18.6792,45.92057],[18.57483,45.80772],[18.44368,45.73972],[18.12439,45.78905],[18.08869,45.76511],[17.99805,45.79671],[17.87377,45.78522],[17.66545,45.84207],[17.56821,45.93728],[17.35672,45.95209],[17.14592,46.16697],[16.8903,46.28122],[16.8541,46.36255],[16.7154,46.39523],[16.6639,46.45203],[16.59527,46.47524],[16.52604,46.47831],[16.5007,46.49644],[16.44036,46.5171],[16.38771,46.53608],[16.37193,46.55008],[16.29793,46.5121],[16.26733,46.51505],[16.26759,46.50566],[16.23961,46.49653],[16.25124,46.48067],[16.27398,46.42875],[16.27329,46.41467],[16.30162,46.40437],[16.30233,46.37837],[16.18824,46.38282],[16.14859,46.40547],[16.05281,46.39141],[16.05065,46.3833],[16.07314,46.36458],[16.07616,46.3463],[15.97965,46.30652],[15.79284,46.25811],[15.78817,46.21719],[15.75479,46.20336],[15.75436,46.21969],[15.67395,46.22478],[15.6434,46.21396],[15.64904,46.19229],[15.59909,46.14761],[15.6083,46.11992],[15.62317,46.09103],[15.72977,46.04682],[15.71246,46.01196],[15.70327,46.00015],[15.70636,45.92116],[15.67967,45.90455],[15.68383,45.88867],[15.68232,45.86819],[15.70411,45.8465],[15.66662,45.84085],[15.64185,45.82915],[15.57952,45.84953],[15.52234,45.82195],[15.47325,45.8253],[15.47531,45.79802],[15.40836,45.79491],[15.25423,45.72275],[15.30872,45.69014],[15.34919,45.71623],[15.4057,45.64727],[15.38952,45.63682],[15.34214,45.64702],[15.34695,45.63382],[15.31027,45.6303],[15.27747,45.60504],[15.29837,45.5841],[15.30249,45.53224],[15.38188,45.48752],[15.33051,45.45258],[15.27758,45.46678],[15.16862,45.42309],[15.05187,45.49079],[15.02385,45.48533],[14.92266,45.52788],[14.90554,45.47769],[14.81992,45.45913],[14.80124,45.49515],[14.71718,45.53442],[14.68605,45.53006],[14.69694,45.57366],[14.59576,45.62812],[14.60977,45.66403],[14.57397,45.67165],[14.53816,45.6205],[14.5008,45.60852],[14.49769,45.54424],[14.36693,45.48642],[14.32487,45.47142],[14.27681,45.4902],[14.26611,45.48239],[14.24239,45.50607],[14.22371,45.50388],[14.20348,45.46896],[14.07116,45.48752],[14.00578,45.52352],[13.96063,45.50825],[13.99488,45.47551],[13.97309,45.45258],[13.90771,45.45149],[13.88124,45.42637],[13.81742,45.43729],[13.7785,45.46787],[13.67398,45.4436],[13.62902,45.45898],[13.56979,45.4895],[13.45644,45.59464],[13.05142,45.33128],[13.12821,44.48877],[16.15283,42.18525],[18.45131,42.21682],[18.54128,42.39171],[18.52152,42.42302],[18.43588,42.48556],[18.44307,42.51077],[18.43735,42.55921],[18.36197,42.61423],[18.24318,42.6112],[17.88201,42.83668],[17.80854,42.9182],[17.7948,42.89556],[17.68151,42.92725],[17.6444,42.88641]]]]}},{type:"Feature",properties:{iso1A2:"HT",iso1A3:"HTI",iso1N3:"332",wikidata:"Q790",nameEn:"Haiti",aliases:["RH"],groups:["029","003","419","019","UN"],callingCodes:["509"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.71885,18.78423],[-71.72624,18.87802],[-71.77766,18.95007],[-71.88102,18.95007],[-71.74088,19.0437],[-71.71088,19.08353],[-71.69938,19.10916],[-71.65337,19.11759],[-71.62642,19.21212],[-71.73229,19.26686],[-71.77766,19.33823],[-71.69448,19.37866],[-71.6802,19.45008],[-71.71268,19.53374],[-71.71449,19.55364],[-71.7429,19.58445],[-71.75865,19.70231],[-71.77419,19.73128],[-72.38946,20.27111],[-73.37289,20.43199],[-74.7289,18.71009],[-74.76465,18.06252],[-72.29523,17.48026],[-71.75671,18.03456],[-71.73783,18.07177],[-71.74994,18.11115],[-71.75465,18.14405],[-71.78271,18.18302],[-71.69952,18.34101],[-71.90875,18.45821],[-71.88102,18.50125],[-72.00201,18.62312],[-71.95412,18.64939],[-71.82556,18.62551],[-71.71885,18.78423]]]]}},{type:"Feature",properties:{iso1A2:"HU",iso1A3:"HUN",iso1N3:"348",wikidata:"Q28",nameEn:"Hungary",groups:["EU","151","150","UN"],callingCodes:["36"]},geometry:{type:"MultiPolygon",coordinates:[[[[21.72525,48.34628],[21.67134,48.3989],[21.6068,48.50365],[21.44063,48.58456],[21.11516,48.49546],[20.83248,48.5824],[20.5215,48.53336],[20.29943,48.26104],[20.24312,48.2784],[19.92452,48.1283],[19.63338,48.25006],[19.52489,48.19791],[19.47957,48.09437],[19.28182,48.08336],[19.23924,48.0595],[19.01952,48.07052],[18.82176,48.04206],[18.76134,47.97499],[18.76821,47.87469],[18.8506,47.82308],[18.74074,47.8157],[18.66521,47.76772],[18.56496,47.76588],[18.29305,47.73541],[18.02938,47.75665],[17.71215,47.7548],[17.23699,48.02094],[17.16001,48.00636],[17.09786,47.97336],[17.11022,47.92461],[17.08275,47.87719],[17.00997,47.86245],[17.07039,47.81129],[17.05048,47.79377],[17.08893,47.70928],[16.87538,47.68895],[16.86509,47.72268],[16.82938,47.68432],[16.7511,47.67878],[16.72089,47.73469],[16.65679,47.74197],[16.61183,47.76171],[16.54779,47.75074],[16.53514,47.73837],[16.55129,47.72268],[16.4222,47.66537],[16.58699,47.61772],[16.64193,47.63114],[16.71059,47.52692],[16.64821,47.50155],[16.6718,47.46139],[16.57152,47.40868],[16.52414,47.41007],[16.49908,47.39416],[16.45104,47.41181],[16.47782,47.25918],[16.44142,47.25079],[16.43663,47.21127],[16.41739,47.20649],[16.42801,47.18422],[16.4523,47.18812],[16.46442,47.16845],[16.44932,47.14418],[16.52863,47.13974],[16.46134,47.09395],[16.52176,47.05747],[16.43936,47.03548],[16.51369,47.00084],[16.28202,47.00159],[16.27594,46.9643],[16.22403,46.939],[16.19904,46.94134],[16.10983,46.867],[16.14365,46.8547],[16.15711,46.85434],[16.21892,46.86961],[16.2365,46.87775],[16.2941,46.87137],[16.34547,46.83836],[16.3408,46.80641],[16.31303,46.79838],[16.30966,46.7787],[16.37816,46.69975],[16.42641,46.69228],[16.41863,46.66238],[16.38594,46.6549],[16.39217,46.63673],[16.50139,46.56684],[16.52885,46.53303],[16.52604,46.5051],[16.59527,46.47524],[16.6639,46.45203],[16.7154,46.39523],[16.8541,46.36255],[16.8903,46.28122],[17.14592,46.16697],[17.35672,45.95209],[17.56821,45.93728],[17.66545,45.84207],[17.87377,45.78522],[17.99805,45.79671],[18.08869,45.76511],[18.12439,45.78905],[18.44368,45.73972],[18.57483,45.80772],[18.6792,45.92057],[18.80211,45.87995],[18.81394,45.91329],[18.99712,45.93537],[19.01284,45.96529],[19.0791,45.96458],[19.10388,46.04015],[19.14543,45.9998],[19.28826,45.99694],[19.52473,46.1171],[19.56113,46.16824],[19.66007,46.19005],[19.81491,46.1313],[19.93508,46.17553],[20.01816,46.17696],[20.03533,46.14509],[20.09713,46.17315],[20.26068,46.12332],[20.28324,46.1438],[20.35573,46.16629],[20.45377,46.14405],[20.49718,46.18721],[20.63863,46.12728],[20.76085,46.21002],[20.74574,46.25467],[20.86797,46.28884],[21.06572,46.24897],[21.16872,46.30118],[21.28061,46.44941],[21.26929,46.4993],[21.33214,46.63035],[21.43926,46.65109],[21.5151,46.72147],[21.48935,46.7577],[21.52028,46.84118],[21.59307,46.86935],[21.59581,46.91628],[21.68645,46.99595],[21.648,47.03902],[21.78395,47.11104],[21.94463,47.38046],[22.01055,47.37767],[22.03389,47.42508],[22.00917,47.50492],[22.31816,47.76126],[22.41979,47.7391],[22.46559,47.76583],[22.67247,47.7871],[22.76617,47.8417],[22.77991,47.87211],[22.89849,47.95851],[22.84276,47.98602],[22.87847,48.04665],[22.81804,48.11363],[22.73427,48.12005],[22.66835,48.09162],[22.58733,48.10813],[22.59007,48.15121],[22.49806,48.25189],[22.38133,48.23726],[22.2083,48.42534],[22.14689,48.4005],[21.83339,48.36242],[21.8279,48.33321],[21.72525,48.34628]]]]}},{type:"Feature",properties:{iso1A2:"IC",wikidata:"Q5813",nameEn:"Canary Islands",country:"ES",groups:["Q3320166","Q105472","EU","039","150","UN"],isoStatus:"excRes",callingCodes:["34"]},geometry:{type:"MultiPolygon",coordinates:[[[[-12.00985,30.24121],[-25.3475,27.87574],[-14.43883,27.02969],[-12.00985,30.24121]]]]}},{type:"Feature",properties:{iso1A2:"ID",iso1A3:"IDN",iso1N3:"360",wikidata:"Q252",nameEn:"Indonesia",aliases:["RI"]},geometry:null},{type:"Feature",properties:{iso1A2:"IE",iso1A3:"IRL",iso1N3:"372",wikidata:"Q27",nameEn:"Republic of Ireland",groups:["EU","Q22890","154","150","UN"],driveSide:"left",callingCodes:["353"]},geometry:{type:"MultiPolygon",coordinates:[[[[-6.26218,54.09785],[-6.29003,54.11278],[-6.32694,54.09337],[-6.36279,54.11248],[-6.36605,54.07234],[-6.47849,54.06947],[-6.62842,54.03503],[-6.66264,54.0666],[-6.6382,54.17071],[-6.70175,54.20218],[-6.74575,54.18788],[-6.81583,54.22791],[-6.85179,54.29176],[-6.87775,54.34682],[-7.02034,54.4212],[-7.19145,54.31296],[-7.14908,54.22732],[-7.25012,54.20063],[-7.26316,54.13863],[-7.29493,54.12013],[-7.29687,54.1354],[-7.28017,54.16714],[-7.29157,54.17191],[-7.34005,54.14698],[-7.30553,54.11869],[-7.32834,54.11475],[-7.44567,54.1539],[-7.4799,54.12239],[-7.55812,54.12239],[-7.69501,54.20731],[-7.81397,54.20159],[-7.8596,54.21779],[-7.87101,54.29299],[-8.04555,54.36292],[-8.179,54.46763],[-8.04538,54.48941],[-7.99812,54.54427],[-7.8596,54.53671],[-7.70315,54.62077],[-7.93293,54.66603],[-7.83352,54.73854],[-7.75041,54.7103],[-7.64449,54.75265],[-7.54671,54.74606],[-7.54508,54.79401],[-7.47626,54.83084],[-7.4473,54.87003],[-7.44404,54.9403],[-7.40004,54.94498],[-7.4033,55.00391],[-7.34464,55.04688],[-7.2471,55.06933],[-6.34755,55.49206],[-7.75229,55.93854],[-11.75,54],[-11,51],[-6.03913,51.13217],[-5.37267,53.63269],[-6.26218,54.09785]]]]}},{type:"Feature",properties:{iso1A2:"IL",iso1A3:"ISR",iso1N3:"376",wikidata:"Q801",nameEn:"Israel",groups:["145","142","UN"],callingCodes:["972"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.052,31.46619],[34.29262,31.70393],[34.48681,31.59711],[34.56797,31.54197],[34.48892,31.48365],[34.40077,31.40926],[34.36505,31.36404],[34.37381,31.30598],[34.36523,31.28963],[34.29417,31.24194],[34.26742,31.21998],[34.92298,29.45305],[34.97718,29.54294],[34.98207,29.58147],[35.02147,29.66343],[35.14108,30.07374],[35.19183,30.34636],[35.16218,30.43535],[35.19595,30.50297],[35.21379,30.60401],[35.29311,30.71365],[35.33456,30.81224],[35.33984,30.8802],[35.41371,30.95565],[35.43658,31.12444],[35.40316,31.25535],[35.47672,31.49578],[35.39675,31.49572],[35.22921,31.37445],[35.13033,31.3551],[35.02459,31.35979],[34.92571,31.34337],[34.88932,31.37093],[34.87833,31.39321],[34.89756,31.43891],[34.93258,31.47816],[34.94356,31.50743],[34.9415,31.55601],[34.95249,31.59813],[35.00879,31.65426],[35.08226,31.69107],[35.10782,31.71594],[35.11895,31.71454],[35.12933,31.7325],[35.13931,31.73012],[35.15119,31.73634],[35.15474,31.73352],[35.16478,31.73242],[35.18023,31.72067],[35.20538,31.72388],[35.21937,31.71578],[35.22392,31.71899],[35.23972,31.70896],[35.24315,31.71244],[35.2438,31.7201],[35.24981,31.72543],[35.25182,31.73945],[35.26319,31.74846],[35.25225,31.7678],[35.26058,31.79064],[35.25573,31.81362],[35.26404,31.82567],[35.251,31.83085],[35.25753,31.8387],[35.24816,31.8458],[35.2304,31.84222],[35.2249,31.85433],[35.22817,31.8638],[35.22567,31.86745],[35.22294,31.87889],[35.22014,31.88264],[35.2136,31.88241],[35.21276,31.88153],[35.21016,31.88237],[35.20945,31.8815],[35.20791,31.8821],[35.20673,31.88151],[35.20381,31.86716],[35.21128,31.863],[35.216,31.83894],[35.21469,31.81835],[35.19461,31.82687],[35.18169,31.82542],[35.18603,31.80901],[35.14174,31.81325],[35.07677,31.85627],[35.05617,31.85685],[35.01978,31.82944],[34.9724,31.83352],[34.99712,31.85569],[35.03489,31.85919],[35.03978,31.89276],[35.03489,31.92448],[35.00124,31.93264],[34.98682,31.96935],[35.00261,32.027],[34.9863,32.09551],[34.99437,32.10962],[34.98507,32.12606],[34.99039,32.14626],[34.96009,32.17503],[34.95703,32.19522],[34.98885,32.20758],[35.01841,32.23981],[35.02939,32.2671],[35.01119,32.28684],[35.01772,32.33863],[35.04243,32.35008],[35.05142,32.3667],[35.0421,32.38242],[35.05311,32.4024],[35.05423,32.41754],[35.07059,32.4585],[35.08564,32.46948],[35.09236,32.47614],[35.10024,32.47856],[35.10882,32.4757],[35.15937,32.50466],[35.2244,32.55289],[35.25049,32.52453],[35.29306,32.50947],[35.30685,32.51024],[35.35212,32.52047],[35.40224,32.50136],[35.42034,32.46009],[35.41598,32.45593],[35.41048,32.43706],[35.42078,32.41562],[35.55807,32.38674],[35.55494,32.42687],[35.57485,32.48669],[35.56614,32.64393],[35.59813,32.65159],[35.61669,32.67999],[35.66527,32.681],[35.68467,32.70715],[35.75983,32.74803],[35.78745,32.77938],[35.83758,32.82817],[35.84021,32.8725],[35.87012,32.91976],[35.89298,32.9456],[35.87188,32.98028],[35.84802,33.1031],[35.81911,33.11077],[35.81911,33.1336],[35.84285,33.16673],[35.83846,33.19397],[35.81647,33.2028],[35.81295,33.24841],[35.77513,33.27342],[35.813,33.3172],[35.77477,33.33609],[35.62019,33.27278],[35.62283,33.24226],[35.58502,33.26653],[35.58326,33.28381],[35.56523,33.28969],[35.55555,33.25844],[35.54544,33.25513],[35.54808,33.236],[35.5362,33.23196],[35.54228,33.19865],[35.52573,33.11921],[35.50335,33.114],[35.50272,33.09056],[35.448,33.09264],[35.43059,33.06659],[35.35223,33.05617],[35.31429,33.10515],[35.1924,33.08743],[35.10645,33.09318],[34.78515,33.20368],[33.62659,31.82938],[34.052,31.46619]]]]}},{type:"Feature",properties:{iso1A2:"IM",iso1A3:"IMN",iso1N3:"833",wikidata:"Q9676",nameEn:"Isle of Man",country:"GB",groups:["Q185086","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01624","44 07624","44 07524","44 07924"]},geometry:{type:"MultiPolygon",coordinates:[[[[-3.98763,54.07351],[-4.1819,54.57861],[-5.6384,53.81157],[-3.98763,54.07351]]]]}},{type:"Feature",properties:{iso1A2:"IN",iso1A3:"IND",iso1N3:"356",wikidata:"Q668",nameEn:"India"},geometry:null},{type:"Feature",properties:{iso1A2:"IO",iso1A3:"IOT",iso1N3:"086",wikidata:"Q43448",nameEn:"British Indian Ocean Territory",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"IQ",iso1A3:"IRQ",iso1N3:"368",wikidata:"Q796",nameEn:"Iraq",groups:["145","142","UN"],callingCodes:["964"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.78887,37.38615],[42.56725,37.14878],[42.35724,37.10998],[42.36697,37.0627],[41.81736,36.58782],[41.40058,36.52502],[41.28864,36.35368],[41.2564,36.06012],[41.37027,35.84095],[41.38184,35.62502],[41.26569,35.42708],[41.21654,35.1508],[41.2345,34.80049],[41.12388,34.65742],[40.97676,34.39788],[40.64314,34.31604],[38.79171,33.37328],[39.08202,32.50304],[38.98762,32.47694],[39.04251,32.30203],[39.26157,32.35555],[39.29903,32.23259],[40.01521,32.05667],[42.97601,30.72204],[42.97796,30.48295],[44.72255,29.19736],[46.42415,29.05947],[46.5527,29.10283],[46.89695,29.50584],[47.15166,30.01044],[47.37192,30.10421],[47.7095,30.10453],[48.01114,29.98906],[48.06782,30.02906],[48.17332,30.02448],[48.40479,29.85763],[48.59531,29.66815],[48.83867,29.78572],[48.61441,29.93675],[48.51011,29.96238],[48.44785,30.00148],[48.4494,30.04456],[48.43384,30.08233],[48.38869,30.11062],[48.38714,30.13485],[48.41671,30.17254],[48.41117,30.19846],[48.26393,30.3408],[48.24385,30.33846],[48.21279,30.31644],[48.19425,30.32796],[48.18321,30.39703],[48.14585,30.44133],[48.02443,30.4789],[48.03221,30.9967],[47.68219,31.00004],[47.6804,31.39086],[47.86337,31.78422],[47.64771,32.07666],[47.52474,32.15972],[47.57144,32.20583],[47.37529,32.47808],[47.17218,32.45393],[46.46788,32.91992],[46.32298,32.9731],[46.17198,32.95612],[46.09103,32.98354],[46.15175,33.07229],[46.03966,33.09577],[46.05367,33.13097],[46.11905,33.11924],[46.20623,33.20395],[45.99919,33.5082],[45.86687,33.49263],[45.96183,33.55751],[45.89801,33.63661],[45.77814,33.60938],[45.50261,33.94968],[45.42789,33.9458],[45.41077,33.97421],[45.47264,34.03099],[45.56176,34.15088],[45.58667,34.30147],[45.53552,34.35148],[45.49171,34.3439],[45.46697,34.38221],[45.43879,34.45949],[45.51883,34.47692],[45.53219,34.60441],[45.59074,34.55558],[45.60224,34.55057],[45.73923,34.54416],[45.70031,34.69277],[45.65672,34.7222],[45.68284,34.76624],[45.70031,34.82322],[45.73641,34.83975],[45.79682,34.85133],[45.78904,34.91135],[45.86532,34.89858],[45.89477,34.95805],[45.87864,35.03441],[45.92173,35.0465],[45.92203,35.09538],[45.93108,35.08148],[45.94756,35.09188],[46.06508,35.03699],[46.07747,35.0838],[46.11763,35.07551],[46.19116,35.11097],[46.15642,35.1268],[46.16229,35.16984],[46.19738,35.18536],[46.18457,35.22561],[46.11367,35.23729],[46.15474,35.2883],[46.13152,35.32548],[46.05358,35.38568],[45.98453,35.49848],[46.01518,35.52012],[45.97584,35.58132],[46.03028,35.57416],[46.01307,35.59756],[46.0165,35.61501],[45.99452,35.63574],[46.0117,35.65059],[46.01631,35.69139],[46.23736,35.71414],[46.34166,35.78363],[46.32921,35.82655],[46.17198,35.8013],[46.08325,35.8581],[45.94711,35.82218],[45.89784,35.83708],[45.81442,35.82107],[45.76145,35.79898],[45.6645,35.92872],[45.60018,35.96069],[45.55245,35.99943],[45.46594,36.00042],[45.38275,35.97156],[45.33916,35.99424],[45.37652,36.06222],[45.37312,36.09917],[45.32235,36.17383],[45.30038,36.27769],[45.26261,36.3001],[45.27394,36.35846],[45.23953,36.43257],[45.11811,36.40751],[45.00759,36.5402],[45.06985,36.62645],[45.06985,36.6814],[45.01537,36.75128],[44.84725,36.77622],[44.83479,36.81362],[44.90173,36.86096],[44.91199,36.91468],[44.89862,37.01897],[44.81611,37.04383],[44.75229,37.11958],[44.78319,37.1431],[44.76698,37.16162],[44.63179,37.19229],[44.42631,37.05825],[44.38117,37.05825],[44.35315,37.04955],[44.35937,37.02843],[44.30645,36.97373],[44.25975,36.98119],[44.18503,37.09551],[44.22239,37.15756],[44.27998,37.16501],[44.2613,37.25055],[44.13521,37.32486],[44.02002,37.33229],[43.90949,37.22453],[43.84878,37.22205],[43.82699,37.19477],[43.8052,37.22825],[43.7009,37.23692],[43.63085,37.21957],[43.56702,37.25675],[43.50787,37.24436],[43.33508,37.33105],[43.30083,37.30629],[43.11403,37.37436],[42.93705,37.32015],[42.78887,37.38615]]]]}},{type:"Feature",properties:{iso1A2:"IR",iso1A3:"IRN",iso1N3:"364",wikidata:"Q794",nameEn:"Iran",groups:["034","142","UN"],callingCodes:["98"]},geometry:{type:"MultiPolygon",coordinates:[[[[44.96746,39.42998],[44.88916,39.59653],[44.81043,39.62677],[44.71806,39.71124],[44.65422,39.72163],[44.6137,39.78393],[44.47298,39.68788],[44.48111,39.61579],[44.41849,39.56659],[44.42832,39.4131],[44.37921,39.4131],[44.29818,39.378],[44.22452,39.4169],[44.03667,39.39223],[44.1043,39.19842],[44.20946,39.13975],[44.18863,38.93881],[44.30322,38.81581],[44.26155,38.71427],[44.28065,38.6465],[44.32058,38.62752],[44.3207,38.49799],[44.3119,38.37887],[44.38309,38.36117],[44.44386,38.38295],[44.50115,38.33939],[44.42476,38.25763],[44.22509,37.88859],[44.3883,37.85433],[44.45948,37.77065],[44.55498,37.783],[44.62096,37.71985],[44.56887,37.6429],[44.61401,37.60165],[44.58449,37.45018],[44.81021,37.2915],[44.75986,37.21549],[44.7868,37.16644],[44.78319,37.1431],[44.75229,37.11958],[44.81611,37.04383],[44.89862,37.01897],[44.91199,36.91468],[44.90173,36.86096],[44.83479,36.81362],[44.84725,36.77622],[45.01537,36.75128],[45.06985,36.6814],[45.06985,36.62645],[45.00759,36.5402],[45.11811,36.40751],[45.23953,36.43257],[45.27394,36.35846],[45.26261,36.3001],[45.30038,36.27769],[45.32235,36.17383],[45.37312,36.09917],[45.37652,36.06222],[45.33916,35.99424],[45.38275,35.97156],[45.46594,36.00042],[45.55245,35.99943],[45.60018,35.96069],[45.6645,35.92872],[45.76145,35.79898],[45.81442,35.82107],[45.89784,35.83708],[45.94711,35.82218],[46.08325,35.8581],[46.17198,35.8013],[46.32921,35.82655],[46.34166,35.78363],[46.23736,35.71414],[46.01631,35.69139],[46.0117,35.65059],[45.99452,35.63574],[46.0165,35.61501],[46.01307,35.59756],[46.03028,35.57416],[45.97584,35.58132],[46.01518,35.52012],[45.98453,35.49848],[46.05358,35.38568],[46.13152,35.32548],[46.15474,35.2883],[46.11367,35.23729],[46.18457,35.22561],[46.19738,35.18536],[46.16229,35.16984],[46.15642,35.1268],[46.19116,35.11097],[46.11763,35.07551],[46.07747,35.0838],[46.06508,35.03699],[45.94756,35.09188],[45.93108,35.08148],[45.92203,35.09538],[45.92173,35.0465],[45.87864,35.03441],[45.89477,34.95805],[45.86532,34.89858],[45.78904,34.91135],[45.79682,34.85133],[45.73641,34.83975],[45.70031,34.82322],[45.68284,34.76624],[45.65672,34.7222],[45.70031,34.69277],[45.73923,34.54416],[45.60224,34.55057],[45.59074,34.55558],[45.53219,34.60441],[45.51883,34.47692],[45.43879,34.45949],[45.46697,34.38221],[45.49171,34.3439],[45.53552,34.35148],[45.58667,34.30147],[45.56176,34.15088],[45.47264,34.03099],[45.41077,33.97421],[45.42789,33.9458],[45.50261,33.94968],[45.77814,33.60938],[45.89801,33.63661],[45.96183,33.55751],[45.86687,33.49263],[45.99919,33.5082],[46.20623,33.20395],[46.11905,33.11924],[46.05367,33.13097],[46.03966,33.09577],[46.15175,33.07229],[46.09103,32.98354],[46.17198,32.95612],[46.32298,32.9731],[46.46788,32.91992],[47.17218,32.45393],[47.37529,32.47808],[47.57144,32.20583],[47.52474,32.15972],[47.64771,32.07666],[47.86337,31.78422],[47.6804,31.39086],[47.68219,31.00004],[48.03221,30.9967],[48.02443,30.4789],[48.14585,30.44133],[48.18321,30.39703],[48.19425,30.32796],[48.21279,30.31644],[48.24385,30.33846],[48.26393,30.3408],[48.41117,30.19846],[48.41671,30.17254],[48.38714,30.13485],[48.38869,30.11062],[48.43384,30.08233],[48.4494,30.04456],[48.44785,30.00148],[48.51011,29.96238],[48.61441,29.93675],[48.83867,29.78572],[49.98877,27.87827],[50.37726,27.89227],[54.39838,25.68383],[55.14145,25.62624],[55.81777,26.18798],[56.2644,26.58649],[56.68954,26.76645],[56.79239,26.41236],[56.82555,25.7713],[56.86325,25.03856],[61.46682,24.57869],[61.6433,25.27541],[61.683,25.66638],[61.83968,25.7538],[61.83831,26.07249],[61.89391,26.26251],[62.05117,26.31647],[62.21304,26.26601],[62.31484,26.528],[62.77352,26.64099],[63.1889,26.65072],[63.18688,26.83844],[63.25005,26.84212],[63.25005,27.08692],[63.32283,27.14437],[63.19649,27.25674],[62.80604,27.22412],[62.79684,27.34381],[62.84905,27.47627],[62.7638,28.02992],[62.79412,28.28108],[62.59499,28.24842],[62.40259,28.42703],[61.93581,28.55284],[61.65978,28.77937],[61.53765,29.00507],[61.31508,29.38903],[60.87231,29.86514],[61.80829,30.84224],[61.78268,30.92724],[61.8335,30.97669],[61.83257,31.0452],[61.80957,31.12576],[61.80569,31.16167],[61.70929,31.37391],[60.84541,31.49561],[60.86191,32.22565],[60.56485,33.12944],[60.88908,33.50219],[60.91133,33.55596],[60.69573,33.56054],[60.57762,33.59772],[60.5485,33.73422],[60.5838,33.80793],[60.50209,34.13992],[60.66502,34.31539],[60.91321,34.30411],[60.72316,34.52857],[60.99922,34.63064],[61.00197,34.70631],[61.06926,34.82139],[61.12831,35.09938],[61.0991,35.27845],[61.18187,35.30249],[61.27371,35.61482],[61.22719,35.67038],[61.26152,35.80749],[61.22444,35.92879],[61.12007,35.95992],[61.22719,36.12759],[61.1393,36.38782],[61.18187,36.55348],[61.14516,36.64644],[60.34767,36.63214],[60.00768,37.04102],[59.74678,37.12499],[59.55178,37.13594],[59.39385,37.34257],[59.39797,37.47892],[59.33507,37.53146],[59.22905,37.51161],[58.9338,37.67374],[58.6921,37.64548],[58.5479,37.70526],[58.47786,37.6433],[58.39959,37.63134],[58.22999,37.6856],[58.21399,37.77281],[57.79534,37.89299],[57.35042,37.98546],[57.37236,38.09321],[57.21169,38.28965],[57.03453,38.18717],[56.73928,38.27887],[56.62255,38.24005],[56.43303,38.26054],[56.32454,38.18502],[56.33278,38.08132],[55.97847,38.08024],[55.76561,38.12238],[55.44152,38.08564],[55.13412,37.94705],[54.851,37.75739],[54.77684,37.62264],[54.81804,37.61285],[54.77822,37.51597],[54.67247,37.43532],[54.58664,37.45809],[54.36211,37.34912],[54.24565,37.32047],[53.89734,37.3464],[48.88288,38.43975],[48.84969,38.45015],[48.81072,38.44853],[48.78979,38.45026],[48.70001,38.40564],[48.62217,38.40198],[48.58793,38.45076],[48.45084,38.61013],[48.3146,38.59958],[48.24773,38.71883],[48.02581,38.82705],[48.01409,38.90333],[48.07734,38.91616],[48.08627,38.94434],[48.28437,38.97186],[48.33884,39.03022],[48.31239,39.09278],[48.15361,39.19419],[48.12404,39.25208],[48.15984,39.30028],[48.37385,39.37584],[48.34264,39.42935],[47.98977,39.70999],[47.84774,39.66285],[47.50099,39.49615],[47.38978,39.45999],[47.31301,39.37492],[47.05927,39.24846],[47.05771,39.20143],[46.95341,39.13505],[46.92539,39.16644],[46.83822,39.13143],[46.75752,39.03231],[46.53497,38.86548],[46.34059,38.92076],[46.20601,38.85262],[46.14785,38.84206],[46.06766,38.87861],[46.00228,38.87376],[45.94624,38.89072],[45.90266,38.87739],[45.83883,38.90768],[45.65172,38.95199],[45.6155,38.94304],[45.6131,38.964],[45.44966,38.99243],[45.44811,39.04927],[45.40452,39.07224],[45.40148,39.09007],[45.30489,39.18333],[45.16168,39.21952],[45.08751,39.35052],[45.05932,39.36435],[44.96746,39.42998]]]]}},{type:"Feature",properties:{iso1A2:"IS",iso1A3:"ISL",iso1N3:"352",wikidata:"Q189",nameEn:"Iceland",groups:["154","150","UN"],callingCodes:["354"]},geometry:{type:"MultiPolygon",coordinates:[[[[-33.15676,62.62995],[-8.25539,63.0423],[-15.70914,69.67442],[-33.15676,62.62995]]]]}},{type:"Feature",properties:{iso1A2:"IT",iso1A3:"ITA",iso1N3:"380",wikidata:"Q38",nameEn:"Italy",groups:["EU","039","150","UN"],callingCodes:["39"]},geometry:{type:"MultiPolygon",coordinates:[[[[8.95861,45.96485],[8.97604,45.96151],[8.97741,45.98317],[8.96668,45.98436],[8.95861,45.96485]]],[[[7.63035,43.57419],[9.56115,43.20816],[10.09675,41.44089],[7.60802,41.05927],[7.89009,38.19924],[11.2718,37.6713],[12.13667,34.20326],[14.02721,36.53141],[17.67657,35.68918],[18.83516,40.36999],[16.15283,42.18525],[13.12821,44.48877],[13.05142,45.33128],[13.45644,45.59464],[13.6076,45.64761],[13.7198,45.59352],[13.74587,45.59811],[13.78445,45.5825],[13.84106,45.58185],[13.86771,45.59898],[13.8695,45.60835],[13.9191,45.6322],[13.87933,45.65207],[13.83422,45.68703],[13.83332,45.70855],[13.8235,45.7176],[13.66986,45.79955],[13.59784,45.8072],[13.58858,45.83503],[13.57563,45.8425],[13.58644,45.88173],[13.59565,45.89446],[13.60857,45.89907],[13.61931,45.91782],[13.63815,45.93607],[13.6329,45.94894],[13.64307,45.98326],[13.63458,45.98947],[13.62074,45.98388],[13.58903,45.99009],[13.56759,45.96991],[13.52963,45.96588],[13.50104,45.98078],[13.47474,46.00546],[13.49702,46.01832],[13.50998,46.04498],[13.49568,46.04839],[13.50104,46.05986],[13.57072,46.09022],[13.64053,46.13587],[13.66472,46.17392],[13.64451,46.18966],[13.56682,46.18703],[13.56114,46.2054],[13.47587,46.22725],[13.42218,46.20758],[13.37671,46.29668],[13.44808,46.33507],[13.43418,46.35992],[13.47019,46.3621],[13.5763,46.40915],[13.5763,46.42613],[13.59777,46.44137],[13.68684,46.43881],[13.7148,46.5222],[13.64088,46.53438],[13.27627,46.56059],[12.94445,46.60401],[12.59992,46.6595],[12.38708,46.71529],[12.27591,46.88651],[12.2006,46.88854],[12.11675,47.01241],[12.21781,47.03996],[12.19254,47.09331],[11.74789,46.98484],[11.50739,47.00644],[11.33355,46.99862],[11.10618,46.92966],[11.00764,46.76896],[10.72974,46.78972],[10.75753,46.82258],[10.66405,46.87614],[10.54783,46.84505],[10.47197,46.85698],[10.38659,46.67847],[10.40475,46.63671],[10.44686,46.64162],[10.49375,46.62049],[10.46136,46.53164],[10.25309,46.57432],[10.23674,46.63484],[10.10307,46.61003],[10.03715,46.44479],[10.165,46.41051],[10.10506,46.3372],[10.17862,46.25626],[10.14439,46.22992],[10.07055,46.21668],[9.95249,46.38045],[9.73086,46.35071],[9.71273,46.29266],[9.57015,46.2958],[9.46117,46.37481],[9.45936,46.50873],[9.40487,46.46621],[9.36128,46.5081],[9.28136,46.49685],[9.25502,46.43743],[9.29226,46.32717],[9.24503,46.23616],[9.01618,46.04928],[8.99257,45.9698],[9.09065,45.89906],[9.06642,45.8761],[9.04546,45.84968],[9.04059,45.8464],[9.03505,45.83976],[9.03793,45.83548],[9.03279,45.82865],[9.0298,45.82127],[9.00324,45.82055],[8.99663,45.83466],[8.9621,45.83707],[8.94737,45.84285],[8.91129,45.8388],[8.93504,45.86245],[8.94372,45.86587],[8.93649,45.86775],[8.88904,45.95465],[8.86688,45.96135],[8.85121,45.97239],[8.8319,45.9879],[8.79362,45.99207],[8.78585,45.98973],[8.79414,46.00913],[8.85617,46.0748],[8.80778,46.10085],[8.75697,46.10395],[8.62242,46.12112],[8.45032,46.26869],[8.46317,46.43712],[8.42464,46.46367],[8.30648,46.41587],[8.31162,46.38044],[8.08814,46.26692],[8.16866,46.17817],[8.11383,46.11577],[8.02906,46.10331],[7.98881,45.99867],[7.9049,45.99945],[7.85949,45.91485],[7.56343,45.97421],[7.10685,45.85653],[7.04151,45.92435],[6.95315,45.85163],[6.80785,45.83265],[6.80785,45.71864],[6.98948,45.63869],[7.00037,45.509],[7.18019,45.40071],[7.10572,45.32924],[7.13115,45.25386],[7.07074,45.21228],[6.96706,45.20841],[6.85144,45.13226],[6.7697,45.16044],[6.62803,45.11175],[6.66981,45.02324],[6.74791,45.01939],[6.74519,44.93661],[6.75518,44.89915],[6.90774,44.84322],[6.93499,44.8664],[7.02217,44.82519],[7.00401,44.78782],[7.07484,44.68073],[7.00582,44.69364],[6.95133,44.66264],[6.96042,44.62129],[6.85507,44.53072],[6.86233,44.49834],[6.94504,44.43112],[6.88784,44.42043],[6.89171,44.36637],[6.98221,44.28289],[7.00764,44.23736],[7.16929,44.20352],[7.27827,44.1462],[7.34547,44.14359],[7.36364,44.11882],[7.62155,44.14881],[7.63245,44.17877],[7.68694,44.17487],[7.66878,44.12795],[7.72508,44.07578],[7.6597,44.03009],[7.66848,43.99943],[7.65266,43.9763],[7.60771,43.95772],[7.56858,43.94506],[7.56075,43.89932],[7.51162,43.88301],[7.49355,43.86551],[7.50423,43.84345],[7.53006,43.78405],[7.63035,43.57419]],[[12.45181,41.90056],[12.44834,41.90095],[12.44582,41.90194],[12.44815,41.90326],[12.44984,41.90545],[12.45091,41.90625],[12.45543,41.90738],[12.45561,41.90629],[12.45762,41.9058],[12.45755,41.9033],[12.45826,41.90281],[12.45834,41.90174],[12.4577,41.90115],[12.45691,41.90125],[12.45626,41.90172],[12.45435,41.90143],[12.45446,41.90028],[12.45181,41.90056]],[[12.45648,43.89369],[12.44184,43.90498],[12.41641,43.89991],[12.40935,43.9024],[12.41233,43.90956],[12.40733,43.92379],[12.41551,43.92984],[12.41165,43.93769],[12.40506,43.94325],[12.40415,43.95485],[12.41414,43.95273],[12.42005,43.9578],[12.43662,43.95698],[12.44684,43.96597],[12.46205,43.97463],[12.47853,43.98052],[12.49406,43.98492],[12.50678,43.99113],[12.51463,43.99122],[12.5154,43.98508],[12.51064,43.98165],[12.51109,43.97201],[12.50622,43.97131],[12.50875,43.96198],[12.50655,43.95796],[12.51427,43.94897],[12.51553,43.94096],[12.50496,43.93017],[12.50269,43.92363],[12.49724,43.92248],[12.49247,43.91774],[12.49429,43.90973],[12.48771,43.89706],[12.45648,43.89369]]]]}},{type:"Feature",properties:{iso1A2:"JE",iso1A3:"JEY",iso1N3:"832",wikidata:"Q785",nameEn:"Bailiwick of Jersey",country:"GB",groups:["830","Q185086","154","150","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["44 01534"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.00491,48.86706],[-1.83944,49.23037],[-2.09454,49.46288],[-2.65349,49.15373],[-2.00491,48.86706]]]]}},{type:"Feature",properties:{iso1A2:"JM",iso1A3:"JAM",iso1N3:"388",wikidata:"Q766",nameEn:"Jamaica",aliases:["JA"],groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 876","1 658"]},geometry:{type:"MultiPolygon",coordinates:[[[[-74.09729,17.36817],[-78.9741,19.59515],[-78.34606,16.57862],[-74.09729,17.36817]]]]}},{type:"Feature",properties:{iso1A2:"JO",iso1A3:"JOR",iso1N3:"400",wikidata:"Q810",nameEn:"Jordan",groups:["145","142","UN"],callingCodes:["962"]},geometry:{type:"MultiPolygon",coordinates:[[[[39.04251,32.30203],[38.98762,32.47694],[39.08202,32.50304],[38.79171,33.37328],[36.83946,32.31293],[36.40959,32.37908],[36.23948,32.50108],[36.20875,32.49529],[36.20379,32.52751],[36.08074,32.51463],[36.02239,32.65911],[35.96633,32.66237],[35.93307,32.71966],[35.88405,32.71321],[35.75983,32.74803],[35.68467,32.70715],[35.66527,32.681],[35.61669,32.67999],[35.59813,32.65159],[35.56614,32.64393],[35.57485,32.48669],[35.55494,32.42687],[35.55807,32.38674],[35.57111,32.21877],[35.52012,32.04076],[35.54375,31.96587],[35.52758,31.9131],[35.55941,31.76535],[35.47672,31.49578],[35.40316,31.25535],[35.43658,31.12444],[35.41371,30.95565],[35.33984,30.8802],[35.33456,30.81224],[35.29311,30.71365],[35.21379,30.60401],[35.19595,30.50297],[35.16218,30.43535],[35.19183,30.34636],[35.14108,30.07374],[35.02147,29.66343],[34.98207,29.58147],[34.97718,29.54294],[34.92298,29.45305],[34.8812,29.36878],[36.07081,29.18469],[36.50005,29.49696],[36.75083,29.86903],[37.4971,29.99949],[37.66395,30.33245],[37.99354,30.49998],[36.99791,31.50081],[38.99233,31.99721],[39.29903,32.23259],[39.26157,32.35555],[39.04251,32.30203]]]]}},{type:"Feature",properties:{iso1A2:"JP",iso1A3:"JPN",iso1N3:"392",wikidata:"Q17",nameEn:"Japan",groups:["030","142","UN"],driveSide:"left",callingCodes:["81"]},geometry:{type:"MultiPolygon",coordinates:[[[[145.82361,43.38904],[145.23667,43.76813],[145.82343,44.571],[140.9182,45.92937],[133.61399,37.41],[129.2669,34.87122],[122.26612,25.98197],[123.92912,17.8782],[155.16731,23.60141],[145.82361,43.38904]]]]}},{type:"Feature",properties:{iso1A2:"KE",iso1A3:"KEN",iso1N3:"404",wikidata:"Q114",nameEn:"Kenya",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["254"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.9419,4.61933],[35.51424,4.61643],[35.42366,4.76969],[35.47843,4.91872],[35.30992,4.90402],[35.34151,5.02364],[34.47601,4.72162],[33.9873,4.23316],[34.06046,4.15235],[34.15429,3.80464],[34.45815,3.67385],[34.44922,3.51627],[34.39112,3.48802],[34.41794,3.44342],[34.40006,3.37949],[34.45815,3.18319],[34.56242,3.11478],[34.60114,2.93034],[34.65774,2.8753],[34.73967,2.85447],[34.78137,2.76223],[34.77244,2.70272],[34.95267,2.47209],[34.90947,2.42447],[34.98692,1.97348],[34.9899,1.6668],[34.92734,1.56109],[34.87819,1.5596],[34.7918,1.36752],[34.82606,1.30944],[34.82606,1.26626],[34.80223,1.22754],[34.67562,1.21265],[34.58029,1.14712],[34.57427,1.09868],[34.52369,1.10692],[34.43349,.85254],[34.40041,.80266],[34.31516,.75693],[34.27345,.63182],[34.20196,.62289],[34.13493,.58118],[34.11408,.48884],[34.08727,.44713],[34.10067,.36372],[33.90936,.10581],[33.98449,-.13079],[33.9264,-.54188],[33.93107,-.99298],[34.02286,-1.00779],[34.03084,-1.05101],[34.0824,-1.02264],[37.67199,-3.06222],[37.71745,-3.304],[37.5903,-3.42735],[37.63099,-3.50723],[37.75036,-3.54243],[37.81321,-3.69179],[39.21631,-4.67835],[39.44306,-4.93877],[39.62121,-4.68136],[41.75542,-1.85308],[41.56362,-1.66375],[41.56,-1.59812],[41.00099,-.83068],[40.98767,2.82959],[41.31368,3.14314],[41.89488,3.97375],[41.1754,3.94079],[40.77498,4.27683],[39.86043,3.86974],[39.76808,3.67058],[39.58339,3.47434],[39.55132,3.39634],[39.51551,3.40895],[39.49444,3.45521],[39.19954,3.47834],[39.07736,3.5267],[38.91938,3.51198],[38.52336,3.62551],[38.45812,3.60445],[38.14168,3.62487],[37.07724,4.33503],[36.84474,4.44518],[36.03924,4.44406],[35.95449,4.53244],[35.9419,4.61933]]]]}},{type:"Feature",properties:{iso1A2:"KG",iso1A3:"KGZ",iso1N3:"417",wikidata:"Q813",nameEn:"Kyrgyzstan",groups:["143","142","UN"],callingCodes:["996"]},geometry:{type:"MultiPolygon",coordinates:[[[[74.88756,42.98612],[74.75,42.99029],[74.70331,43.02519],[74.64615,43.05881],[74.57491,43.13702],[74.22489,43.24657],[73.55634,43.03071],[73.50992,42.82356],[73.44393,42.43098],[71.88792,42.83578],[71.62405,42.76613],[71.53272,42.8014],[71.2724,42.77853],[71.22785,42.69248],[71.17807,42.67381],[71.15232,42.60486],[70.97717,42.50147],[70.85973,42.30188],[70.94483,42.26238],[71.13263,42.28356],[71.28719,42.18033],[70.69777,41.92554],[70.17682,41.5455],[70.48909,41.40335],[70.67586,41.47953],[70.78572,41.36419],[70.77885,41.24813],[70.86263,41.23833],[70.9615,41.16393],[71.02193,41.19494],[71.11806,41.15359],[71.25813,41.18796],[71.27187,41.11015],[71.34877,41.16807],[71.40198,41.09436],[71.46148,41.13958],[71.43814,41.19644],[71.46688,41.31883],[71.57227,41.29175],[71.6787,41.42111],[71.65914,41.49599],[71.73054,41.54713],[71.71132,41.43012],[71.76625,41.4466],[71.83914,41.3546],[71.91457,41.2982],[71.85964,41.19081],[72.07249,41.11739],[72.10745,41.15483],[72.16433,41.16483],[72.17594,41.15522],[72.14864,41.13363],[72.1792,41.10621],[72.21061,41.05607],[72.17594,41.02377],[72.18339,40.99571],[72.324,41.03381],[72.34026,41.04539],[72.34757,41.06104],[72.36138,41.04384],[72.38511,41.02785],[72.45206,41.03018],[72.48742,40.97136],[72.55109,40.96046],[72.59136,40.86947],[72.68157,40.84942],[72.84291,40.85512],[72.94454,40.8094],[73.01869,40.84681],[73.13267,40.83512],[73.13412,40.79122],[73.0612,40.76678],[72.99133,40.76457],[72.93296,40.73089],[72.8722,40.71111],[72.85372,40.7116],[72.84754,40.67229],[72.80137,40.67856],[72.74866,40.60873],[72.74894,40.59592],[72.75982,40.57273],[72.74862,40.57131],[72.74768,40.58051],[72.73995,40.58409],[72.69579,40.59778],[72.66713,40.59076],[72.66713,40.5219],[72.47795,40.5532],[72.40517,40.61917],[72.34406,40.60144],[72.41714,40.55736],[72.38384,40.51535],[72.41513,40.50856],[72.44191,40.48222],[72.40346,40.4007],[72.24368,40.46091],[72.18648,40.49893],[71.96401,40.31907],[72.05464,40.27586],[71.85002,40.25647],[71.82646,40.21872],[71.73054,40.14818],[71.71719,40.17886],[71.69621,40.18492],[71.70569,40.20391],[71.68386,40.26984],[71.61931,40.26775],[71.61725,40.20615],[71.51549,40.22986],[71.51215,40.26943],[71.4246,40.28619],[71.36663,40.31593],[71.13042,40.34106],[71.05901,40.28765],[70.95789,40.28761],[70.9818,40.22392],[70.80495,40.16813],[70.7928,40.12797],[70.65827,40.0981],[70.65946,39.9878],[70.58912,39.95211],[70.55033,39.96619],[70.47557,39.93216],[70.57384,39.99394],[70.58297,40.00891],[70.01283,40.23288],[69.67001,40.10639],[69.64704,40.12165],[69.57615,40.10524],[69.55555,40.12296],[69.53794,40.11833],[69.53855,40.0887],[69.5057,40.03277],[69.53615,39.93991],[69.43557,39.92877],[69.43134,39.98431],[69.35649,40.01994],[69.26938,39.8127],[69.3594,39.52516],[69.68677,39.59281],[69.87491,39.53882],[70.11111,39.58223],[70.2869,39.53141],[70.44757,39.60128],[70.64087,39.58792],[70.7854,39.38933],[71.06418,39.41586],[71.08752,39.50704],[71.49814,39.61397],[71.55856,39.57588],[71.5517,39.45722],[71.62688,39.44056],[71.76816,39.45456],[71.80164,39.40631],[71.7522,39.32031],[71.79202,39.27355],[71.90601,39.27674],[72.04059,39.36704],[72.09689,39.26823],[72.17242,39.2661],[72.23834,39.17248],[72.33173,39.33093],[72.62027,39.39696],[72.85934,39.35116],[73.18454,39.35536],[73.31912,39.38615],[73.45096,39.46677],[73.59831,39.46425],[73.87018,39.47879],[73.94683,39.60733],[73.92354,39.69565],[73.9051,39.75073],[73.83006,39.76136],[73.97049,40.04378],[74.25533,40.13191],[74.35063,40.09742],[74.69875,40.34668],[74.85996,40.32857],[74.78168,40.44886],[74.82013,40.52197],[75.08243,40.43945],[75.22834,40.45382],[75.5854,40.66874],[75.69663,40.28642],[75.91361,40.2948],[75.96168,40.38064],[76.33659,40.3482],[76.5261,40.46114],[76.75681,40.95354],[76.99302,41.0696],[77.28004,41.0033],[77.3693,41.0375],[77.52723,41.00227],[77.76206,41.01574],[77.81287,41.14307],[78.12873,41.23091],[78.15757,41.38565],[78.3732,41.39603],[79.92977,42.04113],[80.17842,42.03211],[80.17807,42.21166],[79.97364,42.42816],[79.52921,42.44778],[79.19763,42.804],[78.91502,42.76839],[78.48469,42.89649],[75.82823,42.94848],[75.72174,42.79672],[75.29966,42.86183],[75.22619,42.85528],[74.88756,42.98612]],[[70.74189,39.86319],[70.63105,39.77923],[70.59667,39.83542],[70.54998,39.85137],[70.52631,39.86989],[70.53651,39.89155],[70.74189,39.86319]],[[71.86463,39.98598],[71.84316,39.95582],[71.7504,39.93701],[71.71511,39.96348],[71.78838,40.01404],[71.86463,39.98598]],[[71.21139,40.03369],[71.1427,39.95026],[71.23067,39.93581],[71.16101,39.88423],[71.10531,39.91354],[71.04979,39.89808],[71.10501,39.95568],[71.09063,39.99],[71.11668,39.99291],[71.11037,40.01984],[71.01035,40.05481],[71.00236,40.18154],[71.06305,40.1771],[71.12218,40.03052],[71.21139,40.03369]]]]}},{type:"Feature",properties:{iso1A2:"KH",iso1A3:"KHM",iso1N3:"116",wikidata:"Q424",nameEn:"Cambodia",groups:["035","142","UN"],callingCodes:["855"]},geometry:{type:"MultiPolygon",coordinates:[[[[105.87328,11.55953],[105.81645,11.56876],[105.80867,11.60536],[105.8507,11.66635],[105.88962,11.67854],[105.95188,11.63738],[106.00792,11.7197],[106.02038,11.77457],[106.06708,11.77761],[106.13158,11.73283],[106.18539,11.75171],[106.26478,11.72122],[106.30525,11.67549],[106.37219,11.69836],[106.44691,11.66787],[106.45158,11.68616],[106.41577,11.76999],[106.44535,11.8279],[106.44068,11.86294],[106.4687,11.86751],[106.4111,11.97413],[106.70687,11.96956],[106.79405,12.0807],[106.92325,12.06548],[106.99953,12.08983],[107.15831,12.27547],[107.34511,12.33327],[107.42917,12.24657],[107.4463,12.29373],[107.55059,12.36824],[107.5755,12.52177],[107.55993,12.7982],[107.49611,12.88926],[107.49144,13.01215],[107.62843,13.3668],[107.61909,13.52577],[107.53503,13.73908],[107.45252,13.78897],[107.46498,13.91593],[107.44318,13.99751],[107.38247,13.99147],[107.35757,14.02319],[107.37158,14.07906],[107.33577,14.11832],[107.40427,14.24509],[107.39493,14.32655],[107.44941,14.41552],[107.48521,14.40346],[107.52569,14.54665],[107.52102,14.59034],[107.55371,14.628],[107.54361,14.69092],[107.47238,14.61523],[107.44435,14.52785],[107.37897,14.54443],[107.3276,14.58812],[107.29803,14.58963],[107.26534,14.54292],[107.256,14.48716],[107.21241,14.48716],[107.17038,14.41782],[107.09722,14.3937],[107.03962,14.45099],[107.04585,14.41782],[106.98825,14.36806],[106.9649,14.3198],[106.90574,14.33639],[106.8497,14.29416],[106.80767,14.31226],[106.73762,14.42687],[106.63333,14.44194],[106.59908,14.50977],[106.57106,14.50525],[106.54148,14.59565],[106.50723,14.58963],[106.45898,14.55045],[106.47766,14.50977],[106.43874,14.52032],[106.40916,14.45249],[106.32355,14.44043],[106.25194,14.48415],[106.21302,14.36203],[106.00131,14.36957],[105.99509,14.32734],[106.02311,14.30623],[106.04801,14.20363],[106.10872,14.18401],[106.11962,14.11307],[106.18656,14.06324],[106.16632,14.01794],[106.10094,13.98471],[106.10405,13.9137],[105.90791,13.92881],[105.78182,14.02247],[105.78338,14.08438],[105.5561,14.15684],[105.44869,14.10703],[105.36775,14.09948],[105.2759,14.17496],[105.20894,14.34967],[105.17748,14.34432],[105.14012,14.23873],[105.08408,14.20402],[105.02804,14.23722],[104.97667,14.38806],[104.69335,14.42726],[104.55014,14.36091],[104.27616,14.39861],[103.93836,14.3398],[103.70175,14.38052],[103.71109,14.4348],[103.53518,14.42575],[103.39353,14.35639],[103.16469,14.33075],[102.93275,14.19044],[102.91251,14.01531],[102.77864,13.93374],[102.72727,13.77806],[102.56848,13.69366],[102.5481,13.6589],[102.58635,13.6286],[102.62483,13.60883],[102.57573,13.60461],[102.5358,13.56933],[102.44601,13.5637],[102.36859,13.57488],[102.33828,13.55613],[102.361,13.50551],[102.35563,13.47307],[102.35692,13.38274],[102.34611,13.35618],[102.36001,13.31142],[102.36146,13.26006],[102.43422,13.09061],[102.46011,13.08057],[102.52275,12.99813],[102.48694,12.97537],[102.49335,12.92711],[102.53053,12.77506],[102.4994,12.71736],[102.51963,12.66117],[102.57567,12.65358],[102.7796,12.43781],[102.78116,12.40284],[102.73134,12.37091],[102.70176,12.1686],[102.77026,12.06815],[102.78427,11.98746],[102.83957,11.8519],[102.90973,11.75613],[102.91449,11.65512],[102.52395,11.25257],[102.47649,9.66162],[103.99198,10.48391],[104.43778,10.42386],[104.47963,10.43046],[104.49869,10.4057],[104.59018,10.53073],[104.87933,10.52833],[104.95094,10.64003],[105.09571,10.72722],[105.02722,10.89236],[105.08326,10.95656],[105.11449,10.96332],[105.34011,10.86179],[105.42884,10.96878],[105.50045,10.94586],[105.77751,11.03671],[105.86376,10.89839],[105.84603,10.85873],[105.93403,10.83853],[105.94535,10.9168],[106.06708,10.8098],[106.18539,10.79451],[106.14301,10.98176],[106.20095,10.97795],[106.1757,11.07301],[106.1527,11.10476],[106.10444,11.07879],[105.86782,11.28343],[105.88962,11.43605],[105.87328,11.55953]]]]}},{type:"Feature",properties:{iso1A2:"KI",iso1A3:"KIR",iso1N3:"296",wikidata:"Q710",nameEn:"Kiribati",groups:["057","009","UN"],driveSide:"left",callingCodes:["686"]},geometry:{type:"MultiPolygon",coordinates:[[[[169,3.9],[169,-3.5],[178,-3.5],[178,3.9],[169,3.9]]],[[[-161.06795,5.2462],[-158.12991,-1.86122],[-175.33482,-1.40631],[-175.31804,-7.54825],[-156.50903,-7.4975],[-156.48634,-15.52824],[-135.59706,-4.70473],[-161.06795,5.2462]]]]}},{type:"Feature",properties:{iso1A2:"KM",iso1A3:"COM",iso1N3:"174",wikidata:"Q970",nameEn:"Comoros",groups:["014","202","002","UN"],callingCodes:["269"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.63904,-10.02522],[43.28731,-13.97126],[45.4971,-11.75965],[42.63904,-10.02522]]]]}},{type:"Feature",properties:{iso1A2:"KN",iso1A3:"KNA",iso1N3:"659",wikidata:"Q763",nameEn:"St. Kitts and Nevis",groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 869"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.29333,17.43155],[-62.76692,17.64353],[-63.09677,17.21372],[-62.63813,16.65446],[-62.29333,17.43155]]]]}},{type:"Feature",properties:{iso1A2:"KP",iso1A3:"PRK",iso1N3:"408",wikidata:"Q423",nameEn:"North Korea",groups:["030","142","UN"],callingCodes:["850"]},geometry:{type:"MultiPolygon",coordinates:[[[[130.26095,42.9027],[130.09764,42.91425],[130.12957,42.98361],[129.96409,42.97306],[129.95082,43.01051],[129.8865,43.00395],[129.85261,42.96494],[129.83277,42.86746],[129.80719,42.79218],[129.7835,42.76521],[129.77183,42.69435],[129.75294,42.59409],[129.72541,42.43739],[129.60482,42.44461],[129.54701,42.37254],[129.42882,42.44702],[129.28541,42.41574],[129.22423,42.3553],[129.22285,42.26491],[129.15178,42.17224],[128.96068,42.06657],[128.94007,42.03537],[128.04487,42.01769],[128.15119,41.74568],[128.30716,41.60322],[128.20061,41.40895],[128.18546,41.41279],[128.12967,41.37931],[128.03311,41.39232],[128.02633,41.42103],[127.92943,41.44291],[127.29712,41.49473],[127.17841,41.59714],[126.90729,41.79955],[126.60631,41.65565],[126.53189,41.35206],[126.242,41.15454],[126.00335,40.92835],[125.76869,40.87908],[125.71172,40.85223],[124.86913,40.45387],[124.40719,40.13655],[124.38556,40.11047],[124.3322,40.05573],[124.37089,40.03004],[124.35029,39.95639],[124.23201,39.9248],[124.17532,39.8232],[123.90497,38.79949],[123.85601,37.49093],[124.67666,38.05679],[124.84224,37.977],[124.87921,37.80827],[125.06408,37.66334],[125.37112,37.62643],[125.81159,37.72949],[126.13074,37.70512],[126.18776,37.74728],[126.19097,37.81462],[126.24402,37.83113],[126.43239,37.84095],[126.46818,37.80873],[126.56709,37.76857],[126.59918,37.76364],[126.66067,37.7897],[126.68793,37.83728],[126.68793,37.9175],[126.67023,37.95852],[126.84961,38.0344],[126.88106,38.10246],[126.95887,38.1347],[126.95338,38.17735],[127.04479,38.25518],[127.15749,38.30722],[127.38727,38.33227],[127.49672,38.30647],[127.55013,38.32257],[128.02917,38.31861],[128.27652,38.41657],[128.31105,38.58462],[128.37487,38.62345],[128.65655,38.61914],[131.95041,41.5445],[130.65022,42.32281],[130.66367,42.38024],[130.64181,42.41422],[130.60805,42.4317],[130.56835,42.43281],[130.55143,42.52158],[130.50123,42.61636],[130.44361,42.54849],[130.41826,42.6011],[130.2385,42.71127],[130.23068,42.80125],[130.26095,42.9027]]]]}},{type:"Feature",properties:{iso1A2:"KR",iso1A3:"KOR",iso1N3:"410",wikidata:"Q884",nameEn:"South Korea",groups:["030","142","UN"],callingCodes:["82"]},geometry:{type:"MultiPolygon",coordinates:[[[[133.11729,37.53115],[128.65655,38.61914],[128.37487,38.62345],[128.31105,38.58462],[128.27652,38.41657],[128.02917,38.31861],[127.55013,38.32257],[127.49672,38.30647],[127.38727,38.33227],[127.15749,38.30722],[127.04479,38.25518],[126.95338,38.17735],[126.95887,38.1347],[126.88106,38.10246],[126.84961,38.0344],[126.67023,37.95852],[126.68793,37.9175],[126.68793,37.83728],[126.66067,37.7897],[126.59918,37.76364],[126.56709,37.76857],[126.46818,37.80873],[126.43239,37.84095],[126.24402,37.83113],[126.19097,37.81462],[126.18776,37.74728],[126.13074,37.70512],[125.81159,37.72949],[125.37112,37.62643],[125.06408,37.66334],[124.87921,37.80827],[124.84224,37.977],[124.67666,38.05679],[123.85601,37.49093],[122.80525,33.30571],[125.99728,32.63328],[129.2669,34.87122],[133.11729,37.53115]]]]}},{type:"Feature",properties:{iso1A2:"KW",iso1A3:"KWT",iso1N3:"414",wikidata:"Q817",nameEn:"Kuwait",groups:["145","142","UN"],callingCodes:["965"]},geometry:{type:"MultiPolygon",coordinates:[[[[49.00421,28.81495],[48.59531,29.66815],[48.40479,29.85763],[48.17332,30.02448],[48.06782,30.02906],[48.01114,29.98906],[47.7095,30.10453],[47.37192,30.10421],[47.15166,30.01044],[46.89695,29.50584],[46.5527,29.10283],[47.46202,29.0014],[47.58376,28.83382],[47.59863,28.66798],[47.70561,28.5221],[48.42991,28.53628],[49.00421,28.81495]]]]}},{type:"Feature",properties:{iso1A2:"KY",iso1A3:"CYM",iso1N3:"136",wikidata:"Q5785",nameEn:"Cayman Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 345"]},geometry:{type:"MultiPolygon",coordinates:[[[[-82.11509,19.60401],[-80.36068,18.11751],[-79.32727,20.06742],[-82.11509,19.60401]]]]}},{type:"Feature",properties:{iso1A2:"KZ",iso1A3:"KAZ",iso1N3:"398",wikidata:"Q232",nameEn:"Kazakhstan",groups:["143","142","UN"],callingCodes:["7"]},geometry:{type:"MultiPolygon",coordinates:[[[[68.90865,55.38148],[68.19206,55.18823],[68.26661,55.09226],[68.21308,54.98645],[65.20174,54.55216],[65.24663,54.35721],[65.11033,54.33028],[64.97216,54.4212],[63.97686,54.29763],[64.02715,54.22679],[63.91224,54.20013],[63.80604,54.27079],[62.58651,54.05871],[62.56876,53.94047],[62.45931,53.90737],[62.38535,54.03961],[62.00966,54.04134],[62.03913,53.94768],[61.65318,54.02445],[61.56941,53.95703],[61.47603,54.08048],[61.3706,54.08464],[61.26863,53.92797],[60.99796,53.93699],[61.14283,53.90063],[61.22574,53.80268],[60.90626,53.62937],[61.55706,53.57144],[61.57185,53.50112],[61.37957,53.45887],[61.29082,53.50992],[61.14291,53.41481],[61.19024,53.30536],[62.14574,53.09626],[62.12799,52.99133],[62.0422,52.96105],[61.23462,53.03227],[61.05842,52.92217],[60.71989,52.75923],[60.71693,52.66245],[60.84118,52.63912],[60.84709,52.52228],[60.98021,52.50068],[61.05417,52.35096],[60.78201,52.22067],[60.72581,52.15538],[60.48915,52.15175],[60.19925,51.99173],[59.99809,51.98263],[60.09867,51.87135],[60.50986,51.7964],[60.36787,51.66815],[60.5424,51.61675],[60.92401,51.61124],[60.95655,51.48615],[61.50677,51.40687],[61.55114,51.32746],[61.6813,51.25716],[61.56889,51.23679],[61.4431,50.80679],[60.81833,50.6629],[60.31914,50.67705],[60.17262,50.83312],[60.01288,50.8163],[59.81172,50.54451],[59.51886,50.49937],[59.48928,50.64216],[58.87974,50.70852],[58.3208,51.15151],[57.75578,51.13852],[57.74986,50.93017],[57.44221,50.88354],[57.17302,51.11253],[56.17906,50.93204],[56.11398,50.7471],[55.67774,50.54508],[54.72067,51.03261],[54.56685,51.01958],[54.71476,50.61214],[54.55797,50.52006],[54.41894,50.61214],[54.46331,50.85554],[54.12248,51.11542],[53.69299,51.23466],[53.46165,51.49445],[52.54329,51.48444],[52.36119,51.74161],[51.8246,51.67916],[51.77431,51.49536],[51.301,51.48799],[51.26254,51.68466],[50.59695,51.61859],[50.26859,51.28677],[49.97277,51.2405],[49.76866,51.11067],[49.39001,51.09396],[49.41959,50.85927],[49.12673,50.78639],[48.86936,50.61589],[48.57946,50.63278],[48.90782,50.02281],[48.68352,49.89546],[48.42564,49.82283],[48.24519,49.86099],[48.10044,50.09242],[47.58551,50.47867],[47.30448,50.30894],[47.34589,50.09308],[47.18319,49.93721],[46.9078,49.86707],[46.78398,49.34026],[47.04658,49.19834],[47.00857,49.04921],[46.78392,48.95352],[46.49011,48.43019],[47.11516,48.27188],[47.12107,47.83687],[47.38731,47.68176],[47.41689,47.83687],[47.64973,47.76559],[48.15348,47.74545],[48.45173,47.40818],[48.52326,47.4102],[49.01136,46.72716],[48.51142,46.69268],[48.54988,46.56267],[49.16518,46.38542],[49.32259,46.26944],[49.88945,46.04554],[49.2134,44.84989],[52.26048,41.69249],[52.47884,41.78034],[52.97575,42.1308],[54.20635,42.38477],[54.95182,41.92424],[55.45471,41.25609],[56.00314,41.32584],[55.97584,44.99322],[55.97584,44.99328],[55.97584,44.99338],[55.97584,44.99343],[55.97584,44.99348],[55.97584,44.99353],[55.97584,44.99359],[55.97584,44.99369],[55.97584,44.99374],[55.97584,44.99384],[55.97584,44.9939],[55.97584,44.994],[55.97584,44.99405],[55.97584,44.99415],[55.97584,44.99421],[55.97584,44.99426],[55.97584,44.99431],[55.97584,44.99436],[55.97584,44.99441],[55.97594,44.99446],[55.97605,44.99452],[55.97605,44.99457],[55.97605,44.99462],[55.97605,44.99467],[55.97605,44.99477],[55.97615,44.99477],[55.97615,44.99483],[55.97615,44.99493],[55.97615,44.99498],[55.97615,44.99503],[55.97615,44.99508],[55.97625,44.99514],[55.97636,44.99519],[55.97636,44.99524],[55.97646,44.99529],[55.97646,44.99534],[55.97656,44.99539],[55.97667,44.99545],[55.97677,44.9955],[55.97677,44.99555],[55.97677,44.9956],[55.97687,44.9956],[55.97698,44.99565],[55.97698,44.9957],[55.97708,44.99576],[55.97718,44.99581],[55.97729,44.99586],[55.97739,44.99586],[55.97739,44.99591],[55.97749,44.99591],[55.9776,44.99591],[55.9777,44.99596],[55.9777,44.99601],[55.9778,44.99607],[55.97791,44.99607],[55.97801,44.99607],[55.97801,44.99612],[55.97811,44.99617],[55.97822,44.99617],[55.97832,44.99622],[55.97842,44.99622],[58.59711,45.58671],[61.01475,44.41383],[62.01711,43.51008],[63.34656,43.64003],[64.53885,43.56941],[64.96464,43.74748],[65.18666,43.48835],[65.53277,43.31856],[65.85194,42.85481],[66.09482,42.93426],[66.00546,41.94455],[66.53302,41.87388],[66.69129,41.1311],[67.9644,41.14611],[67.98511,41.02794],[68.08273,41.08148],[68.1271,41.0324],[67.96736,40.83798],[68.49983,40.56437],[68.63,40.59358],[68.58444,40.91447],[68.49983,40.99669],[68.62221,41.03019],[68.65662,40.93861],[68.73945,40.96989],[68.7217,41.05025],[69.01308,41.22804],[69.05006,41.36183],[69.15137,41.43078],[69.17701,41.43769],[69.18528,41.45175],[69.20439,41.45391],[69.22671,41.46298],[69.23332,41.45847],[69.25059,41.46693],[69.29778,41.43673],[69.35554,41.47211],[69.37468,41.46555],[69.45081,41.46246],[69.39485,41.51518],[69.45751,41.56863],[69.49545,41.545],[70.94483,42.26238],[70.85973,42.30188],[70.97717,42.50147],[71.15232,42.60486],[71.17807,42.67381],[71.22785,42.69248],[71.2724,42.77853],[71.53272,42.8014],[71.62405,42.76613],[71.88792,42.83578],[73.44393,42.43098],[73.50992,42.82356],[73.55634,43.03071],[74.22489,43.24657],[74.57491,43.13702],[74.64615,43.05881],[74.70331,43.02519],[74.75,42.99029],[74.88756,42.98612],[75.22619,42.85528],[75.29966,42.86183],[75.72174,42.79672],[75.82823,42.94848],[78.48469,42.89649],[78.91502,42.76839],[79.19763,42.804],[79.52921,42.44778],[79.97364,42.42816],[80.17807,42.21166],[80.26841,42.23797],[80.16892,42.61137],[80.26886,42.8366],[80.38169,42.83142],[80.58999,42.9011],[80.3735,43.01557],[80.62913,43.141],[80.78817,43.14235],[80.77771,43.30065],[80.69718,43.32589],[80.75156,43.44948],[80.40031,44.10986],[80.40229,44.23319],[80.38384,44.63073],[79.8987,44.89957],[80.11169,45.03352],[81.73278,45.3504],[82.51374,45.1755],[82.58474,45.40027],[82.21792,45.56619],[83.04622,47.19053],[83.92184,46.98912],[84.73077,47.01394],[84.93995,46.87399],[85.22443,47.04816],[85.54294,47.06171],[85.69696,47.2898],[85.61067,47.49753],[85.5169,48.05493],[85.73581,48.3939],[86.38069,48.46064],[86.75343,48.70331],[86.73568,48.99918],[86.87238,49.12432],[87.28386,49.11626],[87.31465,49.23603],[87.03071,49.25142],[86.82606,49.51796],[86.61307,49.60239],[86.79056,49.74787],[86.63674,49.80136],[86.18709,49.50259],[85.24047,49.60239],[84.99198,50.06793],[84.29385,50.27257],[83.8442,50.87375],[83.14607,51.00796],[82.55443,50.75412],[81.94999,50.79307],[81.46581,50.77658],[81.41248,50.97524],[81.06091,50.94833],[81.16999,51.15662],[80.80318,51.28262],[80.44819,51.20855],[80.4127,50.95581],[80.08138,50.77658],[79.11255,52.01171],[77.90383,53.29807],[76.54243,53.99329],[76.44076,54.16017],[76.82266,54.1798],[76.91052,54.4677],[75.3668,54.07439],[75.43398,53.98652],[75.07405,53.80831],[73.39218,53.44623],[73.25412,53.61532],[73.68921,53.86522],[73.74778,54.07194],[73.37963,53.96132],[72.71026,54.1161],[72.43415,53.92685],[72.17477,54.36303],[71.96141,54.17736],[71.10379,54.13326],[71.08706,54.33376],[71.24185,54.64965],[71.08288,54.71253],[70.96009,55.10558],[70.76493,55.3027],[70.19179,55.1476],[69.74917,55.35545],[69.34224,55.36344],[68.90865,55.38148]]]]}},{type:"Feature",properties:{iso1A2:"LA",iso1A3:"LAO",iso1N3:"418",wikidata:"Q819",nameEn:"Laos",groups:["035","142","UN"],callingCodes:["856"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.1245,22.43372],[102.03633,22.46164],[101.98487,22.42766],[101.91344,22.44417],[101.90714,22.38688],[101.86828,22.38397],[101.7685,22.50337],[101.68973,22.46843],[101.61306,22.27515],[101.56789,22.28876],[101.53638,22.24794],[101.60675,22.13513],[101.57525,22.13026],[101.62566,21.96574],[101.7791,21.83019],[101.74555,21.72852],[101.83257,21.61562],[101.80001,21.57461],[101.7475,21.5873],[101.7727,21.51794],[101.74224,21.48276],[101.74014,21.30967],[101.84412,21.25291],[101.83887,21.20983],[101.76745,21.21571],[101.79266,21.19025],[101.7622,21.14813],[101.70548,21.14911],[101.66977,21.20004],[101.60886,21.17947],[101.59491,21.18621],[101.6068,21.23329],[101.54563,21.25668],[101.29326,21.17254],[101.2229,21.23271],[101.26912,21.36482],[101.19349,21.41959],[101.2124,21.56422],[101.15156,21.56129],[101.16198,21.52808],[101.00234,21.39612],[100.80173,21.2934],[100.72716,21.31786],[100.63578,21.05639],[100.55281,21.02796],[100.50974,20.88574],[100.64628,20.88279],[100.60112,20.8347],[100.51079,20.82194],[100.36375,20.82783],[100.1957,20.68247],[100.08404,20.36626],[100.09999,20.31614],[100.09337,20.26293],[100.11785,20.24787],[100.1712,20.24324],[100.16668,20.2986],[100.22076,20.31598],[100.25769,20.3992],[100.33383,20.4028],[100.37439,20.35156],[100.41473,20.25625],[100.44992,20.23644],[100.4537,20.19971],[100.47567,20.19133],[100.51052,20.14928],[100.55218,20.17741],[100.58808,20.15791],[100.5094,19.87904],[100.398,19.75047],[100.49604,19.53504],[100.58219,19.49164],[100.64606,19.55884],[100.77231,19.48324],[100.90302,19.61901],[101.08928,19.59748],[101.26545,19.59242],[101.26991,19.48324],[101.21347,19.46223],[101.20604,19.35296],[101.24911,19.33334],[101.261,19.12717],[101.35606,19.04716],[101.25803,18.89545],[101.22832,18.73377],[101.27585,18.68875],[101.06047,18.43247],[101.18227,18.34367],[101.15108,18.25624],[101.19118,18.2125],[101.1793,18.0544],[101.02185,17.87637],[100.96541,17.57926],[101.15108,17.47586],[101.44667,17.7392],[101.72294,17.92867],[101.78087,18.07559],[101.88485,18.02474],[102.11359,18.21532],[102.45523,17.97106],[102.59234,17.96127],[102.60971,17.95411],[102.61432,17.92273],[102.5896,17.84889],[102.59485,17.83537],[102.68194,17.80151],[102.69946,17.81686],[102.67543,17.84529],[102.68538,17.86653],[102.75954,17.89561],[102.79044,17.93612],[102.81988,17.94233],[102.86323,17.97531],[102.95812,18.0054],[102.9912,17.9949],[103.01998,17.97095],[103.0566,18.00144],[103.07823,18.03833],[103.07343,18.12351],[103.1493,18.17799],[103.14994,18.23172],[103.17093,18.2618],[103.29757,18.30475],[103.23818,18.34875],[103.24779,18.37807],[103.30977,18.4341],[103.41044,18.4486],[103.47773,18.42841],[103.60957,18.40528],[103.699,18.34125],[103.82449,18.33979],[103.85642,18.28666],[103.93916,18.33914],[103.97725,18.33631],[104.06533,18.21656],[104.10927,18.10826],[104.21776,17.99335],[104.2757,17.86139],[104.35432,17.82871],[104.45404,17.66788],[104.69867,17.53038],[104.80061,17.39367],[104.80716,17.19025],[104.73712,17.01404],[104.7373,16.91125],[104.76442,16.84752],[104.7397,16.81005],[104.76099,16.69302],[104.73349,16.565],[104.88057,16.37311],[105.00262,16.25627],[105.06204,16.09792],[105.42001,16.00657],[105.38508,15.987],[105.34115,15.92737],[105.37959,15.84074],[105.42285,15.76971],[105.46573,15.74742],[105.61756,15.68792],[105.60446,15.53301],[105.58191,15.41031],[105.47635,15.3796],[105.4692,15.33709],[105.50662,15.32054],[105.58043,15.32724],[105.46661,15.13132],[105.61162,15.00037],[105.5121,14.80802],[105.53864,14.55731],[105.43783,14.43865],[105.20894,14.34967],[105.2759,14.17496],[105.36775,14.09948],[105.44869,14.10703],[105.5561,14.15684],[105.78338,14.08438],[105.78182,14.02247],[105.90791,13.92881],[106.10405,13.9137],[106.10094,13.98471],[106.16632,14.01794],[106.18656,14.06324],[106.11962,14.11307],[106.10872,14.18401],[106.04801,14.20363],[106.02311,14.30623],[105.99509,14.32734],[106.00131,14.36957],[106.21302,14.36203],[106.25194,14.48415],[106.32355,14.44043],[106.40916,14.45249],[106.43874,14.52032],[106.47766,14.50977],[106.45898,14.55045],[106.50723,14.58963],[106.54148,14.59565],[106.57106,14.50525],[106.59908,14.50977],[106.63333,14.44194],[106.73762,14.42687],[106.80767,14.31226],[106.8497,14.29416],[106.90574,14.33639],[106.9649,14.3198],[106.98825,14.36806],[107.04585,14.41782],[107.03962,14.45099],[107.09722,14.3937],[107.17038,14.41782],[107.21241,14.48716],[107.256,14.48716],[107.26534,14.54292],[107.29803,14.58963],[107.3276,14.58812],[107.37897,14.54443],[107.44435,14.52785],[107.47238,14.61523],[107.54361,14.69092],[107.51579,14.79282],[107.59285,14.87795],[107.48277,14.93751],[107.46516,15.00982],[107.61486,15.0566],[107.61926,15.13949],[107.58844,15.20111],[107.62587,15.2266],[107.60605,15.37524],[107.62367,15.42193],[107.53341,15.40496],[107.50699,15.48771],[107.3815,15.49832],[107.34408,15.62345],[107.27583,15.62769],[107.27143,15.71459],[107.21859,15.74638],[107.21419,15.83747],[107.34188,15.89464],[107.39471,15.88829],[107.46296,16.01106],[107.44975,16.08511],[107.33968,16.05549],[107.25822,16.13587],[107.14595,16.17816],[107.15035,16.26271],[107.09091,16.3092],[107.02597,16.31132],[106.97385,16.30204],[106.96638,16.34938],[106.88067,16.43594],[106.88727,16.52671],[106.84104,16.55415],[106.74418,16.41904],[106.65832,16.47816],[106.66052,16.56892],[106.61477,16.60713],[106.58267,16.6012],[106.59013,16.62259],[106.55485,16.68704],[106.55265,16.86831],[106.52183,16.87884],[106.51963,16.92097],[106.54824,16.92729],[106.55045,17.0031],[106.50862,16.9673],[106.43597,17.01362],[106.31929,17.20509],[106.29287,17.3018],[106.24444,17.24714],[106.18991,17.28227],[106.09019,17.36399],[105.85744,17.63221],[105.76612,17.67147],[105.60381,17.89356],[105.64784,17.96687],[105.46292,18.22008],[105.38366,18.15315],[105.15942,18.38691],[105.10408,18.43533],[105.1327,18.58355],[105.19654,18.64196],[105.12829,18.70453],[104.64617,18.85668],[104.5361,18.97747],[103.87125,19.31854],[104.06058,19.43484],[104.10832,19.51575],[104.05617,19.61743],[104.06498,19.66926],[104.23229,19.70242],[104.41281,19.70035],[104.53169,19.61743],[104.64837,19.62365],[104.68359,19.72729],[104.8355,19.80395],[104.8465,19.91783],[104.9874,20.09573],[104.91695,20.15567],[104.86852,20.14121],[104.61315,20.24452],[104.62195,20.36633],[104.72102,20.40554],[104.66158,20.47774],[104.47886,20.37459],[104.40621,20.3849],[104.38199,20.47155],[104.63957,20.6653],[104.27412,20.91433],[104.11121,20.96779],[103.98024,20.91531],[103.82282,20.8732],[103.73478,20.6669],[103.68633,20.66324],[103.45737,20.82382],[103.38032,20.79501],[103.21497,20.89832],[103.12055,20.89994],[103.03469,21.05821],[102.97745,21.05821],[102.89825,21.24707],[102.80794,21.25736],[102.88939,21.3107],[102.94223,21.46034],[102.86297,21.4255],[102.98846,21.58936],[102.97965,21.74076],[102.86077,21.71213],[102.85637,21.84501],[102.81894,21.83888],[102.82115,21.73667],[102.74189,21.66713],[102.67145,21.65894],[102.62301,21.91447],[102.49092,21.99002],[102.51734,22.02676],[102.18712,22.30403],[102.14099,22.40092],[102.1245,22.43372]]]]}},{type:"Feature",properties:{iso1A2:"LB",iso1A3:"LBN",iso1N3:"422",wikidata:"Q822",nameEn:"Lebanon",aliases:["RL"],groups:["145","142","UN"],callingCodes:["961"]},geometry:{type:"MultiPolygon",coordinates:[[[[35.94816,33.47886],[35.94465,33.52774],[36.05723,33.57904],[35.9341,33.6596],[36.06778,33.82927],[36.14517,33.85118],[36.3967,33.83365],[36.38263,33.86579],[36.28589,33.91981],[36.41078,34.05253],[36.50576,34.05982],[36.5128,34.09916],[36.62537,34.20251],[36.59195,34.2316],[36.58667,34.27667],[36.60778,34.31009],[36.56556,34.31881],[36.53039,34.3798],[36.55853,34.41609],[36.46179,34.46541],[36.4442,34.50165],[36.34745,34.5002],[36.3369,34.52629],[36.39846,34.55672],[36.41429,34.61175],[36.45299,34.59438],[36.46003,34.6378],[36.42941,34.62505],[36.35384,34.65447],[36.35135,34.68516],[36.32399,34.69334],[36.29165,34.62991],[35.98718,34.64977],[35.97386,34.63322],[35.48515,34.70851],[34.78515,33.20368],[35.10645,33.09318],[35.1924,33.08743],[35.31429,33.10515],[35.35223,33.05617],[35.43059,33.06659],[35.448,33.09264],[35.50272,33.09056],[35.50335,33.114],[35.52573,33.11921],[35.54228,33.19865],[35.5362,33.23196],[35.54808,33.236],[35.54544,33.25513],[35.55555,33.25844],[35.56523,33.28969],[35.58326,33.28381],[35.58502,33.26653],[35.62283,33.24226],[35.62019,33.27278],[35.77477,33.33609],[35.81324,33.36354],[35.82577,33.40479],[35.88668,33.43183],[35.94816,33.47886]]]]}},{type:"Feature",properties:{iso1A2:"LC",iso1A3:"LCA",iso1N3:"662",wikidata:"Q760",nameEn:"St. Lucia",aliases:["WL"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 758"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.95997,14.20285],[-61.69315,14.26451],[-59.94058,12.34011],[-59.95997,14.20285]]]]}},{type:"Feature",properties:{iso1A2:"LI",iso1A3:"LIE",iso1N3:"438",wikidata:"Q347",nameEn:"Liechtenstein",aliases:["FL"],groups:["155","150","UN"],callingCodes:["423"]},geometry:{type:"MultiPolygon",coordinates:[[[[9.60717,47.06091],[9.61216,47.07732],[9.63395,47.08443],[9.62623,47.14685],[9.56539,47.17124],[9.58264,47.20673],[9.56981,47.21926],[9.55176,47.22585],[9.56766,47.24281],[9.53116,47.27029],[9.52406,47.24959],[9.50318,47.22153],[9.4891,47.19346],[9.48774,47.17402],[9.51044,47.13727],[9.52089,47.10019],[9.51362,47.08505],[9.47139,47.06402],[9.47548,47.05257],[9.54041,47.06495],[9.55721,47.04762],[9.60717,47.06091]]]]}},{type:"Feature",properties:{iso1A2:"LK",iso1A3:"LKA",iso1N3:"144",wikidata:"Q854",nameEn:"Sri Lanka",groups:["034","142","UN"],driveSide:"left",callingCodes:["94"]},geometry:{type:"MultiPolygon",coordinates:[[[[76.59015,5.591],[85.15017,5.21497],[80.48418,10.20786],[79.42124,9.80115],[79.50447,8.91876],[76.59015,5.591]]]]}},{type:"Feature",properties:{iso1A2:"LR",iso1A3:"LBR",iso1N3:"430",wikidata:"Q1014",nameEn:"Liberia",groups:["011","202","002","UN"],callingCodes:["231"]},geometry:{type:"MultiPolygon",coordinates:[[[[-8.47114,7.55676],[-8.55874,7.62525],[-8.55874,7.70167],[-8.67814,7.69428],[-8.72789,7.51429],[-8.8448,7.35149],[-8.85724,7.26019],[-8.93435,7.2824],[-9.09107,7.1985],[-9.18311,7.30461],[-9.20798,7.38109],[-9.305,7.42056],[-9.41943,7.41809],[-9.48161,7.37122],[-9.37465,7.62032],[-9.35724,7.74111],[-9.44928,7.9284],[-9.41445,8.02448],[-9.50898,8.18455],[-9.47415,8.35195],[-9.77763,8.54633],[-10.05873,8.42578],[-10.05375,8.50697],[-10.14579,8.52665],[-10.203,8.47991],[-10.27575,8.48711],[-10.30084,8.30008],[-10.31635,8.28554],[-10.29839,8.21283],[-10.35227,8.15223],[-10.45023,8.15627],[-10.51554,8.1393],[-10.57523,8.04829],[-10.60492,8.04072],[-10.60422,7.7739],[-11.29417,7.21576],[-11.4027,6.97746],[-11.50429,6.92704],[-12.15048,6.15992],[-7.52774,3.7105],[-7.53259,4.35145],[-7.59349,4.8909],[-7.53876,4.94294],[-7.55369,5.08667],[-7.48901,5.14118],[-7.46165,5.26256],[-7.36463,5.32944],[-7.43428,5.42355],[-7.37209,5.61173],[-7.43926,5.74787],[-7.43677,5.84687],[-7.46165,5.84934],[-7.48155,5.80974],[-7.67309,5.94337],[-7.70294,5.90625],[-7.78254,5.99037],[-7.79747,6.07696],[-7.8497,6.08932],[-7.83478,6.20309],[-7.90692,6.27728],[-8.00642,6.31684],[-8.17557,6.28222],[-8.3298,6.36381],[-8.38453,6.35887],[-8.45666,6.49977],[-8.48652,6.43797],[-8.59456,6.50612],[-8.31736,6.82837],[-8.29249,7.1691],[-8.37458,7.25794],[-8.41935,7.51203],[-8.47114,7.55676]]]]}},{type:"Feature",properties:{iso1A2:"LS",iso1A3:"LSO",iso1N3:"426",wikidata:"Q1013",nameEn:"Lesotho",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["266"]},geometry:{type:"MultiPolygon",coordinates:[[[[29.33204,-29.45598],[29.44883,-29.3772],[29.40524,-29.21246],[28.68043,-28.58744],[28.65091,-28.57025],[28.40612,-28.6215],[28.30518,-28.69531],[28.2348,-28.69471],[28.1317,-28.7293],[28.02503,-28.85991],[27.98675,-28.8787],[27.9392,-28.84864],[27.88933,-28.88156],[27.8907,-28.91612],[27.75458,-28.89839],[27.55974,-29.18954],[27.5158,-29.2261],[27.54258,-29.25575],[27.48679,-29.29349],[27.45125,-29.29708],[27.47254,-29.31968],[27.4358,-29.33465],[27.33464,-29.48161],[27.01016,-29.65439],[27.09489,-29.72796],[27.22719,-30.00718],[27.29603,-30.05473],[27.32555,-30.14785],[27.40778,-30.14577],[27.37293,-30.19401],[27.36649,-30.27246],[27.38108,-30.33456],[27.45452,-30.32239],[27.56901,-30.42504],[27.56781,-30.44562],[27.62137,-30.50509],[27.6521,-30.51707],[27.67819,-30.53437],[27.69467,-30.55862],[27.74814,-30.60635],[28.12073,-30.68072],[28.2319,-30.28476],[28.399,-30.1592],[28.68627,-30.12885],[28.80222,-30.10579],[28.9338,-30.05072],[29.16548,-29.91706],[29.12553,-29.76266],[29.28545,-29.58456],[29.33204,-29.45598]]]]}},{type:"Feature",properties:{iso1A2:"LT",iso1A3:"LTU",iso1N3:"440",wikidata:"Q37",nameEn:"Lithuania",groups:["EU","154","150","UN"],callingCodes:["370"]},geometry:{type:"MultiPolygon",coordinates:[[[[24.89005,56.46666],[24.83686,56.41565],[24.70022,56.40483],[24.57353,56.31525],[24.58143,56.29125],[24.42746,56.26522],[24.32334,56.30226],[24.13139,56.24881],[24.02657,56.3231],[23.75726,56.37282],[23.49803,56.34307],[23.40486,56.37689],[23.31606,56.3827],[23.17312,56.36795],[23.09531,56.30511],[22.96988,56.41213],[22.83048,56.367],[22.69354,56.36284],[22.56441,56.39305],[22.3361,56.4016],[22.09728,56.42851],[22.00548,56.41508],[21.74558,56.33181],[21.57888,56.31406],[21.49736,56.29106],[21.24644,56.16917],[21.15016,56.07818],[20.68447,56.04073],[20.60454,55.40986],[20.95181,55.27994],[21.26425,55.24456],[21.35465,55.28427],[21.38446,55.29348],[21.46766,55.21115],[21.51095,55.18507],[21.55605,55.20311],[21.64954,55.1791],[21.85521,55.09493],[21.96505,55.07353],[21.99543,55.08691],[22.03984,55.07888],[22.02582,55.05078],[22.06087,55.02935],[22.11697,55.02131],[22.14267,55.05345],[22.31562,55.0655],[22.47688,55.04408],[22.58907,55.07085],[22.60075,55.01863],[22.65451,54.97037],[22.68723,54.9811],[22.76422,54.92521],[22.85083,54.88711],[22.87317,54.79492],[22.73631,54.72952],[22.73397,54.66604],[22.75467,54.6483],[22.74225,54.64339],[22.7522,54.63525],[22.68021,54.58486],[22.71293,54.56454],[22.67788,54.532],[22.70208,54.45312],[22.7253,54.41732],[22.79705,54.36264],[22.83756,54.40827],[23.00584,54.38514],[22.99649,54.35927],[23.05726,54.34565],[23.04323,54.31567],[23.104,54.29794],[23.13905,54.31567],[23.15526,54.31076],[23.15938,54.29894],[23.24656,54.25701],[23.3494,54.25155],[23.39525,54.21672],[23.42418,54.17911],[23.45223,54.17775],[23.49196,54.14764],[23.52702,54.04622],[23.48261,53.98855],[23.51284,53.95052],[23.61677,53.92691],[23.71726,53.93379],[23.80543,53.89558],[23.81309,53.94205],[23.95098,53.9613],[23.98837,53.92554],[24.19638,53.96405],[24.34128,53.90076],[24.44411,53.90076],[24.62275,54.00217],[24.69652,54.01901],[24.69185,53.96543],[24.74279,53.96663],[24.85311,54.02862],[24.77131,54.11091],[24.96894,54.17589],[24.991,54.14241],[25.0728,54.13419],[25.19199,54.219],[25.22705,54.26271],[25.35559,54.26544],[25.509,54.30267],[25.56823,54.25212],[25.51452,54.17799],[25.54724,54.14925],[25.64875,54.1259],[25.71084,54.16704],[25.78563,54.15747],[25.78553,54.23327],[25.68513,54.31727],[25.55425,54.31591],[25.5376,54.33158],[25.63371,54.42075],[25.62203,54.4656],[25.64813,54.48704],[25.68045,54.5321],[25.75977,54.57252],[25.74122,54.80108],[25.89462,54.93438],[25.99129,54.95705],[26.05907,54.94631],[26.13386,54.98924],[26.20397,54.99729],[26.26941,55.08032],[26.23202,55.10439],[26.30628,55.12536],[26.35121,55.1525],[26.46249,55.12814],[26.51481,55.16051],[26.54753,55.14181],[26.69243,55.16718],[26.68075,55.19787],[26.72983,55.21788],[26.73017,55.24226],[26.835,55.28182],[26.83266,55.30444],[26.80929,55.31642],[26.6714,55.33902],[26.5709,55.32572],[26.44937,55.34832],[26.5522,55.40277],[26.55094,55.5093],[26.63167,55.57887],[26.63231,55.67968],[26.58248,55.6754],[26.46661,55.70375],[26.39561,55.71156],[26.18509,55.86813],[26.03815,55.95884],[25.90047,56.0013],[25.85893,56.00188],[25.81773,56.05444],[25.69246,56.08892],[25.68588,56.14725],[25.53621,56.16663],[25.39751,56.15707],[25.23099,56.19147],[25.09325,56.1878],[25.05762,56.26742],[24.89005,56.46666]]]]}},{type:"Feature",properties:{iso1A2:"LU",iso1A3:"LUX",iso1N3:"442",wikidata:"Q32",nameEn:"Luxembourg",groups:["EU","155","150","UN"],callingCodes:["352"]},geometry:{type:"MultiPolygon",coordinates:[[[[6.1379,50.12964],[6.1137,50.13668],[6.12028,50.16374],[6.08577,50.17246],[6.06406,50.15344],[6.03093,50.16362],[6.02488,50.18283],[5.96453,50.17259],[5.95929,50.13295],[5.89488,50.11476],[5.8857,50.07824],[5.85474,50.06342],[5.86904,50.04614],[5.8551,50.02683],[5.81866,50.01286],[5.82331,49.99662],[5.83968,49.9892],[5.83467,49.97823],[5.81163,49.97142],[5.80833,49.96451],[5.77291,49.96056],[5.77314,49.93646],[5.73621,49.89796],[5.78415,49.87922],[5.75269,49.8711],[5.75861,49.85631],[5.74567,49.85368],[5.75884,49.84811],[5.74953,49.84709],[5.74975,49.83933],[5.74076,49.83823],[5.7404,49.83452],[5.74844,49.82435],[5.74364,49.82058],[5.74953,49.81428],[5.75409,49.79239],[5.78871,49.7962],[5.82245,49.75048],[5.83149,49.74729],[5.82562,49.72395],[5.84193,49.72161],[5.86503,49.72739],[5.88677,49.70951],[5.86527,49.69291],[5.86175,49.67862],[5.9069,49.66377],[5.90164,49.6511],[5.90599,49.63853],[5.88552,49.63507],[5.88393,49.62802],[5.87609,49.62047],[5.8762,49.60898],[5.84826,49.5969],[5.84971,49.58674],[5.86986,49.58756],[5.87256,49.57539],[5.8424,49.56082],[5.84692,49.55663],[5.84143,49.5533],[5.81838,49.54777],[5.80871,49.5425],[5.81664,49.53775],[5.83648,49.5425],[5.84466,49.53027],[5.83467,49.52717],[5.83389,49.52152],[5.86571,49.50015],[5.94128,49.50034],[5.94224,49.49608],[5.96876,49.49053],[5.97693,49.45513],[6.02648,49.45451],[6.02743,49.44845],[6.04176,49.44801],[6.05553,49.46663],[6.07887,49.46399],[6.08373,49.45594],[6.10072,49.45268],[6.09845,49.46351],[6.10325,49.4707],[6.12346,49.4735],[6.12814,49.49365],[6.14321,49.48796],[6.16115,49.49297],[6.15366,49.50226],[6.17386,49.50934],[6.19543,49.50536],[6.2409,49.51408],[6.25029,49.50609],[6.27875,49.503],[6.28818,49.48465],[6.3687,49.4593],[6.36778,49.46937],[6.36907,49.48931],[6.36788,49.50377],[6.35666,49.52931],[6.38072,49.55171],[6.38228,49.55855],[6.35825,49.57053],[6.36676,49.57813],[6.38024,49.57593],[6.38342,49.5799],[6.37464,49.58886],[6.385,49.59946],[6.39822,49.60081],[6.41861,49.61723],[6.4413,49.65722],[6.43768,49.66021],[6.42726,49.66078],[6.42937,49.66857],[6.44654,49.67799],[6.46048,49.69092],[6.48014,49.69767],[6.49785,49.71118],[6.50647,49.71353],[6.5042,49.71808],[6.49694,49.72205],[6.49535,49.72645],[6.50261,49.72718],[6.51397,49.72058],[6.51805,49.72425],[6.50193,49.73291],[6.50174,49.75292],[6.51646,49.75961],[6.51828,49.76855],[6.51056,49.77515],[6.51669,49.78336],[6.50534,49.78952],[6.52169,49.79787],[6.53122,49.80666],[6.52121,49.81338],[6.51215,49.80124],[6.50647,49.80916],[6.48718,49.81267],[6.47111,49.82263],[6.45425,49.81164],[6.44131,49.81443],[6.42905,49.81091],[6.42521,49.81591],[6.40022,49.82029],[6.36576,49.85032],[6.34267,49.84974],[6.33585,49.83785],[6.32098,49.83728],[6.32303,49.85133],[6.30963,49.87021],[6.29692,49.86685],[6.28874,49.87592],[6.26146,49.88203],[6.23496,49.89972],[6.22926,49.92096],[6.21882,49.92403],[6.22608,49.929],[6.22094,49.94955],[6.19856,49.95053],[6.19089,49.96991],[6.18045,49.96611],[6.18554,49.95622],[6.17872,49.9537],[6.16466,49.97086],[6.1701,49.98518],[6.14147,49.99563],[6.14948,50.00908],[6.13806,50.01056],[6.1295,50.01849],[6.13273,50.02019],[6.13794,50.01466],[6.14666,50.02207],[6.13044,50.02929],[6.13458,50.04141],[6.11274,50.05916],[6.12055,50.09171],[6.1379,50.12964]]]]}},{type:"Feature",properties:{iso1A2:"LV",iso1A3:"LVA",iso1N3:"428",wikidata:"Q211",nameEn:"Latvia",groups:["EU","154","150","UN"],callingCodes:["371"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.34698,57.52242],[26.90364,57.62823],[26.54675,57.51813],[26.46527,57.56885],[26.29253,57.59244],[26.1866,57.6849],[26.2029,57.7206],[26.08098,57.76619],[26.0543,57.76105],[26.03332,57.7718],[26.02415,57.76865],[26.02069,57.77169],[26.0266,57.77441],[26.027,57.78158],[26.02456,57.78342],[26.0324,57.79037],[26.05949,57.84744],[25.73499,57.90193],[25.29581,58.08288],[25.28237,57.98539],[25.19484,58.0831],[24.3579,57.87471],[24.26221,57.91787],[23.20055,57.56697],[22.80496,57.87798],[19.84909,57.57876],[19.64795,57.06466],[20.68447,56.04073],[21.15016,56.07818],[21.24644,56.16917],[21.49736,56.29106],[21.57888,56.31406],[21.74558,56.33181],[22.00548,56.41508],[22.09728,56.42851],[22.3361,56.4016],[22.56441,56.39305],[22.69354,56.36284],[22.83048,56.367],[22.96988,56.41213],[23.09531,56.30511],[23.17312,56.36795],[23.31606,56.3827],[23.40486,56.37689],[23.49803,56.34307],[23.75726,56.37282],[24.02657,56.3231],[24.13139,56.24881],[24.32334,56.30226],[24.42746,56.26522],[24.58143,56.29125],[24.57353,56.31525],[24.70022,56.40483],[24.83686,56.41565],[24.89005,56.46666],[25.05762,56.26742],[25.09325,56.1878],[25.23099,56.19147],[25.39751,56.15707],[25.53621,56.16663],[25.68588,56.14725],[25.69246,56.08892],[25.81773,56.05444],[25.85893,56.00188],[25.90047,56.0013],[26.03815,55.95884],[26.18509,55.86813],[26.39561,55.71156],[26.46661,55.70375],[26.58248,55.6754],[26.63231,55.67968],[26.64888,55.70515],[26.71802,55.70645],[26.76872,55.67658],[26.87448,55.7172],[26.97153,55.8102],[27.1559,55.85032],[27.27804,55.78299],[27.3541,55.8089],[27.61683,55.78558],[27.63065,55.89687],[27.97865,56.11849],[28.15217,56.16964],[28.23716,56.27588],[28.16599,56.37806],[28.19057,56.44637],[28.10069,56.524],[28.13526,56.57989],[28.04768,56.59004],[27.86101,56.88204],[27.66511,56.83921],[27.86101,57.29402],[27.52453,57.42826],[27.56832,57.53728],[27.34698,57.52242]]]]}},{type:"Feature",properties:{iso1A2:"LY",iso1A3:"LBY",iso1N3:"434",wikidata:"Q1016",nameEn:"Libya",groups:["015","002","UN"],callingCodes:["218"]},geometry:{type:"MultiPolygon",coordinates:[[[[26.92891,33.39516],[11.58941,33.36891],[11.55852,33.1409],[11.51549,33.09826],[11.46037,32.6307],[11.57828,32.48013],[11.53898,32.4138],[11.04234,32.2145],[10.7315,31.97235],[10.62788,31.96629],[10.48497,31.72956],[10.31364,31.72648],[10.12239,31.42098],[10.29516,30.90337],[9.88152,30.34074],[9.76848,30.34366],[9.55544,30.23971],[9.3876,30.16738],[9.78136,29.40961],[9.89569,26.57696],[9.51696,26.39148],[9.38834,26.19288],[10.03146,25.35635],[10.02432,24.98124],[10.33159,24.5465],[10.85323,24.5595],[11.41061,24.21456],[11.62498,24.26669],[11.96886,23.51735],[13.5631,23.16574],[14.22918,22.61719],[14.99751,23.00539],[15.99566,23.49639],[23.99539,19.49944],[23.99715,20.00038],[24.99794,19.99661],[24.99885,21.99535],[24.99968,29.24574],[24.71117,30.17441],[25.01077,30.73861],[24.8458,31.39877],[26.92891,33.39516]]]]}},{type:"Feature",properties:{iso1A2:"MA",iso1A3:"MAR",iso1N3:"504",wikidata:"Q1028",nameEn:"Morocco",groups:["015","002","UN"],callingCodes:["212"]},geometry:{type:"MultiPolygon",coordinates:[[[[-2.27707,35.35051],[-5.10878,36.05227],[-7.2725,35.73269],[-14.43883,27.02969],[-17.27295,21.93519],[-17.21511,21.34226],[-17.02707,21.34022],[-16.9978,21.36239],[-16.44269,21.39745],[-14.78487,21.36587],[-14.47329,21.63839],[-14.48112,22.00886],[-14.1291,22.41636],[-14.10361,22.75501],[-13.75627,23.77231],[-13.00628,24.01923],[-12.92147,24.39502],[-12.12281,25.13682],[-12.06001,26.04442],[-11.62052,26.05229],[-11.38635,26.611],[-11.23622,26.72023],[-11.35695,26.8505],[-10.68417,26.90984],[-9.81998,26.71379],[-9.56957,26.90042],[-9.08698,26.98639],[-8.71787,26.9898],[-8.77527,27.66663],[-8.66879,27.6666],[-8.6715,28.71194],[-7.61585,29.36252],[-6.95824,29.50924],[-6.78351,29.44634],[-6.69965,29.51623],[-5.75616,29.61407],[-5.72121,29.52322],[-5.58831,29.48103],[-5.21671,29.95253],[-4.6058,30.28343],[-4.31774,30.53229],[-3.64735,30.67539],[-3.65418,30.85566],[-3.54944,31.0503],[-3.77103,31.14984],[-3.77647,31.31912],[-3.66386,31.39202],[-3.66314,31.6339],[-2.82784,31.79459],[-2.93873,32.06557],[-2.46166,32.16603],[-1.22829,32.07832],[-1.15735,32.12096],[-1.24453,32.1917],[-1.24998,32.32993],[-.9912,32.52467],[-1.37794,32.73628],[-1.54244,32.95499],[-1.46249,33.0499],[-1.67067,33.27084],[-1.59508,33.59929],[-1.73494,33.71721],[-1.64666,34.10405],[-1.78042,34.39018],[-1.69788,34.48056],[-1.84569,34.61907],[-1.73707,34.74226],[-1.97469,34.886],[-1.97833,34.93218],[-2.04734,34.93218],[-2.21445,35.04378],[-2.21248,35.08532],[-2.27707,35.35051]],[[-2.91909,35.33927],[-2.92272,35.27509],[-2.93893,35.26737],[-2.95065,35.26576],[-2.95431,35.2728],[-2.96516,35.27967],[-2.96826,35.28296],[-2.96507,35.28801],[-2.97035,35.28852],[-2.96978,35.29459],[-2.96648,35.30475],[-2.96038,35.31609],[-2.91909,35.33927]],[[-3.90602,35.21494],[-3.89343,35.22728],[-3.88372,35.20767],[-3.90602,35.21494]],[[-4.30191,35.17419],[-4.29436,35.17149],[-4.30112,35.17058],[-4.30191,35.17419]],[[-2.40316,35.16893],[-2.45965,35.16527],[-2.43262,35.20652],[-2.40316,35.16893]],[[-5.38491,35.92591],[-5.21179,35.90091],[-5.34379,35.8711],[-5.35844,35.87375],[-5.37338,35.88417],[-5.38491,35.92591]]]]}},{type:"Feature",properties:{iso1A2:"MC",iso1A3:"MCO",iso1N3:"492",wikidata:"Q235",nameEn:"Monaco",groups:["155","150","UN"],callingCodes:["377"]},geometry:{type:"MultiPolygon",coordinates:[[[[7.47823,43.73341],[7.4379,43.74963],[7.4389,43.75151],[7.43708,43.75197],[7.43624,43.75014],[7.43013,43.74895],[7.42809,43.74396],[7.42443,43.74087],[7.42299,43.74176],[7.42062,43.73977],[7.41233,43.73439],[7.41298,43.73311],[7.41291,43.73168],[7.41113,43.73156],[7.40903,43.7296],[7.42422,43.72209],[7.47823,43.73341]]]]}},{type:"Feature",properties:{iso1A2:"MD",iso1A3:"MDA",iso1N3:"498",wikidata:"Q217",nameEn:"Moldova",groups:["151","150","UN"],callingCodes:["373"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.74422,48.45926],[27.6658,48.44034],[27.59027,48.46311],[27.5889,48.49224],[27.46942,48.454],[27.44333,48.41209],[27.37741,48.41026],[27.37604,48.44398],[27.32159,48.4434],[27.27855,48.37534],[27.13434,48.37288],[27.08078,48.43214],[27.0231,48.42485],[27.03821,48.37653],[26.93384,48.36558],[26.85556,48.41095],[26.71274,48.40388],[26.82809,48.31629],[26.79239,48.29071],[26.6839,48.35828],[26.62823,48.25804],[26.81161,48.25049],[26.87708,48.19919],[26.94265,48.1969],[26.98042,48.15752],[26.96119,48.13003],[27.04118,48.12522],[27.02985,48.09083],[27.15622,47.98538],[27.1618,47.92391],[27.29069,47.73722],[27.25519,47.71366],[27.32202,47.64009],[27.3979,47.59473],[27.47942,47.48113],[27.55731,47.46637],[27.60263,47.32507],[27.68706,47.28962],[27.73172,47.29248],[27.81892,47.1381],[28.09095,46.97621],[28.12173,46.82283],[28.24808,46.64305],[28.22281,46.50481],[28.25769,46.43334],[28.18902,46.35283],[28.19864,46.31869],[28.10937,46.22852],[28.13684,46.18099],[28.08612,46.01105],[28.13111,45.92819],[28.16568,45.6421],[28.08927,45.6051],[28.18741,45.47358],[28.21139,45.46895],[28.30201,45.54744],[28.41836,45.51715],[28.43072,45.48538],[28.51449,45.49982],[28.49252,45.56716],[28.54196,45.58062],[28.51587,45.6613],[28.47879,45.66994],[28.52823,45.73803],[28.70401,45.78019],[28.69852,45.81753],[28.78503,45.83475],[28.74383,45.96664],[28.98004,46.00385],[29.00613,46.04962],[28.94643,46.09176],[29.06656,46.19716],[28.94953,46.25852],[28.98478,46.31803],[29.004,46.31495],[28.9306,46.45699],[29.01241,46.46177],[29.02409,46.49582],[29.23547,46.55435],[29.24886,46.37912],[29.35357,46.49505],[29.49914,46.45889],[29.5939,46.35472],[29.6763,46.36041],[29.66359,46.4215],[29.74496,46.45605],[29.88329,46.35851],[29.94114,46.40114],[30.09103,46.38694],[30.16794,46.40967],[30.02511,46.45132],[29.88916,46.54302],[29.94409,46.56002],[29.9743,46.75325],[29.94522,46.80055],[29.98814,46.82358],[29.87405,46.88199],[29.75458,46.8604],[29.72986,46.92234],[29.57056,46.94766],[29.62137,47.05069],[29.61038,47.09932],[29.53044,47.07851],[29.49732,47.12878],[29.57696,47.13581],[29.54996,47.24962],[29.59665,47.25521],[29.5733,47.36508],[29.48678,47.36043],[29.47854,47.30366],[29.39889,47.30179],[29.3261,47.44664],[29.18603,47.43387],[29.11743,47.55001],[29.22414,47.60012],[29.22242,47.73607],[29.27255,47.79953],[29.20663,47.80367],[29.27804,47.88893],[29.19839,47.89261],[29.1723,47.99013],[28.9306,47.96255],[28.8414,48.03392],[28.85232,48.12506],[28.69896,48.13106],[28.53921,48.17453],[28.48428,48.0737],[28.42454,48.12047],[28.43701,48.15832],[28.38712,48.17567],[28.34009,48.13147],[28.30609,48.14018],[28.30586,48.1597],[28.34912,48.1787],[28.36996,48.20543],[28.35519,48.24957],[28.32508,48.23384],[28.2856,48.23202],[28.19314,48.20749],[28.17666,48.25963],[28.07504,48.23494],[28.09873,48.3124],[28.04527,48.32661],[27.95883,48.32368],[27.88391,48.36699],[27.87533,48.4037],[27.81902,48.41874],[27.79225,48.44244],[27.74422,48.45926]]]]}},{type:"Feature",properties:{iso1A2:"ME",iso1A3:"MNE",iso1N3:"499",wikidata:"Q236",nameEn:"Montenegro",groups:["039","150","UN"],callingCodes:["382"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.22807,43.5264],[19.15685,43.53943],[19.13933,43.5282],[19.04934,43.50384],[19.01078,43.55806],[18.91379,43.50299],[18.95469,43.49367],[18.96053,43.45042],[19.01078,43.43854],[19.04071,43.397],[19.08673,43.31453],[19.08206,43.29668],[19.04233,43.30008],[19.00844,43.24988],[18.95001,43.29327],[18.95819,43.32899],[18.90911,43.36383],[18.83912,43.34795],[18.84794,43.33735],[18.85342,43.32426],[18.76538,43.29838],[18.6976,43.25243],[18.71747,43.2286],[18.66605,43.2056],[18.64735,43.14766],[18.66254,43.03928],[18.52232,43.01451],[18.49076,42.95553],[18.49661,42.89306],[18.4935,42.86433],[18.47633,42.85829],[18.45921,42.81682],[18.47324,42.74992],[18.56789,42.72074],[18.55221,42.69045],[18.54603,42.69171],[18.54841,42.68328],[18.57373,42.64429],[18.52232,42.62279],[18.55504,42.58409],[18.53751,42.57376],[18.49778,42.58409],[18.43735,42.55921],[18.44307,42.51077],[18.43588,42.48556],[18.52152,42.42302],[18.54128,42.39171],[18.45131,42.21682],[19.26406,41.74971],[19.37597,41.84849],[19.37451,41.8842],[19.33812,41.90669],[19.34601,41.95675],[19.37691,41.96977],[19.36867,42.02564],[19.37548,42.06835],[19.40687,42.10024],[19.28623,42.17745],[19.42,42.33019],[19.42352,42.36546],[19.4836,42.40831],[19.65972,42.62774],[19.73244,42.66299],[19.77375,42.58517],[19.74731,42.57422],[19.76549,42.50237],[19.82333,42.46581],[19.9324,42.51699],[20.00842,42.5109],[20.01834,42.54622],[20.07761,42.55582],[20.0969,42.65559],[20.02915,42.71147],[20.02088,42.74789],[20.04898,42.77701],[20.2539,42.76245],[20.27869,42.81945],[20.35692,42.8335],[20.34528,42.90676],[20.16415,42.97177],[20.14896,42.99058],[20.12325,42.96237],[20.05431,42.99571],[20.04729,43.02732],[19.98887,43.0538],[19.96549,43.11098],[19.92576,43.08539],[19.79255,43.11951],[19.76918,43.16044],[19.64063,43.19027],[19.62661,43.2286],[19.54598,43.25158],[19.52962,43.31623],[19.48171,43.32644],[19.44315,43.38846],[19.22229,43.47926],[19.22807,43.5264]]]]}},{type:"Feature",properties:{iso1A2:"MF",iso1A3:"MAF",iso1N3:"663",wikidata:"Q126125",nameEn:"Saint-Martin",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["590"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.93924,18.02904],[-62.62718,18.26185],[-63.35989,18.06012],[-63.33064,17.9615],[-63.13502,18.05445],[-63.11042,18.05339],[-63.09686,18.04608],[-63.07759,18.04943],[-63.0579,18.06614],[-63.04039,18.05619],[-63.02323,18.05757],[-62.93924,18.02904]]]]}},{type:"Feature",properties:{iso1A2:"MG",iso1A3:"MDG",iso1N3:"450",wikidata:"Q1019",nameEn:"Madagascar",aliases:["RM"],groups:["014","202","002","UN"],callingCodes:["261"]},geometry:{type:"MultiPolygon",coordinates:[[[[51.93891,-10.85085],[45.84651,-12.77177],[42.14681,-19.63341],[45.80092,-33.00974],[51.93891,-10.85085]]]]}},{type:"Feature",properties:{iso1A2:"MH",iso1A3:"MHL",iso1N3:"584",wikidata:"Q709",nameEn:"Marshall Islands",groups:["057","009","UN"],roadSpeedUnit:"mph",callingCodes:["692"]},geometry:{type:"MultiPolygon",coordinates:[[[[169,3.9],[173.53711,5.70687],[169.29099,15.77133],[159.04653,10.59067],[169,3.9]]]]}},{type:"Feature",properties:{iso1A2:"MK",iso1A3:"MKD",iso1N3:"807",wikidata:"Q221",nameEn:"North Macedonia",groups:["039","150","UN"],callingCodes:["389"]},geometry:{type:"MultiPolygon",coordinates:[[[[22.34773,42.31725],[22.29275,42.34913],[22.29605,42.37477],[22.16384,42.32103],[22.02908,42.29848],[21.94405,42.34669],[21.91595,42.30392],[21.84654,42.3247],[21.77176,42.2648],[21.70111,42.23789],[21.58992,42.25915],[21.52145,42.24465],[21.50823,42.27156],[21.43882,42.2789],[21.43882,42.23609],[21.38428,42.24465],[21.30496,42.1418],[21.29913,42.13954],[21.31983,42.10993],[21.22728,42.08909],[21.16614,42.19815],[21.11491,42.20794],[20.75464,42.05229],[20.76786,41.91839],[20.68523,41.85318],[20.59524,41.8818],[20.55976,41.87068],[20.57144,41.7897],[20.53405,41.78099],[20.51301,41.72433],[20.52937,41.69292],[20.51769,41.65975],[20.55508,41.58113],[20.52103,41.56473],[20.45809,41.5549],[20.45331,41.51436],[20.49039,41.49277],[20.51301,41.442],[20.55976,41.4087],[20.52119,41.34381],[20.49432,41.33679],[20.51068,41.2323],[20.59715,41.13644],[20.58546,41.11179],[20.59832,41.09066],[20.63454,41.0889],[20.65558,41.08009],[20.71634,40.91781],[20.73504,40.9081],[20.81567,40.89662],[20.83671,40.92752],[20.94305,40.92399],[20.97693,40.90103],[20.97887,40.85475],[21.15262,40.85546],[21.21105,40.8855],[21.25779,40.86165],[21.35595,40.87578],[21.41555,40.9173],[21.53007,40.90759],[21.57448,40.86076],[21.69601,40.9429],[21.7556,40.92525],[21.91102,41.04786],[21.90869,41.09191],[22.06527,41.15617],[22.1424,41.12449],[22.17629,41.15969],[22.26744,41.16409],[22.42285,41.11921],[22.5549,41.13065],[22.58295,41.11568],[22.62852,41.14385],[22.65306,41.18168],[22.71266,41.13945],[22.74538,41.16321],[22.76408,41.32225],[22.81199,41.3398],[22.93334,41.34104],[22.96331,41.35782],[22.95513,41.63265],[23.03342,41.71034],[23.01239,41.76527],[22.96682,41.77137],[22.90254,41.87587],[22.86749,42.02275],[22.67701,42.06614],[22.51224,42.15457],[22.50289,42.19527],[22.47251,42.20393],[22.38136,42.30339],[22.34773,42.31725]]]]}},{type:"Feature",properties:{iso1A2:"ML",iso1A3:"MLI",iso1N3:"466",wikidata:"Q912",nameEn:"Mali",groups:["011","202","002","UN"],callingCodes:["223"]},geometry:{type:"MultiPolygon",coordinates:[[[[-4.83423,24.99935],[-6.57191,25.0002],[-5.60725,16.49919],[-5.33435,16.33354],[-5.50165,15.50061],[-9.32979,15.50032],[-9.31106,15.69412],[-9.33314,15.7044],[-9.44673,15.60553],[-9.40447,15.4396],[-10.71721,15.4223],[-10.90932,15.11001],[-11.43483,15.62339],[-11.70705,15.51558],[-11.94903,14.76143],[-12.23936,14.76324],[-11.93043,13.84505],[-12.06897,13.71049],[-11.83345,13.33333],[-11.63025,13.39174],[-11.39935,12.97808],[-11.37536,12.40788],[-11.50006,12.17826],[-11.24136,12.01286],[-10.99758,12.24634],[-10.80355,12.1053],[-10.71897,11.91552],[-10.30604,12.24634],[-9.714,12.0226],[-9.63938,12.18312],[-9.32097,12.29009],[-9.38067,12.48446],[-9.13689,12.50875],[-8.94784,12.34842],[-8.80854,11.66715],[-8.40058,11.37466],[-8.66923,10.99397],[-8.35083,11.06234],[-8.2667,10.91762],[-8.32614,10.69273],[-8.22711,10.41722],[-8.10207,10.44649],[-7.9578,10.2703],[-7.97971,10.17117],[-7.92107,10.15577],[-7.63048,10.46334],[-7.54462,10.40921],[-7.52261,10.4655],[-7.44555,10.44602],[-7.3707,10.24677],[-7.13331,10.24877],[-7.0603,10.14711],[-7.00966,10.15794],[-6.97444,10.21644],[-7.01186,10.25111],[-6.93921,10.35291],[-6.68164,10.35074],[-6.63541,10.66893],[-6.52974,10.59104],[-6.42847,10.5694],[-6.40646,10.69922],[-6.325,10.68624],[-6.24795,10.74248],[-6.1731,10.46983],[-6.18851,10.24244],[-5.99478,10.19694],[-5.78124,10.43952],[-5.65135,10.46767],[-5.51058,10.43177],[-5.46643,10.56074],[-5.47083,10.75329],[-5.41579,10.84628],[-5.49284,11.07538],[-5.32994,11.13371],[-5.32553,11.21578],[-5.25949,11.24816],[-5.25509,11.36905],[-5.20665,11.43811],[-5.22867,11.60421],[-5.29251,11.61715],[-5.26389,11.75728],[-5.40258,11.8327],[-5.26389,11.84778],[-5.07897,11.97918],[-4.72893,12.01579],[-4.70692,12.06746],[-4.62987,12.06531],[-4.62546,12.13204],[-4.54841,12.1385],[-4.57703,12.19875],[-4.41412,12.31922],[-4.47356,12.71252],[-4.238,12.71467],[-4.21819,12.95722],[-4.34477,13.12927],[-3.96501,13.49778],[-3.90558,13.44375],[-3.96282,13.38164],[-3.7911,13.36665],[-3.54454,13.1781],[-3.4313,13.1588],[-3.43507,13.27272],[-3.23599,13.29035],[-3.28396,13.5422],[-3.26407,13.70699],[-2.88189,13.64921],[-2.90831,13.81174],[-2.84667,14.05532],[-2.66175,14.14713],[-2.47587,14.29671],[-2.10223,14.14878],[-1.9992,14.19011],[-1.97945,14.47709],[-1.68083,14.50023],[-1.32166,14.72774],[-1.05875,14.7921],[-.72004,15.08655],[-.24673,15.07805],[.06588,14.96961],[.23859,15.00135],[.72632,14.95898],[.96711,14.98275],[1.31275,15.27978],[3.01806,15.34571],[3.03134,15.42221],[3.50368,15.35934],[4.19893,16.39923],[4.21787,17.00118],[4.26762,17.00432],[4.26651,19.14224],[3.36082,18.9745],[3.12501,19.1366],[3.24648,19.81703],[1.20992,20.73533],[1.15698,21.12843],[-4.83423,24.99935]]]]}},{type:"Feature",properties:{iso1A2:"MM",iso1A3:"MMR",iso1N3:"104",wikidata:"Q836",nameEn:"Myanmar",aliases:["Burma","BU"],groups:["035","142","UN"],callingCodes:["95"]},geometry:{type:"MultiPolygon",coordinates:[[[[92.62187,21.87037],[92.59775,21.6092],[92.68152,21.28454],[92.60187,21.24615],[92.55105,21.3856],[92.43158,21.37025],[92.37939,21.47764],[92.20087,21.337],[92.17752,21.17445],[92.26071,21.05697],[92.47409,20.38654],[92.61042,13.76986],[94.6371,13.81803],[97.63455,9.60854],[98.12555,9.44056],[98.33094,9.91973],[98.47298,9.95782],[98.52291,9.92389],[98.55174,9.92804],[98.7391,10.31488],[98.81944,10.52761],[98.77275,10.62548],[98.78511,10.68351],[98.86819,10.78336],[99.0069,10.85485],[98.99701,10.92962],[99.02337,10.97217],[99.06938,10.94857],[99.32756,11.28545],[99.31573,11.32081],[99.39485,11.3925],[99.47598,11.62434],[99.5672,11.62732],[99.64108,11.78948],[99.64891,11.82699],[99.53424,12.02317],[99.56445,12.14805],[99.47519,12.1353],[99.409,12.60603],[99.29254,12.68921],[99.18905,12.84799],[99.18748,12.9898],[99.10646,13.05804],[99.12225,13.19847],[99.20617,13.20575],[99.16695,13.72621],[98.97356,14.04868],[98.56762,14.37701],[98.24874,14.83013],[98.18821,15.13125],[98.22,15.21327],[98.30446,15.30667],[98.40522,15.25268],[98.41906,15.27103],[98.39351,15.34177],[98.4866,15.39154],[98.56027,15.33471],[98.58598,15.46821],[98.541,15.65406],[98.59853,15.87197],[98.57019,16.04578],[98.69585,16.13353],[98.8376,16.11706],[98.92656,16.36425],[98.84485,16.42354],[98.68074,16.27068],[98.63817,16.47424],[98.57912,16.55983],[98.5695,16.62826],[98.51113,16.64503],[98.51833,16.676],[98.51472,16.68521],[98.51579,16.69433],[98.51043,16.70107],[98.49713,16.69022],[98.50253,16.7139],[98.46994,16.73613],[98.53833,16.81934],[98.49603,16.8446],[98.52624,16.89979],[98.39441,17.06266],[98.34566,17.04822],[98.10439,17.33847],[98.11185,17.36829],[97.91829,17.54504],[97.76407,17.71595],[97.66794,17.88005],[97.73723,17.97912],[97.60841,18.23846],[97.64116,18.29778],[97.56219,18.33885],[97.50383,18.26844],[97.34522,18.54596],[97.36444,18.57138],[97.5258,18.4939],[97.76752,18.58097],[97.73836,18.88478],[97.66487,18.9371],[97.73654,18.9812],[97.73797,19.04261],[97.83479,19.09972],[97.84024,19.22217],[97.78606,19.26769],[97.84186,19.29526],[97.78769,19.39429],[97.88423,19.5041],[97.84715,19.55782],[98.04364,19.65755],[98.03314,19.80941],[98.13829,19.78541],[98.24884,19.67876],[98.51182,19.71303],[98.56065,19.67807],[98.83661,19.80931],[98.98679,19.7419],[99.0735,20.10298],[99.20328,20.12877],[99.416,20.08614],[99.52943,20.14811],[99.5569,20.20676],[99.46077,20.36198],[99.46008,20.39673],[99.68255,20.32077],[99.81096,20.33687],[99.86383,20.44371],[99.88211,20.44488],[99.88451,20.44596],[99.89168,20.44548],[99.89301,20.44311],[99.89692,20.44789],[99.90499,20.4487],[99.91616,20.44986],[99.95721,20.46301],[100.08404,20.36626],[100.1957,20.68247],[100.36375,20.82783],[100.51079,20.82194],[100.60112,20.8347],[100.64628,20.88279],[100.50974,20.88574],[100.55281,21.02796],[100.63578,21.05639],[100.72716,21.31786],[100.80173,21.2934],[101.00234,21.39612],[101.16198,21.52808],[101.15156,21.56129],[101.11744,21.77659],[100.87265,21.67396],[100.72143,21.51898],[100.57861,21.45637],[100.4811,21.46148],[100.42892,21.54325],[100.35201,21.53176],[100.25863,21.47043],[100.18447,21.51898],[100.1625,21.48704],[100.12542,21.50365],[100.10757,21.59945],[100.17486,21.65306],[100.12679,21.70539],[100.04956,21.66843],[99.98654,21.71064],[99.94003,21.82782],[99.99084,21.97053],[99.96612,22.05965],[99.85351,22.04183],[99.47585,22.13345],[99.33166,22.09656],[99.1552,22.15874],[99.19176,22.16983],[99.17318,22.18025],[99.28771,22.4105],[99.37972,22.50188],[99.38247,22.57544],[99.31243,22.73893],[99.45654,22.85726],[99.43537,22.94086],[99.54218,22.90014],[99.52214,23.08218],[99.34127,23.13099],[99.25741,23.09025],[99.04601,23.12215],[99.05975,23.16382],[98.88597,23.18656],[98.92515,23.29535],[98.93958,23.31414],[98.87573,23.33038],[98.92104,23.36946],[98.87683,23.48995],[98.82877,23.47908],[98.80294,23.5345],[98.88396,23.59555],[98.81775,23.694],[98.82933,23.72921],[98.79607,23.77947],[98.68209,23.80492],[98.67797,23.9644],[98.89632,24.10612],[98.87998,24.15624],[98.85319,24.13042],[98.59256,24.08371],[98.54476,24.13119],[98.20666,24.11406],[98.07806,24.07988],[98.06703,24.08028],[98.0607,24.07812],[98.05671,24.07961],[98.05302,24.07408],[98.04709,24.07616],[97.99583,24.04932],[97.98691,24.03897],[97.93951,24.01953],[97.90998,24.02094],[97.88616,24.00463],[97.88414,23.99405],[97.88814,23.98605],[97.89683,23.98389],[97.89676,23.97931],[97.8955,23.97758],[97.88811,23.97446],[97.86545,23.97723],[97.84328,23.97603],[97.79416,23.95663],[97.79456,23.94836],[97.72302,23.89288],[97.64667,23.84574],[97.5247,23.94032],[97.62363,24.00506],[97.72903,24.12606],[97.75305,24.16902],[97.72799,24.18883],[97.72998,24.2302],[97.76799,24.26365],[97.71941,24.29652],[97.66723,24.30027],[97.65624,24.33781],[97.7098,24.35658],[97.66998,24.45288],[97.60029,24.4401],[97.52757,24.43748],[97.56286,24.54535],[97.56525,24.72838],[97.54675,24.74202],[97.5542,24.74943],[97.56383,24.75535],[97.56648,24.76475],[97.64354,24.79171],[97.70181,24.84557],[97.73127,24.83015],[97.76481,24.8289],[97.79949,24.85655],[97.72903,24.91332],[97.72216,25.08508],[97.77023,25.11492],[97.83614,25.2715],[97.92541,25.20815],[98.14925,25.41547],[98.12591,25.50722],[98.18084,25.56298],[98.16848,25.62739],[98.25774,25.6051],[98.31268,25.55307],[98.40606,25.61129],[98.54064,25.85129],[98.63128,25.79937],[98.70818,25.86241],[98.60763,26.01512],[98.57085,26.11547],[98.63128,26.15492],[98.66884,26.09165],[98.7329,26.17218],[98.67797,26.24487],[98.72741,26.36183],[98.77547,26.61994],[98.7333,26.85615],[98.69582,27.56499],[98.43353,27.67086],[98.42529,27.55404],[98.32641,27.51385],[98.13964,27.9478],[98.15337,28.12114],[97.90069,28.3776],[97.79632,28.33168],[97.70705,28.5056],[97.56835,28.55628],[97.50518,28.49716],[97.47085,28.2688],[97.41729,28.29783],[97.34547,28.21385],[97.31292,28.06784],[97.35412,28.06663],[97.38845,28.01329],[97.35824,27.87256],[97.29919,27.92233],[96.90112,27.62149],[96.91431,27.45752],[97.17422,27.14052],[97.14675,27.09041],[96.89132,27.17474],[96.85287,27.2065],[96.88445,27.25046],[96.73888,27.36638],[96.55761,27.29928],[96.40779,27.29818],[96.15591,27.24572],[96.04949,27.19428],[95.93002,27.04149],[95.81603,27.01335],[95.437,26.7083],[95.30339,26.65372],[95.23513,26.68499],[95.05798,26.45408],[95.12801,26.38397],[95.11428,26.1019],[95.18556,26.07338],[94.80117,25.49359],[94.68032,25.47003],[94.57458,25.20318],[94.74212,25.13606],[94.73937,25.00545],[94.60204,24.70889],[94.5526,24.70764],[94.50729,24.59281],[94.45279,24.56656],[94.32362,24.27692],[94.30215,24.23752],[94.14081,23.83333],[93.92089,23.95812],[93.80279,23.92549],[93.75952,24.0003],[93.62871,24.00922],[93.50616,23.94432],[93.46633,23.97067],[93.41415,24.07854],[93.34735,24.10151],[93.32351,24.04468],[93.36059,23.93176],[93.3908,23.92925],[93.3908,23.7622],[93.43475,23.68299],[93.38805,23.4728],[93.39981,23.38828],[93.38781,23.36139],[93.36862,23.35426],[93.38478,23.13698],[93.2878,23.00464],[93.12988,23.05772],[93.134,22.92498],[93.09417,22.69459],[93.134,22.59573],[93.11477,22.54374],[93.13537,22.45873],[93.18206,22.43716],[93.19991,22.25425],[93.14224,22.24535],[93.15734,22.18687],[93.04885,22.20595],[92.99255,22.05965],[92.99804,21.98964],[92.93899,22.02656],[92.89504,21.95143],[92.86208,22.05456],[92.70416,22.16017],[92.67532,22.03547],[92.60949,21.97638],[92.62187,21.87037]]]]}},{type:"Feature",properties:{iso1A2:"MN",iso1A3:"MNG",iso1N3:"496",wikidata:"Q711",nameEn:"Mongolia",groups:["030","142","UN"],callingCodes:["976"]},geometry:{type:"MultiPolygon",coordinates:[[[[102.14032,51.35566],[101.5044,51.50467],[101.39085,51.45753],[100.61116,51.73028],[99.89203,51.74903],[99.75578,51.90108],[99.27888,51.96876],[98.87768,52.14563],[98.74142,51.8637],[98.33222,51.71832],[98.22053,51.46579],[98.05257,51.46696],[97.83305,51.00248],[98.01472,50.86652],[97.9693,50.78044],[98.06393,50.61262],[98.31373,50.4996],[98.29481,50.33561],[97.85197,49.91339],[97.76871,49.99861],[97.56432,49.92801],[97.56811,49.84265],[97.24639,49.74737],[96.97388,49.88413],[95.80056,50.04239],[95.74757,49.97915],[95.02465,49.96941],[94.97166,50.04725],[94.6121,50.04239],[94.49477,50.17832],[94.39258,50.22193],[94.30823,50.57498],[92.99595,50.63183],[93.01109,50.79001],[92.44714,50.78762],[92.07173,50.69585],[91.86048,50.73734],[89.59711,49.90851],[89.70687,49.72535],[88.82499,49.44808],[88.42449,49.48821],[88.17223,49.46934],[88.15543,49.30314],[87.98977,49.18147],[87.81333,49.17354],[87.88171,48.95853],[87.73822,48.89582],[88.0788,48.71436],[87.96361,48.58478],[88.58939,48.34531],[88.58316,48.21893],[88.8011,48.11302],[88.93186,48.10263],[89.0711,47.98528],[89.55453,48.0423],[89.76624,47.82745],[90.06512,47.88177],[90.10871,47.7375],[90.33598,47.68303],[90.48854,47.41826],[90.48542,47.30438],[90.76108,46.99399],[90.84035,46.99525],[91.03649,46.72916],[91.0147,46.58171],[91.07696,46.57315],[90.89639,46.30711],[90.99672,46.14207],[91.03026,46.04194],[90.70907,45.73437],[90.65114,45.49314],[90.89169,45.19667],[91.64048,45.07408],[93.51161,44.95964],[94.10003,44.71016],[94.71959,44.35284],[95.01191,44.25274],[95.39772,44.2805],[95.32891,44.02407],[95.52594,43.99353],[95.89543,43.2528],[96.35658,42.90363],[96.37926,42.72055],[97.1777,42.7964],[99.50671,42.56535],[100.33297,42.68231],[100.84979,42.67087],[101.80515,42.50074],[102.07645,42.22519],[102.72403,42.14675],[103.92804,41.78246],[104.52258,41.8706],[104.51667,41.66113],[105.0123,41.63188],[106.76517,42.28741],[107.24774,42.36107],[107.29755,42.41395],[107.49681,42.46221],[107.57258,42.40898],[108.84489,42.40246],[109.00679,42.45302],[109.452,42.44842],[109.89402,42.63111],[110.08401,42.6411],[110.4327,42.78293],[111.0149,43.3289],[111.59087,43.51207],[111.79758,43.6637],[111.93776,43.68709],[111.96289,43.81596],[111.40498,44.3461],[111.76275,44.98032],[111.98695,45.09074],[112.4164,45.06858],[112.74662,44.86297],[113.70918,44.72891],[114.5166,45.27189],[114.54801,45.38337],[114.74612,45.43585],[114.94546,45.37377],[115.60329,45.44717],[116.16989,45.68603],[116.27366,45.78637],[116.24012,45.8778],[116.26678,45.96479],[116.58612,46.30211],[116.75551,46.33083],[116.83166,46.38637],[117.36609,46.36335],[117.41782,46.57862],[117.60748,46.59771],[117.69554,46.50991],[118.30534,46.73519],[118.78747,46.68689],[118.8337,46.77742],[118.89974,46.77139],[118.92616,46.72765],[119.00541,46.74273],[119.10448,46.65516],[119.24978,46.64761],[119.32827,46.61433],[119.42827,46.63783],[119.65265,46.62342],[119.68127,46.59015],[119.77373,46.62947],[119.80455,46.67631],[119.89261,46.66423],[119.91242,46.90091],[119.85518,46.92196],[119.71209,47.19192],[119.62403,47.24575],[119.56019,47.24874],[119.54918,47.29505],[119.31964,47.42617],[119.35892,47.48104],[119.13995,47.53997],[119.12343,47.66458],[118.7564,47.76947],[118.55766,47.99277],[118.29654,48.00246],[118.22677,48.03853],[118.11009,48.04],[118.03676,48.00982],[117.80196,48.01661],[117.50181,47.77216],[117.37875,47.63627],[116.9723,47.87285],[116.67405,47.89039],[116.4465,47.83662],[116.21879,47.88505],[115.94296,47.67741],[115.57128,47.91988],[115.52082,48.15367],[115.811,48.25699],[115.78876,48.51781],[116.06565,48.81716],[116.03781,48.87014],[116.71193,49.83813],[116.62502,49.92919],[116.22402,50.04477],[115.73602,49.87688],[115.26068,49.97367],[114.9703,50.19254],[114.325,50.28098],[113.20216,49.83356],[113.02647,49.60772],[110.64493,49.1816],[110.39891,49.25083],[110.24373,49.16676],[109.51325,49.22859],[109.18017,49.34709],[108.53969,49.32325],[108.27937,49.53167],[107.95387,49.66659],[107.96116,49.93191],[107.36407,49.97612],[107.1174,50.04239],[107.00007,50.1977],[106.80326,50.30177],[106.58373,50.34044],[106.51122,50.34408],[106.49628,50.32436],[106.47156,50.31909],[106.07865,50.33474],[106.05562,50.40582],[105.32528,50.4648],[103.70343,50.13952],[102.71178,50.38873],[102.32194,50.67982],[102.14032,51.35566]]]]}},{type:"Feature",properties:{iso1A2:"MO",iso1A3:"MAC",iso1N3:"446",wikidata:"Q14773",nameEn:"Macau",aliases:["Macao"],country:"CN",groups:["030","142","UN"],driveSide:"left",callingCodes:["853"]},geometry:{type:"MultiPolygon",coordinates:[[[[113.54942,22.14519],[113.54839,22.10909],[113.57191,22.07696],[113.63011,22.10782],[113.60504,22.20464],[113.57123,22.20416],[113.56865,22.20973],[113.5508,22.21672],[113.54333,22.21688],[113.54093,22.21314],[113.53593,22.2137],[113.53301,22.21235],[113.53552,22.20607],[113.52659,22.18271],[113.54093,22.15497],[113.54942,22.14519]]]]}},{type:"Feature",properties:{iso1A2:"MP",iso1A3:"MNP",iso1N3:"580",wikidata:"Q16644",nameEn:"Northern Mariana Islands",aliases:["US-MP"],country:"US",groups:["Q1352230","Q153732","057","009","UN"],roadSpeedUnit:"mph",callingCodes:["1 670"]},geometry:{type:"MultiPolygon",coordinates:[[[[135.52896,14.32623],[152.19114,13.63487],[145.05972,21.28731],[135.52896,14.32623]]]]}},{type:"Feature",properties:{iso1A2:"MQ",iso1A3:"MTQ",iso1N3:"474",wikidata:"Q17054",nameEn:"Martinique",country:"FR",groups:["Q3320166","EU","029","003","419","019","UN"],callingCodes:["596"]},geometry:{type:"MultiPolygon",coordinates:[[[[-59.95997,14.20285],[-61.07821,15.25109],[-61.69315,14.26451],[-59.95997,14.20285]]]]}},{type:"Feature",properties:{iso1A2:"MR",iso1A3:"MRT",iso1N3:"478",wikidata:"Q1025",nameEn:"Mauritania",groups:["011","202","002","UN"],callingCodes:["222"]},geometry:{type:"MultiPolygon",coordinates:[[[[-5.60725,16.49919],[-6.57191,25.0002],[-4.83423,24.99935],[-8.66674,27.31569],[-8.66721,25.99918],[-12.0002,25.9986],[-12.00251,23.4538],[-12.14969,23.41935],[-12.36213,23.3187],[-12.5741,23.28975],[-13.00412,23.02297],[-13.10753,22.89493],[-13.15313,22.75649],[-13.08438,22.53866],[-13.01525,21.33343],[-16.95474,21.33997],[-16.99806,21.12142],[-17.0357,21.05368],[-17.0396,20.9961],[-17.06781,20.92697],[-17.0695,20.85742],[-17.0471,20.76408],[-17.15288,16.07139],[-16.50854,16.09032],[-16.48967,16.0496],[-16.44814,16.09753],[-16.4429,16.20605],[-16.27016,16.51565],[-15.6509,16.50315],[-15.00557,16.64997],[-14.32144,16.61495],[-13.80075,16.13961],[-13.43135,16.09022],[-13.11029,15.52116],[-12.23936,14.76324],[-11.94903,14.76143],[-11.70705,15.51558],[-11.43483,15.62339],[-10.90932,15.11001],[-10.71721,15.4223],[-9.40447,15.4396],[-9.44673,15.60553],[-9.33314,15.7044],[-9.31106,15.69412],[-9.32979,15.50032],[-5.50165,15.50061],[-5.33435,16.33354],[-5.60725,16.49919]]]]}},{type:"Feature",properties:{iso1A2:"MS",iso1A3:"MSR",iso1N3:"500",wikidata:"Q13353",nameEn:"Montserrat",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 664"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.91508,16.51165],[-62.1023,16.97277],[-62.58307,16.68909],[-61.91508,16.51165]]]]}},{type:"Feature",properties:{iso1A2:"MT",iso1A3:"MLT",iso1N3:"470",wikidata:"Q233",nameEn:"Malta",groups:["EU","039","150","UN"],driveSide:"left",callingCodes:["356"]},geometry:{type:"MultiPolygon",coordinates:[[[[15.70991,35.79901],[14.07544,36.41525],[13.27636,35.20764],[15.70991,35.79901]]]]}},{type:"Feature",properties:{iso1A2:"MU",iso1A3:"MUS",iso1N3:"480",wikidata:"Q1027",nameEn:"Mauritius",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["230"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.09755,-9.55401],[57.50644,-31.92637],[68.4673,-19.15185],[56.09755,-9.55401]]]]}},{type:"Feature",properties:{iso1A2:"MV",iso1A3:"MDV",iso1N3:"462",wikidata:"Q826",nameEn:"Maldives",groups:["034","142","UN"],driveSide:"left",callingCodes:["960"]},geometry:{type:"MultiPolygon",coordinates:[[[[71.9161,8.55531],[72.57428,-3.7623],[76.59015,5.591],[71.9161,8.55531]]]]}},{type:"Feature",properties:{iso1A2:"MW",iso1A3:"MWI",iso1N3:"454",wikidata:"Q1020",nameEn:"Malawi",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["265"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.48052,-9.62442],[33.31581,-9.48554],[33.14925,-9.49322],[32.99397,-9.36712],[32.95389,-9.40138],[33.00476,-9.5133],[33.00256,-9.63053],[33.05485,-9.61316],[33.10163,-9.66525],[33.12144,-9.58929],[33.2095,-9.61099],[33.31517,-9.82364],[33.36581,-9.81063],[33.37902,-9.9104],[33.31297,-10.05133],[33.53863,-10.20148],[33.54797,-10.36077],[33.70675,-10.56896],[33.47636,-10.78465],[33.28022,-10.84428],[33.25998,-10.88862],[33.39697,-11.15296],[33.29267,-11.3789],[33.29267,-11.43536],[33.23663,-11.40637],[33.24252,-11.59302],[33.32692,-11.59248],[33.33937,-11.91252],[33.25998,-12.14242],[33.3705,-12.34931],[33.47636,-12.32498],[33.54485,-12.35996],[33.37517,-12.54085],[33.28177,-12.54692],[33.18837,-12.61377],[33.05917,-12.59554],[32.94397,-12.76868],[32.96733,-12.88251],[33.02181,-12.88707],[32.98289,-13.12671],[33.0078,-13.19492],[32.86113,-13.47292],[32.84176,-13.52794],[32.73683,-13.57682],[32.68436,-13.55769],[32.66468,-13.60019],[32.68654,-13.64268],[32.7828,-13.64805],[32.84528,-13.71576],[32.76962,-13.77224],[32.79015,-13.80755],[32.88985,-13.82956],[32.99042,-13.95689],[33.02977,-14.05022],[33.07568,-13.98447],[33.16749,-13.93992],[33.24249,-14.00019],[33.66677,-14.61306],[33.7247,-14.4989],[33.88503,-14.51652],[33.92898,-14.47929],[34.08588,-14.48893],[34.18733,-14.43823],[34.22355,-14.43607],[34.34453,-14.3985],[34.35843,-14.38652],[34.39277,-14.39467],[34.4192,-14.43191],[34.44641,-14.47746],[34.45053,-14.49873],[34.47628,-14.53363],[34.48932,-14.53646],[34.49636,-14.55091],[34.52366,-14.5667],[34.53962,-14.59776],[34.55112,-14.64494],[34.53516,-14.67782],[34.52057,-14.68263],[34.54503,-14.74672],[34.567,-14.77345],[34.61522,-14.99583],[34.57503,-15.30619],[34.43126,-15.44778],[34.44981,-15.60864],[34.25195,-15.90321],[34.43126,-16.04737],[34.40344,-16.20923],[35.04805,-16.83167],[35.13771,-16.81687],[35.17017,-16.93521],[35.04805,-17.00027],[35.0923,-17.13235],[35.3062,-17.1244],[35.27065,-16.93817],[35.30929,-16.82871],[35.27219,-16.69402],[35.14235,-16.56812],[35.25828,-16.4792],[35.30157,-16.2211],[35.43355,-16.11371],[35.52365,-16.15414],[35.70107,-16.10147],[35.80487,-16.03907],[35.85303,-15.41913],[35.78799,-15.17428],[35.91812,-14.89514],[35.87212,-14.89478],[35.86945,-14.67481],[35.5299,-14.27714],[35.47989,-14.15594],[34.86229,-13.48958],[34.60253,-13.48487],[34.37831,-12.17408],[34.46088,-12.0174],[34.70739,-12.15652],[34.82903,-12.04837],[34.57917,-11.87849],[34.64241,-11.57499],[34.96296,-11.57354],[34.91153,-11.39799],[34.79375,-11.32245],[34.63305,-11.11731],[34.61161,-11.01611],[34.67047,-10.93796],[34.65946,-10.6828],[34.57581,-10.56271],[34.51911,-10.12279],[34.54499,-10.0678],[34.03865,-9.49398],[33.95829,-9.54066],[33.9638,-9.62206],[33.93298,-9.71647],[33.76677,-9.58516],[33.48052,-9.62442]]]]}},{type:"Feature",properties:{iso1A2:"MX",iso1A3:"MEX",iso1N3:"484",wikidata:"Q96",nameEn:"Mexico",groups:["013","003","419","019","UN"],callingCodes:["52"]},geometry:{type:"MultiPolygon",coordinates:[[[[-117.1243,32.53427],[-118.48109,32.5991],[-120.12904,18.41089],[-92.37213,14.39277],[-92.2261,14.53423],[-92.1454,14.6804],[-92.18161,14.84147],[-92.1423,14.88647],[-92.1454,14.98143],[-92.0621,15.07406],[-92.20983,15.26077],[-91.73182,16.07371],[-90.44567,16.07573],[-90.40499,16.40524],[-90.61212,16.49832],[-90.69064,16.70697],[-91.04436,16.92175],[-91.43809,17.25373],[-90.99199,17.25192],[-90.98678,17.81655],[-89.14985,17.81563],[-89.15105,17.95104],[-89.03839,18.0067],[-88.8716,17.89535],[-88.71505,18.0707],[-88.48242,18.49164],[-88.3268,18.49048],[-88.29909,18.47591],[-88.26593,18.47617],[-88.03238,18.41778],[-88.03165,18.16657],[-87.90671,18.15213],[-87.87604,18.18313],[-87.86657,18.19971],[-87.85693,18.18266],[-87.84815,18.18511],[-86.92368,17.61462],[-85.9092,21.8218],[-96.92418,25.97377],[-97.13927,25.96583],[-97.35946,25.92189],[-97.37332,25.83854],[-97.42511,25.83969],[-97.45669,25.86874],[-97.49828,25.89877],[-97.52025,25.88518],[-97.66511,26.01708],[-97.95155,26.0625],[-97.97017,26.05232],[-98.24603,26.07191],[-98.27075,26.09457],[-98.30491,26.10475],[-98.35126,26.15129],[-99.00546,26.3925],[-99.03053,26.41249],[-99.08477,26.39849],[-99.53573,27.30926],[-99.49744,27.43746],[-99.482,27.47128],[-99.48045,27.49016],[-99.50208,27.50021],[-99.52955,27.49747],[-99.51478,27.55836],[-99.55409,27.61314],[-100.50029,28.66117],[-100.51222,28.70679],[-100.5075,28.74066],[-100.52313,28.75598],[-100.59809,28.88197],[-100.63689,28.90812],[-100.67294,29.09744],[-100.79696,29.24688],[-100.87982,29.296],[-100.94056,29.33371],[-100.94579,29.34523],[-100.96725,29.3477],[-101.01128,29.36947],[-101.05686,29.44738],[-101.47277,29.7744],[-102.60596,29.8192],[-103.15787,28.93865],[-104.37752,29.54255],[-104.39363,29.55396],[-104.3969,29.57105],[-104.5171,29.64671],[-104.77674,30.4236],[-106.00363,31.39181],[-106.09025,31.40569],[-106.20346,31.46305],[-106.23711,31.51262],[-106.24612,31.54193],[-106.28084,31.56173],[-106.30305,31.62154],[-106.33419,31.66303],[-106.34864,31.69663],[-106.3718,31.71165],[-106.38003,31.73151],[-106.41773,31.75196],[-106.43419,31.75478],[-106.45244,31.76523],[-106.46726,31.75998],[-106.47298,31.75054],[-106.48815,31.74769],[-106.50111,31.75714],[-106.50962,31.76155],[-106.51251,31.76922],[-106.52266,31.77509],[-106.529,31.784],[-108.20899,31.78534],[-108.20979,31.33316],[-111.07523,31.33232],[-114.82011,32.49609],[-114.79524,32.55731],[-114.81141,32.55543],[-114.80584,32.62028],[-114.76736,32.64094],[-114.71871,32.71894],[-115.88053,32.63624],[-117.1243,32.53427]]]]}},{type:"Feature",properties:{iso1A2:"MY",iso1A3:"MYS",iso1N3:"458",wikidata:"Q833",nameEn:"Malaysia"},geometry:null},{type:"Feature",properties:{iso1A2:"MZ",iso1A3:"MOZ",iso1N3:"508",wikidata:"Q1029",nameEn:"Mozambique",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["258"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.74206,-10.25691],[40.44265,-10.4618],[40.00295,-10.80255],[39.58249,-10.96043],[39.24395,-11.17433],[38.88996,-11.16978],[38.47258,-11.4199],[38.21598,-11.27289],[37.93618,-11.26228],[37.8388,-11.3123],[37.76614,-11.53352],[37.3936,-11.68949],[36.80309,-11.56836],[36.62068,-11.72884],[36.19094,-11.70008],[36.19094,-11.57593],[35.82767,-11.41081],[35.63599,-11.55927],[34.96296,-11.57354],[34.64241,-11.57499],[34.57917,-11.87849],[34.82903,-12.04837],[34.70739,-12.15652],[34.46088,-12.0174],[34.37831,-12.17408],[34.60253,-13.48487],[34.86229,-13.48958],[35.47989,-14.15594],[35.5299,-14.27714],[35.86945,-14.67481],[35.87212,-14.89478],[35.91812,-14.89514],[35.78799,-15.17428],[35.85303,-15.41913],[35.80487,-16.03907],[35.70107,-16.10147],[35.52365,-16.15414],[35.43355,-16.11371],[35.30157,-16.2211],[35.25828,-16.4792],[35.14235,-16.56812],[35.27219,-16.69402],[35.30929,-16.82871],[35.27065,-16.93817],[35.3062,-17.1244],[35.0923,-17.13235],[35.04805,-17.00027],[35.17017,-16.93521],[35.13771,-16.81687],[35.04805,-16.83167],[34.40344,-16.20923],[34.43126,-16.04737],[34.25195,-15.90321],[34.44981,-15.60864],[34.43126,-15.44778],[34.57503,-15.30619],[34.61522,-14.99583],[34.567,-14.77345],[34.54503,-14.74672],[34.52057,-14.68263],[34.53516,-14.67782],[34.55112,-14.64494],[34.53962,-14.59776],[34.52366,-14.5667],[34.49636,-14.55091],[34.48932,-14.53646],[34.47628,-14.53363],[34.45053,-14.49873],[34.44641,-14.47746],[34.4192,-14.43191],[34.39277,-14.39467],[34.35843,-14.38652],[34.34453,-14.3985],[34.22355,-14.43607],[34.18733,-14.43823],[34.08588,-14.48893],[33.92898,-14.47929],[33.88503,-14.51652],[33.7247,-14.4989],[33.66677,-14.61306],[33.24249,-14.00019],[30.22098,-14.99447],[30.41902,-15.62269],[30.42568,-15.9962],[30.91597,-15.99924],[30.97761,-16.05848],[31.13171,-15.98019],[31.30563,-16.01193],[31.42451,-16.15154],[31.67988,-16.19595],[31.90223,-16.34388],[31.91324,-16.41569],[32.02772,-16.43892],[32.28529,-16.43892],[32.42838,-16.4727],[32.71017,-16.59932],[32.69917,-16.66893],[32.78943,-16.70267],[32.97655,-16.70689],[32.91051,-16.89446],[32.84113,-16.92259],[32.96554,-17.11971],[33.00517,-17.30477],[33.0426,-17.3468],[32.96554,-17.48964],[32.98536,-17.55891],[33.0492,-17.60298],[32.94133,-17.99705],[33.03159,-18.35054],[33.02278,-18.4696],[32.88629,-18.51344],[32.88629,-18.58023],[32.95013,-18.69079],[32.9017,-18.7992],[32.82465,-18.77419],[32.70137,-18.84712],[32.73439,-18.92628],[32.69917,-18.94293],[32.72118,-19.02204],[32.84006,-19.0262],[32.87088,-19.09279],[32.85107,-19.29238],[32.77966,-19.36098],[32.78282,-19.47513],[32.84446,-19.48343],[32.84666,-19.68462],[32.95013,-19.67219],[33.06461,-19.77787],[33.01178,-20.02007],[32.93032,-20.03868],[32.85987,-20.16686],[32.85987,-20.27841],[32.66174,-20.56106],[32.55167,-20.56312],[32.48122,-20.63319],[32.51644,-20.91929],[32.37115,-21.133],[32.48236,-21.32873],[32.41234,-21.31246],[31.38336,-22.36919],[31.30611,-22.422],[31.55779,-23.176],[31.56539,-23.47268],[31.67942,-23.60858],[31.70223,-23.72695],[31.77445,-23.90082],[31.87707,-23.95293],[31.90368,-24.18892],[31.9835,-24.29983],[32.03196,-25.10785],[32.01676,-25.38117],[31.97875,-25.46356],[32.00631,-25.65044],[31.92649,-25.84216],[31.974,-25.95387],[32.00916,-25.999],[32.08599,-26.00978],[32.10435,-26.15656],[32.07352,-26.40185],[32.13409,-26.5317],[32.13315,-26.84345],[32.19409,-26.84032],[32.22302,-26.84136],[32.29584,-26.852],[32.35222,-26.86027],[34.51034,-26.91792],[42.99868,-12.65261],[40.74206,-10.25691]]]]}},{type:"Feature",properties:{iso1A2:"NA",iso1A3:"NAM",iso1N3:"516",wikidata:"Q1030",nameEn:"Namibia",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["264"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.28743,-17.38814],[13.95896,-17.43141],[13.36212,-16.98048],[12.97145,-16.98567],[12.52111,-17.24495],[12.07076,-17.15165],[11.75063,-17.25013],[10.5065,-17.25284],[12.51595,-32.27486],[16.45332,-28.63117],[16.46592,-28.57126],[16.59922,-28.53246],[16.90446,-28.057],[17.15405,-28.08573],[17.4579,-28.68718],[18.99885,-28.89165],[19.99882,-28.42622],[19.99817,-24.76768],[19.99912,-21.99991],[20.99751,-22.00026],[20.99904,-18.31743],[21.45556,-18.31795],[23.0996,-18.00075],[23.29618,-17.99855],[23.61088,-18.4881],[24.19416,-18.01919],[24.40577,-17.95726],[24.57485,-18.07151],[24.6303,-17.9863],[24.71887,-17.9218],[24.73364,-17.89338],[24.95586,-17.79674],[25.05895,-17.84452],[25.16882,-17.78253],[25.26433,-17.79571],[25.00198,-17.58221],[24.70864,-17.49501],[24.5621,-17.52963],[24.38712,-17.46818],[24.32811,-17.49082],[24.23619,-17.47489],[23.47474,-17.62877],[21.42741,-18.02787],[21.14283,-17.94318],[18.84226,-17.80375],[18.39229,-17.38927],[14.28743,-17.38814]]]]}},{type:"Feature",properties:{iso1A2:"NC",iso1A3:"NCL",iso1N3:"540",wikidata:"Q33788",nameEn:"New Caledonia",country:"FR",groups:["EU","Q1451600","054","009","UN"],callingCodes:["687"]},geometry:{type:"MultiPolygon",coordinates:[[[[159.77159,-28.41151],[174.245,-23.1974],[156.73836,-14.50464],[159.77159,-28.41151]]]]}},{type:"Feature",properties:{iso1A2:"NE",iso1A3:"NER",iso1N3:"562",wikidata:"Q1032",nameEn:"Niger",aliases:["RN"],groups:["011","202","002","UN"],callingCodes:["227"]},geometry:{type:"MultiPolygon",coordinates:[[[[14.22918,22.61719],[13.5631,23.16574],[11.96886,23.51735],[7.48273,20.87258],[7.38361,20.79165],[5.8153,19.45101],[4.26651,19.14224],[4.26762,17.00432],[4.21787,17.00118],[4.19893,16.39923],[3.50368,15.35934],[3.03134,15.42221],[3.01806,15.34571],[1.31275,15.27978],[.96711,14.98275],[.72632,14.95898],[.23859,15.00135],[.16936,14.51654],[.38051,14.05575],[.61924,13.68491],[.77377,13.6866],[.77637,13.64442],[.99514,13.5668],[1.02813,13.46635],[1.20088,13.38951],[1.24429,13.39373],[1.28509,13.35488],[1.24516,13.33968],[1.21217,13.37853],[1.18873,13.31771],[.99253,13.37515],[.99167,13.10727],[2.26349,12.41915],[2.05785,12.35539],[2.39723,11.89473],[2.45824,11.98672],[2.39657,12.10952],[2.37783,12.24804],[2.6593,12.30631],[2.83978,12.40585],[3.25352,12.01467],[3.31613,11.88495],[3.48187,11.86092],[3.59375,11.70269],[3.61075,11.69181],[3.67988,11.75429],[3.67122,11.80865],[3.63063,11.83042],[3.61955,11.91847],[3.67775,11.97599],[3.63136,12.11826],[3.66364,12.25884],[3.65111,12.52223],[3.94339,12.74979],[4.10006,12.98862],[4.14367,13.17189],[4.14186,13.47586],[4.23456,13.47725],[4.4668,13.68286],[4.87425,13.78],[4.9368,13.7345],[5.07396,13.75052],[5.21026,13.73627],[5.27797,13.75474],[5.35437,13.83567],[5.52957,13.8845],[6.15771,13.64564],[6.27411,13.67835],[6.43053,13.6006],[6.69617,13.34057],[6.94445,12.99825],[7.0521,13.00076],[7.12676,13.02445],[7.22399,13.1293],[7.39241,13.09717],[7.81085,13.34902],[8.07997,13.30847],[8.25185,13.20369],[8.41853,13.06166],[8.49493,13.07519],[8.60431,13.01768],[8.64251,12.93985],[8.97413,12.83661],[9.65995,12.80614],[10.00373,13.18171],[10.19993,13.27129],[10.46731,13.28819],[10.66004,13.36422],[11.4535,13.37773],[11.88236,13.2527],[12.04209,13.14452],[12.16189,13.10056],[12.19315,13.12423],[12.47095,13.06673],[12.58033,13.27805],[12.6793,13.29157],[12.87376,13.48919],[13.05085,13.53984],[13.19844,13.52802],[13.33213,13.71195],[13.6302,13.71094],[13.47559,14.40881],[13.48259,14.46704],[13.68573,14.55276],[13.67878,14.64013],[13.809,14.72915],[13.78991,14.87519],[13.86301,15.04043],[14.37425,15.72591],[15.50373,16.89649],[15.6032,18.77402],[15.75098,19.93002],[15.99632,20.35364],[15.6721,20.70069],[15.59841,20.74039],[15.56004,20.79488],[15.55382,20.86507],[15.57248,20.92138],[15.62515,20.95395],[15.28332,21.44557],[15.20213,21.49365],[15.19692,21.99339],[14.99751,23.00539],[14.22918,22.61719]]]]}},{type:"Feature",properties:{iso1A2:"NF",iso1A3:"NFK",iso1N3:"574",wikidata:"Q31057",nameEn:"Norfolk Island",country:"AU",groups:["053","009","UN"],driveSide:"left",callingCodes:["672 3"]},geometry:{type:"MultiPolygon",coordinates:[[[[169.82316,-28.16667],[166.29505,-28.29175],[167.94076,-30.60745],[169.82316,-28.16667]]]]}},{type:"Feature",properties:{iso1A2:"NG",iso1A3:"NGA",iso1N3:"566",wikidata:"Q1033",nameEn:"Nigeria",groups:["011","202","002","UN"],callingCodes:["234"]},geometry:{type:"MultiPolygon",coordinates:[[[[6.15771,13.64564],[5.52957,13.8845],[5.35437,13.83567],[5.27797,13.75474],[5.21026,13.73627],[5.07396,13.75052],[4.9368,13.7345],[4.87425,13.78],[4.4668,13.68286],[4.23456,13.47725],[4.14186,13.47586],[4.14367,13.17189],[4.10006,12.98862],[3.94339,12.74979],[3.65111,12.52223],[3.66364,12.25884],[3.63136,12.11826],[3.67775,11.97599],[3.61955,11.91847],[3.63063,11.83042],[3.67122,11.80865],[3.67988,11.75429],[3.61075,11.69181],[3.59375,11.70269],[3.49175,11.29765],[3.71505,11.13015],[3.84243,10.59316],[3.78292,10.40538],[3.6844,10.46351],[3.57275,10.27185],[3.66908,10.18136],[3.54429,9.87739],[3.35383,9.83641],[3.32099,9.78032],[3.34726,9.70696],[3.25093,9.61632],[3.13928,9.47167],[3.14147,9.28375],[3.08017,9.10006],[2.77907,9.06924],[2.67523,7.87825],[2.73095,7.7755],[2.73405,7.5423],[2.78668,7.5116],[2.79442,7.43486],[2.74489,7.42565],[2.76965,7.13543],[2.71702,6.95722],[2.74024,6.92802],[2.73405,6.78508],[2.78823,6.76356],[2.78204,6.70514],[2.7325,6.64057],[2.74334,6.57291],[2.70464,6.50831],[2.70566,6.38038],[2.74181,6.13349],[5.87055,3.78489],[8.34397,4.30689],[8.60302,4.87353],[8.78027,5.1243],[8.92029,5.58403],[8.83687,5.68483],[8.88156,5.78857],[8.84209,5.82562],[9.51757,6.43874],[9.70674,6.51717],[9.77824,6.79088],[9.86314,6.77756],[10.15135,7.03781],[10.21466,6.88996],[10.53639,6.93432],[10.57214,7.16345],[10.59746,7.14719],[10.60789,7.06885],[10.83727,6.9358],[10.8179,6.83377],[10.94302,6.69325],[11.09644,6.68437],[11.09495,6.51717],[11.42041,6.53789],[11.42264,6.5882],[11.51499,6.60892],[11.57755,6.74059],[11.55818,6.86186],[11.63117,6.9905],[11.87396,7.09398],[11.84864,7.26098],[11.93205,7.47812],[12.01844,7.52981],[11.99908,7.67302],[12.20909,7.97553],[12.19271,8.10826],[12.24782,8.17904],[12.26123,8.43696],[12.4489,8.52536],[12.44146,8.6152],[12.68722,8.65938],[12.71701,8.7595],[12.79,8.75361],[12.81085,8.91992],[12.90022,9.11411],[12.91958,9.33905],[12.85628,9.36698],[13.02385,9.49334],[13.22642,9.57266],[13.25472,9.76795],[13.29941,9.8296],[13.25025,9.86042],[13.24132,9.91031],[13.27409,9.93232],[13.286,9.9822],[13.25323,10.00127],[13.25025,10.03647],[13.34111,10.12299],[13.43644,10.13326],[13.5705,10.53183],[13.54964,10.61236],[13.73434,10.9255],[13.70753,10.94451],[13.7403,11.00593],[13.78945,11.00154],[13.97489,11.30258],[14.17821,11.23831],[14.6124,11.51283],[14.64591,11.66166],[14.55207,11.72001],[14.61612,11.7798],[14.6474,12.17466],[14.4843,12.35223],[14.22215,12.36533],[14.17523,12.41916],[14.20204,12.53405],[14.08251,13.0797],[13.6302,13.71094],[13.33213,13.71195],[13.19844,13.52802],[13.05085,13.53984],[12.87376,13.48919],[12.6793,13.29157],[12.58033,13.27805],[12.47095,13.06673],[12.19315,13.12423],[12.16189,13.10056],[12.04209,13.14452],[11.88236,13.2527],[11.4535,13.37773],[10.66004,13.36422],[10.46731,13.28819],[10.19993,13.27129],[10.00373,13.18171],[9.65995,12.80614],[8.97413,12.83661],[8.64251,12.93985],[8.60431,13.01768],[8.49493,13.07519],[8.41853,13.06166],[8.25185,13.20369],[8.07997,13.30847],[7.81085,13.34902],[7.39241,13.09717],[7.22399,13.1293],[7.12676,13.02445],[7.0521,13.00076],[6.94445,12.99825],[6.69617,13.34057],[6.43053,13.6006],[6.27411,13.67835],[6.15771,13.64564]]]]}},{type:"Feature",properties:{iso1A2:"NI",iso1A3:"NIC",iso1N3:"558",wikidata:"Q811",nameEn:"Nicaragua",groups:["013","003","419","019","UN"],callingCodes:["505"]},geometry:{type:"MultiPolygon",coordinates:[[[[-83.13724,15.00002],[-83.49268,15.01158],[-83.62101,14.89448],[-83.89551,14.76697],[-84.10584,14.76353],[-84.48373,14.63249],[-84.70119,14.68078],[-84.82596,14.82212],[-84.90082,14.80489],[-85.1575,14.53934],[-85.18602,14.24929],[-85.32149,14.2562],[-85.45762,14.11304],[-85.73964,13.9698],[-85.75477,13.8499],[-86.03458,13.99181],[-86.00685,14.08474],[-86.14801,14.04317],[-86.35219,13.77157],[-86.76812,13.79605],[-86.71267,13.30348],[-86.87066,13.30641],[-86.93383,13.18677],[-86.93197,13.05313],[-87.03785,12.98682],[-87.06306,13.00892],[-87.37107,12.98646],[-87.55124,13.12523],[-87.7346,13.13228],[-88.11443,12.63306],[-86.14524,11.09059],[-85.71223,11.06868],[-85.60529,11.22607],[-84.92439,10.9497],[-84.68197,11.07568],[-83.90838,10.71161],[-83.66597,10.79916],[-83.68276,11.01562],[-82.56142,11.91792],[-82.06974,14.49418],[-83.04763,15.03256],[-83.13724,15.00002]]]]}},{type:"Feature",properties:{iso1A2:"NL",iso1A3:"NLD",iso1N3:"528",wikidata:"Q29999",nameEn:"Kingdom of the Netherlands"},geometry:null},{type:"Feature",properties:{iso1A2:"NO",iso1A3:"NOR",iso1N3:"578",wikidata:"Q20",nameEn:"Norway"},geometry:null},{type:"Feature",properties:{iso1A2:"NP",iso1A3:"NPL",iso1N3:"524",wikidata:"Q837",nameEn:"Nepal",groups:["034","142","UN"],driveSide:"left",callingCodes:["977"]},geometry:{type:"MultiPolygon",coordinates:[[[[88.13378,27.88015],[87.82681,27.95248],[87.72718,27.80938],[87.56996,27.84517],[87.11696,27.84104],[87.03757,27.94835],[86.75582,28.04182],[86.74181,28.10638],[86.56265,28.09569],[86.51609,27.96623],[86.42736,27.91122],[86.22966,27.9786],[86.18607,28.17364],[86.088,28.09264],[86.08333,28.02121],[86.12069,27.93047],[86.06309,27.90021],[85.94946,27.9401],[85.97813,27.99023],[85.90743,28.05144],[85.84672,28.18187],[85.74864,28.23126],[85.71907,28.38064],[85.69105,28.38475],[85.60854,28.25045],[85.59765,28.30529],[85.4233,28.32996],[85.38127,28.28336],[85.10729,28.34092],[85.18668,28.54076],[85.19135,28.62825],[85.06059,28.68562],[84.85511,28.58041],[84.62317,28.73887],[84.47528,28.74023],[84.2231,28.89571],[84.24801,29.02783],[84.18107,29.23451],[83.97559,29.33091],[83.82303,29.30513],[83.63156,29.16249],[83.44787,29.30513],[83.28131,29.56813],[83.07116,29.61957],[82.73024,29.81695],[82.5341,29.9735],[82.38622,30.02608],[82.16984,30.0692],[82.19475,30.16884],[82.10757,30.23745],[82.10135,30.35439],[81.99082,30.33423],[81.62033,30.44703],[81.5459,30.37688],[81.41018,30.42153],[81.39928,30.21862],[81.33355,30.15303],[81.2623,30.14596],[81.29032,30.08806],[81.24362,30.0126],[81.12842,30.01395],[81.03953,30.20059],[80.92547,30.17193],[80.91143,30.22173],[80.86673,30.17321],[80.8778,30.13384],[80.67076,29.95732],[80.60226,29.95732],[80.57179,29.91422],[80.56247,29.86661],[80.48997,29.79566],[80.43458,29.80466],[80.41554,29.79451],[80.36803,29.73865],[80.38428,29.68513],[80.41858,29.63581],[80.37939,29.57098],[80.24322,29.44299],[80.31428,29.30784],[80.28626,29.20327],[80.24112,29.21414],[80.26602,29.13938],[80.23178,29.11626],[80.18085,29.13649],[80.05743,28.91479],[80.06957,28.82763],[80.12125,28.82346],[80.37188,28.63371],[80.44504,28.63098],[80.52443,28.54897],[80.50575,28.6706],[80.55142,28.69182],[81.03471,28.40054],[81.19847,28.36284],[81.32923,28.13521],[81.38683,28.17638],[81.48179,28.12148],[81.47867,28.08303],[81.91223,27.84995],[81.97214,27.93322],[82.06554,27.92222],[82.46405,27.6716],[82.70378,27.72122],[82.74119,27.49838],[82.93261,27.50328],[82.94938,27.46036],[83.19413,27.45632],[83.27197,27.38309],[83.2673,27.36235],[83.29999,27.32778],[83.35136,27.33885],[83.38872,27.39276],[83.39495,27.4798],[83.61288,27.47013],[83.85595,27.35797],[83.86182,27.4241],[83.93306,27.44939],[84.02229,27.43836],[84.10791,27.52399],[84.21376,27.45218],[84.25735,27.44941],[84.29315,27.39],[84.62161,27.33885],[84.69166,27.21294],[84.64496,27.04669],[84.793,26.9968],[84.82913,27.01989],[84.85754,26.98984],[84.96687,26.95599],[84.97186,26.9149],[85.00536,26.89523],[85.05592,26.88991],[85.02635,26.85381],[85.15883,26.86966],[85.19291,26.86909],[85.18046,26.80519],[85.21159,26.75933],[85.34302,26.74954],[85.47752,26.79292],[85.56471,26.84133],[85.5757,26.85955],[85.59461,26.85161],[85.61621,26.86721],[85.66239,26.84822],[85.73483,26.79613],[85.72315,26.67471],[85.76907,26.63076],[85.83126,26.61134],[85.85126,26.60866],[85.8492,26.56667],[86.02729,26.66756],[86.13596,26.60651],[86.22513,26.58863],[86.26235,26.61886],[86.31564,26.61925],[86.49726,26.54218],[86.54258,26.53819],[86.57073,26.49825],[86.61313,26.48658],[86.62686,26.46891],[86.69124,26.45169],[86.74025,26.42386],[86.76797,26.45892],[86.82898,26.43919],[86.94543,26.52076],[86.95912,26.52076],[87.01559,26.53228],[87.04691,26.58685],[87.0707,26.58571],[87.09147,26.45039],[87.14751,26.40542],[87.18863,26.40558],[87.24682,26.4143],[87.26587,26.40592],[87.26568,26.37294],[87.34568,26.34787],[87.37314,26.40815],[87.46566,26.44058],[87.51571,26.43106],[87.55274,26.40596],[87.59175,26.38342],[87.66803,26.40294],[87.67893,26.43501],[87.76004,26.40711],[87.7918,26.46737],[87.84193,26.43663],[87.89085,26.48565],[87.90115,26.44923],[88.00895,26.36029],[88.09414,26.43732],[88.09963,26.54195],[88.16452,26.64111],[88.1659,26.68177],[88.19107,26.75516],[88.12302,26.95324],[88.13422,26.98705],[88.11719,26.98758],[87.9887,27.11045],[88.01587,27.21388],[88.01646,27.21612],[88.07277,27.43007],[88.04008,27.49223],[88.19107,27.79285],[88.1973,27.85067],[88.13378,27.88015]]]]}},{type:"Feature",properties:{iso1A2:"NR",iso1A3:"NRU",iso1N3:"520",wikidata:"Q697",nameEn:"Nauru",groups:["057","009","UN"],driveSide:"left",callingCodes:["674"]},geometry:{type:"MultiPolygon",coordinates:[[[[166.95155,.14829],[166.21778,-.7977],[167.60042,-.88259],[166.95155,.14829]]]]}},{type:"Feature",properties:{iso1A2:"NU",iso1A3:"NIU",iso1N3:"570",wikidata:"Q34020",nameEn:"Niue",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["683"]},geometry:{type:"MultiPolygon",coordinates:[[[[-170.83899,-18.53439],[-170.82274,-20.44429],[-168.63096,-18.60489],[-170.83899,-18.53439]]]]}},{type:"Feature",properties:{iso1A2:"NZ",iso1A3:"NZL",iso1N3:"554",wikidata:"Q664",nameEn:"New Zealand"},geometry:null},{type:"Feature",properties:{iso1A2:"OM",iso1A3:"OMN",iso1N3:"512",wikidata:"Q842",nameEn:"Oman",groups:["145","142","UN"],callingCodes:["968"]},geometry:{type:"MultiPolygon",coordinates:[[[[56.82555,25.7713],[56.79239,26.41236],[56.68954,26.76645],[56.2644,26.58649],[55.81777,26.18798],[56.08666,26.05038],[56.15498,26.06828],[56.19334,25.9795],[56.13963,25.82765],[56.17416,25.77239],[56.13579,25.73524],[56.14826,25.66351],[56.18363,25.65508],[56.20473,25.61119],[56.25365,25.60211],[56.26636,25.60643],[56.25341,25.61443],[56.26534,25.62825],[56.82555,25.7713]]],[[[56.26062,25.33108],[56.23362,25.31253],[56.25008,25.28843],[56.24465,25.27505],[56.20838,25.25668],[56.20872,25.24104],[56.24341,25.22867],[56.27628,25.23404],[56.34438,25.26653],[56.35172,25.30681],[56.3111,25.30107],[56.3005,25.31815],[56.26062,25.33108]],[[56.28423,25.26344],[56.27086,25.26128],[56.2716,25.27916],[56.28102,25.28486],[56.29379,25.2754],[56.28423,25.26344]]],[[[61.45114,22.55394],[56.86325,25.03856],[56.3227,24.97284],[56.34873,24.93205],[56.30269,24.88334],[56.20568,24.85063],[56.20062,24.78565],[56.13684,24.73699],[56.06128,24.74457],[56.03535,24.81161],[55.97836,24.87673],[55.97467,24.89639],[56.05106,24.87461],[56.05715,24.95727],[55.96316,25.00857],[55.90849,24.96771],[55.85094,24.96858],[55.81116,24.9116],[55.81348,24.80102],[55.83408,24.77858],[55.83271,24.68567],[55.76461,24.5287],[55.83271,24.41521],[55.83395,24.32776],[55.80747,24.31069],[55.79145,24.27914],[55.76781,24.26209],[55.75939,24.26114],[55.75382,24.2466],[55.75257,24.23466],[55.76558,24.23227],[55.77658,24.23476],[55.83367,24.20193],[55.95472,24.2172],[56.01799,24.07426],[55.8308,24.01633],[55.73301,24.05994],[55.48677,23.94946],[55.57358,23.669],[55.22634,23.10378],[55.2137,22.71065],[55.66469,21.99658],[54.99756,20.00083],[52.00311,19.00083],[52.78009,17.35124],[52.74267,17.29519],[52.81185,17.28568],[57.49095,8.14549],[61.45114,22.55394]]]]}},{type:"Feature",properties:{iso1A2:"PA",iso1A3:"PAN",iso1N3:"591",wikidata:"Q804",nameEn:"Panama",groups:["013","003","419","019","UN"],callingCodes:["507"]},geometry:{type:"MultiPolygon",coordinates:[[[[-77.32389,8.81247],[-77.58292,9.22278],[-78.79327,9.93766],[-82.51044,9.65379],[-82.56507,9.57279],[-82.61345,9.49881],[-82.66667,9.49746],[-82.77206,9.59573],[-82.87919,9.62645],[-82.84871,9.4973],[-82.93516,9.46741],[-82.93516,9.07687],[-82.72126,8.97125],[-82.88253,8.83331],[-82.91377,8.774],[-82.92068,8.74832],[-82.8794,8.6981],[-82.82739,8.60153],[-82.83975,8.54755],[-82.83322,8.52464],[-82.8382,8.48117],[-82.8679,8.44042],[-82.93056,8.43465],[-83.05209,8.33394],[-82.9388,8.26634],[-82.88641,8.10219],[-82.89137,8.05755],[-82.89978,8.04083],[-82.94503,7.93865],[-82.13751,6.97312],[-78.06168,7.07793],[-77.89178,7.22681],[-77.81426,7.48319],[-77.72157,7.47612],[-77.72514,7.72348],[-77.57185,7.51147],[-77.17257,7.97422],[-77.45064,8.49991],[-77.32389,8.81247]]]]}},{type:"Feature",properties:{iso1A2:"PE",iso1A3:"PER",iso1N3:"604",wikidata:"Q419",nameEn:"Peru",groups:["005","419","019","UN"],callingCodes:["51"]},geometry:{type:"MultiPolygon",coordinates:[[[[-74.26675,-.97229],[-74.42701,-.50218],[-75.18513,-.0308],[-75.25764,-.11943],[-75.40192,-.17196],[-75.61997,-.10012],[-75.60169,-.18708],[-75.53615,-.19213],[-75.22862,-.60048],[-75.22862,-.95588],[-75.3872,-.9374],[-75.57429,-1.55961],[-76.05203,-2.12179],[-76.6324,-2.58397],[-77.94147,-3.05454],[-78.19369,-3.36431],[-78.14324,-3.47653],[-78.22642,-3.51113],[-78.24589,-3.39907],[-78.34362,-3.38633],[-78.68394,-4.60754],[-78.85149,-4.66795],[-79.01659,-5.01481],[-79.1162,-4.97774],[-79.26248,-4.95167],[-79.59402,-4.46848],[-79.79722,-4.47558],[-80.13945,-4.29786],[-80.39256,-4.48269],[-80.46386,-4.41516],[-80.32114,-4.21323],[-80.45023,-4.20938],[-80.4822,-4.05477],[-80.46386,-4.01342],[-80.13232,-3.90317],[-80.19926,-3.68894],[-80.18741,-3.63994],[-80.19848,-3.59249],[-80.21642,-3.5888],[-80.20535,-3.51667],[-80.22629,-3.501],[-80.23651,-3.48652],[-80.24586,-3.48677],[-80.24123,-3.46124],[-80.20647,-3.431],[-80.30602,-3.39149],[-84.52388,-3.36941],[-85.71054,-21.15413],[-70.59118,-18.35072],[-70.378,-18.3495],[-70.31267,-18.31258],[-70.16394,-18.31737],[-69.96732,-18.25992],[-69.81607,-18.12582],[-69.75305,-17.94605],[-69.82868,-17.72048],[-69.79087,-17.65563],[-69.66483,-17.65083],[-69.46897,-17.4988],[-69.46863,-17.37466],[-69.62883,-17.28142],[-69.16896,-16.72233],[-69.00853,-16.66769],[-69.04027,-16.57214],[-68.98358,-16.42165],[-68.79464,-16.33272],[-68.96238,-16.194],[-69.09986,-16.22693],[-69.20291,-16.16668],[-69.40336,-15.61358],[-69.14856,-15.23478],[-69.36254,-14.94634],[-68.88135,-14.18639],[-69.05265,-13.68546],[-68.8864,-13.40792],[-68.85615,-12.87769],[-68.65044,-12.50689],[-68.98115,-11.8979],[-69.57156,-10.94555],[-69.57835,-10.94051],[-69.90896,-10.92744],[-70.38791,-11.07096],[-70.51395,-10.92249],[-70.64134,-11.0108],[-70.62487,-9.80666],[-70.55429,-9.76692],[-70.58453,-9.58303],[-70.53373,-9.42628],[-71.23394,-9.9668],[-72.14742,-9.98049],[-72.31883,-9.5184],[-72.72216,-9.41397],[-73.21498,-9.40904],[-72.92886,-9.04074],[-73.76576,-7.89884],[-73.65485,-7.77897],[-73.96938,-7.58465],[-73.77011,-7.28944],[-73.73986,-6.87919],[-73.12983,-6.43852],[-73.24579,-6.05764],[-72.83973,-5.14765],[-72.64391,-5.0391],[-71.87003,-4.51661],[-70.96814,-4.36915],[-70.77601,-4.15717],[-70.33236,-4.15214],[-70.19582,-4.3607],[-70.11305,-4.27281],[-70.00888,-4.37833],[-69.94708,-4.2431],[-70.3374,-3.79505],[-70.52393,-3.87553],[-70.71396,-3.7921],[-70.04609,-2.73906],[-70.94377,-2.23142],[-71.75223,-2.15058],[-72.92587,-2.44514],[-73.65312,-1.26222],[-74.26675,-.97229]]]]}},{type:"Feature",properties:{iso1A2:"PF",iso1A3:"PYF",iso1N3:"258",wikidata:"Q30971",nameEn:"French Polynesia",country:"FR",groups:["EU","Q1451600","061","009","UN"],callingCodes:["689"]},geometry:{type:"MultiPolygon",coordinates:[[[[-135.59706,-4.70473],[-156.48634,-15.52824],[-156.45576,-31.75456],[-133.59543,-28.4709],[-135.59706,-4.70473]]]]}},{type:"Feature",properties:{iso1A2:"PG",iso1A3:"PNG",iso1N3:"598",wikidata:"Q691",nameEn:"Papua New Guinea",groups:["054","009","UN"],driveSide:"left",callingCodes:["675"]},geometry:{type:"MultiPolygon",coordinates:[[[[141.03157,2.12829],[140.99813,-6.3233],[140.85295,-6.72996],[140.90448,-6.85033],[141.01763,-6.90181],[141.01842,-9.35091],[141.88934,-9.36111],[142.19246,-9.15378],[142.48658,-9.36754],[143.29772,-9.33993],[143.87386,-9.02382],[145.2855,-9.62524],[156.73836,-14.50464],[154.74815,-7.33315],[155.60735,-6.92266],[155.69784,-6.92661],[155.92557,-6.84664],[156.03993,-6.65703],[156.03296,-6.55528],[160.43769,-4.17974],[141.03157,2.12829]]]]}},{type:"Feature",properties:{iso1A2:"PH",iso1A3:"PHL",iso1N3:"608",wikidata:"Q928",nameEn:"Philippines",aliases:["PI","RP"],groups:["035","142","UN"],callingCodes:["63"]},geometry:{type:"MultiPolygon",coordinates:[[[[129.19694,7.84182],[121.8109,21.77688],[120.69238,21.52331],[118.82252,14.67191],[115.39742,10.92666],[116.79524,7.43869],[117.17735,7.52841],[117.93857,6.89845],[117.98544,6.27477],[119.52945,5.35672],[118.93936,4.09009],[118.06469,4.16638],[121.14448,2.12444],[129.19694,7.84182]]]]}},{type:"Feature",properties:{iso1A2:"PK",iso1A3:"PAK",iso1N3:"586",wikidata:"Q843",nameEn:"Pakistan",groups:["034","142","UN"],driveSide:"left",callingCodes:["92"]},geometry:{type:"MultiPolygon",coordinates:[[[[75.72737,36.7529],[75.45562,36.71971],[75.40481,36.95382],[75.13839,37.02622],[74.56453,37.03023],[74.53739,36.96224],[74.43389,37.00977],[74.04856,36.82648],[73.82685,36.91421],[72.6323,36.84601],[72.18135,36.71838],[71.80267,36.49924],[71.60491,36.39429],[71.19505,36.04134],[71.37969,35.95865],[71.55273,35.71483],[71.49917,35.6267],[71.65435,35.4479],[71.54294,35.31037],[71.5541,35.28776],[71.67495,35.21262],[71.52938,35.09023],[71.55273,35.02615],[71.49917,35.00478],[71.50329,34.97328],[71.29472,34.87728],[71.28356,34.80882],[71.08718,34.69034],[71.11602,34.63047],[71.0089,34.54568],[71.02401,34.44835],[71.17662,34.36769],[71.12815,34.26619],[71.13078,34.16503],[71.09453,34.13524],[71.09307,34.11961],[71.06933,34.10564],[71.07345,34.06242],[70.88119,33.97933],[70.54336,33.9463],[69.90203,34.04194],[69.87307,33.9689],[69.85671,33.93719],[70.00503,33.73528],[70.14236,33.71701],[70.14785,33.6553],[70.20141,33.64387],[70.17062,33.53535],[70.32775,33.34496],[70.13686,33.21064],[70.07369,33.22557],[70.02563,33.14282],[69.85259,33.09451],[69.79766,33.13247],[69.71526,33.09911],[69.57656,33.09911],[69.49004,33.01509],[69.49854,32.88843],[69.5436,32.8768],[69.47082,32.85834],[69.38018,32.76601],[69.43649,32.7302],[69.44747,32.6678],[69.38155,32.56601],[69.2868,32.53938],[69.23599,32.45946],[69.27932,32.29119],[69.27032,32.14141],[69.3225,31.93186],[69.20577,31.85957],[69.11514,31.70782],[69.00939,31.62249],[68.95995,31.64822],[68.91078,31.59687],[68.79997,31.61665],[68.6956,31.75687],[68.57475,31.83158],[68.44222,31.76446],[68.27605,31.75863],[68.25614,31.80357],[68.1655,31.82691],[68.00071,31.6564],[67.86887,31.63536],[67.72056,31.52304],[67.58323,31.52772],[67.62374,31.40473],[67.7748,31.4188],[67.78854,31.33203],[67.29964,31.19586],[67.03323,31.24519],[67.04147,31.31561],[66.83273,31.26867],[66.72561,31.20526],[66.68166,31.07597],[66.58175,30.97532],[66.42645,30.95309],[66.39194,30.9408],[66.28413,30.57001],[66.34869,30.404],[66.23609,30.06321],[66.36042,29.9583],[66.24175,29.85181],[65.04005,29.53957],[64.62116,29.58903],[64.19796,29.50407],[64.12966,29.39157],[63.5876,29.50456],[62.47751,29.40782],[60.87231,29.86514],[61.31508,29.38903],[61.53765,29.00507],[61.65978,28.77937],[61.93581,28.55284],[62.40259,28.42703],[62.59499,28.24842],[62.79412,28.28108],[62.7638,28.02992],[62.84905,27.47627],[62.79684,27.34381],[62.80604,27.22412],[63.19649,27.25674],[63.32283,27.14437],[63.25005,27.08692],[63.25005,26.84212],[63.18688,26.83844],[63.1889,26.65072],[62.77352,26.64099],[62.31484,26.528],[62.21304,26.26601],[62.05117,26.31647],[61.89391,26.26251],[61.83831,26.07249],[61.83968,25.7538],[61.683,25.66638],[61.6433,25.27541],[61.46682,24.57869],[68.11329,23.53945],[68.20763,23.85849],[68.39339,23.96838],[68.74643,23.97027],[68.7416,24.31904],[68.90914,24.33156],[68.97781,24.26021],[69.07806,24.29777],[69.19341,24.25646],[69.29778,24.28712],[69.59579,24.29777],[69.73335,24.17007],[70.03428,24.172],[70.11712,24.30915],[70.5667,24.43787],[70.57906,24.27774],[70.71502,24.23517],[70.88393,24.27398],[70.85784,24.30903],[70.94985,24.3791],[71.04461,24.34657],[71.12838,24.42662],[71.00341,24.46038],[70.97594,24.60904],[71.09405,24.69017],[70.94002,24.92843],[70.89148,25.15064],[70.66695,25.39314],[70.67382,25.68186],[70.60378,25.71898],[70.53649,25.68928],[70.37444,25.67443],[70.2687,25.71156],[70.0985,25.93238],[70.08193,26.08094],[70.17532,26.24118],[70.17532,26.55362],[70.05584,26.60398],[69.88555,26.56836],[69.50904,26.74892],[69.58519,27.18109],[70.03136,27.56627],[70.12502,27.8057],[70.37307,28.01208],[70.60927,28.02178],[70.79054,27.68423],[71.89921,27.96035],[71.9244,28.11555],[72.20329,28.3869],[72.29495,28.66367],[72.40402,28.78283],[72.94272,29.02487],[73.01337,29.16422],[73.05886,29.1878],[73.28094,29.56646],[73.3962,29.94707],[73.58665,30.01848],[73.80299,30.06969],[73.97225,30.19829],[73.95736,30.28466],[73.88993,30.36305],[74.5616,31.04153],[74.67971,31.05479],[74.6852,31.12771],[74.60006,31.13711],[74.60281,31.10419],[74.56023,31.08303],[74.51629,31.13829],[74.53223,31.30321],[74.59773,31.4136],[74.64713,31.45605],[74.59319,31.50197],[74.61517,31.55698],[74.57498,31.60382],[74.47771,31.72227],[74.58907,31.87824],[74.79919,31.95983],[74.86236,32.04485],[74.9269,32.0658],[75.00793,32.03786],[75.25649,32.10187],[75.38046,32.26836],[75.28259,32.36556],[75.03265,32.49538],[74.97634,32.45367],[74.84725,32.49075],[74.68362,32.49298],[74.67431,32.56676],[74.65251,32.56416],[74.64424,32.60985],[74.69542,32.66792],[74.65345,32.71225],[74.7113,32.84219],[74.64675,32.82604],[74.6289,32.75561],[74.45312,32.77755],[74.41467,32.90563],[74.31227,32.92795],[74.34875,32.97823],[74.31854,33.02891],[74.17571,33.07495],[74.15374,33.13477],[74.02144,33.18908],[74.01366,33.25199],[74.08782,33.26232],[74.17983,33.3679],[74.18121,33.4745],[74.10115,33.56392],[74.03576,33.56718],[73.97367,33.64061],[73.98968,33.66155],[73.96423,33.73071],[74.00891,33.75437],[74.05898,33.82089],[74.14001,33.83002],[74.26086,33.92237],[74.25262,34.01577],[74.21554,34.03853],[73.91341,34.01235],[73.88732,34.05105],[73.90677,34.10504],[73.98208,34.2522],[73.90517,34.35317],[73.8475,34.32935],[73.74862,34.34183],[73.74999,34.3781],[73.88732,34.48911],[73.89419,34.54568],[73.93951,34.57169],[73.93401,34.63386],[73.96423,34.68244],[74.12897,34.70073],[74.31239,34.79626],[74.58083,34.77386],[74.6663,34.703],[75.01479,34.64629],[75.38009,34.55021],[75.75438,34.51827],[76.04614,34.67566],[76.15463,34.6429],[76.47186,34.78965],[76.67648,34.76371],[76.74377,34.84039],[76.74514,34.92488],[76.87193,34.96906],[76.99251,34.93349],[77.11796,35.05419],[76.93465,35.39866],[76.85088,35.39754],[76.75475,35.52617],[76.77323,35.66062],[76.50961,35.8908],[76.33453,35.84296],[76.14913,35.82848],[76.15325,35.9264],[75.93028,36.13136],[76.00906,36.17511],[76.0324,36.41198],[75.92391,36.56986],[75.72737,36.7529]]]]}},{type:"Feature",properties:{iso1A2:"PL",iso1A3:"POL",iso1N3:"616",wikidata:"Q36",nameEn:"Poland",groups:["EU","151","150","UN"],callingCodes:["48"]},geometry:{type:"MultiPolygon",coordinates:[[[[18.57853,55.25302],[14.20811,54.12784],[14.22634,53.9291],[14.20647,53.91671],[14.18544,53.91258],[14.20823,53.90776],[14.21323,53.8664],[14.27249,53.74464],[14.26782,53.69866],[14.2836,53.67721],[14.27133,53.66613],[14.28477,53.65955],[14.2853,53.63392],[14.31904,53.61581],[14.30416,53.55499],[14.3273,53.50587],[14.35209,53.49506],[14.4215,53.27724],[14.44133,53.27427],[14.45125,53.26241],[14.40662,53.21098],[14.37853,53.20405],[14.36696,53.16444],[14.38679,53.13669],[14.35044,53.05829],[14.25954,53.00264],[14.14056,52.95786],[14.15873,52.87715],[14.12256,52.84311],[14.13806,52.82392],[14.22071,52.81175],[14.61073,52.59847],[14.6289,52.57136],[14.60081,52.53116],[14.63056,52.48993],[14.54423,52.42568],[14.55228,52.35264],[14.56378,52.33838],[14.58149,52.28007],[14.70139,52.25038],[14.71319,52.22144],[14.68344,52.19612],[14.70616,52.16927],[14.67683,52.13936],[14.6917,52.10283],[14.72971,52.09167],[14.76026,52.06624],[14.71339,52.00337],[14.70488,51.97679],[14.7139,51.95643],[14.71836,51.95606],[14.72163,51.95188],[14.7177,51.94048],[14.70601,51.92944],[14.6933,51.9044],[14.6588,51.88359],[14.59089,51.83302],[14.60493,51.80473],[14.64625,51.79472],[14.66386,51.73282],[14.69065,51.70842],[14.75392,51.67445],[14.75759,51.62318],[14.7727,51.61263],[14.71125,51.56209],[14.73047,51.54606],[14.72652,51.53902],[14.73219,51.52922],[14.94749,51.47155],[14.9652,51.44793],[14.96899,51.38367],[14.98008,51.33449],[15.04288,51.28387],[15.01242,51.21285],[15.0047,51.16874],[14.99311,51.16249],[14.99414,51.15813],[15.00083,51.14974],[14.99646,51.14365],[14.99079,51.14284],[14.99689,51.12205],[14.98229,51.11354],[14.97938,51.07742],[14.95529,51.04552],[14.92942,50.99744],[14.89252,50.94999],[14.89681,50.9422],[14.81664,50.88148],[14.82803,50.86966],[14.99852,50.86817],[15.01088,50.97984],[14.96419,50.99108],[15.02433,51.0242],[15.03895,51.0123],[15.06218,51.02269],[15.10152,51.01095],[15.11937,50.99021],[15.16744,51.01959],[15.1743,50.9833],[15.2361,50.99886],[15.27043,50.97724],[15.2773,50.8907],[15.36656,50.83956],[15.3803,50.77187],[15.43798,50.80833],[15.73186,50.73885],[15.81683,50.75666],[15.87331,50.67188],[15.97219,50.69799],[16.0175,50.63009],[15.98317,50.61528],[16.02437,50.60046],[16.10265,50.66405],[16.20839,50.63096],[16.23174,50.67101],[16.33611,50.66579],[16.44597,50.58041],[16.34572,50.49575],[16.31413,50.50274],[16.19526,50.43291],[16.21585,50.40627],[16.22821,50.41054],[16.28118,50.36891],[16.30289,50.38292],[16.36495,50.37679],[16.3622,50.34875],[16.39379,50.3207],[16.42674,50.32509],[16.56407,50.21009],[16.55446,50.16613],[16.63137,50.1142],[16.7014,50.09659],[16.8456,50.20834],[16.98018,50.24172],[17.00353,50.21449],[17.02825,50.23118],[16.99803,50.25753],[17.02138,50.27772],[16.99803,50.30316],[16.94448,50.31281],[16.90877,50.38642],[16.85933,50.41093],[16.89229,50.45117],[17.1224,50.39494],[17.14498,50.38117],[17.19579,50.38817],[17.19991,50.3654],[17.27681,50.32246],[17.34273,50.32947],[17.34548,50.2628],[17.3702,50.28123],[17.58889,50.27837],[17.67764,50.28977],[17.69292,50.32859],[17.74648,50.29966],[17.72176,50.25665],[17.76296,50.23382],[17.70528,50.18812],[17.59404,50.16437],[17.66683,50.10275],[17.6888,50.12037],[17.7506,50.07896],[17.77669,50.02253],[17.86886,49.97452],[18.00191,50.01723],[18.04585,50.01194],[18.04585,50.03311],[18.00396,50.04954],[18.03212,50.06574],[18.07898,50.04535],[18.10628,50.00223],[18.20241,49.99958],[18.21752,49.97309],[18.27107,49.96779],[18.27794,49.93863],[18.31914,49.91565],[18.33278,49.92415],[18.33562,49.94747],[18.41604,49.93498],[18.53423,49.89906],[18.54495,49.9079],[18.54299,49.92537],[18.57697,49.91565],[18.57045,49.87849],[18.60341,49.86256],[18.57183,49.83334],[18.61278,49.7618],[18.61368,49.75426],[18.62645,49.75002],[18.62943,49.74603],[18.62676,49.71983],[18.69817,49.70473],[18.72838,49.68163],[18.80479,49.6815],[18.84786,49.5446],[18.84521,49.51672],[18.94536,49.52143],[18.97283,49.49914],[18.9742,49.39557],[19.18019,49.41165],[19.25435,49.53391],[19.36009,49.53747],[19.37795,49.574],[19.45348,49.61583],[19.52626,49.57311],[19.53313,49.52856],[19.57845,49.46077],[19.64162,49.45184],[19.6375,49.40897],[19.72127,49.39288],[19.78581,49.41701],[19.82237,49.27806],[19.75286,49.20751],[19.86409,49.19316],[19.90529,49.23532],[19.98494,49.22904],[20.08238,49.1813],[20.13738,49.31685],[20.21977,49.35265],[20.31453,49.34817],[20.31728,49.39914],[20.39939,49.3896],[20.46422,49.41612],[20.5631,49.375],[20.61666,49.41791],[20.72274,49.41813],[20.77971,49.35383],[20.9229,49.29626],[20.98733,49.30774],[21.09799,49.37176],[21.041,49.41791],[21.12477,49.43666],[21.19756,49.4054],[21.27858,49.45988],[21.43376,49.41433],[21.62328,49.4447],[21.77983,49.35443],[21.82927,49.39467],[21.96385,49.3437],[22.04427,49.22136],[22.56155,49.08865],[22.89122,49.00725],[22.86336,49.10513],[22.72009,49.20288],[22.748,49.32759],[22.69444,49.49378],[22.64534,49.53094],[22.78304,49.65543],[22.80261,49.69098],[22.83179,49.69875],[22.99329,49.84249],[23.28221,50.0957],[23.67635,50.33385],[23.71382,50.38248],[23.79445,50.40481],[23.99563,50.41289],[24.03668,50.44507],[24.07048,50.5071],[24.0996,50.60752],[24.0595,50.71625],[23.95925,50.79271],[23.99254,50.83847],[24.0952,50.83262],[24.14524,50.86128],[24.04576,50.90196],[23.92217,51.00836],[23.90376,51.07697],[23.80678,51.18405],[23.63858,51.32182],[23.69905,51.40871],[23.62751,51.50512],[23.56236,51.53673],[23.57053,51.55938],[23.53198,51.74298],[23.62691,51.78208],[23.61523,51.92066],[23.68733,51.9906],[23.64066,52.07626],[23.61,52.11264],[23.54314,52.12148],[23.47859,52.18215],[23.20071,52.22848],[23.18196,52.28812],[23.34141,52.44845],[23.45112,52.53774],[23.58296,52.59868],[23.73615,52.6149],[23.93763,52.71332],[23.91805,52.94016],[23.94689,52.95919],[23.92184,53.02079],[23.87548,53.0831],[23.91393,53.16469],[23.85657,53.22923],[23.81995,53.24131],[23.62004,53.60942],[23.51284,53.95052],[23.48261,53.98855],[23.52702,54.04622],[23.49196,54.14764],[23.45223,54.17775],[23.42418,54.17911],[23.39525,54.21672],[23.3494,54.25155],[23.24656,54.25701],[23.15938,54.29894],[23.15526,54.31076],[23.13905,54.31567],[23.104,54.29794],[23.04323,54.31567],[23.05726,54.34565],[22.99649,54.35927],[23.00584,54.38514],[22.83756,54.40827],[22.79705,54.36264],[21.41123,54.32395],[20.63871,54.3706],[19.8038,54.44203],[19.64312,54.45423],[18.57853,55.25302]]]]}},{type:"Feature",properties:{iso1A2:"PM",iso1A3:"SPM",iso1N3:"666",wikidata:"Q34617",nameEn:"Saint Pierre and Miquelon",country:"FR",groups:["EU","Q1451600","021","003","019","UN"],callingCodes:["508"]},geometry:{type:"MultiPolygon",coordinates:[[[[-56.72993,46.65575],[-55.90758,46.6223],[-56.27503,47.39728],[-56.72993,46.65575]]]]}},{type:"Feature",properties:{iso1A2:"PN",iso1A3:"PCN",iso1N3:"612",wikidata:"Q35672",nameEn:"Pitcairn Islands",country:"GB",groups:["BOTS","061","009","UN"],driveSide:"left",callingCodes:["64"]},geometry:{type:"MultiPolygon",coordinates:[[[[-133.59543,-28.4709],[-122.0366,-24.55017],[-133.61511,-21.93325],[-133.59543,-28.4709]]]]}},{type:"Feature",properties:{iso1A2:"PR",iso1A3:"PRI",iso1N3:"630",wikidata:"Q1183",nameEn:"Puerto Rico",aliases:["US-PR"],country:"US",groups:["Q1352230","029","003","419","019","UN"],roadSpeedUnit:"mph",callingCodes:["1 787","1 939"]},geometry:{type:"MultiPolygon",coordinates:[[[[-65.27974,17.56928],[-65.02435,18.73231],[-67.99519,18.97186],[-68.23894,17.84663],[-65.27974,17.56928]]]]}},{type:"Feature",properties:{iso1A2:"PS",iso1A3:"PSE",iso1N3:"275",wikidata:"Q219060",nameEn:"Palestine"},geometry:null},{type:"Feature",properties:{iso1A2:"PT",iso1A3:"PRT",iso1N3:"620",wikidata:"Q45",nameEn:"Portugal"},geometry:null},{type:"Feature",properties:{iso1A2:"PW",iso1A3:"PLW",iso1N3:"585",wikidata:"Q695",nameEn:"Palau",groups:["057","009","UN"],roadSpeedUnit:"mph",callingCodes:["680"]},geometry:{type:"MultiPolygon",coordinates:[[[[128.97621,3.08804],[136.39296,1.54187],[136.04605,12.45908],[128.97621,3.08804]]]]}},{type:"Feature",properties:{iso1A2:"PY",iso1A3:"PRY",iso1N3:"600",wikidata:"Q733",nameEn:"Paraguay",groups:["005","419","019","UN"],callingCodes:["595"]},geometry:{type:"MultiPolygon",coordinates:[[[[-58.16225,-20.16193],[-58.23216,-19.80058],[-59.06965,-19.29148],[-60.00638,-19.2981],[-61.73723,-19.63958],[-61.93912,-20.10053],[-62.26883,-20.55311],[-62.2757,-21.06657],[-62.64455,-22.25091],[-62.51761,-22.37684],[-62.22768,-22.55807],[-61.9756,-23.0507],[-61.0782,-23.62932],[-60.99754,-23.80934],[-60.28163,-24.04436],[-60.03367,-24.00701],[-59.45482,-24.34787],[-59.33886,-24.49935],[-58.33055,-24.97099],[-58.25492,-24.92528],[-57.80821,-25.13863],[-57.57431,-25.47269],[-57.87176,-25.93604],[-58.1188,-26.16704],[-58.3198,-26.83443],[-58.65321,-27.14028],[-58.59549,-27.29973],[-58.04205,-27.2387],[-56.85337,-27.5165],[-56.18313,-27.29851],[-55.89195,-27.3467],[-55.74475,-27.44485],[-55.59094,-27.32444],[-55.62322,-27.1941],[-55.39611,-26.97679],[-55.25243,-26.93808],[-55.16948,-26.96068],[-55.06351,-26.80195],[-55.00584,-26.78754],[-54.80868,-26.55669],[-54.70732,-26.45099],[-54.69333,-26.37705],[-54.67359,-25.98607],[-54.60664,-25.9691],[-54.62063,-25.91213],[-54.59398,-25.59224],[-54.59509,-25.53696],[-54.60196,-25.48397],[-54.62033,-25.46026],[-54.4423,-25.13381],[-54.28207,-24.07305],[-54.32807,-24.01865],[-54.6238,-23.83078],[-55.02691,-23.97317],[-55.0518,-23.98666],[-55.12292,-23.99669],[-55.41784,-23.9657],[-55.44117,-23.9185],[-55.43585,-23.87157],[-55.5555,-23.28237],[-55.52288,-23.2595],[-55.5446,-23.22811],[-55.63849,-22.95122],[-55.62493,-22.62765],[-55.68742,-22.58407],[-55.6986,-22.56268],[-55.72366,-22.5519],[-55.741,-22.52018],[-55.74941,-22.46436],[-55.8331,-22.29008],[-56.23206,-22.25347],[-56.45893,-22.08072],[-56.5212,-22.11556],[-56.6508,-22.28387],[-57.98625,-22.09157],[-57.94642,-21.73799],[-57.88239,-21.6868],[-57.93492,-21.65505],[-57.84536,-20.93155],[-58.16225,-20.16193]]]]}},{type:"Feature",properties:{iso1A2:"QA",iso1A3:"QAT",iso1N3:"634",wikidata:"Q846",nameEn:"Qatar",groups:["145","142","UN"],callingCodes:["974"]},geometry:{type:"MultiPolygon",coordinates:[[[[50.92992,24.54396],[51.09638,24.46907],[51.29972,24.50747],[51.39468,24.62785],[51.58834,24.66608],[51.83108,24.71675],[51.83682,26.70231],[50.93865,26.30758],[50.81266,25.88946],[50.86149,25.6965],[50.7801,25.595],[50.80824,25.54641],[50.57069,25.57887],[50.8133,24.74049],[50.92992,24.54396]]]]}},{type:"Feature",properties:{iso1A2:"RE",iso1A3:"REU",iso1N3:"638",wikidata:"Q17070",nameEn:"R\xE9union",country:"FR",groups:["Q3320166","EU","014","202","002","UN"],callingCodes:["262"]},geometry:{type:"MultiPolygon",coordinates:[[[[53.37984,-21.23941],[56.73473,-21.9174],[56.62373,-20.2711],[53.37984,-21.23941]]]]}},{type:"Feature",properties:{iso1A2:"RO",iso1A3:"ROU",iso1N3:"642",wikidata:"Q218",nameEn:"Romania",groups:["EU","151","150","UN"],callingCodes:["40"]},geometry:{type:"MultiPolygon",coordinates:[[[[27.15622,47.98538],[27.02985,48.09083],[27.04118,48.12522],[26.96119,48.13003],[26.98042,48.15752],[26.94265,48.1969],[26.87708,48.19919],[26.81161,48.25049],[26.62823,48.25804],[26.55202,48.22445],[26.33504,48.18418],[26.17711,47.99246],[26.05901,47.9897],[25.77723,47.93919],[25.63878,47.94924],[25.23778,47.89403],[25.11144,47.75203],[24.88896,47.7234],[24.81893,47.82031],[24.70632,47.84428],[24.61994,47.95062],[24.43578,47.97131],[24.34926,47.9244],[24.22566,47.90231],[24.11281,47.91487],[24.06466,47.95317],[24.02999,47.95087],[24.00801,47.968],[23.98553,47.96076],[23.96337,47.96672],[23.94192,47.94868],[23.89352,47.94512],[23.8602,47.9329],[23.80904,47.98142],[23.75188,47.99705],[23.66262,47.98786],[23.63894,48.00293],[23.5653,48.00499],[23.52803,48.01818],[23.4979,47.96858],[23.33577,48.0237],[23.27397,48.08245],[23.15999,48.12188],[23.1133,48.08061],[23.08858,48.00716],[23.0158,47.99338],[22.92241,48.02002],[22.94301,47.96672],[22.89849,47.95851],[22.77991,47.87211],[22.76617,47.8417],[22.67247,47.7871],[22.46559,47.76583],[22.41979,47.7391],[22.31816,47.76126],[22.00917,47.50492],[22.03389,47.42508],[22.01055,47.37767],[21.94463,47.38046],[21.78395,47.11104],[21.648,47.03902],[21.68645,46.99595],[21.59581,46.91628],[21.59307,46.86935],[21.52028,46.84118],[21.48935,46.7577],[21.5151,46.72147],[21.43926,46.65109],[21.33214,46.63035],[21.26929,46.4993],[21.28061,46.44941],[21.16872,46.30118],[21.06572,46.24897],[20.86797,46.28884],[20.74574,46.25467],[20.76085,46.21002],[20.63863,46.12728],[20.49718,46.18721],[20.45377,46.14405],[20.35573,46.16629],[20.28324,46.1438],[20.26068,46.12332],[20.35862,45.99356],[20.54818,45.89939],[20.65645,45.82801],[20.70069,45.7493],[20.77416,45.75601],[20.78446,45.78522],[20.82364,45.77738],[20.80361,45.65875],[20.76798,45.60969],[20.83321,45.53567],[20.77217,45.49788],[20.86026,45.47295],[20.87948,45.42743],[21.09894,45.30144],[21.17612,45.32566],[21.20392,45.2677],[21.29398,45.24148],[21.48278,45.19557],[21.51299,45.15345],[21.4505,45.04294],[21.35855,45.01941],[21.54938,44.9327],[21.56328,44.89502],[21.48202,44.87199],[21.44013,44.87613],[21.35643,44.86364],[21.38802,44.78133],[21.55007,44.77304],[21.60019,44.75208],[21.61942,44.67059],[21.67504,44.67107],[21.71692,44.65349],[21.7795,44.66165],[21.99364,44.63395],[22.08016,44.49844],[22.13234,44.47444],[22.18315,44.48179],[22.30844,44.6619],[22.45301,44.7194],[22.61917,44.61489],[22.69196,44.61587],[22.76749,44.54446],[22.70981,44.51852],[22.61368,44.55719],[22.56493,44.53419],[22.54021,44.47836],[22.45436,44.47258],[22.56012,44.30712],[22.68166,44.28206],[22.67173,44.21564],[23.04988,44.07694],[23.01674,44.01946],[22.87873,43.9844],[22.83753,43.88055],[22.85314,43.84452],[23.05288,43.79494],[23.26772,43.84843],[23.4507,43.84936],[23.61687,43.79289],[23.73978,43.80627],[24.18149,43.68218],[24.35364,43.70211],[24.50264,43.76314],[24.62281,43.74082],[24.73542,43.68523],[24.96682,43.72693],[25.10718,43.6831],[25.17144,43.70261],[25.39528,43.61866],[25.72792,43.69263],[25.94911,43.85745],[26.05584,43.90925],[26.10115,43.96908],[26.38764,44.04356],[26.62712,44.05698],[26.95141,44.13555],[27.26845,44.12602],[27.39757,44.0141],[27.60834,44.01206],[27.64542,44.04958],[27.73468,43.95326],[27.92008,44.00761],[27.99558,43.84193],[28.23293,43.76],[29.24336,43.70874],[30.04414,45.08461],[29.69272,45.19227],[29.65428,45.25629],[29.68175,45.26885],[29.59798,45.38857],[29.42632,45.44545],[29.24779,45.43388],[28.96077,45.33164],[28.94292,45.28045],[28.81383,45.3384],[28.78911,45.24179],[28.71358,45.22631],[28.5735,45.24759],[28.34554,45.32102],[28.28504,45.43907],[28.21139,45.46895],[28.18741,45.47358],[28.08927,45.6051],[28.16568,45.6421],[28.13111,45.92819],[28.08612,46.01105],[28.13684,46.18099],[28.10937,46.22852],[28.19864,46.31869],[28.18902,46.35283],[28.25769,46.43334],[28.22281,46.50481],[28.24808,46.64305],[28.12173,46.82283],[28.09095,46.97621],[27.81892,47.1381],[27.73172,47.29248],[27.68706,47.28962],[27.60263,47.32507],[27.55731,47.46637],[27.47942,47.48113],[27.3979,47.59473],[27.32202,47.64009],[27.25519,47.71366],[27.29069,47.73722],[27.1618,47.92391],[27.15622,47.98538]]]]}},{type:"Feature",properties:{iso1A2:"RS",iso1A3:"SRB",iso1N3:"688",wikidata:"Q403",nameEn:"Serbia",groups:["039","150","UN"],callingCodes:["381"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.66007,46.19005],[19.56113,46.16824],[19.52473,46.1171],[19.28826,45.99694],[19.14543,45.9998],[19.10388,46.04015],[19.0791,45.96458],[19.01284,45.96529],[18.99712,45.93537],[18.81394,45.91329],[18.85783,45.85493],[18.90305,45.71863],[18.96691,45.66731],[18.88776,45.57253],[18.94562,45.53712],[19.07471,45.53086],[19.08364,45.48804],[18.99918,45.49333],[18.97446,45.37528],[19.10774,45.29547],[19.28208,45.23813],[19.41941,45.23475],[19.43589,45.17137],[19.19144,45.17863],[19.14063,45.12972],[19.07952,45.14668],[19.1011,45.01191],[19.05205,44.97692],[19.15573,44.95409],[19.06853,44.89915],[19.02871,44.92541],[18.98957,44.90645],[19.01994,44.85493],[19.18183,44.92055],[19.36722,44.88164],[19.32543,44.74058],[19.26388,44.65412],[19.16699,44.52197],[19.13369,44.52521],[19.12278,44.50132],[19.14837,44.45253],[19.14681,44.41463],[19.11785,44.40313],[19.10749,44.39421],[19.10704,44.38249],[19.10365,44.37795],[19.10298,44.36924],[19.11865,44.36712],[19.1083,44.3558],[19.11547,44.34218],[19.13556,44.338],[19.13332,44.31492],[19.16741,44.28648],[19.18328,44.28383],[19.20508,44.2917],[19.23306,44.26097],[19.26945,44.26957],[19.32464,44.27185],[19.34773,44.23244],[19.3588,44.18353],[19.40927,44.16722],[19.43905,44.13088],[19.47338,44.15034],[19.48386,44.14332],[19.47321,44.1193],[19.51167,44.08158],[19.55999,44.06894],[19.57467,44.04716],[19.61991,44.05254],[19.61836,44.01464],[19.56498,43.99922],[19.52515,43.95573],[19.38439,43.96611],[19.24363,44.01502],[19.23465,43.98764],[19.3986,43.79668],[19.5176,43.71403],[19.50455,43.58385],[19.42696,43.57987],[19.41941,43.54056],[19.36653,43.60921],[19.33426,43.58833],[19.2553,43.5938],[19.24774,43.53061],[19.22807,43.5264],[19.22229,43.47926],[19.44315,43.38846],[19.48171,43.32644],[19.52962,43.31623],[19.54598,43.25158],[19.62661,43.2286],[19.64063,43.19027],[19.76918,43.16044],[19.79255,43.11951],[19.92576,43.08539],[19.96549,43.11098],[19.98887,43.0538],[20.04729,43.02732],[20.05431,42.99571],[20.12325,42.96237],[20.14896,42.99058],[20.16415,42.97177],[20.34528,42.90676],[20.35692,42.8335],[20.40594,42.84853],[20.43734,42.83157],[20.53484,42.8885],[20.48692,42.93208],[20.59929,43.01067],[20.64557,43.00826],[20.69515,43.09641],[20.59929,43.20492],[20.68688,43.21335],[20.73811,43.25068],[20.82145,43.26769],[20.88685,43.21697],[20.83727,43.17842],[20.96287,43.12416],[21.00749,43.13984],[21.05378,43.10707],[21.08952,43.13471],[21.14465,43.11089],[21.16734,42.99694],[21.2041,43.02277],[21.23877,43.00848],[21.23534,42.95523],[21.2719,42.8994],[21.32974,42.90424],[21.36941,42.87397],[21.44047,42.87276],[21.39045,42.74888],[21.47498,42.74695],[21.59154,42.72643],[21.58755,42.70418],[21.6626,42.67813],[21.75025,42.70125],[21.79413,42.65923],[21.75672,42.62695],[21.7327,42.55041],[21.70522,42.54176],[21.7035,42.51899],[21.62556,42.45106],[21.64209,42.41081],[21.62887,42.37664],[21.59029,42.38042],[21.57021,42.3647],[21.53467,42.36809],[21.5264,42.33634],[21.56772,42.30946],[21.58992,42.25915],[21.70111,42.23789],[21.77176,42.2648],[21.84654,42.3247],[21.91595,42.30392],[21.94405,42.34669],[22.02908,42.29848],[22.16384,42.32103],[22.29605,42.37477],[22.29275,42.34913],[22.34773,42.31725],[22.45919,42.33822],[22.47498,42.3915],[22.51961,42.3991],[22.55669,42.50144],[22.43983,42.56851],[22.4997,42.74144],[22.43309,42.82057],[22.54302,42.87774],[22.74826,42.88701],[22.78397,42.98253],[22.89521,43.03625],[22.98104,43.11199],[23.00806,43.19279],[22.89727,43.22417],[22.82036,43.33665],[22.53397,43.47225],[22.47582,43.6558],[22.41043,43.69566],[22.35558,43.81281],[22.41449,44.00514],[22.61688,44.06534],[22.61711,44.16938],[22.67173,44.21564],[22.68166,44.28206],[22.56012,44.30712],[22.45436,44.47258],[22.54021,44.47836],[22.56493,44.53419],[22.61368,44.55719],[22.70981,44.51852],[22.76749,44.54446],[22.69196,44.61587],[22.61917,44.61489],[22.45301,44.7194],[22.30844,44.6619],[22.18315,44.48179],[22.13234,44.47444],[22.08016,44.49844],[21.99364,44.63395],[21.7795,44.66165],[21.71692,44.65349],[21.67504,44.67107],[21.61942,44.67059],[21.60019,44.75208],[21.55007,44.77304],[21.38802,44.78133],[21.35643,44.86364],[21.44013,44.87613],[21.48202,44.87199],[21.56328,44.89502],[21.54938,44.9327],[21.35855,45.01941],[21.4505,45.04294],[21.51299,45.15345],[21.48278,45.19557],[21.29398,45.24148],[21.20392,45.2677],[21.17612,45.32566],[21.09894,45.30144],[20.87948,45.42743],[20.86026,45.47295],[20.77217,45.49788],[20.83321,45.53567],[20.76798,45.60969],[20.80361,45.65875],[20.82364,45.77738],[20.78446,45.78522],[20.77416,45.75601],[20.70069,45.7493],[20.65645,45.82801],[20.54818,45.89939],[20.35862,45.99356],[20.26068,46.12332],[20.09713,46.17315],[20.03533,46.14509],[20.01816,46.17696],[19.93508,46.17553],[19.81491,46.1313],[19.66007,46.19005]]]]}},{type:"Feature",properties:{iso1A2:"RU",iso1A3:"RUS",iso1N3:"643",wikidata:"Q159",nameEn:"Russia"},geometry:null},{type:"Feature",properties:{iso1A2:"RW",iso1A3:"RWA",iso1N3:"646",wikidata:"Q1037",nameEn:"Rwanda",groups:["014","202","002","UN"],callingCodes:["250"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.47194,-1.0555],[30.35212,-1.06896],[30.16369,-1.34303],[29.912,-1.48269],[29.82657,-1.31187],[29.59061,-1.39016],[29.53062,-1.40499],[29.45038,-1.5054],[29.36322,-1.50887],[29.24323,-1.66826],[29.24458,-1.69663],[29.11847,-1.90576],[29.17562,-2.12278],[29.105,-2.27043],[29.00051,-2.29001],[28.95642,-2.37321],[28.89601,-2.37321],[28.86826,-2.41888],[28.86846,-2.44866],[28.89132,-2.47557],[28.89342,-2.49017],[28.88846,-2.50493],[28.87497,-2.50887],[28.86209,-2.5231],[28.86193,-2.53185],[28.87943,-2.55165],[28.89288,-2.55848],[28.90226,-2.62385],[28.89793,-2.66111],[28.94346,-2.69124],[29.00357,-2.70596],[29.04081,-2.7416],[29.0562,-2.58632],[29.32234,-2.6483],[29.36805,-2.82933],[29.88237,-2.75105],[29.95911,-2.33348],[30.14034,-2.43626],[30.42933,-2.31064],[30.54501,-2.41404],[30.83915,-2.35795],[30.89303,-2.08223],[30.80802,-1.91477],[30.84079,-1.64652],[30.71974,-1.43244],[30.57123,-1.33264],[30.50889,-1.16412],[30.45116,-1.10641],[30.47194,-1.0555]]]]}},{type:"Feature",properties:{iso1A2:"SA",iso1A3:"SAU",iso1N3:"682",wikidata:"Q851",nameEn:"Saudi Arabia",groups:["145","142","UN"],callingCodes:["966"]},geometry:{type:"MultiPolygon",coordinates:[[[[40.01521,32.05667],[39.29903,32.23259],[38.99233,31.99721],[36.99791,31.50081],[37.99354,30.49998],[37.66395,30.33245],[37.4971,29.99949],[36.75083,29.86903],[36.50005,29.49696],[36.07081,29.18469],[34.8812,29.36878],[34.4454,27.91479],[37.8565,22.00903],[39.63762,18.37348],[40.99158,15.81743],[42.15205,16.40211],[42.76801,16.40371],[42.94625,16.39721],[42.94351,16.49467],[42.97215,16.51093],[43.11601,16.53166],[43.15274,16.67248],[43.22066,16.65179],[43.21325,16.74416],[43.25857,16.75304],[43.26303,16.79479],[43.24801,16.80613],[43.22956,16.80613],[43.22012,16.83932],[43.18338,16.84852],[43.1398,16.90696],[43.19328,16.94703],[43.1813,16.98438],[43.18233,17.02673],[43.23967,17.03428],[43.17787,17.14717],[43.20156,17.25901],[43.32653,17.31179],[43.22533,17.38343],[43.29185,17.53224],[43.43005,17.56148],[43.70631,17.35762],[44.50126,17.47475],[46.31018,17.20464],[46.76494,17.29151],[47.00571,16.94765],[47.48245,17.10808],[47.58351,17.50366],[48.19996,18.20584],[49.04884,18.59899],[52.00311,19.00083],[54.99756,20.00083],[55.66469,21.99658],[55.2137,22.71065],[55.13599,22.63334],[52.56622,22.94341],[51.59617,24.12041],[51.58871,24.27256],[51.41644,24.39615],[51.58834,24.66608],[51.39468,24.62785],[51.29972,24.50747],[51.09638,24.46907],[50.92992,24.54396],[50.8133,24.74049],[50.57069,25.57887],[50.302,25.87592],[50.26923,26.08243],[50.38162,26.53976],[50.71771,26.73086],[50.37726,27.89227],[49.98877,27.87827],[49.00421,28.81495],[48.42991,28.53628],[47.70561,28.5221],[47.59863,28.66798],[47.58376,28.83382],[47.46202,29.0014],[46.5527,29.10283],[46.42415,29.05947],[44.72255,29.19736],[42.97796,30.48295],[42.97601,30.72204],[40.01521,32.05667]]]]}},{type:"Feature",properties:{iso1A2:"SB",iso1A3:"SLB",iso1N3:"090",wikidata:"Q685",nameEn:"Solomon Islands",groups:["054","009","UN"],driveSide:"left",callingCodes:["677"]},geometry:{type:"MultiPolygon",coordinates:[[[[172.71443,-12.01327],[160.43769,-4.17974],[156.03296,-6.55528],[156.03993,-6.65703],[155.92557,-6.84664],[155.69784,-6.92661],[155.60735,-6.92266],[154.74815,-7.33315],[156.73836,-14.50464],[172.71443,-12.01327]]]]}},{type:"Feature",properties:{iso1A2:"SC",iso1A3:"SYC",iso1N3:"690",wikidata:"Q1042",nameEn:"Seychelles",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["248"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.75112,-10.38913],[54.83239,-10.93575],[66.3222,5.65313],[43.75112,-10.38913]]]]}},{type:"Feature",properties:{iso1A2:"SD",iso1A3:"SDN",iso1N3:"729",wikidata:"Q1049",nameEn:"Sudan",groups:["015","002","UN"],callingCodes:["249"]},geometry:{type:"MultiPolygon",coordinates:[[[[37.8565,22.00903],[34.0765,22.00501],[33.99686,21.76784],[33.57251,21.72406],[33.17563,22.00405],[24.99885,21.99535],[24.99794,19.99661],[23.99715,20.00038],[23.99539,19.49944],[23.99997,15.69575],[23.62785,15.7804],[23.38812,15.69649],[23.10792,15.71297],[22.93201,15.55107],[22.92579,15.47007],[22.99584,15.40105],[22.99584,15.22989],[22.66115,14.86308],[22.70474,14.69149],[22.38562,14.58907],[22.44944,14.24986],[22.55997,14.23024],[22.5553,14.11704],[22.22995,13.96754],[22.08674,13.77863],[22.29689,13.3731],[22.1599,13.19281],[22.02914,13.13976],[21.94819,13.05637],[21.81432,12.81362],[21.89371,12.68001],[21.98711,12.63292],[22.15679,12.66634],[22.22684,12.74682],[22.46345,12.61925],[22.38873,12.45514],[22.50548,12.16769],[22.48369,12.02766],[22.64092,12.07485],[22.54907,11.64372],[22.7997,11.40424],[22.93124,11.41645],[22.97249,11.21955],[22.87758,10.91915],[23.02221,10.69235],[23.3128,10.45214],[23.67164,9.86923],[23.69155,9.67566],[24.09319,9.66572],[24.12744,9.73784],[24.49389,9.79962],[24.84653,9.80643],[24.97739,9.9081],[25.05688,10.06776],[25.0918,10.33718],[25.78141,10.42599],[25.93163,10.38159],[25.93241,10.17941],[26.21338,9.91545],[26.35815,9.57946],[26.70685,9.48735],[27.14427,9.62858],[27.90704,9.61323],[28.99983,9.67155],[29.06988,9.74826],[29.53844,9.75133],[29.54,10.07949],[29.94629,10.29245],[30.00389,10.28633],[30.53005,9.95992],[30.82893,9.71451],[30.84605,9.7498],[31.28504,9.75287],[31.77539,10.28939],[31.99177,10.65065],[32.46967,11.04662],[32.39358,11.18207],[32.39578,11.70208],[32.10079,11.95203],[32.73921,11.95203],[32.73921,12.22757],[33.25876,12.22111],[33.13988,11.43248],[33.26977,10.83632],[33.24645,10.77913],[33.52294,10.64382],[33.66604,10.44254],[33.80913,10.32994],[33.90159,10.17179],[33.96984,10.15446],[33.99185,9.99623],[33.96323,9.80972],[33.9082,9.762],[33.87958,9.49937],[34.10229,9.50238],[34.08717,9.55243],[34.13186,9.7492],[34.20484,9.9033],[34.22718,10.02506],[34.32102,10.11599],[34.34783,10.23914],[34.2823,10.53508],[34.4372,10.781],[34.59062,10.89072],[34.77383,10.74588],[34.77532,10.69027],[34.86618,10.74588],[34.86916,10.78832],[34.97491,10.86147],[34.97789,10.91559],[34.93172,10.95946],[35.01215,11.19626],[34.95704,11.24448],[35.09556,11.56278],[35.05832,11.71158],[35.11492,11.85156],[35.24302,11.91132],[35.70476,12.67101],[36.01458,12.72478],[36.14268,12.70879],[36.16651,12.88019],[36.13374,12.92665],[36.24545,13.36759],[36.38993,13.56459],[36.48824,13.83954],[36.44653,13.95666],[36.54376,14.25597],[36.44337,15.14963],[36.54276,15.23478],[36.69761,15.75323],[36.76371,15.80831],[36.92193,16.23451],[36.99777,17.07172],[37.42694,17.04041],[37.50967,17.32199],[38.13362,17.53906],[38.37133,17.66269],[38.45916,17.87167],[38.57727,17.98125],[39.63762,18.37348],[37.8565,22.00903]]]]}},{type:"Feature",properties:{iso1A2:"SE",iso1A3:"SWE",iso1N3:"752",wikidata:"Q34",nameEn:"Sweden",groups:["EU","154","150","UN"],callingCodes:["46"]},geometry:{type:"MultiPolygon",coordinates:[[[[24.15791,65.85385],[23.90497,66.15802],[23.71339,66.21299],[23.64982,66.30603],[23.67591,66.3862],[23.63776,66.43568],[23.85959,66.56434],[23.89488,66.772],[23.98059,66.79585],[23.98563,66.84149],[23.56214,67.17038],[23.58735,67.20752],[23.54701,67.25435],[23.75372,67.29914],[23.75372,67.43688],[23.39577,67.46974],[23.54701,67.59306],[23.45627,67.85297],[23.65793,67.9497],[23.40081,68.05545],[23.26469,68.15134],[23.15377,68.14759],[23.10336,68.26551],[22.73028,68.40881],[22.00429,68.50692],[21.03001,68.88969],[20.90649,68.89696],[20.85104,68.93142],[20.91658,68.96764],[20.78802,69.03087],[20.55258,69.06069],[20.0695,69.04469],[20.28444,68.93283],[20.33435,68.80174],[20.22027,68.67246],[19.95647,68.55546],[20.22027,68.48759],[19.93508,68.35911],[18.97255,68.52416],[18.63032,68.50849],[18.39503,68.58672],[18.1241,68.53721],[18.13836,68.20874],[17.90787,67.96537],[17.30416,68.11591],[16.7409,67.91037],[16.38441,67.52923],[16.12774,67.52106],[16.09922,67.4364],[16.39154,67.21653],[16.35589,67.06419],[15.37197,66.48217],[15.49318,66.28509],[15.05113,66.15572],[14.53778,66.12399],[14.50926,65.31786],[13.64276,64.58402],[14.11117,64.46674],[14.16051,64.18725],[13.98222,64.00953],[13.23411,64.09087],[12.74105,64.02171],[12.14928,63.59373],[12.19919,63.47935],[11.98529,63.27487],[12.19919,63.00104],[12.07085,62.6297],[12.29187,62.25699],[12.14746,61.7147],[12.40595,61.57226],[12.57707,61.56547],[12.86939,61.35427],[12.69115,61.06584],[12.2277,61.02442],[12.59133,60.50559],[12.52003,60.13846],[12.36317,59.99259],[12.15641,59.8926],[11.87121,59.86039],[11.92112,59.69531],[11.69297,59.59442],[11.8213,59.24985],[11.65732,58.90177],[11.45199,58.89604],[11.4601,58.99022],[11.34459,59.11672],[11.15367,59.07862],[11.08911,58.98745],[10.64958,58.89391],[10.40861,58.38489],[12.16597,56.60205],[12.07466,56.29488],[12.65312,56.04345],[12.6372,55.91371],[12.88472,55.63369],[12.60345,55.42675],[12.84405,55.13257],[14.28399,55.1553],[14.89259,55.5623],[15.79951,55.54655],[19.64795,57.06466],[19.84909,57.57876],[20.5104,59.15546],[19.08191,60.19152],[19.23413,60.61414],[20.15877,63.06556],[24.14112,65.39731],[24.15107,65.81427],[24.14798,65.83466],[24.15791,65.85385]]]]}},{type:"Feature",properties:{iso1A2:"SG",iso1A3:"SGP",iso1N3:"702",wikidata:"Q334",nameEn:"Singapore",groups:["035","142","UN"],driveSide:"left",callingCodes:["65"]},geometry:{type:"MultiPolygon",coordinates:[[[[104.00131,1.42405],[103.93384,1.42926],[103.89565,1.42841],[103.86383,1.46288],[103.81181,1.47953],[103.76395,1.45183],[103.74161,1.4502],[103.7219,1.46108],[103.67468,1.43166],[103.62738,1.35255],[103.56591,1.19719],[103.66049,1.18825],[103.74084,1.12902],[104.03085,1.26954],[104.12282,1.27714],[104.08072,1.35998],[104.09162,1.39694],[104.08871,1.42015],[104.07348,1.43322],[104.04622,1.44691],[104.02277,1.4438],[104.00131,1.42405]]]]}},{type:"Feature",properties:{iso1A2:"SH",iso1A3:"SHN",iso1N3:"654",wikidata:"Q192184",nameEn:"Saint Helena, Ascension and Tristan da Cunha",country:"GB"},geometry:null},{type:"Feature",properties:{iso1A2:"SI",iso1A3:"SVN",iso1N3:"705",wikidata:"Q215",nameEn:"Slovenia",groups:["EU","039","150","UN"],callingCodes:["386"]},geometry:{type:"MultiPolygon",coordinates:[[[[16.50139,46.56684],[16.39217,46.63673],[16.38594,46.6549],[16.41863,46.66238],[16.42641,46.69228],[16.37816,46.69975],[16.30966,46.7787],[16.31303,46.79838],[16.3408,46.80641],[16.34547,46.83836],[16.2941,46.87137],[16.2365,46.87775],[16.21892,46.86961],[16.15711,46.85434],[16.14365,46.8547],[16.10983,46.867],[16.05786,46.83927],[15.99054,46.82772],[15.99126,46.78199],[15.98432,46.74991],[15.99769,46.7266],[16.02808,46.71094],[16.04347,46.68694],[16.04036,46.6549],[15.99988,46.67947],[15.98512,46.68463],[15.94864,46.68769],[15.87691,46.7211],[15.8162,46.71897],[15.78518,46.70712],[15.76771,46.69863],[15.73823,46.70011],[15.72279,46.69548],[15.69523,46.69823],[15.67411,46.70735],[15.6543,46.70616],[15.6543,46.69228],[15.6365,46.6894],[15.63255,46.68069],[15.62317,46.67947],[15.59826,46.68908],[15.54533,46.66985],[15.55333,46.64988],[15.54431,46.6312],[15.46906,46.61321],[15.45514,46.63697],[15.41235,46.65556],[15.23711,46.63994],[15.14215,46.66131],[15.01451,46.641],[14.98024,46.6009],[14.96002,46.63459],[14.92283,46.60848],[14.87129,46.61],[14.86419,46.59411],[14.83549,46.56614],[14.81836,46.51046],[14.72185,46.49974],[14.66892,46.44936],[14.5942,46.43434],[14.56463,46.37208],[14.52176,46.42617],[14.45877,46.41717],[14.42608,46.44614],[14.314,46.43327],[14.28326,46.44315],[14.15989,46.43327],[14.12097,46.47724],[14.04002,46.49117],[14.00422,46.48474],[13.89837,46.52331],[13.7148,46.5222],[13.68684,46.43881],[13.59777,46.44137],[13.5763,46.42613],[13.5763,46.40915],[13.47019,46.3621],[13.43418,46.35992],[13.44808,46.33507],[13.37671,46.29668],[13.42218,46.20758],[13.47587,46.22725],[13.56114,46.2054],[13.56682,46.18703],[13.64451,46.18966],[13.66472,46.17392],[13.64053,46.13587],[13.57072,46.09022],[13.50104,46.05986],[13.49568,46.04839],[13.50998,46.04498],[13.49702,46.01832],[13.47474,46.00546],[13.50104,45.98078],[13.52963,45.96588],[13.56759,45.96991],[13.58903,45.99009],[13.62074,45.98388],[13.63458,45.98947],[13.64307,45.98326],[13.6329,45.94894],[13.63815,45.93607],[13.61931,45.91782],[13.60857,45.89907],[13.59565,45.89446],[13.58644,45.88173],[13.57563,45.8425],[13.58858,45.83503],[13.59784,45.8072],[13.66986,45.79955],[13.8235,45.7176],[13.83332,45.70855],[13.83422,45.68703],[13.87933,45.65207],[13.9191,45.6322],[13.8695,45.60835],[13.86771,45.59898],[13.84106,45.58185],[13.78445,45.5825],[13.74587,45.59811],[13.7198,45.59352],[13.6076,45.64761],[13.45644,45.59464],[13.56979,45.4895],[13.62902,45.45898],[13.67398,45.4436],[13.7785,45.46787],[13.81742,45.43729],[13.88124,45.42637],[13.90771,45.45149],[13.97309,45.45258],[13.99488,45.47551],[13.96063,45.50825],[14.00578,45.52352],[14.07116,45.48752],[14.20348,45.46896],[14.22371,45.50388],[14.24239,45.50607],[14.26611,45.48239],[14.27681,45.4902],[14.32487,45.47142],[14.36693,45.48642],[14.49769,45.54424],[14.5008,45.60852],[14.53816,45.6205],[14.57397,45.67165],[14.60977,45.66403],[14.59576,45.62812],[14.69694,45.57366],[14.68605,45.53006],[14.71718,45.53442],[14.80124,45.49515],[14.81992,45.45913],[14.90554,45.47769],[14.92266,45.52788],[15.02385,45.48533],[15.05187,45.49079],[15.16862,45.42309],[15.27758,45.46678],[15.33051,45.45258],[15.38188,45.48752],[15.30249,45.53224],[15.29837,45.5841],[15.27747,45.60504],[15.31027,45.6303],[15.34695,45.63382],[15.34214,45.64702],[15.38952,45.63682],[15.4057,45.64727],[15.34919,45.71623],[15.30872,45.69014],[15.25423,45.72275],[15.40836,45.79491],[15.47531,45.79802],[15.47325,45.8253],[15.52234,45.82195],[15.57952,45.84953],[15.64185,45.82915],[15.66662,45.84085],[15.70411,45.8465],[15.68232,45.86819],[15.68383,45.88867],[15.67967,45.90455],[15.70636,45.92116],[15.70327,46.00015],[15.71246,46.01196],[15.72977,46.04682],[15.62317,46.09103],[15.6083,46.11992],[15.59909,46.14761],[15.64904,46.19229],[15.6434,46.21396],[15.67395,46.22478],[15.75436,46.21969],[15.75479,46.20336],[15.78817,46.21719],[15.79284,46.25811],[15.97965,46.30652],[16.07616,46.3463],[16.07314,46.36458],[16.05065,46.3833],[16.05281,46.39141],[16.14859,46.40547],[16.18824,46.38282],[16.30233,46.37837],[16.30162,46.40437],[16.27329,46.41467],[16.27398,46.42875],[16.25124,46.48067],[16.23961,46.49653],[16.26759,46.50566],[16.26733,46.51505],[16.29793,46.5121],[16.37193,46.55008],[16.38771,46.53608],[16.44036,46.5171],[16.5007,46.49644],[16.52604,46.47831],[16.59527,46.47524],[16.52604,46.5051],[16.52885,46.53303],[16.50139,46.56684]]]]}},{type:"Feature",properties:{iso1A2:"SJ",iso1A3:"SJM",iso1N3:"744",wikidata:"Q842829",nameEn:"Svalbard and Jan Mayen",country:"NO"},geometry:null},{type:"Feature",properties:{iso1A2:"SK",iso1A3:"SVK",iso1N3:"703",wikidata:"Q214",nameEn:"Slovakia",groups:["EU","151","150","UN"],callingCodes:["421"]},geometry:{type:"MultiPolygon",coordinates:[[[[19.82237,49.27806],[19.78581,49.41701],[19.72127,49.39288],[19.6375,49.40897],[19.64162,49.45184],[19.57845,49.46077],[19.53313,49.52856],[19.52626,49.57311],[19.45348,49.61583],[19.37795,49.574],[19.36009,49.53747],[19.25435,49.53391],[19.18019,49.41165],[18.9742,49.39557],[18.97283,49.49914],[18.94536,49.52143],[18.84521,49.51672],[18.74761,49.492],[18.67757,49.50895],[18.6144,49.49824],[18.57183,49.51162],[18.53063,49.49022],[18.54848,49.47059],[18.44686,49.39467],[18.4084,49.40003],[18.4139,49.36517],[18.36446,49.3267],[18.18456,49.28909],[18.15022,49.24518],[18.1104,49.08624],[18.06885,49.03157],[17.91814,49.01784],[17.87831,48.92679],[17.77944,48.92318],[17.73126,48.87885],[17.7094,48.86721],[17.5295,48.81117],[17.45671,48.85004],[17.3853,48.80936],[17.29054,48.85546],[17.19355,48.87602],[17.11202,48.82925],[17.00215,48.70887],[16.93955,48.60371],[16.94611,48.53614],[16.85204,48.44968],[16.8497,48.38321],[16.83588,48.3844],[16.83317,48.38138],[16.84243,48.35258],[16.90903,48.32519],[16.89461,48.31332],[16.97701,48.17385],[17.02919,48.13996],[17.05735,48.14179],[17.09168,48.09366],[17.07039,48.0317],[17.16001,48.00636],[17.23699,48.02094],[17.71215,47.7548],[18.02938,47.75665],[18.29305,47.73541],[18.56496,47.76588],[18.66521,47.76772],[18.74074,47.8157],[18.8506,47.82308],[18.76821,47.87469],[18.76134,47.97499],[18.82176,48.04206],[19.01952,48.07052],[19.23924,48.0595],[19.28182,48.08336],[19.47957,48.09437],[19.52489,48.19791],[19.63338,48.25006],[19.92452,48.1283],[20.24312,48.2784],[20.29943,48.26104],[20.5215,48.53336],[20.83248,48.5824],[21.11516,48.49546],[21.44063,48.58456],[21.6068,48.50365],[21.67134,48.3989],[21.72525,48.34628],[21.8279,48.33321],[21.83339,48.36242],[22.14689,48.4005],[22.16023,48.56548],[22.21379,48.6218],[22.34151,48.68893],[22.42934,48.92857],[22.48296,48.99172],[22.54338,49.01424],[22.56155,49.08865],[22.04427,49.22136],[21.96385,49.3437],[21.82927,49.39467],[21.77983,49.35443],[21.62328,49.4447],[21.43376,49.41433],[21.27858,49.45988],[21.19756,49.4054],[21.12477,49.43666],[21.041,49.41791],[21.09799,49.37176],[20.98733,49.30774],[20.9229,49.29626],[20.77971,49.35383],[20.72274,49.41813],[20.61666,49.41791],[20.5631,49.375],[20.46422,49.41612],[20.39939,49.3896],[20.31728,49.39914],[20.31453,49.34817],[20.21977,49.35265],[20.13738,49.31685],[20.08238,49.1813],[19.98494,49.22904],[19.90529,49.23532],[19.86409,49.19316],[19.75286,49.20751],[19.82237,49.27806]]]]}},{type:"Feature",properties:{iso1A2:"SL",iso1A3:"SLE",iso1N3:"694",wikidata:"Q1044",nameEn:"Sierra Leone",groups:["011","202","002","UN"],callingCodes:["232"]},geometry:{type:"MultiPolygon",coordinates:[[[[-10.27575,8.48711],[-10.37257,8.48941],[-10.54891,8.31174],[-10.63934,8.35326],[-10.70565,8.29235],[-10.61422,8.5314],[-10.47707,8.67669],[-10.56197,8.81225],[-10.5783,9.06386],[-10.74484,9.07998],[-10.6534,9.29919],[-11.2118,10.00098],[-11.89624,9.99763],[-11.91023,9.93927],[-12.12634,9.87203],[-12.24262,9.92386],[-12.47254,9.86834],[-12.76788,9.3133],[-12.94095,9.26335],[-13.08953,9.0409],[-13.18586,9.0925],[-13.29911,9.04245],[-14.36218,8.64107],[-12.15048,6.15992],[-11.50429,6.92704],[-11.4027,6.97746],[-11.29417,7.21576],[-10.60422,7.7739],[-10.60492,8.04072],[-10.57523,8.04829],[-10.51554,8.1393],[-10.45023,8.15627],[-10.35227,8.15223],[-10.29839,8.21283],[-10.31635,8.28554],[-10.30084,8.30008],[-10.27575,8.48711]]]]}},{type:"Feature",properties:{iso1A2:"SM",iso1A3:"SMR",iso1N3:"674",wikidata:"Q238",nameEn:"San Marino",groups:["039","150","UN"],callingCodes:["378"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.45648,43.89369],[12.48771,43.89706],[12.49429,43.90973],[12.49247,43.91774],[12.49724,43.92248],[12.50269,43.92363],[12.50496,43.93017],[12.51553,43.94096],[12.51427,43.94897],[12.50655,43.95796],[12.50875,43.96198],[12.50622,43.97131],[12.51109,43.97201],[12.51064,43.98165],[12.5154,43.98508],[12.51463,43.99122],[12.50678,43.99113],[12.49406,43.98492],[12.47853,43.98052],[12.46205,43.97463],[12.44684,43.96597],[12.43662,43.95698],[12.42005,43.9578],[12.41414,43.95273],[12.40415,43.95485],[12.40506,43.94325],[12.41165,43.93769],[12.41551,43.92984],[12.40733,43.92379],[12.41233,43.90956],[12.40935,43.9024],[12.41641,43.89991],[12.44184,43.90498],[12.45648,43.89369]]]]}},{type:"Feature",properties:{iso1A2:"SN",iso1A3:"SEN",iso1N3:"686",wikidata:"Q1041",nameEn:"Senegal",groups:["011","202","002","UN"],callingCodes:["221"]},geometry:{type:"MultiPolygon",coordinates:[[[[-14.32144,16.61495],[-15.00557,16.64997],[-15.6509,16.50315],[-16.27016,16.51565],[-16.4429,16.20605],[-16.44814,16.09753],[-16.48967,16.0496],[-16.50854,16.09032],[-17.15288,16.07139],[-18.35085,14.63444],[-17.43598,13.59273],[-15.47902,13.58758],[-15.36504,13.79313],[-14.93719,13.80173],[-14.34721,13.46578],[-13.8955,13.59126],[-13.79409,13.34472],[-14.36795,13.23033],[-15.14917,13.57989],[-15.26908,13.37768],[-15.80478,13.34832],[-15.80355,13.16729],[-16.69343,13.16791],[-16.74676,13.06025],[-17.43966,13.04579],[-17.4623,11.92379],[-16.70562,12.34803],[-16.38191,12.36449],[-16.20591,12.46157],[-15.67302,12.42974],[-15.17582,12.6847],[-13.70523,12.68013],[-13.05296,12.64003],[-13.06603,12.49342],[-12.87336,12.51892],[-12.35415,12.32758],[-11.91331,12.42008],[-11.46267,12.44559],[-11.37536,12.40788],[-11.39935,12.97808],[-11.63025,13.39174],[-11.83345,13.33333],[-12.06897,13.71049],[-11.93043,13.84505],[-12.23936,14.76324],[-13.11029,15.52116],[-13.43135,16.09022],[-13.80075,16.13961],[-14.32144,16.61495]]]]}},{type:"Feature",properties:{iso1A2:"SO",iso1A3:"SOM",iso1N3:"706",wikidata:"Q1045",nameEn:"Somalia",groups:["014","202","002","UN"],callingCodes:["252"]},geometry:{type:"MultiPolygon",coordinates:[[[[51.12877,12.56479],[43.90659,12.3823],[42.95776,10.98533],[42.69452,10.62672],[42.87643,10.18441],[43.0937,9.90579],[43.23518,9.84605],[43.32613,9.59205],[44.19222,8.93028],[46.99339,7.9989],[47.92477,8.00111],[47.97917,8.00124],[44.98104,4.91821],[44.02436,4.9451],[43.40263,4.79289],[43.04177,4.57923],[42.97746,4.44032],[42.84526,4.28357],[42.55853,4.20518],[42.07619,4.17667],[41.89488,3.97375],[41.31368,3.14314],[40.98767,2.82959],[41.00099,-.83068],[41.56,-1.59812],[41.56362,-1.66375],[41.75542,-1.85308],[57.49095,8.14549],[51.12877,12.56479]]]]}},{type:"Feature",properties:{iso1A2:"SR",iso1A3:"SUR",iso1N3:"740",wikidata:"Q730",nameEn:"Suriname",groups:["005","419","019","UN"],driveSide:"left",callingCodes:["597"]},geometry:{type:"MultiPolygon",coordinates:[[[[-54.26916,5.26909],[-54.01877,5.52789],[-54.01074,5.68785],[-53.7094,6.2264],[-56.84822,6.73257],[-57.31629,5.33714],[-57.22536,5.15605],[-57.37442,5.0208],[-57.8699,4.89394],[-58.0307,3.95513],[-57.35891,3.32121],[-56.70519,2.02964],[-56.55439,2.02003],[-56.47045,1.95135],[-55.99278,1.83137],[-55.89863,1.89861],[-55.92159,2.05236],[-56.13054,2.27723],[-55.96292,2.53188],[-55.71493,2.40342],[-55.01919,2.564],[-54.6084,2.32856],[-54.42864,2.42442],[-54.28534,2.67798],[-53.9849,3.58697],[-53.98914,3.627],[-54.05128,3.63557],[-54.19367,3.84387],[-54.38444,4.13222],[-54.4717,4.91964],[-54.26916,5.26909]]]]}},{type:"Feature",properties:{iso1A2:"SS",iso1A3:"SSD",iso1N3:"728",wikidata:"Q958",nameEn:"South Sudan",groups:["014","202","002","UN"],callingCodes:["211"]},geometry:{type:"MultiPolygon",coordinates:[[[[34.10229,9.50238],[33.87958,9.49937],[33.9082,9.762],[33.96323,9.80972],[33.99185,9.99623],[33.96984,10.15446],[33.90159,10.17179],[33.80913,10.32994],[33.66604,10.44254],[33.52294,10.64382],[33.24645,10.77913],[33.26977,10.83632],[33.13988,11.43248],[33.25876,12.22111],[32.73921,12.22757],[32.73921,11.95203],[32.10079,11.95203],[32.39578,11.70208],[32.39358,11.18207],[32.46967,11.04662],[31.99177,10.65065],[31.77539,10.28939],[31.28504,9.75287],[30.84605,9.7498],[30.82893,9.71451],[30.53005,9.95992],[30.00389,10.28633],[29.94629,10.29245],[29.54,10.07949],[29.53844,9.75133],[29.06988,9.74826],[28.99983,9.67155],[27.90704,9.61323],[27.14427,9.62858],[26.70685,9.48735],[26.35815,9.57946],[26.21338,9.91545],[25.93241,10.17941],[25.93163,10.38159],[25.78141,10.42599],[25.0918,10.33718],[25.05688,10.06776],[24.97739,9.9081],[24.84653,9.80643],[24.49389,9.79962],[24.12744,9.73784],[24.09319,9.66572],[23.69155,9.67566],[23.62179,9.53823],[23.64981,9.44303],[23.64358,9.28637],[23.56263,9.19418],[23.4848,9.16959],[23.44744,8.99128],[23.59065,8.99743],[23.51905,8.71749],[24.25691,8.69288],[24.13238,8.36959],[24.35965,8.26177],[24.85156,8.16933],[24.98855,7.96588],[25.25319,7.8487],[25.29214,7.66675],[25.20649,7.61115],[25.20337,7.50312],[25.35281,7.42595],[25.37461,7.33024],[25.90076,7.09549],[26.38022,6.63493],[26.32729,6.36272],[26.58259,6.1987],[26.51721,6.09655],[27.22705,5.71254],[27.22705,5.62889],[27.28621,5.56382],[27.23017,5.37167],[27.26886,5.25876],[27.44012,5.07349],[27.56656,4.89375],[27.65462,4.89375],[27.76469,4.79284],[27.79551,4.59976],[28.20719,4.35614],[28.6651,4.42638],[28.8126,4.48784],[29.03054,4.48784],[29.22207,4.34297],[29.43341,4.50101],[29.49726,4.7007],[29.82087,4.56246],[29.79666,4.37809],[30.06964,4.13221],[30.1621,4.10586],[30.22374,3.93896],[30.27658,3.95653],[30.47691,3.83353],[30.55396,3.84451],[30.57378,3.74567],[30.56277,3.62703],[30.78512,3.67097],[30.80713,3.60506],[30.85997,3.5743],[30.85153,3.48867],[30.97601,3.693],[31.16666,3.79853],[31.29476,3.8015],[31.50478,3.67814],[31.50776,3.63652],[31.72075,3.74354],[31.81459,3.82083],[31.86821,3.78664],[31.96205,3.6499],[31.95907,3.57408],[32.05187,3.589],[32.08491,3.56287],[32.08866,3.53543],[32.19888,3.50867],[32.20782,3.6053],[32.41337,3.748],[32.72021,3.77327],[32.89746,3.81339],[33.02852,3.89296],[33.18356,3.77812],[33.51264,3.75068],[33.9873,4.23316],[34.47601,4.72162],[35.34151,5.02364],[35.30992,4.90402],[35.47843,4.91872],[35.42366,4.76969],[35.51424,4.61643],[35.9419,4.61933],[35.82118,4.77382],[35.81968,5.10757],[35.8576,5.33413],[35.50792,5.42431],[35.29938,5.34042],[35.31188,5.50106],[35.13058,5.62118],[35.12611,5.68937],[35.00546,5.89387],[34.96227,6.26415],[35.01738,6.46991],[34.87736,6.60161],[34.77459,6.5957],[34.65096,6.72589],[34.53776,6.74808],[34.53925,6.82794],[34.47669,6.91076],[34.35753,6.91963],[34.19369,7.04382],[34.19369,7.12807],[34.01495,7.25664],[34.03878,7.27437],[34.02984,7.36449],[33.87642,7.5491],[33.71407,7.65983],[33.44745,7.7543],[33.32531,7.71297],[33.24637,7.77939],[33.04944,7.78989],[33.0006,7.90333],[33.08401,8.05822],[33.18083,8.13047],[33.1853,8.29264],[33.19721,8.40317],[33.3119,8.45474],[33.54575,8.47094],[33.66938,8.44442],[33.71407,8.3678],[33.87195,8.41938],[33.89579,8.4842],[34.01346,8.50041],[34.14453,8.60204],[34.14304,9.04654],[34.10229,9.50238]]]]}},{type:"Feature",properties:{iso1A2:"ST",iso1A3:"STP",iso1N3:"678",wikidata:"Q1039",nameEn:"S\xE3o Tom\xE9 and Principe",groups:["017","202","002","UN"],callingCodes:["239"]},geometry:{type:"MultiPolygon",coordinates:[[[[4.34149,1.91417],[6.6507,-.28606],[7.9035,1.92304],[4.34149,1.91417]]]]}},{type:"Feature",properties:{iso1A2:"SV",iso1A3:"SLV",iso1N3:"222",wikidata:"Q792",nameEn:"El Salvador",groups:["013","003","419","019","UN"],callingCodes:["503"]},geometry:{type:"MultiPolygon",coordinates:[[[[-89.34776,14.43013],[-89.39028,14.44561],[-89.57441,14.41637],[-89.58814,14.33165],[-89.50614,14.26084],[-89.52397,14.22628],[-89.61844,14.21937],[-89.70756,14.1537],[-89.75569,14.07073],[-89.73251,14.04133],[-89.76103,14.02923],[-89.81807,14.07073],[-89.88937,14.0396],[-90.10505,13.85104],[-90.11344,13.73679],[-90.55276,12.8866],[-88.11443,12.63306],[-87.7346,13.13228],[-87.55124,13.12523],[-87.69751,13.25228],[-87.73714,13.32715],[-87.80177,13.35689],[-87.84675,13.41078],[-87.83467,13.44655],[-87.77354,13.45767],[-87.73841,13.44169],[-87.72115,13.46083],[-87.71657,13.50577],[-87.78148,13.52906],[-87.73106,13.75443],[-87.68821,13.80829],[-87.7966,13.91353],[-88.00331,13.86948],[-88.07641,13.98447],[-88.23018,13.99915],[-88.25791,13.91108],[-88.48982,13.86458],[-88.49738,13.97224],[-88.70661,14.04317],[-88.73182,14.10919],[-88.815,14.11652],[-88.85785,14.17763],[-88.94608,14.20207],[-89.04187,14.33644],[-89.34776,14.43013]]]]}},{type:"Feature",properties:{iso1A2:"SX",iso1A3:"SXM",iso1N3:"534",wikidata:"Q26273",nameEn:"Sint Maarten",aliases:["NL-SX"],country:"NL",groups:["Q1451600","029","003","419","019","UN"],callingCodes:["1 721"]},geometry:{type:"MultiPolygon",coordinates:[[[[-63.33064,17.9615],[-63.1055,17.86651],[-62.93924,18.02904],[-63.02323,18.05757],[-63.04039,18.05619],[-63.0579,18.06614],[-63.07759,18.04943],[-63.09686,18.04608],[-63.11042,18.05339],[-63.13502,18.05445],[-63.33064,17.9615]]]]}},{type:"Feature",properties:{iso1A2:"SY",iso1A3:"SYR",iso1N3:"760",wikidata:"Q858",nameEn:"Syria",groups:["145","142","UN"],callingCodes:["963"]},geometry:{type:"MultiPolygon",coordinates:[[[[42.23683,37.2863],[42.21548,37.28026],[42.20454,37.28715],[42.22381,37.30238],[42.22257,37.31395],[42.2112,37.32491],[42.19301,37.31323],[42.18225,37.28569],[42.00894,37.17209],[41.515,37.08084],[41.21937,37.07665],[40.90856,37.13147],[40.69136,37.0996],[39.81589,36.75538],[39.21538,36.66834],[39.03217,36.70911],[38.74042,36.70629],[38.55908,36.84429],[38.38859,36.90064],[38.21064,36.91842],[37.81974,36.76055],[37.68048,36.75065],[37.49103,36.66904],[37.47253,36.63243],[37.21988,36.6736],[37.16177,36.66069],[37.10894,36.6704],[37.08279,36.63495],[37.02088,36.66422],[37.01647,36.69512],[37.04619,36.71101],[37.04399,36.73483],[36.99886,36.74012],[36.99557,36.75997],[36.66727,36.82901],[36.61581,36.74629],[36.62681,36.71189],[36.57398,36.65186],[36.58829,36.58295],[36.54206,36.49539],[36.6081,36.33772],[36.65653,36.33861],[36.68672,36.23677],[36.6125,36.22592],[36.50463,36.2419],[36.4617,36.20461],[36.39206,36.22088],[36.37474,36.01163],[36.33956,35.98687],[36.30099,36.00985],[36.28338,36.00273],[36.29769,35.96086],[36.27678,35.94839],[36.25366,35.96264],[36.19973,35.95195],[36.17441,35.92076],[36.1623,35.80925],[36.14029,35.81015],[36.13919,35.83692],[36.11827,35.85923],[35.99829,35.88242],[36.01844,35.92403],[36.00514,35.94113],[35.98499,35.94107],[35.931,35.92109],[35.51152,36.10954],[35.48515,34.70851],[35.97386,34.63322],[35.98718,34.64977],[36.29165,34.62991],[36.32399,34.69334],[36.35135,34.68516],[36.35384,34.65447],[36.42941,34.62505],[36.46003,34.6378],[36.45299,34.59438],[36.41429,34.61175],[36.39846,34.55672],[36.3369,34.52629],[36.34745,34.5002],[36.4442,34.50165],[36.46179,34.46541],[36.55853,34.41609],[36.53039,34.3798],[36.56556,34.31881],[36.60778,34.31009],[36.58667,34.27667],[36.59195,34.2316],[36.62537,34.20251],[36.5128,34.09916],[36.50576,34.05982],[36.41078,34.05253],[36.28589,33.91981],[36.38263,33.86579],[36.3967,33.83365],[36.14517,33.85118],[36.06778,33.82927],[35.9341,33.6596],[36.05723,33.57904],[35.94465,33.52774],[35.94816,33.47886],[35.88668,33.43183],[35.82577,33.40479],[35.81324,33.36354],[35.77477,33.33609],[35.813,33.3172],[35.77513,33.27342],[35.81295,33.24841],[35.81647,33.2028],[35.83846,33.19397],[35.84285,33.16673],[35.81911,33.1336],[35.81911,33.11077],[35.84802,33.1031],[35.87188,32.98028],[35.89298,32.9456],[35.87012,32.91976],[35.84021,32.8725],[35.83758,32.82817],[35.78745,32.77938],[35.75983,32.74803],[35.88405,32.71321],[35.93307,32.71966],[35.96633,32.66237],[36.02239,32.65911],[36.08074,32.51463],[36.20379,32.52751],[36.20875,32.49529],[36.23948,32.50108],[36.40959,32.37908],[36.83946,32.31293],[38.79171,33.37328],[40.64314,34.31604],[40.97676,34.39788],[41.12388,34.65742],[41.2345,34.80049],[41.21654,35.1508],[41.26569,35.42708],[41.38184,35.62502],[41.37027,35.84095],[41.2564,36.06012],[41.28864,36.35368],[41.40058,36.52502],[41.81736,36.58782],[42.36697,37.0627],[42.35724,37.10998],[42.32313,37.17814],[42.34735,37.22548],[42.2824,37.2798],[42.26039,37.27017],[42.23683,37.2863]]]]}},{type:"Feature",properties:{iso1A2:"SZ",iso1A3:"SWZ",iso1N3:"748",wikidata:"Q1050",nameEn:"Eswatini",aliases:["Swaziland"],groups:["018","202","002","UN"],driveSide:"left",callingCodes:["268"]},geometry:{type:"MultiPolygon",coordinates:[[[[31.86881,-25.99973],[31.4175,-25.71886],[31.31237,-25.7431],[31.13073,-25.91558],[30.95819,-26.26303],[30.78927,-26.48271],[30.81101,-26.84722],[30.88826,-26.79622],[30.97757,-26.92706],[30.96088,-27.0245],[31.15027,-27.20151],[31.49834,-27.31549],[31.97592,-27.31675],[31.97463,-27.11057],[32.00893,-26.8096],[32.09664,-26.80721],[32.13315,-26.84345],[32.13409,-26.5317],[32.07352,-26.40185],[32.10435,-26.15656],[32.08599,-26.00978],[32.00916,-25.999],[31.974,-25.95387],[31.86881,-25.99973]]]]}},{type:"Feature",properties:{iso1A2:"TA",iso1A3:"TAA",wikidata:"Q220982",nameEn:"Tristan da Cunha",aliases:["SH-TA"],country:"GB",groups:["SH","BOTS","011","202","002","UN"],isoStatus:"excRes",driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["290 8","44 20"]},geometry:{type:"MultiPolygon",coordinates:[[[[-13.38232,-34.07258],[-16.67337,-41.9188],[-5.88482,-41.4829],[-13.38232,-34.07258]]]]}},{type:"Feature",properties:{iso1A2:"TC",iso1A3:"TCA",iso1N3:"796",wikidata:"Q18221",nameEn:"Turks and Caicos Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 649"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.70065,25.7637],[-72.98446,20.4801],[-69.80718,21.35956],[-71.70065,25.7637]]]]}},{type:"Feature",properties:{iso1A2:"TD",iso1A3:"TCD",iso1N3:"148",wikidata:"Q657",nameEn:"Chad",groups:["017","202","002","UN"],callingCodes:["235"]},geometry:{type:"MultiPolygon",coordinates:[[[[23.99539,19.49944],[15.99566,23.49639],[14.99751,23.00539],[15.19692,21.99339],[15.20213,21.49365],[15.28332,21.44557],[15.62515,20.95395],[15.57248,20.92138],[15.55382,20.86507],[15.56004,20.79488],[15.59841,20.74039],[15.6721,20.70069],[15.99632,20.35364],[15.75098,19.93002],[15.6032,18.77402],[15.50373,16.89649],[14.37425,15.72591],[13.86301,15.04043],[13.78991,14.87519],[13.809,14.72915],[13.67878,14.64013],[13.68573,14.55276],[13.48259,14.46704],[13.47559,14.40881],[13.6302,13.71094],[14.08251,13.0797],[14.46881,13.08259],[14.56101,12.91036],[14.55058,12.78256],[14.83314,12.62963],[14.90827,12.3269],[14.89019,12.16593],[14.96952,12.0925],[15.00146,12.1223],[15.0349,12.10698],[15.05786,12.0608],[15.04808,11.8731],[15.11579,11.79313],[15.06595,11.71126],[15.13149,11.5537],[15.0585,11.40481],[15.10021,11.04101],[15.04957,11.02347],[15.09127,10.87431],[15.06737,10.80921],[15.15532,10.62846],[15.14936,10.53915],[15.23724,10.47764],[15.30874,10.31063],[15.50535,10.1098],[15.68761,9.99344],[15.41408,9.92876],[15.24618,9.99246],[15.14043,9.99246],[15.05999,9.94845],[14.95722,9.97926],[14.80082,9.93818],[14.4673,10.00264],[14.20411,10.00055],[14.1317,9.82413],[14.01793,9.73169],[13.97544,9.6365],[14.37094,9.2954],[14.35707,9.19611],[14.83566,8.80557],[15.09484,8.65982],[15.20426,8.50892],[15.50743,7.79302],[15.59272,7.7696],[15.56964,7.58936],[15.49743,7.52179],[15.73118,7.52006],[15.79942,7.44149],[16.40703,7.68809],[16.41583,7.77971],[16.58315,7.88657],[16.59415,7.76444],[16.658,7.75353],[16.6668,7.67281],[16.8143,7.53971],[17.67288,7.98905],[17.93926,7.95853],[18.02731,8.01085],[18.6085,8.05009],[18.64153,8.08714],[18.62612,8.14163],[18.67455,8.22226],[18.79783,8.25929],[19.11044,8.68172],[18.86388,8.87971],[19.06421,9.00367],[20.36748,9.11019],[20.82979,9.44696],[21.26348,9.97642],[21.34934,9.95907],[21.52766,10.2105],[21.63553,10.217],[21.71479,10.29932],[21.72139,10.64136],[22.45889,11.00246],[22.87758,10.91915],[22.97249,11.21955],[22.93124,11.41645],[22.7997,11.40424],[22.54907,11.64372],[22.64092,12.07485],[22.48369,12.02766],[22.50548,12.16769],[22.38873,12.45514],[22.46345,12.61925],[22.22684,12.74682],[22.15679,12.66634],[21.98711,12.63292],[21.89371,12.68001],[21.81432,12.81362],[21.94819,13.05637],[22.02914,13.13976],[22.1599,13.19281],[22.29689,13.3731],[22.08674,13.77863],[22.22995,13.96754],[22.5553,14.11704],[22.55997,14.23024],[22.44944,14.24986],[22.38562,14.58907],[22.70474,14.69149],[22.66115,14.86308],[22.99584,15.22989],[22.99584,15.40105],[22.92579,15.47007],[22.93201,15.55107],[23.10792,15.71297],[23.38812,15.69649],[23.62785,15.7804],[23.99997,15.69575],[23.99539,19.49944]]]]}},{type:"Feature",properties:{iso1A2:"TF",iso1A3:"ATF",iso1N3:"260",wikidata:"Q129003",nameEn:"French Southern Territories",country:"FR",groups:["EU","UN"]},geometry:null},{type:"Feature",properties:{iso1A2:"TG",iso1A3:"TGO",iso1N3:"768",wikidata:"Q945",nameEn:"Togo",groups:["011","202","002","UN"],callingCodes:["228"]},geometry:{type:"MultiPolygon",coordinates:[[[[.50388,11.01011],[-.13493,11.14075],[-.14462,11.10811],[-.05733,11.08628],[-.0275,11.11202],[-.00514,11.10763],[.00342,11.08317],[.02395,11.06229],[.03355,10.9807],[-.0063,10.96417],[-.00908,10.91644],[-.02685,10.8783],[-.0228,10.81916],[-.07183,10.76794],[-.07327,10.71845],[-.09141,10.7147],[-.05945,10.63458],[.12886,10.53149],[.18846,10.4096],[.29453,10.41546],[.33028,10.30408],[.39584,10.31112],[.35293,10.09412],[.41371,10.06361],[.41252,10.02018],[.36366,10.03309],[.32075,9.72781],[.34816,9.71607],[.34816,9.66907],[.32313,9.6491],[.28261,9.69022],[.26712,9.66437],[.29334,9.59387],[.36008,9.6256],[.38153,9.58682],[.23851,9.57389],[.2409,9.52335],[.30406,9.521],[.31241,9.50337],[.2254,9.47869],[.25758,9.42696],[.33148,9.44812],[.36485,9.49749],[.49118,9.48339],[.56388,9.40697],[.45424,9.04581],[.52455,8.87746],[.37319,8.75262],[.47211,8.59945],[.64731,8.48866],[.73432,8.29529],[.63897,8.25873],[.5913,8.19622],[.61156,8.18324],[.6056,8.13959],[.58891,8.12779],[.62943,7.85751],[.58295,7.62368],[.51979,7.58706],[.52455,7.45354],[.57223,7.39326],[.62943,7.41099],[.65327,7.31643],[.59606,7.01252],[.52217,6.9723],[.52098,6.94391],[.56508,6.92971],[.52853,6.82921],[.57406,6.80348],[.58176,6.76049],[.6497,6.73682],[.63659,6.63857],[.74862,6.56517],[.71048,6.53083],[.89283,6.33779],[.99652,6.33779],[1.03108,6.24064],[1.05969,6.22998],[1.09187,6.17074],[1.19966,6.17069],[1.19771,6.11522],[1.27574,5.93551],[1.67336,6.02702],[1.62913,6.24075],[1.79826,6.28221],[1.76906,6.43189],[1.58105,6.68619],[1.61812,6.74843],[1.55877,6.99737],[1.64249,6.99562],[1.61838,9.0527],[1.5649,9.16941],[1.41746,9.3226],[1.33675,9.54765],[1.36624,9.5951],[1.35507,9.99525],[.77666,10.37665],[.80358,10.71459],[.8804,10.803],[.91245,10.99597],[.66104,10.99964],[.4958,10.93269],[.50521,10.98035],[.48852,10.98561],[.50388,11.01011]]]]}},{type:"Feature",properties:{iso1A2:"TH",iso1A3:"THA",iso1N3:"764",wikidata:"Q869",nameEn:"Thailand",groups:["035","142","UN"],driveSide:"left",callingCodes:["66"]},geometry:{type:"MultiPolygon",coordinates:[[[[100.08404,20.36626],[99.95721,20.46301],[99.91616,20.44986],[99.90499,20.4487],[99.89692,20.44789],[99.89301,20.44311],[99.89168,20.44548],[99.88451,20.44596],[99.88211,20.44488],[99.86383,20.44371],[99.81096,20.33687],[99.68255,20.32077],[99.46008,20.39673],[99.46077,20.36198],[99.5569,20.20676],[99.52943,20.14811],[99.416,20.08614],[99.20328,20.12877],[99.0735,20.10298],[98.98679,19.7419],[98.83661,19.80931],[98.56065,19.67807],[98.51182,19.71303],[98.24884,19.67876],[98.13829,19.78541],[98.03314,19.80941],[98.04364,19.65755],[97.84715,19.55782],[97.88423,19.5041],[97.78769,19.39429],[97.84186,19.29526],[97.78606,19.26769],[97.84024,19.22217],[97.83479,19.09972],[97.73797,19.04261],[97.73654,18.9812],[97.66487,18.9371],[97.73836,18.88478],[97.76752,18.58097],[97.5258,18.4939],[97.36444,18.57138],[97.34522,18.54596],[97.50383,18.26844],[97.56219,18.33885],[97.64116,18.29778],[97.60841,18.23846],[97.73723,17.97912],[97.66794,17.88005],[97.76407,17.71595],[97.91829,17.54504],[98.11185,17.36829],[98.10439,17.33847],[98.34566,17.04822],[98.39441,17.06266],[98.52624,16.89979],[98.49603,16.8446],[98.53833,16.81934],[98.46994,16.73613],[98.50253,16.7139],[98.49713,16.69022],[98.51043,16.70107],[98.51579,16.69433],[98.51472,16.68521],[98.51833,16.676],[98.51113,16.64503],[98.5695,16.62826],[98.57912,16.55983],[98.63817,16.47424],[98.68074,16.27068],[98.84485,16.42354],[98.92656,16.36425],[98.8376,16.11706],[98.69585,16.13353],[98.57019,16.04578],[98.59853,15.87197],[98.541,15.65406],[98.58598,15.46821],[98.56027,15.33471],[98.4866,15.39154],[98.39351,15.34177],[98.41906,15.27103],[98.40522,15.25268],[98.30446,15.30667],[98.22,15.21327],[98.18821,15.13125],[98.24874,14.83013],[98.56762,14.37701],[98.97356,14.04868],[99.16695,13.72621],[99.20617,13.20575],[99.12225,13.19847],[99.10646,13.05804],[99.18748,12.9898],[99.18905,12.84799],[99.29254,12.68921],[99.409,12.60603],[99.47519,12.1353],[99.56445,12.14805],[99.53424,12.02317],[99.64891,11.82699],[99.64108,11.78948],[99.5672,11.62732],[99.47598,11.62434],[99.39485,11.3925],[99.31573,11.32081],[99.32756,11.28545],[99.06938,10.94857],[99.02337,10.97217],[98.99701,10.92962],[99.0069,10.85485],[98.86819,10.78336],[98.78511,10.68351],[98.77275,10.62548],[98.81944,10.52761],[98.7391,10.31488],[98.55174,9.92804],[98.52291,9.92389],[98.47298,9.95782],[98.33094,9.91973],[98.12555,9.44056],[97.63455,9.60854],[97.19814,8.18901],[99.31854,5.99868],[99.50117,6.44501],[99.91873,6.50233],[100.0756,6.4045],[100.12,6.42105],[100.19511,6.72559],[100.29651,6.68439],[100.30828,6.66462],[100.31618,6.66781],[100.31884,6.66423],[100.32671,6.66526],[100.32607,6.65933],[100.31929,6.65413],[100.35413,6.54932],[100.41152,6.52299],[100.41791,6.5189],[100.42351,6.51762],[100.43027,6.52389],[100.66986,6.45086],[100.74361,6.50811],[100.74822,6.46231],[100.81045,6.45086],[100.85884,6.24929],[101.10313,6.25617],[101.12618,6.19431],[101.06165,6.14161],[101.12388,6.11411],[101.087,5.9193],[101.02708,5.91013],[100.98815,5.79464],[101.14062,5.61613],[101.25755,5.71065],[101.25524,5.78633],[101.58019,5.93534],[101.69773,5.75881],[101.75074,5.79091],[101.80144,5.74505],[101.89188,5.8386],[101.91776,5.84269],[101.92819,5.85511],[101.94712,5.98421],[101.9714,6.00575],[101.97114,6.01992],[101.99209,6.04075],[102.01835,6.05407],[102.09182,6.14161],[102.07732,6.193],[102.08127,6.22679],[102.09086,6.23546],[102.46318,7.22462],[102.47649,9.66162],[102.52395,11.25257],[102.91449,11.65512],[102.90973,11.75613],[102.83957,11.8519],[102.78427,11.98746],[102.77026,12.06815],[102.70176,12.1686],[102.73134,12.37091],[102.78116,12.40284],[102.7796,12.43781],[102.57567,12.65358],[102.51963,12.66117],[102.4994,12.71736],[102.53053,12.77506],[102.49335,12.92711],[102.48694,12.97537],[102.52275,12.99813],[102.46011,13.08057],[102.43422,13.09061],[102.36146,13.26006],[102.36001,13.31142],[102.34611,13.35618],[102.35692,13.38274],[102.35563,13.47307],[102.361,13.50551],[102.33828,13.55613],[102.36859,13.57488],[102.44601,13.5637],[102.5358,13.56933],[102.57573,13.60461],[102.62483,13.60883],[102.58635,13.6286],[102.5481,13.6589],[102.56848,13.69366],[102.72727,13.77806],[102.77864,13.93374],[102.91251,14.01531],[102.93275,14.19044],[103.16469,14.33075],[103.39353,14.35639],[103.53518,14.42575],[103.71109,14.4348],[103.70175,14.38052],[103.93836,14.3398],[104.27616,14.39861],[104.55014,14.36091],[104.69335,14.42726],[104.97667,14.38806],[105.02804,14.23722],[105.08408,14.20402],[105.14012,14.23873],[105.17748,14.34432],[105.20894,14.34967],[105.43783,14.43865],[105.53864,14.55731],[105.5121,14.80802],[105.61162,15.00037],[105.46661,15.13132],[105.58043,15.32724],[105.50662,15.32054],[105.4692,15.33709],[105.47635,15.3796],[105.58191,15.41031],[105.60446,15.53301],[105.61756,15.68792],[105.46573,15.74742],[105.42285,15.76971],[105.37959,15.84074],[105.34115,15.92737],[105.38508,15.987],[105.42001,16.00657],[105.06204,16.09792],[105.00262,16.25627],[104.88057,16.37311],[104.73349,16.565],[104.76099,16.69302],[104.7397,16.81005],[104.76442,16.84752],[104.7373,16.91125],[104.73712,17.01404],[104.80716,17.19025],[104.80061,17.39367],[104.69867,17.53038],[104.45404,17.66788],[104.35432,17.82871],[104.2757,17.86139],[104.21776,17.99335],[104.10927,18.10826],[104.06533,18.21656],[103.97725,18.33631],[103.93916,18.33914],[103.85642,18.28666],[103.82449,18.33979],[103.699,18.34125],[103.60957,18.40528],[103.47773,18.42841],[103.41044,18.4486],[103.30977,18.4341],[103.24779,18.37807],[103.23818,18.34875],[103.29757,18.30475],[103.17093,18.2618],[103.14994,18.23172],[103.1493,18.17799],[103.07343,18.12351],[103.07823,18.03833],[103.0566,18.00144],[103.01998,17.97095],[102.9912,17.9949],[102.95812,18.0054],[102.86323,17.97531],[102.81988,17.94233],[102.79044,17.93612],[102.75954,17.89561],[102.68538,17.86653],[102.67543,17.84529],[102.69946,17.81686],[102.68194,17.80151],[102.59485,17.83537],[102.5896,17.84889],[102.61432,17.92273],[102.60971,17.95411],[102.59234,17.96127],[102.45523,17.97106],[102.11359,18.21532],[101.88485,18.02474],[101.78087,18.07559],[101.72294,17.92867],[101.44667,17.7392],[101.15108,17.47586],[100.96541,17.57926],[101.02185,17.87637],[101.1793,18.0544],[101.19118,18.2125],[101.15108,18.25624],[101.18227,18.34367],[101.06047,18.43247],[101.27585,18.68875],[101.22832,18.73377],[101.25803,18.89545],[101.35606,19.04716],[101.261,19.12717],[101.24911,19.33334],[101.20604,19.35296],[101.21347,19.46223],[101.26991,19.48324],[101.26545,19.59242],[101.08928,19.59748],[100.90302,19.61901],[100.77231,19.48324],[100.64606,19.55884],[100.58219,19.49164],[100.49604,19.53504],[100.398,19.75047],[100.5094,19.87904],[100.58808,20.15791],[100.55218,20.17741],[100.51052,20.14928],[100.47567,20.19133],[100.4537,20.19971],[100.44992,20.23644],[100.41473,20.25625],[100.37439,20.35156],[100.33383,20.4028],[100.25769,20.3992],[100.22076,20.31598],[100.16668,20.2986],[100.1712,20.24324],[100.11785,20.24787],[100.09337,20.26293],[100.09999,20.31614],[100.08404,20.36626]]]]}},{type:"Feature",properties:{iso1A2:"TJ",iso1A3:"TJK",iso1N3:"762",wikidata:"Q863",nameEn:"Tajikistan",groups:["143","142","UN"],callingCodes:["992"]},geometry:{type:"MultiPolygon",coordinates:[[[[70.45251,41.04438],[70.38028,41.02014],[70.36655,40.90296],[69.69434,40.62615],[69.59441,40.70181],[69.53021,40.77621],[69.38327,40.7918],[69.32834,40.70233],[69.3455,40.57988],[69.2643,40.57506],[69.21063,40.54469],[69.27066,40.49274],[69.28525,40.41894],[69.30774,40.36102],[69.33794,40.34819],[69.32833,40.29794],[69.30808,40.2821],[69.24817,40.30357],[69.25229,40.26362],[69.30104,40.24502],[69.30448,40.18774],[69.2074,40.21488],[69.15659,40.2162],[69.04544,40.22904],[68.85832,40.20885],[68.84357,40.18604],[68.79276,40.17555],[68.77902,40.20492],[68.5332,40.14826],[68.52771,40.11676],[68.62796,40.07789],[69.01523,40.15771],[69.01935,40.11466],[68.96579,40.06949],[68.84906,40.04952],[68.93695,39.91167],[68.88889,39.87163],[68.63071,39.85265],[68.61972,39.68905],[68.54166,39.53929],[68.12053,39.56317],[67.70992,39.66156],[67.62889,39.60234],[67.44899,39.57799],[67.46547,39.53564],[67.39681,39.52505],[67.46822,39.46146],[67.45998,39.315],[67.36522,39.31287],[67.33226,39.23739],[67.67833,39.14479],[67.68915,39.00775],[68.09704,39.02589],[68.19743,38.85985],[68.06948,38.82115],[68.12877,38.73677],[68.05598,38.71641],[68.0807,38.64136],[68.05873,38.56087],[68.11366,38.47169],[68.06274,38.39435],[68.13289,38.40822],[68.40343,38.19484],[68.27159,37.91477],[68.12635,37.93],[67.81566,37.43107],[67.8474,37.31594],[67.78329,37.1834],[67.7803,37.08978],[67.87917,37.0591],[68.02194,36.91923],[68.18542,37.02074],[68.27605,37.00977],[68.29253,37.10621],[68.41201,37.10402],[68.41888,37.13906],[68.61851,37.19815],[68.6798,37.27906],[68.81438,37.23862],[68.80889,37.32494],[68.91189,37.26704],[68.88168,37.33368],[68.96407,37.32603],[69.03274,37.25174],[69.25152,37.09426],[69.39529,37.16752],[69.45022,37.23315],[69.36645,37.40462],[69.44954,37.4869],[69.51888,37.5844],[69.80041,37.5746],[69.84435,37.60616],[69.93362,37.61378],[69.95971,37.5659],[70.15015,37.52519],[70.28243,37.66706],[70.27694,37.81258],[70.1863,37.84296],[70.17206,37.93276],[70.4898,38.12546],[70.54673,38.24541],[70.60407,38.28046],[70.61526,38.34774],[70.64966,38.34999],[70.69189,38.37031],[70.6761,38.39144],[70.67438,38.40597],[70.69807,38.41861],[70.72485,38.4131],[70.75455,38.4252],[70.77132,38.45548],[70.78581,38.45502],[70.78702,38.45031],[70.79766,38.44944],[70.80521,38.44447],[70.81697,38.44507],[70.82538,38.45394],[70.84376,38.44688],[70.88719,38.46826],[70.92728,38.43021],[70.98693,38.48862],[71.03545,38.44779],[71.0556,38.40176],[71.09542,38.42517],[71.10592,38.42077],[71.10957,38.40671],[71.1451,38.40106],[71.21291,38.32797],[71.33114,38.30339],[71.33869,38.27335],[71.37803,38.25641],[71.36444,38.15358],[71.29878,38.04429],[71.28922,38.01272],[71.27622,37.99946],[71.27278,37.96496],[71.24969,37.93031],[71.2809,37.91995],[71.296,37.93403],[71.32871,37.88564],[71.51565,37.95349],[71.58843,37.92425],[71.59255,37.79956],[71.55752,37.78677],[71.54324,37.77104],[71.53053,37.76534],[71.55234,37.73209],[71.54186,37.69691],[71.51972,37.61945],[71.5065,37.60912],[71.49693,37.53527],[71.50616,37.50733],[71.5256,37.47971],[71.49612,37.4279],[71.47685,37.40281],[71.4862,37.33405],[71.49821,37.31975],[71.50674,37.31502],[71.48536,37.26017],[71.4824,37.24921],[71.48339,37.23937],[71.47386,37.2269],[71.4555,37.21418],[71.4494,37.18137],[71.44127,37.11856],[71.43097,37.05855],[71.45578,37.03094],[71.46923,36.99925],[71.48481,36.93218],[71.51502,36.89128],[71.57195,36.74943],[71.67083,36.67346],[71.83229,36.68084],[72.31676,36.98115],[72.54095,37.00007],[72.66381,37.02014],[72.79693,37.22222],[73.06884,37.31729],[73.29633,37.46495],[73.77197,37.4417],[73.76647,37.33913],[73.61129,37.27469],[73.64974,37.23643],[73.82552,37.22659],[73.8564,37.26158],[74.20308,37.34208],[74.23339,37.41116],[74.41055,37.3948],[74.56161,37.37734],[74.68383,37.3948],[74.8294,37.3435],[74.88887,37.23275],[75.12328,37.31839],[75.09719,37.37297],[75.15899,37.41443],[75.06011,37.52779],[74.94338,37.55501],[74.8912,37.67576],[75.00935,37.77486],[74.92416,37.83428],[74.9063,38.03033],[74.82665,38.07359],[74.80331,38.19889],[74.69894,38.22155],[74.69619,38.42947],[74.51217,38.47034],[74.17022,38.65504],[73.97933,38.52945],[73.79806,38.61106],[73.80656,38.66449],[73.7033,38.84782],[73.7445,38.93867],[73.82964,38.91517],[73.81728,39.04007],[73.75823,39.023],[73.60638,39.24534],[73.54572,39.27567],[73.55396,39.3543],[73.5004,39.38402],[73.59241,39.40843],[73.59831,39.46425],[73.45096,39.46677],[73.31912,39.38615],[73.18454,39.35536],[72.85934,39.35116],[72.62027,39.39696],[72.33173,39.33093],[72.23834,39.17248],[72.17242,39.2661],[72.09689,39.26823],[72.04059,39.36704],[71.90601,39.27674],[71.79202,39.27355],[71.7522,39.32031],[71.80164,39.40631],[71.76816,39.45456],[71.62688,39.44056],[71.5517,39.45722],[71.55856,39.57588],[71.49814,39.61397],[71.08752,39.50704],[71.06418,39.41586],[70.7854,39.38933],[70.64087,39.58792],[70.44757,39.60128],[70.2869,39.53141],[70.11111,39.58223],[69.87491,39.53882],[69.68677,39.59281],[69.3594,39.52516],[69.26938,39.8127],[69.35649,40.01994],[69.43134,39.98431],[69.43557,39.92877],[69.53615,39.93991],[69.5057,40.03277],[69.53855,40.0887],[69.53794,40.11833],[69.55555,40.12296],[69.57615,40.10524],[69.64704,40.12165],[69.67001,40.10639],[70.01283,40.23288],[70.58297,40.00891],[70.57384,39.99394],[70.47557,39.93216],[70.55033,39.96619],[70.58912,39.95211],[70.65946,39.9878],[70.65827,40.0981],[70.7928,40.12797],[70.80495,40.16813],[70.9818,40.22392],[70.8607,40.217],[70.62342,40.17396],[70.56394,40.26421],[70.57149,40.3442],[70.37511,40.38605],[70.32626,40.45174],[70.49871,40.52503],[70.80009,40.72825],[70.45251,41.04438]]],[[[70.68112,40.90612],[70.6158,40.97661],[70.56077,41.00642],[70.54223,40.98787],[70.57501,40.98941],[70.6721,40.90555],[70.68112,40.90612]]],[[[70.74189,39.86319],[70.53651,39.89155],[70.52631,39.86989],[70.54998,39.85137],[70.59667,39.83542],[70.63105,39.77923],[70.74189,39.86319]]]]}},{type:"Feature",properties:{iso1A2:"TK",iso1A3:"TKL",iso1N3:"772",wikidata:"Q36823",nameEn:"Tokelau",country:"NZ",groups:["061","009","UN"],driveSide:"left",callingCodes:["690"]},geometry:{type:"MultiPolygon",coordinates:[[[[-168.251,-9.44289],[-174.18635,-7.80441],[-174.17993,-10.13616],[-168.251,-9.44289]]]]}},{type:"Feature",properties:{iso1A2:"TL",iso1A3:"TLS",iso1N3:"626",wikidata:"Q574",nameEn:"East Timor",aliases:["Timor-Leste","TP"],groups:["035","142","UN"],driveSide:"left",callingCodes:["670"]},geometry:{type:"MultiPolygon",coordinates:[[[[124.46701,-9.13002],[124.94011,-8.85617],[124.97742,-9.08128],[125.11764,-8.96359],[125.18632,-9.03142],[125.18907,-9.16434],[125.09434,-9.19669],[125.04044,-9.17093],[124.97892,-9.19281],[125.09025,-9.46406],[125.68138,-9.85176],[127.55165,-9.05052],[127.42116,-8.22471],[125.87691,-8.31789],[125.58506,-7.95311],[124.92337,-8.75859],[124.33472,-9.11416],[124.04628,-9.22671],[124.04286,-9.34243],[124.10539,-9.41206],[124.14517,-9.42324],[124.21247,-9.36904],[124.28115,-9.42189],[124.28115,-9.50453],[124.3535,-9.48493],[124.35258,-9.43002],[124.38554,-9.3582],[124.45971,-9.30263],[124.46701,-9.13002]]]]}},{type:"Feature",properties:{iso1A2:"TM",iso1A3:"TKM",iso1N3:"795",wikidata:"Q874",nameEn:"Turkmenistan",groups:["143","142","UN"],callingCodes:["993"]},geometry:{type:"MultiPolygon",coordinates:[[[[60.5078,41.21694],[60.06581,41.4363],[60.18117,41.60082],[60.06032,41.76287],[60.08504,41.80997],[60.33223,41.75058],[59.95046,41.97966],[60.0356,42.01028],[60.04659,42.08982],[59.96419,42.1428],[60.00539,42.212],[59.94633,42.27655],[59.4341,42.29738],[59.2955,42.37064],[59.17317,42.52248],[58.93422,42.5407],[58.6266,42.79314],[58.57991,42.64988],[58.27504,42.69632],[58.14321,42.62159],[58.29427,42.56497],[58.51674,42.30348],[58.40688,42.29535],[58.3492,42.43335],[57.99214,42.50021],[57.90975,42.4374],[57.92897,42.24047],[57.84932,42.18555],[57.6296,42.16519],[57.30275,42.14076],[57.03633,41.92043],[56.96218,41.80383],[57.03359,41.41777],[57.13796,41.36625],[57.03423,41.25435],[56.00314,41.32584],[55.45471,41.25609],[54.95182,41.92424],[54.20635,42.38477],[52.97575,42.1308],[52.47884,41.78034],[52.26048,41.69249],[51.7708,40.29239],[53.89734,37.3464],[54.24565,37.32047],[54.36211,37.34912],[54.58664,37.45809],[54.67247,37.43532],[54.77822,37.51597],[54.81804,37.61285],[54.77684,37.62264],[54.851,37.75739],[55.13412,37.94705],[55.44152,38.08564],[55.76561,38.12238],[55.97847,38.08024],[56.33278,38.08132],[56.32454,38.18502],[56.43303,38.26054],[56.62255,38.24005],[56.73928,38.27887],[57.03453,38.18717],[57.21169,38.28965],[57.37236,38.09321],[57.35042,37.98546],[57.79534,37.89299],[58.21399,37.77281],[58.22999,37.6856],[58.39959,37.63134],[58.47786,37.6433],[58.5479,37.70526],[58.6921,37.64548],[58.9338,37.67374],[59.22905,37.51161],[59.33507,37.53146],[59.39797,37.47892],[59.39385,37.34257],[59.55178,37.13594],[59.74678,37.12499],[60.00768,37.04102],[60.34767,36.63214],[61.14516,36.64644],[61.18187,36.55348],[61.1393,36.38782],[61.22719,36.12759],[61.12007,35.95992],[61.22444,35.92879],[61.26152,35.80749],[61.22719,35.67038],[61.27371,35.61482],[61.58742,35.43803],[61.77693,35.41341],[61.97743,35.4604],[62.05709,35.43803],[62.15871,35.33278],[62.29191,35.25964],[62.29878,35.13312],[62.48006,35.28796],[62.62288,35.22067],[62.74098,35.25432],[62.90853,35.37086],[63.0898,35.43131],[63.12276,35.53196],[63.10079,35.63024],[63.23262,35.67487],[63.10318,35.81782],[63.12276,35.86208],[63.29579,35.85985],[63.53475,35.90881],[63.56496,35.95106],[63.98519,36.03773],[64.05385,36.10433],[64.43288,36.24401],[64.57295,36.34362],[64.62514,36.44311],[64.61141,36.6351],[64.97945,37.21913],[65.51778,37.23881],[65.64263,37.34388],[65.64137,37.45061],[65.72274,37.55438],[66.30993,37.32409],[66.55743,37.35409],[66.52303,37.39827],[66.65761,37.45497],[66.52852,37.58568],[66.53676,37.80084],[66.67684,37.96776],[66.56697,38.0435],[66.41042,38.02403],[66.24013,38.16238],[65.83913,38.25733],[65.55873,38.29052],[64.32576,38.98691],[64.19086,38.95561],[63.70778,39.22349],[63.6913,39.27666],[62.43337,39.98528],[62.34273,40.43206],[62.11751,40.58242],[61.87856,41.12257],[61.4446,41.29407],[61.39732,41.19873],[61.33199,41.14946],[61.22212,41.14946],[61.03261,41.25691],[60.5078,41.21694]]]]}},{type:"Feature",properties:{iso1A2:"TN",iso1A3:"TUN",iso1N3:"788",wikidata:"Q948",nameEn:"Tunisia",groups:["015","002","UN"],callingCodes:["216"]},geometry:{type:"MultiPolygon",coordinates:[[[[11.2718,37.6713],[7.89009,38.19924],[8.59123,37.14286],[8.64044,36.9401],[8.62972,36.86499],[8.67706,36.8364],[8.57613,36.78062],[8.46537,36.7706],[8.47609,36.66607],[8.16167,36.48817],[8.18936,36.44939],[8.40731,36.42208],[8.2626,35.91733],[8.26472,35.73669],[8.35371,35.66373],[8.36086,35.47774],[8.30329,35.29884],[8.47318,35.23376],[8.3555,35.10007],[8.30727,34.95378],[8.25189,34.92009],[8.29655,34.72798],[8.20482,34.57575],[7.86264,34.3987],[7.81242,34.21841],[7.74207,34.16492],[7.66174,34.20167],[7.52851,34.06493],[7.54088,33.7726],[7.73687,33.42114],[7.83028,33.18851],[8.11433,33.10175],[8.1179,33.05086],[8.31895,32.83483],[8.35999,32.50101],[9.07483,32.07865],[9.55544,30.23971],[9.76848,30.34366],[9.88152,30.34074],[10.29516,30.90337],[10.12239,31.42098],[10.31364,31.72648],[10.48497,31.72956],[10.62788,31.96629],[10.7315,31.97235],[11.04234,32.2145],[11.53898,32.4138],[11.57828,32.48013],[11.46037,32.6307],[11.51549,33.09826],[11.55852,33.1409],[11.58941,33.36891],[11.2718,37.6713]]]]}},{type:"Feature",properties:{iso1A2:"TO",iso1A3:"TON",iso1N3:"776",wikidata:"Q678",nameEn:"Tonga",groups:["061","009","UN"],driveSide:"left",callingCodes:["676"]},geometry:{type:"MultiPolygon",coordinates:[[[[-176.74538,-22.89767],[-180,-22.90585],[-180,-24.21376],[-173.10761,-24.19665],[-173.13438,-14.94228],[-176.76826,-14.95183],[-176.74538,-22.89767]]]]}},{type:"Feature",properties:{iso1A2:"TR",iso1A3:"TUR",iso1N3:"792",wikidata:"Q43",nameEn:"Turkey",groups:["145","142","UN"],callingCodes:["90"]},geometry:{type:"MultiPolygon",coordinates:[[[[41.54366,41.52185],[40.89217,41.72528],[34.8305,42.4581],[28.32297,41.98371],[28.02971,41.98066],[27.91479,41.97902],[27.83492,41.99709],[27.81235,41.94803],[27.69949,41.97515],[27.55191,41.90928],[27.52379,41.93756],[27.45478,41.96591],[27.27411,42.10409],[27.22376,42.10152],[27.19251,42.06028],[27.08486,42.08735],[27.03277,42.0809],[26.95638,42.00741],[26.79143,41.97386],[26.62996,41.97644],[26.56051,41.92995],[26.57961,41.90024],[26.53968,41.82653],[26.36952,41.82265],[26.33589,41.76802],[26.32952,41.73637],[26.35957,41.71149],[26.47958,41.67037],[26.5209,41.62592],[26.59196,41.60491],[26.59742,41.48058],[26.61767,41.42281],[26.62997,41.34613],[26.5837,41.32131],[26.5209,41.33993],[26.39861,41.25053],[26.32259,41.24929],[26.31928,41.07386],[26.3606,41.02027],[26.33297,40.98388],[26.35894,40.94292],[26.32259,40.94042],[26.28623,40.93005],[26.29441,40.89119],[26.26169,40.9168],[26.20856,40.86048],[26.21351,40.83298],[26.15685,40.80709],[26.12854,40.77339],[26.12495,40.74283],[26.08638,40.73214],[26.0754,40.72772],[26.03489,40.73051],[25.94795,40.72797],[26.04292,40.3958],[25.61285,40.17161],[25.94257,39.39358],[26.43357,39.43096],[26.70773,39.0312],[26.61814,38.81372],[26.21136,38.65436],[26.32173,38.48731],[26.24183,38.44695],[26.21136,38.17558],[27.05537,37.9131],[27.16428,37.72343],[26.99377,37.69034],[26.95583,37.64989],[27.14757,37.32],[27.20312,36.94571],[27.45627,36.9008],[27.24613,36.71622],[27.46117,36.53789],[27.89482,36.69898],[27.95037,36.46155],[28.23708,36.56812],[29.30783,36.01033],[29.48192,36.18377],[29.61002,36.1731],[29.61805,36.14179],[29.69611,36.10365],[29.73302,35.92555],[32.82353,35.70297],[35.51152,36.10954],[35.931,35.92109],[35.98499,35.94107],[36.00514,35.94113],[36.01844,35.92403],[35.99829,35.88242],[36.11827,35.85923],[36.13919,35.83692],[36.14029,35.81015],[36.1623,35.80925],[36.17441,35.92076],[36.19973,35.95195],[36.25366,35.96264],[36.27678,35.94839],[36.29769,35.96086],[36.28338,36.00273],[36.30099,36.00985],[36.33956,35.98687],[36.37474,36.01163],[36.39206,36.22088],[36.4617,36.20461],[36.50463,36.2419],[36.6125,36.22592],[36.68672,36.23677],[36.65653,36.33861],[36.6081,36.33772],[36.54206,36.49539],[36.58829,36.58295],[36.57398,36.65186],[36.62681,36.71189],[36.61581,36.74629],[36.66727,36.82901],[36.99557,36.75997],[36.99886,36.74012],[37.04399,36.73483],[37.04619,36.71101],[37.01647,36.69512],[37.02088,36.66422],[37.08279,36.63495],[37.10894,36.6704],[37.16177,36.66069],[37.21988,36.6736],[37.47253,36.63243],[37.49103,36.66904],[37.68048,36.75065],[37.81974,36.76055],[38.21064,36.91842],[38.38859,36.90064],[38.55908,36.84429],[38.74042,36.70629],[39.03217,36.70911],[39.21538,36.66834],[39.81589,36.75538],[40.69136,37.0996],[40.90856,37.13147],[41.21937,37.07665],[41.515,37.08084],[42.00894,37.17209],[42.18225,37.28569],[42.19301,37.31323],[42.2112,37.32491],[42.22257,37.31395],[42.22381,37.30238],[42.20454,37.28715],[42.21548,37.28026],[42.23683,37.2863],[42.26039,37.27017],[42.2824,37.2798],[42.34735,37.22548],[42.32313,37.17814],[42.35724,37.10998],[42.56725,37.14878],[42.78887,37.38615],[42.93705,37.32015],[43.11403,37.37436],[43.30083,37.30629],[43.33508,37.33105],[43.50787,37.24436],[43.56702,37.25675],[43.63085,37.21957],[43.7009,37.23692],[43.8052,37.22825],[43.82699,37.19477],[43.84878,37.22205],[43.90949,37.22453],[44.02002,37.33229],[44.13521,37.32486],[44.2613,37.25055],[44.27998,37.16501],[44.22239,37.15756],[44.18503,37.09551],[44.25975,36.98119],[44.30645,36.97373],[44.35937,37.02843],[44.35315,37.04955],[44.38117,37.05825],[44.42631,37.05825],[44.63179,37.19229],[44.76698,37.16162],[44.78319,37.1431],[44.7868,37.16644],[44.75986,37.21549],[44.81021,37.2915],[44.58449,37.45018],[44.61401,37.60165],[44.56887,37.6429],[44.62096,37.71985],[44.55498,37.783],[44.45948,37.77065],[44.3883,37.85433],[44.22509,37.88859],[44.42476,38.25763],[44.50115,38.33939],[44.44386,38.38295],[44.38309,38.36117],[44.3119,38.37887],[44.3207,38.49799],[44.32058,38.62752],[44.28065,38.6465],[44.26155,38.71427],[44.30322,38.81581],[44.18863,38.93881],[44.20946,39.13975],[44.1043,39.19842],[44.03667,39.39223],[44.22452,39.4169],[44.29818,39.378],[44.37921,39.4131],[44.42832,39.4131],[44.41849,39.56659],[44.48111,39.61579],[44.47298,39.68788],[44.6137,39.78393],[44.65422,39.72163],[44.71806,39.71124],[44.81043,39.62677],[44.80977,39.65768],[44.75779,39.7148],[44.61845,39.8281],[44.46635,39.97733],[44.26973,40.04866],[44.1778,40.02845],[44.1057,40.03555],[43.92307,40.01787],[43.65688,40.11199],[43.65221,40.14889],[43.71136,40.16673],[43.59928,40.34019],[43.60862,40.43267],[43.54791,40.47413],[43.63664,40.54159],[43.7425,40.66805],[43.74872,40.7365],[43.67712,40.84846],[43.67712,40.93084],[43.58683,40.98961],[43.47319,41.02251],[43.44984,41.0988],[43.4717,41.12611],[43.44973,41.17666],[43.36118,41.2028],[43.23096,41.17536],[43.1945,41.25242],[43.13373,41.25503],[43.21707,41.30331],[43.02956,41.37891],[42.8785,41.50516],[42.84899,41.47265],[42.78995,41.50126],[42.84471,41.58912],[42.72794,41.59714],[42.59202,41.58183],[42.51772,41.43606],[42.26387,41.49346],[41.95134,41.52466],[41.81939,41.43621],[41.7124,41.47417],[41.7148,41.4932],[41.54366,41.52185]]]]}},{type:"Feature",properties:{iso1A2:"TT",iso1A3:"TTO",iso1N3:"780",wikidata:"Q754",nameEn:"Trinidad and Tobago",groups:["029","003","419","019","UN"],driveSide:"left",callingCodes:["1 868"]},geometry:{type:"MultiPolygon",coordinates:[[[[-61.62505,11.18974],[-62.08693,10.04435],[-60.89962,9.81445],[-60.07172,11.77667],[-61.62505,11.18974]]]]}},{type:"Feature",properties:{iso1A2:"TV",iso1A3:"TUV",iso1N3:"798",wikidata:"Q672",nameEn:"Tuvalu",groups:["061","009","UN"],driveSide:"left",callingCodes:["688"]},geometry:{type:"MultiPolygon",coordinates:[[[[174,-5],[174,-11.5],[179.99999,-11.5],[179.99999,-5],[174,-5]]]]}},{type:"Feature",properties:{iso1A2:"TW",iso1A3:"TWN",iso1N3:"158",wikidata:"Q865",nameEn:"Taiwan",aliases:["RC"],groups:["030","142"],callingCodes:["886"]},geometry:{type:"MultiPolygon",coordinates:[[[[121.8109,21.77688],[122.26612,25.98197],[120.5128,26.536],[120.0693,26.3959],[119.78816,26.2348],[119.98511,25.37624],[119.42295,25.0886],[118.6333,24.46259],[118.42453,24.54644],[118.35291,24.51645],[118.28244,24.51231],[118.11703,24.39734],[120.69238,21.52331],[121.8109,21.77688]]]]}},{type:"Feature",properties:{iso1A2:"TZ",iso1A3:"TZA",iso1N3:"834",wikidata:"Q924",nameEn:"Tanzania",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["255"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.80408,-.99911],[30.76635,-.9852],[30.70631,-1.01175],[30.64166,-1.06601],[30.47194,-1.0555],[30.45116,-1.10641],[30.50889,-1.16412],[30.57123,-1.33264],[30.71974,-1.43244],[30.84079,-1.64652],[30.80802,-1.91477],[30.89303,-2.08223],[30.83915,-2.35795],[30.54501,-2.41404],[30.41789,-2.66266],[30.52747,-2.65841],[30.40662,-2.86151],[30.4987,-2.9573],[30.57926,-2.89791],[30.6675,-2.98987],[30.83823,-2.97837],[30.84165,-3.25152],[30.45915,-3.56532],[30.22042,-4.01738],[30.03323,-4.26631],[29.88172,-4.35743],[29.82885,-4.36153],[29.77289,-4.41733],[29.75109,-4.45836],[29.63827,-4.44681],[29.43673,-4.44845],[29.52552,-6.2731],[30.2567,-7.14121],[30.79243,-8.27382],[31.00796,-8.58615],[31.37533,-8.60769],[31.57147,-8.70619],[31.57147,-8.81388],[31.71158,-8.91386],[31.81587,-8.88618],[31.94663,-8.93846],[31.94196,-9.02303],[31.98866,-9.07069],[32.08206,-9.04609],[32.16146,-9.05993],[32.25486,-9.13371],[32.43543,-9.11988],[32.49147,-9.14754],[32.53661,-9.24281],[32.75611,-9.28583],[32.76233,-9.31963],[32.95389,-9.40138],[32.99397,-9.36712],[33.14925,-9.49322],[33.31581,-9.48554],[33.48052,-9.62442],[33.76677,-9.58516],[33.93298,-9.71647],[33.9638,-9.62206],[33.95829,-9.54066],[34.03865,-9.49398],[34.54499,-10.0678],[34.51911,-10.12279],[34.57581,-10.56271],[34.65946,-10.6828],[34.67047,-10.93796],[34.61161,-11.01611],[34.63305,-11.11731],[34.79375,-11.32245],[34.91153,-11.39799],[34.96296,-11.57354],[35.63599,-11.55927],[35.82767,-11.41081],[36.19094,-11.57593],[36.19094,-11.70008],[36.62068,-11.72884],[36.80309,-11.56836],[37.3936,-11.68949],[37.76614,-11.53352],[37.8388,-11.3123],[37.93618,-11.26228],[38.21598,-11.27289],[38.47258,-11.4199],[38.88996,-11.16978],[39.24395,-11.17433],[39.58249,-10.96043],[40.00295,-10.80255],[40.44265,-10.4618],[40.74206,-10.25691],[40.14328,-4.64201],[39.62121,-4.68136],[39.44306,-4.93877],[39.21631,-4.67835],[37.81321,-3.69179],[37.75036,-3.54243],[37.63099,-3.50723],[37.5903,-3.42735],[37.71745,-3.304],[37.67199,-3.06222],[34.0824,-1.02264],[34.03084,-1.05101],[34.02286,-1.00779],[33.93107,-.99298],[30.80408,-.99911]]]]}},{type:"Feature",properties:{iso1A2:"UA",iso1A3:"UKR",iso1N3:"804",wikidata:"Q212",nameEn:"Ukraine",groups:["151","150","UN"],callingCodes:["380"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.57318,46.10317],[33.61467,46.13561],[33.63854,46.14147],[33.61517,46.22615],[33.646,46.23028],[33.74047,46.18555],[33.79715,46.20482],[33.85234,46.19863],[33.91549,46.15938],[34.05272,46.10838],[34.07311,46.11769],[34.12929,46.10494],[34.181,46.06804],[34.25111,46.0532],[34.33912,46.06114],[34.41221,46.00245],[34.44155,45.95995],[34.48729,45.94267],[34.52011,45.95097],[34.55889,45.99347],[34.60861,45.99347],[34.66679,45.97136],[34.75479,45.90705],[34.80153,45.90047],[34.79905,45.81009],[34.96015,45.75634],[35.23066,45.79231],[37.62608,46.82615],[38.12112,46.86078],[38.3384,46.98085],[38.22955,47.12069],[38.23049,47.2324],[38.32112,47.2585],[38.33074,47.30508],[38.22225,47.30788],[38.28954,47.39255],[38.28679,47.53552],[38.35062,47.61631],[38.76379,47.69346],[38.79628,47.81109],[38.87979,47.87719],[39.73935,47.82876],[39.82213,47.96396],[39.77544,48.04206],[39.88256,48.04482],[39.83724,48.06501],[39.94847,48.22811],[40.00752,48.22445],[39.99241,48.31768],[39.97325,48.31399],[39.9693,48.29904],[39.95248,48.29972],[39.91465,48.26743],[39.90041,48.3049],[39.84273,48.30947],[39.84136,48.33321],[39.94847,48.35055],[39.88794,48.44226],[39.86196,48.46633],[39.84548,48.57821],[39.79764,48.58668],[39.67226,48.59368],[39.71765,48.68673],[39.73104,48.7325],[39.79466,48.83739],[39.97182,48.79398],[40.08168,48.87443],[40.03636,48.91957],[39.98967,48.86901],[39.78368,48.91596],[39.74874,48.98675],[39.72649,48.9754],[39.71353,48.98959],[39.6683,48.99454],[39.6836,49.05121],[39.93437,49.05709],[40.01988,49.1761],[40.22176,49.25683],[40.18331,49.34996],[40.14912,49.37681],[40.1141,49.38798],[40.03087,49.45452],[40.03636,49.52321],[40.16683,49.56865],[40.13249,49.61672],[39.84548,49.56064],[39.65047,49.61761],[39.59142,49.73758],[39.44496,49.76067],[39.27968,49.75976],[39.1808,49.88911],[38.9391,49.79524],[38.90477,49.86787],[38.73311,49.90238],[38.68677,50.00904],[38.65688,49.97176],[38.35408,50.00664],[38.32524,50.08866],[38.18517,50.08161],[38.21675,49.98104],[38.02999,49.90592],[38.02999,49.94482],[37.90776,50.04194],[37.79515,50.08425],[37.75807,50.07896],[37.61113,50.21976],[37.62879,50.24481],[37.62486,50.29966],[37.47243,50.36277],[37.48204,50.46079],[37.08468,50.34935],[36.91762,50.34963],[36.69377,50.26982],[36.64571,50.218],[36.56655,50.2413],[36.58371,50.28563],[36.47817,50.31457],[36.30101,50.29088],[36.20763,50.3943],[36.06893,50.45205],[35.8926,50.43829],[35.80388,50.41356],[35.73659,50.35489],[35.61711,50.35707],[35.58003,50.45117],[35.47463,50.49247],[35.39464,50.64751],[35.48116,50.66405],[35.47704,50.77274],[35.41367,50.80227],[35.39307,50.92145],[35.32598,50.94524],[35.40837,51.04119],[35.31774,51.08434],[35.20375,51.04723],[35.12685,51.16191],[35.14058,51.23162],[34.97304,51.2342],[34.82472,51.17483],[34.6874,51.18],[34.6613,51.25053],[34.38802,51.2746],[34.31661,51.23936],[34.23009,51.26429],[34.33446,51.363],[34.22048,51.4187],[34.30562,51.5205],[34.17599,51.63253],[34.07765,51.67065],[34.42922,51.72852],[34.41136,51.82793],[34.09413,52.00835],[34.11199,52.14087],[34.05239,52.20132],[33.78789,52.37204],[33.55718,52.30324],[33.48027,52.31499],[33.51323,52.35779],[33.18913,52.3754],[32.89937,52.2461],[32.85405,52.27888],[32.69475,52.25535],[32.54781,52.32423],[32.3528,52.32842],[32.38988,52.24946],[32.33083,52.23685],[32.34044,52.1434],[32.2777,52.10266],[32.23331,52.08085],[32.08813,52.03319],[31.92159,52.05144],[31.96141,52.08015],[31.85018,52.11305],[31.81722,52.09955],[31.7822,52.11406],[31.38326,52.12991],[31.25142,52.04131],[31.13332,52.1004],[30.95589,52.07775],[30.90897,52.00699],[30.76443,51.89739],[30.68804,51.82806],[30.51946,51.59649],[30.64992,51.35014],[30.56203,51.25655],[30.36153,51.33984],[30.34642,51.42555],[30.17888,51.51025],[29.77376,51.4461],[29.7408,51.53417],[29.54372,51.48372],[29.49773,51.39814],[29.42357,51.4187],[29.32881,51.37843],[29.25191,51.49828],[29.25603,51.57089],[29.20659,51.56918],[29.16402,51.64679],[29.1187,51.65872],[28.99098,51.56833],[28.95528,51.59222],[28.81795,51.55552],[28.76027,51.48802],[28.78224,51.45294],[28.75615,51.41442],[28.73143,51.46236],[28.69161,51.44695],[28.64429,51.5664],[28.47051,51.59734],[28.37592,51.54505],[28.23452,51.66988],[28.10658,51.57857],[27.95827,51.56065],[27.91844,51.61952],[27.85253,51.62293],[27.76052,51.47604],[27.67125,51.50854],[27.71932,51.60672],[27.55727,51.63486],[27.51058,51.5854],[27.47212,51.61184],[27.24828,51.60161],[27.26613,51.65957],[27.20948,51.66713],[27.20602,51.77291],[26.99422,51.76933],[26.9489,51.73788],[26.80043,51.75777],[26.69759,51.82284],[26.46962,51.80501],[26.39367,51.87315],[26.19084,51.86781],[26.00408,51.92967],[25.83217,51.92587],[25.80574,51.94556],[25.73673,51.91973],[25.46163,51.92205],[25.20228,51.97143],[24.98784,51.91273],[24.37123,51.88222],[24.29021,51.80841],[24.3163,51.75063],[24.13075,51.66979],[23.99907,51.58369],[23.8741,51.59734],[23.91118,51.63316],[23.7766,51.66809],[23.60906,51.62122],[23.6736,51.50255],[23.62751,51.50512],[23.69905,51.40871],[23.63858,51.32182],[23.80678,51.18405],[23.90376,51.07697],[23.92217,51.00836],[24.04576,50.90196],[24.14524,50.86128],[24.0952,50.83262],[23.99254,50.83847],[23.95925,50.79271],[24.0595,50.71625],[24.0996,50.60752],[24.07048,50.5071],[24.03668,50.44507],[23.99563,50.41289],[23.79445,50.40481],[23.71382,50.38248],[23.67635,50.33385],[23.28221,50.0957],[22.99329,49.84249],[22.83179,49.69875],[22.80261,49.69098],[22.78304,49.65543],[22.64534,49.53094],[22.69444,49.49378],[22.748,49.32759],[22.72009,49.20288],[22.86336,49.10513],[22.89122,49.00725],[22.56155,49.08865],[22.54338,49.01424],[22.48296,48.99172],[22.42934,48.92857],[22.34151,48.68893],[22.21379,48.6218],[22.16023,48.56548],[22.14689,48.4005],[22.2083,48.42534],[22.38133,48.23726],[22.49806,48.25189],[22.59007,48.15121],[22.58733,48.10813],[22.66835,48.09162],[22.73427,48.12005],[22.81804,48.11363],[22.87847,48.04665],[22.84276,47.98602],[22.89849,47.95851],[22.94301,47.96672],[22.92241,48.02002],[23.0158,47.99338],[23.08858,48.00716],[23.1133,48.08061],[23.15999,48.12188],[23.27397,48.08245],[23.33577,48.0237],[23.4979,47.96858],[23.52803,48.01818],[23.5653,48.00499],[23.63894,48.00293],[23.66262,47.98786],[23.75188,47.99705],[23.80904,47.98142],[23.8602,47.9329],[23.89352,47.94512],[23.94192,47.94868],[23.96337,47.96672],[23.98553,47.96076],[24.00801,47.968],[24.02999,47.95087],[24.06466,47.95317],[24.11281,47.91487],[24.22566,47.90231],[24.34926,47.9244],[24.43578,47.97131],[24.61994,47.95062],[24.70632,47.84428],[24.81893,47.82031],[24.88896,47.7234],[25.11144,47.75203],[25.23778,47.89403],[25.63878,47.94924],[25.77723,47.93919],[26.05901,47.9897],[26.17711,47.99246],[26.33504,48.18418],[26.55202,48.22445],[26.62823,48.25804],[26.6839,48.35828],[26.79239,48.29071],[26.82809,48.31629],[26.71274,48.40388],[26.85556,48.41095],[26.93384,48.36558],[27.03821,48.37653],[27.0231,48.42485],[27.08078,48.43214],[27.13434,48.37288],[27.27855,48.37534],[27.32159,48.4434],[27.37604,48.44398],[27.37741,48.41026],[27.44333,48.41209],[27.46942,48.454],[27.5889,48.49224],[27.59027,48.46311],[27.6658,48.44034],[27.74422,48.45926],[27.79225,48.44244],[27.81902,48.41874],[27.87533,48.4037],[27.88391,48.36699],[27.95883,48.32368],[28.04527,48.32661],[28.09873,48.3124],[28.07504,48.23494],[28.17666,48.25963],[28.19314,48.20749],[28.2856,48.23202],[28.32508,48.23384],[28.35519,48.24957],[28.36996,48.20543],[28.34912,48.1787],[28.30586,48.1597],[28.30609,48.14018],[28.34009,48.13147],[28.38712,48.17567],[28.43701,48.15832],[28.42454,48.12047],[28.48428,48.0737],[28.53921,48.17453],[28.69896,48.13106],[28.85232,48.12506],[28.8414,48.03392],[28.9306,47.96255],[29.1723,47.99013],[29.19839,47.89261],[29.27804,47.88893],[29.20663,47.80367],[29.27255,47.79953],[29.22242,47.73607],[29.22414,47.60012],[29.11743,47.55001],[29.18603,47.43387],[29.3261,47.44664],[29.39889,47.30179],[29.47854,47.30366],[29.48678,47.36043],[29.5733,47.36508],[29.59665,47.25521],[29.54996,47.24962],[29.57696,47.13581],[29.49732,47.12878],[29.53044,47.07851],[29.61038,47.09932],[29.62137,47.05069],[29.57056,46.94766],[29.72986,46.92234],[29.75458,46.8604],[29.87405,46.88199],[29.98814,46.82358],[29.94522,46.80055],[29.9743,46.75325],[29.94409,46.56002],[29.88916,46.54302],[30.02511,46.45132],[30.16794,46.40967],[30.09103,46.38694],[29.94114,46.40114],[29.88329,46.35851],[29.74496,46.45605],[29.66359,46.4215],[29.6763,46.36041],[29.5939,46.35472],[29.49914,46.45889],[29.35357,46.49505],[29.24886,46.37912],[29.23547,46.55435],[29.02409,46.49582],[29.01241,46.46177],[28.9306,46.45699],[29.004,46.31495],[28.98478,46.31803],[28.94953,46.25852],[29.06656,46.19716],[28.94643,46.09176],[29.00613,46.04962],[28.98004,46.00385],[28.74383,45.96664],[28.78503,45.83475],[28.69852,45.81753],[28.70401,45.78019],[28.52823,45.73803],[28.47879,45.66994],[28.51587,45.6613],[28.54196,45.58062],[28.49252,45.56716],[28.51449,45.49982],[28.43072,45.48538],[28.41836,45.51715],[28.30201,45.54744],[28.21139,45.46895],[28.28504,45.43907],[28.34554,45.32102],[28.5735,45.24759],[28.71358,45.22631],[28.78911,45.24179],[28.81383,45.3384],[28.94292,45.28045],[28.96077,45.33164],[29.24779,45.43388],[29.42632,45.44545],[29.59798,45.38857],[29.68175,45.26885],[29.65428,45.25629],[29.69272,45.19227],[30.04414,45.08461],[31.62627,45.50633],[33.54017,46.0123],[33.59087,46.06013],[33.57318,46.10317]]]]}},{type:"Feature",properties:{iso1A2:"UG",iso1A3:"UGA",iso1N3:"800",wikidata:"Q1036",nameEn:"Uganda",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["256"]},geometry:{type:"MultiPolygon",coordinates:[[[[33.93107,-.99298],[33.9264,-.54188],[33.98449,-.13079],[33.90936,.10581],[34.10067,.36372],[34.08727,.44713],[34.11408,.48884],[34.13493,.58118],[34.20196,.62289],[34.27345,.63182],[34.31516,.75693],[34.40041,.80266],[34.43349,.85254],[34.52369,1.10692],[34.57427,1.09868],[34.58029,1.14712],[34.67562,1.21265],[34.80223,1.22754],[34.82606,1.26626],[34.82606,1.30944],[34.7918,1.36752],[34.87819,1.5596],[34.92734,1.56109],[34.9899,1.6668],[34.98692,1.97348],[34.90947,2.42447],[34.95267,2.47209],[34.77244,2.70272],[34.78137,2.76223],[34.73967,2.85447],[34.65774,2.8753],[34.60114,2.93034],[34.56242,3.11478],[34.45815,3.18319],[34.40006,3.37949],[34.41794,3.44342],[34.39112,3.48802],[34.44922,3.51627],[34.45815,3.67385],[34.15429,3.80464],[34.06046,4.15235],[33.9873,4.23316],[33.51264,3.75068],[33.18356,3.77812],[33.02852,3.89296],[32.89746,3.81339],[32.72021,3.77327],[32.41337,3.748],[32.20782,3.6053],[32.19888,3.50867],[32.08866,3.53543],[32.08491,3.56287],[32.05187,3.589],[31.95907,3.57408],[31.96205,3.6499],[31.86821,3.78664],[31.81459,3.82083],[31.72075,3.74354],[31.50776,3.63652],[31.50478,3.67814],[31.29476,3.8015],[31.16666,3.79853],[30.97601,3.693],[30.85153,3.48867],[30.94081,3.50847],[30.93486,3.40737],[30.84251,3.26908],[30.77101,3.04897],[30.8574,2.9508],[30.8857,2.83923],[30.75612,2.5863],[30.74271,2.43601],[30.83059,2.42559],[30.91102,2.33332],[30.96911,2.41071],[31.06593,2.35862],[31.07934,2.30207],[31.12104,2.27676],[31.1985,2.29462],[31.20148,2.2217],[31.28042,2.17853],[31.30127,2.11006],[30.48503,1.21675],[30.24671,1.14974],[30.22139,.99635],[30.1484,.89805],[29.98307,.84295],[29.95477,.64486],[29.97413,.52124],[29.87284,.39166],[29.81922,.16824],[29.77454,.16675],[29.7224,.07291],[29.72687,-.08051],[29.65091,-.46777],[29.67474,-.47969],[29.67176,-.55714],[29.62708,-.71055],[29.63006,-.8997],[29.58388,-.89821],[29.59061,-1.39016],[29.82657,-1.31187],[29.912,-1.48269],[30.16369,-1.34303],[30.35212,-1.06896],[30.47194,-1.0555],[30.64166,-1.06601],[30.70631,-1.01175],[30.76635,-.9852],[30.80408,-.99911],[33.93107,-.99298]]]]}},{type:"Feature",properties:{iso1A2:"UM",iso1A3:"UMI",iso1N3:"581",wikidata:"Q16645",nameEn:"United States Minor Outlying Islands",country:"US"},geometry:null},{type:"Feature",properties:{iso1A2:"UN",wikidata:"Q1065",nameEn:"United Nations",level:"unitedNations",isoStatus:"excRes"},geometry:null},{type:"Feature",properties:{iso1A2:"US",iso1A3:"USA",iso1N3:"840",wikidata:"Q30",nameEn:"United States of America"},geometry:null},{type:"Feature",properties:{iso1A2:"UY",iso1A3:"URY",iso1N3:"858",wikidata:"Q77",nameEn:"Uruguay",groups:["005","419","019","UN"],callingCodes:["598"]},geometry:{type:"MultiPolygon",coordinates:[[[[-57.65132,-30.19229],[-57.61478,-30.25165],[-57.64859,-30.35095],[-57.89115,-30.49572],[-57.8024,-30.77193],[-57.89476,-30.95994],[-57.86729,-31.06352],[-57.9908,-31.34924],[-57.98127,-31.3872],[-58.07569,-31.44916],[-58.0023,-31.53084],[-58.00076,-31.65016],[-58.20252,-31.86966],[-58.10036,-32.25338],[-58.22362,-32.52416],[-58.1224,-32.98842],[-58.40475,-33.11777],[-58.44442,-33.84033],[-58.34425,-34.15035],[-57.83001,-34.69099],[-54.78916,-36.21945],[-52.83257,-34.01481],[-53.37138,-33.74313],[-53.39593,-33.75169],[-53.44031,-33.69344],[-53.52794,-33.68908],[-53.53459,-33.16843],[-53.1111,-32.71147],[-53.37671,-32.57005],[-53.39572,-32.58596],[-53.76024,-32.0751],[-54.17384,-31.86168],[-55.50821,-30.91349],[-55.50841,-30.9027],[-55.51862,-30.89828],[-55.52712,-30.89997],[-55.53276,-30.90218],[-55.53431,-30.89714],[-55.54572,-30.89051],[-55.55218,-30.88193],[-55.55373,-30.8732],[-55.5634,-30.8686],[-55.58866,-30.84117],[-55.87388,-31.05053],[-56.4619,-30.38457],[-56.4795,-30.3899],[-56.49267,-30.39471],[-56.90236,-30.02578],[-57.22502,-30.26121],[-57.65132,-30.19229]]]]}},{type:"Feature",properties:{iso1A2:"UZ",iso1A3:"UZB",iso1N3:"860",wikidata:"Q265",nameEn:"Uzbekistan",groups:["143","142","UN"],callingCodes:["998"]},geometry:{type:"MultiPolygon",coordinates:[[[[65.85194,42.85481],[65.53277,43.31856],[65.18666,43.48835],[64.96464,43.74748],[64.53885,43.56941],[63.34656,43.64003],[62.01711,43.51008],[61.01475,44.41383],[58.59711,45.58671],[55.97842,44.99622],[55.97832,44.99622],[55.97822,44.99617],[55.97811,44.99617],[55.97801,44.99612],[55.97801,44.99607],[55.97791,44.99607],[55.9778,44.99607],[55.9777,44.99601],[55.9777,44.99596],[55.9776,44.99591],[55.97749,44.99591],[55.97739,44.99591],[55.97739,44.99586],[55.97729,44.99586],[55.97718,44.99581],[55.97708,44.99576],[55.97698,44.9957],[55.97698,44.99565],[55.97687,44.9956],[55.97677,44.9956],[55.97677,44.99555],[55.97677,44.9955],[55.97667,44.99545],[55.97656,44.99539],[55.97646,44.99534],[55.97646,44.99529],[55.97636,44.99524],[55.97636,44.99519],[55.97625,44.99514],[55.97615,44.99508],[55.97615,44.99503],[55.97615,44.99498],[55.97615,44.99493],[55.97615,44.99483],[55.97615,44.99477],[55.97605,44.99477],[55.97605,44.99467],[55.97605,44.99462],[55.97605,44.99457],[55.97605,44.99452],[55.97594,44.99446],[55.97584,44.99441],[55.97584,44.99436],[55.97584,44.99431],[55.97584,44.99426],[55.97584,44.99421],[55.97584,44.99415],[55.97584,44.99405],[55.97584,44.994],[55.97584,44.9939],[55.97584,44.99384],[55.97584,44.99374],[55.97584,44.99369],[55.97584,44.99359],[55.97584,44.99353],[55.97584,44.99348],[55.97584,44.99343],[55.97584,44.99338],[55.97584,44.99328],[55.97584,44.99322],[56.00314,41.32584],[57.03423,41.25435],[57.13796,41.36625],[57.03359,41.41777],[56.96218,41.80383],[57.03633,41.92043],[57.30275,42.14076],[57.6296,42.16519],[57.84932,42.18555],[57.92897,42.24047],[57.90975,42.4374],[57.99214,42.50021],[58.3492,42.43335],[58.40688,42.29535],[58.51674,42.30348],[58.29427,42.56497],[58.14321,42.62159],[58.27504,42.69632],[58.57991,42.64988],[58.6266,42.79314],[58.93422,42.5407],[59.17317,42.52248],[59.2955,42.37064],[59.4341,42.29738],[59.94633,42.27655],[60.00539,42.212],[59.96419,42.1428],[60.04659,42.08982],[60.0356,42.01028],[59.95046,41.97966],[60.33223,41.75058],[60.08504,41.80997],[60.06032,41.76287],[60.18117,41.60082],[60.06581,41.4363],[60.5078,41.21694],[61.03261,41.25691],[61.22212,41.14946],[61.33199,41.14946],[61.39732,41.19873],[61.4446,41.29407],[61.87856,41.12257],[62.11751,40.58242],[62.34273,40.43206],[62.43337,39.98528],[63.6913,39.27666],[63.70778,39.22349],[64.19086,38.95561],[64.32576,38.98691],[65.55873,38.29052],[65.83913,38.25733],[66.24013,38.16238],[66.41042,38.02403],[66.56697,38.0435],[66.67684,37.96776],[66.53676,37.80084],[66.52852,37.58568],[66.65761,37.45497],[66.52303,37.39827],[66.55743,37.35409],[66.64699,37.32958],[66.95598,37.40162],[67.08232,37.35469],[67.13039,37.27168],[67.2224,37.24545],[67.2581,37.17216],[67.51868,37.26102],[67.78329,37.1834],[67.8474,37.31594],[67.81566,37.43107],[68.12635,37.93],[68.27159,37.91477],[68.40343,38.19484],[68.13289,38.40822],[68.06274,38.39435],[68.11366,38.47169],[68.05873,38.56087],[68.0807,38.64136],[68.05598,38.71641],[68.12877,38.73677],[68.06948,38.82115],[68.19743,38.85985],[68.09704,39.02589],[67.68915,39.00775],[67.67833,39.14479],[67.33226,39.23739],[67.36522,39.31287],[67.45998,39.315],[67.46822,39.46146],[67.39681,39.52505],[67.46547,39.53564],[67.44899,39.57799],[67.62889,39.60234],[67.70992,39.66156],[68.12053,39.56317],[68.54166,39.53929],[68.61972,39.68905],[68.63071,39.85265],[68.88889,39.87163],[68.93695,39.91167],[68.84906,40.04952],[68.96579,40.06949],[69.01935,40.11466],[69.01523,40.15771],[68.62796,40.07789],[68.52771,40.11676],[68.5332,40.14826],[68.77902,40.20492],[68.79276,40.17555],[68.84357,40.18604],[68.85832,40.20885],[69.04544,40.22904],[69.15659,40.2162],[69.2074,40.21488],[69.30448,40.18774],[69.30104,40.24502],[69.25229,40.26362],[69.24817,40.30357],[69.30808,40.2821],[69.32833,40.29794],[69.33794,40.34819],[69.30774,40.36102],[69.28525,40.41894],[69.27066,40.49274],[69.21063,40.54469],[69.2643,40.57506],[69.3455,40.57988],[69.32834,40.70233],[69.38327,40.7918],[69.53021,40.77621],[69.59441,40.70181],[69.69434,40.62615],[70.36655,40.90296],[70.38028,41.02014],[70.45251,41.04438],[70.80009,40.72825],[70.49871,40.52503],[70.32626,40.45174],[70.37511,40.38605],[70.57149,40.3442],[70.56394,40.26421],[70.62342,40.17396],[70.8607,40.217],[70.9818,40.22392],[70.95789,40.28761],[71.05901,40.28765],[71.13042,40.34106],[71.36663,40.31593],[71.4246,40.28619],[71.51215,40.26943],[71.51549,40.22986],[71.61725,40.20615],[71.61931,40.26775],[71.68386,40.26984],[71.70569,40.20391],[71.69621,40.18492],[71.71719,40.17886],[71.73054,40.14818],[71.82646,40.21872],[71.85002,40.25647],[72.05464,40.27586],[71.96401,40.31907],[72.18648,40.49893],[72.24368,40.46091],[72.40346,40.4007],[72.44191,40.48222],[72.41513,40.50856],[72.38384,40.51535],[72.41714,40.55736],[72.34406,40.60144],[72.40517,40.61917],[72.47795,40.5532],[72.66713,40.5219],[72.66713,40.59076],[72.69579,40.59778],[72.73995,40.58409],[72.74768,40.58051],[72.74862,40.57131],[72.75982,40.57273],[72.74894,40.59592],[72.74866,40.60873],[72.80137,40.67856],[72.84754,40.67229],[72.85372,40.7116],[72.8722,40.71111],[72.93296,40.73089],[72.99133,40.76457],[73.0612,40.76678],[73.13412,40.79122],[73.13267,40.83512],[73.01869,40.84681],[72.94454,40.8094],[72.84291,40.85512],[72.68157,40.84942],[72.59136,40.86947],[72.55109,40.96046],[72.48742,40.97136],[72.45206,41.03018],[72.38511,41.02785],[72.36138,41.04384],[72.34757,41.06104],[72.34026,41.04539],[72.324,41.03381],[72.18339,40.99571],[72.17594,41.02377],[72.21061,41.05607],[72.1792,41.10621],[72.14864,41.13363],[72.17594,41.15522],[72.16433,41.16483],[72.10745,41.15483],[72.07249,41.11739],[71.85964,41.19081],[71.91457,41.2982],[71.83914,41.3546],[71.76625,41.4466],[71.71132,41.43012],[71.73054,41.54713],[71.65914,41.49599],[71.6787,41.42111],[71.57227,41.29175],[71.46688,41.31883],[71.43814,41.19644],[71.46148,41.13958],[71.40198,41.09436],[71.34877,41.16807],[71.27187,41.11015],[71.25813,41.18796],[71.11806,41.15359],[71.02193,41.19494],[70.9615,41.16393],[70.86263,41.23833],[70.77885,41.24813],[70.78572,41.36419],[70.67586,41.47953],[70.48909,41.40335],[70.17682,41.5455],[70.69777,41.92554],[71.28719,42.18033],[71.13263,42.28356],[70.94483,42.26238],[69.49545,41.545],[69.45751,41.56863],[69.39485,41.51518],[69.45081,41.46246],[69.37468,41.46555],[69.35554,41.47211],[69.29778,41.43673],[69.25059,41.46693],[69.23332,41.45847],[69.22671,41.46298],[69.20439,41.45391],[69.18528,41.45175],[69.17701,41.43769],[69.15137,41.43078],[69.05006,41.36183],[69.01308,41.22804],[68.7217,41.05025],[68.73945,40.96989],[68.65662,40.93861],[68.62221,41.03019],[68.49983,40.99669],[68.58444,40.91447],[68.63,40.59358],[68.49983,40.56437],[67.96736,40.83798],[68.1271,41.0324],[68.08273,41.08148],[67.98511,41.02794],[67.9644,41.14611],[66.69129,41.1311],[66.53302,41.87388],[66.00546,41.94455],[66.09482,42.93426],[65.85194,42.85481]],[[70.68112,40.90612],[70.6721,40.90555],[70.57501,40.98941],[70.54223,40.98787],[70.56077,41.00642],[70.6158,40.97661],[70.68112,40.90612]]],[[[71.21139,40.03369],[71.12218,40.03052],[71.06305,40.1771],[71.00236,40.18154],[71.01035,40.05481],[71.11037,40.01984],[71.11668,39.99291],[71.09063,39.99],[71.10501,39.95568],[71.04979,39.89808],[71.10531,39.91354],[71.16101,39.88423],[71.23067,39.93581],[71.1427,39.95026],[71.21139,40.03369]]],[[[71.86463,39.98598],[71.78838,40.01404],[71.71511,39.96348],[71.7504,39.93701],[71.84316,39.95582],[71.86463,39.98598]]]]}},{type:"Feature",properties:{iso1A2:"VA",iso1A3:"VAT",iso1N3:"336",wikidata:"Q237",nameEn:"Vatican City",aliases:["Holy See"],groups:["039","150"],callingCodes:["379","39 06"]},geometry:{type:"MultiPolygon",coordinates:[[[[12.45181,41.90056],[12.45446,41.90028],[12.45435,41.90143],[12.45626,41.90172],[12.45691,41.90125],[12.4577,41.90115],[12.45834,41.90174],[12.45826,41.90281],[12.45755,41.9033],[12.45762,41.9058],[12.45561,41.90629],[12.45543,41.90738],[12.45091,41.90625],[12.44984,41.90545],[12.44815,41.90326],[12.44582,41.90194],[12.44834,41.90095],[12.45181,41.90056]]]]}},{type:"Feature",properties:{iso1A2:"VC",iso1A3:"VCT",iso1N3:"670",wikidata:"Q757",nameEn:"St. Vincent and the Grenadines",aliases:["WV"],groups:["029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",callingCodes:["1 784"]},geometry:{type:"MultiPolygon",coordinates:[[[[-62.64026,12.69984],[-59.94058,12.34011],[-61.69315,14.26451],[-62.64026,12.69984]]]]}},{type:"Feature",properties:{iso1A2:"VE",iso1A3:"VEN",iso1N3:"862",wikidata:"Q717",nameEn:"Venezuela",aliases:["YV"],groups:["005","419","019","UN"],callingCodes:["58"]},geometry:{type:"MultiPolygon",coordinates:[[[[-71.22331,13.01387],[-70.92579,11.96275],[-71.3275,11.85],[-71.9675,11.65536],[-72.24983,11.14138],[-72.4767,11.1117],[-72.88002,10.44309],[-72.98085,9.85253],[-73.36905,9.16636],[-73.02119,9.27584],[-72.94052,9.10663],[-72.77415,9.10165],[-72.65474,8.61428],[-72.4042,8.36513],[-72.36987,8.19976],[-72.35163,8.01163],[-72.39137,8.03534],[-72.47213,7.96106],[-72.48801,7.94329],[-72.48183,7.92909],[-72.47042,7.92306],[-72.45806,7.91141],[-72.46183,7.90682],[-72.44454,7.86031],[-72.46763,7.79518],[-72.47827,7.65604],[-72.45321,7.57232],[-72.47415,7.48928],[-72.43132,7.40034],[-72.19437,7.37034],[-72.04895,7.03837],[-71.82441,7.04314],[-71.44118,7.02116],[-71.42212,7.03854],[-71.37234,7.01588],[-71.03941,6.98163],[-70.7596,7.09799],[-70.10716,6.96516],[-69.41843,6.1072],[-67.60654,6.2891],[-67.4625,6.20625],[-67.43513,5.98835],[-67.58558,5.84537],[-67.63914,5.64963],[-67.59141,5.5369],[-67.83341,5.31104],[-67.85358,4.53249],[-67.62671,3.74303],[-67.50067,3.75812],[-67.30945,3.38393],[-67.85862,2.86727],[-67.85862,2.79173],[-67.65696,2.81691],[-67.21967,2.35778],[-66.85795,1.22998],[-66.28507,.74585],[-65.6727,1.01353],[-65.50158,.92086],[-65.57288,.62856],[-65.11657,1.12046],[-64.38932,1.5125],[-64.34654,1.35569],[-64.08274,1.64792],[-64.06135,1.94722],[-63.39827,2.16098],[-63.39114,2.4317],[-64.0257,2.48156],[-64.02908,2.79797],[-64.48379,3.7879],[-64.84028,4.24665],[-64.72977,4.28931],[-64.57648,4.12576],[-64.14512,4.12932],[-63.99183,3.90172],[-63.86082,3.94796],[-63.70218,3.91417],[-63.67099,4.01731],[-63.50611,3.83592],[-63.42233,3.89995],[-63.4464,3.9693],[-63.21111,3.96219],[-62.98296,3.59935],[-62.7655,3.73099],[-62.74411,4.03331],[-62.57656,4.04754],[-62.44822,4.18621],[-62.13094,4.08309],[-61.54629,4.2822],[-61.48569,4.43149],[-61.29675,4.44216],[-61.31457,4.54167],[-61.15703,4.49839],[-60.98303,4.54167],[-60.86539,4.70512],[-60.5802,4.94312],[-60.73204,5.20931],[-61.4041,5.95304],[-61.15058,6.19558],[-61.20762,6.58174],[-61.13632,6.70922],[-60.54873,6.8631],[-60.39419,6.94847],[-60.28074,7.1162],[-60.44116,7.20817],[-60.54098,7.14804],[-60.63367,7.25061],[-60.59802,7.33194],[-60.71923,7.55817],[-60.64793,7.56877],[-60.51959,7.83373],[-60.38056,7.8302],[-60.02407,8.04557],[-59.97059,8.20791],[-59.83156,8.23261],[-59.80661,8.28906],[-59.85562,8.35213],[-59.98508,8.53046],[-59.54058,8.6862],[-60.89962,9.81445],[-62.08693,10.04435],[-61.62505,11.18974],[-63.73917,11.92623],[-63.19938,16.44103],[-67.89186,12.4116],[-68.01417,11.77722],[-68.33524,11.78151],[-68.99639,11.79035],[-71.22331,13.01387]]]]}},{type:"Feature",properties:{iso1A2:"VG",iso1A3:"VGB",iso1N3:"092",wikidata:"Q25305",nameEn:"British Virgin Islands",country:"GB",groups:["BOTS","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 284"]},geometry:{type:"MultiPolygon",coordinates:[[[[-64.47127,17.55688],[-63.88746,19.15706],[-65.02435,18.73231],[-64.86027,18.39056],[-64.64673,18.36549],[-64.47127,17.55688]]]]}},{type:"Feature",properties:{iso1A2:"VI",iso1A3:"VIR",iso1N3:"850",wikidata:"Q11703",nameEn:"United States Virgin Islands",aliases:["US-VI"],country:"US",groups:["Q1352230","029","003","419","019","UN"],driveSide:"left",roadSpeedUnit:"mph",roadHeightUnit:"ft",callingCodes:["1 340"]},geometry:{type:"MultiPolygon",coordinates:[[[[-65.02435,18.73231],[-65.27974,17.56928],[-64.47127,17.55688],[-64.64673,18.36549],[-64.86027,18.39056],[-65.02435,18.73231]]]]}},{type:"Feature",properties:{iso1A2:"VN",iso1A3:"VNM",iso1N3:"704",wikidata:"Q881",nameEn:"Vietnam",groups:["035","142","UN"],callingCodes:["84"]},geometry:{type:"MultiPolygon",coordinates:[[[[108.10003,21.47338],[108.0569,21.53604],[108.02926,21.54997],[107.97932,21.54503],[107.97383,21.53961],[107.97074,21.54072],[107.96774,21.53601],[107.95232,21.5388],[107.92652,21.58906],[107.90006,21.5905],[107.86114,21.65128],[107.80355,21.66141],[107.66967,21.60787],[107.56537,21.61945],[107.54047,21.5934],[107.49065,21.59774],[107.49532,21.62958],[107.47197,21.6672],[107.41593,21.64839],[107.38636,21.59774],[107.35989,21.60063],[107.35834,21.6672],[107.29296,21.74674],[107.24625,21.7077],[107.20734,21.71493],[107.10771,21.79879],[107.02615,21.81981],[107.00964,21.85948],[107.06101,21.88982],[107.05634,21.92303],[106.99252,21.95191],[106.97228,21.92592],[106.92714,21.93459],[106.9178,21.97357],[106.81038,21.97934],[106.74345,22.00965],[106.72551,21.97923],[106.69276,21.96013],[106.68274,21.99811],[106.70142,22.02409],[106.6983,22.15102],[106.67495,22.1885],[106.69986,22.22309],[106.6516,22.33977],[106.55976,22.34841],[106.57221,22.37],[106.55665,22.46498],[106.58395,22.474],[106.61269,22.60301],[106.65316,22.5757],[106.71698,22.58432],[106.72321,22.63606],[106.76293,22.73491],[106.82404,22.7881],[106.83685,22.8098],[106.81271,22.8226],[106.78422,22.81532],[106.71128,22.85982],[106.71387,22.88296],[106.6734,22.89587],[106.6516,22.86862],[106.60179,22.92884],[106.55976,22.92311],[106.51306,22.94891],[106.49749,22.91164],[106.34961,22.86718],[106.27022,22.87722],[106.19705,22.98475],[106.00179,22.99049],[105.99568,22.94178],[105.90119,22.94168],[105.8726,22.92756],[105.72382,23.06641],[105.57594,23.075],[105.56037,23.16806],[105.49966,23.20669],[105.42805,23.30824],[105.40782,23.28107],[105.32376,23.39684],[105.22569,23.27249],[105.17276,23.28679],[105.11672,23.25247],[105.07002,23.26248],[104.98712,23.19176],[104.96532,23.20463],[104.9486,23.17235],[104.91435,23.18666],[104.87992,23.17141],[104.87382,23.12854],[104.79478,23.12934],[104.8334,23.01484],[104.86765,22.95178],[104.84942,22.93631],[104.77114,22.90017],[104.72755,22.81984],[104.65283,22.83419],[104.60457,22.81841],[104.58122,22.85571],[104.47225,22.75813],[104.35593,22.69353],[104.25683,22.76534],[104.27084,22.8457],[104.11384,22.80363],[104.03734,22.72945],[104.01088,22.51823],[103.99247,22.51958],[103.97384,22.50634],[103.96783,22.51173],[103.96352,22.50584],[103.95191,22.5134],[103.94513,22.52553],[103.93286,22.52703],[103.87904,22.56683],[103.64506,22.79979],[103.56255,22.69499],[103.57812,22.65764],[103.52675,22.59155],[103.43646,22.70648],[103.43179,22.75816],[103.32282,22.8127],[103.28079,22.68063],[103.18895,22.64471],[103.15782,22.59873],[103.17961,22.55705],[103.07843,22.50097],[103.0722,22.44775],[102.9321,22.48659],[102.8636,22.60735],[102.60675,22.73376],[102.57095,22.7036],[102.51802,22.77969],[102.46665,22.77108],[102.42618,22.69212],[102.38415,22.67919],[102.41061,22.64184],[102.25339,22.4607],[102.26428,22.41321],[102.16621,22.43336],[102.14099,22.40092],[102.18712,22.30403],[102.51734,22.02676],[102.49092,21.99002],[102.62301,21.91447],[102.67145,21.65894],[102.74189,21.66713],[102.82115,21.73667],[102.81894,21.83888],[102.85637,21.84501],[102.86077,21.71213],[102.97965,21.74076],[102.98846,21.58936],[102.86297,21.4255],[102.94223,21.46034],[102.88939,21.3107],[102.80794,21.25736],[102.89825,21.24707],[102.97745,21.05821],[103.03469,21.05821],[103.12055,20.89994],[103.21497,20.89832],[103.38032,20.79501],[103.45737,20.82382],[103.68633,20.66324],[103.73478,20.6669],[103.82282,20.8732],[103.98024,20.91531],[104.11121,20.96779],[104.27412,20.91433],[104.63957,20.6653],[104.38199,20.47155],[104.40621,20.3849],[104.47886,20.37459],[104.66158,20.47774],[104.72102,20.40554],[104.62195,20.36633],[104.61315,20.24452],[104.86852,20.14121],[104.91695,20.15567],[104.9874,20.09573],[104.8465,19.91783],[104.8355,19.80395],[104.68359,19.72729],[104.64837,19.62365],[104.53169,19.61743],[104.41281,19.70035],[104.23229,19.70242],[104.06498,19.66926],[104.05617,19.61743],[104.10832,19.51575],[104.06058,19.43484],[103.87125,19.31854],[104.5361,18.97747],[104.64617,18.85668],[105.12829,18.70453],[105.19654,18.64196],[105.1327,18.58355],[105.10408,18.43533],[105.15942,18.38691],[105.38366,18.15315],[105.46292,18.22008],[105.64784,17.96687],[105.60381,17.89356],[105.76612,17.67147],[105.85744,17.63221],[106.09019,17.36399],[106.18991,17.28227],[106.24444,17.24714],[106.29287,17.3018],[106.31929,17.20509],[106.43597,17.01362],[106.50862,16.9673],[106.55045,17.0031],[106.54824,16.92729],[106.51963,16.92097],[106.52183,16.87884],[106.55265,16.86831],[106.55485,16.68704],[106.59013,16.62259],[106.58267,16.6012],[106.61477,16.60713],[106.66052,16.56892],[106.65832,16.47816],[106.74418,16.41904],[106.84104,16.55415],[106.88727,16.52671],[106.88067,16.43594],[106.96638,16.34938],[106.97385,16.30204],[107.02597,16.31132],[107.09091,16.3092],[107.15035,16.26271],[107.14595,16.17816],[107.25822,16.13587],[107.33968,16.05549],[107.44975,16.08511],[107.46296,16.01106],[107.39471,15.88829],[107.34188,15.89464],[107.21419,15.83747],[107.21859,15.74638],[107.27143,15.71459],[107.27583,15.62769],[107.34408,15.62345],[107.3815,15.49832],[107.50699,15.48771],[107.53341,15.40496],[107.62367,15.42193],[107.60605,15.37524],[107.62587,15.2266],[107.58844,15.20111],[107.61926,15.13949],[107.61486,15.0566],[107.46516,15.00982],[107.48277,14.93751],[107.59285,14.87795],[107.51579,14.79282],[107.54361,14.69092],[107.55371,14.628],[107.52102,14.59034],[107.52569,14.54665],[107.48521,14.40346],[107.44941,14.41552],[107.39493,14.32655],[107.40427,14.24509],[107.33577,14.11832],[107.37158,14.07906],[107.35757,14.02319],[107.38247,13.99147],[107.44318,13.99751],[107.46498,13.91593],[107.45252,13.78897],[107.53503,13.73908],[107.61909,13.52577],[107.62843,13.3668],[107.49144,13.01215],[107.49611,12.88926],[107.55993,12.7982],[107.5755,12.52177],[107.55059,12.36824],[107.4463,12.29373],[107.42917,12.24657],[107.34511,12.33327],[107.15831,12.27547],[106.99953,12.08983],[106.92325,12.06548],[106.79405,12.0807],[106.70687,11.96956],[106.4111,11.97413],[106.4687,11.86751],[106.44068,11.86294],[106.44535,11.8279],[106.41577,11.76999],[106.45158,11.68616],[106.44691,11.66787],[106.37219,11.69836],[106.30525,11.67549],[106.26478,11.72122],[106.18539,11.75171],[106.13158,11.73283],[106.06708,11.77761],[106.02038,11.77457],[106.00792,11.7197],[105.95188,11.63738],[105.88962,11.67854],[105.8507,11.66635],[105.80867,11.60536],[105.81645,11.56876],[105.87328,11.55953],[105.88962,11.43605],[105.86782,11.28343],[106.10444,11.07879],[106.1527,11.10476],[106.1757,11.07301],[106.20095,10.97795],[106.14301,10.98176],[106.18539,10.79451],[106.06708,10.8098],[105.94535,10.9168],[105.93403,10.83853],[105.84603,10.85873],[105.86376,10.89839],[105.77751,11.03671],[105.50045,10.94586],[105.42884,10.96878],[105.34011,10.86179],[105.11449,10.96332],[105.08326,10.95656],[105.02722,10.89236],[105.09571,10.72722],[104.95094,10.64003],[104.87933,10.52833],[104.59018,10.53073],[104.49869,10.4057],[104.47963,10.43046],[104.43778,10.42386],[103.99198,10.48391],[102.47649,9.66162],[104.81582,8.03101],[109.55486,8.10026],[111.60491,13.57105],[108.00365,17.98159],[108.10003,21.47338]]]]}},{type:"Feature",properties:{iso1A2:"VU",iso1A3:"VUT",iso1N3:"548",wikidata:"Q686",nameEn:"Vanuatu",groups:["054","009","UN"],callingCodes:["678"]},geometry:{type:"MultiPolygon",coordinates:[[[[156.73836,-14.50464],[174.245,-23.1974],[172.71443,-12.01327],[156.73836,-14.50464]]]]}},{type:"Feature",properties:{iso1A2:"WF",iso1A3:"WLF",iso1N3:"876",wikidata:"Q35555",nameEn:"Wallis and Futuna",country:"FR",groups:["EU","Q1451600","061","009","UN"],callingCodes:["681"]},geometry:{type:"MultiPolygon",coordinates:[[[[-178.66551,-14.32452],[-176.76826,-14.95183],[-175.59809,-12.61507],[-178.66551,-14.32452]]]]}},{type:"Feature",properties:{iso1A2:"WS",iso1A3:"WSM",iso1N3:"882",wikidata:"Q683",nameEn:"Samoa",groups:["061","009","UN"],driveSide:"left",callingCodes:["685"]},geometry:{type:"MultiPolygon",coordinates:[[[[-173.74402,-14.26669],[-170.99605,-15.1275],[-171.39864,-10.21587],[-173.74402,-14.26669]]]]}},{type:"Feature",properties:{iso1A2:"XK",iso1A3:"XKX",wikidata:"Q1246",nameEn:"Kosovo",aliases:["KV"],groups:["039","150"],isoStatus:"usrAssn",callingCodes:["383"]},geometry:{type:"MultiPolygon",coordinates:[[[[21.39045,42.74888],[21.44047,42.87276],[21.36941,42.87397],[21.32974,42.90424],[21.2719,42.8994],[21.23534,42.95523],[21.23877,43.00848],[21.2041,43.02277],[21.16734,42.99694],[21.14465,43.11089],[21.08952,43.13471],[21.05378,43.10707],[21.00749,43.13984],[20.96287,43.12416],[20.83727,43.17842],[20.88685,43.21697],[20.82145,43.26769],[20.73811,43.25068],[20.68688,43.21335],[20.59929,43.20492],[20.69515,43.09641],[20.64557,43.00826],[20.59929,43.01067],[20.48692,42.93208],[20.53484,42.8885],[20.43734,42.83157],[20.40594,42.84853],[20.35692,42.8335],[20.27869,42.81945],[20.2539,42.76245],[20.04898,42.77701],[20.02088,42.74789],[20.02915,42.71147],[20.0969,42.65559],[20.07761,42.55582],[20.17127,42.50469],[20.21797,42.41237],[20.24399,42.32168],[20.34479,42.32656],[20.3819,42.3029],[20.48857,42.25444],[20.56955,42.12097],[20.55633,42.08173],[20.59434,42.03879],[20.63069,41.94913],[20.57946,41.91593],[20.59524,41.8818],[20.68523,41.85318],[20.76786,41.91839],[20.75464,42.05229],[21.11491,42.20794],[21.16614,42.19815],[21.22728,42.08909],[21.31983,42.10993],[21.29913,42.13954],[21.30496,42.1418],[21.38428,42.24465],[21.43882,42.23609],[21.43882,42.2789],[21.50823,42.27156],[21.52145,42.24465],[21.58992,42.25915],[21.56772,42.30946],[21.5264,42.33634],[21.53467,42.36809],[21.57021,42.3647],[21.59029,42.38042],[21.62887,42.37664],[21.64209,42.41081],[21.62556,42.45106],[21.7035,42.51899],[21.70522,42.54176],[21.7327,42.55041],[21.75672,42.62695],[21.79413,42.65923],[21.75025,42.70125],[21.6626,42.67813],[21.58755,42.70418],[21.59154,42.72643],[21.47498,42.74695],[21.39045,42.74888]]]]}},{type:"Feature",properties:{iso1A2:"YE",iso1A3:"YEM",iso1N3:"887",wikidata:"Q805",nameEn:"Yemen",groups:["145","142","UN"],callingCodes:["967"]},geometry:{type:"MultiPolygon",coordinates:[[[[57.49095,8.14549],[52.81185,17.28568],[52.74267,17.29519],[52.78009,17.35124],[52.00311,19.00083],[49.04884,18.59899],[48.19996,18.20584],[47.58351,17.50366],[47.48245,17.10808],[47.00571,16.94765],[46.76494,17.29151],[46.31018,17.20464],[44.50126,17.47475],[43.70631,17.35762],[43.43005,17.56148],[43.29185,17.53224],[43.22533,17.38343],[43.32653,17.31179],[43.20156,17.25901],[43.17787,17.14717],[43.23967,17.03428],[43.18233,17.02673],[43.1813,16.98438],[43.19328,16.94703],[43.1398,16.90696],[43.18338,16.84852],[43.22012,16.83932],[43.22956,16.80613],[43.24801,16.80613],[43.26303,16.79479],[43.25857,16.75304],[43.21325,16.74416],[43.22066,16.65179],[43.15274,16.67248],[43.11601,16.53166],[42.97215,16.51093],[42.94351,16.49467],[42.94625,16.39721],[42.76801,16.40371],[42.15205,16.40211],[40.99158,15.81743],[43.29075,12.79154],[43.32909,12.59711],[43.90659,12.3823],[51.12877,12.56479],[57.49095,8.14549]]]]}},{type:"Feature",properties:{iso1A2:"YT",iso1A3:"MYT",iso1N3:"175",wikidata:"Q17063",nameEn:"Mayotte",country:"FR",groups:["Q3320166","EU","014","202","002","UN"],callingCodes:["262"]},geometry:{type:"MultiPolygon",coordinates:[[[[43.28731,-13.97126],[45.54824,-13.22353],[45.4971,-11.75965],[43.28731,-13.97126]]]]}},{type:"Feature",properties:{iso1A2:"ZA",iso1A3:"ZAF",iso1N3:"710",wikidata:"Q258",nameEn:"South Africa",groups:["018","202","002","UN"],driveSide:"left",callingCodes:["27"]},geometry:{type:"MultiPolygon",coordinates:[[[[31.30611,-22.422],[31.16344,-22.32599],[31.08932,-22.34884],[30.86696,-22.28907],[30.6294,-22.32599],[30.48686,-22.31368],[30.38614,-22.34533],[30.28351,-22.35587],[30.2265,-22.2961],[30.13147,-22.30841],[29.92242,-22.19408],[29.76848,-22.14128],[29.64609,-22.12917],[29.37703,-22.19581],[29.21955,-22.17771],[29.18974,-22.18599],[29.15268,-22.21399],[29.10881,-22.21202],[29.0151,-22.22907],[28.91889,-22.44299],[28.63287,-22.55887],[28.34874,-22.5694],[28.04562,-22.8394],[28.04752,-22.90243],[27.93729,-22.96194],[27.93539,-23.04941],[27.74154,-23.2137],[27.6066,-23.21894],[27.52393,-23.37952],[27.33768,-23.40917],[26.99749,-23.65486],[26.84165,-24.24885],[26.51667,-24.47219],[26.46346,-24.60358],[26.39409,-24.63468],[25.8515,-24.75727],[25.84295,-24.78661],[25.88571,-24.87802],[25.72702,-25.25503],[25.69661,-25.29284],[25.6643,-25.4491],[25.58543,-25.6343],[25.33076,-25.76616],[25.12266,-25.75931],[25.01718,-25.72507],[24.8946,-25.80723],[24.67319,-25.81749],[24.44703,-25.73021],[24.36531,-25.773],[24.18287,-25.62916],[23.9244,-25.64286],[23.47588,-25.29971],[23.03497,-25.29971],[22.86012,-25.50572],[22.70808,-25.99186],[22.56365,-26.19668],[22.41921,-26.23078],[22.21206,-26.3773],[22.06192,-26.61882],[21.90703,-26.66808],[21.83291,-26.65959],[21.77114,-26.69015],[21.7854,-26.79199],[21.69322,-26.86152],[21.37869,-26.82083],[21.13353,-26.86661],[20.87031,-26.80047],[20.68596,-26.9039],[20.63275,-26.78181],[20.61754,-26.4692],[20.86081,-26.14892],[20.64795,-25.47827],[20.29826,-24.94869],[20.03678,-24.81004],[20.02809,-24.78725],[19.99817,-24.76768],[19.99882,-28.42622],[18.99885,-28.89165],[17.4579,-28.68718],[17.15405,-28.08573],[16.90446,-28.057],[16.59922,-28.53246],[16.46592,-28.57126],[16.45332,-28.63117],[12.51595,-32.27486],[38.88176,-48.03306],[34.51034,-26.91792],[32.35222,-26.86027],[32.29584,-26.852],[32.22302,-26.84136],[32.19409,-26.84032],[32.13315,-26.84345],[32.09664,-26.80721],[32.00893,-26.8096],[31.97463,-27.11057],[31.97592,-27.31675],[31.49834,-27.31549],[31.15027,-27.20151],[30.96088,-27.0245],[30.97757,-26.92706],[30.88826,-26.79622],[30.81101,-26.84722],[30.78927,-26.48271],[30.95819,-26.26303],[31.13073,-25.91558],[31.31237,-25.7431],[31.4175,-25.71886],[31.86881,-25.99973],[31.974,-25.95387],[31.92649,-25.84216],[32.00631,-25.65044],[31.97875,-25.46356],[32.01676,-25.38117],[32.03196,-25.10785],[31.9835,-24.29983],[31.90368,-24.18892],[31.87707,-23.95293],[31.77445,-23.90082],[31.70223,-23.72695],[31.67942,-23.60858],[31.56539,-23.47268],[31.55779,-23.176],[31.30611,-22.422]],[[29.33204,-29.45598],[29.28545,-29.58456],[29.12553,-29.76266],[29.16548,-29.91706],[28.9338,-30.05072],[28.80222,-30.10579],[28.68627,-30.12885],[28.399,-30.1592],[28.2319,-30.28476],[28.12073,-30.68072],[27.74814,-30.60635],[27.69467,-30.55862],[27.67819,-30.53437],[27.6521,-30.51707],[27.62137,-30.50509],[27.56781,-30.44562],[27.56901,-30.42504],[27.45452,-30.32239],[27.38108,-30.33456],[27.36649,-30.27246],[27.37293,-30.19401],[27.40778,-30.14577],[27.32555,-30.14785],[27.29603,-30.05473],[27.22719,-30.00718],[27.09489,-29.72796],[27.01016,-29.65439],[27.33464,-29.48161],[27.4358,-29.33465],[27.47254,-29.31968],[27.45125,-29.29708],[27.48679,-29.29349],[27.54258,-29.25575],[27.5158,-29.2261],[27.55974,-29.18954],[27.75458,-28.89839],[27.8907,-28.91612],[27.88933,-28.88156],[27.9392,-28.84864],[27.98675,-28.8787],[28.02503,-28.85991],[28.1317,-28.7293],[28.2348,-28.69471],[28.30518,-28.69531],[28.40612,-28.6215],[28.65091,-28.57025],[28.68043,-28.58744],[29.40524,-29.21246],[29.44883,-29.3772],[29.33204,-29.45598]]]]}},{type:"Feature",properties:{iso1A2:"ZM",iso1A3:"ZMB",iso1N3:"894",wikidata:"Q953",nameEn:"Zambia",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["260"]},geometry:{type:"MultiPolygon",coordinates:[[[[32.95389,-9.40138],[32.76233,-9.31963],[32.75611,-9.28583],[32.53661,-9.24281],[32.49147,-9.14754],[32.43543,-9.11988],[32.25486,-9.13371],[32.16146,-9.05993],[32.08206,-9.04609],[31.98866,-9.07069],[31.94196,-9.02303],[31.94663,-8.93846],[31.81587,-8.88618],[31.71158,-8.91386],[31.57147,-8.81388],[31.57147,-8.70619],[31.37533,-8.60769],[31.00796,-8.58615],[30.79243,-8.27382],[28.88917,-8.4831],[28.9711,-8.66935],[28.38526,-9.23393],[28.36562,-9.30091],[28.52636,-9.35379],[28.51627,-9.44726],[28.56208,-9.49122],[28.68532,-9.78],[28.62795,-9.92942],[28.65032,-10.65133],[28.37241,-11.57848],[28.48357,-11.87532],[29.18592,-12.37921],[29.4992,-12.43843],[29.48404,-12.23604],[29.8139,-12.14898],[29.81551,-13.44683],[29.65078,-13.41844],[29.60531,-13.21685],[29.01918,-13.41353],[28.33199,-12.41375],[27.59932,-12.22123],[27.21025,-11.76157],[27.22541,-11.60323],[27.04351,-11.61312],[26.88687,-12.01868],[26.01777,-11.91488],[25.33058,-11.65767],[25.34069,-11.19707],[24.42612,-11.44975],[24.34528,-11.06816],[24.00027,-10.89356],[24.02603,-11.15368],[23.98804,-12.13149],[24.06672,-12.29058],[23.90937,-12.844],[24.03339,-12.99091],[21.97988,-13.00148],[22.00323,-16.18028],[22.17217,-16.50269],[23.20038,-17.47563],[23.47474,-17.62877],[24.23619,-17.47489],[24.32811,-17.49082],[24.38712,-17.46818],[24.5621,-17.52963],[24.70864,-17.49501],[25.00198,-17.58221],[25.26433,-17.79571],[25.51646,-17.86232],[25.6827,-17.81987],[25.85738,-17.91403],[25.85892,-17.97726],[26.08925,-17.98168],[26.0908,-17.93021],[26.21601,-17.88608],[26.55918,-17.99638],[26.68403,-18.07411],[26.74314,-18.0199],[26.89926,-17.98756],[27.14196,-17.81398],[27.30736,-17.60487],[27.61377,-17.34378],[27.62795,-17.24365],[27.83141,-16.96274],[28.73725,-16.5528],[28.76199,-16.51575],[28.81454,-16.48611],[28.8501,-16.04537],[28.9243,-15.93987],[29.01298,-15.93805],[29.21955,-15.76589],[29.4437,-15.68702],[29.8317,-15.6126],[30.35574,-15.6513],[30.41902,-15.62269],[30.22098,-14.99447],[33.24249,-14.00019],[33.16749,-13.93992],[33.07568,-13.98447],[33.02977,-14.05022],[32.99042,-13.95689],[32.88985,-13.82956],[32.79015,-13.80755],[32.76962,-13.77224],[32.84528,-13.71576],[32.7828,-13.64805],[32.68654,-13.64268],[32.66468,-13.60019],[32.68436,-13.55769],[32.73683,-13.57682],[32.84176,-13.52794],[32.86113,-13.47292],[33.0078,-13.19492],[32.98289,-13.12671],[33.02181,-12.88707],[32.96733,-12.88251],[32.94397,-12.76868],[33.05917,-12.59554],[33.18837,-12.61377],[33.28177,-12.54692],[33.37517,-12.54085],[33.54485,-12.35996],[33.47636,-12.32498],[33.3705,-12.34931],[33.25998,-12.14242],[33.33937,-11.91252],[33.32692,-11.59248],[33.24252,-11.59302],[33.23663,-11.40637],[33.29267,-11.43536],[33.29267,-11.3789],[33.39697,-11.15296],[33.25998,-10.88862],[33.28022,-10.84428],[33.47636,-10.78465],[33.70675,-10.56896],[33.54797,-10.36077],[33.53863,-10.20148],[33.31297,-10.05133],[33.37902,-9.9104],[33.36581,-9.81063],[33.31517,-9.82364],[33.2095,-9.61099],[33.12144,-9.58929],[33.10163,-9.66525],[33.05485,-9.61316],[33.00256,-9.63053],[33.00476,-9.5133],[32.95389,-9.40138]]]]}},{type:"Feature",properties:{iso1A2:"ZW",iso1A3:"ZWE",iso1N3:"716",wikidata:"Q954",nameEn:"Zimbabwe",groups:["014","202","002","UN"],driveSide:"left",callingCodes:["263"]},geometry:{type:"MultiPolygon",coordinates:[[[[30.41902,-15.62269],[30.35574,-15.6513],[29.8317,-15.6126],[29.4437,-15.68702],[29.21955,-15.76589],[29.01298,-15.93805],[28.9243,-15.93987],[28.8501,-16.04537],[28.81454,-16.48611],[28.76199,-16.51575],[28.73725,-16.5528],[27.83141,-16.96274],[27.62795,-17.24365],[27.61377,-17.34378],[27.30736,-17.60487],[27.14196,-17.81398],[26.89926,-17.98756],[26.74314,-18.0199],[26.68403,-18.07411],[26.55918,-17.99638],[26.21601,-17.88608],[26.0908,-17.93021],[26.08925,-17.98168],[25.85892,-17.97726],[25.85738,-17.91403],[25.6827,-17.81987],[25.51646,-17.86232],[25.26433,-17.79571],[25.23909,-17.90832],[25.31799,-18.07091],[25.39972,-18.12691],[25.53465,-18.39041],[25.68859,-18.56165],[25.79217,-18.6355],[25.82353,-18.82808],[25.94326,-18.90362],[25.99837,-19.02943],[25.96226,-19.08152],[26.17227,-19.53709],[26.72246,-19.92707],[27.21278,-20.08244],[27.29831,-20.28935],[27.28865,-20.49873],[27.69361,-20.48531],[27.72972,-20.51735],[27.69171,-21.08409],[27.91407,-21.31621],[28.01669,-21.57624],[28.29416,-21.59037],[28.49942,-21.66634],[28.58114,-21.63455],[29.07763,-21.81877],[29.04023,-21.85864],[29.02191,-21.90647],[29.02191,-21.95665],[29.04108,-22.00563],[29.08495,-22.04867],[29.14501,-22.07275],[29.1974,-22.07472],[29.24648,-22.05967],[29.3533,-22.18363],[29.37703,-22.19581],[29.64609,-22.12917],[29.76848,-22.14128],[29.92242,-22.19408],[30.13147,-22.30841],[30.2265,-22.2961],[30.28351,-22.35587],[30.38614,-22.34533],[30.48686,-22.31368],[30.6294,-22.32599],[30.86696,-22.28907],[31.08932,-22.34884],[31.16344,-22.32599],[31.30611,-22.422],[31.38336,-22.36919],[32.41234,-21.31246],[32.48236,-21.32873],[32.37115,-21.133],[32.51644,-20.91929],[32.48122,-20.63319],[32.55167,-20.56312],[32.66174,-20.56106],[32.85987,-20.27841],[32.85987,-20.16686],[32.93032,-20.03868],[33.01178,-20.02007],[33.06461,-19.77787],[32.95013,-19.67219],[32.84666,-19.68462],[32.84446,-19.48343],[32.78282,-19.47513],[32.77966,-19.36098],[32.85107,-19.29238],[32.87088,-19.09279],[32.84006,-19.0262],[32.72118,-19.02204],[32.69917,-18.94293],[32.73439,-18.92628],[32.70137,-18.84712],[32.82465,-18.77419],[32.9017,-18.7992],[32.95013,-18.69079],[32.88629,-18.58023],[32.88629,-18.51344],[33.02278,-18.4696],[33.03159,-18.35054],[32.94133,-17.99705],[33.0492,-17.60298],[32.98536,-17.55891],[32.96554,-17.48964],[33.0426,-17.3468],[33.00517,-17.30477],[32.96554,-17.11971],[32.84113,-16.92259],[32.91051,-16.89446],[32.97655,-16.70689],[32.78943,-16.70267],[32.69917,-16.66893],[32.71017,-16.59932],[32.42838,-16.4727],[32.28529,-16.43892],[32.02772,-16.43892],[31.91324,-16.41569],[31.90223,-16.34388],[31.67988,-16.19595],[31.42451,-16.15154],[31.30563,-16.01193],[31.13171,-15.98019],[30.97761,-16.05848],[30.91597,-15.99924],[30.42568,-15.9962],[30.41902,-15.62269]]]]}}]},$ne=Gne,MI={},Lr={},zne=/(?=(?!^(and|the|of|el|la|de)$))(\b(and|the|of|el|la|de)\b)|[-_ .,'()&[\]/]/gi;function Zz(n){let e=n||"";return e.charAt(0)==="."?e.toUpperCase():e.replace(zne,"").toUpperCase()}var Ga=["subterritory","territory","subcountryGroup","country","sharedLandform","intermediateRegion","subregion","region","subunion","union","unitedNations","world"];Hne($ne);function Hne(n){let e=["iso1A2","iso1A3","m49","wikidata","emojiFlag","ccTLD","nameEn"],t=[];for(let y of n.features){let x=y.properties;x.id=x.iso1A2||x.m49||x.wikidata,s(y),o(y),a(y),l(y),i(y),p(y),g(y),y.geometry&&t.push(y)}for(let y of n.features)y.properties.groups=y.properties.groups.map(x=>Lr[x].properties.id),m(y);for(let y of n.features)u(y),d(y),f(y),h(y),c(y);for(let y of n.features)y.properties.groups.sort((x,b)=>Ga.indexOf(Lr[x].properties.level)-Ga.indexOf(Lr[b].properties.level)),y.properties.members&&y.properties.members.sort((x,b)=>{let _=Ga.indexOf(Lr[x].properties.level)-Ga.indexOf(Lr[b].properties.level);return _===0?n.features.indexOf(Lr[x])-n.features.indexOf(Lr[b]):_});MI=(0,Qz.default)({type:"FeatureCollection",features:t});function i(y){let x=y.properties;x.groups||(x.groups=[]),y.geometry&&x.country&&x.groups.push(x.country),x.m49!=="001"&&x.groups.push("001")}function s(y){let x=y.properties;!x.m49&&x.iso1N3&&(x.m49=x.iso1N3)}function o(y){let x=y.properties;x.level!=="unitedNations"&&x.ccTLD!==null&&!x.ccTLD&&x.iso1A2&&(x.ccTLD="."+x.iso1A2.toLowerCase())}function a(y){let x=y.properties;!x.isoStatus&&x.iso1A2&&(x.isoStatus="official")}function l(y){let x=y.properties;x.level||(x.country?!x.iso1A2||x.isoStatus==="official"?x.level="territory":x.level="subterritory":x.level="country")}function c(y){let x=y.properties;if(y.geometry||!x.members)return;let b=Ga.indexOf(x.level),_=[];x.members.forEach((S,C)=>{let v=Lr[S].properties.groups.filter(w=>w!==y.properties.id&&b<Ga.indexOf(Lr[w].properties.level));C===0?_=v:_=_.filter(w=>v.indexOf(w)!==-1)}),x.groups=x.groups.concat(_.filter(S=>x.groups.indexOf(S)===-1));for(let S of _){let C=Lr[S];C.properties.members.indexOf(x.id)===-1&&C.properties.members.push(x.id)}}function u(y){let x=y.properties;if(y.geometry)x.roadSpeedUnit||(x.roadSpeedUnit="km/h");else if(x.members){let b=Array.from(new Set(x.members.map(_=>{let S=Lr[_];if(S.geometry)return S.properties.roadSpeedUnit||"km/h"}).filter(Boolean)));b.length===1&&(x.roadSpeedUnit=b[0])}}function d(y){let x=y.properties;if(y.geometry)x.roadHeightUnit||(x.roadHeightUnit="m");else if(x.members){let b=Array.from(new Set(x.members.map(_=>{let S=Lr[_];if(S.geometry)return S.properties.roadHeightUnit||"m"}).filter(Boolean)));b.length===1&&(x.roadHeightUnit=b[0])}}function f(y){let x=y.properties;if(y.geometry)x.driveSide||(x.driveSide="right");else if(x.members){let b=Array.from(new Set(x.members.map(_=>{let S=Lr[_];if(S.geometry)return S.properties.driveSide||"right"}).filter(Boolean)));b.length===1&&(x.driveSide=b[0])}}function h(y){let x=y.properties;!y.geometry&&x.members&&(x.callingCodes=Array.from(new Set(x.members.reduce((b,_)=>{let S=Lr[_];return S.geometry&&S.properties.callingCodes?b.concat(S.properties.callingCodes):b},[]))))}function p(y){if(!y.properties.iso1A2)return;let x=y.properties.iso1A2.replace(/./g,function(b){return String.fromCodePoint(b.charCodeAt(0)+127397)});y.properties.emojiFlag=x}function m(y){for(let x of y.properties.groups){let b=Lr[x];b.properties.members||(b.properties.members=[]),b.properties.members.push(y.properties.id)}}function g(y){let x=[];for(let b of e){let _=y.properties[b];_&&x.push(_)}for(let b of y.properties.aliases||[])x.push(b);for(let b of x){let _=Zz(b);Lr[_]=y}}}function Wne(n){return Array.isArray(n)?n:n.coordinates?n.coordinates:n.geometry.coordinates}function Jz(n){let e=Wne(n),t=MI(e);return t?Lr[t.id]:null}function Vne(n){let e=Jz(n);if(!e)return null;let t=e.properties.country||e.properties.iso1A2;return Lr[t]||null}var eH={level:void 0,maxLevel:void 0,withProp:void 0};function jne(n,e){let t=e.level||"country",r=e.maxLevel||"world",i=e.withProp,s=Ga.indexOf(t);if(s===-1)return null;let o=Ga.indexOf(r);if(o===-1||o<s)return null;if(t==="country"){let c=Vne(n);if(c&&(!i||c.properties[i]))return c}return qne(n).find(c=>{let u=Ga.indexOf(c.properties.level);return(c.properties.level===t||u>s&&u<=o)&&(!i||c.properties[i])?c:!1})||null}function RI(n){let e;return typeof n=="number"?(e=n.toString(),e.length===1?e="00"+e:e.length===2&&(e="0"+e)):e=Zz(n),Lr[e]||null}function Xne(n){return MI.bbox(n).map(e=>Lr[e.id])}function tH(n){return typeof n=="object"?Jz(n):RI(n)}function Dp(n,e=eH){return typeof n=="object"?jne(n,e):RI(n)}function fc(n,e=eH){e.withProp="iso1A2";let t=Dp(n,e);return t&&t.properties.iso1A2||null}function qne(n,e){let t;if(Array.isArray(n)&&n.length===4)t=Xne(n);else{let i=tH(n);t=i?[i]:[]}if(!t.length)return[];let r;!e||typeof n=="object"?r=t.slice():r=[];for(let i of t){let s=i.properties;for(let o of s.groups){let a=Lr[o];r.indexOf(a)===-1&&r.push(a)}}return r}function Yne(n,e){let t=RI(n);if(!t)return[];let r=[];e||r.push(t);let i=t.properties;for(let s of i.members||[])r.push(Lr[s]);return r}function rH(n){let e=Yne(n,!1);if(e.length===0)return null;let t=[];for(let r of e)r.geometry?.type==="MultiPolygon"&&r.geometry.coordinates&&(t=t.concat(r.geometry.coordinates));return{type:"Feature",properties:e[0].properties,geometry:{type:"MultiPolygon",coordinates:t}}}function nH(n){let e=tH(n);return e&&e.properties.roadSpeedUnit||null}var Qne=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,FI=Math.ceil,Is=Math.floor,Mi="[BigNumber Error] ",iH=Mi+"Number primitive has more than 15 significant digits: ",lo=1e14,lt=14,BI=9007199254740991,NI=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],hc=1e7,pn=1e9;function sH(n){var e,t,r,i=x.prototype={constructor:x,toString:null,valueOf:null},s=new x(1),o=20,a=4,l=-7,c=21,u=-1e7,d=1e7,f=!1,h=1,p=0,m={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},g="0123456789abcdefghijklmnopqrstuvwxyz",y=!0;function x(v,w){var A,E,I,M,T,R,P,D,N=this;if(!(N instanceof x))return new x(v,w);if(w==null){if(v&&v._isBigNumber===!0){N.s=v.s,!v.c||v.e>d?N.c=N.e=null:v.e<u?N.c=[N.e=0]:(N.e=v.e,N.c=v.c.slice());return}if((R=typeof v=="number")&&v*0==0){if(N.s=1/v<0?(v=-v,-1):1,v===~~v){for(M=0,T=v;T>=10;T/=10,M++);M>d?N.c=N.e=null:(N.e=M,N.c=[v]);return}D=String(v)}else{if(!Qne.test(D=String(v)))return r(N,D,R);N.s=D.charCodeAt(0)==45?(D=D.slice(1),-1):1}(M=D.indexOf("."))>-1&&(D=D.replace(".","")),(T=D.search(/e/i))>0?(M<0&&(M=T),M+=+D.slice(T+1),D=D.substring(0,T)):M<0&&(M=D.length)}else{if(Tr(w,2,g.length,"Base"),w==10&&y)return N=new x(v),C(N,o+N.e+1,a);if(D=String(v),R=typeof v=="number"){if(v*0!=0)return r(N,D,R,w);if(N.s=1/v<0?(D=D.slice(1),-1):1,x.DEBUG&&D.replace(/^0\.0*|\./,"").length>15)throw Error(iH+v)}else N.s=D.charCodeAt(0)===45?(D=D.slice(1),-1):1;for(A=g.slice(0,w),M=T=0,P=D.length;T<P;T++)if(A.indexOf(E=D.charAt(T))<0){if(E=="."){if(T>M){M=P;continue}}else if(!I&&(D==D.toUpperCase()&&(D=D.toLowerCase())||D==D.toLowerCase()&&(D=D.toUpperCase()))){I=!0,T=-1,M=0;continue}return r(N,String(v),R,w)}R=!1,D=t(D,w,10,N.s),(M=D.indexOf("."))>-1?D=D.replace(".",""):M=D.length}for(T=0;D.charCodeAt(T)===48;T++);for(P=D.length;D.charCodeAt(--P)===48;);if(D=D.slice(T,++P)){if(P-=T,R&&x.DEBUG&&P>15&&(v>BI||v!==Is(v)))throw Error(iH+N.s*v);if((M=M-T-1)>d)N.c=N.e=null;else if(M<u)N.c=[N.e=0];else{if(N.e=M,N.c=[],T=(M+1)%lt,M<0&&(T+=lt),T<P){for(T&&N.c.push(+D.slice(0,T)),P-=lt;T<P;)N.c.push(+D.slice(T,T+=lt));T=lt-(D=D.slice(T)).length}else T-=P;for(;T--;D+="0");N.c.push(+D)}}else N.c=[N.e=0]}x.clone=sH,x.ROUND_UP=0,x.ROUND_DOWN=1,x.ROUND_CEIL=2,x.ROUND_FLOOR=3,x.ROUND_HALF_UP=4,x.ROUND_HALF_DOWN=5,x.ROUND_HALF_EVEN=6,x.ROUND_HALF_CEIL=7,x.ROUND_HALF_FLOOR=8,x.EUCLID=9,x.config=x.set=function(v){var w,A;if(v!=null)if(typeof v=="object"){if(v.hasOwnProperty(w="DECIMAL_PLACES")&&(A=v[w],Tr(A,0,pn,w),o=A),v.hasOwnProperty(w="ROUNDING_MODE")&&(A=v[w],Tr(A,0,8,w),a=A),v.hasOwnProperty(w="EXPONENTIAL_AT")&&(A=v[w],A&&A.pop?(Tr(A[0],-pn,0,w),Tr(A[1],0,pn,w),l=A[0],c=A[1]):(Tr(A,-pn,pn,w),l=-(c=A<0?-A:A))),v.hasOwnProperty(w="RANGE"))if(A=v[w],A&&A.pop)Tr(A[0],-pn,-1,w),Tr(A[1],1,pn,w),u=A[0],d=A[1];else if(Tr(A,-pn,pn,w),A)u=-(d=A<0?-A:A);else throw Error(Mi+w+" cannot be zero: "+A);if(v.hasOwnProperty(w="CRYPTO"))if(A=v[w],A===!!A)if(A)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))f=A;else throw f=!A,Error(Mi+"crypto unavailable");else f=A;else throw Error(Mi+w+" not true or false: "+A);if(v.hasOwnProperty(w="MODULO_MODE")&&(A=v[w],Tr(A,0,9,w),h=A),v.hasOwnProperty(w="POW_PRECISION")&&(A=v[w],Tr(A,0,pn,w),p=A),v.hasOwnProperty(w="FORMAT"))if(A=v[w],typeof A=="object")m=A;else throw Error(Mi+w+" not an object: "+A);if(v.hasOwnProperty(w="ALPHABET"))if(A=v[w],typeof A=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(A))y=A.slice(0,10)=="0123456789",g=A;else throw Error(Mi+w+" invalid: "+A)}else throw Error(Mi+"Object expected: "+v);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[l,c],RANGE:[u,d],CRYPTO:f,MODULO_MODE:h,POW_PRECISION:p,FORMAT:m,ALPHABET:g}},x.isBigNumber=function(v){if(!v||v._isBigNumber!==!0)return!1;if(!x.DEBUG)return!0;var w,A,E=v.c,I=v.e,M=v.s;e:if({}.toString.call(E)=="[object Array]"){if((M===1||M===-1)&&I>=-pn&&I<=pn&&I===Is(I)){if(E[0]===0){if(I===0&&E.length===1)return!0;break e}if(w=(I+1)%lt,w<1&&(w+=lt),String(E[0]).length==w){for(w=0;w<E.length;w++)if(A=E[w],A<0||A>=lo||A!==Is(A))break e;if(A!==0)return!0}}}else if(E===null&&I===null&&(M===null||M===1||M===-1))return!0;throw Error(Mi+"Invalid BigNumber: "+v)},x.maximum=x.max=function(){return _(arguments,-1)},x.minimum=x.min=function(){return _(arguments,1)},x.random=function(){var v=9007199254740992,w=Math.random()*v&2097151?function(){return Is(Math.random()*v)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(A){var E,I,M,T,R,P=0,D=[],N=new x(s);if(A==null?A=o:Tr(A,0,pn),T=FI(A/lt),f)if(crypto.getRandomValues){for(E=crypto.getRandomValues(new Uint32Array(T*=2));P<T;)R=E[P]*131072+(E[P+1]>>>11),R>=9e15?(I=crypto.getRandomValues(new Uint32Array(2)),E[P]=I[0],E[P+1]=I[1]):(D.push(R%1e14),P+=2);P=T/2}else if(crypto.randomBytes){for(E=crypto.randomBytes(T*=7);P<T;)R=(E[P]&31)*281474976710656+E[P+1]*1099511627776+E[P+2]*4294967296+E[P+3]*16777216+(E[P+4]<<16)+(E[P+5]<<8)+E[P+6],R>=9e15?crypto.randomBytes(7).copy(E,P):(D.push(R%1e14),P+=7);P=T/7}else throw f=!1,Error(Mi+"crypto unavailable");if(!f)for(;P<T;)R=w(),R<9e15&&(D[P++]=R%1e14);for(T=D[--P],A%=lt,T&&A&&(R=NI[lt-A],D[P]=Is(T/R)*R);D[P]===0;D.pop(),P--);if(P<0)D=[M=0];else{for(M=-1;D[0]===0;D.splice(0,1),M-=lt);for(P=1,R=D[0];R>=10;R/=10,P++);P<lt&&(M-=lt-P)}return N.e=M,N.c=D,N}}(),x.sum=function(){for(var v=1,w=arguments,A=new x(w[0]);v<w.length;)A=A.plus(w[v++]);return A},t=function(){var v="0123456789";function w(A,E,I,M){for(var T,R=[0],P,D=0,N=A.length;D<N;){for(P=R.length;P--;R[P]*=E);for(R[0]+=M.indexOf(A.charAt(D++)),T=0;T<R.length;T++)R[T]>I-1&&(R[T+1]==null&&(R[T+1]=0),R[T+1]+=R[T]/I|0,R[T]%=I)}return R.reverse()}return function(A,E,I,M,T){var R,P,D,N,F,B,O,G,U=A.indexOf("."),W=o,V=a;for(U>=0&&(N=p,p=0,A=A.replace(".",""),G=new x(E),B=G.pow(A.length-U),p=N,G.c=w($a(ks(B.c),B.e,"0"),10,I,v),G.e=G.c.length),O=w(A,E,I,T?(R=g,v):(R=v,g)),D=N=O.length;O[--N]==0;O.pop());if(!O[0])return R.charAt(0);if(U<0?--D:(B.c=O,B.e=D,B.s=M,B=e(B,G,W,V,I),O=B.c,F=B.r,D=B.e),P=D+W+1,U=O[P],N=I/2,F=F||P<0||O[P+1]!=null,F=V<4?(U!=null||F)&&(V==0||V==(B.s<0?3:2)):U>N||U==N&&(V==4||F||V==6&&O[P-1]&1||V==(B.s<0?8:7)),P<1||!O[0])A=F?$a(R.charAt(1),-W,R.charAt(0)):R.charAt(0);else{if(O.length=P,F)for(--I;++O[--P]>I;)O[P]=0,P||(++D,O=[1].concat(O));for(N=O.length;!O[--N];);for(U=0,A="";U<=N;A+=R.charAt(O[U++]));A=$a(A,D,R.charAt(0))}return A}}(),e=function(){function v(E,I,M){var T,R,P,D,N=0,F=E.length,B=I%hc,O=I/hc|0;for(E=E.slice();F--;)P=E[F]%hc,D=E[F]/hc|0,T=O*P+D*B,R=B*P+T%hc*hc+N,N=(R/M|0)+(T/hc|0)+O*D,E[F]=R%M;return N&&(E=[N].concat(E)),E}function w(E,I,M,T){var R,P;if(M!=T)P=M>T?1:-1;else for(R=P=0;R<M;R++)if(E[R]!=I[R]){P=E[R]>I[R]?1:-1;break}return P}function A(E,I,M,T){for(var R=0;M--;)E[M]-=R,R=E[M]<I[M]?1:0,E[M]=R*T+E[M]-I[M];for(;!E[0]&&E.length>1;E.splice(0,1));}return function(E,I,M,T,R){var P,D,N,F,B,O,G,U,W,V,j,Z,Y,K,ne,ie,q,se=E.s==I.s?1:-1,te=E.c,Q=I.c;if(!te||!te[0]||!Q||!Q[0])return new x(!E.s||!I.s||(te?Q&&te[0]==Q[0]:!Q)?NaN:te&&te[0]==0||!Q?se*0:se/0);for(U=new x(se),W=U.c=[],D=E.e-I.e,se=M+D+1,R||(R=lo,D=Ps(E.e/lt)-Ps(I.e/lt),se=se/lt|0),N=0;Q[N]==(te[N]||0);N++);if(Q[N]>(te[N]||0)&&D--,se<0)W.push(1),F=!0;else{for(K=te.length,ie=Q.length,N=0,se+=2,B=Is(R/(Q[0]+1)),B>1&&(Q=v(Q,B,R),te=v(te,B,R),ie=Q.length,K=te.length),Y=ie,V=te.slice(0,ie),j=V.length;j<ie;V[j++]=0);q=Q.slice(),q=[0].concat(q),ne=Q[0],Q[1]>=R/2&&ne++;do{if(B=0,P=w(Q,V,ie,j),P<0){if(Z=V[0],ie!=j&&(Z=Z*R+(V[1]||0)),B=Is(Z/ne),B>1)for(B>=R&&(B=R-1),O=v(Q,B,R),G=O.length,j=V.length;w(O,V,G,j)==1;)B--,A(O,ie<G?q:Q,G,R),G=O.length,P=1;else B==0&&(P=B=1),O=Q.slice(),G=O.length;if(G<j&&(O=[0].concat(O)),A(V,O,j,R),j=V.length,P==-1)for(;w(Q,V,ie,j)<1;)B++,A(V,ie<j?q:Q,j,R),j=V.length}else P===0&&(B++,V=[0]);W[N++]=B,V[0]?V[j++]=te[Y]||0:(V=[te[Y]],j=1)}while((Y++<K||V[0]!=null)&&se--);F=V[0]!=null,W[0]||W.splice(0,1)}if(R==lo){for(N=1,se=W[0];se>=10;se/=10,N++);C(U,M+(U.e=N+D*lt-1)+1,T,F)}else U.e=D,U.r=+F;return U}}();function b(v,w,A,E){var I,M,T,R,P;if(A==null?A=a:Tr(A,0,8),!v.c)return v.toString();if(I=v.c[0],T=v.e,w==null)P=ks(v.c),P=E==1||E==2&&(T<=l||T>=c)?Tb(P,T):$a(P,T,"0");else if(v=C(new x(v),w,A),M=v.e,P=ks(v.c),R=P.length,E==1||E==2&&(w<=M||M<=l)){for(;R<w;P+="0",R++);P=Tb(P,M)}else if(w-=T,P=$a(P,M,"0"),M+1>R){if(--w>0)for(P+=".";w--;P+="0");}else if(w+=M-R,w>0)for(M+1==R&&(P+=".");w--;P+="0");return v.s<0&&I?"-"+P:P}function _(v,w){for(var A,E,I=1,M=new x(v[0]);I<v.length;I++)E=new x(v[I]),(!E.s||(A=D1(M,E))===w||A===0&&M.s===w)&&(M=E);return M}function S(v,w,A){for(var E=1,I=w.length;!w[--I];w.pop());for(I=w[0];I>=10;I/=10,E++);return(A=E+A*lt-1)>d?v.c=v.e=null:A<u?v.c=[v.e=0]:(v.e=A,v.c=w),v}r=function(){var v=/^(-?)0([xbo])(?=\w[\w.]*$)/i,w=/^([^.]+)\.$/,A=/^\.([^.]+)$/,E=/^-?(Infinity|NaN)$/,I=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(M,T,R,P){var D,N=R?T:T.replace(I,"");if(E.test(N))M.s=isNaN(N)?null:N<0?-1:1;else{if(!R&&(N=N.replace(v,function(F,B,O){return D=(O=O.toLowerCase())=="x"?16:O=="b"?2:8,!P||P==D?B:F}),P&&(D=P,N=N.replace(w,"$1").replace(A,"0.$1")),T!=N))return new x(N,D);if(x.DEBUG)throw Error(Mi+"Not a"+(P?" base "+P:"")+" number: "+T);M.s=null}M.c=M.e=null}}();function C(v,w,A,E){var I,M,T,R,P,D,N,F=v.c,B=NI;if(F){e:{for(I=1,R=F[0];R>=10;R/=10,I++);if(M=w-I,M<0)M+=lt,T=w,P=F[D=0],N=Is(P/B[I-T-1]%10);else if(D=FI((M+1)/lt),D>=F.length)if(E){for(;F.length<=D;F.push(0));P=N=0,I=1,M%=lt,T=M-lt+1}else break e;else{for(P=R=F[D],I=1;R>=10;R/=10,I++);M%=lt,T=M-lt+I,N=T<0?0:Is(P/B[I-T-1]%10)}if(E=E||w<0||F[D+1]!=null||(T<0?P:P%B[I-T-1]),E=A<4?(N||E)&&(A==0||A==(v.s<0?3:2)):N>5||N==5&&(A==4||E||A==6&&(M>0?T>0?P/B[I-T]:0:F[D-1])%10&1||A==(v.s<0?8:7)),w<1||!F[0])return F.length=0,E?(w-=v.e+1,F[0]=B[(lt-w%lt)%lt],v.e=-w||0):F[0]=v.e=0,v;if(M==0?(F.length=D,R=1,D--):(F.length=D+1,R=B[lt-M],F[D]=T>0?Is(P/B[I-T]%B[T])*R:0),E)for(;;)if(D==0){for(M=1,T=F[0];T>=10;T/=10,M++);for(T=F[0]+=R,R=1;T>=10;T/=10,R++);M!=R&&(v.e++,F[0]==lo&&(F[0]=1));break}else{if(F[D]+=R,F[D]!=lo)break;F[D--]=0,R=1}for(M=F.length;F[--M]===0;F.pop());}v.e>d?v.c=v.e=null:v.e<u&&(v.c=[v.e=0])}return v}function k(v){var w,A=v.e;return A===null?v.toString():(w=ks(v.c),w=A<=l||A>=c?Tb(w,A):$a(w,A,"0"),v.s<0?"-"+w:w)}return i.absoluteValue=i.abs=function(){var v=new x(this);return v.s<0&&(v.s=1),v},i.comparedTo=function(v,w){return D1(this,new x(v,w))},i.decimalPlaces=i.dp=function(v,w){var A,E,I,M=this;if(v!=null)return Tr(v,0,pn),w==null?w=a:Tr(w,0,8),C(new x(M),v+M.e+1,w);if(!(A=M.c))return null;if(E=((I=A.length-1)-Ps(this.e/lt))*lt,I=A[I])for(;I%10==0;I/=10,E--);return E<0&&(E=0),E},i.dividedBy=i.div=function(v,w){return e(this,new x(v,w),o,a)},i.dividedToIntegerBy=i.idiv=function(v,w){return e(this,new x(v,w),0,1)},i.exponentiatedBy=i.pow=function(v,w){var A,E,I,M,T,R,P,D,N,F=this;if(v=new x(v),v.c&&!v.isInteger())throw Error(Mi+"Exponent not an integer: "+k(v));if(w!=null&&(w=new x(w)),R=v.e>14,!F.c||!F.c[0]||F.c[0]==1&&!F.e&&F.c.length==1||!v.c||!v.c[0])return N=new x(Math.pow(+k(F),R?v.s*(2-Eb(v)):+k(v))),w?N.mod(w):N;if(P=v.s<0,w){if(w.c?!w.c[0]:!w.s)return new x(NaN);E=!P&&F.isInteger()&&w.isInteger(),E&&(F=F.mod(w))}else{if(v.e>9&&(F.e>0||F.e<-1||(F.e==0?F.c[0]>1||R&&F.c[1]>=24e7:F.c[0]<8e13||R&&F.c[0]<=9999975e7)))return M=F.s<0&&Eb(v)?-0:0,F.e>-1&&(M=1/M),new x(P?1/M:M);p&&(M=FI(p/lt+2))}for(R?(A=new x(.5),P&&(v.s=1),D=Eb(v)):(I=Math.abs(+k(v)),D=I%2),N=new x(s);;){if(D){if(N=N.times(F),!N.c)break;M?N.c.length>M&&(N.c.length=M):E&&(N=N.mod(w))}if(I){if(I=Is(I/2),I===0)break;D=I%2}else if(v=v.times(A),C(v,v.e+1,1),v.e>14)D=Eb(v);else{if(I=+k(v),I===0)break;D=I%2}F=F.times(F),M?F.c&&F.c.length>M&&(F.c.length=M):E&&(F=F.mod(w))}return E?N:(P&&(N=s.div(N)),w?N.mod(w):M?C(N,p,a,T):N)},i.integerValue=function(v){var w=new x(this);return v==null?v=a:Tr(v,0,8),C(w,w.e+1,v)},i.isEqualTo=i.eq=function(v,w){return D1(this,new x(v,w))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(v,w){return D1(this,new x(v,w))>0},i.isGreaterThanOrEqualTo=i.gte=function(v,w){return(w=D1(this,new x(v,w)))===1||w===0},i.isInteger=function(){return!!this.c&&Ps(this.e/lt)>this.c.length-2},i.isLessThan=i.lt=function(v,w){return D1(this,new x(v,w))<0},i.isLessThanOrEqualTo=i.lte=function(v,w){return(w=D1(this,new x(v,w)))===-1||w===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(v,w){var A,E,I,M,T=this,R=T.s;if(v=new x(v,w),w=v.s,!R||!w)return new x(NaN);if(R!=w)return v.s=-w,T.plus(v);var P=T.e/lt,D=v.e/lt,N=T.c,F=v.c;if(!P||!D){if(!N||!F)return N?(v.s=-w,v):new x(F?T:NaN);if(!N[0]||!F[0])return F[0]?(v.s=-w,v):new x(N[0]?T:a==3?-0:0)}if(P=Ps(P),D=Ps(D),N=N.slice(),R=P-D){for((M=R<0)?(R=-R,I=N):(D=P,I=F),I.reverse(),w=R;w--;I.push(0));I.reverse()}else for(E=(M=(R=N.length)<(w=F.length))?R:w,R=w=0;w<E;w++)if(N[w]!=F[w]){M=N[w]<F[w];break}if(M&&(I=N,N=F,F=I,v.s=-v.s),w=(E=F.length)-(A=N.length),w>0)for(;w--;N[A++]=0);for(w=lo-1;E>R;){if(N[--E]<F[E]){for(A=E;A&&!N[--A];N[A]=w);--N[A],N[E]+=lo}N[E]-=F[E]}for(;N[0]==0;N.splice(0,1),--D);return N[0]?S(v,N,D):(v.s=a==3?-1:1,v.c=[v.e=0],v)},i.modulo=i.mod=function(v,w){var A,E,I=this;return v=new x(v,w),!I.c||!v.s||v.c&&!v.c[0]?new x(NaN):!v.c||I.c&&!I.c[0]?new x(I):(h==9?(E=v.s,v.s=1,A=e(I,v,0,3),v.s=E,A.s*=E):A=e(I,v,0,h),v=I.minus(A.times(v)),!v.c[0]&&h==1&&(v.s=I.s),v)},i.multipliedBy=i.times=function(v,w){var A,E,I,M,T,R,P,D,N,F,B,O,G,U,W,V=this,j=V.c,Z=(v=new x(v,w)).c;if(!j||!Z||!j[0]||!Z[0])return!V.s||!v.s||j&&!j[0]&&!Z||Z&&!Z[0]&&!j?v.c=v.e=v.s=null:(v.s*=V.s,!j||!Z?v.c=v.e=null:(v.c=[0],v.e=0)),v;for(E=Ps(V.e/lt)+Ps(v.e/lt),v.s*=V.s,P=j.length,F=Z.length,P<F&&(G=j,j=Z,Z=G,I=P,P=F,F=I),I=P+F,G=[];I--;G.push(0));for(U=lo,W=hc,I=F;--I>=0;){for(A=0,B=Z[I]%W,O=Z[I]/W|0,T=P,M=I+T;M>I;)D=j[--T]%W,N=j[T]/W|0,R=O*D+N*B,D=B*D+R%W*W+G[M]+A,A=(D/U|0)+(R/W|0)+O*N,G[M--]=D%U;G[M]=A}return A?++E:G.splice(0,1),S(v,G,E)},i.negated=function(){var v=new x(this);return v.s=-v.s||null,v},i.plus=function(v,w){var A,E=this,I=E.s;if(v=new x(v,w),w=v.s,!I||!w)return new x(NaN);if(I!=w)return v.s=-w,E.minus(v);var M=E.e/lt,T=v.e/lt,R=E.c,P=v.c;if(!M||!T){if(!R||!P)return new x(I/0);if(!R[0]||!P[0])return P[0]?v:new x(R[0]?E:I*0)}if(M=Ps(M),T=Ps(T),R=R.slice(),I=M-T){for(I>0?(T=M,A=P):(I=-I,A=R),A.reverse();I--;A.push(0));A.reverse()}for(I=R.length,w=P.length,I-w<0&&(A=P,P=R,R=A,w=I),I=0;w;)I=(R[--w]=R[w]+P[w]+I)/lo|0,R[w]=lo===R[w]?0:R[w]%lo;return I&&(R=[I].concat(R),++T),S(v,R,T)},i.precision=i.sd=function(v,w){var A,E,I,M=this;if(v!=null&&v!==!!v)return Tr(v,1,pn),w==null?w=a:Tr(w,0,8),C(new x(M),v,w);if(!(A=M.c))return null;if(I=A.length-1,E=I*lt+1,I=A[I]){for(;I%10==0;I/=10,E--);for(I=A[0];I>=10;I/=10,E++);}return v&&M.e+1>E&&(E=M.e+1),E},i.shiftedBy=function(v){return Tr(v,-BI,BI),this.times("1e"+v)},i.squareRoot=i.sqrt=function(){var v,w,A,E,I,M=this,T=M.c,R=M.s,P=M.e,D=o+4,N=new x("0.5");if(R!==1||!T||!T[0])return new x(!R||R<0&&(!T||T[0])?NaN:T?M:1/0);if(R=Math.sqrt(+k(M)),R==0||R==1/0?(w=ks(T),(w.length+P)%2==0&&(w+="0"),R=Math.sqrt(+w),P=Ps((P+1)/2)-(P<0||P%2),R==1/0?w="5e"+P:(w=R.toExponential(),w=w.slice(0,w.indexOf("e")+1)+P),A=new x(w)):A=new x(R+""),A.c[0]){for(P=A.e,R=P+D,R<3&&(R=0);;)if(I=A,A=N.times(I.plus(e(M,I,D,1))),ks(I.c).slice(0,R)===(w=ks(A.c)).slice(0,R))if(A.e<P&&--R,w=w.slice(R-3,R+1),w=="9999"||!E&&w=="4999"){if(!E&&(C(I,I.e+o+2,0),I.times(I).eq(M))){A=I;break}D+=4,R+=4,E=1}else{(!+w||!+w.slice(1)&&w.charAt(0)=="5")&&(C(A,A.e+o+2,1),v=!A.times(A).eq(M));break}}return C(A,A.e+o+1,a,v)},i.toExponential=function(v,w){return v!=null&&(Tr(v,0,pn),v++),b(this,v,w,1)},i.toFixed=function(v,w){return v!=null&&(Tr(v,0,pn),v=v+this.e+1),b(this,v,w)},i.toFormat=function(v,w,A){var E,I=this;if(A==null)v!=null&&w&&typeof w=="object"?(A=w,w=null):v&&typeof v=="object"?(A=v,v=w=null):A=m;else if(typeof A!="object")throw Error(Mi+"Argument not an object: "+A);if(E=I.toFixed(v,w),I.c){var M,T=E.split("."),R=+A.groupSize,P=+A.secondaryGroupSize,D=A.groupSeparator||"",N=T[0],F=T[1],B=I.s<0,O=B?N.slice(1):N,G=O.length;if(P&&(M=R,R=P,P=M,G-=M),R>0&&G>0){for(M=G%R||R,N=O.substr(0,M);M<G;M+=R)N+=D+O.substr(M,R);P>0&&(N+=D+O.slice(M)),B&&(N="-"+N)}E=F?N+(A.decimalSeparator||"")+((P=+A.fractionGroupSize)?F.replace(new RegExp("\\d{"+P+"}\\B","g"),"$&"+(A.fractionGroupSeparator||"")):F):N}return(A.prefix||"")+E+(A.suffix||"")},i.toFraction=function(v){var w,A,E,I,M,T,R,P,D,N,F,B,O=this,G=O.c;if(v!=null&&(R=new x(v),!R.isInteger()&&(R.c||R.s!==1)||R.lt(s)))throw Error(Mi+"Argument "+(R.isInteger()?"out of range: ":"not an integer: ")+k(R));if(!G)return new x(O);for(w=new x(s),D=A=new x(s),E=P=new x(s),B=ks(G),M=w.e=B.length-O.e-1,w.c[0]=NI[(T=M%lt)<0?lt+T:T],v=!v||R.comparedTo(w)>0?M>0?w:D:R,T=d,d=1/0,R=new x(B),P.c[0]=0;N=e(R,w,0,1),I=A.plus(N.times(E)),I.comparedTo(v)!=1;)A=E,E=I,D=P.plus(N.times(I=D)),P=I,w=R.minus(N.times(I=w)),R=I;return I=e(v.minus(A),E,0,1),P=P.plus(I.times(D)),A=A.plus(I.times(E)),P.s=D.s=O.s,M=M*2,F=e(D,E,M,a).minus(O).abs().comparedTo(e(P,A,M,a).minus(O).abs())<1?[D,E]:[P,A],d=T,F},i.toNumber=function(){return+k(this)},i.toPrecision=function(v,w){return v!=null&&Tr(v,1,pn),b(this,v,w,2)},i.toString=function(v){var w,A=this,E=A.s,I=A.e;return I===null?E?(w="Infinity",E<0&&(w="-"+w)):w="NaN":(v==null?w=I<=l||I>=c?Tb(ks(A.c),I):$a(ks(A.c),I,"0"):v===10&&y?(A=C(new x(A),o+I+1,a),w=$a(ks(A.c),A.e,"0")):(Tr(v,2,g.length,"Base"),w=t($a(ks(A.c),I,"0"),10,v,E,!0)),E<0&&A.c[0]&&(w="-"+w)),w},i.valueOf=i.toJSON=function(){return k(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,n!=null&&x.set(n),x}function Ps(n){var e=n|0;return n>0||n===e?e:e-1}function ks(n){for(var e,t,r=1,i=n.length,s=n[0]+"";r<i;){for(e=n[r++]+"",t=lt-e.length;t--;e="0"+e);s+=e}for(i=s.length;s.charCodeAt(--i)===48;);return s.slice(0,i+1||1)}function D1(n,e){var t,r,i=n.c,s=e.c,o=n.s,a=e.s,l=n.e,c=e.e;if(!o||!a)return null;if(t=i&&!i[0],r=s&&!s[0],t||r)return t?r?0:-a:o;if(o!=a)return o;if(t=o<0,r=l==c,!i||!s)return r?0:!i^t?1:-1;if(!r)return l>c^t?1:-1;for(a=(l=i.length)<(c=s.length)?l:c,o=0;o<a;o++)if(i[o]!=s[o])return i[o]>s[o]^t?1:-1;return l==c?0:l>c^t?1:-1}function Tr(n,e,t,r){if(n<e||n>t||n!==Is(n))throw Error(Mi+(r||"Argument")+(typeof n=="number"?n<e||n>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function Eb(n){var e=n.c.length-1;return Ps(n.e/lt)==e&&n.c[e]%2!=0}function Tb(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function $a(n,e,t){var r,i;if(e<0){for(i=t+".";++e;i+=t);n=i+n}else if(r=n.length,++e>r){for(i=t,e-=r;--e;i+=t);n+=i}else e<r&&(n=n.slice(0,e)+"."+n.slice(e));return n}var Zne=sH(),Ds=Zne;var Jne=class{key;left=null;right=null;constructor(n){this.key=n}},Mp=class extends Jne{constructor(n){super(n)}};var eie=class{size=0;modificationCount=0;splayCount=0;splay(n){let e=this.root;if(e==null)return this.compare(n,n),-1;let t=null,r=null,i=null,s=null,o=e,a=this.compare,l;for(;;)if(l=a(o.key,n),l>0){let c=o.left;if(c==null||(l=a(c.key,n),l>0&&(o.left=c.right,c.right=o,o=c,c=o.left,c==null)))break;t==null?r=o:t.left=o,t=o,o=c}else if(l<0){let c=o.right;if(c==null||(l=a(c.key,n),l<0&&(o.right=c.left,c.left=o,o=c,c=o.right,c==null)))break;i==null?s=o:i.right=o,i=o,o=c}else break;return i!=null&&(i.right=o.left,o.left=s),t!=null&&(t.left=o.right,o.right=r),this.root!==o&&(this.root=o,this.splayCount++),l}splayMin(n){let e=n,t=e.left;for(;t!=null;){let r=t;e.left=r.right,r.right=e,e=r,t=e.left}return e}splayMax(n){let e=n,t=e.right;for(;t!=null;){let r=t;e.right=r.left,r.left=e,e=r,t=e.right}return e}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let t=this.root,r=t,i=t.left;if(this.size--,i==null)this.root=t.right;else{let s=t.right;t=this.splayMax(i),t.right=s,this.root=t}return this.modificationCount++,r}addNewRoot(n,e){this.size++,this.modificationCount++;let t=this.root;if(t==null){this.root=n;return}e<0?(n.left=t,n.right=t.right,t.right=null):(n.right=t,n.left=t.left,t.left=null),this.root=n}_first(){let n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){let n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,e)=>n<e?-1:n>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}};var M1=class Rp extends eie{root=null;compare;validKey;constructor(e,t){super(),this.compare=e??this.defaultCompare(),this.validKey=t??(r=>r!=null&&r!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(let t of e)this.delete(t)}forEach(e){let t=this[Symbol.iterator](),r;for(;r=t.next(),!r.done;)e(r.value,r.value,this)}add(e){let t=this.splay(e);return t!=0&&this.addNewRoot(new Mp(e),t),this}addAndReturn(e){let t=this.splay(e);return t!=0&&this.addNewRoot(new Mp(e),t),this.root.key}addAll(e){for(let t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let r=this.root.left;if(r==null)return null;let i=r.right;for(;i!=null;)r=i,i=r.right;return r.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let r=this.root.right;if(r==null)return null;let i=r.left;for(;i!=null;)r=i,i=r.left;return r.key}retainAll(e){let t=new Rp(this.compare,this.validKey),r=this.modificationCount;for(let i of e){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(i)&&this.splay(i)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){let t=new Rp(this.compare,this.validKey);for(let r of this)e.has(r)&&t.add(r);return t}difference(e){let t=new Rp(this.compare,this.validKey);for(let r of this)e.has(r)||t.add(r);return t}union(e){let t=this.clone();return t.addAll(e),t}clone(){let e=new Rp(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(i,s){let o,a;do{if(o=i.left,a=i.right,o!=null){let l=new Mp(o.key);s.left=l,t(o,l)}if(a!=null){let l=new Mp(a.key);s.right=l,i=a,s=l}}while(a!=null)}let r=new Mp(e.key);return t(e,r),r}toSet(){return this.clone()}entries(){return new rie(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new tie(this.wrap())}[Symbol.toStringTag]="[object Set]"},oH=class{tree;path=new Array;modificationCount=null;splayCount;constructor(n){this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],e=n.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},tie=class extends oH{getValue(n){return n.key}},rie=class extends oH{getValue(n){return[n.key,n.key]}};var fH=n=>()=>n,OI=n=>{let e=n?(t,r)=>r.minus(t).abs().isLessThanOrEqualTo(n):fH(!1);return(t,r)=>e(t,r)?0:t.comparedTo(r)};function nie(n){let e=n?(t,r,i,s,o)=>t.exponentiatedBy(2).isLessThanOrEqualTo(s.minus(r).exponentiatedBy(2).plus(o.minus(i).exponentiatedBy(2)).times(n)):fH(!1);return(t,r,i)=>{let s=t.x,o=t.y,a=i.x,l=i.y,c=o.minus(l).times(r.x.minus(a)).minus(s.minus(a).times(r.y.minus(l)));return e(c,s,o,a,l)?0:c.comparedTo(0)}}var iie=n=>n,sie=n=>{if(n){let e=new M1(OI(n)),t=new M1(OI(n)),r=(s,o)=>o.addAndReturn(s),i=s=>({x:r(s.x,e),y:r(s.y,t)});return i({x:new Ds(0),y:new Ds(0)}),i}return iie},LI=n=>({set:e=>{za=LI(e)},reset:()=>LI(n),compare:OI(n),snap:sie(n),orient:nie(n)}),za=LI(),Fp=(n,e)=>n.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(n.ur.y),UI=(n,e)=>{if(e.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(e.ll.y))return null;let t=n.ll.x.isLessThan(e.ll.x)?e.ll.x:n.ll.x,r=n.ur.x.isLessThan(e.ur.x)?n.ur.x:e.ur.x,i=n.ll.y.isLessThan(e.ll.y)?e.ll.y:n.ll.y,s=n.ur.y.isLessThan(e.ur.y)?n.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:r,y:s}}},kb=(n,e)=>n.x.times(e.y).minus(n.y.times(e.x)),hH=(n,e)=>n.x.times(e.x).plus(n.y.times(e.y)),Pb=n=>hH(n,n).sqrt(),oie=(n,e,t)=>{let r={x:e.x.minus(n.x),y:e.y.minus(n.y)},i={x:t.x.minus(n.x),y:t.y.minus(n.y)};return kb(i,r).div(Pb(i)).div(Pb(r))},aie=(n,e,t)=>{let r={x:e.x.minus(n.x),y:e.y.minus(n.y)},i={x:t.x.minus(n.x),y:t.y.minus(n.y)};return hH(i,r).div(Pb(i)).div(Pb(r))},aH=(n,e,t)=>e.y.isZero()?null:{x:n.x.plus(e.x.div(e.y).times(t.minus(n.y))),y:t},lH=(n,e,t)=>e.x.isZero()?null:{x:t,y:n.y.plus(e.y.div(e.x).times(t.minus(n.x)))},lie=(n,e,t,r)=>{if(e.x.isZero())return lH(t,r,n.x);if(r.x.isZero())return lH(n,e,t.x);if(e.y.isZero())return aH(t,r,n.y);if(r.y.isZero())return aH(n,e,t.y);let i=kb(e,r);if(i.isZero())return null;let s={x:t.x.minus(n.x),y:t.y.minus(n.y)},o=kb(s,e).div(i),a=kb(s,r).div(i),l=n.x.plus(a.times(e.x)),c=t.x.plus(o.times(r.x)),u=n.y.plus(a.times(e.y)),d=t.y.plus(o.times(r.y)),f=l.plus(c).div(2),h=u.plus(d).div(2);return{x:f,y:h}},Zo=class pH{point;isLeft;segment;otherSE;consumedBy;static compare(e,t){let r=pH.comparePoints(e.point,t.point);return r!==0?r:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Db.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");let t=e.point.events;for(let r=0,i=t.length;r<i;r++){let s=t[r];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}checkForConsuming(){let e=this.point.events.length;for(let t=0;t<e;t++){let r=this.point.events[t];if(r.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){let s=this.point.events[i];s.consumedBy===void 0&&r.otherSE.point.events===s.otherSE.point.events&&r.segment.consume(s.segment)}}}getAvailableLinkedEvents(){let e=[];for(let t=0,r=this.point.events.length;t<r;t++){let i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){let t=new Map,r=i=>{let s=i.otherSE;t.set(i,{sine:oie(this.point,e.point,s.point),cosine:aie(this.point,e.point,s.point)})};return(i,s)=>{t.has(i)||r(i),t.has(s)||r(s);let{sine:o,cosine:a}=t.get(i),{sine:l,cosine:c}=t.get(s);return o.isGreaterThanOrEqualTo(0)&&l.isGreaterThanOrEqualTo(0)?a.isLessThan(c)?1:a.isGreaterThan(c)?-1:0:o.isLessThan(0)&&l.isLessThan(0)?a.isLessThan(c)?-1:a.isGreaterThan(c)?1:0:l.isLessThan(o)?-1:l.isGreaterThan(o)?1:0}}},cie=class GI{events;poly;_isExteriorRing;_enclosingRing;static factory(e){let t=[];for(let r=0,i=e.length;r<i;r++){let s=e[r];if(!s.isInResult()||s.ringOut)continue;let o=null,a=s.leftSE,l=s.rightSE,c=[a],u=a.point,d=[];for(;o=a,a=l,c.push(a),a.point!==u;)for(;;){let f=a.getAvailableLinkedEvents();if(f.length===0){let m=c[0].point,g=c[c.length-1].point;throw new Error(`Unable to complete output ring starting at [${m.x}, ${m.y}]. Last matching segment found ends at [${g.x}, ${g.y}].`)}if(f.length===1){l=f[0].otherSE;break}let h=null;for(let m=0,g=d.length;m<g;m++)if(d[m].point===a.point){h=m;break}if(h!==null){let m=d.splice(h)[0],g=c.splice(m.index);g.unshift(g[0].otherSE),t.push(new GI(g.reverse()));continue}d.push({index:c.length,point:a.point});let p=a.getLeftmostComparator(o);l=f.sort(p)[0].otherSE;break}t.push(new GI(c))}return t}constructor(e){this.events=e;for(let t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point,t=[e];for(let c=1,u=this.events.length-1;c<u;c++){let d=this.events[c].point,f=this.events[c+1].point;za.orient(d,e,f)!==0&&(t.push(d),e=d)}if(t.length===1)return null;let r=t[0],i=t[1];za.orient(r,e,i)===0&&t.shift(),t.push(t[0]);let s=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,l=[];for(let c=o;c!=a;c+=s)l.push([t[c].x.toNumber(),t[c].y.toNumber()]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){let e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,s=this.events.length;i<s;i++){let o=this.events[i];Zo.compare(e,o)>0&&(e=o)}let t=e.segment.prevInResult(),r=t?t.prevInResult():null;for(;;){if(!t)return null;if(!r)return t.ringOut;if(r.ringOut!==t.ringOut)return r.ringOut?.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut?.enclosingRing();t=r.prevInResult(),r=t?t.prevInResult():null}}},cH=class{exteriorRing;interiorRings;constructor(n){this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){let n=this.exteriorRing.getGeom();if(n===null)return null;let e=[n];for(let t=0,r=this.interiorRings.length;t<r;t++){let i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}},uie=class{rings;polys;constructor(n){this.rings=n,this.polys=this._composePolys(n)}getGeom(){let n=[];for(let e=0,t=this.polys.length;e<t;e++){let r=this.polys[e].getGeom();r!==null&&n.push(r)}return n}_composePolys(n){let e=[];for(let t=0,r=n.length;t<r;t++){let i=n[t];if(!i.poly)if(i.isExteriorRing())e.push(new cH(i));else{let s=i.enclosingRing();s?.poly||e.push(new cH(s)),s?.poly?.addInterior(i)}}return e}},die=class{queue;tree;segments;constructor(n,e=Db.compare){this.queue=n,this.tree=new M1(e),this.segments=[]}process(n){let e=n.segment,t=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(e),t;n.isLeft&&this.tree.add(e);let r=e,i=e;do r=this.tree.lastBefore(r);while(r!=null&&r.consumedBy!=null);do i=this.tree.firstAfter(i);while(i!=null&&i.consumedBy!=null);if(n.isLeft){let s=null;if(r){let a=r.getIntersection(e);if(a!==null&&(e.isAnEndpoint(a)||(s=a),!r.isAnEndpoint(a))){let l=this._splitSafely(r,a);for(let c=0,u=l.length;c<u;c++)t.push(l[c])}}let o=null;if(i){let a=i.getIntersection(e);if(a!==null&&(e.isAnEndpoint(a)||(o=a),!i.isAnEndpoint(a))){let l=this._splitSafely(i,a);for(let c=0,u=l.length;c<u;c++)t.push(l[c])}}if(s!==null||o!==null){let a=null;s===null?a=o:o===null?a=s:a=Zo.comparePoints(s,o)<=0?s:o,this.queue.delete(e.rightSE),t.push(e.rightSE);let l=e.split(a);for(let c=0,u=l.length;c<u;c++)t.push(l[c])}t.length>0?(this.tree.delete(e),t.push(n)):(this.segments.push(e),e.prev=r)}else{if(r&&i){let s=r.getIntersection(i);if(s!==null){if(!r.isAnEndpoint(s)){let o=this._splitSafely(r,s);for(let a=0,l=o.length;a<l;a++)t.push(o[a])}if(!i.isAnEndpoint(s)){let o=this._splitSafely(i,s);for(let a=0,l=o.length;a<l;a++)t.push(o[a])}}}this.tree.delete(e)}return t}_splitSafely(n,e){this.tree.delete(n);let t=n.rightSE;this.queue.delete(t);let r=n.split(e);return r.push(t),n.consumedBy===void 0&&this.tree.add(n),r}},fie=class{type;numMultiPolys;run(n,e,t){Bp.type=n;let r=[new dH(e,!0)];for(let c=0,u=t.length;c<u;c++)r.push(new dH(t[c],!1));if(Bp.numMultiPolys=r.length,Bp.type==="difference"){let c=r[0],u=1;for(;u<r.length;)UI(r[u].bbox,c.bbox)!==null?u++:r.splice(u,1)}if(Bp.type==="intersection")for(let c=0,u=r.length;c<u;c++){let d=r[c];for(let f=c+1,h=r.length;f<h;f++)if(UI(d.bbox,r[f].bbox)===null)return[]}let i=new M1(Zo.compare);for(let c=0,u=r.length;c<u;c++){let d=r[c].getSweepEvents();for(let f=0,h=d.length;f<h;f++)i.add(d[f])}let s=new die(i),o=null;for(i.size!=0&&(o=i.first(),i.delete(o));o;){let c=s.process(o);for(let u=0,d=c.length;u<d;u++){let f=c[u];f.consumedBy===void 0&&i.add(f)}i.size!=0?(o=i.first(),i.delete(o)):o=null}za.reset();let a=cie.factory(s.segments);return new uie(a).getGeom()}},Bp=new fie,Np=Bp,hie=0,Db=class Ib{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,t){let r=e.leftSE.point.x,i=t.leftSE.point.x,s=e.rightSE.point.x,o=t.rightSE.point.x;if(o.isLessThan(r))return 1;if(s.isLessThan(i))return-1;let a=e.leftSE.point.y,l=t.leftSE.point.y,c=e.rightSE.point.y,u=t.rightSE.point.y;if(r.isLessThan(i)){if(l.isLessThan(a)&&l.isLessThan(c))return 1;if(l.isGreaterThan(a)&&l.isGreaterThan(c))return-1;let d=e.comparePoint(t.leftSE.point);if(d<0)return 1;if(d>0)return-1;let f=t.comparePoint(e.rightSE.point);return f!==0?f:-1}if(r.isGreaterThan(i)){if(a.isLessThan(l)&&a.isLessThan(u))return-1;if(a.isGreaterThan(l)&&a.isGreaterThan(u))return 1;let d=t.comparePoint(e.leftSE.point);if(d!==0)return d;let f=e.comparePoint(t.rightSE.point);return f<0?1:f>0?-1:1}if(a.isLessThan(l))return-1;if(a.isGreaterThan(l))return 1;if(s.isLessThan(o)){let d=t.comparePoint(e.rightSE.point);if(d!==0)return d}if(s.isGreaterThan(o)){let d=e.comparePoint(t.rightSE.point);if(d<0)return 1;if(d>0)return-1}if(!s.eq(o)){let d=c.minus(a),f=s.minus(r),h=u.minus(l),p=o.minus(i);if(d.isGreaterThan(f)&&h.isLessThan(p))return 1;if(d.isLessThan(f)&&h.isGreaterThan(p))return-1}return s.isGreaterThan(o)?1:s.isLessThan(o)||c.isLessThan(u)?-1:c.isGreaterThan(u)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,r,i){this.id=++hie,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=i}static fromRing(e,t,r){let i,s,o,a=Zo.comparePoints(e,t);if(a<0)i=e,s=t,o=1;else if(a>0)i=t,s=e,o=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);let l=new Zo(i,!0),c=new Zo(s,!1);return new Ib(l,c,[r],[o])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return za.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){let t=this.bbox(),r=e.bbox(),i=UI(t,r);if(i===null)return null;let s=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,l=e.rightSE.point,c=Fp(t,a)&&this.comparePoint(a)===0,u=Fp(r,s)&&e.comparePoint(s)===0,d=Fp(t,l)&&this.comparePoint(l)===0,f=Fp(r,o)&&e.comparePoint(o)===0;if(u&&c)return f&&!d?o:!f&&d?l:null;if(u)return d&&s.x.eq(l.x)&&s.y.eq(l.y)?null:s;if(c)return f&&o.x.eq(a.x)&&o.y.eq(a.y)?null:a;if(f&&d)return null;if(f)return o;if(d)return l;let h=lie(s,this.vector(),a,e.vector());return h===null||!Fp(i,h)?null:za.snap(h)}split(e){let t=[],r=e.events!==void 0,i=new Zo(e,!0),s=new Zo(e,!1),o=this.rightSE;this.replaceRightSE(s),t.push(s),t.push(i);let a=new Ib(i,o,this.rings.slice(),this.windings.slice());return Zo.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Zo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),s.checkForConsuming()),t}swapEvents(){let e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,r=this.windings.length;t<r;t++)this.windings[t]*=-1}consume(e){let t=this,r=e;for(;t.consumedBy;)t=t.consumedBy;for(;r.consumedBy;)r=r.consumedBy;let i=Ib.compare(t,r);if(i!==0){if(i>0){let s=t;t=r,r=s}if(t.prev===r){let s=t;t=r,r=s}for(let s=0,o=r.rings.length;s<o;s++){let a=r.rings[s],l=r.windings[s],c=t.rings.indexOf(a);c===-1?(t.rings.push(a),t.windings.push(l)):t.windings[c]+=l}r.rings=null,r.windings=null,r.consumedBy=t,r.leftSE.consumedBy=t.leftSE,r.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};let t=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,l=this.rings.length;a<l;a++){let c=this.rings[a],u=this.windings[a],d=t.indexOf(c);d===-1?(t.push(c),r.push(u)):r[d]+=u}let s=[],o=[];for(let a=0,l=t.length;a<l;a++){if(r[a]===0)continue;let c=t[a],u=c.poly;if(o.indexOf(u)===-1)if(c.isExterior)s.push(u);else{o.indexOf(u)===-1&&o.push(u);let d=s.indexOf(c.poly);d!==-1&&s.splice(d,1)}}for(let a=0,l=s.length;a<l;a++){let c=s[a].multiPoly;i.indexOf(c)===-1&&i.push(c)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Np.type){case"union":{let r=e.length===0,i=t.length===0;this._isInResult=r!==i;break}case"intersection":{let r,i;e.length<t.length?(r=e.length,i=t.length):(r=t.length,i=e.length),this._isInResult=i===Np.numMultiPolys&&r<i;break}case"xor":{let r=Math.abs(e.length-t.length);this._isInResult=r%2===1;break}case"difference":{let r=i=>i.length===1&&i[0].isSubject;this._isInResult=r(e)!==r(t);break}}return this._isInResult}},uH=class{poly;isExterior;segments;bbox;constructor(n,e,t){if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let r=za.snap({x:new Ds(n[0][0]),y:new Ds(n[0][1])});this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let i=r;for(let s=1,o=n.length;s<o;s++){if(typeof n[s][0]!="number"||typeof n[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let a=za.snap({x:new Ds(n[s][0]),y:new Ds(n[s][1])});a.x.eq(i.x)&&a.y.eq(i.y)||(this.segments.push(Db.fromRing(i,a,this)),a.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=a.x),a.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=a.y),a.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=a.x),a.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=a.y),i=a)}(!r.x.eq(i.x)||!r.y.eq(i.y))&&this.segments.push(Db.fromRing(i,r,this))}getSweepEvents(){let n=[];for(let e=0,t=this.segments.length;e<t;e++){let r=this.segments[e];n.push(r.leftSE),n.push(r.rightSE)}return n}},pie=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new uH(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,r=n.length;t<r;t++){let i=new uH(n[t],this,!1);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=e}getSweepEvents(){let n=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){let r=this.interiorRings[e].getSweepEvents();for(let i=0,s=r.length;i<s;i++)n.push(r[i])}return n}},dH=class{isSubject;polys;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new Ds(Number.POSITIVE_INFINITY),y:new Ds(Number.POSITIVE_INFINITY)},ur:{x:new Ds(Number.NEGATIVE_INFINITY),y:new Ds(Number.NEGATIVE_INFINITY)}};for(let t=0,r=n.length;t<r;t++){let i=new pie(n[t],this);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=e}getSweepEvents(){let n=[];for(let e=0,t=this.polys.length;e<t;e++){let r=this.polys[e].getSweepEvents();for(let i=0,s=r.length;i<s;i++)n.push(r[i])}return n}},Mb=(n,...e)=>Np.run("union",n,e),mH=(n,...e)=>Np.run("intersection",n,e);var gH=(n,...e)=>Np.run("difference",n,e),rdt=za.set;var Op=Ot(VI(),1),jH=Ot(UH(),1),XH=Ot(GH(),1),qH=Ot(HH(),1),KI=class{constructor(e){this._cache={},this.strict=!0,e&&e.type==="FeatureCollection"&&Array.isArray(e.features)&&e.features.forEach(r=>{r.properties=r.properties||{};let i=r.properties,s=r.id||i.id;if(!(!s||!/^\S+\.geojson$/i.test(s))){if(s=s.toLowerCase(),r.id=s,i.id=s,!i.area){let o=Op.default.geometry(r.geometry)/1e6;i.area=Number(o.toFixed(2))}this._cache[s]=r}});let t=WH(Dp("Q2"));t.geometry={type:"Polygon",coordinates:[[[-180,-90],[180,-90],[180,90],[-180,90],[-180,-90]]]},t.id="Q2",t.properties.id="Q2",t.properties.area=Op.default.geometry(t.geometry)/1e6,this._cache.Q2=t}validateLocation(e){if(Array.isArray(e)&&(e.length===2||e.length===3)){let t=e[0],r=e[1],i=e[2];if(Number.isFinite(t)&&t>=-180&&t<=180&&Number.isFinite(r)&&r>=-90&&r<=90&&(e.length===2||Number.isFinite(i)&&i>0)){let s="["+e.toString()+"]";return{type:"point",location:e,id:s}}}else if(typeof e=="string"&&/^\S+\.geojson$/i.test(e)){let t=e.toLowerCase();if(this._cache[t])return{type:"geojson",location:e,id:t}}else if(typeof e=="string"||typeof e=="number"){let t=Dp(e);if(t){let r=t.properties.wikidata;return{type:"countrycoder",location:e,id:r}}}if(this.strict)throw new Error(`validateLocation:  Invalid location: "${e}".`);return null}resolveLocation(e){let t=this.validateLocation(e);if(!t)return null;let r=t.id;if(this._cache[r])return Object.assign(t,{feature:this._cache[r]});if(t.type==="point"){let i=e[0],s=e[1],o=e[2]||25,a=10,l=3,c=Math.PI*o*o,u=this._cache[r]=(0,XH.default)({type:"Feature",id:r,properties:{id:r,area:Number(c.toFixed(2))},geometry:(0,jH.default)([i,s],o*1e3,a)},l);return Object.assign(t,{feature:u})}else if(t.type!=="geojson"){if(t.type==="countrycoder"){let i=WH(Dp(r)),s=i.properties;if(Array.isArray(s.members)){let o=rH(r);o.geometry.coordinates=Nb([o],"UNION").geometry.coordinates,i.geometry=o.geometry}if(!s.area){let o=Op.default.geometry(i.geometry)/1e6;s.area=Number(o.toFixed(2))}return i.id=r,s.id=r,this._cache[r]=i,Object.assign(t,{feature:i})}}if(this.strict)throw new Error(`resolveLocation:  Couldn't resolve location "${e}".`);return null}validateLocationSet(e){e=e||{};let t=this.validateLocation.bind(this),r=(e.include||[]).map(t).filter(Boolean),i=(e.exclude||[]).map(t).filter(Boolean);if(!r.length){if(this.strict)throw new Error("validateLocationSet:  LocationSet includes nothing.");e.include=["Q2"],r=[{type:"countrycoder",location:"Q2",id:"Q2"}]}r.sort(VH);let s="+["+r.map(o=>o.id).join(",")+"]";return i.length&&(i.sort(VH),s+="-["+i.map(o=>o.id).join(",")+"]"),{type:"locationset",locationSet:e,id:s}}resolveLocationSet(e){e=e||{};let t=this.validateLocationSet(e);if(!t)return null;let r=t.id;if(this._cache[r])return Object.assign(t,{feature:this._cache[r]});let i=this.resolveLocation.bind(this),s=(e.include||[]).map(i).filter(Boolean),o=(e.exclude||[]).map(i).filter(Boolean);if(s.length===1&&o.length===0)return Object.assign(t,{feature:s[0].feature});let a=Nb(s.map(d=>d.feature),"UNION"),l=Nb(o.map(d=>d.feature),"UNION"),c=l?Nb([a,l],"DIFFERENCE"):a,u=Op.default.geometry(c.geometry)/1e6;return c.id=r,c.properties={id:r,area:Number(u.toFixed(2))},this._cache[r]=c,Object.assign(t,{feature:c})}stringify(e,t){return(0,qH.default)(e,t)}};function Nb(n,e){if(!Array.isArray(n)||!n.length)return null;let t={UNION:Mb,DIFFERENCE:gH}[e],r=n.map(o=>o.geometry.coordinates),i=t.apply(null,r);return{type:"Feature",properties:{},geometry:{type:s(i),coordinates:i}};function s(o){return Array.isArray(o)&&Array.isArray(o[0])&&Array.isArray(o[0][0])&&Array.isArray(o[0][0][0])?"MultiPolygon":"Polygon"}}function WH(n){return JSON.parse(JSON.stringify(n))}function VH(n,e){let t={countrycoder:1,geojson:2,point:3},r=t[n.type],i=t[e.type];return r>i?1:r<i?-1:n.id.localeCompare(e.id)}var YH=KI;var QI=Ot(kp(),1),KH=Ot(VI(),1);var Ha=new YH,Lp=class extends Se{constructor(e){super(e),this.id="locations",this.dependencies=new Set,this._wp=null,this._resolved=new Map,this._knownLocationSets=new Map,this._locationIncludedIn=new Map,this._locationExcludedIn=new Map,this._blocks=[{locationSet:{include:["Q7835","ua"]},text:"Editing has been blocked in this region per request of the OSM Ukrainian community.",url:"https://wiki.openstreetmap.org/wiki/Russian%E2%80%93Ukrainian_war"}];let t=this._blocks.map(i=>{this._resolveLocationSet(i);let s=this._resolved.get(i.locationSetID);return Object.assign(s.properties,i),s});this._wpblocks=(0,QI.default)({type:"FeatureCollection",features:t});let r={locationSet:{include:["Q2"]}};this._resolveLocationSet(r),this._rebuildIndex()}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}_validateLocationSet(e){if(!e.locationSetID)try{let t=e.locationSet;if(!t)throw new Error("object missing locationSet property");t.include||(t.include=["Q2"]);let r=Ha.validateLocationSet(t).id;if(e.locationSetID=r,this._knownLocationSets.has(r))return;let i=0;(t.include||[]).forEach(s=>{let o=Ha.validateLocation(s).id,a=this._resolved.get(o);a||(a=Ha.resolveLocation(s).feature,this._resolved.set(o,a)),i+=a.properties.area;let l=this._locationIncludedIn.get(o);l||(l=new Set,this._locationIncludedIn.set(o,l)),l.add(r)}),(t.exclude||[]).forEach(s=>{let o=Ha.validateLocation(s).id,a=this._resolved.get(o);a||(a=Ha.resolveLocation(s).feature,this._resolved.set(o,a)),i-=a.properties.area;let l=this._locationExcludedIn.get(o);l||(l=new Set,this._locationExcludedIn.set(o,l)),l.add(r)}),this._knownLocationSets.set(r,i)}catch{e.locationSet={include:["Q2"]},e.locationSetID="+[Q2]"}}_resolveLocationSet(e){if(this._validateLocationSet(e),!this._resolved.has(e.locationSetID))try{let t=Ha.resolveLocationSet(e.locationSet),r=t.id;if(e.locationSetID=r,!t.feature.geometry.coordinates.length||!t.feature.properties.area)throw new Error(`locationSet ${r} resolves to an empty feature.`);let i=JSON.parse(JSON.stringify(t.feature));i.id=r,i.properties.id=r,this._resolved.set(r,i)}catch{e.locationSet={include:["Q2"]},e.locationSetID="+[Q2]"}}_rebuildIndex(){this._wp=(0,QI.default)({features:[...this._resolved.values()]}),this.emit("locationchange")}mergeCustomGeoJSON(e){!e||e.type!=="FeatureCollection"||!Array.isArray(e.features)||e.features.forEach(t=>{t.properties=t.properties||{};let r=t.properties,i=t.id||r.id;if(!(!i||!/^\S+\.geojson$/i.test(i))){if(i=i.toLowerCase(),t.id=i,r.id=i,!r.area){let s=KH.default.geometry(t.geometry)/1e6;r.area=Number(s.toFixed(2))}Ha._cache[i]=t}})}mergeLocationSets(e){return Array.isArray(e)?(e.forEach(t=>this._validateLocationSet(t)),this._rebuildIndex(),Promise.resolve(e)):Promise.reject("nothing to do")}locationSetID(e){let t;try{t=Ha.validateLocationSet(e).id}catch{t="+[Q2]"}return t}feature(e="+[Q2]"){return this._resolved.get(e)||this._resolved.get("+[Q2]")}locationSetsAt(e){let t={},r=this._wp(e,!0)||[],i=this;return r.forEach(s=>{if(s.id[0]!=="+")return;let o=s.id,a=i._knownLocationSets.get(o);a&&(t[o]=a)}),r.forEach(s=>{if(s.id[0]==="+")return;let o=s.id;(i._locationIncludedIn.get(o)||[]).forEach(l=>{let c=i._knownLocationSets.get(l);c&&(t[l]=c)})}),r.forEach(s=>{if(s.id[0]==="+")return;let o=s.id;(i._locationExcludedIn.get(o)||[]).forEach(l=>{delete t[l]})}),t}blocksAt(e){return this._blocks.length?this._wpblocks(e,!0)||[]:[]}loco(){return Ha}wpblocks(){return this._wpblocks}};var Eie="Expected a function";function Tie(n,e,t){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(Eie);return x1(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),Xt(n,e,{leading:r,maxWait:e,trailing:i})}var mn=Tie;var QH="#01d4fa",Up=class extends Se{constructor(e){super(e),this.id="map3d",this.autoStart=!1,this.dependencies=new Set(["editor","gfx","l10n","map","styles","ui","urlhash"]),this.maplibre=null,this.containerID="map3d_container",this._loadPromise=null,this._initPromise=null,this._startPromise=null,this._keys=null,this._zDiff=3,this._bDiff=0,this._lastv=null,this._hashchange=this._hashchange.bind(this),this._map3dmoved=this._map3dmoved.bind(this),this._setupKeybinding=this._setupKeybinding.bind(this),this.redraw=this.redraw.bind(this),this.deferredRedraw=mn(this.redraw,50,{leading:!0,trailing:!0}),this.toggle=this.toggle.bind(this),this._getAreaLayer=this._getAreaLayer.bind(this),this._getBuildingLayer=this._getBuildingLayer.bind(this),this._getRoadStrokeLayer=this._getRoadStrokeLayer.bind(this),this._getRoadCasingLayer=this._getRoadCasingLayer.bind(this),this._getRoadSelectedLayer=this._getRoadSelectedLayer.bind(this)}initAsync(){for(let s of this.dependencies)if(!this.context.systems[s])return Promise.reject(`Cannot init:  ${this.id} requires ${s}`);let e=this.context,t=e.systems.l10n,r=e.systems.urlhash,i=Promise.all([t.initAsync(),r.initAsync()]);return this._initPromise=i.then(()=>{r.on("hashchange",this._hashchange),t.on("localechange",this._setupKeybinding),this._setupKeybinding()})}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,t=e.systems.gfx,r=e.systems.ui,i=Promise.all([r.startAsync(),this._loadMapLibreAsync()]);return this._startPromise=i.then(()=>{let s=window.maplibregl;if(!s)throw new Error("maplibre-gl not loaded");let o=this.maplibre=new s.Map({container:this.containerID,minZoom:12,pitch:60,scrollZoom:{around:"center"},style:{version:8,sources:{},layers:[{id:"background-layer",type:"background",layout:{visibility:"visible"},paint:{"background-color":"white"}}]}});t.on("draw",this.deferredRedraw),t.on("move",this.deferredRedraw),o.on("move",this._map3dmoved),o.on("moveend",this._map3dmoved);let a={showCompass:!0,showZoom:!0,visualizePitch:!1};return o.addControl(new s.NavigationControl(a)),new Promise(l=>{o.on("load",()=>{o.setLight({anchor:"viewport",color:"#ff00ff",position:[1,200,30],intensity:.3});let c={type:"FeatureCollection",features:[]};o.addSource("osmareas",{type:"geojson",data:c}),o.addSource("osmroads",{type:"geojson",data:c}),o.addSource("osmbuildings",{type:"geojson",data:c}),o.addLayer(this._getAreaLayer()),o.addLayer(this._getRoadSelectedLayer()),o.addLayer(this._getRoadCasingLayer()),o.addLayer(this._getRoadStrokeLayer()),o.addLayer(this._getBuildingLayer()),this._started=!0,this.redraw(),l()})})}).catch(s=>{s instanceof Error&&console.error(s),this._startPromise=null})}resetAsync(){return this.deferredRedraw.cancel(),Promise.resolve()}get visible(){return!!this.context.systems.urlhash.getParam("map3d")}set visible(e){let t=this.context,r=t.systems.urlhash;if(e)r.setParam("map3d","true"),this.startAsync().then(()=>{t.container().select(`#${this.containerID}`).style("display","block").style("opacity","0").transition().duration(200).style("opacity","1")});else{r.setParam("map3d",null);let i=t.container().select(`#${this.containerID}`);i.transition().duration(200).style("opacity","0").on("end",()=>i.style("display","none"))}}toggle(e){e&&e.preventDefault(),this.visible=!this.visible}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys),this._keys=[Te("\u2318"+r.t("shortcuts.command.toggle_3dmap.key"))],e.keybinding().on(this._keys,this.toggle)}_loadMapLibreAsync(){return this._loadPromise?this._loadPromise:this._loadPromise=new Promise((e,t)=>{let r=this.context.systems.assets,i=0,s=()=>{++i===2&&e()},o=H("head");o.selectAll("#rapideditor-maplibre-css").data([0]).enter().append("link").attr("id","rapideditor-maplibre-css").attr("rel","stylesheet").attr("crossorigin","anonymous").attr("href",r.getAssetURL("maplibre_css")).on("load",s).on("error",t),o.selectAll("#rapideditor-maplibre-js").data([0]).enter().append("script").attr("id","rapideditor-maplibre-js").attr("crossorigin","anonymous").attr("src",r.getAssetURL("maplibre_js")).on("load",s).on("error",t)})}redraw(){this.visible&&(this.updateViewport(),this.updateData())}updateViewport(){let e=this.context,t=this.maplibre,r=e.viewport,i=r.transform;if(!this.visible||!t||t.isMoving()||r.v===this._lastv)return;this._lastv=r.v;let s=Qt(-i.r*Tc,0,360);t.jumpTo({center:r.centerLoc(),bearing:s-this._bDiff,zoom:i.zoom-this._zDiff})}_hashchange(e,t){let r=e.get("map3d"),i=t.get("map3d");(!r||r!==i)&&(r==="true"?this.visible=!0:this.visible=!1)}_map3dmoved(){let e=this.context,t=this.maplibre,r=e.systems.map,i=e.viewport,s=i.transform;if(!t||!this._lastv)return;let o=t.getCenter(),a=[o.lng,o.lat],l=t.getZoom(),c=t.getBearing(),u=i.centerLoc(),d=s.zoom,f=Qt(-s.rotation*Tc,0,360);this._zDiff=d-l,this._bDiff=f-c,He(u,a,1e-6)||r.center(a)}updateData(){if(!this.visible||!this.maplibre)return;let e=this.context,t=e.systems.editor,r=e.viewport,s=t.intersects(r.visibleExtent()).filter(c=>!c.id.startsWith("r")),o=s.filter(c=>Object.keys(c.tags).filter(d=>d.startsWith("highway")).length>0),a=s.filter(c=>Object.keys(c.tags).filter(d=>d.startsWith("building")).length>0),l=s.filter(c=>Object.keys(c.tags).filter(d=>d.startsWith("landuse")||d.startsWith("leisure")||d.startsWith("natural")||d.startsWith("area")).length>0);this._updateRoadData(o),this._updateBuildingData(a),this._updateAreaData(l)}_updateBuildingData(e){let t=this.context,i=t.systems.editor.staging.graph,s=t.selectedIDs(),o=[];for(let l of e){let c=l.asGeoJSON(i);if(c.type!=="Polygon"&&c.type!=="MultiPolygon")continue;if(!l.tags["building:part"]&&e.length<250){let d=!1;for(let f of l.nodes){let h=i.parentWays(i.hasEntity(f));for(let p of h)if(p.tags["building:part"]&&u2(l.nodes.map(m=>i.hasEntity(m).loc),p.nodes.map(m=>i.hasEntity(m).loc))){d=!0;break}}if(d)continue}let u={type:"Feature",properties:{extrude:!0,selected:s.includes(l.id).toString(),min_height:l.tags.min_height?parseFloat(l.tags.min_height):0,height:parseFloat(l.tags.height||l.tags["building:levels"]*3||0)},geometry:c};o.push(u)}let a=this.maplibre.getSource("osmbuildings");a&&a.setData({type:"FeatureCollection",features:o})}_updateAreaData(e){let t=this.context,i=t.systems.editor.staging.graph,s=t.systems.styles,o=t.selectedIDs(),a=[];for(let c of e){let u=c.asGeoJSON(i);if(u.type!=="Polygon"&&u.type!=="MultiPolygon")continue;let d=s.styleMatch(c.tags),f=new ce(d.fill.color).toHex(),h=new ce(d.stroke.color).toHex(),p={type:"Feature",properties:{selected:o.includes(c.id).toString(),fillcolor:f,strokecolor:h},geometry:u};a.push(p)}let l=this.maplibre.getSource("osmareas");l&&l.setData({type:"FeatureCollection",features:a})}_updateRoadData(e){let t=this.context,i=t.systems.editor.staging.graph,s=t.systems.styles,o=t.selectedIDs(),a=[];for(let c of e){let u=c.asGeoJSON(i);if(u.type!=="LineString")continue;let d=s.styleMatch(c.tags),f=new ce(d.casing.color).toHex(),h=new ce(d.stroke.color).toHex(),p={type:"Feature",properties:{selected:o.includes(c.id).toString(),highway:c.tags.highway,casingColor:f,strokeColor:h},geometry:u};a.push(p)}let l=this.maplibre.getSource("osmroads");l&&l.setData({type:"FeatureCollection",features:a})}_getBuildingLayer(){return{id:"building-layer",type:"fill-extrusion",source:"osmbuildings",layout:{},paint:{"fill-extrusion-color":["match",["get","selected"],"true",QH,"#e06e5f"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":.85}}}_getAreaLayer(){return{id:"area-layer",type:"fill",source:"osmareas",layout:{},paint:{"fill-color":["get","fillcolor"],"fill-outline-color":["get","strokecolor"],"fill-opacity":.5}}}_getRoadCasingLayer(){return{id:"road-casing-layer",type:"line",source:"osmroads",layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":["get","casingColor"],"line-width":this._getLineWidth(6)}}}_getRoadSelectedLayer(){return{id:"road-selected-layer",type:"line",source:"osmroads",layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":QH,"line-opacity":["match",["get","selected"],"true",.75,0],"line-width":this._getLineWidth(12)}}}_getRoadStrokeLayer(){return{id:"road-stroke-layer",type:"line",source:"osmroads",layout:{"line-cap":"butt","line-join":"round",visibility:"visible"},paint:{"line-color":["get","strokeColor"],"line-opacity":["match",["get","highway"],"unclassified",.8,"service",.2,1],"line-width":this._getLineWidth(4)}}}_getLineWidth(e){return["interpolate",["linear",2],["zoom"],5,.5,16,["match",["get","highway"],["motorway","trunk","primary"],e*2,["secondary","unclassified"],Math.floor(.75*e*2),["tertiary"],Math.floor(.75*e*2)-1,["minor","service","track","footway","pedestrian","cycleway"],e,e],20,["match",["get","highway"],["motorway","trunk","primary"],e*2.5,["secondary","unclassified"],e*2.5,["tertiary"],e*2.5,["minor","service","track","footway","pedestrian","cycleway"],e*2,e*2]]}};var ZH=256,Ob=2,Gp=24,$p=class extends Se{constructor(e){super(e),this.id="map",this.dependencies=new Set(["editor","filters","gfx","imagery","l10n","photos","rapid","storage","styles","urlhash"]),this.areaFillOptions=["wireframe","partial","full"],this._highlightEdits=!1,this._currFillMode="partial",this._toggleFillMode="partial",this._initPromise=null,this._startPromise=null,this._keys=null,this.$parent=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this._setupKeybinding=this._setupKeybinding.bind(this),this.render=this.render.bind(this),this.immediateRedraw=this.immediateRedraw.bind(this),this.deferredRedraw=this.deferredRedraw.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let h of this.dependencies)if(!this.context.systems[h])return Promise.reject(`Cannot init:  ${this.id} requires ${h}`);let e=this.context,t=e.systems.editor,r=e.systems.filters,i=e.systems.gfx,s=e.systems.imagery,o=e.systems.l10n,a=e.systems.photos,l=e.systems.rapid,c=e.systems.storage,u=e.systems.styles;e.systems.urlhash.on("hashchange",this._hashchange);let f=Promise.all([i.initAsync(),o.initAsync(),c.initAsync()]);return this._initPromise=f.then(()=>{this._currFillMode=c.getItem("area-fill")||"partial",this._toggleFillMode=c.getItem("area-fill-toggle")||"partial";let h=i.scene;i.on("move",()=>this.emit("move")).on("draw",()=>{this._updateHash(),this.emit("draw",{full:!0})}),t.on("merge",m=>{m&&h.dirtyData("osm",m),i.deferredRedraw()}).on("stagingchange",m=>{let g=m.complete();for(let y of g.values())y&&(y.touch(),r.clearEntity(y));i.immediateRedraw()}).on("historyjump",(m,g)=>{let y=t.history[m],x=t.history[g],_=(g===m-1&&y)??x,S=e.viewport.transform.props,C=_.transform;C&&(S.x!==C.x||S.y!==C.y||S.k!==C.k||S.r!==C.r)&&this.transformEase(C);let k=e.mode?.id;if(/^draw/.test(k))return;let v=_.graph,A=(_.selectedIDs??[]).filter(E=>v.hasEntity(E));A.length?e.enter("select-osm",{selection:{osm:A}}):e.enter("browse")}),r.on("filterchange",()=>{h.dirtyLayers("osm"),i.immediateRedraw()}),l.on("datasetchange",()=>{h.dirtyLayers(["rapid","rapid-overlay","overture"]),i.immediateRedraw()}),o.on("localechange",()=>{this._setupKeybinding(),h.dirtyScene(),i.immediateRedraw()}),e.on("modechange",i.immediateRedraw),s.on("imagerychange",i.immediateRedraw),a.on("photochange",i.immediateRedraw),h.on("layerchange",i.immediateRedraw),u.on("stylechange",i.immediateRedraw);let p=e.services.osm;p&&p.on("authchange",i.immediateRedraw),this._setupKeybinding()})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let r=this.context.systems.gfx,s=e.selectAll(".main-map").data([0]).enter().append("div").attr("class","main-map").on("contextmenu",o=>o.preventDefault()).on("wheel.map mousewheel.map",o=>o.preventDefault()).append(()=>r.supersurface).attr("class","supersurface");s.append(()=>r.surface).attr("class","surface"),s.append(()=>r.overlay).attr("class","overlay")}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys);let i=r.t("shortcuts.command.wireframe.key"),s=r.t("shortcuts.command.highlight_edits.key");this._keys=[i,s],e.keybinding().on(i,o=>{o.preventDefault(),o.stopPropagation(),this.wireframeMode=!this.wireframeMode}).on(s,o=>{o.preventDefault(),this.highlightEdits=!this.highlightEdits})}_hashchange(e,t){let i=this.context.systems.gfx.scene,s=e.get("map"),o=t.get("map");if(!s||s!==o){let d,f,h,p;typeof s=="string"&&([d,f,h,p]=s.split("/",4).map(Number)),(isNaN(d)||!isFinite(d))&&(d=2),(isNaN(f)||!isFinite(f))&&(f=0),(isNaN(h)||!isFinite(h))&&(h=0),(isNaN(p)||!isFinite(p))&&(p=0),d=dt(d,Ob,Gp),f=dt(f,-90,90),h=dt(h,-180,180),p=Qt(-p,0,360),this.setMapParams([h,f],d,p*Mn)}let a=e.get("id"),l=t.get("id");if(a!==l&&typeof a=="string"){let d=a.split(",").map(h=>h.trim()).filter(Boolean),f=this.mode?.id;d.length&&f!=="save"&&this.selectEntityID(d[0])}let c=e.get("note")||"",u=t.get("note")||"";if(c!==u){let d=!1,f=null,h=c.split(",").map(p=>p.trim().toLowerCase()).filter(Boolean);for(let p of h){if(p==="true"){d=!0;continue}let m=+p;if(!isNaN(m)&&isFinite(m)){d=!0,f=m;break}}f?this.selectNoteID(f):d?i.enableLayers("notes"):i.disableLayers("notes")}}_updateHash(){let e=this.context,t=e.systems.gfx.scene,r=e.systems.urlhash,i=e.viewport,[s,o]=i.centerLoc(),a=i.transform,l=a.zoom,c=Qt(-a.r*Tc,0,360),u=Math.max(0,Math.ceil(Math.log(l)/Math.LN2)),d=.1,f=l.toFixed(2),h=o.toFixed(u),p=s.toFixed(u),m=c.toFixed(1),g=`${f}/${h}/${p}`;Math.abs(c)>d&&(g+=`/${m}`),r.setParam("map",g);let y=t.layers.get("notes"),x,[b]=e.selectedData(),[_,S]=b||[];S instanceof Qe&&S.service==="osm"&&(x=_),y?.enabled?x?r.setParam("note",x):r.setParam("note","true"):r.setParam("note",null)}deferredRedraw(){this.context.systems.gfx.deferredRedraw()}immediateRedraw(){this.context.systems.gfx.immediateRedraw()}centerPoint(){return this.context.viewport.center()}centerLoc(){return this.context.viewport.centerLoc()}mouse(){return this.context.systems.gfx.events?.coord?.map||this.centerPoint()}mouseLoc(){return this.context.viewport.unproject(this.mouse())}transform(e,t){return e===void 0?this.context.viewport.transform.props:(e.r=Qt(+(e.r||0).toFixed(3),0,Kt),this.context.systems.gfx.setTransformAsync(e,t??0),this)}setTransformAsync(e,t=0){return e.r=Qt(+(e.r||0).toFixed(3),0,Kt),this.context.systems.gfx.setTransformAsync(e,t)}setMapParams(e,t,r,i=0){let o=this.context.viewport,a=o.center(),l=o.centerLoc(),c=o.transform,u=c.zoom,d=c.r;if(e===void 0&&(e=l),t===void 0&&(t=u),r===void 0&&(r=d),e[0]=dt(e[0]||0,-180,180),e[1]=dt(e[1]||0,-90,90),t=dt(+(t||0).toFixed(2),Ob,Gp),r=Qt(+(r||0).toFixed(3),0,Kt),e[0]===l[0]&&e[1]===l[1]&&t===u&&r===d)return this;let f=gi(t,ZH),h=new Rn(c,o.dimensions);h.transform.scale=f;let p=h.transform.translation,m=h.project(e),g=Me(a,m);return p=bt(p,g),this.transform({x:p[0],y:p[1],k:f,r},i)}setMapParamsAsync(e,t,r,i=0){let o=this.context.viewport,a=o.center(),l=o.centerLoc(),c=o.transform,u=c.zoom,d=c.r;if(e===void 0&&(e=l),t===void 0&&(t=u),r===void 0&&(r=d),e[0]=dt(e[0]||0,-180,180),e[1]=dt(e[1]||0,-90,90),t=dt(+(t||0).toFixed(2),Ob,Gp),r=Qt(+(r||0).toFixed(3),0,Kt),e[0]===l[0]&&e[1]===l[1]&&t===u&&r===d)return Promise.resolve(c);let f=gi(t,ZH),h=new Rn(c,o.dimensions);h.transform.scale=f;let p=h.transform.translation,m=h.project(e),g=Me(a,m);return p=bt(p,g),this.setTransformAsync({x:p[0],y:p[1],k:f,r},i)}center(e,t){return e===void 0?this.centerLoc():this.setMapParams(e,void 0,void 0,t??0)}zoom(e,t){return e===void 0?this.context.viewport.transform.zoom:this.setMapParams(void 0,e,void 0,t??0)}pan(e,t=0){let r=this.context.viewport.transform,[i,s]=lr(e,-r.r,[0,0]);return this.transform({x:r.x+i,y:r.y+s,k:r.k,r:r.r},t)}fitEntities(e,t=0){let r,s=this.context.systems.editor.staging.graph;if(Array.isArray(e)?r=Mt(e,s):r=e.extent(s),!isFinite(r.area()))return this;let o=dt(this.trimmedExtentZoom(r),0,20);return this.setMapParams(r.center(),o,void 0,t)}selectEntityID(e,t=!1){let r=this.context,i=r.systems.editor,s=r.systems.gfx.scene,o=r.viewport;if(!e){r.enter("browse");return}let a=u=>{let d=r.selectedIDs();(r.mode?.id!=="select-osm"||!d.includes(e))&&(s.enableLayers("osm"),r.enter("select-osm",{selection:{osm:[u.id]}}));let f=i.staging.graph,h=u.extent(f),p=Math.min(this.trimmedExtentZoom(h),20),m=h.percentContainedIn(o.visibleExtent())<.8,g=o.transform.zoom<p-2;(t||m||g)&&this.fitEntities(u)},c=i.staging.graph.hasEntity(e);c?a(c):r.loadEntity(e,(u,d)=>{u||(c=d.data.find(f=>f.id===e),c&&a(c))})}selectNoteID(e){let t=this.context,r=t.services.osm,i=t.systems.gfx.scene;if(!e||!r){t.enter("browse");return}let s=a=>{i.enableLayers("notes");let l=new Map().set(a.id,a);t.enter("select",{selection:l}),this.centerZoomEase(a.loc,19)},o=r.getNote(e);o?s(o):r.loadNote(e,a=>{a||(o=r.getNote(e),o&&s(o))})}_zoomIn(e){return this.setMapParams(void 0,~~this.zoom()+e,void 0,250)}_zoomOut(e){return this.setMapParams(void 0,~~this.zoom()-e,void 0,250)}zoomIn(){return this._zoomIn(1)}zoomInFurther(){return this._zoomIn(4)}canZoomIn(){return this.zoom()<Gp}zoomOut(){return this._zoomOut(1)}zoomOutFurther(){return this._zoomOut(4)}canZoomOut(){return this.zoom()>Ob}centerZoom(e,t,r=0){return this.setMapParams(e,t,void 0,r)}transformEase(e,t=250){return this.transform(e,t)}centerZoomEase(e,t,r=250){return this.setMapParams(e,t,void 0,r)}centerEase(e,t=250){return this.setMapParams(e,void 0,void 0,t)}zoomEase(e,t=250){return this.setMapParams(void 0,e,void 0,t)}fitEntitiesEase(e,t=250){return this.fitEntities(e,t)}effectiveZoom(){let e=this.context.viewport,t=e.centerLoc()[1],r=e.transform.zoom,i=Gr(1,t),s=Gr(1,0),o=Math.log(i/s)/Math.LN2;return Math.min(r+o,Gp)}extent(e){return e===void 0?this.context.viewport.visibleExtent():this.setMapParams(e.center(),this.extentZoom(e))}trimmedExtent(e){if(e===void 0){let s=this.context.viewport,[o,a]=s.dimensions;return new le(s.unproject([70,a-30-70]),s.unproject([o-70,142]))}else return this.setMapParams(e.center(),this.trimmedExtentZoom(e))}extentZoom(e,t){let r=this.context.viewport,[i,s]=t||r.dimensions,o=r.project([e.min[0],e.max[1]]),a=r.project([e.max[0],e.min[1]]),l=(a[0]-o[0])/i,c=(a[1]-o[1])/s,u=Math.log(Math.abs(l))/Math.LN2,d=Math.log(Math.abs(c))/Math.LN2,f=Math.max(u,d),h=r.transform.zoom,p=Math.max(h,19);return isFinite(f)?h-f:p}trimmedExtentZoom(e){let i=this.context.viewport,s=Me(i.dimensions,[140,240]);return this.extentZoom(e,s)}get highlightEdits(){return this._highlightEdits}set highlightEdits(e){if(this._highlightEdits===e)return;this._highlightEdits=e;let t=this.context.systems.gfx;t.scene.dirtyScene(),t.immediateRedraw(),this.emit("mapchange")}get areaFillMode(){return this._currFillMode}set areaFillMode(e){let t=this.context,r=t.systems.gfx,i=t.systems.storage,s=this._currFillMode;s!==e&&(s!=="wireframe"&&(this._toggleFillMode=s,i.setItem("area-fill-toggle",s)),this._currFillMode=e,i.setItem("area-fill",e),r.scene.dirtyScene(),r.immediateRedraw(),this.emit("mapchange"))}get wireframeMode(){return this._currFillMode==="wireframe"}set wireframeMode(e){e?this.areaFillMode!=="wireframe"&&(this.areaFillMode="wireframe"):this.areaFillMode=this._toggleFillMode}};var zp=class extends Se{constructor(e){super(e),this.id="photos",this.dependencies=new Set(["gfx","map","urlhash","ui"]),this._currPhotoLayerID=null,this._currPhotoID=null,this._currDetectionLayerID=null,this._currDetectionID=null,this._filterPhotoTypes=new Set(this.photoTypes),this._filterFromDate=null,this._filterToDate=null,this._filterUsernames=null,this._initPromise=null,this._hashchange=this._hashchange.bind(this),this._layerchange=this._layerchange.bind(this),this._photoChanged=this._photoChanged.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let o of this.dependencies)if(!this.context.systems[o])return Promise.reject(`Cannot init:  ${this.id} requires ${o}`);let e=this.context,t=e.systems.gfx,r=e.systems.map,i=e.systems.urlhash,s=Promise.all([t.initAsync(),r.initAsync(),i.initAsync()]);return this._initPromise=s.then(()=>{i.on("hashchange",this._hashchange),t.scene.on("layerchange",this._layerchange)})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}_hashchange(e,t){let r=this.context.systems.gfx.scene,i=e.get("photo_overlay"),s=t.get("photo_overlay");if(i!==s){let p=new Set;typeof i=="string"&&(p=new Set(i.replace(/;/g,",").split(",")));for(let m of this.layerIDs){let g=r.layers.get(m);g&&(g.enabled=p.has(g.id))}}let o=e.get("photo_dates"),a=t.get("photo_dates");if(o!==a)if(typeof o=="string"){let p=/^(.*)[–_](.*)$/g.exec(o.trim());this.setDateFilter("fromDate",p&&p.length>=2&&p[1]),this.setDateFilter("toDate",p&&p.length>=3&&p[2])}else this._filterToDate=this._filterFromDate=null;let l=e.get("photo_username"),c=t.get("photo_username");l!==c&&this.setUsernameFilter(l);let u=e.get("photo")||"",d=t.get("photo")||"";if(u!==d){let[p,m]=u.split("/",2).filter(Boolean);p&&m?this.selectPhoto(p,m):this.selectPhoto()}let f=e.get("detection")||"",h=t.get("detection")||"";if(f!==h){let[p,m]=f.split("/",2).filter(Boolean);p&&m?this.selectDetection(p,m):this.selectDetection()}}_layerchange(){let e=this.context,t=e.systems.gfx.scene;for(let i of this.detectionLayerIDs)!t.layers.get(i).enabled&&this._currDetectionLayerID===i&&(e.enter("browse"),this.selectDetection());let r=0;for(let i of this.photoLayerIDs){let s=t.layers.get(i);s.enabled&&r++,i===this._currPhotoLayerID&&(s.enabled?this.selectPhoto(this._currPhotoLayerID,this._currPhotoID):this.selectPhoto())}r||this.hideViewer()}_photoChanged(){let e=this.context,t=e.systems.urlhash,r=e.systems.gfx.scene,i=[];for(let l of this.layerIDs){let c=r.layers.get(l);c&&c.supported&&c.enabled&&i.push(l)}t.setParam("photo_overlay",i.length?i.join(","):null);let s;(this._filterFromDate||this._filterToDate)&&(s=(this._filterFromDate||"")+"_"+(this._filterToDate||"")),t.setParam("photo_dates",s),t.setParam("photo_username",this._filterUsernames?this._filterUsernames.join(","):null);let o;this._currPhotoLayerID&&this._currPhotoID&&(o=`${this._currPhotoLayerID}/${this._currPhotoID}`),t.setParam("photo",o);let a;this._currDetectionLayerID&&this._currDetectionID&&(a=`${this._currDetectionLayerID}/${this._currDetectionID}`),t.setParam("detection",a),this.emit("photochange")}photosUsed(){let e={streetside:"Bing Streetside",mapillary:"Mapillary","mapillary-detections":"Mapillary Detected Objects","mapillary-signs":"Mapillary Traffic Signs",kartaview:"KartaView"},t=[];return this._currPhotoLayerID&&this._currPhotoID&&t.push(e[this._currPhotoLayerID]),this._currDetectionLayerID&&this._currDetectionID&&t.push(e[this._currDetectionLayerID]),t}get layerIDs(){return["streetside","mapillary","mapillary-detections","mapillary-signs","kartaview"]}get photoLayerIDs(){return["streetside","mapillary","kartaview"]}get detectionLayerIDs(){return["mapillary-detections","mapillary-signs"]}get photoTypes(){return["flat","panoramic"]}get dateFilters(){return["fromDate","toDate"]}get fromDate(){return this._filterFromDate}get toDate(){return this._filterToDate}get usernames(){return this._filterUsernames}get currPhotoLayerID(){return this._currPhotoLayerID}get currPhotoID(){return this._currPhotoID}get currDetectionLayerID(){return this._currDetectionLayerID}get currDetectionID(){return this._currDetectionID}selectPhoto(e=null,t=null){let r=this.context,i=r.systems.map,s=r.systems.gfx.scene,o=this._currPhotoLayerID!==e||this._currPhotoID!==t;if(this.photoLayerIDs.includes(e)&&!this.isLayerEnabled(e)){s.enableLayers(e);return}if(this._currPhotoLayerID=null,this._currPhotoID=null,s.clearClass("selectphoto"),t&&this.photoLayerIDs.includes(e)){let a=r.services[e];if(!a)return;this._currPhotoLayerID=e,this._currPhotoID=t,s.setClass("selectphoto",e,t),a.selectImageAsync(t).then(l=>{l&&l.id===this._currPhotoID&&(this._currDetectionID||o&&i.centerEase(l.loc))}).then(()=>this.showViewer())}this._photoChanged()}selectDetection(e=null,t=null){let r=this.context,i=r.systems.map,s=r.systems.gfx.scene;if(this.detectionLayerIDs.includes(e)&&!this.isLayerEnabled(e)){s.enableLayers(e);return}if(this._currDetectionLayerID=null,this._currDetectionID=null,s.clearClass("selectdetection"),s.clearClass("highlightphoto"),t&&this.detectionLayerIDs.includes(e)){let o=e.split("-")[0],a=r.services[o];if(!a)return;this._currDetectionLayerID=e,this._currDetectionID=t,s.setClass("selectdetection",e,t),a.selectDetectionAsync(t).then(l=>{if(!l||l.id!==this._currDetectionID)return;if(!r.selectedData().has(l.id)){let d=new Map().set(l.id,l);r.enter("select",{selection:d});return}let c=(l.images??[]).map(d=>d.id);for(let d of c)s.setClass("highlightphoto",o,d);let u;if(this._currPhotoLayerID===o&&c.includes(this._currPhotoID)?u=this._currPhotoID:u=l.bestImageID,l.loc&&(!this._currPhotoID||this._currPhotoID!==u)){let d=new le(l.loc),f=a.getImage(u);f?.loc&&d.extendSelf(f.loc);let h=i.trimmedExtentZoom(d)-.5,p=r.viewport.transform.zoom;i.centerZoomEase(d.center(),Math.min(h,p))}this.selectPhoto(o,u)})}else this.selectPhoto(this._currPhotoLayerID,this._currPhotoID);this._photoChanged()}dateFilterValue(e){return e==="fromDate"?this._filterFromDate:e==="toDate"?this._filterToDate:null}setDateFilter(e,t){let r=t&&new Date(t);r&&!isNaN(r)?t=r.toISOString().slice(0,10):t=null;let i=!1;e==="fromDate"&&(this._filterFromDate=t,i=!0,this._filterFromDate&&this._filterToDate&&new Date(this._filterToDate)<new Date(this._filterFromDate)&&(this._filterToDate=this._filterFromDate)),e==="toDate"&&(this._filterToDate=t,i=!0,this._filterFromDate&&this._filterToDate&&new Date(this._filterToDate)<new Date(this._filterFromDate)&&(this._filterFromDate=this._filterToDate)),i&&this._photoChanged()}setUsernameFilter(e){e&&typeof e=="string"&&(e=e.replace(/;/g,",").split(",")),e&&(e=e.map(t=>t.trim()).filter(Boolean),e.length||(e=null)),this._filterUsernames=e,this._photoChanged()}togglePhotoType(e){this.photoTypes.includes(e)&&(this._filterPhotoTypes.has(e)?this._filterPhotoTypes.delete(e):this._filterPhotoTypes.add(e),this._photoChanged())}isLayerEnabled(e){return this.context.systems.gfx.scene.layers.get(e)?.enabled}showViewer(){let e=this.context,t=this._currPhotoLayerID,r=this._currPhotoID;if(!t||!r)return;e.services[t]?.showViewer()}hideViewer(){for(let e of this.photoLayerIDs)e===this._currPhotoLayerID&&this.selectPhoto(),this.context.services[e]?.hideViewer()}isViewerShowing(){let e=this.context.container().selectAll(".photoviewer");return e.size()&&!e.classed("hide")}shouldFilterByDate(){return this.isLayerEnabled("mapillary")||this.isLayerEnabled("kartaview")||this.isLayerEnabled("streetside")}shouldFilterByPhotoType(){return this.isLayerEnabled("mapillary")||this.isLayerEnabled("streetside")&&this.isLayerEnabled("kartaview")}shouldFilterByUsername(){return!this.isLayerEnabled("mapillary")&&this.isLayerEnabled("kartaview")&&!this.isLayerEnabled("streetside")}showsPhotoType(e){return this.shouldFilterByPhotoType()?this._filterPhotoTypes.has(e):!0}showsFlat(){return this.showsPhotoType("flat")}showsPanoramic(){return this.showsPhotoType("panoramic")}};var kie={value:()=>{}};function eW(){for(var n=0,e=arguments.length,t={},r;n<e;++n){if(!(r=arguments[n]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new Lb(t)}function Lb(n){this._=n}function Iie(n,e){return n.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");if(i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}Lb.prototype=eW.prototype={constructor:Lb,on:function(n,e){var t=this._,r=Iie(n+"",t),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(n=r[s]).type)&&(i=Pie(t[i],n.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(n=r[s]).type)t[i]=JH(t[i],n.name,e);else if(e==null)for(i in t)t[i]=JH(t[i],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new Lb(n)},call:function(n,e){if((i=arguments.length-2)>0)for(var t=new Array(i),r=0,i,s;r<i;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],r=0,i=s.length;r<i;++r)s[r].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],i=0,s=r.length;i<s;++i)r[i].value.apply(e,t)}};function Pie(n,e){for(var t=0,r=n.length,i;t<r;++t)if((i=n[t]).name===e)return i.value}function JH(n,e,t){for(var r=0,i=n.length;r<i;++r)if(n[r].name===e){n[r]=kie,n=n.slice(0,r).concat(n.slice(r+1));break}return t!=null&&n.push({name:e,value:t}),n}var ge=eW;function F1(n,e){let t=n.systems.editor,r=n.systems.l10n,i=ge("change"),s=[],o=[],a=H(null),l=H(null),c=H(null),u=H(null),d,f,h=[],p,m=e.presetField.options;if(Array.isArray(m))for(let _ of m)s.push(_==="undefined"?void 0:_),o.push(e.tHtml(`options.${_}`,{default:_}));else s=[void 0,"yes"],o=[r.tHtml("inspector.unknown"),r.tHtml("inspector.check.yes")],e.type!=="defaultCheck"&&(s.push("no"),o.push(r.tHtml("inspector.check.no")));function g(){if(f=e.id==="oneway_yes",e.id==="oneway"&&h.length){let S=t.staging.graph.entity(h[0]);for(let C in S.tags)if(C in Ya&&S.tags[C]in Ya[C]){f=!0,o[0]=r.tHtml("_tagging.presets.fields.oneway_yes.options.undefined");break}}}function y(){return n.container().select("div.inspector-hover").empty()?!(p==="yes"||f&&!p):!0}function x(_){let S=t.staging.graph,C=h.length&&S.hasEntity(h[0]);if(y()||!C)return _;let k=C.first(),v=C.isClosed()?C.nodes[C.nodes.length-2]:C.last(),A=k<v?"#rapid-icon-forward":"#rapid-icon-backward";return _.selectAll(".reverser-span").html(r.tHtml("inspector.check.reverser")).call(X(A,"inline")),_}let b=function(_){g(),c=_.selectAll(".form-field-input-wrap").data([0]);let S=c.enter().append("label").attr("class","form-field-input-wrap form-field-input-check");S.append("input").property("indeterminate",e.type!=="defaultCheck").attr("type","checkbox").attr("id",e.uid),S.append("span").html(o[0]).attr("class","value"),e.type==="onewayCheck"&&S.append("button").attr("class","reverser"+(y()?" hide":"")).append("span").attr("class","reverser-span"),c=c.merge(S),a=c.selectAll("input"),l=c.selectAll("span.value"),a.on("click",function(C){C.stopPropagation();let k=e.key,v={};Array.isArray(d[k])?s.indexOf("yes")!==-1?v[k]="yes":v[k]=s[0]:v[k]=s[(s.indexOf(p)+1)%s.length],(v[k]==="reversible"||v[k]==="alternating")&&(v[k]=s[0]),i.call("change",this,v)}),e.type==="onewayCheck"&&(u=c.selectAll(".reverser"),u.call(x).on("click",function(C){if(C.preventDefault(),C.stopPropagation(),!h.length)return;let k=v=>{for(let w of h)v=ns(w)(v);return v};t.perform(k),t.commit({annotation:r.t("operations.reverse.annotation.line",{n:1}),selectedIDs:h}),H(this).call(x)}))};return b.entityIDs=function(_){return arguments.length?(h=_,b):h},b.tags=function(_){d=_;let S=e.key;function C(w){return w!=="no"&&w!==""&&w!==void 0&&w!==null}function k(w){w===""&&(w=void 0);let A=s.indexOf(w);return A===-1?`"${w}"`:o[A]}g();let v=Array.isArray(_[S]);p=!v&&_[S]&&_[S].toLowerCase(),e.type==="onewayCheck"&&(p==="1"||p==="-1")&&(p="yes"),a.property("indeterminate",v||e.type!=="defaultCheck"&&!p).property("checked",C(p)),l.html(v?r.tHtml("inspector.multiple_values"):k(p)).classed("mixed",v),c.classed("set",!!p),e.type==="onewayCheck"&&u.classed("hide",y()).call(x)},b.focus=function(){a.node().focus()},xe(b,i,"on")}var tW={passive:!1},B1={capture:!0,passive:!1};function Ub(n){n.stopImmediatePropagation()}function pc(n){n.preventDefault(),n.stopImmediatePropagation()}function Hp(n){var e=n.document.documentElement,t=H(n).on("dragstart.drag",pc,B1);"onselectstart"in e?t.on("selectstart.drag",pc,B1):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Wp(n,e){var t=n.document.documentElement,r=H(n).on("dragstart.drag",null);e&&(r.on("click.drag",pc,B1),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in t?r.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}var Vp=n=>()=>n;function jp(n,{sourceEvent:e,subject:t,target:r,identifier:i,active:s,x:o,y:a,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}jp.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function Die(n){return!n.ctrlKey&&!n.button}function Mie(){return this.parentNode}function Rie(n,e){return e??{x:n.x,y:n.y}}function Fie(){return navigator.maxTouchPoints||"ontouchstart"in this}function Xp(){var n=Die,e=Mie,t=Rie,r=Fie,i={},s=ge("start","drag","end"),o=0,a,l,c,u,d=0;function f(_){_.on("mousedown.drag",h).filter(r).on("touchstart.drag",g).on("touchmove.drag",y,tW).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(_,S){if(!(u||!n.call(this,_,S))){var C=b(this,e.call(this,_,S),_,S,"mouse");C&&(H(_.view).on("mousemove.drag",p,B1).on("mouseup.drag",m,B1),Hp(_.view),Ub(_),c=!1,a=_.clientX,l=_.clientY,C("start",_))}}function p(_){if(pc(_),!c){var S=_.clientX-a,C=_.clientY-l;c=S*S+C*C>d}i.mouse("drag",_)}function m(_){H(_.view).on("mousemove.drag mouseup.drag",null),Wp(_.view,c),pc(_),i.mouse("end",_)}function g(_,S){if(n.call(this,_,S)){var C=_.changedTouches,k=e.call(this,_,S),v=C.length,w,A;for(w=0;w<v;++w)(A=b(this,k,_,S,C[w].identifier,C[w]))&&(Ub(_),A("start",_,C[w]))}}function y(_){var S=_.changedTouches,C=S.length,k,v;for(k=0;k<C;++k)(v=i[S[k].identifier])&&(pc(_),v("drag",_,S[k]))}function x(_){var S=_.changedTouches,C=S.length,k,v;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),k=0;k<C;++k)(v=i[S[k].identifier])&&(Ub(_),v("end",_,S[k]))}function b(_,S,C,k,v,w){var A=s.copy(),E=os(w||C,S),I,M,T;if((T=t.call(_,new jp("beforestart",{sourceEvent:C,target:f,identifier:v,active:o,x:E[0],y:E[1],dx:0,dy:0,dispatch:A}),k))!=null)return I=T.x-E[0]||0,M=T.y-E[1]||0,function R(P,D,N){var F=E,B;switch(P){case"start":i[v]=R,B=o++;break;case"end":delete i[v],--o;case"drag":E=os(N||D,S),B=o;break}A.call(P,_,new jp(P,{sourceEvent:D,subject:T,target:f,identifier:v,active:B,x:E[0]+I,y:E[1]+M,dx:E[0]-F[0],dy:E[1]-F[1],dispatch:A}),k)}}return f.filter=function(_){return arguments.length?(n=typeof _=="function"?_:Vp(!!_),f):n},f.container=function(_){return arguments.length?(e=typeof _=="function"?_:Vp(_),f):e},f.subject=function(_){return arguments.length?(t=typeof _=="function"?_:Vp(_),f):t},f.touchable=function(_){return arguments.length?(r=typeof _=="function"?_:Vp(!!_),f):r},f.on=function(){var _=s.on.apply(s,arguments);return _===s?f:_},f.clickDistance=function(_){return arguments.length?(d=(_=+_)*_,f):Math.sqrt(d)},f}var Gb;function ct(n,e){var t=ge("accept","cancel"),r=n.container(),i=[],s=[],o={},a=null,l=!0,c=!1,u=!1,d=2,f=0,h,p,m=function(y,x){x(s.filter(function(b){var _=b.terms||[];return _.push(b.value),_.some(function(S){return S.toString().toLowerCase().indexOf(y.toLowerCase())!==-1})}))},g=function(y,x){if(!y||y.empty())return;y.classed("combobox-input",!0).on("focus.combo-input",S).on("blur.combo-input",C).on("keydown.combo-input",w).on("keyup.combo-input",A).on("input.combo-input",E).on("mousedown.combo-input",b).each(function(){var B=this.parentNode,O=this.nextSibling;H(B).selectAll(".combobox-caret").filter(function(G){return G===y.node()}).data([y.node()]).enter().insert("div",function(){return O}).attr("class","combobox-caret").on("mousedown.combo-caret",function(G){G.preventDefault(),y.node().focus(),b(G)}).on("mouseup.combo-caret",function(G){G.preventDefault(),_(G)})});function b(B){if(B.button===0){f=+new Date;var O=y.property("selectionStart"),G=y.property("selectionEnd");if(O!==G){var U=Ee(y);y.node().setSelectionRange(U.length,U.length);return}y.on("mouseup.combo-input",_)}}function _(B){if(y.on("mouseup.combo-input",null),B.button===0&&y.node()===document.activeElement){var O=y.property("selectionStart"),G=y.property("selectionEnd");if(O===G){var U=r.selectAll(".combobox");if(U.empty()||U.datum()!==y.node()){var W=f;window.setTimeout(function(){W===f&&R("",function(){k(),D()})},250)}else v()}}}function S(){R("")}function C(){Gb=window.setTimeout(v,75)}function k(){v(),r.insert("div",":first-child").datum(y.node()).attr("class","combobox"+(e?" combobox-"+e:"")).style("position","absolute").style("display","block").style("left","0px").on("mousedown.combo-container",function(B){B.preventDefault()}),r.on("scroll.combo-scroll",D,!0)}function v(){Gb&&(window.clearTimeout(Gb),Gb=void 0),r.selectAll(".combobox").remove(),r.on("scroll.combo-scroll",null)}function w(B){var O=!r.selectAll(".combobox").empty(),G=y.node()?y.node().tagName.toLowerCase():"";switch(B.keyCode){case 8:case 46:B.stopPropagation(),a=null,D(),y.on("input.combo-input",function(){var U=y.property("selectionStart");y.node().setSelectionRange(U,U),y.on("input.combo-input",E)});break;case 9:N(B);break;case 13:B.preventDefault(),B.stopPropagation();break;case 38:if(G==="textarea"&&!O)return;B.preventDefault(),G==="input"&&!O&&k(),I(-1);break;case 40:if(G==="textarea"&&!O)return;B.preventDefault(),G==="input"&&!O&&k(),I(1);break}}function A(B){switch(B.keyCode){case 27:F();break;case 13:N(B);break}}function E(){R(T(),function(){a=null;var B=y.property("value");if(i.length&&(y.property("selectionEnd")===B.length&&(a=P()),a||(a=B)),B.length){var O=r.selectAll(".combobox");O.empty()&&k()}else v();D()})}function I(B){if(i.length){for(var O=-1,G=0;G<i.length;G++)if(a&&i[G].value===a){O=G;break}O=Math.max(Math.min(O+B,i.length-1),0),a=i[O].value,y.property("value",a)}D(),M()}function M(){var B=r.selectAll(".combobox");if(!B.empty()){var O=r.node().getBoundingClientRect(),G=B.node().getBoundingClientRect();if(G.bottom>O.bottom){var U=x?x.node():y.node();U.scrollIntoView({behavior:"instant",block:"center"}),D()}var W=B.selectAll(".combobox-option.selected").node();W&&W.scrollIntoView({behavior:"smooth",block:"nearest"})}}function T(){var B=y.property("value"),O=y.property("selectionStart"),G=y.property("selectionEnd");return O&&G&&(B=B.substring(0,O)),B}function R(B,O){u=!1,m.call(y,B,function(G){u||(i=G,G.forEach(function(U){o[U.value]=U}),O&&O())})}function P(){if(l){var B=c?T():T().toLowerCase();if(B&&!(!isNaN(parseFloat(B))&&isFinite(B))){for(var O=-1,G=0;G<i.length;G++){var U=i[G].value,W=c?U:U.toLowerCase();if(W===B){O=G;break}else O===-1&&W.indexOf(B)===0&&(O=G)}if(O!==-1){var V=i[O].value;return y.property("value",V),y.node().setSelectionRange(B.length,V.length),V}}}}function D(){if(i.length<d||document.activeElement!==y.node()){v();return}var B=!r.selectAll(".combobox").empty();if(B){var O=r.selectAll(".combobox"),G=O.selectAll(".combobox-option").data(i,function(j){return j.value});G.exit().remove(),G.enter().append("a").attr("class",function(j){return"combobox-option "+(j.klass||"")}).attr("title",function(j){return j.title}).each(function(j,Z,Y){let K=H(Y[Z]);typeof j.display=="function"?K.call(j.display):j.display?K.html(j.display):K.text(j.value)}).on("mouseenter",h).on("mouseleave",p).merge(G).classed("selected",function(j){return j.value===a}).on("click.combo-option",N).order();var U=x?x.node():y.node(),W=r.node().getBoundingClientRect(),V=U.getBoundingClientRect();O.style("left",V.left+5-W.left+"px").style("width",V.width-10+"px").style("top",V.height+V.top-W.top+"px")}}function N(B,O){u=!0;var G=y.node();O&&(Ee(y,O.value),h2(y,"change"));var U=Ee(y);G.setSelectionRange(U.length,U.length),O=o[U],t.call("accept",G,O,U),v()}function F(){u=!0;var B=y.node(),O=Ee(y),G=y.property("selectionStart"),U=y.property("selectionEnd");O=O.slice(0,G)+O.slice(U),Ee(y,O),B.setSelectionRange(O.length,O.length),t.call("cancel",B),v()}};return g.canAutocomplete=function(y){return arguments.length?(l=y,g):l},g.caseSensitive=function(y){return arguments.length?(c=y,g):c},g.data=function(y){return arguments.length?(s=y,g):s},g.fetcher=function(y){return arguments.length?(m=y,g):m},g.minItems=function(y){return arguments.length?(d=y,g):d},g.itemsMouseEnter=function(y){return arguments.length?(h=y,g):h},g.itemsMouseLeave=function(y){return arguments.length?(p=y,g):p},xe(g,t,"on")}ct.off=function(n,e){n.on("focus.combo-input",null).on("blur.combo-input",null).on("keydown.combo-input",null).on("keyup.combo-input",null).on("input.combo-input",null).on("mousedown.combo-input",null).on("mouseup.combo-input",null),e.container().on("scroll.combo-scroll",null)};function Zi(n,e){let t=n.systems.assets,r=n.systems.editor,i=n.systems.l10n,s=ge("change"),o=e.presetField;var a=e.type==="multiCombo"||e.type==="manyCombo",l=e.type==="networkCombo",c=e.type==="semiCombo",u=o.options,d=e.type!=="manyCombo"&&o.autoSuggestions!==!1,f=e.type!=="manyCombo"&&o.customValues!==!1,h=o.snake_case||o.snake_case===void 0,p=ct(n,"combo-"+e.safeid).caseSensitive(o.caseSensitive).minItems(a||c?1:2),m=H(null),g=H(null),y=H(null),x=[],b=[],_=[],S,C,k,v=[];t.loadAssetAsync("tagging_deprecated").then(function(U){v=U}).catch(U=>console.error(U)),a&&e.key&&/[^:]$/.test(e.key)&&(e.key+=":");function w(U){return U.replace(/\s+/g,"_").toLowerCase()}function A(U){return U.split(";").map(W=>W.trim()).join(";")}function E(U){U=A(U||"");var W=x.find(function(V){return V.key&&A(V.value)===U});return W?W.key:e.type==="typeCombo"&&!U?"yes":(h?w(U):U)||void 0}function I(U){return U=U||"",e.hasTextForStringID("options."+U)?e.t(`options.${U}`,{default:U}):e.type==="typeCombo"&&U.toLowerCase()==="yes"?"":U}function M(U,W){return U.filter(function(V){return!W.some(function(j){return!j.isMixed&&V.value===j.value})})}function T(U,W){f||U.attr("readonly","readonly"),n.services.taginfo&&d?(U.call(p.fetcher(P),W),P("",D)):(U.call(p,W),R(D))}function R(U){u&&(x=u.map(function(W){return{key:W,value:e.t(`options.${W}`,{default:W}),title:W,display:e.tHtml(`options.${W}`,{default:W}),klass:e.hasTextForStringID(`options.${W}`)?"":"raw-option"}}),p.data(M(x,b)),U&&U(x))}function P(U,W){let V=n.services.taginfo,j=r.staging.graph;if(!V){x=[],W&&W(x);return}var Z=a?V.multikeys:V.values,Y=(a?e.key:"")+U,K=l&&C&&C.indexOf(U.toLowerCase())===0;K&&(Y=C+":");var ne={debounce:U!=="",key:e.key,query:Y};_.length&&(ne.geometry=j.geometry(_[0])),Z(ne,function(ie,q){if(!ie){q=q.filter(function(te){return e.type==="typeCombo"&&te.value==="yes"?!1:!te.count||te.count>10});var se=me.deprecatedTagValuesByKey(v)[e.key];se&&(q=q.filter(function(te){return se.indexOf(te.value)===-1})),K&&(q=q.filter(function(te){return te.value.toLowerCase().indexOf(C+":")===0})),m.classed("empty-combobox",q.length===0),x=q.map(function(te){var Q=te.value;a&&(Q=Q.replace(e.key,""));var _e=e.t(`options.${Q}`,{default:Q});return{key:Q,value:_e,display:e.tHtml(`options.${Q}`,{default:Q}),title:te.title||_e,klass:e.hasTextForStringID(`options.${Q}`)?"":"raw-option"}}),x=M(x,b),W&&W(x)}})}function D(U){if(a||c)k=e.placeholder||i.t("inspector.add");else{var W=U.map(function(Z){return Z.value}).filter(function(Z){return Z.length<20}),V=W.length>1?W:U.map(function(Z){return Z.key});k=e.placeholder||V.slice(0,3).join(", ")}/(…|\.\.\.)$/.test(k)||(k+="\u2026");var j;!a&&!c&&S&&Array.isArray(S[e.key])?j=i.t("inspector.multiple_values"):j=k,m.selectAll("input").attr("placeholder",j)}function N(){var U={},W;if(a||c){W=E(Ee(y))||"",m.classed("active",!1),Ee(y,"");var V=W.split(";").filter(Boolean);if(!V.length)return;if(a)Ge(V).forEach(function(Y){var K=(e.key||"")+Y;if(S){var ne=S[K];if(typeof ne=="string"&&ne.toLowerCase()!=="no")return}K=n.cleanTagKey(K),e.keys.push(K),U[K]="yes"});else if(c){var j=b.map(function(Y){return Y.key});j=j.concat(V),U[e.key]=n.cleanTagValue(Ge(j).filter(Boolean).join(";"))}window.setTimeout(function(){y.node().focus()},10)}else{var Z=Ee(y);if(!Z&&Array.isArray(S[e.key]))return;W=n.cleanTagValue(E(Z)),U[e.key]=W||void 0}s.call("change",this,U)}function F(){let U=n.systems.rapid,W=_?.length&&_[0];return W&&U.acceptIDs.has(W)}function B(U,W){U.preventDefault(),U.stopPropagation();let V=e.key;if(!(V==="source"&&F())){var j={};if(a)j[W.key]=void 0;else if(c){var Z=b.map(function(Y){return Y.key===W.key?null:Y.key}).filter(Boolean);Z=Ge(Z),j[V]=Z.length?Z.join(";"):void 0}s.call("change",this,j)}}function O(U){m=U.selectAll(".form-field-input-wrap").data([0]);var W=a||c?"multicombo":"combo";if(m=m.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+W).merge(m),a||c){m=m.selectAll(".chiplist").data([0]);var V="chiplist";(e.key==="destination"||e.key==="via")&&(V+=" full-line-chips"),m=m.enter().append("ul").attr("class",V).on("click",function(){window.setTimeout(function(){y.node().focus()},10)}).merge(m),g=m.selectAll(".input-wrap").data([0]),g=g.enter().append("li").attr("class","input-wrap").merge(g),y=g.selectAll("input").data([0])}else y=m.selectAll("input").data([0]);if(y=y.enter().append("input").attr("type","text").attr("id",e.uid).call(Oe).call(T,U).merge(y),l){var j=e.entityExtent,Z=j&&fc(j.center());C=Z&&Z.toLowerCase()}y.on("change",N).on("blur",N),y.on("keydown.field",function(Y){switch(Y.keyCode){case 13:y.node().blur(),Y.stopPropagation();break}}),(a||c)&&(p.on("accept",function(){y.node().blur(),y.node().focus()}),y.on("focus",function(){m.classed("active",!0)}))}O.tags=function(U){S=U;let W=e.key,V=e.keys;if(a||c){b=[];var j;if(a){for(var Z in U)if(!(W&&Z.indexOf(W)!==0)&&!(!W&&V.indexOf(Z)===-1)){var Y=U[Z];if(!(!Y||typeof Y=="string"&&Y.toLowerCase()==="no")){var K=W?Z.slice(W.length):Z;b.push({key:Z,value:I(K),isMixed:Array.isArray(Y)})}}W?(V=b.map(function(Ye){return Ye.key}),j=n.maxCharsForTagKey-mv(W)):j=n.maxCharsForTagKey}else if(c){var ne=[],ie;Array.isArray(U[W])?(U[W].forEach(function(Ye){var mt=Ge((Ye||"").split(";")).filter(Boolean);ne=ne.concat(mt),ie?ie=ie.filter(Yr=>mt.includes(Yr)):ie=mt}),ne=Ge(ne).filter(Boolean)):(ne=Ge((U[W]||"").split(";")).filter(Boolean),ie=ne),b=ne.map(function(Ye){return{key:Ye,value:I(Ye),isMixed:!ie.includes(Ye)}});var q=mv(ie.join(";"));j=n.maxCharsForTagValue-q,q>0&&(j-=1)}j=Math.max(0,j);var se=c&&!Array.isArray(U[W]),te=M(x,b);p.data(te);var Q=!f&&!te.length||j<=0;m.selectAll(".chiplist .input-wrap").style("display",Q?"none":null);var _e=m.selectAll(".chip").data(b);_e.exit().remove();var je=_e.enter().insert("li",".input-wrap").attr("class","chip");je.append("span"),je.append("a"),_e=_e.merge(je).order().classed("raw-value",function(Ye){var mt=Ye.key;return a&&(mt=mt.replace(W,"")),!e.hasTextForStringID("options."+mt)}).classed("draggable",se).classed("mixed",function(Ye){return Ye.isMixed}).attr("title",function(Ye){return Ye.isMixed?i.t("inspector.unshared_value_tooltip"):null}),se&&G(_e),_e.select("span").text(Ye=>Ye.value),e.key==="source"&&F()||_e.select("a").attr("href","#").on("click",B).attr("class","remove").text("\xD7")}else{var Dt=Array.isArray(U[W]),xt=Dt&&U[W].map(function(Ye){return I(Ye)}).filter(Boolean),nr=!Dt&&U[W]&&!(e.type==="typeCombo"&&U[W]==="yes"),on=nr&&!e.hasTextForStringID("options."+U[W]),rn=nr&&!on,fr=!f||rn;Ee(y,Dt?"":I(U[W])).classed("raw-value",on).classed("known-value",rn).attr("readonly",fr?"readonly":void 0).attr("title",Dt?xt.join(`
`):void 0).attr("placeholder",Dt?i.t("inspector.multiple_values"):k||"").classed("mixed",Dt).on("keydown.deleteCapture",function(Ye){if(fr&&rn&&(Ye.keyCode===Xe.keyCodes["\u232B"]||Ye.keyCode===Xe.keyCodes["\u2326"])){Ye.preventDefault(),Ye.stopPropagation();var mt={};mt[W]=void 0,s.call("change",this,mt)}})}};function G(U){let W=e.key;var V,j;U.call(Xp().on("start",function(Z){V={x:Z.x,y:Z.y},j=null}).on("drag",function(Z){var Y=Z.x-V.x,K=Z.y-V.y;if(!(!H(this).classed("dragging")&&Math.sqrt(Math.pow(Y,2)+Math.pow(K,2))<=5)){var ne=U.nodes().indexOf(this);H(this).classed("dragging",!0),j=null;var ie=null,q=H(this).node().offsetWidth;W==="destination"||W==="via"?m.selectAll(".chip").style("transform",function(se,te){var Q=H(this).node();return ne===te?"translate("+Y+"px, "+K+"px)":te>ne&&Z.y>Q.offsetTop?((j===null||te>j)&&(j=te),"translateY(-100%)"):te<ne&&Z.y<Q.offsetTop+Q.offsetHeight?((j===null||te<j)&&(j=te),"translateY(100%)"):null}):m.selectAll(".chip").each(function(se,te){var Q=H(this).node();ne!==te&&Z.x<Q.offsetLeft+Q.offsetWidth+5&&Z.x>Q.offsetLeft&&Z.y<Q.offsetTop+Q.offsetHeight&&Z.y>Q.offsetTop&&(j=te,ie=Q.offsetTop)}).style("transform",function(se,te){var Q=H(this).node();if(ne===te)return"translate("+Y+"px, "+K+"px)";if(Q.offsetTop===ie){if(te<ne&&te>=j)return"translateX("+q+"px)";if(te>ne&&te<=j)return"translateX(-"+q+"px)"}return null})}}).on("end",function(){if(H(this).classed("dragging")){var Z=U.nodes().indexOf(this);if(H(this).classed("dragging",!1),m.selectAll(".chip").style("transform",null),typeof j=="number"){var Y=b[Z];b.splice(Z,1),b.splice(j,0,Y);var K={};b.length?K[W]=b.map(function(ne){return ne.key}).join(";"):K[W]=void 0,s.call("change",this,K)}V=void 0,j=void 0}}))}return O.focus=function(){y.node().focus()},O.entityIDs=function(U){return arguments.length?(_=U||[],O):_},xe(O,s,"on")}function Ri(n,e){let t=n.systems.assets,r=n.systems.editor,i=n.systems.l10n,s=n.systems.presets,o=ge("change"),a=H(null),l=H(null),c=[],u,d={};e.type==="tel"&&t.loadAssetAsync("phone_formats").then(x=>{d=x.phoneFormats,p()}).catch(x=>console.error(x));function f(){let x=r.staging.graph,_=["brand","network","operator","flag"].includes(e.id)&&c.length&&c.some(S=>{let C=x.hasEntity(S);if(!C)return!1;if(C.tags.wikidata)return!0;let v=s.match(C,x)?.suggestion,w=e.id;return v&&!!C.tags[w]&&!!C.tags[w+":wikidata"]});e.locked(_)}function h(x){let b=e.presetField;f();let _=e.locked(),S=x.selectAll(".form-field-input-wrap").data([0]);if(S=S.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(S),a=S.selectAll("input").data([0]),a=a.enter().append("input").attr("type",e.type==="identifier"||e.type==="roadheight"?"text":e.type).attr("id",e.uid).classed(e.type,!0).call(Oe).merge(a),a.classed("disabled",!!_).attr("readonly",_||null).on("input",y(!0)).on("blur",y()).on("change",y()),e.type==="tel")p();else if(e.type==="number"){a.attr("type","text");let C=b.increment()??1,k=S.selectAll(".increment, .decrement").data(i.isRTL()?[C,-C]:[-C,C]);k.enter().append("button").attr("class",function(v){return`form-field-button ${v>0?"increment":"decrement"}`}).merge(k).on("click",function(v,w){v.preventDefault();let E=(a.node().value||"0").split(";");E=E.map(I=>{let M=parseFloat(I.trim(),10);return isFinite(M)?g(M+w):I.trim()}),a.node().value=E.join(";"),y()()})}else e.type==="identifier"&&b.urlFormat&&b.pattern?(a.attr("type","text"),l=S.selectAll(".foreign-id-permalink").data([0]),l.enter().append("button").call(X("#rapid-icon-out-link")).attr("class","form-field-button foreign-id-permalink").attr("title",function(){let C=/^https?:\/\/(.{1,}?)\//.exec(b.urlFormat);if(C.length>=2&&C[1]){let k=C[1];return i.t("icons.view_on",{domain:k})}return""}).on("click",function(C){C.preventDefault();let k=m();if(k){let v=b.urlFormat.replace(/{value}/,encodeURIComponent(k));window.open(v,"_blank")}}).merge(l)):e.type==="url"&&(a.attr("type","text"),l=S.selectAll(".foreign-id-permalink").data([0]),l.enter().append("button").call(X("#rapid-icon-out-link")).attr("class","form-field-button foreign-id-permalink").attr("title",()=>i.t("icons.visit_website")).on("click",function(C){C.preventDefault();let k=m();k&&window.open(k,"_blank")}).merge(l))}function p(){if(a.empty()||!Object.keys(d).length)return;let x=e.entityExtent,b=x&&fc(x.center()),_=b&&d[b.toLowerCase()];_&&a.attr("placeholder",_)}function m(){let x=e.presetField.pattern,b=Ee(a).trim().split(";")[0];return e.type==="url"&&/^https?:\/\//i.test(b)?b:e.type==="identifier"&&x?b&&b.match(new RegExp(x)):null}function g(x){let b=e.presetField;return b.minValue!==void 0&&(x=Math.max(x,b.minValue)),b.maxValue!==void 0&&(x=Math.min(x,b.maxValue)),x}function y(x){return function(){let b=e.key,_={},S=Ee(a);if(x||(S=n.cleanTagValue(S)),!(!S&&Array.isArray(u[b]))){if(!x){if(e.type==="number"&&S){let C=S.split(";");C=C.map(k=>{let v=parseFloat(k.trim(),10);return isFinite(v)?g(v):k.trim()}),S=C.join(";")}Ee(a,S)}_[b]=S||void 0,o.call("change",this,_,x)}}}return h.entityIDs=function(x){return arguments.length?(c=x,h):c},h.tags=function(x){u=x;let b=e.key,_=Array.isArray(x[b]);if(Ee(a,!_&&x[b]?x[b]:"").attr("title",_?x[b].filter(Boolean).join(`
`):void 0).attr("placeholder",_?i.t("inspector.multiple_values"):e.placeholder||i.t("inspector.unknown")).classed("mixed",_),l&&!l.empty()){let S=!m();l.classed("disabled",S)}},h.focus=function(){let x=a.node();x&&x.focus()},xe(h,o,"on")}function ZI(n,e){let t=n.systems.l10n,r=ge("change"),i=H(null),s;function o(c){let u=c.selectAll(".form-field-input-wrap").data([0]);u=u.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(u);let d=u.selectAll("ul").data([0]);d=d.enter().append("ul").attr("class","rows").merge(d),i=d.selectAll("li").data(e.keys);let f=i.enter().append("li").attr("class",h=>`labeled-input preset-access-${h}`);f.append("div").attr("class","label preset-label-access").attr("for",h=>`preset-input-access-${h}`).html(h=>e.tHtml(`types.${h}`)),f.append("div").attr("class","preset-input-access-wrap").append("input").attr("type","text").attr("class",h=>`preset-input-access preset-input-access-${h}`).call(Oe).each((h,p,m)=>{H(m[p]).call(ct(n,`access-${h}`).data(o.options(h)))}),i=i.merge(f),u.selectAll(".preset-input-access").on("change",a).on("blur",a)}function a(c,u){let d={},f=n.cleanTagValue(Ee(H(this)));!f&&typeof s[u]!="string"||(d[u]=f||void 0,r.call("change",this,d))}o.options=function(c){let u=["no","permissive","private","permit","destination"];return c!=="access"&&(u.unshift("yes"),u.push("designated"),c==="bicycle"&&u.push("dismount")),u.map(d=>({title:e.t(`options.${d}.description`),value:d}))};let l={footway:{foot:"designated",motor_vehicle:"no"},steps:{foot:"yes",motor_vehicle:"no",bicycle:"no",horse:"no"},pedestrian:{foot:"yes",motor_vehicle:"no"},cycleway:{motor_vehicle:"no",bicycle:"designated"},bridleway:{motor_vehicle:"no",horse:"designated"},path:{foot:"yes",motor_vehicle:"no",bicycle:"yes",horse:"yes"},motorway:{foot:"no",motor_vehicle:"yes",bicycle:"no",horse:"no"},trunk:{motor_vehicle:"yes"},primary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},secondary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},tertiary:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},residential:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},unclassified:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},service:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},motorway_link:{foot:"no",motor_vehicle:"yes",bicycle:"no",horse:"no"},trunk_link:{motor_vehicle:"yes"},primary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},secondary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},tertiary_link:{foot:"yes",motor_vehicle:"yes",bicycle:"yes",horse:"yes"},busway:{access:"no",bus:"designated",emergency:"yes"}};return o.tags=function(c){s=c,Ee(i.selectAll(".preset-input-access"),u=>typeof c[u]=="string"?c[u]:"").classed("mixed",u=>c[u]&&Array.isArray(c[u])).attr("title",u=>c[u]&&Array.isArray(c[u])&&c[u].filter(Boolean).join(`
`)).attr("placeholder",u=>{if(c[u]&&Array.isArray(c[u]))return t.t("inspector.multiple_values");if(u==="access")return"yes";if(c.access&&typeof c.access=="string")return c.access;if(c.highway)if(typeof c.highway=="string"){if(l[c.highway]&&l[c.highway][u])return l[c.highway][u]}else{let d=c.highway.filter(Boolean).map(f=>l[f]&&l[f][u]).filter(Boolean);if(d.length===c.highway.length&&new Set(d).size===1)return d[0]}return e.placeholder})},o.focus=function(){i.selectAll(".preset-input-access").node().focus()},xe(o,r,"on")}function JI(n,e){let t=n.systems.assets,r=n.systems.editor,i=n.systems.l10n,s=ge("change"),o=H(null),a=H(null),l=[],c,u,d=[{format:[["housenumber","street"],["city","postcode"]]}];t.loadAssetAsync("address_formats").then(_=>{d=_.addressFormats,o.empty()||o.call(g)}).catch(_=>console.error(_));function f(){let _=e.entityExtent.center(),S=new le(_).padByMeters(200),C=r.intersects(S).filter(k).map(v=>{let w=n.viewport.project(_),A=Ar(r.staging.graph.childNodes(v),w,n.viewport);return{title:v.tags.name,value:v.tags.name,dist:A.distance}}).sort((v,w)=>v.dist-w.dist);return q1(C,"value");function k(v){return v.tags.highway&&v.tags.name&&v.type==="way"}}function h(){let _=e.entityExtent.center(),S=new le(_).padByMeters(200),C=r.intersects(S).filter(k).map(v=>({title:v.tags["addr:city"]||v.tags.name,value:v.tags["addr:city"]||v.tags.name,dist:ht(v.extent(r.staging.graph).center(),_)})).sort((v,w)=>v.dist-w.dist);return q1(C,"value");function k(v){return!!(v.tags.name&&(v.tags.admin_level==="8"&&v.tags.boundary==="administrative"||v.tags.border_type==="city"||v.tags.place==="city"||v.tags.place==="town"||v.tags.place==="village")||v.tags["addr:city"])}}function p(_){let S=e.entityExtent.center(),C=new le(S).padByMeters(200),k=r.intersects(C).filter(v).map(w=>({title:w.tags[_],value:w.tags[_],dist:ht(w.extent(r.staging.graph).center(),S)})).sort((w,A)=>w.dist-A.dist);return q1(k,"value");function v(w){return!l.includes(w.id)&&w.tags[_]}}function m(){if(!u)return;let _;for(let A=0;A<d.length;A++){let E=d[A];if(!E.countryCodes)_=E;else if(E.countryCodes.includes(u)){_=E;break}}let S=_.dropdowns||["city","county","country","district","hamlet","neighbourhood","place","postcode","province","quarter","state","street","subdistrict","suburb"],C=_.widths||{housenumber:1/3,street:2/3,city:2/3,state:1/4,postcode:1/3};function k(A){let E=A.reduce((I,M)=>I+(C[M]||.5),0);return A.map(I=>({id:I,width:(C[I]||.5)/E}))}let v=a.selectAll(".addr-row").data(_.format,A=>A.toString());v.exit().remove(),v.enter().append("div").attr("class","addr-row").selectAll("input").data(k).enter().append("input").property("type","text").call(x).attr("class",A=>`addr-${A.id}`).call(Oe).each(w).style("width",A=>A.width*100+"%");function w(A){if(!S.includes(A.id))return;let E=A.id==="street"?f:A.id==="city"?h:p;H(this).call(ct(n,`address-${A.id}`).minItems(1).caseSensitive(!0).fetcher(function(I,M){M(E(`addr:${A.id}`))}))}a.selectAll("input").on("blur",y()).on("change",y()),a.selectAll("input:not(.combobox-input)").on("input",y(!0)),c&&b(c)}function g(_){o=_,a=_.selectAll(".form-field-input-wrap").data([0]),a=a.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(a);let S=e.entityExtent.center(),C;n.inIntro?C=i.t("intro.graph.countrycode"):C=fc(S),C&&(u=C.toLowerCase(),m())}function y(_){return function(){let S={};a.selectAll("input").each((C,k,v)=>{let w=v[k],A=e.key+":"+C.id,E=_?w.value:n.cleanTagValue(w.value);Array.isArray(c[A])&&!E||(S[A]=E||void 0)}),s.call("change",this,S,_)}}function x(_){return _.attr("placeholder",function(S){let C=e.key+":"+S.id;if(c&&Array.isArray(c[C]))return i.t("inspector.multiple_values");if(u){let k=S.id+"!"+u,v=e.hasTextForStringID("placeholders."+k)?k:S.id;return e.presetField.t(`placeholders.${v}`)}})}function b(_){Ee(a.selectAll("input"),function(S){let C=e.key+":"+S.id,k=_[C];return typeof k=="string"?k:""}).attr("title",S=>{let C=e.key+":"+S.id,k=_[C];return k&&Array.isArray(k)&&k.filter(Boolean).join(`
`)}).classed("mixed",S=>{let C=e.key+":"+S.id;return Array.isArray(_[C])}).call(x)}return g.entityIDs=function(_){return arguments.length?(l=_,g):l},g.tags=function(_){c=_,b(_)},g.focus=function(){let _=a.selectAll("input").node();_&&_.focus()},xe(g,s,"on")}function eP(n,e){let t=n.systems.l10n,r=ge("change");var i=H(null),s=H(null),o;function a(c){function u(p){return p.replace(":","")}s=c.selectAll(".form-field-input-wrap").data([0]),s=s.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(s);var d=s.selectAll("ul").data([0]);d=d.enter().append("ul").attr("class","rows rows-table").merge(d);var f=["cycleway:left","cycleway:right"];i=d.selectAll("li").data(f);var h=i.enter().append("li").attr("class",function(p){return"labeled-input preset-cycleway-"+u(p)});h.append("div").attr("class","label preset-label-cycleway").attr("for",function(p){return"preset-input-cycleway-"+u(p)}).html(function(p){return e.tHtml("types."+p)}),h.append("div").attr("class","preset-input-cycleway-wrap").append("input").attr("type","text").attr("class",function(p){return"preset-input-cycleway preset-input-"+u(p)}).call(Oe).each(function(p){H(this).call(ct(n,"cycleway-"+u(p)).data(a.options(p)))}),i=i.merge(h),s.selectAll(".preset-input-cycleway").on("change",l).on("blur",l)}function l(c,u){var d=n.cleanTagValue(Ee(H(this)));if(!(!d&&(Array.isArray(o.cycleway)||Array.isArray(o[u])))){(d==="none"||d==="")&&(d=void 0);var f=u==="cycleway:left"?"cycleway:right":"cycleway:left",h=typeof o.cycleway=="string"?o.cycleway:o[f];h&&Array.isArray(h)&&(h=h[0]),(h==="none"||h==="")&&(h=void 0);var p={};d===h?p={cycleway:d,"cycleway:left":void 0,"cycleway:right":void 0}:(p={cycleway:void 0},p[u]=d,p[f]=h),r.call("change",this,p)}}return a.options=function(){return e.presetField.options.map(function(c){return{title:e.t(`options.${c}.description`),value:c}})},a.tags=function(c){o=c;var u=typeof c.cycleway=="string"&&c.cycleway;Ee(i.selectAll(".preset-input-cycleway"),function(d){return u||(!c.cycleway&&typeof c[d]=="string"?c[d]:"")}).attr("title",function(d){if(Array.isArray(c.cycleway)||Array.isArray(c[d])){var f=[];return Array.isArray(c.cycleway)&&(f=f.concat(c.cycleway)),Array.isArray(c[d])&&(f=f.concat(c[d])),f.filter(Boolean).join(`
`)}return null}).attr("placeholder",function(d){return Array.isArray(c.cycleway)||Array.isArray(c[d])?t.t("inspector.multiple_values"):e.placeholder}).classed("mixed",function(d){return Array.isArray(c.cycleway)||Array.isArray(c[d])})},a.focus=function(){var c=s.selectAll("input").node();c&&c.focus()},xe(a,r,"on")}function $b(n,e){var t=ge("change"),r=40,i=200,s=[];function o(a){let c=n.systems.editor.staging.graph.entity(s[0]).lanes();if(!n.container().select(".inspector-wrap.inspector-hidden").empty()||!a.node().parentNode){a.call(o.off);return}var u=a.selectAll(".form-field-input-wrap").data([0]);u=u.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(u);var d=u.selectAll(".surface").data([0]),f=um(u),h=f[0]-c.lanes.length*r*1.5+r*.5;d=d.enter().append("svg").attr("width",f[0]).attr("height",300).attr("class","surface").merge(d);var p=d.selectAll(".lanes").data([0]);p=p.enter().append("g").attr("class","lanes").merge(p),p.attr("transform",function(){return"translate("+h/2+", 0)"});var m=p.selectAll(".lane").data(c.lanes);m.exit().remove();var g=m.enter().append("g").attr("class","lane");g.append("g").append("rect").attr("y",50).attr("width",r).attr("height",i),g.append("g").attr("class","forward").append("text").attr("y",40).attr("x",14).text("\u25B2"),g.append("g").attr("class","bothways").append("text").attr("y",40).attr("x",14).text("\u25B2\u25BC"),g.append("g").attr("class","backward").append("text").attr("y",40).attr("x",14).text("\u25BC"),m=m.merge(g),m.attr("transform",function(y){return"translate("+r*y.index*1.5+", 0)"}),m.select(".forward").style("visibility",function(y){return y.direction==="forward"?"visible":"hidden"}),m.select(".bothways").style("visibility",function(y){return y.direction==="bothways"?"visible":"hidden"}),m.select(".backward").style("visibility",function(y){return y.direction==="backward"?"visible":"hidden"})}return o.entityIDs=function(a){s=a},o.tags=function(){},o.focus=function(){},o.off=function(){},xe(o,t,"on")}$b.supportsMultiselection=!1;var Bie=0;function zb(n,e){var t=Bie++,r=H(null),i=function(x){r=x,x.each(f)},s=Wt(!1),o=Wt("top"),a=Wt("center"),l=Wt(H(null)),c,u=Wt(""),d=Wt(!0);i.displayType=function(x){return arguments.length?(u=Wt(x),i):u},i.hasArrow=function(x){return arguments.length?(d=Wt(x),i):d},i.placement=function(x){return arguments.length?(o=Wt(x),i):o},i.alignment=function(x){return arguments.length?(a=Wt(x),i):a},i.scrollContainer=function(x){return arguments.length?(l=Wt(x),i):l},i.content=function(x){return arguments.length?(c=x,i):c},i.isShown=function(){var x=r.select(".popover-"+t);return!x.empty()&&x.classed("in")},i.show=function(){r.each(h)},i.updateContent=function(){r.each(p)},i.hide=function(){r.each(g)},i.toggle=function(){r.each(y)},i.destroy=function(x,b){b=b||".popover-"+t,x.on("pointerenter.popover",null).on("pointerleave.popover",null).on("pointerup.popover",null).on("pointerdown.popover",null).on("click.popover",null).selectAll(b).remove()},i.destroyAny=function(x){x.call(i.destroy,".popover")};function f(){var x=H(this),b=s.apply(this,arguments),_=x.selectAll(".popover-"+t).data([0]),S=_.enter().append("div").attr("class","popover popover-"+t+" "+(e||"")).classed("arrowed",d.apply(this,arguments));S.append("div").attr("class","popover-arrow"),S.append("div").attr("class","popover-inner"),_=S.merge(_),b&&_.classed("fade",!0);var C=u.apply(this,arguments);if(C==="hover"){var k;x.on("pointerenter.popover",function(v){if(v.pointerType){if(v.pointerType!=="mouse"){k=v.timeStamp;return}else if(k&&v.timeStamp-k<1500)return}v.buttons===0&&h.apply(this,arguments)}).on("pointerleave.popover",function(){g.apply(this,arguments)}).on("focus.popover",function(){h.apply(this,arguments)}).on("blur.popover",function(){g.apply(this,arguments)})}else C==="clickFocus"&&(x.on("pointerdown.popover",function(v){v.preventDefault(),v.stopPropagation()}).on("pointerup.popover",function(v){v.preventDefault(),v.stopPropagation()}).on("click.popover",y),_.attr("tabindex",0).on("blur.popover",function(){x.each(function(){g.apply(this,arguments)})}))}function h(){var x=H(this),b=x.selectAll(".popover-"+t);b.empty()&&(x.call(i.destroy),x.each(f),b=x.selectAll(".popover-"+t)),b.classed("in",!0);var _=u.apply(this,arguments);_==="clickFocus"&&(x.classed("active",!0),b.node().focus()),x.each(p)}function p(){var x=H(this);c&&x.selectAll(".popover-"+t+" > .popover-inner").call(c.apply(this,arguments)),m.apply(this,arguments),m.apply(this,arguments),m.apply(this,arguments)}function m(){var x=H(this),b=x.selectAll(".popover-"+t),_=l&&l.apply(this,arguments),S=_&&!_.empty()&&_.node(),C=S?S.scrollLeft:0,k=S?S.scrollTop:0,v=o.apply(this,arguments);b.classed("left",!1).classed("right",!1).classed("top",!1).classed("bottom",!1).classed(v,!0);var w=a.apply(this,arguments),A=.5;w==="leading"?A=0:w==="trailing"&&(A=1);var E=D(x.node()),I=D(b.node()),M;switch(v){case"top":M={x:E.x+(E.w-I.w)*A,y:E.y-I.h};break;case"bottom":M={x:E.x+(E.w-I.w)*A,y:E.y+E.h};break;case"left":M={x:E.x-I.w,y:E.y+(E.h-I.h)*A};break;case"right":M={x:E.x+E.w,y:E.y+(E.h-I.h)*A};break}if(M){if(S&&(v==="top"||v==="bottom")){var T=M.x;M.x+I.w>S.offsetWidth-10?M.x=S.offsetWidth-10-I.w:M.x<10&&(M.x=10);var R=x.selectAll(".popover-"+t+" > .popover-arrow"),P=Math.min(Math.max(I.w/2-(M.x-T),10),I.w-10);R.style("left",~~P+"px")}b.style("left",~~M.x+"px").style("top",~~M.y+"px")}else b.style("left",null).style("top",null);function D(N){var F=H(N).style("position");return F==="absolute"||F==="static"?{x:N.offsetLeft-C,y:N.offsetTop-k,w:N.offsetWidth,h:N.offsetHeight}:{x:0,y:0,w:N.offsetWidth,h:N.offsetHeight}}}function g(){var x=H(this);u.apply(this,arguments)==="clickFocus"&&x.classed("active",!1),x.selectAll(".popover-"+t).classed("in",!1)}function y(){H(this).select(".popover-"+t).classed("in")?g.apply(this,arguments):h.apply(this,arguments)}return i}function de(n){let e=n.systems.l10n,t=zb(n,"tooltip").displayType("hover"),r=Wt(null),i=Wt(null),s=Wt(null);return t.title=function(o){return arguments.length?(r=Wt(o),t):r},t.heading=function(o){return arguments.length?(i=Wt(o),t):i},t.shortcut=function(o){return arguments.length?(s=Wt(o),t):s},t.content(function(){let o=i.apply(this,arguments),a=r.apply(this,arguments),l=s.apply(this,arguments);return function(c){let u=c.selectAll(".tooltip-heading").data(o?[o]:[]);u.exit().remove(),u.enter().append("div").attr("class","tooltip-heading").merge(u).text(m=>m);let d=c.selectAll(".tooltip-text").data(a?[a]:[]);d.exit().remove(),d.enter().append("div").attr("class","tooltip-text").merge(d).html(m=>m);let f=c.selectAll(".tooltip-keyhint").data(l?[l]:[]);f.exit().remove(),f.enter().append("div").attr("class","tooltip-keyhint").text(m=>m.length===1?e.t("tooltip_keyhint"):null).append("span").attr("class","tooltip-keys").selectAll("kbd.shortcut").data(m=>typeof m=="string"?m.split(""):[]).enter().each((m,g,y)=>{let x=H(y[g]);x.append("kbd").attr("class","shortcut").text(b=>Te.display(n,b)),g<l.length-1&&x.append("span").text("+")})}}),t}var sf=[],Hb=/^(.*):([a-z]{2,3}(?:-[A-Z][a-z]{3})?(?:-[A-Z]{2})?)$/;function tP(n,e){let t=n.systems.assets,r=n.systems.editor,i=n.systems.l10n,s=n.systems.presets;var o=ge("change","input"),a=n.services.wikipedia,l=H(null),c=H(null),u,d;t.loadAssetAsync("languages").then(b).catch(M=>console.error(M));var f={};t.loadAssetAsync("territory_languages").then(M=>f=M.territoryLanguages).catch(M=>console.error(M));var h=ct(n,"localized-lang").fetcher(A).minItems(0),p=H(null),m=[],g=de(n).title(i.t("translate.translate")).placement("left"),y,x=[];function b(M){if(sf.length)return;var T={sr:"sr-Cyrl","sr-Cyrl":!1};let R=M.languages;for(var P in R)if(T[P]!==!1){var D=P;T[P]&&(D=T[P]),sf.push({localName:i.languageName(D,{localOnly:!0}),nativeName:R[D].nativeName,code:P,label:i.languageName(D)})}}function _(){let M=r.staging.graph;var T=e.id==="name"&&x.length&&x.some(function(R){var P=M.hasEntity(R);if(!P)return!1;if(P.tags.wikidata||P.tags["name:etymology:wikidata"])return!0;var D=s.match(P,M);if(D){var N=D.suggestion,F=D.fields(),B=F.some(function(V){return V.id==="brand"}),O=F.some(function(V){return V.id==="operator"}),G=D.addTags.name,U=D.addTags["brand:wikidata"],W=D.addTags["operator:wikidata"];return N&&G&&(U&&!B||W&&!O)}return!1});e.locked(T)}function S(M){var T=m.map(function(F){return F.lang}),R=new Set(T.filter(Boolean));for(var P in M){var D=P.match(Hb);if(D&&D[1]===e.key&&D[2]){var N={lang:D[2],value:M[P]};R.has(N.lang)?(m[T.indexOf(N.lang)].value=N.value,R.delete(N.lang)):m.push(N)}}m.forEach(function(F){F.lang&&R.has(F.lang)&&(F.value="")})}function C(M){p=M,_();var T=e.locked(),R=M.selectAll(".form-field-input-wrap").data([0]);R=R.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(R),l=R.selectAll(".localized-main").data([0]),l=l.enter().append("input").attr("type","text").attr("id",e.uid).attr("class","localized-main").call(Oe).merge(l),l.classed("disabled",!!T).attr("readonly",T||null).on("input",N(!0)).on("blur",N()).on("change",N());var P=R.selectAll(".localized-add").data([0]);P=P.enter().append("button").attr("class","localized-add form-field-button").call(X("#rapid-icon-plus")).merge(P),P.classed("disabled",!!T).call(T?g.destroy:g).on("click",D),d&&!m.length&&S(d),c=M.selectAll(".localized-multilingual").data([0]),c=c.enter().append("div").attr("class","localized-multilingual").merge(c),c.call(E),c.selectAll("button, input").classed("disabled",!!T).attr("readonly",T||null);function D(F){if(F.preventDefault(),!e.locked()){var B=i.languageCode().toLowerCase(),O=m.find(function(U){return U.lang===B}),G=B.indexOf("en")>-1;(G||O)&&(B="",O=m.find(function(U){return U.lang===B})),O||(m.unshift({lang:B,value:""}),c.call(E))}}function N(F){return function(B){if(e.locked()){B.preventDefault();return}var O=Ee(H(this));if(F||(O=n.cleanTagValue(O)),!(!O&&Array.isArray(d[e.key]))){var G={};G[e.key]=O||void 0,o.call("change",this,G,F)}}}}function k(M){return e.key+":"+M}function v(M,T){var R={},P=Ee(H(this)).toLowerCase(),D=sf.find(function(B){return B.label.toLowerCase()===P||B.localName&&B.localName.toLowerCase()===P||B.nativeName&&B.nativeName.toLowerCase()===P});D&&(P=D.code),T.lang&&T.lang!==P&&(R[k(T.lang)]=void 0);var N=P&&n.cleanTagKey(k(P)),F=Ee(H(this.parentNode).selectAll(".localized-value"));N&&F?R[N]=F:N&&y&&y[T.lang]&&(R[N]=y[T.lang]),T.lang=P,o.call("change",this,R)}function w(M,T){if(T.lang){var R=n.cleanTagValue(Ee(H(this)))||void 0;if(!(!R&&Array.isArray(T.value))){var P={};P[k(T.lang)]=R,T.value=R,o.call("change",this,P)}}}function A(M,T){var R=M.toLowerCase(),P=[i.localeCode(),i.languageCode()];u&&f[u]&&(P=P.concat(f[u]));var D=[];P.forEach(function(N){var F=sf.find(function(B){return B.code===N});F&&D.push(F)}),D=Ge(D.concat(sf)),T(D.filter(function(N){return N.label.toLowerCase().indexOf(R)>=0||N.localName&&N.localName.toLowerCase().indexOf(R)>=0||N.nativeName&&N.nativeName.toLowerCase().indexOf(R)>=0||N.code.toLowerCase().indexOf(R)>=0}).map(function(N){return{value:N.label}}))}function E(M){var T=M.selectAll("div.entry").data(m,function(P){return P.lang});T.exit().style("top","0").style("max-height","240px").transition().duration(200).style("opacity","0").style("max-height","0px").remove();var R=T.enter().append("div").attr("class","entry").each(function(P,D){var N=H(this),F=xo(D),B=N.append("label").attr("class","field-label").attr("for",F),O=B.append("span").attr("class","label-text");O.append("span").attr("class","label-textvalue").html(i.tHtml("translate.localized_translation_label")),O.append("span").attr("class","label-textannotation"),B.append("button").attr("class","remove-icon-multilingual").on("click",function(G,U){if(!e.locked()){G.preventDefault(),m.splice(m.indexOf(U),1);var W=U.lang&&k(U.lang);if(W&&W in d){delete d[W];var V={};V[W]=void 0,o.call("change",this,V);return}E(M)}}).call(X("#rapid-operation-delete")),N.append("input").attr("class","localized-lang").attr("id",F).attr("type","text").attr("placeholder",i.t("translate.localized_translation_language")).on("blur",v).on("change",v).call(h),N.append("input").attr("type","text").attr("class","localized-value").on("blur",w).on("change",w)});R.style("margin-top","0px").style("max-height","0px").style("opacity","0").transition().duration(200).style("margin-top","10px").style("max-height","240px").style("opacity","1").on("end",function(){H(this).style("max-height","").style("overflow","visible")}),T=T.merge(R),T.order(),T.classed("present",!0),Ee(T.select(".localized-lang"),function(P){var D=sf.find(function(N){return N.code===P.lang});return D?D.label:P.lang}),Ee(T.select(".localized-value"),function(P){return typeof P.value=="string"?P.value:""}).attr("title",function(P){return Array.isArray(P.value)?P.value.filter(Boolean).join(`
`):null}).attr("placeholder",function(P){return Array.isArray(P.value)?i.t("inspector.multiple_values"):i.t("translate.localized_translation_name")}).classed("mixed",function(P){return Array.isArray(P.value)})}C.tags=function(M){if(d=M,typeof M.wikipedia=="string"&&!y){y={};var T=M.wikipedia.match(/([^:]+):(.+)/);T&&T[0]&&T[1]&&a.translations(T[1],T[2],function(P,D){P||!D||(y=D)})}var R=Array.isArray(M[e.key]);Ee(l,typeof M[e.key]=="string"?M[e.key]:"").attr("title",R?M[e.key].filter(Boolean).join(`
`):void 0).attr("placeholder",R?i.t("inspector.multiple_values"):e.placeholder).classed("mixed",R),S(M),p.call(C)},C.focus=function(){l.node().focus()},C.entityIDs=function(M){return arguments.length?(x=M,m=[],I(),C):x};function I(){var M=e.entityExtent,T=M&&fc(M.center());u=T&&T.toLowerCase()}return xe(C,o,"on")}function rP(n,e){let t=n.systems.l10n,r=ge("change");var i=H(null),s=H(null),o,a,l=ct(n,"roadspeed"),c=ct(n,"roadspeed-unit").data(["km/h","mph"].map(p)),u=[20,30,40,50,60,70,80,90,100,110,120],d=[5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80];function f(g){var y=g.selectAll(".form-field-input-wrap").data([0]);y=y.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(y),s=y.selectAll("input.roadspeed-number").data([0]),s=s.enter().append("input").attr("type","text").attr("class","roadspeed-number").attr("id",e.uid).call(Oe).call(l).merge(s),s.on("change",m).on("blur",m);var x=e.entityExtent.center();a=nH(x)==="mph",i=y.selectAll("input.roadspeed-unit").data([0]),i=i.enter().append("input").attr("type","text").attr("class","roadspeed-unit").call(c).merge(i),i.on("blur",b).on("change",b);function b(){a=Ee(i)==="mph",Ee(i,a?"mph":"km/h"),h(),m()}}function h(){l.data((a?d:u).map(p)),Ee(i,a?"mph":"km/h")}function p(g){return{value:g.toString(),title:g.toString()}}function m(){var g={},y=Ee(s).trim();let x=e.key;!y&&Array.isArray(o[x])||(y?isNaN(y)||!a?g[x]=n.cleanTagValue(y):g[x]=n.cleanTagValue(y+" mph"):g[x]=void 0,r.call("change",this,g))}return f.tags=function(g){o=g;let y=e.key;var x=g[y],b=Array.isArray(x);b||(x&&x.indexOf("mph")>=0?(x=parseInt(x,10).toString(),a=!0):x&&(a=!1)),h(),Ee(s,typeof x=="string"?x:"").attr("title",b?x.filter(Boolean).join(`
`):null).attr("placeholder",b?t.t("inspector.multiple_values"):e.placeholder).classed("mixed",b)},f.focus=function(){s.node().focus()},xe(f,r,"on")}function Jo(n,e){let t=n.systems.l10n,r=n.services[e.qid?"wikidata":"osmwikibase"],i={},s=H(null),o=H(null),a,l;function c(){r&&(s.classed("tag-reference-loading",!0),r.getDocs(e,u))}function u(h,p){if(o.html(""),!p||!p.title){o.append("p").attr("class","tag-reference-description").html(t.tHtml("inspector.no_documentation_key")),d();return}p.imageURL?o.append("img").attr("class","tag-reference-wiki-image").attr("src",p.imageURL).on("load",()=>d()).on("error",function(){H(this).remove(),d()}):d();let m;p.description?m=t.htmlForLocalizedText(p.description,p.descriptionLocaleCode):m=t.tHtml("inspector.no_documentation_key"),o.append("p").attr("class","tag-reference-description").html(m).append("a").attr("class","tag-reference-edit").attr("target","_blank").attr("title",t.t("inspector.edit_reference")).attr("href",p.editURL).call(X("#rapid-icon-edit","inline")),p.wiki&&o.append("a").attr("class","tag-reference-link").attr("target","_blank").attr("href",p.wiki.url).call(X("#rapid-icon-out-link","inline")).append("span").html(t.tHtml(p.wiki.text)),e.key==="comment"&&o.append("a").attr("class","tag-reference-comment-link").attr("target","_blank").call(X("#rapid-icon-out-link","inline")).attr("href",t.t("commit.about_changeset_comments_link")).append("span").html(t.tHtml("commit.about_changeset_comments"))}function d(){a=!0,s.classed("tag-reference-loading",!1),o.classed("expanded",!0).transition().duration(200).style("max-height","200px").style("opacity","1"),l=!0,s.selectAll("svg.icon use").each((h,p,m)=>{let g=H(m[p]);g.attr("href")==="#rapid-icon-info"&&g.attr("href","#rapid-icon-info-filled")})}function f(){o.transition().duration(200).style("max-height","0px").style("opacity","0").on("end",()=>{o.classed("expanded",!1)}),l=!1,s.selectAll("svg.icon use").each((h,p,m)=>{let g=H(m[p]);g.attr("href")==="#rapid-icon-info-filled"&&g.attr("href","#rapid-icon-info")})}return i.button=function(h,p,m){s=h.selectAll(".tag-reference-button").data([0]),s=s.enter().append("button").attr("class","tag-reference-button "+(p||"")).attr("title",t.t("icons.information")).call(X("#rapid-icon-"+(m||"inspect"))).merge(s),s.on("click",function(g){g.stopPropagation(),g.preventDefault(),this.blur(),l?f():a?d():c()})},i.body=function(h){let p=e.qid||e.key+"-"+(e.value||"");o=h.selectAll(".tag-reference-body").data([p],m=>m),o.exit().remove(),o=o.enter().append("div").attr("class","tag-reference-body").style("max-height","0").style("opacity","0").merge(o),l===!1&&f()},i.showing=function(h){return arguments.length?(l=h,i):l},i}var Fi=class{constructor(e,t,r=[],i={}){this.context=e,this.presetField=t,this.entityIDs=r,this.options=Object.assign({show:!0,wrap:!0,remove:!0,revert:!0,info:!0},i),this.id=t.id,this.type=t.type,this.title=t.title(),this.label=t.label(),this.terms=t.terms(),this.placeholder=t.placeholder(),this.default=t.default,this.key=t.key,this.keys=t.keys,this.safeid=t.safeid,this.t=t.t,this.tHtml=t.tHtml,this.hasTextForStringID=t.hasTextForStringID,this.uid=xo(`form-field-${t.safeid}`),this._show=this.options.show,this._internal=null,this._state="",this._tags={};let o=e.systems.editor.staging.graph,a=e.systems.l10n;this.entityExtent=null,r?.length&&(this.entityExtent=Mt(r,o)),this._locked=!1,this._lockedTip=de(e).title(a.t("inspector.lock.suggestion",{label:this.label})).placement("bottom"),this.dispatch=ge("change","revert"),xe(this,this.dispatch,"on"),this.isAllowed=this.isAllowed.bind(this),this.isModified=this.isModified.bind(this),this.isShown=this.isShown.bind(this),this.remove=this.remove.bind(this),this.render=this.render.bind(this),this.revert=this.revert.bind(this),this.tagsContainFieldKey=this.tagsContainFieldKey.bind(this),this._show&&this._createField()}_createField(){this._internal||(this._internal=of[this.type](this.context,this).on("change",(e,t)=>{this.dispatch.call("change",this,e,t)}),typeof this._internal.entityIDs=="function"&&this._internal.entityIDs(this.entityIDs))}isModified(){if(!this.entityIDs?.length)return!1;let e=this.context.systems.editor,t=e.base.graph,r=e.staging.graph;return this.entityIDs.some(i=>{let s=t.hasEntity(i),o=r.hasEntity(i);return this.keys.some(a=>s?o.tags[a]!==s.tags[a]:o.tags[a])})}tagsContainFieldKey(){return this.keys.some(e=>{if(this.type==="multiCombo"){for(let t in this._tags)if(t.indexOf(e)===0)return!0;return!1}else if(this.type==="localized")for(let t in this._tags){let r=t.match(Hb);if(r&&r[1]===this.key&&r[2])return!0}return this._tags[e]!==void 0})}revert(e){if(e.stopPropagation(),e.preventDefault(),!this.entityIDs?.length||this._locked)return;let t=new Set(this.keys);t.has("crossing")&&(t.add("crossing:markings"),t.add("crossing:signals")),(t.has("crossing:markings")||t.has("crossing:signals"))&&t.add("crossing"),this.dispatch.call("revert",this,[...t])}remove(e){if(e.stopPropagation(),e.preventDefault(),this._locked)return;let t=new Set(this.keys);t.has("crossing")&&(t.add("crossing:markings"),t.add("crossing:signals")),(t.has("crossing:markings")||t.has("crossing:signals"))&&t.add("crossing");let r={};for(let i of t)r[i]=void 0;this.dispatch.call("change",this,r)}render(e){let t=this.context.systems.l10n,r=e.selectAll(".form-field").data([this]),i=r.enter().append("div").attr("class",`form-field form-field-${this.safeid}`).classed("nowrap",!this.options.wrap);if(this.options.wrap){let a=i.append("label").attr("class","field-label").attr("for",this.uid),l=a.append("span").attr("class","label-text");l.append("span").attr("class","label-textvalue").html(this.label),l.append("span").attr("class","label-textannotation"),this.options.remove&&a.append("button").attr("class","remove-icon").attr("title",t.t("icons.remove")).call(X("#rapid-operation-delete")),this.options.revert&&a.append("button").attr("class","modified-icon").attr("title",t.t("icons.undo")).call(X(t.isRTL()?"#rapid-icon-redo":"#rapid-icon-undo"))}r=r.merge(i),r.select(".field-label > .remove-icon").on("click",this.remove),r.select(".field-label > .modified-icon").on("click",this.revert),r.each((a,l,c)=>{let u=H(c[l]);this._internal||this._createField();let d;if(this.options.wrap&&this.options.info){let f=this.key||"";this.type==="multiCombo"&&(f=f.replace(/:$/,"")),d=Jo(this.context,this.reference||{key:f}),this._state==="hover"&&d.showing(!1)}u.call(this._internal),d&&u.call(d.body).select(".field-label").call(d.button),this._internal.tags(this._tags)}),r.classed("locked",this._locked).classed("modified",this.isModified()).classed("present",this.tagsContainFieldKey());let o=r.selectAll(".field-label .label-textannotation").selectAll(".icon").data(this._locked?[0]:[]);o.exit().remove(),o.enter().append("svg").attr("class","icon").append("use").attr("xlink:href","#fas-lock"),r.call(this._locked?this._lockedTip:this._lockedTip.destroy)}state(e){return e===void 0?this._state:(this._state=e,this)}tags(e){return e===void 0?this._tags:(this._tags=e,this.tagsContainFieldKey()&&!this._show&&(this._show=!0,this._internal||this._createField()),this)}locked(e){return e===void 0?this._locked:(this._locked=e,this)}show(){if(this._show=!0,this._internal||this._createField(),this.default&&this.key&&this._tags[this.key]!==this.default){let e={};e[this.key]=this.default,this.dispatch.call("change",this,e)}}isShown(){return this._show}isAllowed(){let e=this.context,t=e.systems.editor.staging.graph,r=e.systems.locations,i=this.presetField;if(!this.entityIDs?.length)return!0;if(this.entityIDs.length>1&&of[this.type].supportsMultiselection===!1||i.geometry&&!this.entityIDs.every(o=>i.matchGeometry(t.geometry(o)))||this.entityExtent&&i.locationSetID&&!r.locationSetsAt(this.entityExtent.center())[i.locationSetID])return!1;let s=i.prerequisiteTag;return!(s&&!this.tagsContainFieldKey()&&!this.entityIDs.every(a=>{let l=t.entity(a);if(s.key){let c=l.tags[s.key];if(!c)return!1;if(s.valueNot)return s.valueNot!==c;if(s.value)return s.value===c}else if(s.keyNot&&l.tags[s.keyNot])return!1;return!0}))}focus(){this._internal&&this._internal.focus()}};function qp(n,e){let t=n.systems.l10n,r=ge("change");var i=H(null),s=H(null),o=H(null),a=H(null),l=(e.presetField.options||e.keys).slice(),c,u,d={},f=[];function h(){var b=s.selectAll(".form-field-input-radio label.active input");return!b.empty()&&b.datum()}function p(b){b.classed("preset-radio",!0),s=b.selectAll(".form-field-input-wrap").data([0]);var _=s.enter().append("div").attr("class","form-field-input-wrap form-field-input-radio");_.append("span").attr("class","placeholder"),s=s.merge(_),i=s.selectAll(".placeholder"),o=s.selectAll("label").data(l),_=o.enter().append("label"),_.append("input").attr("type","radio").attr("name",e.id).attr("value",function(S){return e.t(`options.${S}`,{default:S})}).attr("checked",!1),_.append("span").html(function(S){return e.tHtml(`options.${S}`,{default:S})}),o=o.merge(_),a=o.selectAll("input").on("change",x)}function m(b,_){var S=h()||_.layer!==void 0,C=n.systems.presets,k=C.field(S),v=C.field("layer"),w=S==="bridge"||S==="tunnel"||_.layer!==void 0,A=b.selectAll(".structure-extras-wrap").data(S?[0]:[]);A.exit().remove(),A=A.enter().append("div").attr("class","structure-extras-wrap").merge(A);var E=A.selectAll("ul").data([0]);E=E.enter().append("ul").attr("class","rows").merge(E),k?((!c||c.id!==S)&&(c=new Fi(n,k,f,{wrap:!1}).on("change",g)),c.tags(_)):c=null;var I=E.selectAll(".structure-type-item").data(c?[c]:[],function(P){return P.id});I.exit().remove();var M=I.enter().insert("li",":first-child").attr("class","labeled-input structure-type-item");M.append("div").attr("class","label structure-label-type").attr("for","preset-input-"+S).text(t.t("inspector.type")),M.append("div").attr("class","structure-input-type-wrap"),I=I.merge(M),c&&I.selectAll(".structure-input-type-wrap").call(c.render),v&&w?(u||(u=new Fi(n,v,f,{wrap:!1}).on("change",y)),u.tags(_),e.keys=Ur(e.keys,["layer"])):(u=null,e.keys=e.keys.filter(function(P){return P!=="layer"}));var T=E.selectAll(".structure-layer-item").data(u?[u]:[]);T.exit().remove();var R=T.enter().append("li").attr("class","labeled-input structure-layer-item");R.append("div").attr("class","label structure-label-layer").attr("for","preset-input-layer").html(t.tHtml("inspector.radio.structure.layer")),R.append("div").attr("class","structure-input-layer-wrap"),T=T.merge(R),u&&T.selectAll(".structure-input-layer-wrap").call(u.render)}function g(b,_){var S=h();if(S){var C=b[S];C!=="no"&&(d[S]=C),e.type==="structureRadio"&&((C==="no"||S!=="bridge"&&S!=="tunnel"||S==="tunnel"&&C==="building_passage")&&(b.layer=void 0),b.layer===void 0&&(S==="bridge"&&C!=="no"&&(b.layer="1"),S==="tunnel"&&C!=="no"&&C!=="building_passage"&&(b.layer="-1"))),r.call("change",this,b,_)}}function y(b,_){b.layer==="0"&&(b.layer=void 0),r.call("change",this,b,_)}function x(){var b={},_;e.key&&(b[e.key]=void 0),a.each(function(S){var C=H(this).property("checked");if(C&&(_=S),e.key)C&&(b[e.key]=S);else{var k=d[_]||"yes";b[S]=C?k:void 0}}),e.type==="structureRadio"&&(_==="bridge"?b.layer="1":_==="tunnel"&&b.tunnel!=="building_passage"?b.layer="-1":b.layer=void 0),r.call("change",this,b)}return p.tags=function(b){a.property("checked",function(C){return e.key?b[e.key]===C:typeof b[C]=="string"&&b[C].toLowerCase()!=="no"});function _(C){return e.key?Array.isArray(b[e.key])&&b[e.key].includes(C):Array.isArray(b[C])}o.classed("active",function(C){return e.key?Array.isArray(b[e.key])&&b[e.key].includes(C)||b[e.key]===C:Array.isArray(b[C])||!!(b[C]&&b[C].toLowerCase()!=="no")}).classed("mixed",_).attr("title",function(C){return _(C)?t.t("inspector.unshared_value_tooltip"):null});var S=a.filter(function(){return this.checked});S.empty()?i.html(t.tHtml("inspector.none")):(i.html(S.attr("value")),d[S.datum()]=b[S.datum()]),e.type==="structureRadio"&&(b.waterway&&!d.tunnel&&(d.tunnel="culvert"),s.call(m,b))},p.focus=function(){a.node().focus()},p.entityIDs=function(b){return arguments.length?(f=b,d={},p):f},p.isAllowed=function(){return f.length===1},xe(p,r,"on")}function nP(n,e){let t=n.systems.l10n,r=ge("change"),i=H(null),s;function o(l){let c=l.selectAll(".form-field-input-wrap").data([0]);c=c.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(c),i=c.selectAll("textarea").data([0]),i=i.enter().append("textarea").attr("id",e.uid).call(Oe).on("input",a(!0)).on("blur",a()).on("change",a()).merge(i)}function a(l){return function(){let c=e.key,u=Ee(i);if(l||(u=n.cleanTagValue(u)),!u&&Array.isArray(s[c]))return;let d={};d[c]=u||void 0,r.call("change",this,d,l)}}return o.tags=function(l){s=l;let c=e.key,u=Array.isArray(l[c]),d=u?t.t("inspector.multiple_values"):e.placeholder||t.t("inspector.unknown");Ee(i,!u&&l[c]?l[c]:"").attr("title",u?l[c].filter(Boolean).join(`
`):void 0).attr("placeholder",d).classed("mixed",u)},o.focus=function(){i.node().focus()},xe(o,r,"on")}function iP(n,e){let t=n.systems.editor,r=n.systems.l10n,i=n.services.wikidata,s=ge("change");var o=H(null),a=H(null),l=null,c=null,u="",d=[],f=e.keys&&e.keys.find(function(_){return _.includes("wikipedia")}),h=e.key==="wikidata"?"name":e.key.split(":")[0],p=ct(n,"combo-"+e.safeid).caseSensitive(!0).minItems(1);function m(_){o=_;var S=_.selectAll(".form-field-input-wrap").data([0]);S=S.enter().append("div").attr("class","form-field-input-wrap form-field-input-"+e.type).merge(S);var C=S.selectAll("ul").data([0]);C=C.enter().append("ul").attr("class","rows").merge(C);var k=C.selectAll("li.wikidata-search").data([0]),v=k.enter().append("li").attr("class","wikidata-search");v.append("input").attr("type","text").attr("id",e.uid).style("flex","1").call(Oe).on("focus",function(){var I=H(this).node();I.setSelectionRange(0,I.value.length)}).on("blur",function(){x()}).call(p.fetcher(g)),p.on("accept",function(I){I&&(l=I.id,y())}).on("cancel",function(){x()}),v.append("button").attr("class","form-field-button wiki-link").attr("title",r.t("icons.view_on",{domain:"wikidata.org"})).call(X("#rapid-icon-out-link")).on("click",function(I){I.preventDefault(),u&&window.open(u,"_blank")}),k=k.merge(v),a=k.select("input");var w=["description","identifier"],A=C.selectAll("li.labeled-input").data(w),E=A.enter().append("li").attr("class",function(I){return"labeled-input preset-wikidata-"+I});E.append("div").attr("class","label").html(function(I){return r.tHtml("wikidata."+I)}),E.append("input").attr("type","text").call(Oe).classed("disabled","true").attr("readonly","true"),E.append("button").attr("class","form-field-button").attr("title",r.t("icons.copy")).call(X("#rapid-operation-copy")).on("click",function(I){I.preventDefault(),H(this.parentNode).select("input").node().select(),document.execCommand("copy")})}function g(_,S){if(!_&&h){let k=t.staging.graph;for(var C in d){let v=k.hasEntity(d[C]);if(v.tags[h]){_=v.tags[h];break}}}i.itemsForSearchQuery(_,function(k,v){if(!k){var w=v.map(function(A){return{id:A.id,value:A.label+" ("+A.id+")",title:A.description,terms:A.aliases}});S&&S(w)}})}function y(){let _=e.key,S={};if(S[_]=l,s.call("change",this,S),!f)return;let C=t.staging.graph,k=d;i.entityByQID(l,(v,w)=>{if(v||!w?.sitelinks)return;let A=t.staging.graph;if(A!==C)return;let E=new Set(i.languagesToQuery());for(let T of["labels","descriptions"]){if(!w[T])continue;let R=Object.keys(w[T]);R.length!==0&&E.add(R[0])}let I,M=!1;for(let T of E){let R=T.replace("-","_")+"wiki";if(w.sitelinks[R]){M=!0,I=T+":"+w.sitelinks[R].title;break}}if(!M){let T=Object.keys(w.sitelinks).filter(R=>R.endsWith("wiki"));if(T.length===0)I=null;else{let R=T[0];I=R.slice(0,-4).replace("_","-")+":"+w.sitelinks[R].title}}if(I&&(I=n.cleanTagValue(I)),!(typeof I>"u"))for(let T of k){let R=A.entity(T),P=Object.assign({},R.tags);if(I===null){if(!P[f])continue;delete P[f]}else{if(P[f]===I)continue;P[f]=I}t.perform(Ft(T,P))}})}function x(){var _="";c&&(_=b(c,"labels"),_.length===0&&(_=c.id.toString())),Ee(a,_)}m.tags=function(_){let S=e.key;var C=Array.isArray(_[S]);if(a.attr("title",C?_[S].filter(Boolean).join(`
`):null).attr("placeholder",C?r.t("inspector.multiple_values"):"").classed("mixed",C),l=typeof _[S]=="string"&&_[S]||"",!/^Q[0-9]*$/.test(l)){k();return}u="https://wikidata.org/wiki/"+l,i.entityByQID(l,function(v,w){if(v){k();return}c=w,x();var A=b(w,"descriptions");o.select("button.wiki-link").classed("disabled",!1),o.select(".preset-wikidata-description").style("display",function(){return A.length>0?"flex":"none"}).select("input").attr("value",A),o.select(".preset-wikidata-identifier").style("display",function(){return w.id?"flex":"none"}).select("input").attr("value",w.id)});function k(){c=null,x(),o.select(".preset-wikidata-description").style("display","none"),o.select(".preset-wikidata-identifier").style("display","none"),o.select("button.wiki-link").classed("disabled",!0),l&&l!==""?u="https://wikidata.org/wiki/Special:Search?search="+l:u=""}};function b(_,S){if(!_[S])return"";var C=_[S],k=Object.keys(C);if(k.length===0)return"";var v=i.languagesToQuery();for(var w in v){var A=v[w],E=C[A];if(E&&E.value&&E.value.length>0)return E.value}return C[k[0]].value}return m.entityIDs=function(_){return arguments.length?(d=_,m):d},m.focus=function(){a.node().focus()},xe(m,s,"on")}function Wb(n,e){let t=n.systems.assets,r=n.systems.editor,i=n.systems.l10n,s=n.services.wikipedia,o=n.services.wikidata,a=ge("change"),l=H(null),c=H(null),u="",d,f,h=[];t.loadAssetAsync("wmf_sitematrix").then(C=>{h=C,f&&S(f)}).catch(C=>console.error(C));let p=ct(n,"wikipedia-lang").fetcher((C,k)=>{let v=C.toLowerCase();k(h.filter(w=>w[0].toLowerCase().indexOf(v)>=0||w[1].toLowerCase().indexOf(v)>=0||w[2].toLowerCase().indexOf(v)>=0).map(w=>({value:w[1]})))}),m=ct(n,"wikipedia-title").fetcher((C,k)=>{if(!C){C="";let w=r.staging.graph;for(let A in d){let E=w.hasEntity(d[A]);if(E.tags.name){C=E.tags.name;break}}}(C.length>7?s.search:s.suggestions)(x()[2],C,(w,A)=>{k(A.map(E=>({value:E})))})});function g(C){let k=C.selectAll(".form-field-input-wrap").data([0]);k=k.enter().append("div").attr("class",`form-field-input-wrap form-field-input-${e.type}`).merge(k);let v=k.selectAll(".wiki-lang-container").data([0]);v=v.enter().append("div").attr("class","wiki-lang-container").merge(v),l=v.selectAll("input.wiki-lang").data([0]),l=l.enter().append("input").attr("type","text").attr("class","wiki-lang").attr("placeholder",i.t("translate.localized_translation_language")).call(Oe).call(p).merge(l),l.on("blur",b).on("change",b);let w=k.selectAll(".wiki-title-container").data([0]);w=w.enter().append("div").attr("class","wiki-title-container").merge(w),c=w.selectAll("input.wiki-title").data([0]),c=c.enter().append("input").attr("type","text").attr("class","wiki-title").attr("id",e.uid).call(Oe).call(m).merge(c),c.on("blur",function(){_(!0)}).on("change",function(){_(!1)});let A=w.selectAll(".wiki-link").data([0]);A=A.enter().append("button").attr("class","form-field-button wiki-link").attr("title",i.t("icons.view_on",{domain:"wikipedia.org"})).call(X("#rapid-icon-out-link")).merge(A),A.on("click",E=>{E.preventDefault(),u&&window.open(u,"_blank")})}function y(C){let k=i.languageCode().toLowerCase();for(let v in h){let w=h[v];if(w[2]===k)return w}return C?["","",""]:["English","English","en"]}function x(C){let k=Ee(l).toLowerCase();for(let v in h){let w=h[v];if(w[0].toLowerCase()===k||w[1].toLowerCase()===k||w[2]===k)return w}return y(C)}function b(){Ee(l,x()[1]),_(!0)}function _(C){let k=Ee(c),v=k.match(/https?:\/\/([-a-z]+)\.wikipedia\.org\/(?:wiki|\1-[-a-z]+)\/([^#]+)(?:#(.+))?/),w=v&&h.find(M=>v[1]===M[2]),A={};if(w){let M=w[1];if(k=decodeURIComponent(v[2]).replace(/_/g," "),v[3]){let T;T=decodeURIComponent(v[3]),k+="#"+T.replace(/_/g," ")}k=k.slice(0,1).toUpperCase()+k.slice(1),Ee(l,M),Ee(c,k)}if(k?A.wikipedia=n.cleanTagValue(x()[2]+":"+k):A.wikipedia=void 0,a.call("change",this,A),C||!k||!x()[2])return;let E=r.staging.graph,I=d;o.itemsByTitle(x()[2],k,(M,T)=>{if(M||!T||!Object.keys(T).length)return;let R=r.staging.graph;if(R!==E)return;let P=Object.keys(T),D=P&&P.find(N=>N.match(/^Q\d+$/));for(let N of I){let F=R.entity(N),B=Object.assign({},F.tags);B.wikidata!==D&&(B.wikidata=D,r.perform(Ft(N,B)))}})}g.tags=C=>{f=C,S(C)};function S(C){let k=e.key,v=typeof C[k]=="string"?C[k]:"",w=v.match(/([^:]+):([^#]+)(?:#(.+))?/),A=w&&w[1],E=w&&w[2],I=w&&w[3],M=A&&h.find(T=>A===T[2]);if(M){let T=M[1];Ee(l,T),Ee(c,E+(I?"#"+I:""));let R=g.encodePath(E,I);u=`https://${A}.wikipedia.org/wiki/${R}`}else if(Ee(c,v),v&&v!=="")Ee(l,""),u=`https://${y()[2]}.wikipedia.org/w/index.php?fulltext=1&search=${v}`;else{let T=x(!0);Ee(l,T[1]),u=""}}return g.encodePath=(C,k)=>{let v=C.replace(/ /g,"_"),w=encodeURIComponent(v),A=g.encodeURIAnchorFragment(k);return`${w}${A}`},g.encodeURIAnchorFragment=C=>{if(!C)return"";let k=C.replace(/ /g,"_");return"#"+encodeURIComponent(k)},g.entityIDs=C=>arguments.length?(d=C,g):d,g.focus=()=>{c.node().focus()},xe(g,a,"on")}Wb.supportsMultiselection=!1;var of={access:ZI,address:JI,check:F1,combo:Zi,cycleway:eP,defaultCheck:F1,email:Ri,identifier:Ri,lanes:$b,localized:tP,roadspeed:rP,roadheight:Ri,manyCombo:Zi,multiCombo:Zi,networkCombo:Zi,number:Ri,onewayCheck:F1,radio:qp,semiCombo:Zi,structureRadio:qp,tel:Ri,text:Ri,textarea:nP,typeCombo:Zi,url:Ri,wikidata:iP,wikipedia:Wb};var Nie=!0,Oie=30,Lie=6,Yp=class extends Se{constructor(e){super(e),this.id="presets",this.dependencies=new Set(["assets","l10n","locations","storage","urlhash"]),this.geometries=["point","vertex","line","area","relation"];let t=new Co(e,"point",{name:"Point",tags:{},geometry:["point","vertex"],matchScore:.1}),r=new Co(e,"line",{name:"Line",tags:{},geometry:["line"],matchScore:.1}),i=new Co(e,"area",{name:"Area",tags:{area:"yes"},geometry:["area"],matchScore:.1}),s=new Co(e,"relation",{name:"Relation",tags:{},geometry:["relation"],matchScore:.1});this.collection=new wo(e,[t,r,i,s]),this._defaults={point:[],vertex:[],line:[],area:[],relation:[]},this._presets={point:t,line:r,area:i,relation:s},this._fields={},this._categories={},this._universal=[],this._recentIDs=null,this.addablePresetIDs=null,this._geometryIndex={point:{},vertex:{},line:{},area:{},relation:{}},this._initPromise=null}initAsync(){if(this._initPromise)return this._initPromise;for(let o of this.dependencies)if(!this.context.systems[o])return Promise.reject(`Cannot init:  ${this.id} requires ${o}`);let e=this.context,t=e.systems.assets,r=e.systems.locations,i=e.systems.urlhash,s=Promise.all([t.initAsync(),r.initAsync(),i.initAsync()]);return this._initPromise=s.then(()=>{let o=i.initialHashParams.get("presets");if(o){let a=o.split(",").map(l=>l.trim()).filter(Boolean);this.addablePresetIDs=new Set(a)}return Promise.all([t.loadAssetAsync("tagging_preset_categories"),t.loadAssetAsync("tagging_preset_defaults"),t.loadAssetAsync("tagging_preset_presets"),t.loadAssetAsync("tagging_preset_fields"),t.loadAssetAsync("tagging_preset_overrides")])}).then(o=>{this.merge({categories:o[0],defaults:o[1],presets:o[2],fields:o[3]}),this.merge(o[4]),A6(this.areaKeys()),E6(this.pointTags()),T6(this.vertexTags())})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}merge(e){let t=[],r=this.context,i=r.systems.locations;if(e.fields)for(let[o,a]of Object.entries(e.fields))if(a){if(!of[a.type]){Nie&&console.warn(`"${a.type}" type not supported for ${o}`);continue}let l=new P2(r,o,a,this._fields);l.locationSet&&t.push(l),this._fields[o]=l}else delete this._fields[o];if(e.presets)for(let[o,a]of Object.entries(e.presets)){let c=this._presets[o]?.isFallback();if(a){a.icon&&(a.icon=a.icon.replace(/^iD-/,"rapid-")),o==="address"&&(a.icon="maki-circle-stroked"),o==="highway/turning_loop"&&(a.icon="maki-circle"),a.icon==="roentgen-needleleaved_tree"&&(a.icon="temaki-tree_needleleaved"),a.icon==="roentgen-tree"&&(a.icon="temaki-tree_broadleaved");let u=new Co(r,o,a,this._fields,this._presets);u.locationSet&&t.push(u),this._presets[o]=u}else c||delete this._presets[o]}if(e.categories)for(let[o,a]of Object.entries(e.categories))if(a){a.icon&&(a.icon=a.icon.replace(/^iD-/,"rapid-"));let l=new b2(r,o,a,this._presets);l.locationSet&&t.push(l),this._categories[o]=l}else delete this._categories[o];if(e.defaults)for(let[o,a]of Object.entries(e.defaults))Array.isArray(a)?this._defaults[o]=a.map(l=>this._presets[l]||this._categories[l]).filter(l=>l&&!l.isFallback()):this._defaults[o]=[];let s=Object.values(this._presets).concat(Object.values(this._categories));return this.collection=new wo(r,s),this._universal=Object.values(this._fields).filter(o=>o.universal),Object.values(this._presets).forEach(o=>o.resetFields()),this._geometryIndex={point:{},vertex:{},line:{},area:{},relation:{}},s.forEach(o=>{(o.geometry||[]).forEach(a=>{let l=this._geometryIndex[a];for(let c in o.tags){l[c]=l[c]||{};let u=o.tags[c];(l[c][u]=l[c][u]||[]).push(o)}})}),e.featureCollection&&Array.isArray(e.featureCollection.features)&&i.mergeCustomGeoJSON(e.featureCollection),t.length&&i.mergeLocationSets(t),this}item(e){return this.collection.item(e)}index(e){return this.collection.index(e)}fallback(e){return this.collection.fallback(e)}matchGeometry(e){return this.collection.matchGeometry(e)}matchAllGeometry(e){return this.collection.matchAllGeometry(e)}search(e,t,r){return this.collection.search(e,t,r)}match(e,t){return t.transient(e,"presetMatch",()=>{let r=e.geometry(t);r==="vertex"&&e.isOnAddressLine(t)&&(r="point");let i=e.extent(t);return this.matchTags(e.tags,r,i.center())})}matchTags(e,t,r){let i=this._geometryIndex[t],o=this.context.systems.locations,a=Array.isArray(r)?o.locationSetsAt(r):null,l=-1,c=null,u=[];for(let d in e){let f=i[d];if(!f)continue;let h=[],p=f[e[d]];p&&h.push(...p);let m=f["*"];if(m&&h.push(...m),h.length!==0)for(let g of h){let y=g.matchScore(e);y!==-1&&(a&&g.locationSetID&&!a[g.locationSetID]||(u.push({score:y,candidate:g}),y>l&&(l=y,c=g)))}}if(!c||c.isFallback()){for(let d in e)if(/^addr:/.test(d)&&i["addr:*"]&&i["addr:*"]["*"]){c=i["addr:*"]["*"][0];break}}return c||this.fallback(t)}allowsVertex(e,t){return e.type!=="node"?!1:Object.keys(e.tags).length===0?!0:t.transient(e,"vertexMatch",()=>{if(e.isOnAddressLine(t))return!0;let r=qa(e.tags);return r.vertex?!0:!r.point})}areaKeys(){let e=["barrier","highway","footway","railway","junction","type"],t={},r=Object.values(this._presets).filter(i=>!i.suggestion&&!i.replacement);for(let i of r){let s=Object.keys(i.tags)[0];s&&(e.includes(s)||i.geometry.includes("area")&&(t[s]=t[s]||{}))}for(let i of r)if(i.geometry.includes("line"))for(let[s,o]of Object.entries(i.addTags))s in t&&o!=="*"&&(t[s][o]=!0);return t}pointTags(){let e={},t=Object.values(this._presets).filter(r=>!r.suggestion&&!r.replacement&&r.searchable!==!1);for(let r of t){if(!r.geometry.includes("point"))continue;let i=Object.keys(r.tags)[0],s=Object.values(r.tags)[0];!i||!s||(e[i]=e[i]||{},e[i][s]=!0)}return e}vertexTags(){let e={},t=Object.values(this._presets).filter(r=>!r.suggestion&&!r.replacement&&r.searchable!==!1);for(let r of t){if(!r.geometry.includes("vertex"))continue;let i=Object.keys(r.tags)[0],s=Object.values(r.tags)[0];!i||!s||(e[i]=e[i]||{},e[i][s]=!0)}return e}field(e){return this._fields[e]}universal(){return this._universal}defaults(e,t=10,r=!0,i=null){let s=new Map;if(r)for(let l of this.getRecents())s.size<Lie&&l.matchGeometry(e)&&s.set(l.id,l);if(this.addablePresetIDs instanceof Set)for(let l of this.addablePresetIDs){let c=this.item(l);c?.matchGeometry(e)&&s.set(l,c)}else for(let l of this._defaults[e])l.matchGeometry(e)&&s.set(l.id,l);let o=this.fallback(e);o&&!s.has(o.id)&&s.set(o.id,o);let a=[...s.values()];if(Array.isArray(i)){let c=this.context.systems.locations.locationSetsAt(i);a=a.filter(u=>!u.locationSetID||c[u.locationSetID])}return new wo(this.context,a.slice(0,t-1))}getRecents(){let e=this._recentIDs;if(!e){let r=this.context.systems.storage;e=JSON.parse(r.getItem("preset_recents"))||[]}let t=e.map(r=>{let i=r?.id||r;return this._presets[i]}).filter(Boolean);return this._recentIDs||(this._recentIDs=t.map(r=>r.id)),t}setMostRecent(e){if(e.searchable===!1)return;this._recentIDs.unshift(e.id),this._recentIDs=Ge(this._recentIDs).slice(0,Oie),this.context.systems.storage.setItem("preset_recents",JSON.stringify(this._recentIDs))}};var rW="#da26d3",Uie="#00ffff",sP=["#ff0000","#ffa500","#ffd700","#00ff00","#00ffff","#1e90ff","#da26d3","#ffc0cb","#d3d3d3","#faf0e6"];function Kp(n){return n instanceof Set?n:new Set(n!==void 0&&[].concat(n))}var Qp=class extends Se{constructor(e){super(e),this.id="rapid",this.dependencies=new Set(["assets","editor","l10n","map","urlhash"]),this.catalog=new Map,this.categories=new Set,this._addedDatasetIDs=new Set,this._enabledDatasetIDs=new Set,this.acceptIDs=new Set,this.ignoreIDs=new Set,this._nextColorIndex=2,this._taskExtent=null,this._isTaskBoundsRect=null,this._hadPoweruser=!1,this._initPromise=null,this._startPromise=null,this._hashchange=this._hashchange.bind(this),this._stablechange=this._stablechange.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let o of this.dependencies)if(!this.context.systems[o])return Promise.reject(`Cannot init:  ${this.id} requires ${o}`);let e=this.context,t=e.systems.editor,r=e.systems.map,i=e.systems.urlhash,s=Promise.all([t.initAsync(),r.initAsync(),i.initAsync()]);return this._initPromise=s.then(()=>{i.on("hashchange",this._hashchange),t.on("stablechange",this._stablechange)})}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,t=e.systems.urlhash,r=e.services.esri,i=e.services.mapwithai,s=e.services.overture,o=[];r&&o.push(r),i&&o.push(i),s&&o.push(s);let a=Promise.all(o.map(l=>l.startAsync()));return this._startPromise=a.then(()=>{for(let l of o){let c=l.getAvailableDatasets();for(let u of c){this.catalog.set(u.id,u);for(let d of u.categories)this.categories.add(d)}}t.initialHashParams.has("datasets")||(this._addedDatasetIDs=new Set(["fbRoads","msBuildings","overture-places","omdFootways"]),this._enabledDatasetIDs=new Set(["fbRoads","msBuildings"]),this._datasetsChanged()),this._started=!0})}resetAsync(){return this.acceptIDs.clear(),this.ignoreIDs.clear(),Promise.resolve()}addDatasets(e){for(let t of Kp(e))this._addedDatasetIDs.add(t);this._datasetsChanged()}removeDatasets(e){for(let t of Kp(e))this._addedDatasetIDs.delete(t),this._enabledDatasetIDs.delete(t);this._datasetsChanged()}enableDatasets(e){for(let t of Kp(e))this._addedDatasetIDs.add(t),this._enabledDatasetIDs.add(t);this._datasetsChanged()}disableDatasets(e){for(let t of Kp(e))this._enabledDatasetIDs.delete(t);this._datasetsChanged()}toggleDatasets(e){for(let t of Kp(e))this._addedDatasetIDs.add(t),this._enabledDatasetIDs.has(t)?this._enabledDatasetIDs.delete(t):this._enabledDatasetIDs.add(t);this._datasetsChanged()}get datasets(){let e=new Map;for(let t of this._addedDatasetIDs){let r=this.catalog.get(t);e.set(t,r)}return e}get colors(){return sP}get taskExtent(){return this._taskExtent}isTaskRectangular(){return!!this._taskExtent&&this._isTaskBoundsRect}get hadPoweruser(){return this._hadPoweruser}setTaskExtentByGpxData(e){let t=Vx(e),r=t.features.reduce((s,o)=>s+(o.geometry.type==="LineString"?1:0),0);if(t.type==="FeatureCollection"){let s,o,a,l;t.features.forEach(c=>{if(c.geometry.type==="Point"){let u=c.geometry.coordinates[0],d=c.geometry.coordinates[1];(s===void 0||d<s)&&(s=d),(o===void 0||u<o)&&(o=u),(a===void 0||d>a)&&(a=d),(l===void 0||u>l)&&(l=u)}else if(c.geometry.type==="LineString"&&r===1){let u=c.geometry.coordinates.map(m=>m[0]),d=c.geometry.coordinates.map(m=>m[1]),f=u.filter(i),h=d.filter(i),p=!0;f.forEach(m=>{c.geometry.coordinates.filter(y=>y[0]===m).map(y=>y[1]).filter(i).length!==2&&(p=!1)}),f.length===2&&h.length===2&&p?this._isTaskBoundsRect=!0:this._isTaskBoundsRect=!1}}),this._taskExtent=new le([o,s],[l,a]),this.emit("taskchanged")}function i(s,o,a){return a.indexOf(s)===o}}_stablechange(){let t=this.context.systems.editor;this.acceptIDs.clear(),this.ignoreIDs.clear();let r=t.history,i=t.index;for(let s=1;s<=i;s++){let a=r[s].annotation;a?.type==="rapid_accept_feature"?a.entityID&&this.acceptIDs.add(a.entityID):a?.type==="rapid_ignore_feature"&&a.entityID&&this.ignoreIDs.add(a.entityID)}}_hashchange(e,t){e.get("poweruser")==="true"&&(this._hadPoweruser=!0);let r=e.get("datasets"),i=t.get("datasets");if(r!==i)if(this._enabledDatasetIDs.clear(),typeof r=="string"){let s=r.replace(/;/g,",").split(",").map(o=>o.trim()).filter(Boolean);this.enableDatasets(s)}else this._datasetsChanged()}_datasetsChanged(){let t=this.context.systems.urlhash,r=[];for(let[i,s]of this.catalog){let o=s.added,a=this._addedDatasetIDs.has(i);!o&&a&&s.color===rW&&(s.categories.has("meta")||s.categories.has("microsoft")?s.color=rW:s.categories.has("overture")?s.color=Uie:s.color=sP[this._nextColorIndex++%sP.length]),s.added=a,s.enabled=this._enabledDatasetIDs.has(i),s.added&&s.enabled&&r.push(i)}t.setParam("datasets",r.length?r.join(","):null),this.emit("datasetchange")}};var Zp=class extends Se{constructor(e){super(e),this.id="storage",this.dependencies=new Set,this._storage=null;try{this._storage=window.localStorage}catch{this._mock=new Map,this._storage={isMocked:!0,hasItem:r=>this._mock.has(r),getItem:r=>this._mock.get(r),setItem:(r,i)=>this._mock.set(r,i),removeItem:r=>this._mock.delete(r),clear:()=>this._mock.clear()}}}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}hasItem(e){return!!this._storage.getItem(e)}getItem(e){return this._storage.getItem(e)}setItem(e,t){try{return this._storage.setItem(e,t),!this._storage.isMocked}catch{console.error("localStorage quota exceeded")}return!1}removeItem(e){this._storage.removeItem(e)}clear(){this._storage.clear()}};var Gie=new Set(["motorway","trunk","primary","secondary","tertiary","residential","motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","unclassified","road","service","track","living_street","bus_guideway","busway"]),Jp=new Set(["abandoned","construction","demolished","destroyed","dismantled","disused","intermittent","obliterated","planned","proposed","razed","removed","was"]),$ie=new RegExp("^("+Array.from(Jp).join("|")+"):"),e5=class extends Se{constructor(e){super(e),this.id="styles",this.context=e,this.dependencies=new Set(["assets"]),this.protanopiaMatrix=[.567,.433,0,0,0,.558,.442,0,0,0,0,.242,.758,0,0,0,0,0,1,0],this.deuteranopiaMatrix=[.625,.375,0,0,0,.7,.3,0,0,0,0,.3,.7,0,0,0,0,0,1,0],this.tritanopiaMatrix=[.95,.05,0,0,0,0,.433,.567,0,0,0,.475,.525,0,0,0,0,0,1,0],this.STYLE_DECLARATIONS={DEFAULTS:{fill:{width:2,color:11184810,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:"round",join:"round"},stroke:{width:3,color:13421772,alpha:1,cap:"round",join:"round"}},LIFECYCLE:{casing:{alpha:0},stroke:{dash:[7,3],cap:"butt"}},red:{fill:{color:14708319,alpha:.3}},green:{fill:{color:9228383,alpha:.3}},blue:{fill:{color:7853278,alpha:.3}},yellow:{fill:{color:16777108,alpha:.25}},gold:{fill:{color:12893721,alpha:.3}},orange:{fill:{color:14059546,alpha:.3}},pink:{fill:{color:14918901,alpha:.3}},teal:{fill:{color:10084778,alpha:.3}},lightgreen:{fill:{color:12511295,alpha:.3}},tan:{fill:{color:16112826,alpha:.3}},darkgray:{fill:{color:9211020,alpha:.5}},lightgray:{fill:{color:11184810,alpha:.3}},motorway:{casing:{width:10,color:7354159},stroke:{width:8,color:13574273}},trunk:{casing:{width:10,color:7354159},stroke:{width:8,color:14495522}},primary:{casing:{width:10,color:7354159},stroke:{width:8,color:16357382}},secondary:{casing:{width:10,color:7354159},stroke:{width:8,color:15987474}},tertiary:{casing:{width:10,color:7354159},stroke:{width:8,color:16775603}},unclassified:{casing:{width:10,color:4473924},stroke:{width:8,color:14535850}},residential:{casing:{width:10,color:4473924},stroke:{width:8,color:16777215}},living_street:{casing:{width:7,color:16777215},stroke:{width:5,color:13421772}},service:{casing:{width:7,color:4473924},stroke:{width:5,color:16777215}},special_service:{casing:{width:7,color:4473924},stroke:{width:5,color:14535850}},track:{casing:{width:7,color:7630703},stroke:{width:5,color:12957087}},pedestrian:{casing:{width:7,color:16777215},stroke:{width:5,color:10061960,dash:[8,8],cap:"butt"}},path:{casing:{width:5,color:14535850},stroke:{width:3,color:10061960,dash:[6,6],cap:"butt"}},footway:{casing:{width:5,color:16777215},stroke:{width:3,color:10061960,dash:[6,6],cap:"butt"}},crossing_marked:{casing:{width:5,color:14535850},stroke:{width:3,color:4998212,dash:[6,3],cap:"butt"}},crossing_unmarked:{casing:{width:5,color:14535850},stroke:{width:3,color:7826026,dash:[6,4],cap:"butt"}},cycleway:{casing:{width:5,color:16777215},stroke:{width:3,color:5810669,dash:[6,6],cap:"butt"}},bridleway:{casing:{width:5,color:16777215},stroke:{width:3,color:14708063,dash:[6,6],cap:"butt"}},corridor:{casing:{width:5,color:16777215},stroke:{width:3,color:9228383,dash:[2,8],cap:"round"}},steps:{casing:{width:5,color:16777215},stroke:{width:3,color:8507996,dash:[3,3],cap:"butt"}},river:{fill:{color:7853278,alpha:.3},casing:{width:10,color:4473924},stroke:{width:8,color:7855581}},stream:{fill:{color:7853278,alpha:.3},casing:{width:7,color:4473924},stroke:{width:5,color:7855581}},ridge:{stroke:{width:2,color:9228383}},runway:{casing:{width:10,color:0,cap:"butt"},stroke:{width:8,color:16777215,dash:[24,48],cap:"butt"}},taxiway:{casing:{width:7,color:4473924},stroke:{width:5,color:16776960}},railway:{casing:{width:7,color:5592405,cap:"butt"},stroke:{width:2,color:15658734,dash:[12,12],cap:"butt"}},ferry:{casing:{alpha:0},stroke:{width:3,color:5810669,dash:[12,8],cap:"butt"}},boundary:{casing:{width:6,color:8566270,cap:"butt"},stroke:{width:2,color:16777215,dash:[20,5,5,5],cap:"butt"}},boundary_park:{casing:{width:6,color:8566270,cap:"butt"},stroke:{width:2,color:11592344,dash:[20,5,5,5],cap:"butt"}},barrier:{casing:{alpha:0},stroke:{width:3,color:14540253,dash:[10,5,2,5],cap:"round"}},barrier_wall:{casing:{alpha:0},stroke:{width:3,color:14540253,dash:[10,5,2,5],cap:"round"}},barrier_hedge:{fill:{color:9228383,alpha:.3},casing:{alpha:0},stroke:{width:3,color:9228383,dash:[10,5,2,5],cap:"round"}},tree_row:{casing:{width:7,color:4473924},stroke:{width:5,color:9228383}},construction:{casing:{width:10,color:16777215},stroke:{width:8,color:16542740,dash:[10,10],cap:"butt"}},pipeline:{casing:{width:7,color:4473924},stroke:{width:5,color:14540253,dash:[80,2],cap:"butt"}},roller_coaster:{casing:{width:7,color:4473924},stroke:{width:5,color:14540253,dash:[10,1],cap:"butt"}}},this.STYLE_SELECTORS={aeroway:{runway:"runway",taxiway:"taxiway"},amenity:{childcare:"yellow",college:"yellow",fountain:"blue",kindergarten:"yellow",parking:"darkgray",research_institute:"yellow",school:"yellow",university:"yellow"},building:{"*":"red"},barrier:{city_wall:"barrier_wall",hedge:"barrier_hedge",retaining_wall:"barrier_wall",wall:"barrier_wall","*":"barrier"},boundary:{protected_area:"boundary_park",national_park:"boundary_park","*":"boundary"},crossing:{marked:"crossing_marked",traffic_signals:"crossing_marked",uncontrolled:"crossing_marked",zebra:"crossing_marked","*":"crossing_unmarked"},golf:{green:"lightgreen"},highway:{bridleway:"bridleway",bus_guideway:"railway",busway:"special_service",corridor:"corridor",construction:"construction",cycleway:"cycleway",footway:"footway",living_street:"living_street",living_street_link:"living_street",motorway:"motorway",motorway_link:"motorway",path:"path",pedestrian:"pedestrian",primary:"primary",primary_link:"primary",residential:"residential",residential_link:"residential",secondary:"secondary",secondary_link:"secondary",service:"service",service_link:"service",steps:"steps",tertiary:"tertiary",tertiary_link:"tertiary",track:"track",trunk:"trunk",trunk_link:"trunk",unclassified:"unclassified",unclassified_link:"unclassified"},landuse:{cemetery:"lightgreen",commercial:"orange",construction:"gold",farmland:"lightgreen",farmyard:"tan",flowerbed:"green",forest:"green",grass:"green",industrial:"pink",landfill:"orange",meadow:"lightgreen",military:"orange",orchard:"lightgreen",quarry:"darkgray",railway:"darkgray",recreation_ground:"green",residential:"gold",retail:"orange",village_green:"green",vineyard:"lightgreen"},leisure:{garden:"green",golf_course:"green",nature_reserve:"green",park:"green",pitch:"green",swimming_pool:"blue",track:"yellow"},man_made:{adit:"darkgray",breakwater:"barrier_wall",groyne:"barrier_wall",pipeline:"pipeline"},military:{"*":"orange"},natural:{bare_rock:"darkgray",bay:"blue",beach:"yellow",cave_entrance:"darkgray",cliff:"darkgray",glacier:"lightgray",ridge:"ridge",rock:"darkgray",sand:"yellow",scree:"darkgray",scrub:"yellow",shingle:"darkgray",stone:"darkgray",strait:"blue",tree_row:"tree_row",water:"blue",wetland:"teal","*":"green"},power:{plant:"pink"},railway:{platform:"footway","*":"railway"},roller_coaster:{track:"roller_coaster"},route:{ferry:"ferry"},sport:{baseball:"yellow",basketball:"darkgray",beachvolleyball:"yellow",skateboard:"darkgray",softball:"yellow"},type:{waterway:"river"},waterway:{river:"river",dam:"DEFAULTS",weir:"DEFAULTS","*":"stream"},service:{alley:"special_service",driveway:"special_service","drive-through":"special_service",parking_aisle:"special_service","*":"special_service"}},this.PATTERN_DECLARATIONS=["bushes","cemetery","cemetery_buddhist","cemetery_christian","cemetery_jewish","cemetery_muslim","construction","dots","farmland","farmyard","forest","forest_broadleaved","forest_leafless","forest_needleleaved","grass","landfill","lines","orchard","pond","quarry","vineyard","waves","wetland","wetland_bog","wetland_marsh","wetland_reedbed","wetland_swamp"],this.PATTERN_SELECTORS={amenity:{fountain:"pond",grave_yard:"cemetery"},golf:{green:"grass"},landuse:{cemetery:"cemetery",construction:"construction",farmland:"farmland",farmyard:"farmyard",forest:"forest",grass:"grass",grave_yard:"cemetery",landfill:"landfill",meadow:"grass",military:"construction",orchard:"orchard",quarry:"quarry",vineyard:"vineyard"},leaf_type:{broadleaved:"forest_broadleaved",leafless:"forest_leafless",needleleaved:"forest_needleleaved"},natural:{bay:"waves",beach:"dots",grassland:"grass",sand:"dots",scrub:"bushes",strait:"waves",water:"waves",wetland:"wetland",wood:"forest"},religion:{buddhist:"cemetery_buddhist",christian:"cemetery_christian",jewish:"cemetery_jewish",muslim:"cemetery_muslim"},surface:{grass:"grass"},water:{pond:"pond",reservoir:"lines"},wetland:{bog:"wetland_bog",marsh:"wetland_marsh",reedbed:"wetland_reedbed",swamp:"wetland_swamp"}},this.styleMatch=this.styleMatch.bind(this)}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init: ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}styleMatch(e){let t=this.STYLE_DECLARATIONS.DEFAULTS,r=t,i=999,s;for(let[x,b]of Object.entries(e)){let _=this.STYLE_SELECTORS[x];if(!_||!b||x==="service"&&y(e,"highway")===void 0)continue;let S=_[b]??_["*"],C=Object.keys(_).length;if(Jp.has(b)&&(C=999),S&&C<=i){let k=this.STYLE_DECLARATIONS[S];if(!k){console.error(`invalid styleID: ${S}`);continue}if(r=k,i=C,s=x,i===1)break}}let o=!1;for(let[x,b]of Object.entries(e))if(Jp.has(x)&&b!=="no"){o=!0;break}else if((!s||x===s)&&Jp.has(b)){o=!0;break}else if(!s&&$ie.test(x)&&b!=="no"){o=!0;break}let a={};for(let x of["fill","casing","stroke"]){a[x]={};for(let b of["width","color","alpha","cap","dash"]){let _=r[x]&&r[x][b];if(_!==void 0)a[x][b]=_;else{let S=t[x]&&t[x][b];S!==void 0&&(a[x][b]=S)}}}let l=y(e,"bridge"),c=y(e,"building"),u=y(e,"cutting"),d=y(e,"embankment"),f=y(e,"highway"),h=y(e,"tracktype"),p=y(e,"tunnel"),m=y(e,"surface");if(f==="track"&&h!=="grade1"&&(m=m||"dirt"),(l||d||u)&&(a.casing.width+=7,a.casing.color=0,a.casing.cap="butt",(d||u)&&(a.casing.dash=[2,4])),p&&(a.stroke.alpha=.5),m&&Gie.has(f)&&!Cc.surface[m]&&(l||(a.casing.color=13421772),a.casing.cap="butt",a.casing.dash=[4,4]),o){let x=this.STYLE_DECLARATIONS.LIFECYCLE;for(let b of["fill","casing","stroke"])for(let _ of["width","color","alpha","cap","dash"]){let S=x[b]&&x[b][_];S!==void 0&&(a[b][_]=S)}}if(c)return a;if(a.fill.pattern)if(!this.PATTERN_DECLARATIONS.includes(a.fill.pattern))console.error(`invalid patternID: ${patternID}`);else return a;let g=999;for(let[x,b]of Object.entries(e)){let _=this.PATTERN_SELECTORS[x];if(!_||!b)continue;let S=_[b]??_["*"],C=Object.keys(_).length;if(Jp.has(b)&&(C=999),S&&C<=g){if(!this.PATTERN_DECLARATIONS.includes(S)){console.error(`invalid patternID: ${S}`);continue}if(a.fill.pattern=S,g=C,g===1)break}}return a;function y(x,b){return x[b]==="no"?void 0:x[b]}}};var af=class{constructor(e){this.context=e,this.user=void 0,this.$parent=null,this.render=this.render.bind(this),this.tryLogout=this.tryLogout.bind(this),this.getUserDetails=this.getUserDetails.bind(this);let t=e.services.osm;t&&t.on("authchange",this.getUserDetails)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.l10n,i=t.services.osm;if(t.embed())return;if(this.user===void 0){this.getUserDetails();return}e.selectAll(".userInfo").data([0]).enter().append("div").attr("class","userInfo"),e.selectAll(".loginLogout").data([0]).enter().append("div").attr("class","loginLogout").append("a").attr("href","#");let s=e.select(".userInfo"),o=e.select(".loginLogout");if(!this.user)s.html("").classed("hide",!0);else{s.html("").classed("hide",!1);let a=s.append("a").attr("href",i.userURL(this.user.display_name)).attr("target","_blank");this.user.image_url?a.append("img").attr("class","icon pre-text user-icon").attr("src",this.user.image_url):a.call(X("#rapid-icon-avatar","pre-text light")),a.append("span").attr("class","label").text(this.user.display_name)}i?i.authenticated()?o.classed("hide",!1).select("a").text(r.t("logout")).on("click",a=>{a.preventDefault(),i.logout(),this.tryLogout()}):o.classed("hide",!1).select("a").text(r.t("login")).on("click",a=>{a.preventDefault(),i.authenticate()}):o.classed("hide",!0)}getUserDetails(){let t=this.context.services.osm;!t||!t.authenticated()?(this.user=null,this.render()):t.userDetails((r,i)=>{this.user=i||null,this.render()})}tryLogout(){let e=this.context,t=e.systems.l10n,r=e.services.osm;if(!r)return;let i=t.localeCode(),s=r.wwwroot+`/logout?locale=${i}&referer=`+encodeURIComponent(`/login?locale=${i}`),o=600,a=550,l=[["width",o],["height",a],["left",window.screen.width/2-o/2],["top",window.screen.height/2-a/2]].map(c=>c.join("=")).join(",");window.open(s,"_blank",l)}};var lf=class{constructor(e){this.context=e,this._apiStatus=null,this._backupStatus=null,this.$parent=null,this.render=this.render.bind(this),this._onApiStatusChange=this._onApiStatusChange.bind(this),this._onBackupStatusChange=this._onBackupStatusChange.bind(this),e.systems.editor.on("backupstatuschange",this._onBackupStatusChange);let r=e.services.osm;r&&(window.setInterval(()=>{this._apiStatus==="ratelimit"&&this.render()},1e3),window.setInterval(()=>{r.reloadApiStatus()},9e4),r.reloadApiStatus(),r.on("apistatuschange",this._onApiStatusChange))}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.l10n,i=t.services.osm,s=i?.getRateLimit(),o=e.selectAll(".api-status").data([0]),a=o.enter().append("div").attr("class","api-status");o=o.merge(a),o.html(""),this._apiStatus==="readonly"?o.text(r.t("osm_api_status.message.readonly")):this._apiStatus==="offline"?o.text(r.t("osm_api_status.message.offline")):this._apiStatus==="ratelimit"&&s?(o.text(r.t("osm_api_status.message.ratelimit",{seconds:s.remaining})),i&&!i.authenticated()&&o.append("a").attr("href","#").attr("target","_blank").call(X("#rapid-icon-out-link","inline")).append("span").text(r.t("login")).on("click.login",l=>{l.preventDefault(),i.authenticate(),this._apiStatus="online"})):this._apiStatus==="error"?(o.text(r.t("osm_api_status.message.error")+" "),i&&o.append("a").attr("href","#").text(r.t("osm_api_status.retry")).on("click.retry",l=>{l.preventDefault(),i.throttledReloadApiStatus()})):this._backupStatus==="error"&&o.text(r.t("osm_api_status.message.local_storage_full"))}_onApiStatusChange(e,t){this._apiStatus=t??"error",this.render()}_onBackupStatusChange(e){this._backupStatus=e?"ok":"error",this.render()}};var cf=class{constructor(e){this.context=e,this.$parent=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this.throttledRender=mn(this.rerender,400,{leading:!1}),e.systems.imagery.on("imagerychange",this.rerender),e.systems.map.on("draw",this.throttledRender)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.imagery,i=t.systems.l10n,s=t.systems.gfx.scene,a=(t.systems.storage.getItem("preferences.privacy.thirdpartyicons")??"true")==="true",l=s.layers.get("rapid")?.enabled,c=e.selectAll(".attribution-wrap").data([0]),u=c.enter().append("div").attr("class","attribution-wrap");c=c.merge(u);let d=[{id:"baselayer",sources:[]},{id:"overlays",sources:[]}],f=r.baseLayerSource();f&&d[0].sources.push(f);let h=r.overlayLayerSources()||[];for(let x of h)d[1].sources.push(x);l&&d[1].sources.push({id:"__mapwithai",overlay:!0,terms_text:i.t("map_data.layers.rapid.license"),terms_url:"https://mapwith.ai/doc/license/MapWithAILicense.pdf"});let p=c.selectAll(".attribution-section").data(d,x=>x.id),m=p.enter().append("div").attr("class",x=>`attribution-section ${x.id}`);p=p.merge(m);let g=p.selectAll(".attribution").data(x=>x.sources,x=>x.id);g.exit().remove();let y=g.enter().append("a").attr("class","attribution").attr("target","_blank").attr("href",x=>x.terms_url||null).each((x,b,_)=>{let S=H(_[b]);if(x.terms_html){S.html(x.terms_html);return}x.icon&&!x.overlay&&a&&S.append("img").attr("class","attribution-image").attr("src",x.icon),S.append("span").attr("class","attribution-text")});g=g.merge(y),g.selectAll(".attribution-text").text(x=>i.t(`_imagery.imagery.${x.idtx}.attribution.text`,{default:x.terms_text||x.id||x.name}))}};function uf(n){let e=n.systems.l10n,t=ct(n,"more-fields").minItems(1),r=[],i="",s="",o="";function a(l){let c=r.filter(S=>S.isAllowed()),u=c.filter(S=>S.isShown()),d=c.filter(S=>!S.isShown()),f=l.selectAll(".form-fields-container").data([0]);f=f.enter().append("div").attr("class","form-fields-container "+(o||"")).merge(f);let h=f.selectAll(".wrap-form-field").data(u,S=>S.id+(S.entityIDs?S.entityIDs.join():""));h.exit().remove();let p=h.enter().append("div").attr("class",S=>`wrap-form-field wrap-form-field-${S.safeid}`);h=h.merge(p),h.order().each((S,C,k)=>{H(k[C]).call(S.render)});let m=[],g=d.map(S=>{let C=S.title;m.push(C);let k=S.terms;return S.key&&k.push(S.key),S.keys&&(k=k.concat(S.keys)),{display:S.label,value:C,title:C,field:S,terms:k}}),y=m.slice(0,3).join(", ")+(m.length>3?"\u2026":""),x=l.selectAll(".more-fields").data(s==="hover"||g.length===0?[]:[0]);x.exit().remove();let b=x.enter().append("div").attr("class","more-fields").append("label");b.append("span").text(e.t("inspector.add_fields")),x=b.merge(x);let _=x.selectAll(".value").data([0]);_.exit().remove(),_=_.enter().append("input").attr("class","value").attr("type","text").attr("placeholder",y).call(Oe).merge(_),_.call(Ee,"").call(t.data(g).on("accept",S=>{if(!S)return;let C=S.field;C.show(),l.call(a),C.focus()})),i!==y&&(_.attr("placeholder",y),i=y)}return a.fieldsArr=function(l){return arguments.length?(r=l||[],a):r},a.state=function(l){return arguments.length?(s=l,a):s},a.klass=function(l){return arguments.length?(o=l,a):o},a}function Vb(n){let e=n.systems.l10n,t=ge("change");var r=uf(n),i=ct(n,"comment").caseSensitive(!0),s,o,a;function l(u){c(u)}function c(u){var d=!1;if(!s){d=!0;var f=n.systems.presets;s=[new Fi(n,f.field("comment"),null,{show:!0,revert:!1}),new Fi(n,f.field("source"),null,{show:!1,revert:!1}),new Fi(n,f.field("hashtags"),null,{show:!1,revert:!1})],s.forEach(function(b){b.on("change",function(_,S){t.call("change",b,void 0,_,S)})})}if(s.forEach(function(b){b.tags(o)}),u.call(r.fieldsArr(s)),d){var h=u.select(".form-field-comment textarea"),p=h.node();p&&(p.focus(),p.select()),h2(h,"blur");var m=n.services.osm;m&&m.userChangesets(function(b,_){if(!b){var S=_.map(function(C){var k=C.tags.comment;return k?{title:k,value:k}:null}).filter(Boolean);h.call(i.data(q1(S,"title")))}})}var g=o.comment.match(/google/i),y=u.select(".form-field-comment").selectAll(".comment-warning").data(g?[0]:[]);y.exit().transition().duration(200).style("opacity",0).remove();var x=y.enter().insert("div",".tag-reference-body").attr("class","field-warning comment-warning").style("opacity",0);x.append("a").attr("target","_blank").call(X("#rapid-icon-alert","inline")).attr("href",e.t("commit.google_warning_link")).append("span").text(e.t("commit.google_warning")),x.transition().duration(200).style("opacity",1)}return l.tags=function(u){return arguments.length?(o=u,l):o},l.changesetID=function(u){return arguments.length?(a===u||(a=u,s=null),l):a},xe(l,t,"on")}var sW=Ot(_2(),1);var ea=new function(){var n="keyValue",e="keyAttributes",t="@",r=[],i=/^\s*$/,s=/^(?:true|false)$/i;function o(d){return i.test(d)?null:s.test(d)?d.toLowerCase()==="true":isFinite(d)?parseFloat(d):isFinite(Date.parse(d))?new Date(d):d}function a(){}a.prototype.toString=function(){return"null"},a.prototype.valueOf=function(){return null};function l(d){return d===null?new a:d instanceof Object?d:new d.constructor(d)}function c(d,f,h,p){var m=r.length,g=d.hasChildNodes(),y=d.hasAttributes(),x=!!(f&2),b,_,S=0,C="",k=x?{}:!0;if(g)for(var v,w=0;w<d.childNodes.length;w++)v=d.childNodes.item(w),v.nodeType===4?C+=v.nodeValue:v.nodeType===3?C+=v.nodeValue.trim():v.nodeType===1&&!v.prefix&&r.push(v);var A=r.length,E=o(C);!x&&(g||y)&&(k=f===0?l(E):{});for(var I=m;I<A;I++)b=r[I].nodeName.toLowerCase(),_=c(r[I],f,h,p),k.hasOwnProperty(b)?(k[b].constructor!==Array&&(k[b]=[k[b]]),k[b].push(_)):(k[b]=_,S++);if(y){for(var M=d.attributes.length,T=p?"":t,R=p?{}:k,P,D=0;D<M;S++,D++)P=d.attributes.item(D),R[T+P.name.toLowerCase()]=o(P.value.trim());p&&(h&&Object.freeze(R),k[e]=R,S-=M-1)}return f===3||(f===2||f===1&&S>0)&&C?k[n]=E:!x&&S===0&&C&&(k=E),h&&(x||S>0)&&Object.freeze(k),r.length=m,k}function u(d,f,h){var p,m;h instanceof String||h instanceof Number||h instanceof Boolean?f.appendChild(d.createTextNode(h.toString())):h.constructor===Date&&f.appendChild(d.createTextNode(h.toGMTString()));for(var g in h)if(p=h[g],!(isFinite(g)||p instanceof Function))if(g===n)p!==null&&p!==!0&&f.appendChild(d.createTextNode(p.constructor===Date?p.toGMTString():String(p)));else if(g===e)for(var y in p)f.setAttribute(y,p[y]);else if(g.charAt(0)===t)f.setAttribute(g.slice(1),p);else if(p.constructor===Array)for(var x=0;x<p.length;x++)m=d.createElement(g),u(d,m,p[x]),f.appendChild(m);else m=d.createElement(g),p instanceof Object?u(d,m,p):p!==null&&p!==!0&&m.appendChild(d.createTextNode(p.toString())),f.appendChild(m)}this.build=function(d,f,h,p){var m=arguments.length>1&&typeof f=="number"?f&3:1;return c(d,m,h||!1,arguments.length>3?p:m===3)},this.unbuild=function(d){var f=document.implementation.createDocument("","",null);return u(f,f,d),f},this.stringify=function(d){return new XMLSerializer().serializeToString(ea.unbuild(d))}};function jb(n,e){return function(t){t.style("opacity",n?0:1).classed("hide",!1).transition().style("opacity",n?1:0).on("end",function(){H(this).classed("hide",!n).style("opacity",null),e&&e.apply(this)})}}function N1(n,e){let t=n.systems.l10n,r=n.systems.storage,i=ge("toggled"),s=!0,o=!0,a,l=Wt(""),c=function(){},u=function(f){o&&(s=(r.getItem(`disclosure.${e}.expanded`)||"true")==="true"),a!==void 0&&(s=a);let h=f.selectAll(`.hide-toggle-${e}`).data([0]),p=h.enter().append("a").attr("href","#").attr("class",`hide-toggle hide-toggle-${e}`).call(X("","pre-text hide-toggle-icon"));p.append("span").attr("class","hide-toggle-text"),h=p.merge(h),h.on("click",x).classed("expanded",s),h.selectAll(".hide-toggle-text").text(l());let m=t.isRTL(),g=s?"down":m?"backward":"forward";h.selectAll(".hide-toggle-icon > use").attr("xlink:href",`#rapid-icon-${g}`);let y=f.selectAll(".disclosure-wrap").data([0]);y=y.enter().append("div").attr("class",`disclosure-wrap disclosure-wrap-${e}`).merge(y).classed("hide",!s),s&&y.call(c);function x(b){b.preventDefault(),s=!s,o&&a===void 0&&r.setItem(`disclosure.${e}.expanded`,s),a=void 0,h.classed("expanded",s);let _=s?"down":m?"backward":"forward";h.selectAll(".hide-toggle-icon > use").attr("xlink:href",`#rapid-icon-${_}`),y.call(jb(s)),s&&y.call(c),i.call("toggled",this,s)}};return u.expanded=d=>arguments.length?(s=d,u):s,u.checkPreference=d=>arguments.length?(o=d,u):o,u.expandOverride=d=>arguments.length?(a=d,u):a,u.label=d=>arguments.length?(l=Wt(d),u):l,u.content=d=>arguments.length?(c=d,u):c,xe(u,i,"on")}function Ke(n,e){let t=Wt(""),r=H(null),i,s,o,a,l,c,u={id:e};u.selection=function(){return r},u.classes=function(f){return arguments.length?(t=Wt(f),u):t},u.label=function(f){return arguments.length?(a=Wt(f),u):a},u.shouldDisplay=function(f){return arguments.length?(i=Wt(f),u):i},u.content=function(f){return arguments.length?(s=f,u):s},u.disclosureContent=function(f){return arguments.length?(l=f,u):l},u.disclosureExpandOverride=function(f){return arguments.length?(c=f,u):c},u.render=function(h){r=h.selectAll(`.section-${e}`).data([0]),r=r.enter().append("div").attr("class",`section section-${e} `+(t&&t()||"")).merge(r),r.call(d)},u.reRender=function(){r.call(d)};function d(f){if(typeof i=="function"){let h=i();if(f.classed("hide",!h),!h){f.html("");return}}l?(o||(o=N1(n,e.replace(/-/g,"_")).label(a||"").content(l)),o.expandOverride(c),f.call(o)):s&&f.call(s)}return u}function Xb(n){let e=n.systems.assets,t=n.systems.editor,r=n.systems.l10n,i=Et(),s={};e.loadAssetAsync("tagging_discarded").then(l=>s=l).catch(()=>{});let o=Ke(n,"changes-list").label(()=>{let l=t.difference().summary();return r.t("inspector.title_count",{title:r.t("commit.changes"),count:l.size})}).disclosureContent(a);function a(l){let c=[...t.difference().summary().values()],u=l.selectAll(".commit-section").data([0]),d=u.enter().append("div").attr("class","commit-section");d.append("ul").attr("class","changeset-list"),u=d.merge(u);let f=u.select("ul").selectAll("li").data(c),h=f.enter().append("li").attr("class","change-item"),p=h.append("button").on("mouseover",S).on("mouseout",C).on("click",k);p.each((v,w,A)=>{let E=v.entity.geometry(v.graph);H(A[w]).call(X(`#rapid-icon-${E}`,`pre-text ${v.changeType}`))}),p.append("span").attr("class","change-type").text(v=>r.t(`commit.${v.changeType}`)+" "),p.append("strong").attr("class","entity-type").text(v=>{let w=n.systems.presets.match(v.entity,v.graph);return w&&w.name()||r.displayType(v.entity.id)}),p.append("span").attr("class","entity-name").text(v=>{let w=r.displayName(v.entity.tags),A="";return w!==""&&(A+=":"),A+=" "+w}),f=h.merge(f);let m=new ri().update({id:void 0}),g=t.changes(ma(t.difference(),s));delete m.id;let y=ea.stringify(m.osmChangeJXON(g)),x=new Blob([y],{type:"text/xml;charset=utf-8;"}),b="changes.osc",_=u.selectAll(".download-changes").data([0]).enter().append("a").attr("class","download-changes");i.download?_.attr("href",window.URL.createObjectURL(x)).attr("download",b):_.attr("target","_blank").on("click.download",()=>navigator.msSaveBlob(x,b)),_.call(X("#rapid-icon-load","inline")).append("span").text(r.t("commit.download_changes"));function S(v){}function C(){}function k(v,w){if(w.changeType!=="deleted"){let A=w.entity;n.systems.map.fitEntitiesEase(A)}}}return o}function qb(n){let e=n.systems.l10n,t=n.systems.validator;function r(i){let s=t.getIssuesBySeverity({what:"edited",where:"all",includeDisabledRules:!0});for(let o of["error","warning"]){let a=s[o];o==="warning"&&(a=a.filter(m=>m.type!=="help_request"));let l=`${o}-section`,c=`${o}-item`,u=i.selectAll("."+l).data(a.length?[0]:[]);u.exit().remove();let d=u.enter().append("div").attr("class","modal-section "+l+" fillL2");d.append("h3").html(o==="warning"?e.tHtml("commit.warnings"):e.tHtml("commit.errors")),d.append("ul").attr("class","changeset-list"),u=d.merge(u);let f=u.select("ul").selectAll("li").data(a,m=>m.key);f.exit().remove();let h=f.enter().append("li").attr("class",c),p=h.append("button").on("click",(m,g)=>{t.focusIssue(g)});p.call(X(t.getSeverityIcon(o),"pre-text")),p.append("strong").attr("class","issue-message"),f=h.merge(f),f.selectAll(".issue-message").html(m=>m.message(n))}}return r}function mc(n,e){let t=n.systems.assets,r=n.systems.editor,i=n.systems.l10n,s=n.systems.storage,o=n.services.taginfo,a=ge("change"),l=[{id:"list",icon:"#fas-th-list"},{id:"text",icon:"#fas-i-cursor"}],c=Ke(n,e).classes("raw-tag-editor").label(()=>{let O=Object.keys(b).filter(Boolean).length;return i.t("inspector.title_count",{title:i.t("inspector.tags"),count:O})}).disclosureContent(S),u=new Set;t.loadAssetAsync("tagging_discarded").then(O=>u=new Set(Object.keys(O)));let d=s.getItem("raw-tag-editor-view")||"list",f=[],h=[],p=!1,m=!1,g=null,y,x,b,_=[];function S(O){h=h.filter(Q=>b[Q]!==void 0);let G=Object.keys(b).sort(),U=an(G,h);for(let Q in U)h.push(U[Q]);let W=h.map((Q,_e)=>({index:_e,key:Q,value:b[Q]}));(!W.length||m)&&(m=!1,W.push({index:W.length,key:"",value:""})),O.selectAll(".raw-tag-options").data([0]).enter().insert("div",":first-child").attr("class","raw-tag-options").selectAll(".raw-tag-option").data(l,Q=>Q.id).enter().append("button").attr("class",Q=>`raw-tag-option raw-tag-option-${Q.id}`+(d===Q.id?" selected":"")).attr("title",Q=>i.t(`icons.${Q.id}`)).on("click",function(Q,_e){d=_e.id,s.setItem("raw-tag-editor-view",_e.id),O.selectAll(".raw-tag-option").classed("selected",je=>je===_e),O.selectAll(".tag-text").classed("hide",_e.id!=="text").each(v),O.selectAll(".tag-list, .add-row").classed("hide",_e.id!=="list")}).each((Q,_e,je)=>{H(je[_e]).call(X(Q.icon))});let Y=E(W),K=O.selectAll(".tag-text").data([0]);K=K.enter().append("textarea").attr("class","tag-text"+(d!=="text"?" hide":"")).call(Oe).attr("placeholder",i.t("inspector.key_value")).attr("spellcheck","false").merge(K),K.call(Ee,Y).each(v).on("input",v).on("focus",F).on("blur",I).on("change",I);let ne=O.selectAll(".tag-list").data([0]);ne=ne.enter().append("ul").attr("class","tag-list"+(d!=="list"?" hide":"")).merge(ne);let ie=O.selectAll(".add-row").data([0]).enter().append("div").attr("class","add-row"+(d!=="list"?" hide":""));ie.append("button").attr("class","add-tag").call(X("#rapid-icon-plus","light")).on("click",N),ie.append("div").attr("class","space-value"),ie.append("div").attr("class","space-buttons");let q=ne.selectAll(".tag-row").data(W,Q=>Q.key);q.exit().each((Q,_e,je)=>{H(je[_e]).selectAll("input.key, input.value").call(ct.off,n)}).remove();let se=q.enter().append("li").attr("class","tag-row").classed("readonly",C),te=se.append("div").attr("class","inner-wrap");te.append("div").attr("class","key-wrap").append("input").property("type","text").attr("class","key").call(Oe).on("focus",F).on("blur",R).on("change",R),te.append("div").attr("class","value-wrap").append("input").property("type","text").attr("class","value").call(Oe).on("focus",F).on("blur",P).on("change",P).on("keydown.push-more",M),te.append("button").attr("class","form-field-button remove").attr("title",i.t("icons.remove")).call(X("#rapid-operation-delete")),q=q.merge(se).sort((Q,_e)=>Q.index-_e.index),q.each((Q,_e,je)=>{let Dt=H(je[_e]);Dt.select("input.key"),Dt.select("input.value"),_.length&&o&&y!=="hover"&&T(Dt);let xt={key:Q.key};k(Q)||(xt.value=Q.value);let nr=Jo(n,xt);y==="hover"&&nr.showing(!1),Dt.select(".inner-wrap").call(nr.button),Dt.call(nr.body),Dt.select("button.remove")}),q.selectAll("input.key").attr("title",Q=>Q.key).attr("readonly",Q=>C(Q)||k(Q)||null).call(Ee,Q=>Q.key),q.selectAll("input.value").classed("mixed",k).attr("title",Q=>k(Q)?Q.value.filter(Boolean).join(`
`):Q.value).attr("readonly",Q=>C(Q)||null).attr("placeholder",Q=>k(Q)?i.t("inspector.multiple_values"):null).call(Ee,Q=>k(Q)?"":Q.value),q.selectAll("button.remove").on(("PointerEvent"in window?"pointer":"mouse")+"down",D)}function C(O){for(let G of f)if(G.test(O.key))return!0;return!1}function k(O){return Array.isArray(O.value)}function v(){if(d!=="text")return;let O=H(this),G=O.node().value.match(/\n/g),U=2+Number(G&&G.length);O.style("height",U*20+"px")}function w(O){return JSON.stringify(O).slice(1,-1)}function A(O){let G="",U="";return(O.length<1||O.charAt(0)!=='"')&&(G='"'),(O.length<2||O.charAt(O.length-1)!=='"'||O.charAt(O.length-1)==='"'&&O.charAt(O.length-2)==="\\")&&(U='"'),JSON.parse(G+O+U)}function E(O){let G=O.filter(U=>U.key&&U.key.trim()!=="").map(U=>{let W=U.value;typeof W!="string"&&(W="*");let V=W?w(W):"";return w(U.key)+"="+V}).join(`
`);return y!=="hover"&&G.length?G+`
`:G}function I(){let O=this.value.trim(),G={};O.split(`
`).forEach(W=>{let V=W.match(/^\s*([^=]+)=(.*)$/);if(V!==null){let j=n.cleanTagKey(A(V[1].trim())),Z=n.cleanTagValue(A(V[2].trim()));G[j]=Z}});let U=ia(b,G);if(U.length){if(g=g||{},U.forEach(function(W){C({key:W.key})||W.newVal==="*"&&typeof W.oldVal!="string"||(W.type==="-"?g[W.key]=void 0:W.type==="+"&&(g[W.key]=W.newVal||""))}),Object.keys(g).length===0){g=null;return}B()}}function M(O){O.keyCode===9&&!O.shiftKey&&c.selection().selectAll(".tag-list li:last-child input.value").node()===this&&Ee(H(this))&&N()}function T(O){let G=O.datum(),U=O.select("input.key"),W=O.select("input.value");if(C(G)||!_.length)return;if(k(G)){W.call(ct(n,"tag-value").minItems(1).fetcher(function(Y,K){let ne=Ee(U);if(!b[ne])return;let ie=b[ne].filter(Boolean).map(q=>({value:q,title:q}));K(ie)}));return}let j=r.staging.graph.geometry(_[0]);U.call(ct(n,"tag-key").fetcher(function(Y,K){o.keys({debounce:!0,geometry:j,query:Y},function(ne,ie){if(!ne){let q=ie.filter(se=>!(/_\d$/.test(se.value)||u.has(se.value)||b[se.value]!==void 0));K(Z(Y,q))}})})),W.call(ct(n,"tag-value").fetcher(function(Y,K){o.values({debounce:!0,key:Ee(U),geometry:j,query:Y},function(ne,ie){ne||K(Z(Y,ie))})}));function Z(Y,K){let ne=[],ie=[];for(let q of K)q.value.substring(0,Y.length)===Y?ne.push(q):ie.push(q);return ne.concat(ie)}}function R(O,G){if(H(this).attr("readonly"))return;let U=G.key;if(g&&g.hasOwnProperty(U)&&g[U]===void 0)return;let W=n.cleanTagKey(this.value.trim());if(C({key:W})){this.value=U;return}if(W&&W!==U&&b[W]!==void 0){this.value=U,c.selection().selectAll(".tag-list input.value").each((K,ne,ie)=>{if(K.key===W){let q=ie[ne];q.focus(),q.select()}});return}let V=this.parentNode.parentNode,j=H(V).selectAll("input.value"),Z=n.cleanTagValue(Ee(j));g=g||{},U&&(g[U]=void 0),g[W]=Z;let Y=h.indexOf(U);Y!==-1&&(h[Y]=W),G.key=W,G.value=Z,this.value=W,Ee(j,Z),B()}function P(O,G){C(G)||k(G)&&!this.value||g&&g.hasOwnProperty(G.key)&&g[G.key]===void 0||(g=g||{},g[G.key]=n.cleanTagValue(this.value),B())}function D(O,G){C(G)||(G.key===""?(m=!1,c.reRender()):(h=h.filter(U=>U!==G.key),g=g||{},g[G.key]=void 0,B()))}function N(){window.setTimeout(function(){m=!0,c.reRender(),c.selection().selectAll(".tag-list li:last-child input.key").node().focus()},20)}function F(){p=!0}function B(){let O=_;window.setTimeout(function(){g&&(a.call("change",this,O,g),g=null)},10)}return c.state=function(O){return arguments.length?(y!==O&&(p=!1,h=[],y=O),c):y},c.presets=function(O){return arguments.length?(x=O,x&&x.length&&x[0].isFallback()||p?c.disclosureExpandOverride(!0):c.disclosureExpandOverride(void 0),c):x},c.tags=function(O){return arguments.length?(b=O,c):b},c.entityIDs=function(O){return arguments.length?((!_||!O||!Kr(_,O))&&(p=!1,h=[],_=O),c):_},c.readOnlyTags=function(O){return arguments.length?(f=O,c):f},xe(c,a,"on")}var nW=[/^closed:/,/^ideditor:/,/^rapid:/,/^resolved:/,/^warnings:/,/^changesets_count$/,/^created_by$/,/^(imagery|photos|data)_used$/,/^host$/,/^locale$/],iW=/(#[^\u2000-\u206F\u2E00-\u2E7F\s\\'!"#$%()*,.\/:;<=>?@\[\]^`{|}~]+)/g;function Yb(n){let e=n.systems.editor,t=n.systems.l10n,r=n.systems.rapid,i=n.systems.storage,s=n.systems.uploader,o=n.systems.urlhash,a=n.systems.validator,l=ge("cancel"),c,u,d=Vb(n).on("change",_),f=mc(n,"changeset-tag-editor").on("change",_).readOnlyTags(nW),h=Xb(n),p=qb(n);function m(v){u=v,s.changeset||g(),y(),v.call(x)}function g(){let v=t.localeCode(),w=+i.getItem("commentDate")||0,A=Date.now(),E=2*86400*1e3;(w>A||A-w>E)&&(i.removeItem("comment"),i.removeItem("hashtags"),i.removeItem("source"));let I=o.initialHashParams.get("comment"),M=o.initialHashParams.get("source"),T=o.initialHashParams.get("hashtags");I&&(i.setItem("comment",I),i.setItem("commentDate",Date.now())),M&&(i.setItem("source",M),i.setItem("commentDate",Date.now())),T&&(i.setItem("hashtags",T),i.setItem("commentDate",Date.now()));let R=Et(),P={comment:i.getItem("comment")||"",created_by:n.cleanTagValue("Rapid "+n.version),host:n.cleanTagValue(R.host),locale:n.cleanTagValue(v)};S(P,!0);let D=i.getItem("hashtags");D&&(P.hashtags=D);let N=i.getItem("source");N&&(P.source=N),s.changeset=new ri({tags:P})}function y(){let v=Object.assign({},s.changeset.tags);r.hadPoweruser?v["rapid:poweruser"]="true":delete v["rapid:poweruser"];let w=new Set,A=new Set,E=!1,I=n.services.maproulette;if(I){let j=I.getClosed(),Z=new Set;for(let{challengeID:Y}of j){if(Z.has(Y))continue;Z.add(Y);let K=I.getChallenge(Y);K&&(K.checkinComment&&w.add(K.checkinComment),K.checkinSource&&A.add(K.checkinSource))}j.length&&(E=!0)}if(w.size&&(v.comment=[...w].join(`
`)),E){let j=new Set((v.hashtags||"").split(";"));j.add("#maproulette"),v.hashtags=n.cleanTagValue([...j].join(";"))}let M=e.sourcesUsed(),T=new Set((v.source||"").split(";")),R=["aerial imagery","streetlevel imagery","mapillary","kartaview","streetside","mapwithai","esri"];for(let j of R)T.delete(j);for(let j of A)T.add(j);let P;M.imagery.size&&(T.add("aerial imagery"),P=n.cleanTagValue(Array.from(M.imagery).filter(Boolean).join(";"))),P?v.imagery_used=P:delete v.imagery_used;let D;if(M.photos.size){T.add("streetlevel imagery");for(let j of M.photos){let Z=j.match(/(mapillary|kartaview|streetside)/i);Z!==null&&T.add(Z[1])}D=n.cleanTagValue(Array.from(M.photos).filter(Boolean).join(";"))}D?v.photos_used=D:delete v.photos_used;let N;if(M.data.size){for(let j of M.data){let Z=j.match(/(mapwithai|esri)/i);Z!==null&&T.add(Z[1])}N=n.cleanTagValue(Array.from(M.data).filter(Boolean).join(";"))}N?v.data_used=N:delete v.data_used;let F=n.cleanTagValue(Array.from(T).filter(Boolean).join(";"));F?v.source=F:delete v.source;for(let j of Object.keys(v))/^(closed|warnings|resolved):/.test(j)&&delete v[j];let B=n.services.osm;if(B){let j=B.getClosedIDs();j.length&&(v["closed:note"]=n.cleanTagValue(j.join(";")))}let O=n.services.keepRight;if(O){let j=O.getClosedIDs();j.length&&(v["closed:keepright"]=n.cleanTagValue(j.join(";")))}let G=n.services.osmose;if(G){let j=G.getClosedCounts();for(let Z in j)v[`closed:osmose:${Z}`]=n.cleanTagValue(j[Z].toString())}let U=a.getIssuesBySeverity({what:"edited",where:"all",includeIgnored:!0,includeDisabledRules:!0}).warning.filter(j=>j.type!=="help_request");V(U,"warnings");let W=a.getResolvedIssues();V(W,"resolved"),s.changeset=s.changeset.update({tags:v});function V(j,Z){let Y=hr(j,"type");for(let K in Y){let ne=Y[K];if(ne[0].subtype){let ie=hr(ne,"subtype");for(let q in ie){let se=ie[q];v[Z+":"+K+":"+q]=n.cleanTagValue(se.length.toString())}}else v[Z+":"+K]=n.cleanTagValue(ne.length.toString())}}}function x(v){let w=n.services.osm;if(!w)return;let E=v.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");E.append("div").append("h3").html(t.tHtml("commit.title")),E.append("button").attr("class","close").on("click",function(){l.call("cancel",this)}).call(X("#rapid-icon-close"));let I=v.selectAll(".body").data([0]);I=I.enter().append("div").attr("class","body").merge(I);let M=I.selectAll(".changeset-editor").data([0]);M=M.enter().append("div").attr("class","modal-section changeset-editor").merge(M),M.call(d.changesetID(s.changeset.id).tags(s.changeset.tags)),I.call(p);let T=I.selectAll(".save-section").data([0]);T=T.enter().append("div").attr("class","modal-section save-section fillL").merge(T);let R=T.selectAll(".commit-info").data([0]);R.enter().size()&&(c=null),R=R.enter().append("p").attr("class","commit-info").html(t.tHtml("commit.upload_explanation")).merge(R),w.userDetails(function(Y,K){if(Y||c===K)return;c=K;let ne=H(document.createElement("div"));K.image_url&&ne.append("img").attr("src",K.image_url).attr("class","icon pre-text user-icon"),ne.append("a").attr("class","user-info").html(K.display_name).attr("href",w.userURL(K.display_name)).attr("target","_blank"),R.html(t.tHtml("commit.upload_explanation_with_user",{user:ne.html()}))});let P=T.selectAll(".request-review").data([0]),D=P.enter().append("div").attr("class","request-review"),N=xo("commit-input-request-review"),F=D.append("label").attr("for",N);F.empty()||F.call(de(n).title(t.t("commit.request_review_info")).placement("top")),F.append("input").attr("type","checkbox").attr("id",N),F.append("span").html(t.tHtml("commit.request_review")),P=P.merge(D);let B=P.selectAll("input").property("checked",C(s.changeset.tags)).on("change",Z),O=T.selectAll(".buttons").data([0]),G=O.enter().append("div").attr("class","buttons fillL");G.append("button").attr("class","secondary-action button cancel-button").append("span").attr("class","label").html(t.tHtml("commit.cancel")),G.append("button").attr("class","action button save-button").append("span").attr("class","label").html(t.tHtml("commit.save"));let W=b();O=O.merge(G),O.selectAll(".cancel-button").on("click.cancel",function(){l.call("cancel",this)}),O.selectAll(".save-button").classed("disabled",W!==null).on("click.save",function(){if(!H(this).classed("disabled")){this.blur();let Y=s.changeset.tags;for(let[K,ne]of Object.entries(Y))(!K||!ne)&&delete Y[K];s.save()}}),de(n).destroyAny(O.selectAll(".save-button")),W&&O.selectAll(".save-button").call(de(n).title(W).placement("top"));let V=I.selectAll(".tag-section.raw-tag-editor").data([0]);V=V.enter().append("div").attr("class","modal-section tag-section raw-tag-editor").merge(V),V.call(f.tags(Object.assign({},s.changeset.tags)).render);let j=I.selectAll(".commit-changes-section").data([0]);j=j.enter().append("div").attr("class","modal-section commit-changes-section").merge(j),j.call(h.render);function Z(){let Y=B.property("checked");k({review_requested:Y?"yes":void 0}),V.call(f.tags(Object.assign({},s.changeset.tags)).render)}}function b(){let v=a.getIssuesBySeverity({what:"edited",where:"all"}).error;return v.length?t.t("commit.outstanding_errors_message",{count:v.length}):(s.changeset?.tags?.comment??"").trim().length?null:t.t("commit.comment_needed_message")}function _(v,w,A){w.hasOwnProperty("comment")&&(w.comment===void 0&&(w.comment=""),A||(i.setItem("comment",w.comment),i.setItem("commentDate",Date.now()))),w.hasOwnProperty("source")&&(w.source===void 0?i.removeItem("source"):A||(i.setItem("source",w.source),i.setItem("commentDate",Date.now()))),k(w,A),u&&u.call(x)}function S(v,w){let A=I();A.length&&i.removeItem("hashtags"),(!A.length||!w)&&(A=A.concat(M()));let E=new Set;return A.filter(T=>{let R=T.toLowerCase();return E.has(R)?!1:(E.add(R),!0)});function I(){return(v.comment||"").replace(/http\S*/g,"").match(iW)||[]}function M(){return(v.hashtags||"").split(/[,;\s]+/).map(function(R){R[0]!=="#"&&(R="#"+R);let P=R.match(iW);return P&&P[0]}).filter(Boolean)||[]}}function C(v){let w=v.review_requested;return w===void 0?!1:(w=w.trim().toLowerCase(),!(w===""||w==="no"))}function k(v,w){let A=Object.assign({},s.changeset.tags);if(Object.keys(v).forEach(function(E){let I=v[E];E=n.cleanTagKey(E),nW.indexOf(E)===-1&&(I===void 0?delete A[E]:w?A[E]=I:A[E]=n.cleanTagValue(I))}),!w){let E=v.hasOwnProperty("comment")&&v.comment!=="",I=S(A,E);I.length?(A.hashtags=n.cleanTagValue(I.join(";")),i.setItem("hashtags",A.hashtags)):(delete A.hashtags,i.removeItem("hashtags"))}if(c&&c.changesets_count!==void 0){let E=parseInt(c.changesets_count,10)+1;if(A.changesets_count=String(E),E<=100){let I;I=i.getItem("walkthrough_completed"),I&&(A["ideditor:walkthrough_completed"]=I),I=i.getItem("walkthrough_progress"),I&&(A["ideditor:walkthrough_progress"]=I),I=i.getItem("walkthrough_started"),I&&(A["ideditor:walkthrough_started"]=I)}}else delete A.changesets_count;(0,sW.default)(s.changeset.tags,A)||(s.changeset=s.changeset.update({tags:A}))}return xe(m,l,"on")}function gc(n,e){let t=n.systems.l10n,r=vr(e);r.select(".modal").classed("modal-alert",!0);let i=r.select(".content");i.append("div").attr("class","modal-section header"),i.append("div").attr("class","modal-section message-text");let s=i.append("div").attr("class","modal-section buttons cf");return r.okButton=function(){return s.append("button").attr("class","button ok-button action").on("click.confirm",()=>r.remove()).text(t.t("confirm.okay")).node().focus(),r},r}function Kb(n){let e=n.systems.editor,t=n.systems.l10n,r=n.systems.map,i=ge("cancel","save"),s=Xe("conflicts"),o,a,l;function c(){H(document).call(s.on("\u238B",f,!0))}function u(){H(document).call(s.unbind)}function d(){u(),i.call("save")}function f(){u(),i.call("cancel")}function h(x){c();let b=x.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");b.append("button").attr("class","fr").on("click",f).call(X("#rapid-icon-close")),b.append("h3").html(t.tHtml("save.conflict.header"));let _=x.selectAll(".body").data([0]).enter().append("div").attr("class","body fillL"),S=_.append("div").attr("class","conflicts-help").html(t.tHtml("save.conflict.help")),C=Et(),k=new ri;delete k.id;let v=ea.stringify(k.osmChangeJXON(o)),w=new Blob([v],{type:"text/xml;charset=utf-8;"}),A="changes.osc",E=S.selectAll(".download-changes").append("a").attr("class","download-changes");C.download?E.attr("href",window.URL.createObjectURL(w)).attr("download",A):E.attr("target","_blank").on("click.download",()=>navigator.msSaveBlob(w,A)),E.call(X("#rapid-icon-load","inline")).append("span").html(t.tHtml("save.conflict.download_changes")),_.append("div").attr("class","conflict-container fillL3").call(p,0),_.append("div").attr("class","conflicts-done").attr("opacity",0).style("display","none").html(t.tHtml("save.conflict.done"));let I=_.append("div").attr("class","buttons col12 joined conflicts-buttons");I.append("button").attr("disabled",a.length>1).attr("class","action conflicts-button col6").html(t.tHtml("save.title")).on("click.try_again",d),I.append("button").attr("class","secondary-action conflicts-button col6").html(t.tHtml("confirm.cancel")).on("click.cancel",f)}function p(x,b){b=Qt(b,0,a.length),l=b;let _=H(x.node().parentNode);b===a.length-1&&window.setTimeout(()=>{_.select(".conflicts-button").attr("disabled",null),_.select(".conflicts-done").transition().attr("opacity",1).style("display","block")},250);let S=x.selectAll(".conflict").data([a[b]]);S.exit().remove();let C=S.enter().append("div").attr("class","conflict");C.append("h4").attr("class","conflict-count").html(t.tHtml("save.conflict.count",{num:b+1,total:a.length})),C.append("a").attr("class","conflict-description").attr("href","#").text(v=>v.name).on("click",(v,w)=>{v.preventDefault(),y(w.id)});let k=C.append("div").attr("class","conflict-detail-container");k.append("ul").attr("class","conflict-detail-list").selectAll("li").data(v=>v.details||[]).enter().append("li").attr("class","conflict-detail-item").html(v=>v),k.append("div").attr("class","conflict-choices").call(m),k.append("div").attr("class","conflict-nav-buttons joined cf").selectAll("button").data(["previous","next"]).enter().append("button").html(v=>t.tHtml(`save.conflict.${v}`)).attr("class","conflict-nav-button action col6").attr("disabled",(v,w)=>w===0&&b===0||w===1&&b===a.length-1||null).on("click",(v,w)=>{v.preventDefault();let A=_.selectAll(".conflict-container"),E=w==="previous"?-1:1;A.selectAll(".conflict").remove(),A.call(p,b+E)})}function m(x){let b=x.append("ul").attr("class","layer-list").selectAll("li").data(C=>C.choices||[]),_=b.enter().append("li").attr("class","layer"),S=_.append("label");S.append("input").attr("type","radio").attr("name",C=>C.id).on("change",function(C,k){let v=this.parentNode.parentNode.parentNode;v.__data__.chosen=k.id,g(C,v,k)}),S.append("span").text(C=>C.text),_.merge(b).each((C,k,v)=>{let w=v[k].parentNode;w.__data__.chosen===C.id&&g(null,w,C)})}function g(x,b,_){x&&x.preventDefault(),H(b).selectAll("li").classed("active",v=>v===_).selectAll("input").property("checked",v=>v===_);let S=new le,C,k;C=e.staging.graph,k=C.hasEntity(_.id),k&&(S=S.extend(k.extent(C))),_.action(),C=e.staging.graph,k=C.hasEntity(_.id),k&&(S=S.extend(k.extent(C))),y(_.id,S)}function y(x,b){let S=e.staging.graph.hasEntity(x);S&&(b?r.trimmedExtent(b):r.fitEntitiesEase(S))}return h.conflictList=function(x){return arguments.length?(a=x,h):a},h.origChanges=function(x){return arguments.length?(o=x,h):o},h.shownEntityIds=function(){return a&&typeof l=="number"?[a[l].id]:[]},xe(h,i,"on")}var oP=4,df=class{constructor(e){this.context=e,this._lastv=null,this.$parent=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this.deferredRender=mn(this.rerender,1e3,{leading:!0,trailing:!0}),e.systems.gfx.on("draw",this.deferredRender)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.editor,i=t.systems.l10n,s=t.services.osm,o=t.viewport;if(!s||this._lastv===o.v)return;let a=e.selectAll(".contributors").data([0]),l=a.enter().append("div").attr("class","contributors");l.call(X("#rapid-icon-nearby","pre-text light")),l.append("span").attr("class","user-list"),a=a.merge(l);let c=new Set,u=r.intersects(o.visibleExtent());for(let p of u)p?.user&&c.add(p.user);if(c.size===0){a.classed("hide",!0);return}else a.classed("hide",!1),this._lastv=o.v;let d=Array.from(c).slice(0,oP),f=H(document.createElement("span"));f.selectAll("a").data(d).enter().append("a").attr("class","user-link").attr("href",p=>s.userURL(p)).attr("target","_blank").text(p=>p);let h=f.node().outerHTML;if(c.size>oP){let p=c.size-oP,m=H(document.createElement("a"));m.attr("target","_blank").attr("href",s.changesetsURL(o.centerLoc(),o.transform.zoom)).text(p);let g=m.node().outerHTML;a.selectAll(".user-list").html(i.t("contributors.truncated_list",{n:p,users:h,count:g}))}else a.selectAll(".user-list").html(i.t("contributors.list",{users:h}))}};function Qb(n){let e=n.systems.l10n,t;function r(i){let s=i.selectAll(".data-header").data(t?[t]:[],l=>l.__featurehash__);s.exit().remove();let o=s.enter().append("div").attr("class","data-header");o.append("div").attr("class","data-header-icon").append("div").attr("class","preset-icon-28").call(X("#rapid-icon-data")),o.append("div").attr("class","data-header-label").html(e.tHtml("map_data.layers.custom.title"))}return r.datum=function(i){return arguments.length?(t=i,this):t},r}function ff(n){let e=n.systems.l10n,t=Qb(n),r=mc(n,"custom-data-tag-editor").readOnlyTags([/./]),i;function s(o){let l=o.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");l.append("button").attr("class","close").on("click",()=>n.enter("browse")).call(X("#rapid-icon-close")),l.append("h3").html(e.tHtml("map_data.title"));let c=o.selectAll(".body").data([0]);c=c.enter().append("div").attr("class","body").merge(c);let u=c.selectAll(".data-editor").data([0]);u.enter().append("div").attr("class","modal-section data-editor").merge(u).call(t.datum(i));let d=c.selectAll(".data-tag-editor").data([0]);d.enter().append("div").attr("class","data-tag-editor").merge(d).call(r.tags(i&&i.properties||{}).state("hover").render).selectAll("textarea.tag-text").attr("readonly",!0).classed("readonly",!0)}return s.datum=function(o){return arguments.length?(i=o,this):i},s}var hf=class{constructor(e){this.context=e,this.spritesheetIDs=["rapid","maki","temaki","fa","roentgen","community","mapillary"],this.$parent=null,this.render=this.render.bind(this),this._spritesheetLoaded=this._spritesheetLoaded.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let r=this.context.systems.assets;e.selectAll("#rapid-defs").data([0]).enter().append("svg").attr("id","rapid-defs").append("defs"),e.selectAll("#rapid-defs > defs").selectAll(".spritesheet").data(this.spritesheetIDs,s=>s).enter().append("g").attr("class",s=>`spritesheet spritesheet-${s}`).each((s,o,a)=>{let l=H(a[o]),c=r.getFileURL(`img/${s}-sprite.svg`);fetch(c).then(Ae).then(u=>l.call(this._spritesheetLoaded,s,u)).catch(u=>console.error(u))})}_spritesheetLoaded(e,t,r){let i=e.node(),s=r.documentElement;s.setAttribute("id",t),i.appendChild(s),["maki","temaki","fa","roentgen","community"].includes(t)&&e.selectAll("path").attr("fill","currentColor");let o=this.context.systems.gfx.textures;if(!o)throw new Error(`TextureManager not ready to pack icons for ${t}`);e.selectAll("symbol").each((a,l,c)=>{let u=c[l],d=u.getAttribute("id");o.registerSvgIcon(d,u)})}};function Zb(n){let e=n.systems.l10n,t;function r(s){if(!s)return null;let o={day:"numeric",month:"short",year:"numeric"},a=new Date(s);if(isNaN(a.getTime()))return null;let l=e.localeCode();return a.toLocaleDateString(l,o)}function i(s){let o=s.selectAll(".error-details").data(t?[t]:[],f=>f.key);o.exit().remove();let l=o.enter().append("div").attr("class","error-details qa-details-container").append("div").attr("class","qa-details-subsection");l.append("h3").text(e.t("inspector.details")+":");let c=l.attr("class","qa-details-item").append("div");c.append("strong").text(e.t("inspector.type")+":"),c.append("span").text(f=>f.value);let u=l.attr("class","qa-details-item").append("div");u.append("strong").text(e.t("inspector.first_seen")+":"),u.append("span").text(f=>f.first_seen_at?r(f.first_seen_at):e.t("inspector.unknown"));let d=l.attr("class","qa-details-item").append("div");d.append("strong").text(e.t("inspector.last_seen")+":"),d.append("span").text(f=>f.last_seen_at?r(f.last_seen_at):e.t("inspector.unknown"))}return i.datum=function(s){return arguments.length?(t=s,i):t},i}function Jb(n){let e=n.systems.l10n,t=n.systems.presets,r;function i(a){if(a.object_type==="traffic_sign")return e.t("mapillary_signs.traffic_sign");{let l=a.value.replace(/--/g,".");return e.t(`mapillary_detections.${l}`,{default:e.t("inspector.unknown")})}}function s(a){let l=a.datum();if(!l)return;let c;if(l.object_type==="traffic_sign")c=l.value;else{let d=n.services[l.service],f=d&&d.getDetectionPresetID(l.value);c=(f&&t.item(f))?.icon||"fas-question"}let u=n.container().selectAll(`#rapid-defs #${c}`).size();a.call(X(u?`#${c}`:"#fas-question"))}function o(a){let l=a.selectAll(".qa-header").data(r?[r]:[],u=>u.key);l.exit().remove();let c=l.enter().append("div").attr("class","qa-header");c.append("div").attr("class","qa-header-icon").append("div").attr("class",u=>`qaItem ${u.service}`).call(s),c.append("div").attr("class","qa-header-label").text(i)}return o.datum=function(a){return arguments.length?(r=a,o):r},o}var qn=class{constructor(e){this.context=e,this.url=null,this.stringID=null,this.$parent=null,this.render=this.render.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let r=this.context.systems.l10n,i=this.url,s=this.stringID,o=e.selectAll(".view-on").data(i&&s?[i]:[],l=>l);o.exit().remove();let a=o.enter().append("a").attr("class","view-on").attr("target","_blank").call(X("#rapid-icon-out-link","inline"));a.append("span"),o=o.merge(a),o.attr("href",l=>l),o.selectAll("span").text(s?r.t(s):"")}};function pf(n){let e=n.systems.l10n,t=n.systems.photos,r=Zb(n),i=Jb(n),s=new qn(n),o;function a(l){let c=l.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");c.append("button").attr("class","close").on("click",()=>n.enter("browse")).call(X("#rapid-icon-close")),c.append("h3").text(e.t("mapillary.detection"));let u=l.selectAll(".body").data([0]);u=u.enter().append("div").attr("class","body").merge(u);let d=u.selectAll(".qa-editor").data([0]);d.enter().append("div").attr("class","modal-section qa-editor").merge(d).call(i.datum(o)).call(r.datum(o));let f=n.services[o.service],h=o.bestImageID||t.currPhotoID;f&&h?(s.stringID="mapillary.view_on_mapillary",s.url=f.imageURL(h)):(s.stringID="",s.url="");let p=l.selectAll(".sidebar-footer").data([0]);p.enter().append("div").attr("class","sidebar-footer").merge(p).call(s.render)}return a.datum=function(l){return arguments.length?(o=l,a):o},a}function e_(n){let e=ge("toggled"),t=n.systems.gfx,r=n.systems.l10n,i=n.systems.map,s=n.systems.ui,o=n.viewport,a=85,l=45,c=35,u=10,d=4,f=210,h=H(null),p=[],m=new Map,g=[0,0],y=0,x="",b=!1,_,S,C=function(v){x===void 0&&(x="rightclick");let w=x.includes("touch")||x.includes("pen"),A=p.filter(B=>!w||!B.mouseOnly);if(!A.length)return;b=w;let E=!0,I=E?32:34;E?S=52+Math.min(120,6*Math.max.apply(Math,A.map(function(B){return B.title.length}))):S=44,_=d*2+A.length*I,y=o.transform.scale;let M=v.selectAll(".edit-menu").data([0]),T=M.enter().append("div").attr("class","edit-menu").classed("touch-menu",w).style("padding",d+"px 0");h=M.merge(T);let R=h.selectAll(".edit-menu-item").data(A,B=>B.id);R.exit().remove();let P=R.enter().append("button").attr("class",B=>`edit-menu-item edit-menu-item-${B.id}`).style("height",`${I}px`).on("click",F).on("pointerup",N).on("pointerdown mousedown",function(B){B.stopPropagation()}).on("mouseenter.highlight",function(B,O){!O.relatedEntityIds||H(this).classed("disabled")||Je(O.relatedEntityIds(),!0,n)}).on("mouseleave.highlight",function(B,O){O.relatedEntityIds&&Je(O.relatedEntityIds(),!1,n)});P.each((B,O,G)=>{let U=H(G[O]);U.append("div").attr("class","icon-wrap").call(X("","operation")),E&&U.append("span").attr("class","label");let W=de(n);m.set(B.id,W),U.call(W)}),R=R.merge(P),R.each((B,O,G)=>{let U=H(G[O]);U.classed("disabled",V=>V.disabled()),U.selectAll(".icon-wrap use").attr("href",`#rapid-operation-${B.id}`),U.selectAll(".label").text(V=>V.title);let W=m.get(B.id);W&&W.heading(B.title).title(B.tooltip()).shortcut(B.keys[0])}),k(),i.off("move",k),i.on("move",k);let D;function N(B){D=B.pointerType}function F(B,O){B.stopPropagation(),O.relatedEntityIds&&Je(O.relatedEntityIds(),!1,n),O.disabled()?(D==="touch"||D==="pen")&&s.Flash.duration(4e3).iconName(`#rapid-operation-${O.id}`).iconClass("operation disabled").label(O.tooltip)():((D==="touch"||D==="pen")&&s.Flash.duration(2e3).iconName(`#rapid-operation-${O.id}`).iconClass("operation").label(O.annotation()||O.title)(),O(),C.close()),D=null}e.call("toggled",this,!0)};function k(){if(!h||h.empty())return;if(y!==o.transform.scale){C.close();return}let v=o.project(g,!0),w=t.surface.getBoundingClientRect();if(v[0]<0||v[0]>w.width||v[1]<0||v[1]>w.height){C.close();return}let A=R(w),E=[0,0];E[0]=A?-1*(u+S):u,b?v[1]-_<a?E[1]=-v[1]+a:E[1]=-_:v[1]+_>w.height-l?E[1]=-v[1]-_+w.height-l:E[1]=0;let[I,M]=bt(v,E);h.style("left",`${I}px`).style("top",`${M}px`);let T=P(w,A);for(let D of m.values())D.placement(T),D.isShown()&&D.updateContent();function R(D){return r.isRTL()?!(v[0]-u-S<c):v[0]+u+S>D.width-c}function P(D,N){return r.isRTL()?!N||v[0]-u-S-f<c?"right":"left":N||v[0]+u+S+f>D.width-c?"left":"right"}}return C.close=function(){i.off("move",k),h.remove(),m.clear(),e.call("toggled",this,!1)},C.anchorLoc=function(v){return arguments.length?(g=v,C):g},C.triggerType=function(v){return arguments.length?(x=v,C):x},C.operations=function(v){return arguments.length?(p=v,C):p},xe(C,e,"on")}var cP=Ot(_2(),1);function t_(n){let e=n.systems.editor,t=n.systems.l10n,r=n.systems.map,i=n.systems.storage,s=n.systems.validator,a=(i.getItem("entity-issues.reference.expanded")||"true")==="true",l=[],c=[],u,d=Ke(n,"entity-issues").shouldDisplay(()=>c.length).label(()=>t.t("inspector.title_count",{title:t.t("issues.title"),count:c.length})).disclosureContent(p);function f(){c=s.getSharedEntityIssues(l,{includeDisabledRules:!0})}function h(y){u=y,d.selection().selectAll(".issue-container").classed("active",x=>x.id===u)}function p(y){y.classed("grouped-items-area",!0),u=c.length?c[0].id:null;let x=y.selectAll(".issue-container").data(c,I=>I.key);x.exit().remove();let b=x.enter().append("div").attr("class","issue-container"),_=b.append("div").attr("class",I=>`issue severity-${I.severity}`).on("mouseover.highlight",function(I,M){let T=M.entityIds.filter(R=>!l.includes(R));Je(T,!0,n)}).on("mouseout.highlight",function(I,M){let T=M.entityIds.filter(R=>!l.includes(R));Je(T,!1,n)}),S=_.append("div").attr("class","issue-label"),C=S.append("button").attr("class","issue-text").on("click",function(I,M){h(M.id);let T=e.staging.graph,R=M.extent(T);if(R){let P=Math.max(r.zoom(),19);r.centerZoomEase(R.center(),P)}});C.each((I,M,T)=>{H(T[M]).call(X(s.getSeverityIcon(I.severity),"issue-icon"))}),C.append("span").attr("class","issue-message"),S.append("button").attr("class","issue-info-button").attr("title",t.t("icons.information")).call(X("#rapid-icon-inspect")).on("click",function(I){I.stopPropagation(),I.preventDefault(),this.blur();let T=H(this.parentNode.parentNode.parentNode).selectAll(".issue-info"),R=T.classed("expanded");a=!R,i.setItem("entity-issues.reference.expanded",a),R?T.transition().duration(200).style("max-height","0px").style("opacity","0").on("end",()=>T.classed("expanded",!1)):T.classed("expanded",!0).transition().duration(200).style("max-height","200px").style("opacity","1").on("end",()=>T.style("max-height",null))}),_.append("ul").attr("class","issue-fix-list"),b.append("div").attr("class","issue-info"+(a?" expanded":"")).style("max-height",a?null:"0").style("opacity",a?"1":"0").each((I,M,T)=>{let R=H(T[M]);typeof I.reference=="function"?R.call(I.reference):R.text(t.t("inspector.no_documentation_key"))}),x=x.merge(b).classed("active",I=>I.id===u),x.selectAll(".issue-message").html(I=>I.message(n));let w=x.selectAll(".issue-fix-list").selectAll(".issue-fix-item").data(I=>I.fixes?I.fixes():[],I=>I.id);w.exit().remove();let A=w.enter().append("li").attr("class","issue-fix-item"),E=A.append("button").on("click",function(I,M){H(this).attr("disabled")||!M.onClick||M.issue.dateLastRanFix&&new Date-M.issue.dateLastRanFix<1e3||(M.issue.dateLastRanFix=new Date,Je(M.issue.entityIds.concat(M.entityIds),!1,n),M.onClick())}).on("mouseover.highlight",(I,M)=>Je(M.issue.entityIds,!0,n)).on("mouseout.highlight",(I,M)=>Je(M.issue.entityIds,!1,n));E.each((I,M,T)=>{let R=I.icon??"rapid-icon-wrench";H(T[M]).call(X(`#${R}`,"fix-icon"))}),E.append("span").attr("class","fix-message").text(I=>I.title),A.merge(w).selectAll("button").classed("actionable",I=>typeof I.onClick=="function").attr("disabled",I=>typeof I.onClick=="function"?null:"true").attr("title",I=>I.disabledReason??null)}let m=()=>{f(),d.reRender()},g=y=>{h(y.id)};return s.off("validated",m),s.off("focusedIssue",g),s.on("validated",m),s.on("focusedIssue",g),d.entityIDs=function(y){return y===void 0?l:((!l||!y||!Kr(l,y))&&(l=y,u=null,f()),d)},d}function O1(n){let e,t;function r(p,m){return Array.isArray(p)?"rapid-icon-data":p.icon?p.icon:m==="line"?"rapid-other-line":m==="vertex"?p.isFallback()?"":"temaki-vertex":"maki-marker-stroked"}function i(p,m){let y=new ce(m.fill.color).toHex(),x=m.fill.alpha;p.append("svg").attr("class","preset-icon-category-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60").append("path").attr("fill",y).attr("fill-opacity",x).attr("stroke",y).attr("d","M9.5,7.5 L25.5,7.5 L28.5,12.5 L49.5,12.5 C51.709139,12.5 53.5,14.290861 53.5,16.5 L53.5,43.5 C53.5,45.709139 51.709139,47.5 49.5,47.5 L10.5,47.5 C8.290861,47.5 6.5,45.709139 6.5,43.5 L6.5,12.5 L9.5,7.5 Z")}function s(p){p.append("svg").attr("class","preset-icon-point-border").attr("width","60px").attr("height","60px").attr("viewBox","-10 -27 20 30").append("path").attr("d","M 0,0 C -2,-2 -8,-10 -8,-15 C -8,-19 -4,-23 0,-23 C 4,-23 8,-19 8,-15 C 8,-10 2,-2 0,0 Z")}function o(p){p.append("svg").attr("class","preset-icon-vertex-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60").append("circle").attr("cx",30).attr("cy",30).attr("r",40/2)}function a(p,m){let S=new ce(m.fill.color).toHex(),C=m.fill.alpha,k=p.append("svg").attr("class","preset-icon-area-border").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60");k.append("path").attr("fill",S).attr("fill-opacity",C).attr("stroke",S).attr("d","M10 10 L10 50 L50 50 L50 10 Z");let v=2.5;[[10,10],[10,50],[50,50],[50,10]].forEach(([A,E])=>{k.append("circle").attr("class","vertex").attr("cx",A).attr("cy",E).attr("r",v)});let w=1.25;[[10,30],[50,30],[30,10],[30,50]].forEach(([A,E])=>{k.append("circle").attr("class","midpoint").attr("cx",A).attr("cy",E).attr("r",w)})}function l(p,m){let y=Math.round(43.199999999999996),x=Math.round(60*.6),b=(60-x)/2,_=b+x,S=new ce(m.casing.color).toHex(),C=new ce(m.stroke.color).toHex(),k=m.stroke.dash,v=Array.isArray(k),w=p.append("svg").attr("class","preset-icon-line").attr("width","60px").attr("height","60px").attr("viewBox","0 0 60 60");w.append("path").attr("class","casing").attr("stroke",S).attr("stroke-opacity",v?1:.5).attr("d",`M${b} ${y} L${_} ${y}`),w.append("path").attr("class","stroke").attr("stroke",C).attr("stroke-dasharray",v?k.map(E=>E*.75).join(" "):null).attr("d",`M${b} ${y} L${_} ${y}`);let A=3;[[b-1,y],[_+1,y]].forEach(([E,I])=>{w.append("circle").attr("class","vertex").attr("cx",E).attr("cy",I).attr("r",A)})}function c(p){p.append("div").attr("class","preset-icon-route").call(X("#rapid-route","rapid-icon lowered"))}function u(p,m,g,y){p.append("div").attr("class","preset-icon").call(X(`#${m}`,g.join(" "))),p.selectAll(".preset-icon svg.icon").attr("color",y)}function d(p,m){p.selectAll("img.image-icon").data([m]).enter().append("img").attr("class","image-icon").attr("src",m).on("load",()=>p.classed("showing-img",!0)).on("error",()=>p.classed("showing-img",!1))}function f(p){let m=p.selectAll(".preset-icon-container").data([0]);m=m.enter().append("div").attr("class","preset-icon-container").merge(m).html("");let g=e,y=t;if(!g||!y)return;let x=Array.isArray(g),b=!x&&typeof g.setTags=="function",_=!x&&!b,S=b?g.setTags({},y):{};for(let P in S)S[P]==="*"&&(S[P]="yes");y==="relation"&&(S.type==="route"||S.type==="waterway")&&(y="route");let C=n.systems.storage,k=n.systems.styles,w=(C.getItem("preferences.privacy.thirdpartyicons")??"true")==="true"&&g.imageURL,A=r(g,y),E=b&&y==="vertex",I=b&&y==="line",M=b&&y==="area",T=b&&y==="route"&&g.id!=="type/route",R=k.styleMatch(S);if(m.classed("showing-img",!!w),_&&i(m,R),E&&o(m),M&&a(m,R),I&&l(m,R),T&&c(m),A){let P=I||T,D=x||_||I||T,N=/^rapid-/.test(A),F=[];N&&F.push("rapid-icon"),D&&F.push("shrunk"),P&&F.push("raised");let B="#333";(I||T)&&N&&(B=new ce(R.stroke.color).toHex()),u(m,A,F,B)}w&&d(m,w)}h.preset=function(p){return arguments.length?(e=p,h):e},h.geometry=function(p){return arguments.length?(t=p,h):t};function h(p){p.call(f)}return h}function r_(n){let e=n.systems.editor,t=n.systems.l10n,r=ge("choose"),i=[],s=[],o,a=Ke(n,"feature-type").label(t.t("inspector.feature_type")).disclosureContent(l);function l(u){u.classed("preset-list-item",!0),u.classed("mixed-types",s.length>1);let d=u.selectAll(".preset-list-button-wrap").data([0]).enter().append("div").attr("class","preset-list-button-wrap"),f=d.append("button").attr("class","preset-list-button preset-reset").call(de(n).title(t.t("inspector.back_tooltip")).placement("bottom"));f.append("div").attr("class","preset-icon-container"),f.append("div").attr("class","label").append("div").attr("class","label-inner"),d.append("div").attr("class","accessory-buttons");let h=u.selectAll(".tag-reference-body-wrap").data([0]);h=h.enter().append("div").attr("class","tag-reference-body-wrap").merge(h),o&&(u.selectAll(".preset-list-button-wrap .accessory-buttons").style("display",s.length===1?null:"none").call(o.button),h.style("display",s.length===1?null:"none").call(o.body)),u.selectAll(".preset-reset").on("click",function(){r.call("choose",this,s)}).on("pointerdown pointerup mousedown mouseup",function(x){x.preventDefault(),x.stopPropagation()});let p=c();u.select(".preset-list-item button").call(O1(n).geometry(p.length===1?p[0]:p).preset(s.length===1?s[0]:s));let m=s.length===1?[s[0].nameLabel(),s[0].subtitleLabel()].filter(Boolean):[t.t("inspector.multiple_types")],y=u.select(".label-inner").selectAll(".namepart").data(m,x=>x);y.exit().remove(),y.enter().append("div").attr("class","namepart").html(x=>x)}a.entityIDs=function(u){return arguments.length?(i=u,a):i},a.presets=function(u){return arguments.length?(Kr(u,s)||(s=u,s.length===1&&(o=Jo(n,s[0].reference()).showing(!1))),a):s};function c(){let u={},d=e.staging.graph;for(let f of i){let h=d.geometry(f);u[h]||(u[h]=0),u[h]+=1}return Object.keys(u).sort((f,h)=>u[h]-u[f])}return xe(a,r,"on")}function n_(n){let e=n.systems.editor,t=n.systems.l10n,r=n.systems.presets,i=Ke(n,"preset-fields").label(t.t("inspector.fields")).disclosureContent(f),s=ge("change","revert"),o=uf(n),a,l,c=[],u,d;function f(h){if(!l){let p=e.staging.graph,m=Object.keys(d.reduce((v,w)=>(v[p.entity(w).geometry(p)]=!0,v),{})),g=[],y=[],x;for(let v of c){let w=v.fields(),A=v.moreFields();g=Ur(g,w),y=Ur(y,A),x?x=x.filter(E=>w.includes(E)||A.includes(E)):x=Ur(w,A)}let b=g.filter(v=>x.includes(v)),_=y.filter(v=>x.includes(v));l=[];for(let v of b)v.matchAllGeometry(m)&&l.push(new Fi(n,v,d));let S=t.localeCode(),C=Ur(_,r.universal());C.sort((v,w)=>v.label().localeCompare(w.label(),S));for(let v of C)!b.includes(v)&&v.matchAllGeometry(m)&&l.push(new Fi(n,v,d,{show:!1}));let k=d.slice();for(let v of l)v.on("change",(w,A)=>{s.call("change",v,k,w,A)}),v.on("revert",w=>{s.call("revert",v,w)})}for(let p of l)p.state(a).tags(u);h.call(o.fieldsArr(l).state(a).klass("grouped-items-area")),h.selectAll(".wrap-form-field input").on("keydown",function(p){p.keyCode===13&&n.container().select(".combobox").empty()&&n.enter("browse")})}return i.presets=function(h){return arguments.length?((!c||!h||!Kr(c,h))&&(c=h,l=null),i):c},i.state=function(h){return arguments.length?(a=h,i):a},i.tags=function(h){return arguments.length?(u=h,i):u},i.entityIDs=function(h){return arguments.length?((!h||!d||!Kr(d,h))&&(d=h,l=null),i):d},xe(i,s,"on")}var aP=1e3;function i_(n){let e=n.systems.editor,t=n.systems.l10n,r=n.systems.map,i=n.systems.presets,s=n.services.taginfo,o=n.viewport,a=[],l=Ke(n,"raw-member-editor").shouldDisplay(function(){return!a||a.length!==1?!1:e.staging.graph.hasEntity(a[0])?.type==="relation"}).label(function(){let b=e.staging.graph.hasEntity(a[0]);if(!b)return"";let S=(b.members.length>aP?">":"")+b.members.slice(0,aP).length;return t.t("inspector.title_count",{title:t.t("inspector.members"),count:S})}).disclosureContent(p);function c(x,b){x.preventDefault(),H(this.parentNode).classed("tag-reference-loading",!0),n.loadEntity(b.id,function(){l.reRender()})}function u(x,b){x.preventDefault();let S=e.staging.graph.entity(b.id);r.fitEntitiesEase(S),Je([b.id],!0,n)}function d(x,b){x.preventDefault(),Je([b.id],!1,n);let _=e.staging.graph,S=_.entity(b.id),C=o.visibleExtent();S.intersects(C,_)||r.fitEntitiesEase(S),n.enter("select-osm",{selection:{osm:[b.id]}})}function f(x,b){let _=b.role,S=n.cleanRelationRole(H(this).property("value"));if(_!==S){let C={id:b.id,type:b.type,role:S};e.perform(nl(b.relation.id,C,b.index)),e.commit({annotation:t.t("operations.change_role.annotation",{n:1}),selectedIDs:[b.relation.id]})}}function h(x,b){Je([b.id],!1,n),e.perform(il(b.relation.id,b.index)),e.commit({annotation:t.t("operations.delete_member.annotation",{n:1}),selectedIDs:[b.relation.id]}),e.staging.graph.hasEntity(b.relation.id)||n.enter("browse")}function p(x){let b=e.staging.graph,_=a[0],S=b.entity(_),C=[];S.members.slice(0,aP).forEach((T,R)=>{C.push({index:R,id:T.id,type:T.type,role:T.role,relation:S,member:b.hasEntity(T.id),uid:xo(`${_}-member-${R}`)})});let k=x.selectAll(".member-list").data([0]);k=k.enter().append("ul").attr("class","member-list").merge(k);let v=k.selectAll("li").data(C,T=>{let R=me.key(T.relation),P=T.member&&me.key(T.member)||"incomplete";return`${R},${T.index},${P}`});v.exit().each(y).remove();let w=v.enter().append("li").attr("class","member-row form-field").classed("member-incomplete",T=>!T.member);w.each((T,R,P)=>{let D=H(P[R]),N=D.append("label").attr("class","field-label").attr("for",T.uid);if(T.member){D.on("mouseover",()=>Je([T.id],!0,n)).on("mouseout",()=>Je([T.id],!1,n));let F=N.append("span").attr("class","label-text").append("a").attr("href","#").on("click",d);F.append("span").attr("class","member-entity-type").html(B=>{let O=i.match(B.member,e.staging.graph);return O&&O.name()||t.displayType(B.member.id)}),F.append("span").attr("class","member-entity-name").classed("has-color",B=>!!m(B.member)).style("border-color",B=>m(B.member)).text(B=>B.member?t.displayName(B.member.tags):""),N.append("button").attr("title",t.t("icons.remove")).attr("class","remove member-delete").call(X("#rapid-operation-delete")),N.append("button").attr("class","member-zoom").attr("title",t.t("icons.zoom_to")).call(X("#rapid-icon-framed-dot","monochrome")).on("click",u)}else{let F=N.append("span").attr("class","label-text");F.append("span").attr("class","member-entity-type").text(t.t(`inspector.${T.type}`,{id:T.id})),F.append("span").attr("class","member-entity-name").text(t.t("inspector.incomplete",{id:T.id})),N.append("button").attr("class","member-download").attr("title",t.t("icons.download")).call(X("#rapid-icon-load")).on("click",c)}});let A=w.append("div").attr("class","form-field-input-wrap form-field-input-member");A.append("input").attr("class","member-role").attr("id",T=>T.uid).property("type","text").attr("placeholder",t.t("inspector.role")).call(Oe),s&&A.each(g),v=v.merge(w).order(),v.select("input.member-role").property("value",T=>T.role).on("blur",f).on("change",f),v.select("button.member-delete").on("click",h);let E,I,M;v.call(Xp().on("start",function(T){E=T.x,I=T.y,M=null}).on("drag",function(T){let[R,P]=[T.x,T.y],[D,N]=Me([R,P],[E,I]);if(!H(this).classed("dragging")&&Ne([D,N])<=5)return;let F=v.nodes().indexOf(this);H(this).classed("dragging",!0),M=null,x.selectAll("li.member-row").style("transform",function(B,O){let G=H(this).node();return F===O?`translate(${D}px, ${N}px)`:O>F&&P>G.offsetTop?((M===null||O>M)&&(M=O),"translateY(-100%)"):O<F&&P<G.offsetTop+G.offsetHeight?((M===null||O<M)&&(M=O),"translateY(100%)"):null})}).on("end",function(T,R){if(!H(this).classed("dragging"))return;let P=v.nodes().indexOf(this);H(this).classed("dragging",!1),x.selectAll("li.member-row").style("transform",null),M!==null&&(e.perform(Nm(R.relation.id,P,M)),e.commit({annotation:t.t("operations.reorder_members.annotation"),selectedIDs:[R.relation.id]}))}))}l.entityIDs=function(x){return arguments.length?(a=x||[],l):a};function m(x){let b=x?.type==="relation"&&x?.tags.colour;return b&&el(b)?b:null}function g(x,b,_){let C=H(_[b]).selectAll("input.member-role"),k=C.property("value");function v(w,A){let E=[],I=[];for(let M of A)M.value.substring(0,w.length)===w?E.push(M):I.push(M);return E.concat(I)}C.call(ct(n,"member-role").fetcher(function(w,A){let E;x.member?E=e.staging.graph.geometry(x.member.id):x.type==="relation"?E="relation":x.type==="way"?E="line":E="point",s.roles({debounce:!0,rtype:x.relation.tags.type||"",geometry:E,query:w},(I,M)=>{I||A(v(w,M))})}).on("cancel",()=>{C.property("value",k)}))}function y(x,b,_){H(_[b]).selectAll("input.member-role").call(ct.off,n)}return l}function oW(n,e){return function(t){e.sort((i,s)=>s-i);for(var r in e)t=il(n,e[r])(t);return t}}var lP=1e3;function s_(n){let e=n.systems.editor,t=n.systems.l10n,r=n.systems.map,i=n.systems.presets,s=n.services.taginfo,o=n.viewport;var a=Ke(n,"raw-membership-editor").shouldDisplay(function(){return u&&u.length}).label(function(){var C=f(),k=C.length>lP?">":"",v=k+C.slice(0,lP).length;return t.t("inspector.title_count",{title:t.t("inspector.relations"),count:v})}).disclosureContent(S),l=ct(n,"parent-relation").minItems(1).fetcher(_).itemsMouseEnter(function(C,k){k.relation&&Je([k.relation.id],!0,n)}).itemsMouseLeave(function(C,k){k.relation&&Je([k.relation.id],!1,n)}),c=!1,u=[],d;function f(){for(var C=[],k=0;k<u.length;k++){var v=e.staging.graph.hasEntity(u[k]);if(v&&(k===0?C=e.staging.graph.parentRelations(v):C=bn(C,e.staging.graph.parentRelations(v)),!C.length))break}return C}function h(){var C=[],k=f().slice(0,lP),v=u.length>1,w,A,E,I,M,T;for(w=0;w<k.length;w++){for(A=k[w],E={relation:A,members:[],hash:me.key(A)},I=0;I<A.members.length;I++)M=A.members[I],u.indexOf(M.id)!==-1&&(T=Object.assign({},M,{index:I}),E.members.push(T),E.hash+=","+I.toString(),v||(C.push(E),E={relation:A,members:[],hash:me.key(A)}));E.members.length&&C.push(E)}return C.forEach(function(R){R.uid=xo("membership-"+R.relation.id);var P=[];R.members.forEach(function(D){P.indexOf(D.role)===-1&&P.push(D.role)}),R.role=P.length===1?P[0]:P}),C}function p(C,k){C.preventDefault(),Je([k.relation.id],!1,n),n.enter("select-osm",{selection:{osm:[k.relation.id]}})}function m(C,k){C.preventDefault();let w=e.staging.graph.entity(k.relation.id);r.fitEntitiesEase(w),Je([k.relation.id],!0,n)}function g(C){let k=C?.type==="relation"&&C?.tags.colour;return k&&el(k)?k:null}function y(C,k){if(k!==0&&!c){var v=n.cleanRelationRole(H(this).property("value"));if(!(!v.trim()&&typeof k.role!="string")){var w=k.members.filter(function(A){return A.role!==v});if(w.length){c=!0;let A=E=>{for(let I of w){let M=Object.assign({},I,{role:v});delete M.index,E=nl(k.relation.id,M,I.index)(E)}return E};e.perform(A),e.commit({annotation:t.t("operations.change_role.annotation",{n:w.length}),selectedIDs:[k.relation.id]})}c=!1}}}function x(C,k){this.blur(),d=!1;function v(A,E,I){return function(M){for(var T in E){var R={id:E[T],type:M.entity(E[T]).type,role:I};M=Ic(A,R)(M)}return M}}if(C.relation)e.perform(v(C.relation.id,u,k)),e.commit({annotation:t.t("operations.add_member.annotation",{n:u.length}),selectedIDs:[C.relation.id]});else{var w=mr();e.perform(Yt(w),v(w.id,u,k)),e.commit({annotation:t.t("operations.add.annotation.relation"),selectedIDs:[w.id]}),n.enter("select-osm",{selection:{osm:[w.id]},newFeature:!0})}}function b(C,k){if(this.blur(),k!==0){Je([k.relation.id],!1,n);var v=k.members.map(function(w){return w.index});e.perform(oW(k.relation.id,v)),e.commit({annotation:t.t("operations.delete_member.annotation",{n:u.length}),selectedIDs:[k.relation.id]})}}function _(C,k){var v={relation:null,value:t.t("inspector.new_relation"),display:t.t("inspector.new_relation")},w=u[0],A=[],E=e.staging.graph;function I(P){var D=i.match(P,E),N=D&&D.name()||t.t("inspector.relation"),F=t.displayName(P.tags)||"";return N+" "+F}function M(P){var D=i.match(P,E),N=D&&D.name()||t.t("inspector.relation"),F=t.displayName(P.tags)||"",B=g(P);return O=>{O.append("b").text(N+" "),O.append("span").classed("has-color",!!B).style("border-color",B).text(F)}}var T=C&&E.hasEntity(C.toLowerCase());if(T&&T.type==="relation"&&T.id!==w)A.push({relation:T,value:I(T)+" "+T.id,display:M(T)});else{let P=o.visibleExtent();e.intersects(P).forEach(function(D){if(!(D.type!=="relation"||D.id===w)){var N=I(D);C&&(N+" "+D.id).toLowerCase().indexOf(C.toLowerCase())===-1||A.push({relation:D,value:N,display:M(D)})}}),A.sort(function(D,N){return mr.creationOrder(D.relation,N.relation)});var R=Object.values(hr(A,"value")).filter(function(D){return D.length>1});R.forEach(function(D){D.forEach(function(N){N.value+=" "+N.relation.id})})}A.forEach(function(P){P.title=P.value}),A.unshift(v),k(A)}function S(C){var k=h(),v=C.selectAll(".member-list").data([0]);v=v.enter().append("ul").attr("class","member-list").merge(v);var w=v.selectAll("li.member-row-normal").data(k,function(V){return V.hash});w.exit().each(W).remove();var A=w.enter().append("li").attr("class","member-row member-row-normal form-field");A.on("mouseover",function(V,j){Je([j.relation.id],!0,n)}).on("mouseout",function(V,j){Je([j.relation.id],!1,n)});var E=A.append("label").attr("class","field-label").attr("for",function(V){return V.uid}),I=E.append("span").attr("class","label-text").append("a").attr("href","#").on("click",p);I.append("span").attr("class","member-entity-type").html(function(V){let j=i.match(V.relation,e.staging.graph);return j&&j.name()||t.t("inspector.relation")}),I.append("span").attr("class","member-entity-name").classed("has-color",V=>!!g(V.relation)).style("border-color",V=>g(V.relation)).text(function(V){let j=i.match(V.relation,e.staging.graph);return t.displayName(V.relation.tags,j.suggestion)}),E.append("button").attr("class","remove member-delete").call(X("#rapid-operation-delete")).on("click",b),E.append("button").attr("class","member-zoom").attr("title",t.t("icons.zoom_to")).call(X("#rapid-icon-framed-dot","monochrome")).on("click",m);var M=A.append("div").attr("class","form-field-input-wrap form-field-input-member");M.append("input").attr("class","member-role").attr("id",function(V){return V.uid}).property("type","text").property("value",function(V){return typeof V.role=="string"?V.role:""}).attr("title",function(V){return Array.isArray(V.role)?V.role.filter(Boolean).join(`
`):V.role}).attr("placeholder",function(V){return Array.isArray(V.role)?t.t("inspector.multiple_roles"):t.t("inspector.role")}).classed("mixed",function(V){return Array.isArray(V.role)}).call(Oe).on("blur",y).on("change",y),s&&M.each(U);var T=v.selectAll(".member-row-new").data(d?[0]:[]);T.exit().remove();var R=T.enter().append("li").attr("class","member-row member-row-new form-field"),P=R.append("label").attr("class","field-label");P.append("input").attr("placeholder",t.t("inspector.choose_relation")).attr("type","text").attr("class","member-entity-input").call(Oe),P.append("button").attr("class","remove member-delete").call(X("#rapid-operation-delete")).on("click",function(){v.selectAll(".member-row-new").remove()});var D=R.append("div").attr("class","form-field-input-wrap form-field-input-member");D.append("input").attr("class","member-role").property("type","text").attr("placeholder",t.t("inspector.role")).call(Oe),T=T.merge(R),T.selectAll(".member-entity-input").on("blur",G).call(l.on("accept",O).on("cancel",G));var N=C.selectAll(".add-row").data([0]),F=N.enter().append("div").attr("class","add-row"),B=F.append("button").attr("class","add-relation");B.call(X("#rapid-icon-plus","light")),B.call(de(n).title(t.t("inspector.add_to_relation")).placement(t.isRTL()?"left":"right")),F.append("div").attr("class","space-value"),F.append("div").attr("class","space-buttons"),N=N.merge(F),N.select(".add-relation").on("click",function(){d=!0,a.reRender(),v.selectAll(".member-entity-input").node().focus()});function O(V){if(!V){G();return}V.relation&&Je([V.relation.id],!1,n);var j=n.cleanRelationRole(v.selectAll(".member-row-new .member-role").property("value"));x(V,j)}function G(){var V=T.selectAll(".member-entity-input");V.property("value","")}function U(V){var j=H(this),Z=j.selectAll("input.member-role"),Y=Z.property("value");function K(ne,ie){for(var q=[],se=[],te=0;te<ie.length;te++)ie[te].value.substring(0,ne.length)===ne?q.push(ie[te]):se.push(ie[te]);return q.concat(se)}Z.call(ct(n,"member-role").fetcher(function(ne,ie){var q=V.relation.tags.type;s.roles({debounce:!0,rtype:q||"",geometry:e.staging.graph.geometry(u[0]),query:ne},function(se,te){se||ie(K(ne,te))})}).on("cancel",function(){Z.property("value",Y)}))}function W(){var V=H(this);V.selectAll("input.member-role").call(ct.off,n)}}return a.entityIDs=function(C){return arguments.length?(u=C,d=!1,a):u},a}function o_(n){let e=n.systems.editor,t=n.systems.l10n,r=n.systems.presets,i=[],s=Ke(n,"selected-features").shouldDisplay(o).label(a).disclosureContent(u);s.entityIDs=function(d){return arguments.length?(i=d,s):i};function o(){return i.length>1}function a(){return t.t("inspector.title_count",{title:t.t("inspector.features"),count:i.length})}function l(d,f){n.enter("select-osm",{selection:{osm:[f.id]}})}function c(d,f){let h=i.slice(),p=h.indexOf(f.id);p>-1&&(h.splice(p,1),n.enter("select-osm",{selection:{osm:h}}))}function u(d){let f=e.staging.graph,h=d.selectAll(".feature-list").data([0]);h=h.enter().append("ul").attr("class","feature-list").merge(h);let p=i.map(x=>f.hasEntity(x)).filter(Boolean),m=h.selectAll(".feature-list-item").data(p,me.key);m.exit().remove();let g=m.enter().append("li").attr("class","feature-list-item").each((x,b,_)=>{H(_[b]).on("mouseover",()=>Je([x.id],!0,n)).on("mouseout",()=>Je([x.id],!1,n))}),y=g.append("button").attr("class","label").on("click",l);y.append("span").attr("class","entity-geom-icon").call(X("","pre-text")),y.append("span").attr("class","entity-type"),y.append("span").attr("class","entity-name"),g.append("button").attr("class","close").attr("title",t.t("icons.deselect")).on("click",c).call(X("#rapid-icon-close")),m=m.merge(g),m.selectAll(".entity-geom-icon use").attr("href",(x,b,_)=>"#rapid-icon-"+H(_[b])._groups[0][0].parentNode.parentNode.__data__.geometry(f)),m.selectAll(".entity-type").html(x=>r.match(x,f).name()),m.selectAll(".entity-name").html(x=>{let b=f.entity(x.id);return t.displayName(b.tags)})}return e.on("stablechange",()=>s.reRender()),s}var a_=[],aW=new Set(["crossing","crossing_ref","crossing:continuous","crossing:island","crossing:markings","crossing:signals"]);function l_(n){let e=n.systems.editor,t=n.systems.l10n,r=n.systems.presets,i=ge("choose"),s=[o_(n),r_(n).on("choose",function(_){i.call("choose",this,_)}),t_(n),n_(n).on("change",g).on("revert",y),mc(n,"raw-tag-editor").on("change",m),i_(n),s_(n)],o=null,a="",l=!1,c,u=[],d=[],f;e.off("stagingchange",p),e.on("stagingchange",p);function h(_){o=_;let S=b(u,e.staging.graph),C=t.isRTL(),k=_.selectAll(".header").data([0]),v=k.enter().append("div").attr("class","header fillL");v.append("button").attr("class","preset-reset preset-choose").call(X(C?"#rapid-icon-forward":"#rapid-icon-backward")),v.append("button").attr("class","close").on("click",()=>n.enter("browse")).call(X("#rapid-icon-close")),v.append("h3"),k=k.merge(v),k.selectAll("h3").text(u.length===1?t.t("map_data.layers.osm.feature"):t.t("inspector.multiselect")),k.selectAll(".preset-reset").on("click",function(){i.call("choose",this,d)});let w=_.selectAll(".inspector-body").data([0]),A=w.enter().append("div").attr("class","entity-editor inspector-body");w=w.merge(A);for(let E of s)E.entityIDs&&E.entityIDs(u),E.presets&&E.presets(d),E.tags&&E.tags(S),E.state&&E.state(a),w.call(E.render)}h.modified=function(_){return arguments.length?(l=_,h):l},h.state=function(_){return arguments.length?(a=_,h):a},h.entityIDs=function(_){if(!arguments.length)return u;if(c=e.staging.graph,Array.isArray(_)&&Kr(u,_))return h;if(u=_??[],x(!0),o){let S=o.selectAll(".inspector-body").node();S&&S.scroll(0,0)}return h.modified(!1)},h.newFeature=function(_){return arguments.length?(f=_,h):f},h.presets=function(_){return arguments.length?(Kr(_,d)||(d=_),h):d};function p(_){if(!_||!o||o.selectAll(".entity-editor").empty()||a==="hide"||!(_.didChange.properties||_.didChange.addition||_.didChange.deletion))return;let C=e.staging.graph;if(u=u.filter(w=>C.hasEntity(w)),!u.length)return;let k=d.length===1&&d[0];x();let v=d.length===1&&d[0];h.modified(c!==C),o.call(h),k!==v&&n.container().selectAll(".entity-editor button.preset-reset .label").style("background-color","#fff").transition().duration(750).style("background-color",null)}function m(_,S,C){g(_,S,C,!0)}function g(_,S,C,k=!1){let v=Kr(u,a_);a_=u.slice(),e.beginTransaction();for(let w of u){let E=e.staging.graph.hasEntity(w);if(!E)continue;let I=Object.assign({},E.tags),M=!1;for(let[T,R]of Object.entries(S)){if(!T)continue;aW.has(T)&&(M=!0);let P=E.tags.source;E.__fbid__&&T==="source"&&(P==="digitalglobe"||P==="maxar")||(R!==void 0||I.hasOwnProperty(T))&&(I[T]=R)}C||(I=pv(I)),(0,cP.default)(E.tags,I)||(e.perform(Ft(w,I)),!k&&M&&e.perform(Gs(w)))}if(!C){let w=t.t("operations.change_tags.annotation"),A={annotation:w,selectedIDs:u};v&&e.getUndoAnnotation()===w?e.commitAppend(A):e.commit(A)}e.endTransaction()}function y(_){let S=Kr(u,a_);a_=u.slice();let C=e.base.graph;e.beginTransaction();for(let w of u){let A=e.staging.graph,E=C.hasEntity(w),I=A.entity(w),M=Object.assign({},I.tags),T={};for(let P of _)T[P]=E?.tags[P]??void 0;let R=!1;for(let[P,D]of Object.entries(T))P&&(aW.has(P)&&(R=!0),(D!==void 0||M.hasOwnProperty(P))&&(M[P]=D));M=pv(M),(0,cP.default)(I.tags,M)||(e.perform(Ft(w,M)),R&&e.perform(Gs(w)))}let k=t.t("operations.change_tags.annotation"),v={annotation:k,selectedIDs:u};S&&e.getUndoAnnotation()===k?e.commitAppend(v):e.commit(v),e.endTransaction()}function x(_){let S=e.staging.graph,C={};for(let v of u){let w=S.hasEntity(v);if(!w)return;let A=r.match(w,S);C[A.id]=(C[A.id]||0)+1}let k=Object.keys(C).sort((v,w)=>C[w]-C[v]).map(v=>r.item(v));!_&&d.length===1&&!d[0].isFallback()&&Object.keys(d[0].addTags||{}).length===0&&k.length===1&&k[0].isFallback()||h.presets(k)}function b(_,S){let C=new Map,k=new Map,v=_.map(A=>S.hasEntity(A)).filter(Boolean);for(let A of v)for(let E of Object.keys(A.tags))E&&C.set(E,new Set);for(let A of v)for(let[E,I]of C){let M=A.tags[E];I.add(M);let T=`${E}=${M}`,R=k.get(T)??0;k.set(T,R+1)}let w={};for(let[A,E]of C){let I=[...E];I.length===1?w[A]=I[0]:w[A]=I.sort((M,T)=>{let R=k.get(`${A}=${M}`)??0,P=k.get(`${A}=${T}`)??0;return P!==R?P-R:T&&M?M.localeCompare(T):M?1:-1})}return w}return xe(h,i,"on")}var uW=Ot(cW(),1);var gf=class{constructor(e){this.context=e,this._geocodeResults=null,this.$parent=null,this.$featureList=null,this.$search=null,this.$list=null,this.render=this.render.bind(this),this._clearSearch=this._clearSearch.bind(this),this._click=this._click.bind(this),this._drawList=this._drawList.bind(this),this._focusSearch=this._focusSearch.bind(this),this._input=this._input.bind(this),this._keydown=this._keydown.bind(this),this._keypress=this._keypress.bind(this),this._mouseout=this._mouseout.bind(this),this._mouseover=this._mouseover.bind(this),this._nominatimSearch=this._nominatimSearch.bind(this),e.on("modechange",this._clearSearch);let t=Te("\u2318F");e.keybinding().on(t,this._focusSearch)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let r=this.context.systems.l10n,i=e.selectAll(".feature-list-wrap").data([0]),s=i.enter().append("div").attr("class","feature-list-wrap inspector-hidden");this.$featureList=i=i.merge(s),i.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL").append("h3"),i.selectAll(".header h3").text(r.t("inspector.feature_list"));let o=i.selectAll(".search-header").data([0]).enter().append("div").attr("class","search-header");o.call(X("#rapid-icon-search")),o.append("input").attr("type","search").call(Oe).on("keypress",this._keypress).on("keydown",this._keydown).on("input",this._input),this.$search=i.selectAll(".search-header input"),this.$search.attr("placeholder",r.t("inspector.search")),i.selectAll(".inspector-body").data([0]).enter().append("div").attr("class","inspector-body").append("div").attr("class","feature-list"),this.$list=i.selectAll(".feature-list"),this._drawList()}_drawList(){if(!this.$search||!this.$list)return;let e=this.context,t=e.systems.l10n,r=e.services.nominatim,i=this.$search.property("value"),s=this._getSearchResults(),o=this.$list;o.classed("filtered",i.length),o.selectAll(".no-results-item").data([0]).enter().append("button").property("disabled",!0).attr("class","no-results-item").call(X("#rapid-icon-alert","pre-text")).append("span").attr("class","entity-name"),o.selectAll(".no-results-item .entity-name").text(t.t("geocoder.no_results_worldwide")),r&&o.selectAll(".geocode-item").data([0]).enter().append("button").attr("class","geocode-item secondary-action").on("click",this._nominatimSearch).append("div").attr("class","label").append("span").attr("class","entity-name").text(t.t("geocoder.search")),o.selectAll(".no-results-item").style("display",i.length&&!s.length?"block":"none"),o.selectAll(".geocode-item").style("display",i&&this._geocodeResults===void 0?"block":"none"),o.selectAll(".feature-list-item").data([-1]).remove();let l=o.selectAll(".feature-list-item").data(s,d=>d.id),c=l.enter().insert("button",".geocode-item").attr("class","feature-list-item").on("mouseover",this._mouseover).on("mouseout",this._mouseout).on("click",this._click),u=c.append("div").attr("class","label");u.each((d,f,h)=>{H(h[f]).call(X(`#rapid-icon-${d.geometry}`,"pre-text"))}),u.append("span").attr("class","entity-type").text(d=>d.type),u.append("span").attr("class","entity-name").classed("has-color",d=>!!this._getColor(d.entity)).style("border-color",d=>this._getColor(d.entity)).text(d=>d.name),c.style("opacity",0).transition().style("opacity",1),l.order(),l.exit().remove()}_focusSearch(e){this.$search&&this.context.mode?.id==="browse"&&(e?.preventDefault(),this.$search.node().focus())}_keydown(e){this.$search&&e.keyCode===27&&this.$search.node().blur()}_keypress(e){if(!this.$search||!this.$list)return;let t=this.$search.property("value"),r=this.$list.selectAll(".feature-list-item");e.keyCode===13&&t.length&&r.size()&&this._click(e,r.datum())}_input(){this._geocodeResults=void 0,this._drawList()}_clearSearch(){this.$search&&(this.$search.property("value",""),this._drawList())}_getColor(e){let t=e?.type==="relation"&&e?.tags.colour;return t&&el(t)?t:null}_mouseover(e,t){!t.id||t.id===-1||Je([t.id],!0,this.context)}_mouseout(e,t){!t.id||t.id===-1||Je([t.id],!1,this.context)}_click(e,t){e.preventDefault();let r=this.context,i=r.systems.map;t.location?i.centerZoomEase([t.location[1],t.location[0]],19):t.id!==-1?(Je([t.id],!1,r),i.selectEntityID(t.id,!0)):t.noteID&&i.selectNoteID(t.noteID)}_nominatimSearch(){if(!this.$search)return;let e=this.context.services.nominatim;if(!e)return;let t=this.$search.property("value");e.search(t,(r,i)=>{this._geocodeResults=i||[],this._drawList()})}_getSearchResults(){if(!this.$search)return;let e=this.context,t=e.systems.editor,r=e.systems.l10n,i=e.systems.presets,s=e.viewport.centerLoc(),o=this.$search.property("value").toLowerCase(),a=[];if(!o)return a;let l=uW.pair(o.toUpperCase())||r.dmsMatcher(o);if(l){let m=[parseFloat(l[0]),parseFloat(l[1])];a.push({id:-1,geometry:"point",type:r.t("inspector.location"),name:r.dmsCoordinatePair([m[1],m[0]]),location:m})}let c=!l&&o.match(/(?:^|\W)(node|way|relation|note|[nwr])\W?0*([1-9]\d*)(?:\W|$)/i);if(c){let m=c[1].charAt(0),g=c[2];c[1]==="note"?a.push({id:-1,noteID:g,geometry:"note",type:r.t("note.note"),name:g}):a.push({id:m+g,geometry:m==="n"?"point":m==="w"?"line":"relation",type:r.displayType(m),name:g})}let u=t.staging.graph,d=u.base.entities,f=u.local.entities,h=new Set([...d.keys(),...f.keys()]),p=[];for(let m of h){if(f.has(m)&&f.get(m)===void 0)continue;let g=u.hasEntity(m);if(!g)continue;let y=r.displayName(g.tags)||"";if(y.toLowerCase().indexOf(o)<0)continue;let x=i.match(g,u),b=x&&x.name()||r.displayType(g.id),_=g.extent(u),S=_?ht(s,_.center()):0;if(p.push({id:g.id,entity:g,geometry:g.geometry(u),type:b,name:y,distance:S}),p.length>100)break}p=p.sort((m,g)=>m.distance-g.distance),a=a.concat(p);for(let m of this._geocodeResults||[]){if(!m.osm_type||!m.osm_id)continue;let g=me.id.fromOSM(m.osm_type,m.osm_id),y={};y[m.class]=m.type;let x={id:g,type:m.osm_type,tags:y};m.osm_type==="way"&&(x.nodes=["a","a"]);let b=me(x),_=new Fr([b]),S=i.match(b,_),C=S&&S.name()||r.displayType(g);a.push({id:b.id,geometry:b.geometry(_),type:C,name:m.display_name,extent:new le([parseFloat(m.boundingbox[3]),parseFloat(m.boundingbox[0])],[parseFloat(m.boundingbox[2]),parseFloat(m.boundingbox[1])])})}return o.match(/^[0-9]+$/)&&(a.push({id:"n"+o,geometry:"point",type:r.t("inspector.node"),name:o}),a.push({id:"w"+o,geometry:"line",type:r.t("inspector.way"),name:o}),a.push({id:"r"+o,geometry:"relation",type:r.t("inspector.relation"),name:o}),a.push({id:-1,noteID:o,geometry:"note",type:r.t("note.note"),name:o})),a}};var yf=class{constructor(e){this.context=e,this.Tooltip=de(e).placement("top"),this.$parent=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this.click=this.click.bind(this),this.deferredRender=mn(this.rerender,1e3,{leading:!0,trailing:!0}),e.systems.gfx.on("draw",this.deferredRender)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.filters,i=t.systems.l10n,s=e.selectAll(".filter-info").data([0]),o=s.enter().append("div").attr("class","filter-info");o.append("a").attr("class","chip").attr("href","#").on("click",this.click).call(this.Tooltip).call(X("#fas-filter")).append("span").attr("class","count"),s=s.merge(o);let l=r.getStats(),c=[],u=0;for(let[d,f]of Object.entries(l))f.count>0&&(u+=f.count,c.push(i.t("inspector.title_count",{title:i.t(`filters.${d}.description`),count:f.count})));c.length?this.Tooltip.title(i.t("filters.active")+"<br/>"+c.join("<br/>")):this.Tooltip.hide(),s.classed("hide",!c.length),s.selectAll("span.count").text(u.toString())}click(e){e&&e.preventDefault();let r=this.context.systems.ui;this.Tooltip.hide(),r.Overmap.MapPanes.MapData.togglePane()}};var xf=0,r5=0,t5=0,fW=1e3,c_,n5,u_=0,L1=0,d_=0,i5=typeof performance=="object"&&performance.now?performance:Date,hW=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function o5(){return L1||(hW(jie),L1=i5.now()+d_)}function jie(){L1=0}function s5(){this._call=this._time=this._next=null}s5.prototype=f_.prototype={constructor:s5,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?o5():+t)+(e==null?0:+e),!this._next&&n5!==this&&(n5?n5._next=this:c_=this,n5=this),this._call=n,this._time=t,fP()},stop:function(){this._call&&(this._call=null,this._time=1/0,fP())}};function f_(n,e,t){var r=new s5;return r.restart(n,e,t),r}function pW(){o5(),++xf;for(var n=c_,e;n;)(e=L1-n._time)>=0&&n._call.call(void 0,e),n=n._next;--xf}function dW(){L1=(u_=i5.now())+d_,xf=r5=0;try{pW()}finally{xf=0,qie(),L1=0}}function Xie(){var n=i5.now(),e=n-u_;e>fW&&(d_-=e,u_=n)}function qie(){for(var n,e=c_,t,r=1/0;e;)e._call?(r>e._time&&(r=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:c_=t);n5=n,fP(r)}function fP(n){if(!xf){r5&&(r5=clearTimeout(r5));var e=n-L1;e>24?(n<1/0&&(r5=setTimeout(dW,n-i5.now()-d_)),t5&&(t5=clearInterval(t5))):(t5||(u_=i5.now(),t5=setInterval(Xie,fW)),xf=1,hW(dW))}}function bf(n,e,t){var r=new s5;return e=e==null?0:+e,r.restart(i=>{r.stop(),n(i+e)},e,t),r}function _f(n){var e,t=2e3,r="#rapid-icon-no",i="disabled",s="";function o(){e&&e.stop(),n.container().select(".map-footer-wrap").classed("map-footer-hide",!0).classed("map-footer-show",!1),n.container().select(".flash-wrap").classed("map-footer-hide",!1).classed("map-footer-show",!0);var a=n.container().select(".flash-wrap").selectAll(".flash-content").data([0]),l=a.enter().append("div").attr("class","flash-content"),c=l.append("svg").attr("class","flash-icon icon").append("g").attr("transform","translate(10,10)");return c.append("circle").attr("r",9),c.append("use").attr("transform","translate(-7,-7)").attr("width","14").attr("height","14"),l.append("div").attr("class","flash-text"),a=a.merge(l),a.selectAll(".flash-icon").attr("class","icon flash-icon "+(i||"")),a.selectAll(".flash-icon use").attr("xlink:href",r),a.selectAll(".flash-text").attr("class","flash-text").html(s),e=bf(function(){e=null,n.container().select(".map-footer-wrap").classed("map-footer-hide",!1).classed("map-footer-show",!0),n.container().select(".flash-wrap").classed("map-footer-hide",!0).classed("map-footer-show",!1)},t),a}return o.duration=function(a){return arguments.length?(t=a,o):t},o.label=function(a){return arguments.length?(s=a,o):s},o.iconName=function(a){return arguments.length?(r=a,o):r},o.iconClass=function(a){return arguments.length?(i=a,o):i},o}var vf=class{constructor(e){this.context=e,this.$parent=null,this.render=this.render.bind(this),this.toggle=this.toggle.bind(this)}render(e=this.$parent){if(!this.isSupported())return;let t=this.context,i=Et().os==="mac"?[Te("\u2303\u2318F"),"f11"]:["f11"];t.keybinding().off(i),t.keybinding().on(i,this.toggle)}isSupported(){return typeof this.context.containerNode.requestFullscreen=="function"}isFullscreen(){let e=this.context.containerNode;return document.fullscreenElement===e}requestFullscreen(){return this.context.containerNode.requestFullscreen()}exitFullscreen(){return document.exitFullscreen()}toggle(e){return e&&e.preventDefault(),this.isSupported()?this.isFullscreen()?this.exitFullscreen():this.requestFullscreen():Promise.resolve()}};function Ce(n,e){let t="",r=n.toLowerCase().match(/^#rapid-interaction-(.*)$/);return r&&(t="<title>"+r[1].replace(/\-/g," ")+"</title>"),`<svg class="${"icon"+(e?` ${e}`:"")}">${t}<use xlink:href="${n}"></use></svg>`}function kr(n){n.stopPropagation(),n.preventDefault()}var h_;function J(n,e,t){let r=n.systems.l10n,i=r.isRTL();h_||(h_={point_icon:Ce("#rapid-icon-point","inline"),line_icon:Ce("#rapid-icon-line","inline"),area_icon:Ce("#rapid-icon-area","inline"),note_icon:Ce("#rapid-icon-note","inline add-note"),plus:Ce("#rapid-icon-plus","inline"),minus:Ce("#rapid-icon-minus","inline"),layers_icon:Ce("#rapid-icon-layers","inline"),data_icon:Ce("#rapid-icon-data","inline"),inspect:Ce("#rapid-icon-inspect","inline"),help_icon:Ce("#rapid-icon-help","inline"),undo_icon:Ce(i?"#rapid-icon-redo":"#rapid-icon-undo","inline"),redo_icon:Ce(i?"#rapid-icon-undo":"#rapid-icon-redo","inline"),save_icon:Ce("#rapid-icon-save","inline"),circularize_icon:Ce("#rapid-operation-circularize","operation"),continue_icon:Ce("#rapid-operation-continue","operation"),copy_icon:Ce("#rapid-operation-copy","operation"),delete_icon:Ce("#rapid-operation-delete","operation"),disconnect_icon:Ce("#rapid-operation-disconnect","operation"),downgrade_icon:Ce("#rapid-operation-downgrade","operation"),extract_icon:Ce("#rapid-operation-extract","operation"),merge_icon:Ce("#rapid-operation-merge","operation"),move_icon:Ce("#rapid-operation-move","operation"),orthogonalize_icon:Ce("#rapid-operation-orthogonalize","operation"),paste_icon:Ce("#rapid-operation-paste","operation"),reflect_long_icon:Ce("#rapid-operation-reflect-long","operation"),reflect_short_icon:Ce("#rapid-operation-reflect-short","operation"),reverse_icon:Ce("#rapid-operation-reverse","operation"),rotate_icon:Ce("#rapid-operation-rotate","operation"),split_icon:Ce("#rapid-operation-split","operation"),straighten_icon:Ce("#rapid-operation-straighten","operation"),keyboard_arrows_all:Ce("#rapid-interaction-keyboard-arrows-all","operation"),keyboard_arrows_down:Ce("#rapid-interaction-keyboard-arrows-down","operation"),keyboard_arrows_left:Ce("#rapid-interaction-keyboard-arrows-left","operation"),keyboard_arrows_right:Ce("#rapid-interaction-keyboard-arrows-right","operation"),keyboard_arrows_up:Ce("#rapid-interaction-keyboard-arrows-up","operation"),keyboard_arrows_up_down:Ce("#rapid-interaction-keyboard-arrows-up-down","operation"),keyboard_arrows_left_right:Ce("#rapid-interaction-keyboard-arrows-left-right","operation"),mouse_left_icon:Ce("#rapid-interaction-mouse-left","operation"),mouse_right_icon:Ce("#rapid-interaction-mouse-right","operation"),mouse_wheel_icon:Ce("#rapid-interaction-mouse-wheel","operation"),onefinger_tap_icon:Ce("#rapid-interaction-onefinger-tap","operation"),onefinger_tap_and_hold_icon:Ce("#rapid-interaction-onefinger-tap-and-hold","operation"),onefinger_tap_and_drag_icon:Ce("#rapid-interaction-onefinger-tap-and-drag","operation"),twofinger_tap_and_drag_icon:Ce("#rapid-interaction-twofinger-tap-and-drag","operation"),twofinger_pinch_icon:Ce("#rapid-interaction-twofinger-pinch","operation"),twofinger_zoom_icon:Ce("#rapid-interaction-twofinger-zoom","operation"),twofinger_rotate_icon:Ce("#rapid-interaction-twofinger-rotate","operation"),shift:Te.display(n,"\u21E7"),option:Te.display(n,"\u2325"),control:Te.display(n,"\u2303"),return:Te.display(n,"\u21B5"),esc:Te.display(n,"\u238B"),space:r.t("shortcuts.key.space"),add_point_key:r.t("shortcuts.command.add_point.key"),add_line_key:r.t("shortcuts.command.add_line.key"),add_area_key:r.t("shortcuts.command.add_area.key"),add_note_key:r.t("shortcuts.command.add_note.key"),help_key:r.t("shortcuts.command.toggle_help.key"),shortcuts_key:r.t("shortcuts.command.keyboard_shortcuts.key"),toggle_notes_key:r.t("shortcuts.command.toggle_osm_notes.key"),save:r.t("save.title"),undo:r.t("undo.title"),redo:r.t("redo.title"),upload:r.t("commit.save"),point:r.t("modes.add_point.title"),line:r.t("modes.add_line.title"),area:r.t("modes.add_area.title"),note:r.t("modes.add_note.title"),circularize:r.t("operations.circularize.title"),continue:r.t("operations.continue.title"),copy:r.t("operations.copy.title"),delete:r.t("operations.delete.title"),disconnect:r.t("operations.disconnect.title"),downgrade:r.t("operations.downgrade.title"),extract:r.t("operations.extract.title"),merge:r.t("operations.merge.title"),move:r.t("operations.move.title"),orthogonalize:r.t("operations.orthogonalize.title"),paste:r.t("operations.paste.title"),reflect_long:r.t("operations.reflect.title.long"),reflect_short:r.t("operations.reflect.title.short"),reverse:r.t("operations.reverse.title"),rotate:r.t("operations.rotate.title"),split:r.t("operations.split.title"),straighten:r.t("operations.straighten.title"),map_data:r.t("map_data.title"),osm_notes:r.t("map_data.layers.notes.title"),fields:r.t("inspector.fields"),tags:r.t("inspector.tags"),relations:r.t("inspector.relations"),new_relation:r.t("inspector.new_relation"),turn_restrictions:r.t("_tagging.presets.fields.restrictions.label"),background_settings:r.t("background.description"),imagery_offset:r.t("background.fix_misalignment"),start_the_walkthrough:r.t("splash.walkthrough"),help:r.t("help.title"),ok:r.t("intro.ok")});let s;return t?s=Object.assign(t,h_):s=h_,r.tHtml(e,s).replace(/\`(.*?)\`/g,"<kbd>$1</kbd>")}function mW(n){return n.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}var gW={};function yW(n,e,t){if(n.systems.l10n.t(e,{default:void 0})===void 0){if(gW.hasOwnProperty(e))return;gW[e]=t;let i=`${e}: ${t}`;typeof console<"u"&&console.log(i)}}function hP(n,e){let t=n.systems.l10n,r,i=e.tags&&e.tags.name;i&&(r="intro.graph.name."+mW(i),e.tags.name=t.t(r,{default:i}),yW(n,r,i));let s=e.tags&&e.tags["addr:street"];if(s){r="intro.graph.name."+mW(s),e.tags["addr:street"]=t.t(r,{default:s}),yW(n,r,s);let o=["block_number","city","county","district","hamlet","neighbourhood","postcode","province","quarter","state","subdistrict","suburb"];for(let a of o){let l=`intro.graph.${a}`,c=`addr:${a}`,u=e.tags&&e.tags[c],d=t.t(l,{default:u});d&&(d.match(/^<.*>$/)!==null?delete e.tags[c]:e.tags[c]=d)}}return e}function xW(n){let t=Math.cos(75*Math.PI/180),r=Math.cos(15*Math.PI/180);for(let i=0;i<n.length;i++){let s=n[(i-1+n.length)%n.length],o=n[i],a=n[(i+1)%n.length],l=sm(s,a,o),c=Math.abs(l);if(c>t&&c<r)return!1}return!0}function jr(n,e){let t=ht(n,e);return t<1e-4?0:t<200?500:1e3}function Ut(n=300){return new Promise(e=>window.setTimeout(e,n))}var p_=class{constructor(e){this.context=e,this._enabled=!1,this._revealOptions=null,this._revealPolygon=[],this._darknessDirty=!0,this._tooltipDirty=!0,this._inTransition=!1,this.$parent=null,this.$curtain=null,this.$tooltip=null,this.enable=this.enable.bind(this),this.disable=this.disable.bind(this),this.redraw=this.redraw.bind(this),this.resize=this.resize.bind(this)}enable(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;this._enabled||(this._enabled=!0,this._revealOptions=null,this._revealPolygon=[],this._darknessDirty=!0,this._tooltipDirty=!0,this._inTransition=!1,this.$curtain=e.append("svg").attr("class","curtain").style("top",0).style("left",0),this.$tooltip=e.append("div").attr("class","tooltip"),this.$tooltip.append("div").attr("class","popover-arrow"),this.$tooltip.append("div").attr("class","popover-inner"),this.context.systems.map.on("move",this.redraw),this.context.systems.ui.on("uichange",this.resize),this.resize())}disable(){this._enabled&&(this._enabled=!1,this.$curtain.remove(),this.$curtain=null,this.$tooltip.remove(),this.$tooltip=null,this._revealOptions=null,this._revealPolygon=[],this.context.systems.map.off("move",this.redraw),this.context.systems.ui.off("uichange",this.resize))}resize(){this.$curtain&&(this._revealPolygon=[],this._darknessDirty=!0,this.$curtain.selectAll("path").interrupt(),this._inTransition=!1,this.redraw())}hide(){this.reveal({duration:0})}reveal(e={}){if(this.$tooltip)return this._revealOptions=Object.assign({},e,{duration:250}),this._revealPolygon=[],this._darknessDirty=!0,this._tooltipDirty=!0,this.redrawDarkness(this._revealOptions.duration),this.redrawTooltip(),this.$tooltip}redraw(){this._inTransition||(this.redrawDarkness(),this.redrawTooltip())}redrawDarkness(e=0){if(!this._darknessDirty||!this.$curtain)return;let r=this.context.container(),i=r.node(),s=this._copyRect(i.getBoundingClientRect()),o=r.select(".main-map").node(),a=this._copyRect(o.getBoundingClientRect()),l=this._revealOptions;if(this._revealPolygon=[],l){if(l.revealExtent instanceof le){let h=this.context.viewport,p=[a.left-50,a.top-50],m=l.revealExtent.polygon().map(x=>bt(p,h.project(x,!0)));a.top+=72,a.botom-=30;let g=[[a.left,a.top],[a.left,a.bottom],[a.right,a.bottom],[a.right,a.top],[a.left,a.top]],y=mH([m],[g]);y?.length&&(this._revealPolygon=y[0][0])}else if(l.revealSelector&&!l.revealNode&&(l.revealNode=H(l.revealSelector).node()),l.revealNode instanceof Element){let h=this._copyRect(l.revealNode.getBoundingClientRect()),p=l?.revealPadding??0;h.left-=p,h.top-=p,h.right+=p,h.bottom+=p,this._revealPolygon=[[h.left,h.top],[h.left,h.bottom],[h.right,h.bottom],[h.right,h.top],[h.left,h.top]]}}let c=s,u=`M${c.left},${c.top} L${c.left},${c.bottom} L${c.right},${c.bottom}, L${c.right},${c.top} Z`;if(this._revealPolygon.length){let h=this._revealPolygon;u+=` M${h[0]} `;for(let p=1;p<h.length-1;p++)u+=`L${h[p]} `;u+="Z"}let d=this.$curtain.selectAll("path").data([0]).interrupt(),f=d.enter().append("path").attr("class","curtain-darkness");d=d.merge(f),e>0?(this._inTransition=!0,d=d.transition().duration(e).ease(lp).on("end interrupt",()=>this._inTransition=!1)):this._inTransition=!1,d.attr("d",u),this._darknessDirty=l?.revealExtent}redrawTooltip(){if(!this.$tooltip)return;let e=this.context,t=e.systems.l10n.isRTL(),i=e.container().node(),s=this._copyRect(i.getBoundingClientRect()),o=this._revealOptions,a;if(o&&(o.tipSelector&&!o.tipNode&&(o.tipNode=H(o.tipSelector).node()),o.tipNode instanceof Element&&(a=this._copyRect(o.tipNode.getBoundingClientRect())),!a&&this._revealPolygon.length)){a={left:1/0,top:1/0,right:-1/0,bottom:-1/0};for(let[c,u]of this._revealPolygon)a.left=Math.min(a.left,c),a.top=Math.min(a.top,u),a.right=Math.max(a.right,c),a.bottom=Math.max(a.bottom,u)}let l=o?.tipHtml;if(a&&l){let c="curtain-tooltip popover tooltip arrowed in "+(o.tooltipClass||"");if(this._tooltipDirty){let g="",y=l.match(/\*\*(.*?)\*\*/);y&&(g=y[1],l=l.replace(/\*\*.*?\*\*/g,"")),l=l.replace(/<span[^>]*><\/span>/g,""),l=l.replace(/\*(.*?)\*/g,"<em>$1</em>"),l=l.replace(/\{br\}/g,"<br/>"),g&&(l+=`<div class="instruction">${g}</div>`),o.buttonText&&o.buttonCallback&&(l+=`<div class="button-section"><button href="#" class="button action">${o.buttonText}</button></div>`),this.$tooltip.attr("class",c).selectAll(".popover-inner").html(l),o.buttonText&&o.buttonCallback&&this.$tooltip.selectAll("button.action").on("click",x=>{x.preventDefault(),o.buttonCallback()}),this._tooltipDirty=!1}let u=5,d=this._copyRect(this.$tooltip.node().getBoundingClientRect()),f,h,p;a.left=dt(a.left,s.left,s.right),a.top=dt(a.top,s.top,s.bottom),a.right=dt(a.right,s.left,s.right),a.bottom=dt(a.bottom,s.top,s.bottom),a.width=a.right-a.left,a.height=a.bottom-a.top,a.bottom<100?(f="bottom",h=a.left+a.width/2-d.width/2,p=a.bottom):a.top>s.height-140?(f="top",h=a.left+a.width/2-d.width/2,p=a.top-d.height):(p=a.top+a.height/2-d.height/2,t?a.left-d.width-u<70?(f="right",h=a.right+u):(f="left",h=a.left-d.width-u):a.right+u+d.width>s.width-70?(f="left",h=a.left-d.width-u):(f="right",h=a.right+u)),this.$tooltip.style("left",`${h}px`).style("top",`${p}px`).attr("class",c+" "+f);let m=0;(f==="left"||f==="right")&&(p<60?m=60-p:p+d.height>s.height-100&&(m=s.height-p-d.height-100)),this.$tooltip.selectAll(".popover-inner").style("top",`${m}px`)}else this.$tooltip.classed("in",!1),this._tooltipDirty=!1}_copyRect(e){return{x:e.x,y:e.y,left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height}}};function bW(n,e){let t=ge("done"),r={title:"intro.welcome.title"},i=new le([-85.63654,41.9429],[-85.63632,41.94307]),s=n.systems.l10n,o=n.systems.map,a=!1,l=null;function c(p){return a?Promise.reject():typeof p!="function"?Promise.resolve():p().then(m=>c(m)).catch(m=>(m instanceof Error&&console.error(m),c(p)))}function u(){return o.setMapParamsAsync(i.center(),19,0).then(()=>new Promise((p,m)=>{l=m,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:J(n,"intro.welcome.welcome"),buttonText:s.t("intro.ok"),buttonCallback:()=>p(d)})}))}function d(){return new Promise((p,m)=>{l=m,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:J(n,"intro.welcome.practice"),buttonText:s.t("intro.ok"),buttonCallback:()=>p(f)})})}function f(){return new Promise((p,m)=>{l=m,e.reveal({revealSelector:".intro-nav-wrap .chapter-welcome",tipHtml:J(n,"intro.welcome.words"),buttonText:s.t("intro.ok"),buttonCallback:()=>p(h)})})}function h(){return t.call("done"),e.reveal({revealSelector:".intro-nav-wrap .chapter-navigation",tipHtml:J(n,"intro.welcome.chapters",{next:s.t("intro.navigation.title")})}),Promise.resolve()}return r.enter=()=>{a=!1,l=null,c(u).catch(p=>{p instanceof Error&&console.error(p)})},r.exit=()=>{a=!0,l&&(l(),l=null)},r.restart=()=>{r.exit(),r.enter()},xe(r,t,"on")}function _W(n,e){let t=ge("done"),r={title:"intro.navigation.title"},i=n.container(),s=n.systems.editor,o=n.systems.l10n,a=n.systems.map,l=n.systems.presets,c=n.systems.ui,u="n2061",d=new le([-85.63654,41.9429],[-85.63632,41.94307]),f="w397",h=new le([-85.63588,41.94155],[-85.63574,41.94278]),p=l.field("oneway"),m=l.field("maxspeed"),g=!1,y=null,x=null,b=null;function _(){if(!s.staging.graph.hasEntity(u)||n.mode?.id!=="select-osm")return!1;let K=n.selectedIDs();return K.length===1&&K[0]===u}function S(){return s.staging.graph.hasEntity(f)}function C(){if(!s.staging.graph.hasEntity(f)||n.mode?.id!=="select-osm")return!1;let K=n.selectedIDs();return K.length===1&&K[0]===f}function k(Y){return g?Promise.reject():typeof Y!="function"?Promise.resolve():Y().then(K=>k(K)).catch(K=>(K instanceof Error&&console.error(K),k(Y)))}function v(){n.enter("browse"),s.restoreCheckpoint("initial");let Y=d.center(),K=jr(Y,a.center());return K>0&&e.hide(),a.setMapParamsAsync(Y,19,0,K).then(()=>new Promise((ne,ie)=>{y=ie;let q=J(n,"intro.navigation.map_info")+"{br}"+J(n,"intro.navigation.map_info2");e.reveal({revealSelector:".main-map",tipHtml:q,buttonText:o.t("intro.ok"),buttonCallback:()=>ne(w)})}))}function w(){return new Promise((Y,K)=>{y=K;let ne=a.center(),ie=n.lastPointerType==="mouse"?"mouse":"touch",q=J(n,"intro.navigation.pan")+"{br}"+(ie==="touch"?J(n,"intro.navigation.pan_touch")+"{br}":"")+(ie==="mouse"?J(n,"intro.navigation.pan_mouse")+"{br}":"")+(ie==="mouse"?J(n,"intro.navigation.pan_touchpad")+"{br}":"")+J(n,"intro.navigation.pan_keyboard")+"{br}"+J(n,"intro.navigation.pan_the_map");x=()=>{He(a.center(),ne)||H(".curtain-tooltip .instruction").call(X("#rapid-icon-apply","inline success"))},e.reveal({revealSelector:".main-map",tipHtml:q,buttonText:o.t("intro.ok"),buttonCallback:()=>Y(A)})}).finally(()=>{x=null})}function A(){return new Promise((Y,K)=>{y=K;let ne=n.viewport.transform.zoom,ie=n.lastPointerType==="mouse"?"mouse":"touch",q=J(n,"intro.navigation.zoom")+"{br}"+(ie==="touch"?J(n,"intro.navigation.zoom_touch_pinch")+"{br}":"")+(ie==="touch"?J(n,"intro.navigation.zoom_touch_doubletap")+"{br}":"")+(ie==="mouse"?J(n,"intro.navigation.zoom_mouse_scroll")+"{br}":"")+(ie==="mouse"?J(n,"intro.navigation.zoom_mouse_doubleclick")+"{br}":"")+(ie==="mouse"?J(n,"intro.navigation.zoom_touchpad")+"{br}":"")+J(n,"intro.navigation.zoom_keyboard")+"{br}"+J(n,"intro.navigation.zoom_buttons")+"{br}"+J(n,"intro.navigation.zoom_the_map");x=()=>{n.viewport.transform.zoom!==ne&&H(".curtain-tooltip .instruction").call(X("#rapid-icon-apply","inline success"))},e.reveal({revealSelector:".main-map",tipHtml:q,buttonText:o.t("intro.ok"),buttonCallback:()=>Y(E)})}).finally(()=>{x=null})}function E(){return c.togglePanes(n.container().select(".map-panes .preferences-pane")),Ut().then(()=>new Promise((Y,K)=>{e.reveal({revealSelector:".map-panes .preferences-pane",tipHtml:J(n,"intro.navigation.user_settings"),buttonText:o.t("intro.ok"),buttonCallback:()=>{c.togglePanes(),Y(I)}})}))}function I(){return new Promise((Y,K)=>{y=K;let ne=n.viewport.transform.rotation,ie=n.lastPointerType==="mouse"?"mouse":"touch",q=J(n,"intro.navigation.rotate")+"{br}"+J(n,`intro.navigation.rotate_${ie}`)+"{br}"+J(n,"intro.navigation.rotate_keyboard")+"{br}"+J(n,"intro.navigation.rotate_the_map");x=()=>{n.viewport.transform.rotation!==ne&&H(".curtain-tooltip .instruction").call(X("#rapid-icon-apply","inline success"))},e.reveal({revealSelector:".main-map",tipHtml:q,buttonText:o.t("intro.ok"),buttonCallback:()=>Y(M)})}).finally(()=>{x=null})}function M(){let Y=n.viewport.transform.rotation,K=0;return Y<5*Mn&&(Y=45*Mn,K=100),a.setMapParamsAsync(void 0,void 0,Y,K).then(()=>new Promise((ne,ie)=>{y=ie,x=()=>{n.viewport.transform.rotation===0&&ne(T)},e.reveal({revealSelector:".main-map",tipSelector:".map-control.bearing",tipHtml:J(n,"intro.navigation.reset_bearing")})})).finally(()=>{x=null})}function T(){return new Promise((Y,K)=>{y=K,e.reveal({revealSelector:".main-map",tipHtml:J(n,"intro.navigation.features"),buttonText:o.t("intro.ok"),buttonCallback:()=>Y(R)})})}function R(){return new Promise((Y,K)=>{y=K,e.reveal({revealSelector:".main-map",tipHtml:J(n,"intro.navigation.points_lines_areas"),buttonText:o.t("intro.ok"),buttonCallback:()=>Y(P)})})}function P(){return new Promise((Y,K)=>{y=K,e.reveal({revealSelector:".main-map",tipHtml:J(n,"intro.navigation.nodes_ways"),buttonText:o.t("intro.ok"),buttonCallback:()=>Y(D)})})}function D(){n.enter("browse"),s.restoreCheckpoint("initial");let Y=d.center(),K=jr(Y,a.center());return K>0&&e.hide(),a.setMapParamsAsync(Y,19,void 0,K).then(()=>new Promise((ne,ie)=>{y=ie,b=()=>ne(N);let q=n.lastPointerType==="mouse"?"click_townhall":"tap_townhall";e.reveal({revealExtent:d,tipHtml:J(n,`intro.navigation.${q}`)})})).finally(()=>{b=null})}function N(){return _()?new Promise((Y,K)=>{y=K,b=K,e.reveal({revealExtent:d,tipHtml:J(n,"intro.navigation.selected_townhall"),buttonText:o.t("intro.ok"),buttonCallback:()=>Y(F)})}).finally(()=>{b=null}):Promise.resolve(D)}function F(){return _()?new Promise((Y,K)=>{y=K,b=K,c.Sidebar.showEntityEditor(),i.select(".inspector-wrap").on("wheel.intro",kr),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(n,"intro.navigation.editor_townhall"),buttonText:o.t("intro.ok"),buttonCallback:()=>Y(B)})}).finally(()=>{b=null,i.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(D)}function B(){return _()?new Promise((Y,K)=>{y=K,b=K,c.Sidebar.showEntityEditor(),i.select(".inspector-wrap").on("wheel.intro",kr);let ne=s.staging.graph,ie=ne.entity(n.selectedIDs()[0]),q=l.match(ie,ne);e.reveal({revealSelector:".entity-editor-pane .section-feature-type",revealPadding:5,tipHtml:J(n,"intro.navigation.preset_townhall",{preset:q.name()}),buttonText:o.t("intro.ok"),buttonCallback:()=>Y(O)})}).finally(()=>{b=null,i.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(D)}function O(){return _()?new Promise((Y,K)=>{y=K,b=K,c.Sidebar.showEntityEditor(),i.select(".inspector-wrap").on("wheel.intro",kr),e.reveal({revealSelector:".entity-editor-pane .section-preset-fields",revealPadding:5,tipHtml:J(n,"intro.navigation.fields_townhall"),buttonText:o.t("intro.ok"),buttonCallback:()=>Y(G)})}).finally(()=>{b=null,i.select(".inspector-wrap").on("wheel.intro",null)}):Promise.resolve(D)}function G(){return _()?new Promise((Y,K)=>{y=K,b=()=>Y(U),c.Sidebar.showEntityEditor();let ie=H(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close";e.reveal({revealSelector:".entity-editor-pane",tipSelector:".entity-editor-pane button.close",tipHtml:J(n,"intro.navigation.close_townhall",{button:Ce(ie,"inline")})})}).finally(()=>{b=null}):Promise.resolve(D)}function U(){n.enter("browse"),s.restoreCheckpoint("initial");let Y=h.center(),K=jr(Y,a.center());return K>0&&e.hide(),a.setMapParamsAsync(Y,19,0,K).then(()=>new Promise((ne,ie)=>{y=ie,e.reveal({revealSelector:".search-header input",tipHtml:J(n,"intro.navigation.search_street",{name:o.t("intro.graph.name.spring-street")})}),i.select(".search-header input").on("keyup.intro",()=>ne(W))})).finally(()=>{i.select(".search-header input").on("keyup.intro",null)})}function W(){return S()?new Promise((Y,K)=>{y=K,b=()=>Y(V),i.select(".search-header input").on("keyup.intro",()=>{let ne=i.select(".feature-list-item:nth-child(0n+2)"),ie=ne.select(".entity-name"),q=o.t("intro.graph.name.spring-street");!ie.empty()&&ie.html()===q&&(e.reveal({revealNode:ne.node(),revealPadding:5,tipHtml:J(n,"intro.navigation.choose_street",{name:q})}),i.select(".search-header input").on("keydown.intro",kr,!0).on("keyup.intro",null))})}).finally(()=>{b=null,i.select(".search-header input").on("keydown.intro",null).on("keyup.intro",null)}):Promise.resolve(U)}function V(){let Y=h.center();return a.setMapParamsAsync(Y,19,0,0).then(()=>new Promise((K,ne)=>{if(y=ne,b=ne,!C()){K(U);return}e.reveal({revealExtent:h,revealPadding:40,tipHtml:J(n,"intro.navigation.selected_street",{name:o.t("intro.graph.name.spring-street")}),buttonText:o.t("intro.ok"),buttonCallback:()=>K(j)})})).finally(()=>{b=null})}function j(){return C()?new Promise((Y,K)=>{y=K,b=()=>Y(Z),c.Sidebar.showEntityEditor();let ie=H(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close",q=J(n,"intro.navigation.street_different_fields")+"{br}"+J(n,"intro.navigation.editor_street",{button:Ce(ie,"inline"),field1:p.label(),field2:m.label()});e.reveal({revealSelector:".entity-editor-pane",tipHtml:q})}).finally(()=>{b=null}):Promise.resolve(U)}function Z(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-point",tipHtml:J(n,"intro.navigation.play",{next:o.t("intro.points.title")}),buttonText:o.t("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{g=!1,y=null,x=null,b=null,n.on("modechange",K),a.on("move",Y),k(v).catch(ne=>{ne instanceof Error&&console.error(ne)}).finally(()=>{n.off("modechange",K),a.off("move",Y)});function Y(...ne){typeof x=="function"&&x(...ne)}function K(...ne){typeof b=="function"&&b(...ne)}},r.exit=()=>{g=!0,y&&(y(),y=null)},r.restart=()=>{r.exit(),r.enter()},xe(r,t,"on")}function vW(n,e){let t=ge("done"),r={title:"intro.points.title"},i=n.container(),s=n.systems.editor,o=n.systems.l10n,a=n.systems.map,l=n.systems.presets,c=n.systems.ui,u=c.EditMenu,d=new le([-85.63261,41.94391],[-85.63222,41.94419]),f=l.item("amenity/cafe"),h=!1,p=null,m=null,g=null,y=null,x=null;function b(){let B=s.staging.graph;return x&&B.hasEntity(x)}function _(){if(n.mode?.id!=="select-osm")return!1;let B=n.selectedIDs();return B.length===1&&B[0]===x}function S(B){return h?Promise.reject():typeof B!="function"?Promise.resolve():B().then(O=>S(O)).catch(O=>(O instanceof Error&&console.error(O),S(B)))}function C(){n.enter("browse"),s.restoreCheckpoint("initial"),x=null;let B=d.center(),O=jr(B,a.center());return O>0&&e.hide(),a.setMapParamsAsync(B,20,0,O).then(()=>new Promise((G,U)=>{p=U,m=()=>G(k),e.reveal({revealSelector:"button.add-point",tipHtml:J(n,"intro.points.points_info")+"{br}"+J(n,"intro.points.add_point")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-points")})).finally(()=>{m=null})}function k(){return n.mode?.id!=="add-point"?Promise.resolve(C):(x=null,new Promise((B,O)=>{p=O,m=()=>B(v),g=U=>{let W=U.created();W.length!==1||W[0].geometry(U._head)!=="point"||(x=W[0].id)};let G=n.lastPointerType==="mouse"?"place_point":"place_point_touch";e.reveal({revealExtent:d,tipHtml:J(n,`intro.points.${G}`)})}).finally(()=>{m=null,g=null}))}function v(){return Ut().then(()=>new Promise((B,O)=>{if(p=O,!b()){B(C);return}_()||n.enter("select-osm",{selection:{osm:[x]}}),m=O,g=U=>{let W=U.modified();if(W.length===1){let V=s.staging.graph;l.match(W[0],V)===f?B(w):O()}},i.select(".inspector-wrap").on("wheel.intro",kr),c.Sidebar.showPresetList(),e.reveal({revealSelector:".preset-search-input",tipHtml:J(n,"intro.points.search_cafe",{preset:f.name()})}),i.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",G);function G(){let U=i.select(".preset-list-item:first-child");U.classed("preset-amenity_cafe")&&(e.reveal({revealNode:U.select(".preset-list-button").node(),revealPadding:5,tipHtml:J(n,"intro.points.choose_cafe",{preset:f.name()})}),i.select(".preset-search-input").on("keydown.intro",kr,!0).on("keyup.intro",null))}})).finally(()=>{m=null,g=null,i.select(".inspector-wrap").on("wheel.intro",null),i.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function w(){return Ut().then(()=>new Promise((B,O)=>{if(p=O,!b()){B(C);return}_()||n.enter("select-osm",{selection:{osm:[x]}}),m=()=>B(A),c.Sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(n,"intro.points.feature_editor"),tipClass:"intro-points-describe",buttonText:o.t("intro.ok"),buttonCallback:()=>B(A)})})).finally(()=>{m=null})}function A(){return Ut().then(()=>new Promise((B,O)=>{if(p=O,!b()){B(C);return}_()||n.enter("select-osm",{selection:{osm:[x]}}),m=()=>B(I),y=()=>B(E),c.Sidebar.showEntityEditor(),s.staging.graph.hasEntity(x).tags.name?e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(n,"intro.points.fields_info"),buttonText:o.t("intro.ok"),buttonCallback:()=>B(E)}).select(".instruction").style("display","none"):e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(n,"intro.points.fields_info")+"{br}"+J(n,"intro.points.add_name"),tipClass:"intro-points-describe"})})).finally(()=>{m=null,y=null})}function E(){return b()?(_()||n.enter("select-osm",{selection:{osm:[x]}}),new Promise((B,O)=>{p=O,m=()=>B(I),c.Sidebar.showEntityEditor();let U=H(".entity-editor-pane button.close svg use").attr("href")||"#rapid-icon-close";e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(n,"intro.points.add_close",{button:Ce(U,"inline")})})}).finally(()=>{m=null})):Promise.resolve(C)}function I(){if(!b())return Promise.resolve(C);let B=s.staging.graph,O=B.entity(x),G=l.match(O,B);return G!==f&&(s.perform(ti(x,G,f)),s.commit({annotation:o.t("operations.change_tags.annotation"),selectedIDs:[x]})),s.setCheckpoint("hasPoint"),Promise.resolve(M)}function M(){n.enter("browse"),s.restoreCheckpoint("hasPoint");let B=d.center(),O=jr(B,a.center());return O>0&&e.hide(),a.setMapParamsAsync(B,20,void 0,O).then(()=>new Promise((G,U)=>{p=U,m=()=>G(T),e.reveal({revealExtent:d,tipHtml:J(n,"intro.points.reselect")})})).finally(()=>{m=null})}function T(){return Ut().then(()=>new Promise((B,O)=>{if(p=O,!b()||!_()){B(M);return}m=O,y=()=>B(R),c.Sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(n,"intro.points.update"),tipClass:"intro-points-describe"})})).finally(()=>{m=null,y=null})}function R(){return!b()||!_()?Promise.resolve(M):new Promise((B,O)=>{p=O,m=()=>B(P),c.Sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(n,"intro.points.update_close",{button:Ce("#rapid-icon-close","inline")})})}).finally(()=>{m=null})}function P(){return b()?(["browse","select-osm"].includes(n.mode?.id)||n.enter("browse"),new Promise((B,O)=>{p=O,y=O;let G=n.lastPointerType==="mouse"?"rightclick":"edit_menu_touch";e.reveal({revealExtent:d,tipHtml:J(n,`intro.points.${G}`)}),u.on("toggled.intro",U=>{U&&B(D)})}).finally(()=>{y=null,u.on("toggled.intro",null)})):Promise.resolve(M)}function D(){return i.select(".edit-menu-item-delete").node()?Ut().then(()=>new Promise((O,G)=>{if(p=G,m=()=>{b()&&G()},g=U=>{let W=U.deleted();W.length===1&&W[0].id===x&&O(N)},!b()||!_()){O(P);return}e.reveal({revealSelector:".edit-menu",revealPadding:50,tipHtml:J(n,"intro.points.delete")})})).finally(()=>{m=null,g=null}):Promise.resolve(P)}function N(){return new Promise((B,O)=>{p=O,g=()=>B(F),e.reveal({revealSelector:".map-toolbar button.undo-button",tipHtml:J(n,"intro.points.undo")})}).finally(()=>{g=null})}function F(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-area",tipHtml:J(n,"intro.points.play",{next:o.t("intro.areas.title")}),buttonText:o.t("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{h=!1,p=null,m=null,g=null,y=null,n.on("modechange",B),s.on("stablechange",O),s.on("stagingchange",G),S(C).catch(U=>{U instanceof Error&&console.error(U)}).finally(()=>{n.off("modechange",B),s.off("stablechange",O),s.off("stagingchange",G)});function B(...U){typeof m=="function"&&m(...U)}function O(...U){typeof g=="function"&&g(...U)}function G(...U){typeof y=="function"&&y(...U)}},r.exit=()=>{h=!0,p&&(p(),p=null)},r.restart=()=>{r.exit(),r.enter()},xe(r,t,"on")}function wW(n,e){let t=ge("done"),r={title:"intro.areas.title"},i=n.container(),s=n.systems.editor,o=n.systems.l10n,a=n.systems.map,l=n.systems.presets,c=n.systems.ui,u=new le([-85.63575,41.94137],[-85.63526,41.9418]),d=l.item("leisure/playground"),f=l.field("name"),h=l.field("description"),p=!1,m=null,g=null,y=null,x=null;function b(){let P=s.staging.graph;return x&&P.hasEntity(x)}function _(){if(n.mode?.id!=="select-osm")return!1;let P=n.selectedIDs();return P.length===1&&P[0]===x}function S(P){return p?Promise.reject():typeof P!="function"?Promise.resolve():P().then(D=>S(D)).catch(D=>(D instanceof Error&&console.error(D),S(P)))}function C(){n.enter("browse"),s.restoreCheckpoint("initial"),x=null;let P=u.center(),D=jr(P,a.center());return D>0&&e.hide(),a.setMapParamsAsync(P,19.5,0,D).then(()=>new Promise((N,F)=>{m=F,g=()=>N(k),e.reveal({revealSelector:"button.draw-area",tipHtml:J(n,"intro.areas.add_playground")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-areas")})).finally(()=>{g=null})}function k(){return n.mode?.id!=="draw-area"?Promise.resolve(C):(x=null,new Promise((P,D)=>{m=D,g=D,y=B=>{for(let O of B.created())O.type==="way"&&(x=O.id,P(v))};let N=n.lastPointerType==="mouse"?"click":"tap",F=J(n,"intro.areas.start_playground")+J(n,`intro.areas.starting_node_${N}`);e.reveal({revealExtent:u,tipHtml:F})}).finally(()=>{g=null,y=null}))}function v(){return!b()||n.mode?.id!=="draw-area"?Promise.resolve(C):new Promise((P,D)=>{m=D,g=D,y=N=>{for(let F of N.modified())F.id===x&&F.nodes.length>5&&P(w)},e.reveal({revealExtent:u,tipHtml:J(n,"intro.areas.continue_playground")})}).finally(()=>{g=null,y=null})}function w(){return!b()||n.mode?.id!=="draw-area"?Promise.resolve(C):new Promise((P,D)=>{m=D,g=()=>P(A);let N=n.lastPointerType==="mouse"?"click":"tap",F=J(n,`intro.areas.finish_area_${N}`)+J(n,"intro.areas.finish_playground");e.reveal({revealExtent:u,tipHtml:F})}).finally(()=>{g=null})}function A(){return Ut().then(()=>new Promise((P,D)=>{if(m=D,!b()){P(C);return}_()||n.enter("select-osm",{selection:{osm:[x]}}),g=D,y=F=>{let B=F.modified();if(B.length===1){let O=s.staging.graph;l.match(B[0],O)===d?P(E):D()}},c.Sidebar.showPresetList(),i.select(".inspector-wrap").on("wheel.intro",kr),e.reveal({revealSelector:".preset-search-input",tipHtml:J(n,"intro.areas.search_playground",{preset:d.name()})}),i.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",N);function N(){let F=i.select(".preset-list-item:first-child");F.classed("preset-leisure_playground")&&(e.reveal({revealNode:F.select(".preset-list-button").node(),revealPadding:5,tipHtml:J(n,"intro.areas.search_playground",{preset:d.name()})}),i.select(".preset-search-input").on("keydown.intro",kr,!0).on("keyup.intro",null))}})).finally(()=>{g=null,y=null,i.select(".inspector-wrap").on("wheel.intro",null),i.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function E(){return Ut().then(()=>new Promise((P,D)=>{if(m=D,!b()){P(C);return}if(_()||n.enter("select-osm",{selection:{osm:[x]}}),!i.select(".form-field-description").empty()){P(M);return}if(s.staging.graph.entity(x).tags.description){P(R);return}g=D,c.Sidebar.showEntityEditor(),i.select(".inspector-wrap").on("wheel.intro",kr);let B=i.select(".more-fields").node().getBoundingClientRect();if(B.top>300){let O=i.select(".entity-editor-pane .inspector-body"),G=O.node().scrollTop,U=G+(B.top-300);O.transition().duration(250).tween("scroll.inspector",()=>{let W=this,V=wr(G,U);return function(j){W.scrollTop=V(j)}})}window.setTimeout(()=>{e.reveal({revealSelector:".more-fields .combobox-input",revealPadding:5,tipHtml:J(n,"intro.areas.add_field",{name:f.label(),description:h.label()})}),i.select(".more-fields .combobox-input").on("click.intro",()=>{let O=window.setInterval(()=>{i.select("div.combobox").empty()||(window.clearInterval(O),P(I))},300)})},300)})).finally(()=>{g=null,i.select(".inspector-wrap").on("wheel.intro",null),i.select(".more-fields .combobox-input").on("click.intro",null)})}function I(){if(!b())return Promise.resolve(C);if(!_())return Promise.resolve(A);if(!i.select(".form-field-description").empty())return Promise.resolve(M);if(i.select("div.combobox").empty())return Promise.resolve(E);let P;return new Promise((D,N)=>{m=N,g=N,P=window.setInterval(()=>{i.select("div.combobox").empty()&&(window.clearInterval(P),window.setTimeout(()=>{i.select(".form-field-description").empty()?D(T):D(M)},300))},300),c.Sidebar.showEntityEditor(),e.reveal({revealSelector:"div.combobox",revealPadding:5,tipHtml:J(n,"intro.areas.choose_field",{field:h.label()})})}).finally(()=>{g=null,P&&window.clearInterval(P)})}function M(){return b()?_()?i.select(".form-field-description").empty()?Promise.resolve(T):new Promise((P,D)=>{m=D,g=()=>P(R),c.Sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(n,"intro.areas.describe_playground",{button:Ce("#rapid-icon-close","inline")})})}).finally(()=>{g=null}):Promise.resolve(A):Promise.resolve(C)}function T(){return b()?_()?new Promise((P,D)=>{m=D,g=D,c.Sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(n,"intro.areas.retry_add_field",{field:h.label()}),buttonText:o.t("intro.ok"),buttonCallback:()=>P(E)})}).finally(()=>{g=null}):Promise.resolve(A):Promise.resolve(C)}function R(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-line",tipHtml:J(n,"intro.areas.play",{next:o.t("intro.lines.title")}),buttonText:o.t("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{p=!1,m=null,g=null,y=null,n.on("modechange",P),s.on("stagingchange",D),S(C).catch(N=>{N instanceof Error&&console.error(N)}).finally(()=>{n.off("modechange",P),s.off("stagingchange",D)});function P(...N){typeof g=="function"&&g(...N)}function D(...N){typeof y=="function"&&y(...N)}},r.exit=()=>{p=!0,m&&(m(),m=null)},r.restart=()=>{r.exit(),r.enter()},xe(r,t,"on")}function SW(n,e){let t=ge("done"),r={title:"intro.lines.title"},i=n.container(),s=n.behaviors.drag,o=n.systems.editor,a=n.systems.l10n,l=n.systems.map,c=n.systems.presets,u=n.systems.ui,d=u.EditMenu,f="w646",h=new le([-85.63016,41.95749],[-85.62937,41.95843]),p=new le([-85.63044,41.95686],[-85.629,41.95843]),m=[-85.629745,41.95742],g=c.item("category-road_minor"),y=c.item("highway/residential"),x="w525",b="n2862",_=new le([-85.62457,41.95381],[-85.62326,41.9548]),S=[-85.6239,41.95397],C=[-85.62387,41.95467],k=[-85.62386,41.9543],v="w522",w="w1",A="n3550",E=new le([-85.62304,41.95084],[-85.62087,41.95336]),I=[-85.622758,41.951884],M=!1,T=null,R=null,P=null,D=null,N=null,F=null;function B(){let ae=o.staging.graph;return F&&ae.hasEntity(F)}function O(){if(n.mode?.id!=="select-osm")return!1;let ae=n.selectedIDs();return ae.length===1&&ae[0]===F}function G(){let ae=o.staging.graph,ye=F&&ae.hasEntity(F),Ue=f&&ae.hasEntity(f);return!ye||!Ue?!1:ae.childNodes(ye).some(vt=>ae.parentWays(vt).some(qt=>qt.id===f))}function U(){let ae=o.staging.graph;return ae.hasEntity(x)&&ae.hasEntity(b)}function W(){if(n.mode?.id!=="select-osm")return!1;let ae=n.selectedIDs();return ae.length===1&&ae[0]===x}function V(){let ae=o.staging.graph;return ae.hasEntity(v)&&ae.hasEntity(w)&&ae.hasEntity(A)}function j(){let ae=o.staging.graph;return N&&ae.hasEntity(N)}function Z(){if(n.mode?.id!=="select-osm")return!1;let ae=n.selectedIDs();return ae.length===1&&ae[0]===A}function Y(ae){return M?Promise.reject():typeof ae!="function"?Promise.resolve():ae().then(ye=>Y(ye)).catch(ye=>(ye instanceof Error&&console.error(ye),Y(ae)))}function K(){n.enter("browse"),o.restoreCheckpoint("initial"),F=null;let ae=h.center(),ye=jr(ae,l.center());return ye>0&&e.hide(),l.setMapParamsAsync(ae,18.5,0,ye).then(()=>new Promise((Ue,Be)=>{T=Be,P=()=>Ue(ne),e.reveal({revealSelector:"button.draw-line",tipHtml:J(n,"intro.lines.add_line")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-lines")})).finally(()=>{P=null})}function ne(){return n.mode?.id!=="draw-line"?Promise.resolve(K):(F=null,new Promise((ae,ye)=>{T=ye,P=ye,D=vt=>{for(let qt of vt.created())qt.type==="way"&&(F=qt.id,ae(ie))};let Ue=n.lastPointerType==="mouse"?"start_line":"start_line_tap",Be=J(n,"intro.lines.missing_road")+"{br}"+J(n,"intro.lines.line_draw_info")+J(n,`intro.lines.${Ue}`);e.reveal({revealExtent:h,tipHtml:Be})}).finally(()=>{P=null,D=null}))}function ie(){let ae=p.center(),ye=jr(ae,l.center());return l.setMapParamsAsync(ae,18.5,0,ye).then(()=>new Promise((Ue,Be)=>{if(T=Be,!B()||n.mode?.id!=="draw-line"){Ue(K);return}P=()=>Ue(q),D=()=>{G()&&Ue(se)},e.reveal({revealExtent:p,tipHtml:J(n,"intro.lines.intersect",{name:a.t("intro.graph.name.flower-street")})})})).finally(()=>{P=null,D=null})}function q(){return new Promise((ae,ye)=>{T=ye,e.reveal({revealExtent:new le(m).padByMeters(15),tipHtml:J(n,"intro.lines.retry_intersect",{name:a.t("intro.graph.name.flower-street")}),buttonText:a.t("intro.ok"),buttonCallback:()=>ae(K)})})}function se(){let ae=p.center(),ye=jr(ae,l.center());return l.setMapParamsAsync(ae,18.5,0,ye).then(()=>new Promise((Ue,Be)=>{if(T=Be,!B()||n.mode?.id!=="draw-line"){Ue(K);return}P=()=>Ue(te);let vt=n.lastPointerType==="mouse"?"click":"tap",qt=J(n,"intro.lines.continue_line")+"{br}"+J(n,`intro.lines.finish_line_${vt}`)+J(n,"intro.lines.finish_road");e.reveal({revealSelector:".main-map",tipHtml:qt})})).finally(()=>{P=null})}function te(){let ae;return Ut().then(()=>new Promise((ye,Ue)=>{if(T=Ue,!B()){ye(K);return}if(O()||n.enter("select-osm",{selection:{osm:[F]}}),P=Ue,i.select(".inspector-wrap").on("wheel.intro",kr),ae=i.select(".preset-category_road_minor .preset-list-button"),ae.empty()){Ue(new Error("no minor roads category?"));return}if(ae.classed("expanded")){ye(Q);return}e.reveal({revealNode:ae.node(),revealPadding:5,tipHtml:J(n,"intro.lines.choose_category_road",{category:g.name()})}),ae.on("click.intro",()=>ye(Q))})).finally(()=>{P=null,ae&&ae.on("click.intro",null),i.select(".inspector-wrap").on("wheel.intro",null)})}function Q(){return Ut().then(()=>new Promise((ae,ye)=>{if(T=ye,!B()){ae(K);return}O()||n.enter("select-osm",{selection:{osm:[F]}}),i.select(".inspector-wrap").on("wheel.intro",kr);let Ue=i.select(".preset-category_road_minor .preset-list-button");if(Ue.empty()){ye(new Error("no minor roads category?"));return}if(!Ue.classed("expanded")){ae(te);return}let Be=i.select(".preset-category_road_minor .subgrid");if(Be.empty()){ye(new Error("no minor roads presets?"));return}P=ye,D=vt=>{let qt=vt.modified();if(qt.length===1){let xn=o.staging.graph;c.match(qt[0],xn)===y?ae(je):ae(_e)}},e.reveal({revealNode:Be.node(),revealPadding:5,tipSelector:".preset-highway_residential .preset-list-button",tipHtml:J(n,"intro.lines.choose_preset_residential",{preset:y.name()})})})).finally(()=>{P=null,D=null,i.select(".inspector-wrap").on("wheel.intro",null)})}function _e(){return Ut().then(()=>new Promise((ae,ye)=>{if(T=ye,!B()){ae(K);return}O()||n.enter("select-osm",{selection:{osm:[F]}}),u.Sidebar.showPresetList(),i.select(".inspector-wrap").on("wheel.intro",kr);let Ue=i.select(".preset-category_road_minor .preset-list-button");if(Ue.empty()){ye(new Error("no minor roads category?"));return}if(!Ue.classed("expanded")){ae(te);return}let Be=i.select(".preset-highway_residential .preset-list-button");if(Be.empty()){ye(new Error("no residential road preset?"));return}P=ye,D=vt=>{let qt=vt.modified();if(qt.length===1){let xn=o.staging.graph;c.match(qt[0],xn)===y?ae(je):ae(te)}},e.reveal({revealNode:Be.node(),revealPadding:5,tipHtml:J(n,"intro.lines.retry_preset_residential",{preset:y.name()})})})).finally(()=>{P=null,D=null,i.select(".inspector-wrap").on("wheel.intro",null)})}function je(){return Ut().then(()=>new Promise((ae,ye)=>{if(T=ye,!B()){ae(K);return}O()||n.enter("select-osm",{selection:{osm:[F]}}),P=()=>ae(Dt),u.Sidebar.showEntityEditor(),e.reveal({revealSelector:".entity-editor-pane",tipHtml:J(n,"intro.lines.name_road",{button:Ce("#rapid-icon-close","inline")}),tooltipClass:"intro-lines-name_road"})})).finally(()=>{P=null})}function Dt(){return B()?(o.setCheckpoint("doneAddLine"),new Promise((ae,ye)=>{T=ye,e.reveal({revealSelector:".main-map",tipHtml:J(n,"intro.lines.did_name_road"),buttonText:a.t("intro.ok"),buttonCallback:()=>ae(xt)})})):Promise.resolve(K)}function xt(){n.enter("browse"),o.restoreCheckpoint("doneAddLine"),U()||o.restoreCheckpoint("initial");let ae=_.center(),ye=jr(ae,l.center());return ye>0&&e.hide(),l.setMapParamsAsync(ae,19,0,ye).then(()=>new Promise((Ue,Be)=>{T=Be,e.reveal({revealExtent:_,tipHtml:J(n,"intro.lines.update_line"),buttonText:a.t("intro.ok"),buttonCallback:()=>Ue(nr)})}))}function nr(){return n.enter("browse"),U()?new Promise((ae,ye)=>{T=ye,P=Be=>{["browse","select-osm"].includes(Be.id)||ye()},D=Be=>{Be&&Be.created().length===1?ae(on):ye()};let Ue=n.lastPointerType==="mouse"?"":"_touch";e.reveal({revealExtent:new le(S).padByMeters(15),tipHtml:J(n,`intro.lines.add_node${Ue}`)})}).finally(()=>{P=null,D=null}):Promise.resolve(xt)}function on(){if(!U())return Promise.resolve(xt);let ae;return new Promise((ye,Ue)=>{T=Ue;let Be=n.lastPointerType==="mouse"?"":"_touch",vt=J(n,`intro.lines.start_drag_endpoint${Be}`)+J(n,"intro.lines.drag_to_intersection");e.reveal({revealExtent:new le(C).padByMeters(20),tipHtml:vt}),ae=()=>{if(!U())Ue();else{let xn=o.staging.graph.entity(b);ht(xn.loc,C)<=4&&ye(rn)}},s.on("move",ae)}).finally(()=>{ae&&s.off("move",ae)})}function rn(){if(!U())return Promise.resolve(xt);let ae;return new Promise((ye,Ue)=>{T=Ue,P=()=>ye(fr);let Be=n.lastPointerType==="mouse"?"":"_touch",vt=J(n,"intro.lines.spot_looks_good")+J(n,`intro.lines.finish_drag_endpoint${Be}`);e.reveal({revealExtent:new le(C).padByMeters(20),tipHtml:vt}),ae=()=>{if(!U())Ue();else{let xn=o.staging.graph.entity(b);ht(xn.loc,C)>4&&ye(on)}},s.on("move",ae)}).finally(()=>{P=null,ae&&s.off("move",ae)})}function fr(){return U()?(W()||n.enter("select-osm",{selection:{osm:[x]}}),new Promise((ae,ye)=>{T=ye,P=ye,D=Ue=>{Ue&&Ue.created().length===1&&ae(Ye)},e.reveal({revealExtent:new le(k).padByMeters(20),tipHtml:J(n,"intro.lines.start_drag_midpoint")})}).finally(()=>{P=null,D=null})):Promise.resolve(xt)}function Ye(){return U()?new Promise((ae,ye)=>{T=ye,e.reveal({revealExtent:_,tipHtml:J(n,"intro.lines.continue_drag_midpoint"),buttonText:a.t("intro.ok"),buttonCallback:()=>{o.setCheckpoint("doneUpdateLine"),ae(mt)}})}):Promise.resolve(xt)}function mt(){n.enter("browse"),o.restoreCheckpoint("doneUpdateLine"),V()||o.restoreCheckpoint("initial");let ae=E.center(),ye=jr(ae,l.center());return ye>0&&e.hide(),l.setMapParamsAsync(ae,18,0,ye).then(()=>new Promise((Ue,Be)=>{T=Be,e.reveal({revealExtent:E,tipHtml:J(n,"intro.lines.delete_lines",{street:a.t("intro.graph.name.12th-avenue")}),buttonText:a.t("intro.ok"),buttonCallback:()=>Ue(Yr)})}))}function Yr(){return n.enter("browse"),o.restoreCheckpoint("doneUpdateLine"),V()||o.restoreCheckpoint("initial"),N=null,new Promise((ae,ye)=>{T=ye,D=ye;let Ue=n.lastPointerType==="mouse"?"rightclick_intersection":"edit_menu_intersection_touch",Be=J(n,"intro.lines.split_street",{street1:a.t("intro.graph.name.11th-avenue"),street2:a.t("intro.graph.name.washington-street")})+J(n,`intro.lines.${Ue}`);e.reveal({revealExtent:new le(I).padByMeters(10),tipHtml:Be}),d.on("toggled.intro",vt=>{vt&&ae(di)})}).finally(()=>{D=null,d.on("toggled.intro",null)})}function di(){return i.select(".edit-menu-item-split").node()?(N=null,Ut().then(()=>new Promise((ye,Ue)=>{if(T=Ue,!V()){ye(mt);return}Z()||n.enter("select-osm",{selection:{osm:[A]}});let Be=(vt=0)=>{let qt=i.select(".edit-menu").node();qt?e.reveal({duration:vt,revealNode:qt,revealPadding:50,tipHtml:J(n,"intro.lines.split_intersection",{street:a.t("intro.graph.name.washington-street")})}):Ue()};P=Ue,D=vt=>{R=null,D=null,vt&&vt.created()?(N=vt.created()[0].id,ye()):Ue()},R=Be,Be(250)})).then(Ut).then(()=>o.getUndoAnnotation()===a.t("operations.split.annotation.line",{n:1})?ja:_c).finally(()=>{P=null,D=null,R=null})):Promise.resolve(Yr)}function _c(){return n.enter("browse"),new Promise((ae,ye)=>{T=ye,e.reveal({revealExtent:E,tipHtml:J(n,"intro.lines.retry_split"),buttonText:a.t("intro.ok"),buttonCallback:()=>ae(Yr)})})}function ja(){return V()?j()?new Promise((ae,ye)=>{T=ye,P=()=>ae(Bi),D=ye;let Be="intro.lines.did_split_"+(n.selectedIDs().length>1?"multi":"single"),vt=a.t("intro.graph.name.washington-street");e.reveal({revealExtent:E,tipHtml:J(n,Be,{street1:vt,street2:vt})})}).finally(()=>{P=null,D=null}):Promise.resolve(Yr):Promise.resolve(mt)}function Bi(){if(!V())return Promise.resolve(mt);if(!j())return Promise.resolve(Yr);let ae=n.selectedIDs(),ye=ae.indexOf(N)!==-1,Ue=ae.indexOf(w)!==-1;if(ye&&Ue)return Promise.resolve(na);if(!ye&&!Ue)return Promise.resolve(ja);let Be,vt;ye?(Be=a.t("intro.graph.name.washington-street"),vt=a.t("intro.graph.name.12th-avenue")):(Be=a.t("intro.graph.name.12th-avenue"),vt=a.t("intro.graph.name.washington-street"));let qt=n.lastPointerType==="mouse"?"click":"touch",xn=J(n,"intro.lines.multi_select",{selected:Be,other1:vt})+" "+J(n,`intro.lines.add_to_selection_${qt}`,{selected:Be,other2:vt});return e.reveal({revealExtent:E,tipHtml:xn}),new Promise((Bs,Ni)=>{T=Ni,P=Ni,D=Ni}).finally(()=>{P=null,D=null})}function na(){if(!V())return Promise.resolve(mt);if(!j())return Promise.resolve(Yr);let ae=n.selectedIDs(),ye=ae.indexOf(N)!==-1,Ue=ae.indexOf(w)!==-1;return!ye||!Ue?Promise.resolve(Bi):new Promise((Be,vt)=>{T=vt,P=vt,D=vt;let qt=n.lastPointerType==="mouse"?"rightclick":"edit_menu_touch",xn=J(n,"intro.lines.multi_select_success")+J(n,`intro.lines.multi_${qt}`);e.reveal({revealExtent:E,tipHtml:xn}),d.on("toggled.intro",Bs=>{Bs&&Be(Pn)})}).finally(()=>{P=null,D=null,d.on("toggled.intro",null)})}function Pn(){return i.select(".edit-menu-item-delete").node()?Ut().then(()=>new Promise((ye,Ue)=>{if(T=Ue,!V()){ye(mt);return}if(!j()){ye(Yr);return}let Be=n.selectedIDs(),vt=Be.indexOf(N)!==-1,qt=Be.indexOf(w)!==-1;if(!vt||!qt){ye(Bi);return}let xn=(Bs=0)=>{let Ni=i.select(".edit-menu").node();Ni?e.reveal({duration:Bs,revealNode:Ni,revealPadding:50,tipHtml:J(n,"intro.lines.multi_delete")}):Ue()};P=Bs=>{let Ni=o.staging.graph;Bs.id==="browse"&&!Ni.hasEntity(N)&&!Ni.hasEntity(w)?ye(vc):ye(Bi)},D=()=>{D=null,P=null;let Bs=o.staging.graph;!Bs.hasEntity(N)&&!Bs.hasEntity(w)?ye(vc):ye(rs)},R=xn,xn(250)})).finally(()=>{P=null,D=null,R=null}):Promise.resolve(Bi)}function rs(){return n.enter("browse"),new Promise((ae,ye)=>{T=ye,e.reveal({revealExtent:E,tipHtml:J(n,"intro.lines.retry_delete"),buttonText:a.t("intro.ok"),buttonCallback:()=>ae(Bi)})})}function vc(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-building",tipHtml:J(n,"intro.lines.play",{next:a.t("intro.buildings.title")}),buttonText:a.t("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{M=!1,T=null,R=null,P=null,D=null,n.on("modechange",ye),l.on("move",ae),o.on("stagingchange",Ue),Y(K).catch(Be=>{Be instanceof Error&&console.error(Be)}).finally(()=>{n.off("modechange",ye),l.off("move",ae),o.off("stagingchange",Ue)});function ae(...Be){typeof R=="function"&&R(...Be)}function ye(...Be){typeof P=="function"&&P(...Be)}function Ue(...Be){typeof D=="function"&&D(...Be)}},r.exit=()=>{M=!0,T&&(T(),T=null)},r.restart=()=>{r.exit(),r.enter()},xe(r,t,"on")}function CW(n,e){let t=ge("done"),r={title:"intro.buildings.title"},i=n.container(),s=n.systems.editor,o=n.systems.l10n,a=n.systems.map,l=n.systems.presets,c=n.systems.ui,u=c.EditMenu,d=new le([-85.62836,41.95622],[-85.62791,41.95654]),f=new le([-85.62766,41.95324],[-85.62695,41.95372]),h=l.item("category-building"),p=l.item("building/house"),m=l.item("man_made/storage_tank"),g=!1,y=null,x=null,b=null,_=null,S=null,C=null;function k(){let q=s.staging.graph;return S&&q.hasEntity(S)}function v(){if(n.mode?.id!=="select-osm")return!1;let q=n.selectedIDs();return q.length===1&&q[0]===S}function w(){let q=s.staging.graph;return C&&q.hasEntity(C)}function A(){if(n.mode?.id!=="select-osm")return!1;let q=n.selectedIDs();return q.length===1&&q[0]===C}function E(q){return g?Promise.reject():typeof q!="function"?Promise.resolve():q().then(se=>E(se)).catch(se=>(se instanceof Error&&console.error(se),E(q)))}function I(){n.enter("browse"),s.restoreCheckpoint("initial"),S=null;let q=d.center(),se=jr(q,a.center());return se>0&&e.hide(),a.setMapParamsAsync(q,19,0,se).then(()=>new Promise((te,Q)=>{y=Q,b=()=>te(M),e.reveal({revealSelector:"button.draw-area",tipHtml:J(n,"intro.buildings.add_building")}).selectAll(".popover-inner").insert("svg","span").attr("class","tooltip-illustration").append("use").attr("xlink:href","#rapid-graphic-buildings")})).finally(()=>{b=null})}function M(){return S=null,a.setMapParamsAsync(d.center(),20,0,200).then(()=>new Promise((q,se)=>{if(y=se,n.mode?.id!=="draw-area"){q(I);return}b=se,_=_e=>{for(let je of _e.created())je.type==="way"&&(S=je.id,q(T))};let te=n.lastPointerType==="mouse"?"click":"tap",Q=J(n,"intro.buildings.start_building")+J(n,`intro.buildings.building_corner_${te}`);e.reveal({revealExtent:d,tipHtml:Q})})).finally(()=>{b=null,_=null})}function T(){return!k()||n.mode?.id!=="draw-area"?Promise.resolve(I):new Promise((q,se)=>{y=se,b=()=>{if(k()&&v()){let _e=s.staging.graph,je=_e.entity(S),Dt=_e.childNodes(je),xt=Ge(Dt).map(nr=>n.viewport.project(nr.loc));xW(xt)?q(P):q(R)}else se()};let te=n.lastPointerType==="mouse"?"click":"tap",Q=J(n,"intro.buildings.continue_building")+"{br}"+J(n,`intro.areas.finish_area_${te}`)+J(n,"intro.buildings.finish_building");e.reveal({revealExtent:d,tipHtml:Q})}).finally(()=>{b=null})}function R(){return new Promise((q,se)=>{y=se,e.reveal({revealExtent:d,tipHtml:J(n,"intro.buildings.retry_building"),buttonText:o.t("intro.ok"),buttonCallback:()=>q(I)})})}function P(){return Ut().then(()=>new Promise((q,se)=>{if(y=se,!k()){q(I);return}v()||n.enter("select-osm",{selection:{osm:[S]}}),b=se,c.Sidebar.showPresetList(),i.select(".inspector-wrap").on("wheel.intro",kr);let te=i.select(".preset-category_building .preset-list-button");if(te.empty()){q(I);return}e.reveal({revealNode:te.node(),revealPadding:5,tipHtml:J(n,"intro.buildings.choose_category_building",{category:h.name()})}),te.on("click.intro",()=>q(D))})).finally(()=>{b=null,i.select(".inspector-wrap").on("wheel.intro",null),i.select(".preset-list-button").on("click.intro",null)})}function D(){return Ut().then(()=>new Promise((q,se)=>{if(y=se,!k()){q(I);return}v()||n.enter("select-osm",{selection:{osm:[S]}}),b=se,_=Q=>{let _e=Q.modified();if(_e.length===1){let je=s.staging.graph;l.match(_e[0],je)===p?q(N):q(P)}},i.select(".inspector-wrap").on("wheel.intro",kr);let te=i.select(".preset-building_house .preset-list-button");if(te.empty()){q(I);return}e.reveal({revealNode:te.node(),revealPadding:5,tipHtml:J(n,"intro.buildings.choose_preset_house",{preset:p.name()})})})).finally(()=>{b=null,_=null,i.select(".inspector-wrap").on("wheel.intro",null),i.select(".preset-list-button").on("click.intro",null)})}function N(){if(!k())return Promise.resolve(I);let q=s.staging.graph,se=q.entity(S),te=l.match(se,q);return te!==p&&(s.perform(ti(S,te,p)),s.commit({annotation:o.t("operations.change_tags.annotation"),selectedIDs:[S]})),s.setCheckpoint("hasHouse"),Promise.resolve(F)}function F(){["browse","select-osm"].includes(n.mode?.id)||n.enter("browse"),s.restoreCheckpoint("hasHouse");let q=Math.max(a.zoom(),20);return a.setMapParamsAsync(d.center(),q,0,100).then(()=>new Promise((se,te)=>{y=te,_=te;let Q=n.lastPointerType==="mouse"?"rightclick_building":"edit_menu_building_touch";e.reveal({revealExtent:d,tipHtml:J(n,`intro.buildings.${Q}`)}),u.on("toggled.intro",_e=>{_e&&se(B)})})).finally(()=>{_=null,u.on("toggled.intro",null)})}function B(){return i.select(".edit-menu-item-orthogonalize").node()?Ut().then(()=>new Promise((se,te)=>{if(y=te,!k()||!v()){se(F);return}let Q=(_e=0)=>{let je=i.select(".edit-menu").node();je?e.reveal({duration:_e,revealNode:je,revealPadding:50,tipHtml:J(n,"intro.buildings.square_building")}):te()};b=te,_=()=>{_=null,x=null,e.reveal({revealExtent:d}),se()},x=Q,Q(250)})).then(Ut).then(()=>s.getUndoAnnotation()===o.t("operations.orthogonalize.annotation.feature",{n:1})?G:O).finally(()=>{x=null,b=null,_=null}):Promise.resolve(F)}function O(){return n.enter("browse"),new Promise((q,se)=>{y=se,e.reveal({revealExtent:d,tipHtml:J(n,"intro.buildings.retry_square"),buttonText:o.t("intro.ok"),buttonCallback:()=>q(F)})})}function G(){return s.setCheckpoint("doneSquare"),new Promise((q,se)=>{y=se,e.reveal({revealExtent:d,tipHtml:J(n,"intro.buildings.done_square"),buttonText:o.t("intro.ok"),buttonCallback:()=>q(U)})})}function U(){n.enter("browse"),s.restoreCheckpoint("doneSquare"),C=null;let q=f.center(),se=jr(q,a.center());return se>0&&e.hide(),a.setMapParamsAsync(q,19.5,0,se).then(()=>new Promise((te,Q)=>{y=Q,b=()=>te(W),e.reveal({revealSelector:"button.draw-area",tipHtml:J(n,"intro.buildings.add_tank")})})).finally(()=>{b=null})}function W(){return n.mode?.id!=="draw-area"?Promise.resolve(U):(C=null,new Promise((q,se)=>{y=se,b=se,_=_e=>{for(let je of _e.created())je.type==="way"&&(C=je.id,q(V))};let te=n.lastPointerType==="mouse"?"click":"tap",Q=J(n,"intro.buildings.start_tank")+J(n,`intro.buildings.tank_edge_${te}`);e.reveal({revealExtent:f,tipHtml:Q})}).finally(()=>{b=null,_=null}))}function V(){return n.mode?.id!=="draw-area"?Promise.resolve(U):new Promise((q,se)=>{y=se,b=()=>{w()&&A()?q(j):se()};let te=n.lastPointerType==="mouse"?"click":"tap",Q=J(n,"intro.buildings.continue_tank")+"{br}"+J(n,`intro.areas.finish_area_${te}`)+J(n,"intro.buildings.finish_tank");e.reveal({revealExtent:f,tipHtml:Q})}).finally(()=>{b=null})}function j(){return Ut().then(()=>new Promise((q,se)=>{if(y=se,!w()){q(U);return}A()||n.enter("select-osm",{selection:{osm:[C]}}),b=se,_=Q=>{let _e=Q.modified();if(_e.length===1){let je=s.staging.graph;l.match(_e[0],je)===m?q(Z):se()}},i.select(".inspector-wrap").on("wheel.intro",kr),c.Sidebar.showPresetList(),e.reveal({revealSelector:".preset-search-input",tipHtml:J(n,"intro.buildings.search_tank",{preset:m.name()})}),i.select(".preset-search-input").on("keydown.intro",null).on("keyup.intro",te);function te(){let Q=i.select(".preset-list-item:first-child");Q.classed("preset-man_made_storage_tank")&&(e.reveal({revealNode:Q.select(".preset-list-button").node(),revealPadding:5,tipHtml:J(n,"intro.buildings.choose_tank",{preset:m.name()})}),i.select(".preset-search-input").on("keydown.intro",kr,!0).on("keyup.intro",null))}})).finally(()=>{b=null,_=null,i.select(".inspector-wrap").on("wheel.intro",null),i.select(".preset-search-input").on("keydown.intro keyup.intro",null)})}function Z(){if(!w())return Promise.resolve(U);let q=s.staging.graph,se=q.entity(C),te=l.match(se,q);return te!==m&&(s.perform(ti(C,te,m)),s.commit({annotation:o.t("operations.change_tags.annotation"),selectedIDs:[C]})),s.setCheckpoint("hasTank"),Promise.resolve(Y)}function Y(){return["browse","select-osm"].includes(n.mode?.id)||n.enter("browse"),s.restoreCheckpoint("hasTank"),new Promise((q,se)=>{y=se,_=se;let te=n.lastPointerType==="mouse"?"rightclick_tank":"edit_menu_tank_touch";e.reveal({revealExtent:f,tipHtml:J(n,`intro.buildings.${te}`)}),u.on("toggled.intro",Q=>{Q&&q(K)})}).finally(()=>{_=null,u.on("toggled.intro",null)})}function K(){return i.select(".edit-menu-item-circularize").node()?Ut().then(()=>new Promise((se,te)=>{if(y=te,!w()||!A()){se(Y);return}b=te;let Q=(_e=0)=>{let je=i.select(".edit-menu").node();je?e.reveal({duration:_e,revealNode:je,revealPadding:50,tipHtml:J(n,"intro.buildings.circle_tank")}):te()};_=()=>{x=null,_=null,e.reveal({revealExtent:f}),se()},x=Q,Q(250)})).then(Ut).then(()=>s.getUndoAnnotation()===o.t("operations.circularize.annotation.feature",{n:1})?ie:ne).finally(()=>{x=null,b=null,_=null}):Promise.resolve(Y)}function ne(){return n.enter("browse"),new Promise((q,se)=>{y=se,e.reveal({revealExtent:f,tipHtml:J(n,"intro.buildings.retry_circle"),buttonText:o.t("intro.ok"),buttonCallback:()=>q(Y)})})}function ie(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-rapid",tipHtml:J(n,"intro.buildings.play",{next:o.t("intro.rapid.title")}),buttonText:o.t("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{g=!1,y=null,x=null,b=null,_=null,n.on("modechange",se),a.on("move",q),s.on("stablechange",te),E(I).catch(Q=>{Q instanceof Error&&console.error(Q)}).finally(()=>{n.off("modechange",se),a.off("move",q),s.off("stablechange",te)});function q(...Q){typeof x=="function"&&x(...Q)}function se(...Q){typeof b=="function"&&b(...Q)}function te(...Q){typeof _=="function"&&_(...Q)}},r.exit=()=>{g=!0,y&&(y(),y=null)},r.restart=()=>{r.exit(),r.enter()},xe(r,t,"on")}function AW(n,e){let t=ge("done"),r={title:"intro.startediting.title"},i=n.container(),s=n.systems.l10n,o=!1,a=null;function l(h){return o?Promise.reject():typeof h!="function"?Promise.resolve():h().then(p=>l(p)).catch(p=>(p instanceof Error&&console.error(p),l(h)))}function c(){return new Promise((h,p)=>{a=p,e.reveal({revealSelector:".map-control.help-control",tipHtml:J(n,"intro.startediting.help"),buttonText:s.t("intro.ok"),buttonCallback:()=>h(u)})})}function u(){return new Promise((h,p)=>{a=p,e.reveal({revealSelector:".map-control.help-control",tipHtml:J(n,"intro.startediting.shortcuts"),buttonText:s.t("intro.ok"),buttonCallback:()=>h(d)})})}function d(){return i.selectAll(".shaded").remove(),new Promise((h,p)=>{a=p,e.reveal({revealSelector:".map-toolbar button.save",tipHtml:J(n,"intro.startediting.save"),buttonText:s.t("intro.ok"),buttonCallback:()=>h(f)})})}function f(){i.selectAll(".shaded").remove();let h=vr(i);return h.select(".modal").attr("class","modal-splash modal"),h.selectAll(".close").remove(),new Promise((p,m)=>{a=m;let g=h.select(".content").attr("class","fillL").append("button").attr("class","modal-section huge-modal-button").on("click",()=>{p(),t.call("done")});g.append("svg").attr("class","illustration").append("use").attr("xlink:href","#rapid-logo-walkthrough"),g.append("h2").html(s.tHtml("intro.startediting.start"))}).finally(()=>{h.remove()})}return r.enter=()=>{o=!1,a=null,l(c).catch(h=>{h instanceof Error&&console.error(h)})},r.exit=()=>{i.selectAll(".shaded").remove(),o=!0,a&&(a(),a=null)},xe(r,t,"on")}function EW(n,e){let t=ge("done"),r={title:"intro.rapid.title"},i=n.systems.editor,s=n.systems.l10n,o=n.systems.map,a=n.systems.rapid,l=n.systems.ui,c="w-516",u=new le([-85.62991,41.95568],[-85.627,41.95638]),d=!1,f=null,h=null;function p(){if(!["select","select-osm"].includes(n.mode?.id))return!1;let M=n.selectedIDs();return M.length===1&&M[0]===c}function m(){return i.staging.graph.hasEntity(c)}function g(M){return d?Promise.reject():typeof M!="function"?Promise.resolve():M().then(T=>g(T)).catch(T=>(T instanceof Error&&console.error(T),g(M)))}function y(){n.enter("browse"),i.restoreCheckpoint("initial"),n.scene().enableLayers("rapid"),a.enableDatasets("rapid_intro_graph");let M=u.center(),T=jr(M,o.center());return T>0&&e.hide(),o.setMapParamsAsync(M,18.5,0,T).then(()=>new Promise((R,P)=>{f=P;let D=s.isRTL()?"-rtl":"";e.reveal({revealSelector:".intro-nav-wrap .chapter-rapid",tipHtml:J(n,"intro.rapid.start",{rapid:Ce(`#rapid-logo-rapid-wordmark${D}`,"pre-text rapid")}),buttonText:s.t("intro.ok"),buttonCallback:()=>R(x)})}))}function x(){return new Promise((M,T)=>{f=T;let R=s.isRTL()?"-rtl":"";e.reveal({revealSelector:"button.rapid-features",tipHtml:J(n,"intro.rapid.ai_roads",{rapid:Ce(`#rapid-logo-rapid-wordmark${R}`,"pre-text rapid")}),buttonText:s.t("intro.ok"),buttonCallback:()=>M(b)})})}function b(){return n.enter("browse"),i.restoreCheckpoint("initial"),l.togglePanes(),n.scene().enableLayers("rapid"),a.enableDatasets("rapid_intro_graph"),new Promise((M,T)=>{f=T,h=()=>M(_),H(".inspector-wrap").on("wheel.intro",kr),e.reveal({revealExtent:u,tipHtml:J(n,"intro.rapid.select_road")})}).finally(()=>{h=null,H(".inspector-wrap").on("wheel.intro",null)})}function _(){return Ut().then(()=>new Promise((M,T)=>{if(f=T,!p()){M();return}h=M,e.reveal({revealSelector:".rapid-inspector-choice-accept",tipHtml:J(n,"intro.rapid.add_road")})})).then(()=>i.getUndoAnnotation()?.type==="rapid_accept_feature"?S:b).finally(()=>{h=null})}function S(){return Ut().then(()=>new Promise((M,T)=>{if(f=T,!m()){M(b);return}p()||n.enter("select-osm",{selection:{osm:[c]}}),h=T;let R=s.isRTL()?"-rtl":"";e.reveal({revealExtent:u,tipHtml:J(n,"intro.rapid.add_road_not_saved_yet",{rapid:Ce(`#rapid-logo-rapid-wordmark${R}`,"pre-text rapid")}),buttonText:s.t("intro.ok"),buttonCallback:()=>M(C)})})).finally(()=>{h=null})}function C(){if(!m())return Promise.resolve(b);p()||n.enter("select-osm",{selection:{osm:[c]}});let M=H("div.map-control.issues-control > button");return new Promise((T,R)=>{f=R,h=R,e.reveal({revealNode:M.node(),tipHtml:J(n,"intro.rapid.open_issues")}),M.on("click.intro",()=>T(k))}).finally(()=>{h=null,M.on("click.intro",null)})}function k(){return Ut().then(()=>new Promise((M,T)=>{if(f=T,!m()){M(b);return}p()||n.enter("select-osm",{selection:{osm:[c]}});let R=H("li.issue.severity-warning");e.reveal({revealNode:R.node(),revealPadding:5,tipHtml:J(n,"intro.rapid.new_lints"),buttonText:s.t("intro.ok"),buttonCallback:()=>M(v)})}))}function v(){if(!m())return Promise.resolve(b);p()||n.enter("select-osm",{selection:{osm:[c]}});let M=H(".map-toolbar button.undo-button");return new Promise((T,R)=>{f=R,e.reveal({revealNode:M.node(),tipHtml:J(n,"intro.rapid.undo_road_add",{button:Ce("#rapid-icon-undo","inline")})}),M.on("click.intro",()=>T(w))}).finally(()=>{M.on("click.intro",null)})}function w(){return m()?Promise.resolve(b):(l.togglePanes(),new Promise((M,T)=>{f=T,e.reveal({revealExtent:u,tipHtml:J(n,"intro.rapid.undo_road_add_aftermath"),buttonText:s.t("intro.ok"),buttonCallback:()=>M(A)})}))}function A(){n.enter("browse"),i.restoreCheckpoint("initial"),n.scene().enableLayers("rapid"),a.enableDatasets("rapid_intro_graph");let M=u.center(),T=jr(M,o.center());return T>0&&e.hide(),o.setMapParamsAsync(M,18.5,0,T).then(()=>new Promise((R,P)=>{f=P,h=()=>{n.selectedIDs().includes(c)&&R(E)},e.reveal({revealExtent:u,tipHtml:J(n,"intro.rapid.select_road_again")})})).finally(()=>{h=null})}function E(){return Ut().then(()=>new Promise((M,T)=>{if(f=T,!p()){M();return}h=M,e.reveal({revealSelector:".rapid-inspector-choice-ignore",tipHtml:J(n,"intro.rapid.ignore_road")})})).then(()=>i.getUndoAnnotation()?.type==="rapid_ignore_feature"?I:A).finally(()=>{h=null})}function I(){return t.call("done"),e.reveal({revealSelector:".ideditor",tipSelector:".intro-nav-wrap .chapter-startEditing",tipHtml:J(n,"intro.rapid.done",{next:s.t("intro.startediting.title")}),buttonText:s.t("intro.ok"),buttonCallback:()=>e.reveal({revealSelector:".ideditor"})}),Promise.resolve()}return r.enter=()=>{n.scene().enableLayers("rapid"),d=!1,f=null,h=null,n.on("modechange",M),g(y).catch(T=>{T instanceof Error&&console.error(T)}).finally(()=>{n.off("modechange",M)});function M(...T){typeof h=="function"&&h(...T)}},r.exit=()=>{n.scene().disableLayers("rapid"),a.disableDatasets("rapid_intro_graph"),d=!0,f&&(f(),f=null)},r.restart=()=>{r.exit(),r.enter()},xe(r,t,"on")}var Yie={welcome:bW,navigation:_W,point:vW,area:wW,line:SW,building:CW,rapid:EW,startEditing:AW},a5=["welcome","navigation","point","area","line","building","rapid","startEditing"];function co(n,e){let t=n.systems.assets,r=n.systems.editor,i=n.systems.imagery,s=n.systems.l10n,o=n.systems.map,a=n.services.mapwithai,l=n.services.osm,c=n.systems.rapid,u=n.systems.storage,d=n.systems.urlhash,f=n.systems.ui,h={},p={},m={},g=[],y,x,b,_;function S(w){Promise.all([t.loadAssetAsync("intro_rapid_graph"),t.loadAssetAsync("intro_graph")]).then(A=>{let E=A[0].introRapidGraph,I=A[1].introGraph;for(let[M,T]of Object.entries(E))p[M]||(p[M]=me(hP(n,T)));for(let[M,T]of Object.entries(I))h[M]||(h[M]=me(hP(n,T)));w.call(C)})}function C(w){d.pause(),l?.pause(),a?.pause(),n.container().classed("inIntro",!0),n.inIntro=!0,n.enter("browse"),m={hash:window.location.hash,transform:n.viewport.transform.props,brightness:i.brightness,baseLayer:i.baseLayerSource(),overlayLayers:i.overlayLayerSources(),layersEnabled:new Set,datasetsAdded:new Set(c._addedDatasetIDs),datasetsEnabled:new Set(c._enabledDatasetIDs),edits:r.toJSON()};for(let[T,R]of n.scene().layers)R.enabled&&m.layersEnabled.add(T);n.scene().onlyLayers(["background","osm","labels"]),c.removeDatasets(c._addedDatasetIDs),c.addDatasets("rapid_intro_graph");let A=i.getSourceByID("Bing");i.baseLayerSource(A),m.overlayLayers.forEach(T=>i.toggleOverlayLayer(T)),i.brightness=1,f.Sidebar.expand(!1),b=new p_(n),w.call(b.enable),u.setItem("walkthrough_started","yes"),g=(u.getItem("walkthrough_progress")||"").split(";").filter(Boolean);let I=a5.map((T,R)=>{let P=Yie[T](n,b).on("done",()=>{if(x.filter(D=>D.title===P.title).classed("finished",!0),g.push(T),u.setItem("walkthrough_progress",Ge(g).join(";")),R<a5.length-1){let D=a5[R+1];n.container().select(`button.chapter-${D}`).classed("next",!0)}else v()});return P});_=w.append("div").attr("class","intro-nav-wrap fillD"),_.append("svg").attr("class","intro-nav-wrap-logo").append("use").attr("xlink:href","#rapid-logo-walkthrough"),x=_.append("div").attr("class","joined").selectAll("button.chapter").data(I).enter().append("button").attr("class",(T,R)=>`chapter chapter-${a5[R]}`).on("click",k),x.append("span").text(T=>s.t(T.title)),x.append("span").attr("class","status").call(X(s.isRTL()?"#rapid-icon-backward":"#rapid-icon-forward","inline")),n.resetAsync().then(()=>{r.merge(Object.values(h)),a?.merge("rapid_intro_graph",Object.values(p)),r.setCheckpoint("initial"),k(null,I[e?6:0])})}function k(w,A){y&&y.exit(),n.enter("browse"),y=A,y.enter(),x.classed("next",!1).classed("active",E=>E.title===y.title)}function v(){an(a5,g).length||u.setItem("walkthrough_completed","yes"),c.removeDatasets("rapid_intro_graph"),c.addDatasets(m.datasetsAdded),c.enableDatasets(m.datasetsEnabled),b.disable(),_.remove();for(let[A,E]of n.scene().layers)E.enabled=m.layersEnabled.has(A);i.baseLayerSource(m.baseLayer),m.overlayLayers.forEach(A=>i.toggleOverlayLayer(A)),i.brightness=m.brightness,o.transform(m.transform),window.location.replace(m.hash),n.container().classed("inIntro",!1),n.inIntro=!1,l?.resume(),a?.resume(),d.resume(),n.resetAsync().then(()=>m.edits?r.fromJSONAsync(m.edits):Promise.resolve())}return S}var uo=class{constructor(e){this.context=e,this._isVisible=!1,this.$parent=null,this.$wrap=null,this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.toggle=this.toggle.bind(this)}get visible(){return this._isVisible}show(e){if(e&&e.preventDefault(),this._isVisible){this.render();return}this._isVisible=!0,this.render(),this.$wrap&&this.$wrap.interrupt().style("display",null).style("opacity","0").transition().duration(200).style("opacity","1")}hide(e){e&&e.preventDefault(),this.$wrap&&this._isVisible&&(this._isVisible=!1,this.$wrap.interrupt().transition().duration(200).style("opacity","0").on("end",()=>this.$wrap.style("display","none")))}toggle(e){this._isVisible?this.hide(e):this.show(e)}};var TW=["zoom","vintage","source","description","resolution","accuracy"],l5=class extends uo{constructor(e){super(e),this.id="background";let t=e.systems.l10n,r=e.systems.map;this._currSourceID=null,this._metadata={},this._keys=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this.updateMetadata=this.updateMetadata.bind(this),this.deferredRender=Xt(this.rerender,250),this.deferredUpdateMetadata=Xt(this.updateMetadata,250),this._setupKeybinding=this._setupKeybinding.bind(this),r.on("draw",this.deferredRender).on("move",this.deferredUpdateMetadata),t.on("localechange",this._setupKeybinding),this._setupKeybinding()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;if(!this.visible)return;let t=this.context,r=t.systems.imagery,i=t.systems.l10n,s=e.selectAll(".card-container").data([this.id],h=>h),o=s.enter().append("div").attr("class",h=>`fillD2 card-container card-container-${h}`),a=o.append("div").attr("class","fillD2 card-title");a.append("h3"),a.append("button").attr("class","close").on("click",this.toggle).call(X("#rapid-icon-close")),o.append("div").attr("class",h=>`card-content card-content-${h}`),this.$wrap=s=s.merge(o),s.selectAll("h3").text(i.t("info_panels.background.title"));let l=s.selectAll(".card-content"),c=r.baseLayerSource(),u=c?.key;if(!c)return;this._currSourceID!==u&&(this._currSourceID=u,this._metadata={}),l.html("");let d=l.append("ul").attr("class","background-info");d.append("li").text(c.name),c.id==="EsriWayback"&&d.append("li").text(i.t("background.wayback.date")+":").append("span").text(c.date||i.t("inspector.unknown")),TW.forEach(h=>{d.append("li").attr("class",`background-info-list-${h}`).classed("hide",!this._metadata[h]).text(i.t(`info_panels.background.${h}`)+":").append("span").attr("class",`background-info-span-${h}`).text(this._metadata[h])}),this.deferredUpdateMetadata();let f=t.getDebug("tile")?"hide_tiles":"show_tiles";l.append("a").text(i.t(`info_panels.background.${f}`)).attr("href","#").attr("class","button button-toggle-tiles").on("click",h=>{h.preventDefault(),t.setDebug("tile",!t.getDebug("tile")),this.render()})}updateMetadata(){if(!this.visible||!this.$wrap)return;let e=this.context,t=e.systems.imagery,r=e.systems.l10n,i=e.viewport,s=this.$wrap.selectAll(".card-content"),o=t.baseLayerSource(),a=o?.key;if(!o)return;this._currSourceID!==a&&(this._currSourceID=a,this._metadata={});let l=i.centerLoc(),c=new le(l),d=e.scene().layers.get("background")?._tileMaps.get(a),f,h;if(d){for(let m of d.values())if(m.loaded&&m.wgs84Extent.contains(c)){f=m.xyz,h=m.xyz[2];break}}let p=h||Math.floor(i.transform.zoom);this._metadata.zoom=String(p),s.selectAll(".background-info-list-zoom").classed("hide",!1).selectAll(".background-info-span-zoom").text(this._metadata.zoom),f&&o.getMetadata(l,f,(m,g)=>{if(m||this._currSourceID!==a)return;let y=g.vintage;this._metadata.vintage=y?.range||r.t("inspector.unknown"),s.selectAll(".background-info-list-vintage").classed("hide",!1).selectAll(".background-info-span-vintage").text(this._metadata.vintage),TW.forEach(x=>{if(x==="zoom"||x==="vintage")return;let b=g[x];this._metadata[x]=b,s.selectAll(`.background-info-list-${x}`).classed("hide",!b).selectAll(`.background-info-span-${x}`).text(b)})})}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys),this._keys=[Te("\u2318\u21E7"+r.t("shortcuts.command.toggle_background_card.key"))],e.keybinding().on(this._keys,this.toggle)}};var c5=class extends uo{constructor(e){super(e),this.id="history";let t=e.systems.l10n,r=e.systems.map;this._keys=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this.deferredRender=Xt(this.rerender,250),this.renderEntity=this.renderEntity.bind(this),this.renderNote=this.renderNote.bind(this),this.renderUser=this.renderUser.bind(this),this.renderChangeset=this.renderChangeset.bind(this),this.displayTimestamp=this.displayTimestamp.bind(this),this._setupKeybinding=this._setupKeybinding.bind(this),r.on("draw",this.deferredRender),e.on("modechange",this.rerender),t.on("localechange",this._setupKeybinding),this._setupKeybinding()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;if(!this.visible)return;let t=this.context,r=t.systems.editor.staging.graph,i=t.systems.l10n,s=e.selectAll(".card-container").data([this.id],h=>h),o=s.enter().append("div").attr("class",h=>`fillD2 card-container card-container-${h}`),a=o.append("div").attr("class","fillD2 card-title");a.append("h3"),a.append("button").attr("class","close").on("click",this.toggle).call(X("#rapid-icon-close")),o.append("div").attr("class",h=>`card-content card-content-${h}`),this.$wrap=s=s.merge(o),s.selectAll("h3").text(i.t("info_panels.history.title"));let l=s.selectAll(".card-content");l.html("");let c,u,d;c=t.selectedIDs().filter(h=>r.hasEntity(h)),c.length&&(d=r.entity(c[0]));let f=c.length===1?c[0]:null;l.append("h4").attr("class","history-heading").text(f||i.t("info_panels.selected",{n:c.length})),f&&(d?l.call(this.renderEntity,d):u&&l.call(this.renderNote,u))}renderNote(e,t){let r=this.context,i=r.systems.l10n,s=r.services.osm;if(!t||t.isNew()){e.append("div").text(i.t("info_panels.history.note_no_history"));return}let o=e.append("ul");o.append("li").text(i.t("info_panels.history.note_comments")+":").append("span").text(t.comments.length),t.comments.length&&(o.append("li").text(i.t("info_panels.history.note_created_date")+":").append("span").text(this.displayTimestamp(t.comments[0].date)),o.append("li").text(i.t("info_panels.history.note_created_user")+":").call(this.renderUser,t.comments[0].user)),s&&e.append("a").attr("class","view-history-on-osm").attr("target","_blank").attr("href",s.noteURL(t)).call(X("#rapid-icon-out-link","inline")).append("span").text(i.t("info_panels.history.note_link_text"))}renderEntity(e,t){let r=this.context,i=r.systems.l10n,s=r.services.osm;if(!t||t.isNew()){e.append("div").text(i.t("info_panels.history.no_history"));return}let o=e.append("div").attr("class","links");s&&o.append("a").attr("class","view-history-on-osm").attr("href",s.historyURL(t)).attr("target","_blank").attr("title",i.t("info_panels.history.link_text")).text("OSM"),o.append("a").attr("class","pewu-history-viewer-link").attr("href","https://pewu.github.io/osm-history/#/"+t.type+"/"+t.osmId()).attr("target","_blank").attr("tabindex",-1).text("PeWu");let a=e.append("ul");a.append("li").text(i.t("info_panels.history.version")+":").append("span").text(t.version),a.append("li").text(i.t("info_panels.history.last_edit")+":").append("span").text(this.displayTimestamp(t.timestamp)),a.append("li").text(i.t("info_panels.history.edited_by")+":").call(this.renderUser,t.user),a.append("li").text(i.t("info_panels.history.changeset")+":").call(this.renderChangeset,t.changeset)}displayTimestamp(e){let t=this.context,r=t.systems.l10n;if(!e)return r.t("inspector.unknown");let i={day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},s=new Date(e);if(isNaN(s.getTime()))return r.t("inspector.unknown");let o=t.systems.l10n.localeCode();return s.toLocaleString(o,i)}renderUser(e,t){let r=this.context,i=r.systems.l10n,s=r.services.osm;if(!t){e.append("span").text(i.t("inspector.unknown"));return}e.append("span").attr("class","user-name").text(t);let o=e.append("div").attr("class","links");s&&o.append("a").attr("class","user-osm-link").attr("href",s.userURL(t)).attr("target","_blank").text("OSM"),o.append("a").attr("class","user-hdyc-link").attr("href",`https://hdyc.neis-one.org/?${t}`).attr("target","_blank").attr("tabindex",-1).text("HDYC")}renderChangeset(e,t){let r=this.context,i=r.systems.l10n,s=r.services.osm;if(!t){e.append("span").text(i.t("inspector.unknown"));return}e.append("span").attr("class","changeset-id").text(t);let o=e.append("div").attr("class","links");s&&o.append("a").attr("class","changeset-osm-link").attr("href",s.changesetURL(t)).attr("target","_blank").text("OSM"),o.append("a").attr("class","changeset-osmcha-link").attr("href",`https://osmcha.org/changesets/${t}`).attr("target","_blank").text("OSMCha"),o.append("a").attr("class","changeset-achavi-link").attr("href",`https://overpass-api.de/achavi/?changeset=${t}`).attr("target","_blank").text("Achavi")}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys),this._keys=[Te("\u2318\u21E7"+r.t("shortcuts.command.toggle_history_card.key"))],e.keybinding().on(this._keys,this.toggle)}};var u5=class extends uo{constructor(e){super(e),this.id="location";let t=e.systems.gfx.events,r=e.systems.l10n;this._currLocation=null,this._keys=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this.updateLocation=this.updateLocation.bind(this),this._deferredUpdateLocation=Xt(this.updateLocation,1e3),this._setupKeybinding=this._setupKeybinding.bind(this),t.on("pointermove",this.rerender),r.on("localechange",this._setupKeybinding),this._setupKeybinding()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;if(!this.visible)return;let t=this.context,r=t.systems.l10n,s=t.systems.map.mouseLoc(),o=e.selectAll(".card-container").data([this.id],d=>d),a=o.enter().append("div").attr("class",d=>`fillD2 card-container card-container-${d}`),l=a.append("div").attr("class","fillD2 card-title");l.append("h3"),l.append("button").attr("class","close").on("click",this.toggle).call(X("#rapid-icon-close")),a.append("div").attr("class",d=>`card-content card-content-${d}`),this.$wrap=o=o.merge(a),o.selectAll("h3").text(r.t("info_panels.location.title"));let c=o.selectAll(".card-content");c.html(""),c.append("ul").append("li").text(r.dmsCoordinatePair(s)).append("li").text(r.decimalCoordinatePair(s)),c.append("div").attr("class","location-info").text(this._currLocation||" "),this._deferredUpdateLocation(s)}updateLocation(e){if(!this.visible||!this.$wrap)return;let t=this.context,r=t.systems.l10n,i=t.services.nominatim,s=this.$wrap.selectAll(".card-content");i?i.reverse(e,(o,a)=>{this._currLocation=a?a.display_name:r.t("info_panels.location.unknown_location"),s.selectAll(".location-info").text(this._currLocation)}):(this._currLocation=r.t("info_panels.location.unknown_location"),s.selectAll(".location-info").text(this._currLocation))}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys),this._keys=[Te("\u2318\u21E7"+r.t("shortcuts.command.toggle_location_card.key"))],e.keybinding().on(this._keys,this.toggle)}};function Kie(n){return n*63710071809e-4}function Qie(n){return n/(4*Math.PI)*510065621724e3}function Zie(n){if(n.type==="LineString")return n;let e={type:"LineString",coordinates:[]};return n.type==="Polygon"?e.coordinates=n.coordinates[0]:n.type==="MultiPolygon"&&(e.coordinates=n.coordinates[0][0]),e}var d5=class extends uo{constructor(e){super(e),this.id="measurement";let t=e.systems.l10n,r=e.systems.map;this._isImperial=!t.isMetric(),this._keys=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this._setupKeybinding=this._setupKeybinding.bind(this),r.on("draw",this.rerender),e.on("modechange",this.rerender),t.on("localechange",this._setupKeybinding),this._setupKeybinding()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;if(!this.visible)return;let t=this.context,r=t.systems.l10n,i=t.systems.editor.staging.graph,s=r.localeCode(),o=e.selectAll(".card-container").data([this.id],A=>A),a=o.enter().append("div").attr("class",A=>`fillD2 card-container card-container-${A}`),l=a.append("div").attr("class","fillD2 card-title");l.append("h3"),l.append("button").attr("class","close").on("click",this.toggle).call(X("#rapid-icon-close")),a.append("div").attr("class",A=>`card-content card-content-${A}`),this.$wrap=o=o.merge(a),o.selectAll("h3").text(r.t("info_panels.measurement.title"));let c=o.selectAll(".card-content");c.html("");let u,d,f,h,p,m,g,y=0,x=0,b,_=t.selectedIDs(),S=t.selectedData(),[C]=S.values(),k=C instanceof Qe&&C.service==="osm";if(S.size===1&&k){let A=C;u=r.t("note.note")+" "+A.id,f=A.loc,m="note"}else{let A=_.map(E=>i.hasEntity(E)).filter(Boolean);if(A.length===1?u=A[0].id:u=r.t("info_panels.selected",{n:A.length}),A.length>0){let E=new le;A.forEach(I=>{let M=I.extent(i),T=I.asGeoJSON(i);E=E.extend(M),m=I.geometry(i),(m==="line"||m==="area")&&(p=I.type==="relation"||I.isClosed()&&!I.isDegenerate(),y+=Kie(Ov(Zie(T))),h=Fv(T),(!h||!isFinite(h[0])||!isFinite(h[1]))&&(h=M.center()),p&&(x+=Qie(I.area(i))))}),A.length>1&&(m=null,p=null,h=null),A.length===2&&A[0].type==="node"&&A[1].type==="node"&&(b=ht(A[0].loc,A[1].loc)),A.length===1&&A[0].type==="node"?f=A[0].loc:g=Ht(_,i).length,!f&&!h&&(d=E.center())}}u&&c.append("h4").attr("class","measurement-heading").text(u);let v=c.append("ul"),w;if(m&&v.append("li").text(r.t("info_panels.measurement.geometry")+":").append("span").text(p?r.t("info_panels.measurement.closed_"+m):r.t("geometry."+m)),g&&v.append("li").text(r.t("info_panels.measurement.node_count")+":").append("span").text(g.toLocaleString(s)),x&&v.append("li").text(r.t("info_panels.measurement.area")+":").append("span").text(r.displayArea(x,this._isImperial)),y&&v.append("li").text(r.t("info_panels.measurement."+(p?"perimeter":"length"))+":").append("span").text(r.displayLength(y,this._isImperial)),typeof b=="number"&&v.append("li").text(r.t("info_panels.measurement.distance")+":").append("span").text(r.displayLength(b,this._isImperial)),f&&(w=v.append("li").text(r.t("info_panels.measurement.location")+":"),w.append("span").text(r.dmsCoordinatePair(f)),w.append("span").text(r.decimalCoordinatePair(f))),h&&(w=v.append("li").text(r.t("info_panels.measurement.centroid")+":"),w.append("span").text(r.dmsCoordinatePair(h)),w.append("span").text(r.decimalCoordinatePair(h))),d&&(w=v.append("li").text(r.t("info_panels.measurement.center")+":"),w.append("span").text(r.dmsCoordinatePair(d)),w.append("span").text(r.decimalCoordinatePair(d))),y||x||typeof b=="number"){let A=this._isImperial?"imperial":"metric";c.append("a").text(r.t(`info_panels.measurement.${A}`)).attr("href","#").attr("class","button button-toggle-units").on("click",E=>{E.preventDefault(),this._isImperial=!this._isImperial,this.render()})}}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys),this._keys=[Te("\u2318\u21E7"+r.t("shortcuts.command.toggle_measurement_card.key"))],e.keybinding().on(this._keys,this.toggle)}};var wf=class{constructor(e){this.context=e,this._wasVisible=new Set,this._keys=null,this.BackgroundCard=new l5(e),this.HistoryCard=new c5(e),this.LocationCard=new u5(e),this.MeasurementCard=new d5(e),this.cards=[this.BackgroundCard,this.HistoryCard,this.LocationCard,this.MeasurementCard],this.$parent=null,this.render=this.render.bind(this),this.toggle=this.toggle.bind(this),this._setupKeybinding=this._setupKeybinding.bind(this),e.systems.l10n.on("localechange",this._setupKeybinding),this._setupKeybinding()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=e.selectAll(".info-cards").data([0]),r=t.enter().append("div").attr("class","info-cards");t=t.merge(r);for(let i of this.cards)t.call(i.render)}toggle(e){e&&e.preventDefault();let t=new Set;for(let r of this.cards)r.visible&&t.add(r);if(t.size){this._wasVisible=t;for(let r of t)r.hide(e)}else{this._wasVisible.size||this._wasVisible.add(this.MeasurementCard);for(let r of this._wasVisible)r.show(e)}this.render()}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys),this._keys=[Te("\u2318"+r.t("shortcuts.command.toggle_all_cards.key"))],e.keybinding().on(this._keys,this.toggle)}};function Ji(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=n.systems.map,o=n.systems.storage,a=n.viewport,l=e.map(m=>r.hasEntity(m)).filter(Boolean),c=l.every(m=>m.isNew()),u=pa(e),f=Ht(e,r).map(m=>m.loc),h=Mt(l,r),p=function(){let m=t.staging.graph,g,y;if(l.length===1){let b=l[0],_=b.geometry(m),C=m.parentWays(b)[0];if(_==="vertex"){let k=C.nodes,v=k.indexOf(b.id);if(v===0)v++;else if(v===k.length-1)v--;else{let w=ht(b.loc,m.entity(k[v-1]).loc),A=ht(b.loc,m.entity(k[v+1]).loc);v=w<A?v-1:v+1}g=m.entity(k[v]),y=g.loc}}let x=p.annotation();t.perform(u),t.commit({annotation:x,selectedIDs:e}),g&&y?(s.centerEase(y),n.enter("select-osm",{selection:{osm:[g.id]}})):n.enter("browse")};return p.available=function(){return!0},p.disabled=function(){let m=t.staging.graph;if(!c&&g())return"too_large";if(!c&&y())return"not_downloaded";if(e.some(n.hasHiddenConnections))return"connected_to_hidden";if(e.some(_))return"part_of_relation";if(e.some(b))return"incomplete_relation";if(e.some(x))return"has_wikidata_tag";return!1;function g(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&h.percentContainedIn(a.visibleExtent())<.8}function y(){if(n.inIntro)return!1;let S=n.services.osm;if(S){let C=f.filter(k=>!S.isDataLoaded(k));if(C.length)return C.forEach(k=>n.loadTileAtLoc(k)),!0}return!1}function x(S){let C=m.entity(S);return C.tags.wikidata&&C.tags.wikidata.trim().length>0}function b(S){let C=m.entity(S);return C.type==="relation"&&!C.isComplete(m)}function _(S){let C=m.entity(S);if(C.type!=="way")return!1;let k=m.parentRelations(C);for(let v of k){let w=v.tags.type,A=v.memberById(S).role||"outer";if(w==="route"||w==="boundary"||w==="multipolygon"&&A==="outer")return!0}return!1}},p.tooltip=function(){let m=p.disabled();return m?i.t(`operations.delete.${m}`,{n:e.length}):i.t("operations.delete.description",{n:e.length})},p.annotation=function(){let m=t.staging.graph;return e.length===1?i.t("operations.delete.annotation."+m.geometry(e[0])):i.t("operations.delete.annotation.feature",{n:e.length})},p.id="delete",p.keys=[Te("\u2318\u232B"),Te("\u2318\u2326"),Te("\u2326")],p.title=i.t("operations.delete.title"),p.behavior=new Pt(n,p),p}function m_(n){let e=n.systems.editor,t=n.systems.l10n,r=n.systems.filters,i=n.systems.presets,s=ge("cancel","choose"),o=null,a=[],l=null,c=[],u=null,d=null,f=new Set,h=!1,p=H(null),m=H(null);function g(k){if(o=k,!a.length)return;let v=t.isRTL(),w=k.selectAll(".header").data([0]),A=w.enter().append("div").attr("class","header fillL");A.append("h3").attr("class","preset-list-message").text(t.t("inspector.choose")),A.append("button").attr("class","preset-choose").on("click",function(){s.call("cancel",this)}).call(X(v?"#rapid-icon-backward":"#rapid-icon-forward"));let E=w.merge(A).selectAll(".preset-list-message"),I=k.selectAll(".search-header").data([0]),M=I.enter().append("div").attr("class","search-header");M.call(X("#rapid-icon-search")),M.append("input").attr("class","preset-search-input").attr("placeholder",t.t("inspector.search")).attr("type","search").call(Oe).on("keydown",P).on("keypress",N).on("input",Xt(F)),I=I.merge(M),m=I.selectAll(".preset-search-input"),h&&setTimeout(()=>m.node().focus(),0);let T=k.selectAll(".inspector-body").data([0]),R=T.enter().append("div").attr("class","inspector-body");R.append("div").attr("class","preset-list-main preset-list"),p=T.merge(R).selectAll(".preset-list-main").call(y,d),r.off("filterchange",S),r.on("filterchange",S);function P(B){let O=m.property("value");O.length===0&&(B.keyCode===Xe.keyCodes["\u232B"]||B.keyCode===Xe.keyCodes["\u2326"])?(B.preventDefault(),B.stopPropagation(),Ji(n,a)()):O.length===0&&(B.ctrlKey||B.metaKey)&&B.keyCode===Xe.keyCodes.z?(B.preventDefault(),B.stopPropagation(),e.undo()):!B.ctrlKey&&!B.metaKey&&(H(this).on("keydown",D),D.call(this,B))}function D(B){if(B.keyCode===Xe.keyCodes["\u2193"]&&m.node().selectionStart===m.property("value").length){B.preventDefault(),B.stopPropagation();let O=p.selectAll(".preset-list-button");O.empty()||O.node().focus()}}function N(B){let O=B.currentTarget.value;B.keyCode===13&&O.length&&p.selectAll(".preset-list-item:first-child").datum().choose()}function F(){let B=m.property("value");p.classed("filtered",B.length);let O=c[0],G,U;B.length?(G=u.search(B,O,l),U=t.t("inspector.results",{n:G.array.length,search:B})):(G=d,U=t.t("inspector.choose")),p.call(y,G),E.text(U)}}function y(k,v){let w=[];for(let I of v.array)I&&(I.members?w.push(new b(I)):w.push(new _(I)));let A=k.selectAll(":scope > .preset-list-item").data(w,I=>I.preset.id);A.exit().remove();let E=A.enter().append("div").attr("class",I=>`preset-list-item preset-${I.preset.safeid}`).style("opacity",0).transition().style("opacity",1);A=A.merge(E).order().each((I,M,T)=>H(T[M]).call(I.render)).classed("current",I=>f.has(I.preset.id)),S()}function x(k){let v=k.currentTarget,w=H(v),A=H(v.closest(".preset-list-item")),E=A.node(),I=H(E.parentNode.closest(".preset-list-item")),M=I.node(),T=t.isRTL();if(k.keyCode===Xe.keyCodes["\u2193"]){k.preventDefault(),k.stopPropagation();let R=H(E.nextElementSibling);R.empty()?M&&(R=H(M.nextElementSibling)):w.classed("expanded")&&(R=A.select(".subgrid .preset-list-item:first-child")),R.empty()||R.select(".preset-list-button").node().focus()}else if(k.keyCode===Xe.keyCodes["\u2191"]){k.preventDefault(),k.stopPropagation();let R=H(E.previousElementSibling);R.empty()?I.empty()||(R=I):R.select(".preset-list-button").classed("expanded")&&(R=R.select(".subgrid .preset-list-item:last-child")),R.empty()?m.node().focus():R.select(".preset-list-button").node().focus()}else k.keyCode===Xe.keyCodes[T?"\u2192":"\u2190"]?(k.preventDefault(),k.stopPropagation(),I.empty()||I.select(".preset-list-button").node().focus()):k.keyCode===Xe.keyCodes[T?"\u2190":"\u2192"]&&(k.preventDefault(),k.stopPropagation(),A.datum().choose())}class b{constructor(v){this.box=null,this.sublist=null,this.shown=!1,this.preset=v,this.choose=this.choose.bind(this),this.render=this.render.bind(this),this._click=this._click.bind(this),this._keydown=this._keydown.bind(this)}render(v){let w=this.preset,A=t.isRTL();v.selectAll(":scope > .preset-list-button-wrap").data([this],T=>T.preset.id).enter().append("div").attr("class","preset-list-button-wrap category").append("button").attr("class","preset-list-button").classed("expanded",!1).call(O1(n).geometry(c.length===1&&c[0]).preset(w)).on("click",this._click).on("keydown",this._keydown).append("div").attr("class","label").append("div").attr("class","label-inner").append("div").attr("class","namepart").call(X(A?"#rapid-icon-backward":"#rapid-icon-forward","inline")).append("span").html(()=>w.nameLabel()+"&hellip;"),this.box=v.append("div").attr("class","subgrid").style("max-height","0px").style("opacity",0),this.box.append("div").attr("class","arrow"),this.sublist=this.box.append("div").attr("class","preset-list preset-list-sub fillL3")}_keydown(v){let w=t.isRTL(),A=v.currentTarget,E=H(A);v.keyCode===Xe.keyCodes[w?"\u2190":"\u2192"]?(v.preventDefault(),v.stopPropagation(),E.classed("expanded")||this._click(v)):v.keyCode===Xe.keyCodes[w?"\u2192":"\u2190"]?(v.preventDefault(),v.stopPropagation(),E.classed("expanded")&&this._click(v)):x(v)}_click(v){let w=t.isRTL(),A=v.currentTarget,E=H(A),I=E.classed("expanded"),M=I?w?"#rapid-icon-backward":"#rapid-icon-forward":"#rapid-icon-down";E.classed("expanded",!I),E.selectAll("div.label-inner svg.icon use").attr("href",M),this.choose()}choose(){if(!(!this.box||!this.sublist))if(this.shown)this.shown=!1,this.box.transition().duration(200).style("opacity","0").style("max-height","0px").style("padding-bottom","0px");else{this.shown=!0;let v=this.preset.members.matchAllGeometry(c);this.sublist.call(y,v),this.box.transition().duration(200).style("opacity","1").style("max-height",200+v.array.length*190+"px").style("padding-bottom","10px")}}}class _{constructor(v){this.preset=v,this.reference=Jo(n,v.reference()),this.choose=this.choose.bind(this),this.render=this.render.bind(this)}render(v){let w=this.preset,A=v.selectAll(".preset-list-button-wrap").data([this],T=>T.preset.id).enter().append("div").attr("class","preset-list-button-wrap"),I=A.append("button").attr("class","preset-list-button").call(O1(n).geometry(c.length===1&&c[0]).preset(w)).on("click",this.choose).on("keydown",x).append("div").attr("class","label").append("div").attr("class","label-inner"),M=[w.nameLabel(),w.subtitleLabel()].filter(Boolean);I.selectAll(".namepart").data(M).enter().append("div").attr("class","namepart").html(T=>T),A.call(this.reference.button),v.call(this.reference.body)}choose(){let v=this.preset;n.inIntro||i.setMostRecent(v);let w=A=>{for(let E of a){let I=i.match(A.entity(E),A);A=ti(E,I,v)(A)}return A};e.perform(w),e.commit({annotation:t.t("operations.change_tags.annotation"),selectedIDs:a}),s.call("choose",this,v)}}function S(){let k=e.staging.graph;if(!a.every(w=>k.hasEntity(w)))return;let v=p.selectAll(".preset-list-button");v.call(de(n).destroyAny),v.each((w,A,E)=>{let I=H(E[A]),M;for(let R of c)if(M=r.isHiddenPreset(w.preset,R),M)break;let T=M&&!n.inIntro&&!f.has(w.preset.id);I.classed("disabled",T),T&&I.call(de(n).title(t.t("filters.hidden_preset.manual",{features:t.t(`filters.${M}.description`)})).placement(A<2?"bottom":"top"))})}g.autofocus=function(k){return arguments.length?(h=k,g):h},g.entityIDs=function(k){if(!arguments.length)return a;if(a=k??[],l=null,c=[],u=null,d=null,f=new Set,m.property("value",""),p.selectAll(".preset-list-item").remove(),a.length){let v=e.staging.graph;l=Mt(a,v).center(),c=C(),u=i.matchAllGeometry(c),d=i.defaults(c[0],36,!n.inIntro,l);for(let w of a){let A=i.match(v.entity(w),v);A&&f.add(A.id)}}if(o){let v=o.selectAll(".inspector-body").node();v&&v.scroll(0,0)}return g},g.selected=function(k){if(!arguments.length)return f;if(f=new Set,Array.isArray(k))for(let v of k)v?.id&&f.add(v.id);return g};function C(){let k=e.staging.graph,v={};for(let w of a){let A=k.entity(w),E=A.geometry(k);E==="vertex"&&A.isOnAddressLine(k)&&(E="point"),v[E]||(v[E]=0),v[E]+=1}return Object.keys(v).sort((w,A)=>v[A]-v[w])}return xe(g,s,"on")}var Sf=class{constructor(e){this.context=e,this.PresetList=m_(e),this.EntityEditor=l_(e),this.ViewOn=new qn(e),this.$parent=null,this.$inspector=null,this.$paneWrap=null,this.$presetPane=null,this.$editorPane=null,this._state="",this._entityIDs=[],this._newFeature=!1,this.render=this.render.bind(this),this.setPreset=this.setPreset.bind(this),this.showPresetList=this.showPresetList.bind(this),this.showEntityEditor=this.showEntityEditor.bind(this),this._onMerge=this._onMerge.bind(this),e.systems.editor.on("merge",this._onMerge),this.PresetList.on("choose",t=>this.setPreset(t)).on("cancel",()=>this.setPreset()),this.EntityEditor.on("choose",t=>this.showPresetList(t,!0))}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,i=t.systems.editor.staging.graph,s=t.services.osm,o=t.systems.validator,a=this._state,l=this._entityIDs,c=this._newFeature;this.PresetList.entityIDs(l).autofocus(c),this.EntityEditor.state(a).entityIDs(l);let u=e.selectAll(".inspector-wrap").data([0]),d=u.enter().append("div").attr("class","inspector-wrap inspector-hidden");this.$inspector=u=u.merge(d);let f=u.selectAll(".panewrap").data([0]),h=f.enter().append("div").attr("class","panewrap");h.append("div").attr("class","preset-list-pane pane"),h.append("div").attr("class","entity-editor-pane pane"),this.$paneWrap=f=f.merge(h),this.$presetPane=f.selectAll(".preset-list-pane"),this.$editorPane=f.selectAll(".entity-editor-pane"),g()?this.showPresetList():this.showEntityEditor();let p=i.hasEntity(l.length===1&&l[0]);this.ViewOn.stringID="inspector.view_on_osm",this.ViewOn.url=s&&p?s.entityURL(p):"";let m=u.selectAll(".sidebar-footer").data([0]);m.enter().append("div").attr("class","sidebar-footer").merge(m).call(this.ViewOn.render);function g(){if(a!=="select"||l.length!==1)return!1;let y=l[0],x=i.hasEntity(y);return!x||x.hasNonGeometryTags()?!1:c?!0:!(x.geometry(i)!=="vertex"||i.parentRelations(x).length||o.getEntityIssues(y).length||x.isHighwayIntersection(i))}}showPresetList(e,t){let r=this.$paneWrap,i=this.$presetPane,s=this.$editorPane;if(!r||!i||!s)return!1;let c=this.context.systems.l10n.isRTL()?"margin-right":"margin-left";t?r.transition().style(c,"0%"):r.style(c,"0%"),this.PresetList.entityIDs(this._entityIDs).selected(e||[]).autofocus(this._newFeature||t),i.call(this.PresetList)}showEntityEditor(e,t){let r=this.$paneWrap,i=this.$presetPane,s=this.$editorPane;if(!r||!i||!s)return!1;let c=this.context.systems.l10n.isRTL()?"margin-right":"margin-left";t?r.transition().style(c,"-100%"):r.style(c,"-100%"),Array.isArray(e)&&this.EntityEditor.presets(e),this.EntityEditor.state(this._state).entityIDs(this._entityIDs),s.call(this.EntityEditor)}setPreset(e){let t=this.$presetPane;if(!t)return!1;if(e?.id==="type/multipolygon")this.showPresetList();else{let r=e?[e]:null,i=t.select(".preset-search-input").node();i.value="",this.showEntityEditor(r,!0)}}_onMerge(e){if(!(e instanceof Set)||!this._entityIDs.length)return;let t=!1;for(let r of this._entityIDs)if(e.has(r)){t=!0;break}t&&this.render()}state(e){return e===void 0?this._state:(this._state=e,this.EntityEditor.state(this._state),this.context.container().selectAll(".field-help-body").remove(),this)}entityIDs(e){return e===void 0?this._entityIDs:(this._entityIDs=e??[],this)}newFeature(e){return e===void 0?this._newFeature:(this._newFeature=e,this)}};function g_(n){let e=n.systems.editor,t=n.systems.filters,r=n.systems.gfx,i=n.systems.l10n,s=n.systems.map,o=n.systems.presets,a=n.systems.gfx.scene,l;function c(d){let{itemType:f,parentIssueType:h}=d,p=i.t("inspector.unknown"),m=d.replacements||{};m.default=p;let g=i.t(`QA.keepRight.errorTypes.${f}.description`,m);return g===p&&(g=i.t(`QA.keepRight.errorTypes.${h}.description`,m)),g}function u(d){let f=d.selectAll(".error-details").data(l?[l]:[],g=>g.key);f.exit().remove();let p=f.enter().append("div").attr("class","error-details qa-details-container").append("div").attr("class","qa-details-subsection");p.append("h4").text(i.t("QA.keepRight.detail_description")),p.append("div").attr("class","qa-details-description-text").html(c);let m=[];p.selectAll(".error_entity_link, .error_object_link").attr("href","#").each((g,y,x)=>{let b=x[y],_=H(b),S=_.classed("error_object_link"),C=S?l.objectType.charAt(0)+l.objectId:b.textContent,k=e.staging.graph,v=k.hasEntity(C);if(m.push(C),_.on("mouseenter",()=>{Je([C],!0,n)}).on("mouseleave",()=>{Je([C],!1,n)}).on("click",w=>{w.preventDefault(),Je([C],!1,n),a.enableLayers("osm"),s.centerZoomEase(l.loc,20),s.selectEntityID(C)}),v){let w=i.displayName(v.tags);if(!w&&!S){let A=o.match(v,k);w=A&&!A.isFallback()&&A.name()}w&&(b.innerText=w)}}),t.forceVisible(m),r.immediateRedraw()}return u.issue=function(d){return arguments.length?(l=d,u):l},u}function y_(n){let e=n.systems.l10n,t;function r(s){let o=e.t("inspector.unknown"),a=s.replacements||{};a.default=o;let l=e.t(`QA.keepRight.errorTypes.${s.itemType}.title`,a);return l===o&&(l=e.t(`QA.keepRight.errorTypes.${s.parentIssueType}.title`,a)),l}function i(s){let o=16777215,a=n.services.keepRight;a&&(o=a.getColor(t?.parentIssueType));let l=s.selectAll(".qa-header").data(t?[t]:[],u=>u.key);l.exit().remove();let c=l.enter().append("div").attr("class","qa-header");c.append("div").attr("class","qa-header-icon").append("div").attr("class",u=>`qaItem ${u.service}`).call(X("#rapid-icon-bolt")),c.append("div").attr("class","qa-header-label").text(r),c.selectAll(".qaItem svg.icon").attr("stroke","#333").attr("stroke-width","1.3px").attr("color",new ce(o).toHex())}return i.issue=function(s){return arguments.length?(t=s,i):t},i}function Cf(n){let e=n.systems.l10n,t=n.services.keepRight,r=ge("change"),i=g_(n),s=y_(n),o=new qn(n),a;function l(d){let f=d.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");f.append("button").attr("class","close").on("click",()=>n.enter("browse")).call(X("#rapid-icon-close")),f.append("h3").text(e.t("QA.keepRight.title"));let h=d.selectAll(".body").data([0]);h=h.enter().append("div").attr("class","body").merge(h);let p=h.selectAll(".qa-editor").data([0]);p.enter().append("div").attr("class","modal-section qa-editor").merge(p).call(s.issue(a)).call(i.issue(a)).call(c),o.stringID="inspector.view_on_keepRight",o.url=t.issueURL(a);let m=d.selectAll(".sidebar-footer").data([0]);m.enter().append("div").attr("class","sidebar-footer").merge(m).call(o.render)}function c(d){let f=a?.id,h=f&&n.selectedData().has(f),p=a&&(h||a.newComment||a.comment),m=d.selectAll(".qa-save").data(p?[a]:[],x=>x.key);m.exit().remove();let g=m.enter().append("div").attr("class","qa-save save-section cf");g.append("h4").attr("class",".qa-save-header").text(e.t("QA.keepRight.comment")),g.append("textarea").attr("class","new-comment-input").attr("placeholder",e.t("QA.keepRight.comment_placeholder")).attr("maxlength",1e3).property("value",x=>x.newComment||x.comment).call(Oe).on("input",y).on("blur",y),m=g.merge(m).call(u);function y(){let b=H(this).property("value").trim();b===a.comment&&(b=void 0),a=a.update({newComment:b}),t&&t.replaceItem(a),m.call(u)}}function u(d){let f=a?.id,h=f&&n.selectedData().has(f),p=d.selectAll(".buttons").data(h?[a]:[],g=>g.key);p.exit().remove();let m=p.enter().append("div").attr("class","buttons");m.append("button").attr("class","button comment-button action").text(e.t("QA.keepRight.save_comment")),m.append("button").attr("class","button close-button action"),m.append("button").attr("class","button ignore-button action"),p=p.merge(m),p.select(".comment-button").attr("disabled",g=>g.newComment?null:!0).on("click.comment",function(g,y){this.blur(),t&&t.postUpdate(y,(x,b)=>r.call("change",b))}),p.select(".close-button").text(g=>{let y=g.newComment?"_comment":"";return e.t(`QA.keepRight.close${y}`)}).on("click.close",function(g,y){this.blur(),t&&(y.newStatus="ignore_t",t.postUpdate(y,(x,b)=>r.call("change",b)))}),p.select(".ignore-button").text(g=>{let y=g.newComment?"_comment":"";return e.t(`QA.keepRight.ignore${y}`)}).on("click.ignore",function(g,y){this.blur(),t&&(y.newStatus="ignore",t.postUpdate(y,(x,b)=>r.call("change",b)))})}return l.error=function(d){return arguments.length?(a=d,l):a},xe(l,r,"on")}var Af=class{constructor(e){this.context=e,this.$parent=null,this.render=this.render.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let r=this.context.systems.map3d.containerID;e.selectAll(`#${r}`).data([0]).enter().append("div").attr("id",r).style("display","none")}};var f5=class{constructor(e){this.context=e,this.Tooltip=de(e).shortcut("\u21E7 "),this.$parent=null,this.$button=null,this.render=this.render.bind(this),this.resetBearing=this.resetBearing.bind(this),this.updateBearing=this.updateBearing.bind(this),e.systems.map.on("draw",this.updateBearing)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let r=this.context.systems.l10n,i=e.selectAll("button").data([0]),s=i.enter().append("button").attr("class","bearing").on("click",this.resetBearing);s.append("div").attr("class","bearing_n"),s.call(this.Tooltip).call(X("#rapid-icon-compass","light")),this.$button=i=i.merge(s),this.Tooltip.placement(r.isRTL()?"right":"left").title(r.t("bearing.reset_bearing")),this.Tooltip.updateContent(),i.selectAll(".tooltip-keyhint").selectAll(".rotate-the-map").data([0]).enter().insert("div",".tooltip-keys").attr("class","rotate-the-map"),i.selectAll(".tooltip-keys > kbd.shortcut:last-of-type").classed("hide",!0),i.selectAll(".tooltip-keys").call(X("#rapid-interaction-keyboard-arrows-left-right","operation")),i.selectAll(".rotate-the-map").text(r.t("bearing.rotate_the_map")),i.selectAll(".bearing_n").text(r.t("bearing.n")),this.updateBearing()}updateBearing(){let e=this.$button;if(!e)return;let r=this.context.viewport.transform.rotation,i=r===0,s=lr([0,8],r,[0,0]);e.selectAll(".bearing_n").style("transform",`translate(${s[0]}px, ${s[1]}px)`),e.selectAll(":scope > .icon use").style("transform-origin",i?null:"center").style("transform",i?null:`rotate(${r}rad)`)}resetBearing(e){e&&e.preventDefault();let t=this.context,r=t.systems.map,i=t.viewport.transform.props;i.r!==0&&r.transformEase(Object.assign(i,{r:0}))}};var Jie=1e4,ese=2e3,kW={enableHighAccuracy:!1,timeout:6e3},h5=class{constructor(e){this.context=e,this._isSupported=typeof navigator?.geolocation?.getCurrentPosition=="function",this._isActive=!1,this._timeoutID=null,this.Tooltip=de(e),this.Loading=Vo(e).blocking(!0),this.$parent=null,this.$button=null,this.block=this.block.bind(this),this.error=this.error.bind(this),this.render=this.render.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.success=this.success.bind(this),this.toggle=this.toggle.bind(this),this.unblock=this.unblock.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;if(!this._isSupported)return;let r=this.context.systems.l10n,i=e.selectAll("button").data([0]),s=i.enter().append("button").attr("class","geolocate").on("click",this.toggle).call(this.Tooltip).call(X("#rapid-icon-geolocate","light"));this.$button=i=i.merge(s),this.$button.classed("active",this._isActive),this.Tooltip.placement(r.isRTL()?"right":"left").title(r.t("geolocate.title")),this.Loading.message(r.t("geolocate.locating"))}toggle(e){e&&e.preventDefault(),this._isSupported&&(this.context.inIntro||(this._isActive?this.stop(e):this.start(e)))}start(e){e&&e.preventDefault(),this._isSupported&&(this.context.inIntro||this._isActive||(this._isActive=!0,this.$button&&this.$button.classed("active",!0),this.context.enter("browse"),this.block(),navigator.geolocation.getCurrentPosition(this.success,this.error,kW)))}stop(e){if(e&&e.preventDefault(),!this._isActive)return;let r=this.context.systems.gfx,i=r.scene.layers.get("map-ui");this._isActive=!1,this.$button&&this.$button.classed("active",!1),this.unblock(),i.geolocationData=null,r.deferredRedraw()}success(e){let t=this.context,r=t.systems.gfx,i=t.systems.map,s=r.scene.layers.get("map-ui");if(this._isActive){let o=e.coords,a=new le([o.longitude,o.latitude]).padByMeters(o.accuracy);s.geolocationData=e,r.deferredRedraw(),this._timeoutID&&(window.clearTimeout(this._timeoutID),this._timeoutID=null,i.centerZoomEase(a.center(),Math.min(20,i.extentZoom(a)))),window.setTimeout(()=>{navigator.geolocation.getCurrentPosition(this.success,this.error,kW)},ese)}this.unblock()}error(){let e=this.context,t=e.systems.l10n,r=e.systems.ui;this._isActive&&r.Flash.label(t.t("geolocate.location_unavailable")).iconName("#rapid-icon-geolocate")(),this.stop()}block(){this._timeoutID=window.setTimeout(this.error,Jie),this.context.container().call(this.Loading)}unblock(){this._timeoutID&&(window.clearTimeout(this._timeoutID),this._timeoutID=null),this.Loading.close()}};var p5=class{constructor(e){this.context=e;let t=e.systems.l10n,r=e.systems.map;this.Tooltip=de(e),this.$parent=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this.zoomIn=this.zoomIn.bind(this),this.zoomOut=this.zoomOut.bind(this),this.zoomInFurther=this.zoomInFurther.bind(this),this.zoomOutFurther=this.zoomOutFurther.bind(this),this.zooms=[{id:"zoom-in",icon:"rapid-icon-plus",key:"+",action:this.zoomIn,isDisabled:()=>!r.canZoomIn(),getTitle:()=>t.t("zoom.in"),getDisabledTitle:()=>t.t("zoom.disabled.in")},{id:"zoom-out",icon:"rapid-icon-minus",key:"-",action:this.zoomOut,isDisabled:()=>!r.canZoomOut(),getTitle:()=>t.t("zoom.out"),getDisabledTitle:()=>t.t("zoom.disabled.out")}],Xe.plusKeys.forEach(i=>{e.keybinding().on(i,this.zoomIn),e.keybinding().on(Te("\u2325"+i),this.zoomInFurther)}),Xe.minusKeys.forEach(i=>{e.keybinding().on(i,this.zoomOut),e.keybinding().on(Te("\u2325"+i),this.zoomOutFurther)}),r.on("draw",this.rerender)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let r=this.context.systems.l10n,i=e.selectAll("button").data(this.zooms),s=i.enter().append("button").attr("class",o=>o.id).on("click",(o,a)=>{a.isDisabled()||a.action(o)}).call(this.Tooltip).each((o,a,l)=>{H(l[a]).call(X(`#${o.icon}`,"light"))});i=i.merge(s),i.classed("disabled",o=>o.isDisabled()),this.Tooltip.placement(r.isRTL()?"right":"left").title(o=>o.isDisabled()?o.getDisabledTitle():o.getTitle()).shortcut(o=>o.key),i.each((o,a,l)=>{let c=H(l[a]);c.select(".tooltip.in").empty()||c.call(this.Tooltip.updateContent)})}zoomIn(e){e&&e.preventDefault(),this.context.systems.map.zoomIn()}zoomOut(e){e&&e.preventDefault(),this.context.systems.map.zoomOut()}zoomInFurther(e){e&&e.preventDefault(),this.context.systems.map.zoomInFurther()}zoomOutFurther(e){e&&e.preventDefault(),this.context.systems.map.zoomOutFurther()}};var m5=class{constructor(e){this.context=e;let t=e.systems.l10n;this._prevTransform=null,this._keys=null,this.Tooltip=de(e),this.$parent=null,this.isDisabled=this.isDisabled.bind(this),this.render=this.render.bind(this),this.modechange=this.modechange.bind(this),this.zoomTo=this.zoomTo.bind(this),this._setupKeybinding=this._setupKeybinding.bind(this),e.on("modechange",this.modechange),t.on("localechange",this._setupKeybinding),this._setupKeybinding()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let r=this.context.systems.l10n,i=e.selectAll("button").data([0]),s=i.enter().append("button").attr("class","zoom-to-selection").on("click",this.zoomTo).call(this.Tooltip).call(X("#rapid-icon-framed-dot","light"));i=i.merge(s),i.classed("disabled",this.isDisabled),this.Tooltip.placement(r.isRTL()?"right":"left").title(()=>this.isDisabled()?r.t("inspector.zoom_to.no_selection"):r.t("inspector.zoom_to.title")).shortcut(r.t("shortcuts.command.zoom_to.key"))}isDisabled(){let e=this.context;return!this._prevTransform&&!e.mode?.extent}modechange(){this._prevTransform=null,this.render()}zoomTo(e){e&&e.preventDefault();let t=this.context,r=t.mode?.extent,i=t.systems.map;if(this._prevTransform)i.transformEase(this._prevTransform),this._prevTransform=null;else if(r){let s=t.viewport;this._prevTransform=s.transform.props;let o=i.extentZoom(r,s.center());i.centerZoomEase(r.center(),o)}}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys),this._keys=[r.t("shortcuts.command.zoom_to.key")],e.keybinding().on(this._keys,this.zoomTo)}};var Ef=class{constructor(e){this.context=e,this.BearingControl=new f5(e),this.ZoomControl=new p5(e),this.ZoomToControl=new m5(e),this.GeolocateControl=new h5(e),this.$parent=null,this.render=this.render.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=e.selectAll(".map-controls").data([0]),r=t.enter().append("div").attr("class","map-controls");t=t.merge(r);let i=[{control:this.BearingControl,klass:"bearing"},{control:this.ZoomControl,klass:"zoombuttons"},{control:this.ZoomToControl,klass:"zoom-to-selection"},{control:this.GeolocateControl,klass:"geolocate"}],s=t.selectAll(".map-control").data(i,a=>a.klass),o=s.enter().append("div").attr("class",a=>`map-control ${a.klass}`);s=s.merge(o),s.each((a,l,c)=>{H(c[l]).call(a.control.render)})}};function Ms(n,e){let t=n.systems.l10n,r=n.systems.ui,i=n.systems.validator,s,o="",a="",l="",c,u=H(null),d,f={id:e};f.label=function(p){return arguments.length?(o=p,f):o},f.key=function(p){return arguments.length?(s=p,f):s},f.description=function(p){return arguments.length?(a=p,f):a},f.iconName=function(p){return arguments.length?(l=p,f):l},f.sections=function(p){return arguments.length?(c=p,f):c};function h(){r.togglePanes()}return f.togglePane=function(p){p&&p.preventDefault(),d.hide();let m=!u.classed("shown");r.togglePanes(m?u:void 0),m&&(u.selectAll(".pane-content").call(f.renderContent),f.id==="issues"&&i.validateAsync())},f.renderToggleButton=function(p){if(!d){let g=t.isRTL();d=de(n).placement(g?"right":"left").title(a).shortcut(s)}p.append("div").attr("class",`map-control map-pane-control ${e}-control`).append("button").on("click",f.togglePane).call(X(`#${l}`,"light")).call(d)},f.renderContent=function(p){if(c)for(let m of c)p.call(m.render)},f.renderPane=function(p){u=p.append("div").attr("class",`fillL map-pane hide ${e}-pane`).attr("pane",e);let m=u.append("div").attr("class","pane-heading");m.append("h2").text(o),m.append("button").on("click",h).call(X("#rapid-icon-close")),u.append("div").attr("class","pane-content").call(f.renderContent),s&&(n.keybinding().off(s),n.keybinding().on(s,f.togglePane))},f}function x_(n){let e=n.systems.imagery,t=n.systems.l10n,r=n.systems.storage,i=Ke(n,"background-display-options").label(t.t("background.display_options")).disclosureContent(d),s=r.getItem("background-opacity"),o=0,a=3,l=["brightness","contrast","saturation","sharpness"],c={brightness:s!==null?+s:1,contrast:1,saturation:1,sharpness:1};function u(f,h){h=dt(h,o,a),c[f]=h,f==="brightness"?(r.setItem("background-opacity",h),e.brightness=h):f==="contrast"?e.contrast=h:f==="saturation"?e.saturation=h:f==="sharpness"&&(e.sharpness=h),i.reRender()}function d(f){let h=f.selectAll(".display-options-container").data([0]),p=h.enter().append("div").attr("class","display-options-container controls-list"),m=p.selectAll(".display-control").data(l).enter().append("div").attr("class",y=>`display-control display-control-${y}`);m.append("h5").text(y=>t.t(`background.${y}`)).append("span").attr("class",y=>`display-option-value display-option-value-${y}`);let g=m.append("div").attr("class","control-wrap");g.append("input").attr("class",y=>`display-option-input display-option-input-${y}`).attr("type","range").attr("min",o).attr("max",a).attr("step","0.05").on("input",(y,x)=>{u(x,y.target.value||1)}),g.append("button").attr("title",t.t("background.reset")).attr("class",y=>`display-option-reset display-option-reset-${y}`).on("click",(y,x)=>{y.button===0&&u(x,1)}).call(X("#rapid-icon-"+(t.isRTL()?"redo":"undo"))),p.append("a").attr("class","display-option-resetlink").attr("href","#").text(t.t("background.reset_all")).on("click",y=>{y.preventDefault();for(let x of l)u(x,1)}),h=p.merge(h),h.selectAll(".display-option-input").property("value",y=>c[y]),h.selectAll(".display-option-value").text(y=>Math.floor(c[y]*100)+"%"),h.selectAll(".display-option-reset").classed("disabled",y=>c[y]===1),p.size()&&c.brightness!==1&&(e.brightness=c.brightness)}return i}function gP(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var G1=gP();function FW(n){G1=n}var x5={exec:()=>null};function er(n,e=""){let t=typeof n=="string"?n:n.source,r={replace:(i,s)=>{let o=typeof s=="string"?s:s.source;return o=o.replace(li.caret,"$1"),t=t.replace(i,o),r},getRegex:()=>new RegExp(t,e)};return r}var li={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},tse=/^(?:[ \t]*(?:\n|$))+/,rse=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,nse=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,_5=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,ise=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,BW=/(?:[*+-]|\d{1,9}[.)])/,NW=er(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,BW).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),yP=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,sse=/^[^\n]+/,xP=/(?!\s*\])(?:\\.|[^\[\]\\])+/,ose=er(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",xP).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),ase=er(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,BW).getRegex(),v_="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",bP=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,lse=er("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",bP).replace("tag",v_).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),OW=er(yP).replace("hr",_5).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v_).getRegex(),cse=er(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",OW).getRegex(),_P={blockquote:cse,code:rse,def:ose,fences:nse,heading:ise,hr:_5,html:lse,lheading:NW,list:ase,newline:tse,paragraph:OW,table:x5,text:sse},IW=er("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",_5).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v_).getRegex(),use={..._P,table:IW,paragraph:er(yP).replace("hr",_5).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",IW).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",v_).getRegex()},dse={..._P,html:er(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",bP).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:x5,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:er(yP).replace("hr",_5).replace("heading",` *#{1,6} *[^
]`).replace("lheading",NW).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},LW=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,fse=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,UW=/^( {2,}|\\)\n(?!\s*$)/,hse=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,w_=/[\p{P}\p{S}]/u,vP=/[\s\p{P}\p{S}]/u,GW=/[^\s\p{P}\p{S}]/u,pse=er(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,vP).getRegex(),mse=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,gse=er(/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,"u").replace(/punct/g,w_).getRegex(),yse=er("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)","gu").replace(/notPunctSpace/g,GW).replace(/punctSpace/g,vP).replace(/punct/g,w_).getRegex(),xse=er("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,GW).replace(/punctSpace/g,vP).replace(/punct/g,w_).getRegex(),bse=er(/\\(punct)/,"gu").replace(/punct/g,w_).getRegex(),_se=er(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),vse=er(bP).replace("(?:-->|$)","-->").getRegex(),wse=er("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",vse).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),__=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Sse=er(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",__).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),$W=er(/^!?\[(label)\]\[(ref)\]/).replace("label",__).replace("ref",xP).getRegex(),zW=er(/^!?\[(ref)\](?:\[\])?/).replace("ref",xP).getRegex(),Cse=er("reflink|nolink(?!\\()","g").replace("reflink",$W).replace("nolink",zW).getRegex(),wP={_backpedal:x5,anyPunctuation:bse,autolink:_se,blockSkip:mse,br:UW,code:fse,del:x5,emStrongLDelim:gse,emStrongRDelimAst:yse,emStrongRDelimUnd:xse,escape:LW,link:Sse,nolink:zW,punctuation:pse,reflink:$W,reflinkSearch:Cse,tag:wse,text:hse,url:x5},Ase={...wP,link:er(/^!?\[(label)\]\((.*?)\)/).replace("label",__).getRegex(),reflink:er(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",__).getRegex()},pP={...wP,escape:er(LW).replace("])","~|])").getRegex(),url:er(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Ese={...pP,br:er(UW).replace("{2,}","*").getRegex(),text:er(pP.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},b_={normal:_P,gfm:use,pedantic:dse},g5={normal:wP,gfm:pP,breaks:Ese,pedantic:Ase},Tse={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},PW=n=>Tse[n];function ta(n,e){if(e){if(li.escapeTest.test(n))return n.replace(li.escapeReplace,PW)}else if(li.escapeTestNoEncode.test(n))return n.replace(li.escapeReplaceNoEncode,PW);return n}function DW(n){try{n=encodeURI(n).replace(li.percentDecode,"%")}catch{return null}return n}function MW(n,e){let t=n.replace(li.findPipe,(s,o,a)=>{let l=!1,c=o;for(;--c>=0&&a[c]==="\\";)l=!l;return l?"|":" |"}),r=t.split(li.splitPipe),i=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(li.slashPipe,"|");return r}function y5(n,e,t){let r=n.length;if(r===0)return"";let i=0;for(;i<r;){let s=n.charAt(r-i-1);if(s===e&&!t)i++;else if(s!==e&&t)i++;else break}return n.slice(0,r-i)}function kse(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let r=0;r<n.length;r++)if(n[r]==="\\")r++;else if(n[r]===e[0])t++;else if(n[r]===e[1]&&(t--,t<0))return r;return-1}function RW(n,e,t,r,i){let s=e.href,o=e.title||null,a=n[1].replace(i.other.outputLinkReplace,"$1");if(n[0].charAt(0)!=="!"){r.state.inLink=!0;let l={type:"link",raw:t,href:s,title:o,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,l}return{type:"image",raw:t,href:s,title:o,text:a}}function Ise(n,e,t){let r=n.match(t.other.indentCodeCompensation);if(r===null)return e;let i=r[1];return e.split(`
`).map(s=>{let o=s.match(t.other.beginningSpace);if(o===null)return s;let[a]=o;return a.length>=i.length?s.slice(i.length):s}).join(`
`)}var kf=class{options;rules;lexer;constructor(e){this.options=e||G1}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let r=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?r:y5(r,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let r=t[0],i=Ise(r,t[3]||"",this.rules);return{type:"code",raw:r,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:i}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let r=t[2].trim();if(this.rules.other.endingHash.test(r)){let i=y5(r,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(r=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:y5(t[0],`
`)}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let r=y5(t[0],`
`).split(`
`),i="",s="",o=[];for(;r.length>0;){let a=!1,l=[],c;for(c=0;c<r.length;c++)if(this.rules.other.blockquoteStart.test(r[c]))l.push(r[c]),a=!0;else if(!a)l.push(r[c]);else break;r=r.slice(c);let u=l.join(`
`),d=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${u}`:u,s=s?`${s}
${d}`:d;let f=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(d,o,!0),this.lexer.state.top=f,r.length===0)break;let h=o.at(-1);if(h?.type==="code")break;if(h?.type==="blockquote"){let p=h,m=p.raw+`
`+r.join(`
`),g=this.blockquote(m);o[o.length-1]=g,i=i.substring(0,i.length-p.raw.length)+g.raw,s=s.substring(0,s.length-p.text.length)+g.text;break}else if(h?.type==="list"){let p=h,m=p.raw+`
`+r.join(`
`),g=this.list(m);o[o.length-1]=g,i=i.substring(0,i.length-h.raw.length)+g.raw,s=s.substring(0,s.length-p.raw.length)+g.raw,r=m.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:o,text:s}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r=t[1].trim(),i=r.length>1,s={type:"list",raw:"",ordered:i,start:i?+r.slice(0,-1):"",loose:!1,items:[]};r=i?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=i?r:"[*+-]");let o=this.rules.other.listItemRegex(r),a=!1;for(;e;){let c=!1,u="",d="";if(!(t=o.exec(e))||this.rules.block.hr.test(e))break;u=t[0],e=e.substring(u.length);let f=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,x=>" ".repeat(3*x.length)),h=e.split(`
`,1)[0],p=!f.trim(),m=0;if(this.options.pedantic?(m=2,d=f.trimStart()):p?m=t[1].length+1:(m=t[2].search(this.rules.other.nonSpaceChar),m=m>4?1:m,d=f.slice(m),m+=t[1].length),p&&this.rules.other.blankLine.test(h)&&(u+=h+`
`,e=e.substring(h.length+1),c=!0),!c){let x=this.rules.other.nextBulletRegex(m),b=this.rules.other.hrRegex(m),_=this.rules.other.fencesBeginRegex(m),S=this.rules.other.headingBeginRegex(m),C=this.rules.other.htmlBeginRegex(m);for(;e;){let k=e.split(`
`,1)[0],v;if(h=k,this.options.pedantic?(h=h.replace(this.rules.other.listReplaceNesting,"  "),v=h):v=h.replace(this.rules.other.tabCharGlobal,"    "),_.test(h)||S.test(h)||C.test(h)||x.test(h)||b.test(h))break;if(v.search(this.rules.other.nonSpaceChar)>=m||!h.trim())d+=`
`+v.slice(m);else{if(p||f.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||_.test(f)||S.test(f)||b.test(f))break;d+=`
`+h}!p&&!h.trim()&&(p=!0),u+=k+`
`,e=e.substring(k.length+1),f=v.slice(m)}}s.loose||(a?s.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(a=!0));let g=null,y;this.options.gfm&&(g=this.rules.other.listIsTask.exec(d),g&&(y=g[0]!=="[ ] ",d=d.replace(this.rules.other.listReplaceTask,""))),s.items.push({type:"list_item",raw:u,task:!!g,checked:y,loose:!1,text:d,tokens:[]}),s.raw+=u}let l=s.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;s.raw=s.raw.trimEnd();for(let c=0;c<s.items.length;c++)if(this.lexer.state.top=!1,s.items[c].tokens=this.lexer.blockTokens(s.items[c].text,[]),!s.loose){let u=s.items[c].tokens.filter(f=>f.type==="space"),d=u.length>0&&u.some(f=>this.rules.other.anyLine.test(f.raw));s.loose=d}if(s.loose)for(let c=0;c<s.items.length;c++)s.items[c].loose=!0;return s}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let r=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:r,raw:t[0],href:i,title:s}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let r=MW(t[1]),i=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===i.length){for(let a of i)this.rules.other.tableAlignRight.test(a)?o.align.push("right"):this.rules.other.tableAlignCenter.test(a)?o.align.push("center"):this.rules.other.tableAlignLeft.test(a)?o.align.push("left"):o.align.push(null);for(let a=0;a<r.length;a++)o.header.push({text:r[a],tokens:this.lexer.inline(r[a]),header:!0,align:o.align[a]});for(let a of s)o.rows.push(MW(a,o.header.length).map((l,c)=>({text:l,tokens:this.lexer.inline(l),header:!1,align:o.align[c]})));return o}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let r=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:r,tokens:this.lexer.inline(r)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let r=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let o=y5(r.slice(0,-1),"\\");if((r.length-o.length)%2===0)return}else{let o=kse(t[2],"()");if(o>-1){let l=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let i=t[2],s="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(i);o&&(i=o[1],s=o[3])}else s=t[3]?t[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?i=i.slice(1):i=i.slice(1,-1)),RW(t,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let i=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=t[i.toLowerCase()];if(!s){let o=r[0].charAt(0);return{type:"text",raw:o,text:o}}return RW(r,s,r[0],this.lexer,this.rules)}}emStrong(e,t,r=""){let i=this.rules.inline.emStrongLDelim.exec(e);if(!i||i[3]&&r.match(this.rules.other.unicodeAlphaNumeric))return;if(!(i[1]||i[2]||"")||!r||this.rules.inline.punctuation.exec(r)){let o=[...i[0]].length-1,a,l,c=o,u=0,d=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,t=t.slice(-1*e.length+o);(i=d.exec(t))!=null;){if(a=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!a)continue;if(l=[...a].length,i[3]||i[4]){c+=l;continue}else if((i[5]||i[6])&&o%3&&!((o+l)%3)){u+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+u);let f=[...i[0]][0].length,h=e.slice(0,o+i.index+f+l);if(Math.min(o,l)%2){let m=h.slice(1,-1);return{type:"em",raw:h,text:m,tokens:this.lexer.inlineTokens(m)}}let p=h.slice(2,-2);return{type:"strong",raw:h,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let r=t[2].replace(this.rules.other.newLineCharGlobal," "),i=this.rules.other.nonSpaceChar.test(r),s=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return i&&s&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:t[0],text:r}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let r,i;return t[2]==="@"?(r=t[1],i="mailto:"+r):(r=t[1],i=r),{type:"link",raw:t[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let r,i;if(t[2]==="@")r=t[0],i="mailto:"+r;else{let s;do s=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(s!==t[0]);r=t[0],t[1]==="www."?i="http://"+t[0]:i=t[0]}return{type:"link",raw:t[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let r=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:r}}}},fo=class n{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||G1,this.options.tokenizer=this.options.tokenizer||new kf,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:li,block:b_.normal,inline:g5.normal};this.options.pedantic?(t.block=b_.pedantic,t.inline=g5.pedantic):this.options.gfm&&(t.block=b_.gfm,this.options.breaks?t.inline=g5.breaks:t.inline=g5.gfm),this.tokenizer.rules=t}static get rules(){return{block:b_,inline:g5}}static lex(e,t){return new n(t).lex(e)}static lexInline(e,t){return new n(t).inlineTokens(e)}lex(e){e=e.replace(li.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let r=this.inlineQueue[t];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],r=!1){for(this.options.pedantic&&(e=e.replace(li.tabCharGlobal,"    ").replace(li.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(o=>(i=o.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let o=t.at(-1);i.raw.length===1&&o!==void 0?o.raw+=`
`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.at(-1).src=o.text):t.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=`
`+i.raw,o.text+=`
`+i.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),t.push(i);continue}let s=e;if(this.options.extensions?.startBlock){let o=1/0,a=e.slice(1),l;this.options.extensions.startBlock.forEach(c=>{l=c.call({lexer:this},a),typeof l=="number"&&l>=0&&(o=Math.min(o,l))}),o<1/0&&o>=0&&(s=e.substring(0,o+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){let o=t.at(-1);r&&o?.type==="paragraph"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):t.push(i),r=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="text"?(o.raw+=`
`+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):t.push(i);continue}if(e){let o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r=e,i=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)a.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,i.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s=!1,o="";for(;e;){s||(o=""),s=!1;let a;if(this.options.extensions?.inline?.some(c=>(a=c.call({lexer:this},e,t))?(e=e.substring(a.raw.length),t.push(a),!0):!1))continue;if(a=this.tokenizer.escape(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.tag(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.link(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(a.raw.length);let c=t.at(-1);a.type==="text"&&c?.type==="text"?(c.raw+=a.raw,c.text+=a.text):t.push(a);continue}if(a=this.tokenizer.emStrong(e,r,o)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.codespan(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.br(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.del(e)){e=e.substring(a.raw.length),t.push(a);continue}if(a=this.tokenizer.autolink(e)){e=e.substring(a.raw.length),t.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(e))){e=e.substring(a.raw.length),t.push(a);continue}let l=e;if(this.options.extensions?.startInline){let c=1/0,u=e.slice(1),d;this.options.extensions.startInline.forEach(f=>{d=f.call({lexer:this},u),typeof d=="number"&&d>=0&&(c=Math.min(c,d))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(a=this.tokenizer.inlineText(l)){e=e.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(o=a.raw.slice(-1)),s=!0;let c=t.at(-1);c?.type==="text"?(c.raw+=a.raw,c.text+=a.text):t.push(a);continue}if(e){let c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}},If=class{options;parser;constructor(e){this.options=e||G1}space(e){return""}code({text:e,lang:t,escaped:r}){let i=(t||"").match(li.notSpaceStart)?.[0],s=e.replace(li.endingNewline,"")+`
`;return i?'<pre><code class="language-'+ta(i)+'">'+(r?s:ta(s,!0))+`</code></pre>
`:"<pre><code>"+(r?s:ta(s,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){let t=e.ordered,r=e.start,i="";for(let a=0;a<e.items.length;a++){let l=e.items[a];i+=this.listitem(l)}let s=t?"ol":"ul",o=t&&r!==1?' start="'+r+'"':"";return"<"+s+o+`>
`+i+"</"+s+`>
`}listitem(e){let t="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?e.tokens[0]?.type==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=r+" "+ta(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",r="";for(let s=0;s<e.header.length;s++)r+=this.tablecell(e.header[s]);t+=this.tablerow({text:r});let i="";for(let s=0;s<e.rows.length;s++){let o=e.rows[s];r="";for(let a=0;a<o.length;a++)r+=this.tablecell(o[a]);i+=this.tablerow({text:r})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${ta(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:r}){let i=this.parser.parseInline(r),s=DW(e);if(s===null)return i;e=s;let o='<a href="'+e+'"';return t&&(o+=' title="'+ta(t)+'"'),o+=">"+i+"</a>",o}image({href:e,title:t,text:r}){let i=DW(e);if(i===null)return ta(r);e=i;let s=`<img src="${e}" alt="${r}"`;return t&&(s+=` title="${ta(t)}"`),s+=">",s}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:ta(e.text)}},b5=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}},ho=class n{options;renderer;textRenderer;constructor(e){this.options=e||G1,this.options.renderer=this.options.renderer||new If,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new b5}static parse(e,t){return new n(t).parse(e)}static parseInline(e,t){return new n(t).parseInline(e)}parse(e,t=!0){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=s,l=this.options.extensions.renderers[a.type].call({parser:this},a);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){r+=l||"";continue}}let o=s;switch(o.type){case"space":{r+=this.renderer.space(o);continue}case"hr":{r+=this.renderer.hr(o);continue}case"heading":{r+=this.renderer.heading(o);continue}case"code":{r+=this.renderer.code(o);continue}case"table":{r+=this.renderer.table(o);continue}case"blockquote":{r+=this.renderer.blockquote(o);continue}case"list":{r+=this.renderer.list(o);continue}case"html":{r+=this.renderer.html(o);continue}case"paragraph":{r+=this.renderer.paragraph(o);continue}case"text":{let a=o,l=this.renderer.text(a);for(;i+1<e.length&&e[i+1].type==="text";)a=e[++i],l+=`
`+this.renderer.text(a);t?r+=this.renderer.paragraph({type:"paragraph",raw:l,text:l,tokens:[{type:"text",raw:l,text:l,escaped:!0}]}):r+=l;continue}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}parseInline(e,t=this.renderer){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){r+=a||"";continue}}let o=s;switch(o.type){case"escape":{r+=t.text(o);break}case"html":{r+=t.html(o);break}case"link":{r+=t.link(o);break}case"image":{r+=t.image(o);break}case"strong":{r+=t.strong(o);break}case"em":{r+=t.em(o);break}case"codespan":{r+=t.codespan(o);break}case"br":{r+=t.br(o);break}case"del":{r+=t.del(o);break}case"text":{r+=t.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}},Tf=class{options;block;constructor(e){this.options=e||G1}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?fo.lex:fo.lexInline}provideParser(){return this.block?ho.parse:ho.parseInline}},mP=class{defaults=gP();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=ho;Renderer=If;TextRenderer=b5;Lexer=fo;Tokenizer=kf;Hooks=Tf;constructor(...e){this.use(...e)}walkTokens(e,t){let r=[];for(let i of e)switch(r=r.concat(t.call(this,i)),i.type){case"table":{let s=i;for(let o of s.header)r=r.concat(this.walkTokens(o.tokens,t));for(let o of s.rows)for(let a of o)r=r.concat(this.walkTokens(a.tokens,t));break}case"list":{let s=i;r=r.concat(this.walkTokens(s.items,t));break}default:{let s=i;this.defaults.extensions?.childTokens?.[s.type]?this.defaults.extensions.childTokens[s.type].forEach(o=>{let a=s[o].flat(1/0);r=r.concat(this.walkTokens(a,t))}):s.tokens&&(r=r.concat(this.walkTokens(s.tokens,t)))}}return r}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(r=>{let i={...r};if(i.async=this.defaults.async||i.async||!1,r.extensions&&(r.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let o=t.renderers[s.name];o?t.renderers[s.name]=function(...a){let l=s.renderer.apply(this,a);return l===!1&&(l=o.apply(this,a)),l}:t.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=t[s.level];o?o.unshift(s.tokenizer):t[s.level]=[s.tokenizer],s.start&&(s.level==="block"?t.startBlock?t.startBlock.push(s.start):t.startBlock=[s.start]:s.level==="inline"&&(t.startInline?t.startInline.push(s.start):t.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(t.childTokens[s.name]=s.childTokens)}),i.extensions=t),r.renderer){let s=this.defaults.renderer||new If(this.defaults);for(let o in r.renderer){if(!(o in s))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let a=o,l=r.renderer[a],c=s[a];s[a]=(...u)=>{let d=l.apply(s,u);return d===!1&&(d=c.apply(s,u)),d||""}}i.renderer=s}if(r.tokenizer){let s=this.defaults.tokenizer||new kf(this.defaults);for(let o in r.tokenizer){if(!(o in s))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let a=o,l=r.tokenizer[a],c=s[a];s[a]=(...u)=>{let d=l.apply(s,u);return d===!1&&(d=c.apply(s,u)),d}}i.tokenizer=s}if(r.hooks){let s=this.defaults.hooks||new Tf;for(let o in r.hooks){if(!(o in s))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let a=o,l=r.hooks[a],c=s[a];Tf.passThroughHooks.has(o)?s[a]=u=>{if(this.defaults.async)return Promise.resolve(l.call(s,u)).then(f=>c.call(s,f));let d=l.call(s,u);return c.call(s,d)}:s[a]=(...u)=>{let d=l.apply(s,u);return d===!1&&(d=c.apply(s,u)),d}}i.hooks=s}if(r.walkTokens){let s=this.defaults.walkTokens,o=r.walkTokens;i.walkTokens=function(a){let l=[];return l.push(o.call(this,a)),s&&(l=l.concat(s.call(this,a))),l}}this.defaults={...this.defaults,...i}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return fo.lex(e,t??this.defaults)}parser(e,t){return ho.parse(e,t??this.defaults)}parseMarkdown(e){return(r,i)=>{let s={...i},o={...this.defaults,...s},a=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&s.async===!1)return a(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof r>"u"||r===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof r!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(r)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=e);let l=o.hooks?o.hooks.provideLexer():e?fo.lex:fo.lexInline,c=o.hooks?o.hooks.provideParser():e?ho.parse:ho.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(r):r).then(u=>l(u,o)).then(u=>o.hooks?o.hooks.processAllTokens(u):u).then(u=>o.walkTokens?Promise.all(this.walkTokens(u,o.walkTokens)).then(()=>u):u).then(u=>c(u,o)).then(u=>o.hooks?o.hooks.postprocess(u):u).catch(a);try{o.hooks&&(r=o.hooks.preprocess(r));let u=l(r,o);o.hooks&&(u=o.hooks.processAllTokens(u)),o.walkTokens&&this.walkTokens(u,o.walkTokens);let d=c(u,o);return o.hooks&&(d=o.hooks.postprocess(d)),d}catch(u){return a(u)}}}onError(e,t){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let i="<p>An error occurred:</p><pre>"+ta(r.message+"",!0)+"</pre>";return t?Promise.resolve(i):i}if(t)return Promise.reject(r);throw r}}},U1=new mP;function qe(n,e){return U1.parse(n,e)}qe.options=qe.setOptions=function(n){return U1.setOptions(n),qe.defaults=U1.defaults,FW(qe.defaults),qe};qe.getDefaults=gP;qe.defaults=G1;qe.use=function(...n){return U1.use(...n),qe.defaults=U1.defaults,FW(qe.defaults),qe};qe.walkTokens=function(n,e){return U1.walkTokens(n,e)};qe.parseInline=U1.parseInline;qe.Parser=ho;qe.parser=ho.parse;qe.Renderer=If;qe.TextRenderer=b5;qe.Lexer=fo;qe.lexer=fo.lex;qe.Tokenizer=kf;qe.Hooks=Tf;qe.parse=qe;var Q9t=qe.options,Z9t=qe.setOptions,J9t=qe.use,e8t=qe.walkTokens,t8t=qe.parseInline;var r8t=ho.parse,n8t=fo.lex;function S_(n){let e=n.systems.l10n,t=n.systems.storage,r=ge("change");function i(s){let o={template:t.getItem("background-custom-template")},a=Object.assign({},o),l=gc(n,s).okButton();l.classed("settings-modal settings-custom-background",!0),l.select(".modal-section.header").append("h3").html(e.tHtml("settings.custom_background.header"));let c="settings.custom_background.instructions",u=e.t(`${c}.info`),d=e.t(`${c}.wms.tokens_label`),f=e.t(`${c}.wms.tokens.proj`),h=e.t(`${c}.wms.tokens.wkid`),p=e.t(`${c}.wms.tokens.dimensions`),m=e.t(`${c}.wms.tokens.bbox`),g=e.t(`${c}.tms.tokens_label`),y=e.t(`${c}.tms.tokens.xyz`),x=e.t(`${c}.tms.tokens.flipped_y`),b=e.t(`${c}.tms.tokens.switch`),_=e.t(`${c}.tms.tokens.quadtile`),S=e.t(`${c}.tms.tokens.scale_factor`),C=e.t("example"),k=qe.parse(`
${u}
&nbsp;<br>
&nbsp;<br>
#### ${d}
* ${f}
* ${h}
* ${p}
* ${m}
&nbsp;<br>
&nbsp;<br>
#### ${g}
* ${y}
* ${x}
* ${b}
* ${_}
* ${S}
&nbsp;<br>
&nbsp;<br>
#### ${C}
* \`https://{switch:a,b,c}.tile.openstreetmap.org/{zoom}/{x}/{y}.png\`
`),v=l.select(".modal-section.message-text");v.append("div").attr("class","instructions-template").html(k),v.append("textarea").attr("class","field-template").attr("placeholder",e.t("settings.custom_background.template.placeholder")).call(Oe).property("value",a.template);let w=l.select(".modal-section.buttons");w.insert("button",".ok-button").attr("class","button cancel-button secondary-action").html(e.tHtml("confirm.cancel")),w.select(".cancel-button").on("click.cancel",A),w.select(".ok-button").on("click.save",E);function A(){v.select(".field-template").property("value",o.template),t.setItem("background-custom-template",o.template),this.blur(),l.close()}function E(){a.template=v.select(".field-template").property("value"),t.setItem("background-custom-template",a.template),this.blur(),l.close(),r.call("change",this,a)}}return xe(i,r,"on")}function C_(n){let e=n.systems.imagery,t=n.systems.l10n,r=n.systems.map,i=n.systems.storage,s=n.systems.ui,o=Ke(n,"background-list").label(t.t("background.backgrounds")).disclosureContent(g),a=H(null),l=null,c=S_(n).on("change",S),u=JSON.parse(i.getItem("background-favorites"))||[],d=Array.isArray(u)?u:Object.keys(u),f=new Set(d);function h(){return i.getItem("background-last-used-toggle")}function p(P){return!P.overlay}function m(){o.reRender()}function g(P){let D=n.systems.map3d,N=s.InfoCards.BackgroundCard,F=s.InfoCards.LocationCard,B=P.selectAll(".layer-background-list").data([0]);a=B.enter().append("ul").attr("class","layer-list layer-background-list").merge(B);let O=P.selectAll(".bg-extras-list").data([0]).enter().append("ul").attr("class","layer-list bg-extras-list"),G=O.append("li").attr("class","minimap-toggle-item").append("label").call(de(n).title(t.t("background.minimap.tooltip")).shortcut(t.t("shortcuts.command.toggle_minimap.key")).placement("top"));G.append("input").attr("type","checkbox").on("change",Z=>{Z.preventDefault(),s.Minimap.toggle()}),G.append("span").text(t.t("background.minimap.description"));let U=O.append("li").attr("class","map3d-toggle-item").append("label").call(de(n).title(t.t("background.3dmap.tooltip")).shortcut(Te("\u2318"+t.t("shortcuts.command.toggle_3dmap.key"))).placement("top"));U.append("input").attr("type","checkbox").attr("class","map3d-toggle-checkbox").on("change",Z=>{Z.preventDefault();let Y=Z.currentTarget;D.visible=Y.checked}),U.append("span").text(t.t("background.3dmap.description"));let W=O.append("li").attr("class","background-panel-toggle-item").append("label").call(de(n).title(t.t("background.panel.tooltip")).shortcut(Te("\u2318\u21E7"+t.t("shortcuts.command.toggle_background_card.key"))).placement("top"));W.append("input").attr("type","checkbox").on("change",N.toggle),W.append("span").text(t.t("background.panel.description"));let V=O.append("li").attr("class","location-panel-toggle-item").append("label").call(de(n).title(t.t("background.location_panel.tooltip")).shortcut(Te("\u2318\u21E7"+t.t("shortcuts.command.toggle_location_card.key"))).placement("top"));V.append("input").attr("type","checkbox").on("change",F.toggle),V.append("span").text(t.t("background.location_panel.description")),P.selectAll(".imagery-faq").data([0]).enter().append("div").attr("class","imagery-faq").append("a").attr("target","_blank").call(X("#rapid-icon-out-link","inline")).attr("href","https://github.com/openstreetmap/iD/blob/develop/FAQ.md#how-can-i-report-an-issue-with-background-imagery").append("span").text(t.t("background.imagery_problem_faq")),a.call(b);let j=P.selectAll(".bg-extras-list");j.selectAll(".map3d-toggle-item").classed("active",D.visible).selectAll("input").property("checked",D.visible),j.selectAll(".background-panel-toggle-item").classed("active",N.visible).selectAll("input").property("checked",N.visible),j.selectAll(".location-panel-toggle-item").classed("active",F.visible).selectAll("input").property("checked",F.visible)}function y(P){P.each((D,N,F)=>{let B=H(F[N]).select("label"),O=N<F.length/2?"bottom":"top",G=de(n).placement(O);B.call(G.destroyAny);let U="";D.description&&(U+=D.description),D.id===h()&&(U+="<br/><br/>"+t.t("background.switch"),G.shortcut(Te("\u2318"+t.t("shortcuts.command.background_switch.key")))),U&&(G.title(U),B.call(G))})}function x(P,D){return f.has(P.id)&&!f.has(D.id)?-1:f.has(D.id)&&!f.has(P.id)?1:P.best&&!D.best?-1:D.best&&!P.best?1:D.area!==P.area?D.area-P.area:P.name.localeCompare(D.name)}function b(P){let D=e.visibleSources().filter(p),N=P.selectAll("li").data(D,O=>O.id);N.exit().remove();let F=N.enter().append("li").classed("layer-custom",O=>O.id==="custom").classed("best",O=>O.best),B=F.append("label");B.append("input").attr("type","radio").attr("name","layers").on("change",_),B.append("span").attr("class","background-name").text(O=>O.name),F.each((O,G,U)=>{let W=H(U[G]);O.id==="EsriWayback"&&W.selectAll("label").append("select").attr("class","wayback-date").on("change",k),O.id!=="custom"&&W.append("button").attr("class","favorite-background").attr("tabindex",-1).call(X("",void 0,t.t("icons.favorite"))).on("click",v),O.id==="custom"&&W.append("button").attr("class","layer-browse").call(de(n).title(t.t("settings.custom_background.tooltip")).placement(t.isRTL()?"right":"left")).on("click",C).call(X("#rapid-icon-more")),O.best&&W.selectAll("label").append("span").attr("class","best").call(X("#rapid-icon-best-background",void 0,t.t("background.best_imagery")))}),N=N.merge(F).sort(x),N.each((O,G,U)=>{let W=H(U[G]);if(W.classed("active",j=>e.showsLayer(j)).call(y).selectAll("input").property("checked",j=>e.showsLayer(j)),O.id==="EsriWayback"){let j=O.date,Y=W.selectAll(".wayback-date").selectAll("option").data(O.localReleaseDates,ne=>ne);Y.exit().remove();let K=Y.enter().append("option").attr("value",ne=>ne).text(ne=>ne);Y.merge(K).attr("selected",ne=>ne===j?"":null).order()}let V=f.has(O.id);W.selectAll("button.favorite-background svg.icon").classed("favorite",V).selectAll("use").attr("href",V?"#fas-star":"#far-star")})}function _(P,D){let N,F;if(D instanceof $i?(N=D,F=D.id):F=D,F==="custom"&&!N?.template)return C();let B=e.baseLayerSource();B instanceof $i&&i.setItem("background-last-used-toggle",B.id),i.setItem("background-last-used",F),e.setSourceByID(F)}function S(P){let D=e.getSourceByID("custom");P?.template?(D.template=P.template,_(void 0,D)):(D.template="",_(void 0,"none"))}function C(P){P&&P.preventDefault(),n.container().call(c)}function k(P){let D="EsriWayback",N=P.target.value;N&&(D+="_"+N),_(void 0,D)}function v(P,D){P.preventDefault();let N=P.currentTarget,F=H(N);F.node().blur(),f.has(D.id)?(F.classed("favorite",!1),f.delete(D.id)):(F.classed("favorite",!0),f.add(D.id));let B=[...f];i.setItem("background-favorites",JSON.stringify(B)),H(N.parentElement).transition().duration(300).ease(y1).style("background-color","orange").transition().duration(300).ease(y1).style("background-color",null),m()}function w(P){let D=e.visibleSources().filter(p);D.sort(x);let N=e.baseLayerSource(),F=D.indexOf(N);if(F===-1)return;let B=Qt(F+P,0,D.length),O=D[B];O.id==="custom"&&!O.template&&(B=Qt(B+P,0,D.length),O=D[B]),_(void 0,O)}function A(){let P=h();P&&_(void 0,P)}function E(){w(1)}function I(){w(-1)}function M(){e.getSourceByID("EsriWayback").refreshLocalReleaseDatesAsync(),window.requestIdleCallback(()=>{m()})}function T(){let P=n.keybinding(),D=n.systems.l10n;Array.isArray(l)&&P.off(l);let N=Te("\u2318"+D.t("shortcuts.command.background_switch.key")),F=D.t("shortcuts.command.background_next.key"),B=D.t("shortcuts.command.background_previous.key");l=[N,F,B],P.on(N,A).on(F,E).on(B,I)}let R=Xt(M,1e3,{leading:!0,trailing:!0});return e.on("imagerychange",m),r.on("draw",R),t.on("localechange",T),T(),o}function A_(n){let e=n.systems.l10n,t=n.systems.imagery,r=Ke(n,"background-offset").label(e.t("background.fix_misalignment")).disclosureContent(u),i=[["top",[0,-.5]],["left",[-.5,0]],["right",[.5,0]],["bottom",[0,.5]]];function s(){let d=nm(t.offset),f=+d[0].toFixed(2),h=+d[1].toFixed(2);n.container().selectAll(".nudge-inner-rect").select("input").classed("error",!1).property("value",`${f},${h}`),n.container().selectAll(".nudge-reset").classed("disabled",f===0&&h===0)}function o(){t.offset=[0,0],s()}function a(d){t.nudge(d),s()}function l(d){let f=H(d.target),h=f.node().value;if(h==="")return o();if(h=h.replace(/;/g,",").split(",").map(p=>!isNaN(p)&&p),h.length!==2||!h[0]||!h[1]){f.classed("error",!0);return}t.offset=rm(h),s()}function c(d){if(d.button!==0)return;let f=n.container().selectAll(".nudge-inner-rect > input").node();if(d.target===f)return;let h=[d.clientX,d.clientY],p=d.pointerId||"mouse";n.container().append("div").attr("class","nudge-surface"),H(window).on("pointermove.drag-bg-offset",m).on("pointerup.drag-bg-offset",g).on("pointercancel.drag-bg-offset",g);function m(y){if(p!==(y.pointerId||"mouse"))return;let x=[y.clientX,y.clientY],b=[-(h[0]-x[0])/4,-(h[1]-x[1])/4];h=x,a(b)}function g(y){p===(y.pointerId||"mouse")&&y.button===0&&(n.container().selectAll(".nudge-surface").remove(),H(window).on(".drag-bg-offset",null))}}function u(d){let h=d.selectAll(".nudge-container").data([0]).enter().append("div").attr("class","nudge-container");h.append("div").attr("class","nudge-instructions").text(e.t("background.offset"));let p=h.append("div").attr("class","nudge-controls-wrap");p.append("div").attr("class","nudge-outer-rect").on("pointerdown",c).append("div").attr("class","nudge-inner-rect").append("input").attr("type","text").on("change",l),p.append("div").selectAll("button").data(i).enter().append("button").attr("class",g=>`${g[0]} nudge`).attr("tabindex",-1).on("click",(g,y)=>a(y[1])),p.append("button").attr("title",e.t("background.reset")).attr("class","nudge-reset disabled").on("click",g=>{g.preventDefault(),o()}).call(X("#rapid-icon-"+(e.isRTL()?"redo":"undo"))),s()}return t.on("imagerychange",s),r}function HW(n){let e=n.systems.imagery,t=n.systems.l10n,r=n.systems.rapid,i=Ke(n,"grid-display-options").label(t.t("background.grid.grids")).disclosureContent(l),s=[{numSplit:0,name:t.t("background.grid.no_grid")},{numSplit:2,name:t.t("background.grid.n_by_n",{num:2})},{numSplit:3,name:t.t("background.grid.n_by_n",{num:3})},{numSplit:4,name:t.t("background.grid.n_by_n",{num:4})},{numSplit:5,name:t.t("background.grid.n_by_n",{num:5})},{numSplit:6,name:t.t("background.grid.n_by_n",{num:6})}];function o(c,u){c.preventDefault(),e.numGridSplits=u.numSplit}function a(c){let u=c.selectAll(".layer-grid-list").data([0]),f=u.enter().append("ul").attr("class","layer-list layer-grid-list").merge(u).selectAll("li").data(s,m=>m.name),p=f.enter().insert("li",".custom-gridsopt").attr("class","gridsopt").append("label");p.append("input").attr("type","radio").attr("name","grids").property("checked",m=>m.numSplit===e.numGridSplits).on("change",o),p.append("span").text(m=>m.name),f.exit().remove()}function l(c){let u=H(".section-grid-display-options");if(r.on("taskchanged",()=>{r.isTaskRectangular()&&(u.classed("hide",!1),c.call(a))}),!r.isTaskRectangular()){u.classed("hide",!0);return}}return i}function E_(n){let e=n.systems.imagery,t=n.systems.l10n,r=n.systems.map,i=Ke(n,"overlay-list").label(t.t("background.overlays")).disclosureContent(l),s=H(null);function o(m){return!!m.overlay}function a(){i.reRender()}function l(m){let g=m.selectAll(".layer-overlay-list").data([0]);s=g.enter().append("ul").attr("class","layer-list layer-overlay-list").merge(g),s.call(d)}function c(m){m.each((g,y,x)=>{let b=H(x[y]).select("label"),_=b.select("span"),S=y<x.length/2?"bottom":"top",C=_.property("clientWidth")!==_.property("scrollWidth");b.call(de(n).destroyAny),(g.description||C)&&b.call(de(n).placement(S).title(g.description||g.name))})}function u(m){function g(y){return e.showsLayer(y)}m.selectAll("li").classed("active",g).call(c).selectAll("input").property("checked",g)}function d(m){let g=e.visibleSources().filter(o),y=m.selectAll("li").data(g,S=>S.name);y.exit().remove();let b=y.enter().append("li").append("label");b.append("input").attr("type","checkbox").attr("name","layers").on("change",f),b.append("span").text(S=>S.name),m.selectAll("li").sort(_),m.call(u);function _(S,C){return Z1(S.area,C.area)||Oi(S.name,C.name)||0}}function f(m,g){m.preventDefault(),e.toggleOverlayLayer(g),s.call(u)}function h(){window.requestIdleCallback(()=>{a()})}let p=Xt(h,1e3,{leading:!0,trailing:!0});return e.on("imagerychange",a),r.on("draw",p),i}function SP(n){let e=n.systems.l10n;return Ms(n,"background").key(e.t("shortcuts.command.toggle_background.key")).label(e.t("background.title")).description(e.t("background.description")).iconName("rapid-icon-layers").sections([C_(n),E_(n),HW(n),x_(n),A_(n)])}function CP(n){let e=n.systems.l10n,t=n.systems.ui,r=null,i=0,s=[["help",["welcome","open_data_h","open_data","before_start_h","before_start","open_source_h","open_source","open_source_help"]],["overview",["navigation_h","navigation_pan","navigation_zoom","navigation_rotate","features_h","features","nodes_ways"]],["editing",["select_h","select_left_click","select_right_click","select_space","multiselect_h","multiselect","multiselect_shift_click","multiselect_lasso","undo_redo_h","undo_redo","save_h","save","save_validation","upload_h","upload","backups_h","backups","keyboard_h","keyboard"]],["feature_editor",["intro","definitions","type_h","type","type_picker","fields_h","fields_all_fields","fields_example","fields_add_field","tags_h","tags_all_tags","tags_resources"]],["points",["intro","add_point_h","add_point","add_point_finish","move_point_h","move_point","delete_point_h","delete_point","delete_point_command"]],["lines",["intro","add_line_h","add_line","add_line_draw","add_line_continue","add_line_finish","modify_line_h","modify_line_dragnode","modify_line_addnode","connect_line_h","connect_line","connect_line_display","connect_line_drag","connect_line_tag","disconnect_line_h","disconnect_line_command","move_line_h","move_line_command","move_line_connected","delete_line_h","delete_line","delete_line_command"]],["areas",["intro","point_or_area_h","point_or_area","add_area_h","add_area_command","add_area_draw","add_area_continue","add_area_finish","square_area_h","square_area_command","modify_area_h","modify_area_dragnode","modify_area_addnode","delete_area_h","delete_area","delete_area_command"]],["relations",["intro","edit_relation_h","edit_relation","edit_relation_add","edit_relation_delete","maintain_relation_h","maintain_relation","relation_types_h","multipolygon_h","multipolygon","multipolygon_create","multipolygon_merge","turn_restriction_h","turn_restriction","turn_restriction_field","turn_restriction_editing","route_h","route","route_add","boundary_h","boundary","boundary_add"]],["operations",["intro","intro_2","straighten","orthogonalize","circularize","move","rotate","reflect","continue","reverse","disconnect","split","extract","merge","delete","downgrade","copy_paste"]],["notes",["intro","show_notes","add_note_h","add_note","place_note","move_note","update_note_h","update_note","save_note_h","save_note"]],["imagery",["intro","sources_h","choosing","sources","offsets_h","offset","offset_change"]],["streetlevel",["intro","using_h","using","photos","viewer"]],["gps",["intro","survey","using_h","using","tracing","upload"]],["qa",["intro","tools_h","tools","issues_h","issues"]]],o={"help.help.open_data_h":3,"help.help.before_start_h":3,"help.help.open_source_h":3,"help.overview.navigation_h":3,"help.overview.features_h":3,"help.editing.select_h":3,"help.editing.multiselect_h":3,"help.editing.undo_redo_h":3,"help.editing.save_h":3,"help.editing.upload_h":3,"help.editing.backups_h":3,"help.editing.keyboard_h":3,"help.feature_editor.type_h":3,"help.feature_editor.fields_h":3,"help.feature_editor.tags_h":3,"help.points.add_point_h":3,"help.points.move_point_h":3,"help.points.delete_point_h":3,"help.lines.add_line_h":3,"help.lines.modify_line_h":3,"help.lines.connect_line_h":3,"help.lines.disconnect_line_h":3,"help.lines.move_line_h":3,"help.lines.delete_line_h":3,"help.areas.point_or_area_h":3,"help.areas.add_area_h":3,"help.areas.square_area_h":3,"help.areas.modify_area_h":3,"help.areas.delete_area_h":3,"help.relations.edit_relation_h":3,"help.relations.maintain_relation_h":3,"help.relations.relation_types_h":2,"help.relations.multipolygon_h":3,"help.relations.turn_restriction_h":3,"help.relations.route_h":3,"help.relations.boundary_h":3,"help.notes.add_note_h":3,"help.notes.update_note_h":3,"help.notes.save_note_h":3,"help.imagery.sources_h":3,"help.imagery.offsets_h":3,"help.streetlevel.using_h":3,"help.gps.using_h":3,"help.qa.tools_h":3,"help.qa.issues_h":3},a=e.isRTL()?"-rtl":"",l={version:`**${n.version}**`,rapidicon:`<svg class="icon pre-text rapid"><use xlink:href="#rapid-logo-rapid-wordmark${a}"></use></svg>`},c=[];for(let[p,m]of s){let g=m.reduce((y,x)=>{let b=`help.${p}.${x}`,_=o[b],S=_?Array(_+1).join("#")+" ":"";return y+S+J(n,b,l)+`

`},"");c.push({title:e.t(`help.${p}.title`),contentHtml:qe.parse(g.trim()).replace(/<code>/g,"<kbd>").replace(/<\/code>/g,"</kbd>")})}let u=Ms(n,"help").key(e.t("shortcuts.command.toggle_help.key")).label(e.t("help.title")).description(e.t("help.title")).iconName("rapid-icon-help");u.renderContent=function(p){r=p;let m=p.selectAll(".toc").data([0]).enter().append("ul").attr("class","toc");m.selectAll("li").data(c).enter().append("li").append("a").attr("href","#").text(b=>b.title).on("click",(b,_)=>{b.preventDefault(),d(_,c.indexOf(_))}),m.append("li").attr("class","shortcuts").call(de(n).title(e.t("shortcuts.tooltip")).shortcut("?").placement("top")).append("a").attr("href","#").on("click",h).append("div").text(e.t("shortcuts.title"));let y=m.append("li").attr("class","walkthrough").append("a").attr("href","#").on("click",f);y.append("svg").attr("class","logo logo-walkthrough").append("use").attr("xlink:href","#rapid-logo-walkthrough"),y.append("div").text(e.t("splash.walkthrough"));let x=p.selectAll(".help-content-wrap").data([0]).enter().append("div").attr("class","help-content-wrap");x.append("div").attr("class","help-content"),x.append("div").attr("class","nav"),d(c[i],i)};function d(p,m){if(!r)return;i=m;let g=e.isRTL();r.property("scrollTop",0),H(r.node().parentElement).selectAll(".pane-heading > h2").text(p.title);let x=r.selectAll(".help-content");x.html(p.contentHtml),x.selectAll("a").attr("target","_blank"),r.selectAll(".toc > li").classed("selected",C=>C===p);let b=r.selectAll(".nav");b.html(""),g?b.call(_).call(S):b.call(S).call(_);function _(C){if(m===c.length-1)return;C.append("a").attr("href","#").attr("class","next").on("click",v=>{v.preventDefault(),d(c[m+1],m+1)}).append("span").text(c[m+1].title).call(X(g?"#rapid-icon-backward":"#rapid-icon-forward","inline"))}function S(C){if(m===0)return;C.append("a").attr("href","#").attr("class","previous").on("click",v=>{v.preventDefault(),d(c[m-1],m-1)}).call(X(g?"#rapid-icon-forward":"#rapid-icon-backward","inline")).append("span").text(c[m-1].title)}}function f(p){p.preventDefault(),!n.inIntro&&(n.container().call(co(n)),t.togglePanes())}function h(p){p.preventDefault(),t.Shortcuts.show()}return u}var AP=1e3;function Pf(n,e){let t=n.systems.editor,r=n.systems.l10n,i=n.systems.map,s=n.systems.storage,o=n.systems.urlhash,a=n.systems.validator,l=n.viewport,c=`issues-${e}`,u=Ke(n,c).label(f).shouldDisplay(h).disclosureContent(p),d=[];function f(){let C=d.length>AP?`${AP}+`:String(d.length),k=r.t(`issues.${e}s`);return r.t("inspector.title_count",{title:k,count:C})}function h(){return d.length}function p(C){let k=t.staging.graph,v=l.centerLoc(),w=d.map(function(E){let I=E.extent(k),M=I?ht(v,I.center()):0;return Object.assign(E,{dist:M})}).sort((A,E)=>A.dist-E.dist);w=w.slice(0,AP),C.call(m,w)}function m(C,k){let v=s.getItem("rapid-internal-feature.showAutoFix")==="true",w=C.selectAll(".issues-list").data([0]);w=w.enter().append("ul").attr("class",`layer-list issues-list ${e}-list`).merge(w);let A=w.selectAll("li").data(k,N=>N.key);A.exit().remove();let E=A.enter().append("li").attr("class",N=>`issue severity-${N.severity}`),I=E.append("button").attr("class","issue-label").on("click",(N,F)=>a.focusIssue(F)).on("mouseover",(N,F)=>Je(F.entityIds,!0,n)).on("mouseout",(N,F)=>Je(F.entityIds,!1,n)),M=I.append("span").attr("class","issue-text");M.append("span").attr("class","issue-icon").each((N,F,B)=>{H(B[F]).call(X(a.getSeverityIcon(N.severity)))}),M.append("span").attr("class","issue-message"),I.append("span").attr("class","issue-autofix").append("button").attr("title",r.t("issues.fix_one.title")).attr("class","autofix action").on("click",g).call(X("#rapid-icon-wrench")),A=A.merge(E).order(),A.selectAll(".issue-message").html(N=>N.message(n)),A.selectAll(".issue-autofix").classed("hide",N=>!(v&&N.autoArgs));let T=k.filter(N=>N.autoArgs),R=C.selectAll(".autofix-all").data(v&&T.length?[0]:[]);R.exit().remove();let P=R.enter().insert("div",".issues-list").attr("class","autofix-all"),D=P.append("a").attr("class","autofix-all-link").attr("href","#");D.append("span").attr("class","autofix-all-link-text").text(r.t("issues.fix_all.title")),D.append("span").attr("class","autofix-all-link-icon").call(X("#rapid-icon-wrench")),R=R.merge(P),R.selectAll(".autofix-all-link").on("click",N=>y(N,T))}function g(C,k){C&&(C.preventDefault(),C.stopPropagation()),Je(k.entityIds,!1,n),t.perform(k.autoArgs[0]),t.commit({annotation:k.autoArgs[1],selectedIDs:k.entityIds})}function y(C,k){C&&(C.preventDefault(),C.stopPropagation()),t.beginTransaction();for(let v of k){let w=v.autoArgs[0];t.perform(w)}t.commit({annotation:r.t("issues.fix_all.annotation")}),t.endTransaction()}function x(){return{what:s.getItem("validate-what")||"edited",where:s.getItem("validate-where")||"all"}}function b(){let C=x();d=a.getIssuesBySeverity(C)[e]}function _(){return n.container().selectAll(".map-panes .issues-pane.shown").size()}function S(){window.requestIdleCallback(()=>{_()&&(b(),u.reRender())})}return a.on("validated",S),o.on("hashchange",(C,k)=>{C.get("poweruser")!==k.get("poweruser")&&S()}),i.on("draw",Xt(()=>{S()},500,{leading:!1,trailing:!0})),u}function T_(n){let e=n.systems.l10n,t=n.systems.storage,r=n.systems.validator,i,s=Ke(n,"issues-options").content(o);function o(c=i){if(c instanceof fe)i=c;else return;let u=c.selectAll(".issues-options-container").data([0]);u=u.enter().append("div").attr("class","issues-options-container").merge(u);let d=[{key:"what",values:["edited","all"]},{key:"where",values:["visible","all"]}],h=u.selectAll(".issues-option").data(d,m=>m.key).enter().append("div").attr("class",m=>`issues-option issues-option-${m.key}`);h.append("div").attr("class","issues-option-title").text(m=>e.t(`issues.options.${m.key}.title`));let p=h.selectAll("label").data(m=>m.values.map(g=>({value:g,key:m.key}))).enter().append("label");p.append("input").attr("type","radio").attr("name",m=>`issues-option-${m.key}`).attr("value",m=>m.value).property("checked",m=>a()[m.key]===m.value).on("change",(m,g)=>l(m,g.key,g.value)),p.append("span").text(m=>e.t(`issues.options.${m.key}.${m.value}`))}function a(){return{what:t.getItem("validate-what")||"edited",where:t.getItem("validate-where")||"all"}}function l(c,u,d){!d&&c&&c.target&&(d=c.target.value),t.setItem(`validate-${u}`,d),r.validateAsync()}return s}function k_(n){let e=n.systems.l10n,t=n.systems.storage,r=n.systems.validator,i=0,s=20,o=5,a=Ke(n,"issues-rules").disclosureContent(c).label(e.t("issues.rules")),l=r.getRuleKeys().sort((p,m)=>e.t(`issues.${p}.title`)<e.t(`issues.${m}.title`)?-1:1);function c(p){let m=p.selectAll(".issues-rulelist-container").data([0]),g=m.enter().append("div").attr("class","issues-rulelist-container");g.append("ul").attr("class","layer-list issue-rules-list");let y=g.append("div").attr("class","issue-rules-links section-footer");y.append("a").attr("class","issue-rules-link").attr("href","#").text(e.t("issues.disable_all")).on("click",x=>{x.preventDefault(),r.disableRules(l)}),y.append("a").attr("class","issue-rules-link").attr("href","#").text(e.t("issues.enable_all")).on("click",x=>{x.preventDefault(),r.disableRules([])}),m=m.merge(g),m.selectAll(".issue-rules-list").call(u)}function u(p){let m=p.selectAll("li").data(l);m.exit().remove();let g=m.enter().append("li").call(de(n).title(S=>e.t(`issues.${S}.tip`)).placement("top")),y=g.append("label");y.append("input").attr("type","checkbox").attr("name","rule").on("change",h),y.append("span").html(S=>{let C={};return S==="unsquare_way"&&(C.val='<span class="square-degrees"></span>'),e.tHtml(`issues.${S}.title`,C)}),m=m.merge(g),m.classed("active",f).selectAll("input").property("checked",f).property("indeterminate",!1);let x=t.getItem("validate-square-degrees");x===null&&(x=o.toString());let _=m.selectAll(".square-degrees").selectAll(".square-degrees-input").data([0]);_.enter().append("input").attr("type","number").attr("min",i.toString()).attr("max",s.toString()).attr("step","0.5").attr("class","square-degrees-input").call(Oe).on("click",function(S){S.preventDefault(),S.stopPropagation(),this.select()}).on("keyup",function(S){S.keyCode===13&&(this.blur(),this.select())}).on("blur",d).merge(_).property("value",x)}function d(){let p=H(this),m=Ee(p).trim(),g=parseFloat(m,10);isFinite(g)?g>s?g=s:g<i&&(g=i):g=o,g=Math.round(g*10)/10,m=g.toString(),p.property("value",m),t.setItem("validate-square-degrees",m),r.revalidateUnsquare()}function f(p){return r.isRuleEnabled(p)}function h(p,m){r.toggleRule(m)}return r.on("validated",()=>{window.requestIdleCallback(a.reRender)}),a}function I_(n){let e=n.systems.l10n,t=n.systems.validator,r=Ke(n,"issues-status").shouldDisplay(i).content(o);function i(){return t.getIssues(s()).length===0}function s(){let c=n.systems.storage;return{what:c.getItem("validate-what")||"edited",where:c.getItem("validate-where")||"all"}}function o(c){let d=c.selectAll(".box").data([0]).enter().append("div").attr("class","box");d.append("div").call(X("#rapid-icon-apply","pre-text"));let f=d.append("span");f.append("strong").attr("class","message"),f.append("br"),f.append("span").attr("class","details"),a(c),l(c)}function a(c){let u=t.getIssues({what:"all",where:"all",includeDisabledRules:!0,includeIgnored:"only"}),d=c.selectAll(".reset-ignored").data(u.length?[0]:[]);d.exit().remove();let f=d.enter().append("div").attr("class","reset-ignored section-footer");f.append("a").attr("href","#"),d=d.merge(f),d.select("a").text(e.t("inspector.title_count",{title:e.t("issues.reset_ignored"),count:u.length})),d.on("click",h=>{h.preventDefault(),t.resetIgnoredIssues()})}function l(c){let u=s();function d(h){for(let p in h){let m=h[p],g=t.getIssues(m);if(g.length){c.select(".box .details").text(e.t("issues.no_issues.hidden_issues."+p,{count:g.length.toString()}));return}}c.select(".box .details").text(e.t("issues.no_issues.hidden_issues.none"))}let f;u.what==="edited"&&u.where==="visible"?(f="edits_in_view",d({elsewhere:{what:"edited",where:"all"},everything_else:{what:"all",where:"visible"},disabled_rules:{what:"edited",where:"visible",includeDisabledRules:"only"},everything_else_elsewhere:{what:"all",where:"all"},disabled_rules_elsewhere:{what:"edited",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"edited",where:"visible",includeIgnored:"only"},ignored_issues_elsewhere:{what:"edited",where:"all",includeIgnored:"only"}})):u.what==="edited"&&u.where==="all"?(f="edits",d({everything_else:{what:"all",where:"all"},disabled_rules:{what:"edited",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"edited",where:"all",includeIgnored:"only"}})):u.what==="all"&&u.where==="visible"?(f="everything_in_view",d({elsewhere:{what:"all",where:"all"},disabled_rules:{what:"all",where:"visible",includeDisabledRules:"only"},disabled_rules_elsewhere:{what:"all",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"all",where:"visible",includeIgnored:"only"},ignored_issues_elsewhere:{what:"all",where:"all",includeIgnored:"only"}})):u.what==="all"&&u.where==="all"&&(f="everything",d({disabled_rules:{what:"all",where:"all",includeDisabledRules:"only"},ignored_issues:{what:"all",where:"all",includeIgnored:"only"}})),u.what==="edited"&&n.systems.editor.difference().summary().size===0&&(f="no_edits"),c.select(".box .message").text(e.t(`issues.no_issues.message.${f}`))}return t.on("validated",()=>{window.requestIdleCallback(r.reRender)}),n.systems.map.on("draw",Xt(()=>{window.requestIdleCallback(r.reRender)},1e3)),r}function EP(n){let e=n.systems.l10n;return Ms(n,"issues").key(e.t("shortcuts.command.toggle_issues.key")).label(e.t("issues.title")).description(e.t("issues.title")).iconName("rapid-icon-alert").sections([T_(n),I_(n),Pf(n,"error"),Pf(n,"warning"),Pf(n,"suggestion"),k_(n)])}function P_(n){let e=n.systems.l10n,t=n.systems.storage,r=n.systems.urlhash,i=ge("change"),s="settings.custom_data",o=[".gpx","application/gpx","application/gpx+xml",".kml","application/vnd.google-earth.kml+xml","application/kml","application/kml+xml",".geojson",".json","application/geo+json","application/json","application/vnd.geo+json","text/x-json"];function a(l){let c=n.scene().layers.get("custom-data"),u=r.getParam("data")||r.getParam("gpx")||t.getItem("settings-custom-data-url"),d=c&&c.getFileList()||null,f=u,h=d,p=gc(n,l).okButton();p.classed("settings-modal settings-custom-data",!0),p.select(".modal-section.header").append("h3").html(e.tHtml("settings.custom_data.header"));let m=p.select(".modal-section.message-text"),g=e.t(`${s}.instructions`),y=e.t(`${s}.file.heading`),x=e.t(`${s}.file.instructions`),b=e.t(`${s}.file.types`),_=e.t(`${s}.file.tip`),S=qe.parse(`
${g}
&nbsp;<br>
&nbsp;<br>
### ${y}
${x}
* ${b}
&nbsp;<br>
&nbsp;<br>
${_}
`);m.append("div").attr("class","instructions-template").html(S),m.append("input").attr("class","field-file").attr("type","file").attr("accept",o.join()).property("files",h).on("change",B=>{let O=B.target.files;O?.length?(h=O,f="",m.select(".field-url").property("value","")):h=null});let C=e.t(`${s}.or`),k=e.t(`${s}.url.heading`),v=e.t(`${s}.url.instructions`),w=e.t(`${s}.url.tokens`),A=e.t(`${s}.url.xyz`),E=e.t(`${s}.url.example_file`),I=e.t(`${s}.url.example_xyz`),M=e.t(`${s}.url.example_pmtiles`),T=e.t("example"),R=qe.parse(`
### ${C}
### ${k}
${v}
&nbsp;<br>
&nbsp;<br>
${w}
* ${A}
&nbsp;<br>
&nbsp;<br>
#### ${T}
* \`${E}\`
* \`${I}\`
* \`${M}\`
`);m.append("div").attr("class","instructions-template").html(R),m.append("textarea").attr("class","field-url").attr("placeholder",e.t("settings.custom_data.url.placeholder")).call(Oe).property("value",f);let P=p.select(".modal-section.buttons");P.insert("button",".ok-button").attr("class","button cancel-button secondary-action").html(e.tHtml("confirm.cancel")),P.select(".cancel-button").on("click.cancel",N),P.select(".ok-button").attr("disabled",D).on("click.save",F);function D(){return null}function N(){m.select(".field-url").property("value",u),t.setItem("settings-custom-data-url",u),this.blur(),p.close()}function F(){f=m.select(".field-url").property("value").trim();let B={};f?(B={url:f,fileList:null},t.setItem("settings-custom-data-url",f)):h&&(B={url:null,fileList:h}),this.blur(),p.close(),i.call("change",this,B)}}return xe(a,i,"on")}function D_(n){let e=n.systems.l10n,t=n.systems.gfx.scene,r=n.systems.ui,i=Ke(n,"data-layers").label(e.t("map_data.data_layers")).disclosureContent(d),s=P_(n).on("change",_),o=new Map,a=null;function l(v){v&&v.preventDefault();let w=["osm","notes","rapid","maproulette","keepRight","osmose","geoScribble","custom-data","mapillary","streetside","kartaview"];w.some(E=>f(E))?w.forEach(E=>{o.set(E,f(E)),h(E,!1)}):o.forEach((E,I)=>{h(I,E)})}function c(v,w){v&&v.preventDefault(),p(w)}function u(){i.reRender()}function d(v){let w=v.selectAll(".data-layer-container").data([0]);w.enter().append("div").attr("class","data-layer-container").merge(w).call(g).call(y).call(x).call(C)}function f(v){return t.layers.get(v)?.enabled}function h(v,w){let A=n.mode;A&&/^draw/.test(A.id)||(w?t.enableLayers(v):(t.disableLayers(v),(v==="osm"||v==="notes")&&n.enter("browse")))}function p(v){h(v,!f(v))}function m(v){v.each((w,A,E)=>{let I=H(E[A]).select("label"),M=A<E.length/2?"bottom":"top",T=de(n).placement(M);I.call(T.destroyAny);let R="";w.id&&(R+=w.id),R&&(T.title(e.t(`map_data.layers.${w.id}.tooltip`)),I.call(T))})}function g(v){let w=[{id:"osm",layer:t.layers.get("osm"),key:"shortcuts.command.toggle_osm_data.key"},{id:"notes",layer:t.layers.get("notes"),key:"shortcuts.command.toggle_osm_notes.key"},{id:"rapid",layer:t.layers.get("rapid"),key:"shortcuts.command.toggle_rapid_data.key"}],A=v.selectAll(".layer-list-osm").data([0]);A=A.enter().append("ul").attr("class","layer-list layer-list-osm").merge(A);let E=A.selectAll(".list-item").data(w);E.exit().remove();let I=E.enter().append("li").attr("class",T=>`list-item list-item-${T.id}`),M=I.append("label").each((T,R,P)=>{H(P[R]).call(de(n).title(e.t(`map_data.layers.${T.id}.tooltip`)).shortcut(Te("\u21E7"+e.t(T.key))).placement("bottom"))});M.append("input").attr("type","checkbox").on("change",(T,R)=>p(R.id)),M.append("span").text(T=>e.t(`map_data.layers.${T.id}.title`)),E.merge(I).classed("active",T=>f(T.id)).selectAll("input").property("checked",T=>f(T.id))}function y(v){let A=["maproulette","keepRight","osmose","geoScribble"].map(P=>t.layers.get(P)).filter(Boolean),E=n.services.maproulette,I=v.selectAll(".layer-list-qa").data([0]);I=I.enter().append("ul").attr("class","layer-list layer-list-qa").merge(I);let M=I.selectAll(".list-item").data(A);M.exit().remove();let T=M.enter().append("li").attr("class",P=>`list-item list-item-${P.id}`),R=T.append("label").attr("class","content-label");R.append("input").attr("type","checkbox").on("change",(P,D)=>p(D.id)),R.append("span").text(P=>e.t(`map_data.layers.${P.id}.title`,{n:999})),R.filter(P=>P.id==="maproulette").append("input").attr("type","text").attr("placeholder",e.t("map_data.layers.maproulette.id_placeholder")).attr("class","challenge-ids").on("change",S),M=M.merge(T),M.classed("active",P=>P.enabled).call(m).selectAll('input[type="checkbox"]').property("checked",P=>P.enabled),M.selectAll("input.challenge-ids").attr("value",E.challengeIDs)}function x(v){let w=t.layers.get("custom-data"),A=e.isRTL(),E=v.selectAll(".layer-list-data").data(w?[w]:[]);E.exit().remove();let I=E.enter().append("ul").attr("class","layer-list layer-list-data"),M=I.append("li").attr("class","list-item-data"),T=M.append("label").call(de(n).title(e.t("map_data.layers.custom.tooltip")).placement("top"));T.append("input").attr("type","checkbox").on("change",()=>p("custom-data")),T.append("span").text(e.t("map_data.layers.custom.title")),M.append("button").attr("class","open-data-options").call(de(n).title(e.t("settings.custom_data.tooltip")).placement(A?"right":"left")).on("click",R=>{R.preventDefault(),b()}).call(X("#rapid-icon-more")),M.append("button").attr("class","zoom-to-data").call(de(n).title(e.t("map_data.layers.custom.zoom")).placement(A?"right":"left")).on("click",function(R){if(H(this).classed("disabled"))return;R.preventDefault(),R.stopPropagation(),t.layers.get("custom-data")?.fitZoom()}).call(X("#rapid-icon-framed-dot","monochrome")),E=E.merge(I),E.selectAll(".list-item-data").classed("active",R=>R.enabled).selectAll("label").classed("deemphasize",R=>!R.hasData).selectAll("input").property("disabled",R=>!R.hasData).property("checked",R=>R.enabled),E.selectAll("button.zoom-to-data").classed("disabled",R=>!R.hasData)}function b(){n.container().call(s)}function _(v){let w=t.layers.get("custom-data");w&&(v?.url?w.setUrl(v.url):v?.fileList&&w.setFileList(v.fileList))}function S(v){let w=n.services.maproulette;w.challengeIDs=v.target.value}function C(v){let w=r.InfoCards.HistoryCard,A=r.InfoCards.MeasurementCard,E=v.selectAll(".md-extras-list").data([0]).enter().append("ul").attr("class","layer-list md-extras-list"),I=E.append("li").attr("class","history-panel-toggle-item").append("label").call(de(n).title(e.t("map_data.history_panel.tooltip")).shortcut(Te("\u2318\u21E7"+e.t("shortcuts.command.toggle_history_card.key"))).placement("top"));I.append("input").attr("type","checkbox").on("change",w.toggle),I.append("span").text(e.t("map_data.history_panel.title"));let M=E.append("li").attr("class","measurement-panel-toggle-item").append("label").call(de(n).title(e.t("map_data.measurement_panel.tooltip")).shortcut(Te("\u2318\u21E7"+e.t("shortcuts.command.toggle_measurement_card.key"))).placement("top"));M.append("input").attr("type","checkbox").on("change",A.toggle),M.append("span").text(e.t("map_data.measurement_panel.title")),v.selectAll(".history-panel-toggle-item").classed("active",w.visible).selectAll("input").property("checked",w.visible),v.selectAll(".measurement-panel-toggle-item").classed("active",A.visible).selectAll("input").property("checked",A.visible)}function k(){let v=n.keybinding(),w=n.systems.l10n;Array.isArray(a)&&v.off(a);let A=Te("\u21E7"+w.t("shortcuts.command.toggle_all_layers.key")),E=Te("\u21E7"+w.t("shortcuts.command.toggle_osm_data.key")),I=Te("\u21E7"+w.t("shortcuts.command.toggle_osm_notes.key")),M=Te("\u21E7"+w.t("shortcuts.command.toggle_rapid_data.key")),T=Te("\u21E7"+w.t("shortcuts.command.toggle_mapillary.key")),R=Te("\u21E7"+w.t("shortcuts.command.toggle_streetside.key")),P=Te("\u21E7"+w.t("shortcuts.command.toggle_kartaview.key"));a=[A,E,I,M,T,R,P],v.on(A,D=>l(D)).on(E,D=>c(D,"osm")).on(I,D=>c(D,"notes")).on(M,D=>c(D,"rapid")).on(T,D=>c(D,"mapillary")).on(R,D=>c(D,"streetside")).on(P,D=>c(D,"kartaview"))}return t.off("layerchange",u),t.on("layerchange",u),e.off("localechange",k),e.on("localechange",k),k(),i}function M_(n){let e=n.systems.filters,t=n.systems.l10n,r=Ke(n,"filters").label(t.t("filters.title")).disclosureContent(i);function i(l){let c=l.selectAll(".layer-feature-list-container").data([0]),u=c.enter().append("div").attr("class","layer-feature-list-container");u.append("ul").attr("class","layer-list layer-feature-list");let d=u.append("div").attr("class","feature-list-links section-footer");d.append("a").attr("class","feature-list-link").attr("href","#").text(t.t("issues.disable_all")).on("click",f=>{f.preventDefault(),e.disableAll()}),d.append("a").attr("class","feature-list-link").attr("href","#").text(t.t("issues.enable_all")).on("click",f=>{f.preventDefault(),e.enableAll()}),c=c.merge(u),c.selectAll(".layer-feature-list").call(s)}function s(l){let c=l.selectAll("li").data(e.keys);c.exit().remove();let u=c.enter().append("li").call(de(n).title(f=>t.t(`filters.${f}.tooltip`)).placement("top")),d=u.append("label");d.append("input").attr("type","checkbox").attr("name","feature").on("change",a),d.append("span").text(f=>t.t(`filters.${f}.description`)),c=c.merge(u),c.classed("active",o).selectAll("input").property("checked",o)}function o(l){return e.isEnabled(l)}function a(l,c){e.toggle(c)}return e.on("filterchange",r.reRender),r}function R_(n){let e=n.systems.l10n,t=n.systems.map,r=Ke(n,"fill-area").label(e.t("map_data.style_options")).disclosureContent(i);function i(u){let d=u.selectAll(".layer-fill-list").data([0]);d.enter().append("ul").attr("class","layer-list layer-fill-list").merge(d).call(s,t.areaFillOptions,"radio","area_fill",a,o);let f=u.selectAll(".layer-visual-diff-list").data([0]);f.enter().append("ul").attr("class","layer-list layer-visual-diff-list").merge(f).call(s,["highlight_edits"],"checkbox","visual_diff",c,l)}function s(u,d,f,h,p,m){let g=u.selectAll("li").data(d);g.exit().remove();let y=g.enter().append("li").call(de(n).title(b=>e.t(`${h}.${b}.tooltip`)).shortcut(b=>b==="wireframe"?e.t("shortcuts.command.wireframe.key"):b==="highlight_edits"?e.t("shortcuts.command.highlight_edits.key"):null).placement("top")),x=y.append("label");x.append("input").attr("type",f).attr("name",h).on("change",p),x.append("span").text(b=>e.t(`${h}.${b}.description`)),g=g.merge(y),g.classed("active",m).selectAll("input").property("checked",m).property("indeterminate",!1)}function o(u){return t.areaFillMode===u}function a(u,d){t.areaFillMode=d}function l(){return t.highlightEdits}function c(u){let d=u.currentTarget;t.highlightEdits=d.checked}return t.off("mapchange",r.reRender),t.on("mapchange",r.reRender),r}function F_(n){let e=n.systems.l10n,t=n.systems.photos,r=n.scene(),i=Ke(n,"photo-overlays").label(e.t("photo_overlays.title")).disclosureContent(o);function s(){i.reRender()}function o(f){let h=f.selectAll(".photo-overlay-container").data([0]);h.enter().append("div").attr("class","photo-overlay-container").merge(h).call(c).call(u).call(d)}function a(f,h){let p=n.mode;p&&/^draw/.test(p.id)||(h?r.enableLayers(f):r.disableLayers(f))}function l(f){a(f,!t.isLayerEnabled(f))}function c(f){let h=t.layerIDs,p=t.detectionLayerIDs,g=h.map(k=>r.layers.get(k)).filter(Boolean).filter(k=>k.supported);function y(k){return k&&k.supported}function x(k){return y(k)&&k.enabled}let b=f.selectAll(".layer-list-photos").data([0]);b=b.enter().append("ul").attr("class","layer-list layer-list-photos").merge(b);let _=b.selectAll(".list-item-photos").data(g);_.exit().remove();let S=_.enter().append("li").attr("class",k=>{let v=`list-item-photos list-item-${k.id}`;return p.includes(k.id)&&(v+=" indented"),v}),C=S.append("label").each((k,v,w)=>{let A=k.id.replace(/-/g,"_")+".tooltip";H(w[v]).call(de(n).title(e.t(A)).placement("top"))});C.append("input").attr("type","checkbox").on("change",(k,v)=>l(v.id)),C.append("span").text(k=>{let v=k.id.replace(/-/g,"_")+".title";return e.t(v)}),_.merge(S).classed("active",x).selectAll("input").property("checked",x)}function u(f){let h=t.photoTypes;function p(b){return t.showsPhotoType(b)}let m=f.selectAll(".layer-list-photo-types").data([0]);m.exit().remove(),m=m.enter().append("ul").attr("class","layer-list layer-list-photo-types").merge(m);let g=m.selectAll(".list-item-photo-types").data(t.shouldFilterByPhotoType()?h:[]);g.exit().remove();let y=g.enter().append("li").attr("class",b=>`list-item-photo-types list-item-${b}`),x=y.append("label").each(function(b){H(this).call(de(n).title(e.t(`photo_overlays.photo_type.${b}.tooltip`)).placement("top"))});x.append("input").attr("type","checkbox").on("change",(b,_)=>t.togglePhotoType(_)),x.append("span").text(b=>e.t(`photo_overlays.photo_type.${b}.title`)),g.merge(y).classed("active",p).selectAll("input").property("checked",p)}function d(f){let h=t.dateFilters;function p(b){return t.dateFilterValue(b)}let m=f.selectAll(".layer-list-date-filter").data([0]);m.exit().remove(),m=m.enter().append("ul").attr("class","layer-list layer-list-date-filter").merge(m);let g=m.selectAll(".list-item-date-filter").data(t.shouldFilterByDate()?h:[]);g.exit().remove();let y=g.enter().append("li").attr("class","list-item-date-filter"),x=y.append("label").each((b,_,S)=>{H(S[_]).call(de(n).title(e.t(`photo_overlays.date_filter.${b}.tooltip`)).placement("top"))});x.append("span").text(b=>e.t(`photo_overlays.date_filter.${b}.title`)),x.append("input").attr("type","date").attr("class","list-item-input").attr("placeholder",e.t("units.year_month_day")).call(Oe).each((b,_,S)=>{Ee(H(S[_]),t.dateFilterValue(b)||"")}).on("change",function(b,_){let S=Ee(H(this)).trim();t.setDateFilter(_,S,!0),g.selectAll("input").each(function(C){Ee(H(this),t.dateFilterValue(C)||"")})}),g=g.merge(y).classed("active",p)}return r.off("layerchange",s),r.on("layerchange",s),t.off("photochange",s),t.on("photochange",s),i}function TP(n){let e=n.systems.l10n;return Ms(n,"map-data").key(e.t("shortcuts.command.toggle_map_data.key")).label(e.t("map_data.title")).description(e.t("map_data.description")).iconName("rapid-icon-data").sections([D_(n),F_(n),R_(n),M_(n)])}function B_(n){let e=n.systems.l10n,t=n.systems.storage,r=Ke(n,"preferences-third-party").label(e.t("preferences.privacy.title")).disclosureContent(s),i=t.getItem("preferences.privacy.thirdpartyicons")||"true";function s(o){let l=o.selectAll(".privacy-options-list").data([0]).enter().append("ul").attr("class","layer-list privacy-options-list").append("li").attr("class","privacy-third-party-icons-item").append("label").call(de(n).title(e.t("preferences.privacy.third_party_icons.tooltip")).placement("bottom"));l.append("input").attr("type","checkbox").on("change",u=>{u.preventDefault(),i=i==="true"?"false":"true",t.setItem("preferences.privacy.thirdpartyicons",i),c()}),l.append("span").text(e.t("preferences.privacy.third_party_icons.description")),o.selectAll(".privacy-link").data([0]).enter().append("div").attr("class","privacy-link").append("a").attr("target","_blank").call(X("#rapid-icon-out-link","inline")).attr("href","https://rapideditor.org/doc/license/MapWithAIPrivacyPolicy.pdf").append("span").text(e.t("preferences.privacy.privacy_link")),c();function c(){o.selectAll(".privacy-third-party-icons-item").classed("active",i==="true").select("input").property("checked",i==="true")}}return r}function N_(n){let e=n.systems.storage,t=n.systems.l10n,r=Ke(n,"map_interaction").label(t.t("preferences.map_interaction.title")).disclosureContent(s),i=["auto","zoom","pan"];function s(c){let u=c.selectAll(".mouse-wheel-options").data([0]),d=u.enter().append("div").attr("class","mouse-wheel-options");d.append("div").attr("class","mouse-wheel-title").text(t.t("preferences.map_interaction.mouse_wheel.title")),d.append("ul").attr("class","layer-list mouse-wheel-options-list"),u.merge(d).selectAll(".mouse-wheel-options-list").call(o)}function o(c){let u=c.selectAll("li").data(i);u.exit().remove();let d=u.enter().append("li").call(de(n).title(h=>t.t(`preferences.map_interaction.mouse_wheel.${h}.tooltip`)).placement("top")),f=d.append("label");f.append("input").attr("type","radio").attr("name","mouse_wheel").on("change",l),f.append("span").text(h=>t.t(`preferences.map_interaction.mouse_wheel.${h}.title`)),u.merge(d).classed("active",a).selectAll("input").property("checked",a).property("indeterminate",!1)}function a(c){return(e.getItem("prefs.mouse_wheel.interaction")||"auto")===c}function l(c,u){e.setItem("prefs.mouse_wheel.interaction",u),r.reRender()}return r}function kP(n){let e=n.systems.l10n;return Ms(n,"preferences").key(e.t("shortcuts.command.toggle_preferences.key")).label(e.t("preferences.title")).description(e.t("preferences.description")).iconName("fas-user-cog").sections([B_(n),N_(n)])}var Df=class{constructor(e){this.context=e,this.Background=SP(e),this.MapData=TP(e),this.Issues=EP(e),this.Preferences=kP(e),this.Help=CP(e),this.panes=[this.Background,this.MapData,this.Issues,this.Preferences,this.Help],this.$parent=null,this.render=this.render.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;e.selectAll(".map-panes").data([0]).enter().append("div").attr("class","map-panes").selectAll(".map-pane").data(this.panes,s=>s.id).enter().each((s,o,a)=>{H(a[o]).call(s.renderPane)}),e.selectAll(".map-controls").selectAll(".map-pane-control").data(this.panes,s=>s.id).enter().each((s,o,a)=>{H(a[o]).call(s.renderToggleButton)})}};var Mf=class{constructor(e){this.context=e,this.AccountInfo=new af(e),this.Contributors=new df(e),this.FilterStatus=new yf(e),this.ProjectLinks=new Rf(e),this.Scale=new Ff(e),this.SourceSwitch=new Bf(e),this.ValidatorStatus=new Nf(e),this.VersionInfo=new Of(e),this.$parent=null,this.render=this.render.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=e.selectAll(".map-footer").data([0]),r=t.enter().append("div").attr("class","map-footer fillD");r.append("div").attr("class","flash-wrap map-footer-hide"),r.append("div").attr("class","map-footer-wrap map-footer-show"),t=t.merge(r);let i=t.selectAll(".map-footer-wrap");i.call(this.Scale.render);let s=i.selectAll(".map-footer-info").data([0]),o=s.enter().append("div").attr("class","map-footer-info");s=s.merge(o),s.call(this.Contributors.render).call(this.SourceSwitch.render).call(this.ValidatorStatus.render).call(this.FilterStatus.render).call(this.ProjectLinks.render).call(this.VersionInfo.render).call(this.AccountInfo.render)}};var Pse=ge("start","end","cancel","interrupt"),Dse=[],jW=0,WW=1,L_=2,O_=3,VW=4,U_=5,v5=6;function yc(n,e,t,r,i,s){var o=n.__transition;if(!o)n.__transition={};else if(t in o)return;Mse(n,t,{name:e,index:r,group:i,on:Pse,tween:Dse,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:jW})}function w5(n,e){var t=sn(n,e);if(t.state>jW)throw new Error("too late; already scheduled");return t}function In(n,e){var t=sn(n,e);if(t.state>O_)throw new Error("too late; already running");return t}function sn(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function Mse(n,e,t){var r=n.__transition,i;r[e]=t,t.timer=f_(s,0,t.time);function s(c){t.state=WW,t.timer.restart(o,t.delay,t.time),t.delay<=c&&o(c-t.delay)}function o(c){var u,d,f,h;if(t.state!==WW)return l();for(u in r)if(h=r[u],h.name===t.name){if(h.state===O_)return bf(o);h.state===VW?(h.state=v5,h.timer.stop(),h.on.call("interrupt",n,n.__data__,h.index,h.group),delete r[u]):+u<e&&(h.state=v5,h.timer.stop(),h.on.call("cancel",n,n.__data__,h.index,h.group),delete r[u])}if(bf(function(){t.state===O_&&(t.state=VW,t.timer.restart(a,t.delay,t.time),a(c))}),t.state=L_,t.on.call("start",n,n.__data__,t.index,t.group),t.state===L_){for(t.state=O_,i=new Array(f=t.tween.length),u=0,d=-1;u<f;++u)(h=t.tween[u].value.call(n,n.__data__,t.index,t.group))&&(i[++d]=h);i.length=d+1}}function a(c){for(var u=c<t.duration?t.ease.call(null,c/t.duration):(t.timer.restart(l),t.state=U_,1),d=-1,f=i.length;++d<f;)i[d].call(n,u);t.state===U_&&(t.on.call("end",n,n.__data__,t.index,t.group),l())}function l(){t.state=v5,t.timer.stop(),delete r[e];for(var c in r)return;delete n.__transition}}function $1(n,e){var t=n.__transition,r,i,s=!0,o;if(t){e=e==null?null:e+"";for(o in t){if((r=t[o]).name!==e){s=!1;continue}i=r.state>L_&&r.state<U_,r.state=v5,r.timer.stop(),r.on.call(i?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete t[o]}s&&delete n.__transition}}function XW(n){return this.each(function(){$1(this,n)})}function Rse(n,e){var t,r;return function(){var i=In(this,n),s=i.tween;if(s!==t){r=t=s;for(var o=0,a=r.length;o<a;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function Fse(n,e,t){var r,i;if(typeof t!="function")throw new Error;return function(){var s=In(this,n),o=s.tween;if(o!==r){i=(r=o).slice();for(var a={name:e,value:t},l=0,c=i.length;l<c;++l)if(i[l].name===e){i[l]=a;break}l===c&&i.push(a)}s.tween=i}}function qW(n,e){var t=this._id;if(n+="",arguments.length<2){for(var r=sn(this.node(),t).tween,i=0,s=r.length,o;i<s;++i)if((o=r[i]).name===n)return o.value;return null}return this.each((e==null?Rse:Fse)(t,n,e))}function Lf(n,e,t){var r=n._id;return n.each(function(){var i=In(this,r);(i.value||(i.value={}))[e]=t.apply(this,arguments)}),function(i){return sn(i,r).value[e]}}function G_(n,e){var t;return(typeof e=="number"?wr:e instanceof oo?Xo:(t=oo(e))?(e=t,Xo):gp)(n,e)}function Bse(n){return function(){this.removeAttribute(n)}}function Nse(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Ose(n,e,t){var r,i=t+"",s;return function(){var o=this.getAttribute(n);return o===i?null:o===r?s:s=e(r=o,t)}}function Lse(n,e,t){var r,i=t+"",s;return function(){var o=this.getAttributeNS(n.space,n.local);return o===i?null:o===r?s:s=e(r=o,t)}}function Use(n,e,t){var r,i,s;return function(){var o,a=t(this),l;return a==null?void this.removeAttribute(n):(o=this.getAttribute(n),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a)))}}function Gse(n,e,t){var r,i,s;return function(){var o,a=t(this),l;return a==null?void this.removeAttributeNS(n.space,n.local):(o=this.getAttributeNS(n.space,n.local),l=a+"",o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a)))}}function YW(n,e){var t=ha(n),r=t==="transform"?Fk:G_;return this.attrTween(n,typeof e=="function"?(t.local?Gse:Use)(t,r,Lf(this,"attr."+n,e)):e==null?(t.local?Nse:Bse)(t):(t.local?Lse:Ose)(t,r,e))}function $se(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function zse(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function Hse(n,e){var t,r;function i(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&zse(n,s)),t}return i._value=e,i}function Wse(n,e){var t,r;function i(){var s=e.apply(this,arguments);return s!==r&&(t=(r=s)&&$se(n,s)),t}return i._value=e,i}function KW(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var r=ha(n);return this.tween(t,(r.local?Hse:Wse)(r,e))}function Vse(n,e){return function(){w5(this,n).delay=+e.apply(this,arguments)}}function jse(n,e){return e=+e,function(){w5(this,n).delay=e}}function QW(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?Vse:jse)(e,n)):sn(this.node(),e).delay}function Xse(n,e){return function(){In(this,n).duration=+e.apply(this,arguments)}}function qse(n,e){return e=+e,function(){In(this,n).duration=e}}function ZW(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?Xse:qse)(e,n)):sn(this.node(),e).duration}function Yse(n,e){if(typeof e!="function")throw new Error;return function(){In(this,n).ease=e}}function JW(n){var e=this._id;return arguments.length?this.each(Yse(e,n)):sn(this.node(),e).ease}function Kse(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;In(this,n).ease=t}}function eV(n){if(typeof n!="function")throw new Error;return this.each(Kse(this._id,n))}function tV(n){typeof n!="function"&&(n=Ch(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=[],l,c=0;c<o;++c)(l=s[c])&&n.call(l,l.__data__,c,s)&&a.push(l);return new ci(r,this._parents,this._name,this._id)}function rV(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,r=e.length,i=t.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l=e[a],c=t[a],u=l.length,d=o[a]=new Array(u),f,h=0;h<u;++h)(f=l[h]||c[h])&&(d[h]=f);for(;a<r;++a)o[a]=e[a];return new ci(o,this._parents,this._name,this._id)}function Qse(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function Zse(n,e,t){var r,i,s=Qse(e)?w5:In;return function(){var o=s(this,n),a=o.on;a!==r&&(i=(r=a).copy()).on(e,t),o.on=i}}function nV(n,e){var t=this._id;return arguments.length<2?sn(this.node(),t).on.on(n):this.each(Zse(t,n,e))}function Jse(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function iV(){return this.on("end.remove",Jse(this._id))}function sV(n){var e=this._name,t=this._id;typeof n!="function"&&(n=kc(n));for(var r=this._groups,i=r.length,s=new Array(i),o=0;o<i;++o)for(var a=r[o],l=a.length,c=s[o]=new Array(l),u,d,f=0;f<l;++f)(u=a[f])&&(d=n.call(u,u.__data__,f,a))&&("__data__"in u&&(d.__data__=u.__data__),c[f]=d,yc(c[f],e,t,f,c,sn(u,t)));return new ci(s,this._parents,e,t)}function oV(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Sh(n));for(var r=this._groups,i=r.length,s=[],o=[],a=0;a<i;++a)for(var l=r[a],c=l.length,u,d=0;d<c;++d)if(u=l[d]){for(var f=n.call(u,u.__data__,d,l),h,p=sn(u,t),m=0,g=f.length;m<g;++m)(h=f[m])&&yc(h,e,t,m,f,p);s.push(f),o.push(u)}return new ci(s,o,e,t)}var eoe=fe.prototype.constructor;function aV(){return new eoe(this._groups,this._parents)}function toe(n,e){var t,r,i;return function(){var s=tl(this,n),o=(this.style.removeProperty(n),tl(this,n));return s===o?null:s===t&&o===r?i:i=e(t=s,r=o)}}function lV(n){return function(){this.style.removeProperty(n)}}function roe(n,e,t){var r,i=t+"",s;return function(){var o=tl(this,n);return o===i?null:o===r?s:s=e(r=o,t)}}function noe(n,e,t){var r,i,s;return function(){var o=tl(this,n),a=t(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(n),tl(this,n))),o===l?null:o===r&&l===i?s:(i=l,s=e(r=o,a))}}function ioe(n,e){var t,r,i,s="style."+e,o="end."+s,a;return function(){var l=In(this,n),c=l.on,u=l.value[s]==null?a||(a=lV(e)):void 0;(c!==t||i!==u)&&(r=(t=c).copy()).on(o,i=u),l.on=r}}function cV(n,e,t){var r=(n+="")=="transform"?Rk:G_;return e==null?this.styleTween(n,toe(n,r)).on("end.style."+n,lV(n)):typeof e=="function"?this.styleTween(n,noe(n,r,Lf(this,"style."+n,e))).each(ioe(this._id,n)):this.styleTween(n,roe(n,r,e),t).on("end.style."+n,null)}function soe(n,e,t){return function(r){this.style.setProperty(n,e.call(this,r),t)}}function ooe(n,e,t){var r,i;function s(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&soe(n,o,t)),r}return s._value=e,s}function uV(n,e,t){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,ooe(n,e,t??""))}function aoe(n){return function(){this.textContent=n}}function loe(n){return function(){var e=n(this);this.textContent=e??""}}function dV(n){return this.tween("text",typeof n=="function"?loe(Lf(this,"text",n)):aoe(n==null?"":n+""))}function coe(n){return function(e){this.textContent=n.call(this,e)}}function uoe(n){var e,t;function r(){var i=n.apply(this,arguments);return i!==t&&(e=(t=i)&&coe(i)),e}return r._value=n,r}function fV(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,uoe(n))}function hV(){for(var n=this._name,e=this._id,t=$_(),r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var u=sn(l,e);yc(l,n,t,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ci(r,this._parents,n,t)}function pV(){var n,e,t=this,r=t._id,i=t.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--i===0&&s()}};t.each(function(){var c=In(this,r),u=c.on;u!==n&&(e=(n=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),i===0&&s()})}var doe=0;function ci(n,e,t,r){this._groups=n,this._parents=e,this._name=t,this._id=r}function mV(n){return fe().transition(n)}function $_(){return++doe}var Wa=fe.prototype;ci.prototype=mV.prototype={constructor:ci,select:sV,selectAll:oV,selectChild:Wa.selectChild,selectChildren:Wa.selectChildren,filter:tV,merge:rV,selection:aV,transition:hV,call:Wa.call,nodes:Wa.nodes,node:Wa.node,size:Wa.size,empty:Wa.empty,each:Wa.each,on:nV,attr:YW,attrTween:KW,style:cV,styleTween:uV,text:dV,textTween:fV,remove:iV,tween:qW,delay:QW,duration:ZW,ease:JW,easeVarying:eV,end:pV,[Symbol.iterator]:Wa[Symbol.iterator]};var foe={time:null,delay:0,duration:250,ease:y1};function hoe(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function gV(n){var e,t;n instanceof ci?(e=n._id,n=n._name):(e=$_(),(t=foe).time=o5(),n=n==null?null:n+"");for(var r=this._groups,i=r.length,s=0;s<i;++s)for(var o=r[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&yc(l,n,e,c,o,t||hoe(l,e));return new ci(r,this._parents,n,e)}fe.prototype.interrupt=XW;fe.prototype.transition=gV;var S5=n=>()=>n;function IP(n,{sourceEvent:e,target:t,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function po(n,e,t){this.k=n,this.x=e,this.y=t}po.prototype={constructor:po,scale:function(n){return n===1?this:new po(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new po(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var mo=new po(1,0,0);PP.prototype=po.prototype;function PP(n){for(;!n.__zoom;)if(!(n=n.parentNode))return mo;return n.__zoom}function z_(n){n.stopImmediatePropagation()}function Uf(n){n.preventDefault(),n.stopImmediatePropagation()}function poe(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function moe(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function yV(){return this.__zoom||mo}function goe(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function yoe(){return navigator.maxTouchPoints||"ontouchstart"in this}function xoe(n,e,t){var r=n.invertX(e[0][0])-t[0][0],i=n.invertX(e[1][0])-t[1][0],s=n.invertY(e[0][1])-t[0][1],o=n.invertY(e[1][1])-t[1][1];return n.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),o>s?(s+o)/2:Math.min(0,s)||Math.max(0,o))}function Gf(){var n=poe,e=moe,t=xoe,r=goe,i=yoe,s=[0,1/0],o=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Bk,c=ge("start","zoom","end"),u,d,f,h=500,p=150,m=0,g=10;function y(T){T.property("__zoom",yV).on("wheel.zoom",v,{passive:!1}).on("mousedown.zoom",w).on("dblclick.zoom",A).filter(i).on("touchstart.zoom",E).on("touchmove.zoom",I).on("touchend.zoom touchcancel.zoom",M).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(T,R,P,D){var N=T.selection?T.selection():T;N.property("__zoom",yV),T!==N?S(T,R,P,D):N.interrupt().each(function(){C(this,arguments).event(D).start().zoom(null,typeof R=="function"?R.apply(this,arguments):R).end()})},y.scaleBy=function(T,R,P,D){y.scaleTo(T,function(){var N=this.__zoom.k,F=typeof R=="function"?R.apply(this,arguments):R;return N*F},P,D)},y.scaleTo=function(T,R,P,D){y.transform(T,function(){var N=e.apply(this,arguments),F=this.__zoom,B=P==null?_(N):typeof P=="function"?P.apply(this,arguments):P,O=F.invert(B),G=typeof R=="function"?R.apply(this,arguments):R;return t(b(x(F,G),B,O),N,o)},P,D)},y.translateBy=function(T,R,P,D){y.transform(T,function(){return t(this.__zoom.translate(typeof R=="function"?R.apply(this,arguments):R,typeof P=="function"?P.apply(this,arguments):P),e.apply(this,arguments),o)},null,D)},y.translateTo=function(T,R,P,D,N){y.transform(T,function(){var F=e.apply(this,arguments),B=this.__zoom,O=D==null?_(F):typeof D=="function"?D.apply(this,arguments):D;return t(mo.translate(O[0],O[1]).scale(B.k).translate(typeof R=="function"?-R.apply(this,arguments):-R,typeof P=="function"?-P.apply(this,arguments):-P),F,o)},D,N)};function x(T,R){return R=Math.max(s[0],Math.min(s[1],R)),R===T.k?T:new po(R,T.x,T.y)}function b(T,R,P){var D=R[0]-P[0]*T.k,N=R[1]-P[1]*T.k;return D===T.x&&N===T.y?T:new po(T.k,D,N)}function _(T){return[(+T[0][0]+ +T[1][0])/2,(+T[0][1]+ +T[1][1])/2]}function S(T,R,P,D){T.on("start.zoom",function(){C(this,arguments).event(D).start()}).on("interrupt.zoom end.zoom",function(){C(this,arguments).event(D).end()}).tween("zoom",function(){var N=this,F=arguments,B=C(N,F).event(D),O=e.apply(N,F),G=P==null?_(O):typeof P=="function"?P.apply(N,F):P,U=Math.max(O[1][0]-O[0][0],O[1][1]-O[0][1]),W=N.__zoom,V=typeof R=="function"?R.apply(N,F):R,j=l(W.invert(G).concat(U/W.k),V.invert(G).concat(U/V.k));return function(Z){if(Z===1)Z=V;else{var Y=j(Z),K=U/Y[2];Z=new po(K,G[0]-Y[0]*K,G[1]-Y[1]*K)}B.zoom(null,Z)}})}function C(T,R,P){return!P&&T.__zooming||new k(T,R)}function k(T,R){this.that=T,this.args=R,this.active=0,this.sourceEvent=null,this.extent=e.apply(T,R),this.taps=0}k.prototype={event:function(T){return T&&(this.sourceEvent=T),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(T,R){return this.mouse&&T!=="mouse"&&(this.mouse[1]=R.invert(this.mouse[0])),this.touch0&&T!=="touch"&&(this.touch0[1]=R.invert(this.touch0[0])),this.touch1&&T!=="touch"&&(this.touch1[1]=R.invert(this.touch1[0])),this.that.__zoom=R,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(T){var R=H(this.that).datum();c.call(T,this.that,new IP(T,{sourceEvent:this.sourceEvent,target:y,type:T,transform:this.that.__zoom,dispatch:c}),R)}};function v(T,...R){if(!n.apply(this,arguments))return;var P=C(this,R).event(T),D=this.__zoom,N=Math.max(s[0],Math.min(s[1],D.k*Math.pow(2,r.apply(this,arguments)))),F=os(T);if(P.wheel)(P.mouse[0][0]!==F[0]||P.mouse[0][1]!==F[1])&&(P.mouse[1]=D.invert(P.mouse[0]=F)),clearTimeout(P.wheel);else{if(D.k===N)return;P.mouse=[F,D.invert(F)],$1(this),P.start()}Uf(T),P.wheel=setTimeout(B,p),P.zoom("mouse",t(b(x(D,N),P.mouse[0],P.mouse[1]),P.extent,o));function B(){P.wheel=null,P.end()}}function w(T,...R){if(f||!n.apply(this,arguments))return;var P=T.currentTarget,D=C(this,R,!0).event(T),N=H(T.view).on("mousemove.zoom",G,!0).on("mouseup.zoom",U,!0),F=os(T,P),B=T.clientX,O=T.clientY;Hp(T.view),z_(T),D.mouse=[F,this.__zoom.invert(F)],$1(this),D.start();function G(W){if(Uf(W),!D.moved){var V=W.clientX-B,j=W.clientY-O;D.moved=V*V+j*j>m}D.event(W).zoom("mouse",t(b(D.that.__zoom,D.mouse[0]=os(W,P),D.mouse[1]),D.extent,o))}function U(W){N.on("mousemove.zoom mouseup.zoom",null),Wp(W.view,D.moved),Uf(W),D.event(W).end()}}function A(T,...R){if(n.apply(this,arguments)){var P=this.__zoom,D=os(T.changedTouches?T.changedTouches[0]:T,this),N=P.invert(D),F=P.k*(T.shiftKey?.5:2),B=t(b(x(P,F),D,N),e.apply(this,R),o);Uf(T),a>0?H(this).transition().duration(a).call(S,B,D,T):H(this).call(y.transform,B,D,T)}}function E(T,...R){if(n.apply(this,arguments)){var P=T.touches,D=P.length,N=C(this,R,T.changedTouches.length===D).event(T),F,B,O,G;for(z_(T),B=0;B<D;++B)O=P[B],G=os(O,this),G=[G,this.__zoom.invert(G),O.identifier],N.touch0?!N.touch1&&N.touch0[2]!==G[2]&&(N.touch1=G,N.taps=0):(N.touch0=G,F=!0,N.taps=1+!!u);u&&(u=clearTimeout(u)),F&&(N.taps<2&&(d=G[0],u=setTimeout(function(){u=null},h)),$1(this),N.start())}}function I(T,...R){if(this.__zooming){var P=C(this,R).event(T),D=T.changedTouches,N=D.length,F,B,O,G;for(Uf(T),F=0;F<N;++F)B=D[F],O=os(B,this),P.touch0&&P.touch0[2]===B.identifier?P.touch0[0]=O:P.touch1&&P.touch1[2]===B.identifier&&(P.touch1[0]=O);if(B=P.that.__zoom,P.touch1){var U=P.touch0[0],W=P.touch0[1],V=P.touch1[0],j=P.touch1[1],Z=(Z=V[0]-U[0])*Z+(Z=V[1]-U[1])*Z,Y=(Y=j[0]-W[0])*Y+(Y=j[1]-W[1])*Y;B=x(B,Math.sqrt(Z/Y)),O=[(U[0]+V[0])/2,(U[1]+V[1])/2],G=[(W[0]+j[0])/2,(W[1]+j[1])/2]}else if(P.touch0)O=P.touch0[0],G=P.touch0[1];else return;P.zoom("touch",t(b(B,O,G),P.extent,o))}}function M(T,...R){if(this.__zooming){var P=C(this,R).event(T),D=T.changedTouches,N=D.length,F,B;for(z_(T),f&&clearTimeout(f),f=setTimeout(function(){f=null},h),F=0;F<N;++F)B=D[F],P.touch0&&P.touch0[2]===B.identifier?delete P.touch0:P.touch1&&P.touch1[2]===B.identifier&&delete P.touch1;if(P.touch1&&!P.touch0&&(P.touch0=P.touch1,delete P.touch1),P.touch0)P.touch0[1]=this.__zoom.invert(P.touch0[0]);else if(P.end(),P.taps===2&&(B=os(B,this),Math.hypot(d[0]-B[0],d[1]-B[1])<g)){var O=H(this).on("dblclick.zoom");O&&O.apply(this,arguments)}}}return y.wheelDelta=function(T){return arguments.length?(r=typeof T=="function"?T:S5(+T),y):r},y.filter=function(T){return arguments.length?(n=typeof T=="function"?T:S5(!!T),y):n},y.touchable=function(T){return arguments.length?(i=typeof T=="function"?T:S5(!!T),y):i},y.extent=function(T){return arguments.length?(e=typeof T=="function"?T:S5([[+T[0][0],+T[0][1]],[+T[1][0],+T[1][1]]]),y):e},y.scaleExtent=function(T){return arguments.length?(s[0]=+T[0],s[1]=+T[1],y):[s[0],s[1]]},y.translateExtent=function(T){return arguments.length?(o[0][0]=+T[0][0],o[1][0]=+T[1][0],o[0][1]=+T[0][1],o[1][1]=+T[1][1],y):[[o[0][0],o[0][1]],[o[1][0],o[1][1]]]},y.constrain=function(T){return arguments.length?(t=T,y):t},y.duration=function(T){return arguments.length?(a=+T,y):a},y.interpolate=function(T){return arguments.length?(l=T,y):l},y.on=function(){var T=c.on.apply(c,arguments);return T===c?y:T},y.clickDistance=function(T){return arguments.length?(m=(T=+T)*T,y):Math.sqrt(m)},y.tapDistance=function(T){return arguments.length?(g=+T,y):g},y}var bV=.5,_V=24,xV=gi(bV),boe=gi(_V),$f=class{constructor(e){this.context=e,this.viewMini=new Rn,this.stage=null,this.layer=null,this._isHidden=!0,this._skipEvents=!1,this._gesture=null,this._zDiff=5,this._tStart=null,this._keys=null,this._initPromise=null,this.$parent=null,this.$supersurface=null,this.$surface=null,this.$wrap=null,this.render=this.render.bind(this),this.toggle=this.toggle.bind(this),this.drawMinimap=this.drawMinimap.bind(this),this._setupKeybinding=this._setupKeybinding.bind(this),this._tick=this._tick.bind(this),this._zoomStarted=this._zoomStarted.bind(this),this._zoomed=this._zoomed.bind(this),this._zoomEnded=this._zoomEnded.bind(this),this._zoom=Gf().scaleExtent([xV,boe]).on("start",this._zoomStarted).on("zoom",this._zoomed).on("end",this._zoomEnded),e.systems.l10n.on("localechange",this._setupKeybinding),this._setupKeybinding()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=e.selectAll(".map-in-map").data([0]),r=t.enter().append("div").attr("class","map-in-map");this.$wrap=t=t.merge(r).style("display",this._isHidden?"none":"block");let i=t.selectAll(".supersurface").data([0]),s=i.enter().append("div").attr("class","supersurface").call(this._zoom).on("dblclick.zoom",null);this.$supersurface=i=i.merge(s);let o=i.selectAll(".surface").data([0]),a=o.enter().append("canvas").attr("class","surface");this.$surface=o=o.merge(a);let[l,c]=[200,150];this.viewMini.dimensions=[l*2,c*2],o.style("width",`${l}px`).style("height",`${c}px`).attr("width",l*2).attr("height",c*2),this.initAsync().then(()=>this.drawMinimap())}drawMinimap(){if(this._isHidden)return;let e=this.context.systems.gfx;!e.pixi||!e.textures?.loaded||(this._updateTransform(),this._updateBoundingBox(),this._tick())}_zoomStarted(){if(this._skipEvents)return;let e=this.viewMini.transform.props;this._tStart=mo.translate(e.x,e.y).scale(e.k),this._gesture=null}_zoomed(e){if(this._skipEvents)return;let{x:t,y:r,k:i}=e.transform;this._gesture||(this._gesture=i!==this._tStart.k?"zoom":"pan");let s=this.context.viewport,o=this.viewMini;if(this._gesture==="zoom"){let a=s.centerLoc(),l=s.transform.props,c=o.center();o.transform={x:l.x,y:l.y,k:i};let u=o.transform.translation,d=o.project(a),f=Me(c,d);u=bt(u,f),o.transform={x:u[0],y:u[1],k:i}}else o.transform={x:t,y:r,k:i};this._zDiff=s.transform.zoom-o.transform.zoom,this.drawMinimap()}_zoomEnded(){this._skipEvents||(this._gesture==="pan"&&this.context.systems.map.center(this.viewMini.centerLoc()),this._tStart=null,this._gesture=null,this.drawMinimap())}_updateTransform(){if(this._tStart)return;let e=this.context.viewport,t=this.viewMini,r=e.centerLoc(),i=e.transform.props,s=e.transform.zoom,o=dt(s-this._zDiff,bV,_V),a=gi(o),l=t.center();this.stage.position.set(0,0),t.transform={x:i.x,y:i.y,k:a};let c=t.transform.translation,u=t.project(r),d=Me(l,u);c=bt(c,d),t.transform={x:c[0],y:c[1],k:a};let f=this._zoom;this._skipEvents=!0,f.scaleExtent([xV,gi(s-3)]),this.$supersurface.call(f.transform,mo.translate(c[0],c[1]).scale(a)),this._skipEvents=!1}_updateBoundingBox(){if(this._isHidden)return;let e=this.context,t=e.systems.gfx;if(!t.pixi||!t.textures?.loaded)return;let r=this.stage,i=e.viewport,s=this.viewMini,[o,a]=i.dimensions,l=[[0,0],[0,a],[o,a],[o,0],[0,0]],c=new Array(l.length),u=new Array(l.length*2),d=[0,0],f=this._tStart,h=s.transform.props;f&&f.k===h.k&&(d=[h.x-f.x,h.y-f.y]);for(let x=0;x<l.length;x++){let[b,_]=s.project(i.unproject(l[x],!0));c[x]=Me([b,_],d),u[x*2]=b-d[0],u[x*2+1]=_-d[1]}let p=r.getChildByLabel("bbox");p||(p=new ze,p.label="bbox",p.eventMode="none",r.addChild(p));let m=r.getChildByLabel("arrow");if(!m){m=new we,m.label="arrow",m.eventMode="none",r.addChild(m);let x=new At;x.texture=t.textures.get("sided"),x.tint=16776960,x.anchor.set(0,.5),x.scale.set(2,2),x.rotation=-Us,m.addChild(x)}p.clear().poly(u).stroke({color:16776960,width:3});let[g,y]=at(c[3],c[4],.5);m.position.set(g,y),m.rotation=-i.transform.rotation}toggle(e){e&&e.preventDefault();let t=this.context,r=this.$wrap;r&&(this._isHidden=!this._isHidden,t.container().select(".minimap-toggle-item").classed("active",!this._isHidden).select("input").property("checked",!this._isHidden),this._isHidden?r.transition().duration(200).style("opacity","0").on("end",()=>{r.style("display","none"),this._clear()}):(this.drawMinimap(),r.style("display","block").style("opacity","0").transition().duration(200).style("opacity","1")))}_clear(){this.layer&&this.layer.destroyAll()}_tick(){if(this._isHidden)return;let e=this.context.systems.gfx;if(!e.pixi||!e.textures?.loaded)return;window.performance.mark("minimap-start"),this.layer.render(0,this.viewMini);let r=e.pixi.renderer,i=this.$surface.node(),s;r.type===Bt.WEBGL&&r.context.multiView&&(s=r.view.canvas,r.view.canvas=i),r.render({container:this.stage,target:i}),s&&(r.view.canvas=s),window.performance.mark("minimap-end"),window.performance.measure("minimap","minimap-start","minimap-end")}initAsync(){if(this._initPromise)return this._initPromise;if(!this.$supersurface||!this.$surface)return Promise.reject();let e=this.context,t=e.systems.gfx;if(!t.pixi||!t.textures)return Promise.reject();t.on("draw",this.drawMinimap);let r=new we;r.label="mini-stage",r.sortableChildren=!1,r.eventMode="none",this.stage=r;let i={id:"gfx",context:e,supersurface:this.$supersurface.node(),surface:this.$surface.node(),stage:r,origin:r,pixi:t.pixi,textures:t.textures,deferredRedraw:t.deferredRedraw,immediateRedraw:t.immediateRedraw},s={context:e,gfx:i,groups:new Map,layers:new Map,features:new Map};i.scene=s;let o=new we;return o.label="background",r.addChild(o),s.groups.set("background",o),this.layer=new qd(s,"minimap-background",!0),s.layers.set(this.layer.id,this.layer),this._initPromise=Promise.resolve()}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys),this._keys=[r.t("shortcuts.command.toggle_minimap.key")],e.keybinding().on(this._keys,this.toggle)}};function H_(n){let e=n.systems.l10n,t=n.services.maproulette,r;function i(c,u){return`<select name="${c}"><option value=""></option>${u.map(d=>`<option value="${d.trim()}">${d.trim()}</option>`).join("")}</select>`}function s(c){let u=c.split(/\[select\s+&quot;\s*[^"]*?\s*&quot;\s+name=&quot;/),d=u[0];return u.slice(1).forEach(f=>{let h=f.indexOf("&quot;"),p=f.substring(0,h),m=f.indexOf("values=&quot;")+13,g=f.indexOf("&quot;",m),y=f.substring(m,g).split(","),x=i(p,y),b=f.substring(g+6).trim().replace(/^\]/,"");d+=x+b}),d}function o(c,u){let d=/\{\{([\w:]+)\}\}/g;return c.replace(d,(f,h)=>{if(h==="osmIdentifier"&&u.title){let p=u.title.split("@")[0];return`<a href="#" class="highlight-link" data-osm-id="${p}">${p}</a>`}return u.properties&&u.properties.hasOwnProperty(h)?u.properties[h]:""})}function a(c){let u=c.split("@")[0];n.enter("select-osm",{selection:{osm:[u]}})}function l(c){let u=c.selectAll(".error-details").data(r?[r]:[],f=>f.key);u.exit().remove();let d=u.enter().append("div").attr("class","error-details qa-details-container");d.append("div").attr("class","qa-details-subsection").text(e.t("map_data.layers.maproulette.loading_task_details")),u=u.merge(d),t.loadTaskDetailAsync(r).then(f=>{if(!f||r.id!==f.id)return;let h=u.selectAll(".qa-details-subsection");h.html(""),f.id&&(h.append("h4").text(e.t("map_data.layers.maproulette.id_title")),h.append("p").text(`${f.parentId} / ${f.id}`).selectAll("a").attr("rel","noopener").attr("target","_blank"));let p=s(o(f.description,f)),m=s(o(f.instruction,f));f.description&&(h.append("h4").text(e.t("map_data.layers.maproulette.detail_title")),h.append("p").html(p).selectAll("a").attr("rel","noopener").attr("target","_blank")),f.instruction&&f.instruction!==f.description&&(h.append("h4").text(e.t("map_data.layers.maproulette.instruction_title")),h.append("p").html(m).selectAll("a").attr("rel","noopener").attr("target","_blank")),h.selectAll(".highlight-link").on("mouseover",function(){let g=H(this).attr("data-osm-id");Je([g],!0,n)}).on("mouseout",function(){let g=H(this).attr("data-osm-id");Je([g],!1,n)}).on("click",function(g){g.preventDefault();let y=H(this).attr("data-osm-id");Je([y],!1,n),a(y)})}).catch(f=>{u.selectAll(".qa-details-subsection").text(e.t("map_data.layers.maproulette.error_loading_task_details"))})}return l.task=function(c){return arguments.length?(r=c,l):r},l}function vV(n){let e=n.systems.l10n,t;function r(i){let s=i.selectAll(".qa-header").data(t?[t]:[],l=>l.key);s.exit().remove();let o=s.enter().append("div").attr("class","qa-header"),a=o.append("div").attr("class","qa-header-icon").append("svg").attr("width","20px").attr("height","27px").attr("viewbox","0 0 20 27");a.append("polygon").attr("fill","#01ff00").attr("stroke","#333").attr("points","16,3 4,3 1,6 1,17 4,20 7,20 10,27 13,20 16,20 19,17.033 19,6"),a.append("use").attr("class","icon-annotation").attr("width","13px").attr("height","13px").attr("transform","translate(3.5, 5)").attr("fill","#01ff00"),o.append("div").attr("class","qa-header-label").text(l=>l.parentName||e.t("inspector.unknown"))}return r.task=function(i){return arguments.length?(t=i,r):t},r}function zf(n){let e=n.systems.l10n,t=n.services.maproulette,r=ge("change"),i=H_(n),s=vV(n),o=new qn(n),a,l,c;function u(A){let I=A.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");I.append("button").attr("class","close").on("click",()=>n.enter("browse")).call(X("#rapid-icon-close")),I.append("h3").text(e.t("map_data.layers.maproulette.title",{n:1}));let M=A.selectAll(".body").data([0]);M=M.enter().append("div").attr("class","body").merge(M);let T=M.selectAll(".mr-editor").data([0]);T.enter().append("div").attr("class","modal-section mr-editor").merge(T).call(s.task(a)).call(i.task(a)).call(f).call(p),o.stringID="inspector.view_on_maproulette",o.url=t&&a?t.itemURL(a):"";let R=A.selectAll(".sidebar-footer").data([0]);R.enter().append("div").attr("class","sidebar-footer").merge(R).call(o.render)}function d(A,E){A.services.osm.loadMapRouletteKey((M,T)=>{typeof E=="function"&&(M?E(M):E(null,T.maproulette_apikey_v2))})}function f(A){let E=a?.id,I=E&&n.selectedData().has(E),M=a&&I,T=A.selectAll(".mr-save").data(M?[a]:[],P=>P.key);T.exit().remove(),T=T.enter().append("div").attr("class","mr-save save-section cf").merge(T).call(m).call(g)}function h(A){switch(A){case"FIXED":return"#62c9d3";case"CAN'T COMPLETE":return"#fe5e63";case"ALREADY FIXED":return"#ccb185";case"NOT AN ISSUE":return"#f7ba59";default:return"black"}}function p(A){let E=a?.id,I=E&&n.selectedData().has(E),M=A.selectAll(".note-save").data(I&&l?[a]:[],P=>P.key);M.exit().remove();let T=M.enter().append("div").attr("class","note-save save-section cf");T.append("h4").attr("class","note-save-header"),M=T.merge(M),M.select(".note-save-header").html(e.t("map_data.layers.maproulette.comment")+' <span style="color: '+h(l)+';">'+l+"</span>"),T.append("textarea").attr("class","new-comment-input").attr("placeholder",e.t("map_data.layers.maproulette.inputPlaceholder")).attr("maxlength",1e3).property("value",function(P){return P.newComment}).call(Oe).on("input.note-input",R).on("blur.note-input",R).style("resize","none"),M=T.merge(M).call(m).call(b);function R(){let D=H(this).property("value").trim()||void 0;a.update({newComment:D}),t&&t.replaceTask(a),M.call(g)}}function m(A){let E=A.selectAll(".detail-section").data([0]);E=E.enter().append("div").attr("class","detail-section").merge(E);let I=n.services.osm;if(!I)return;let M=I.authenticated(),T=E.selectAll(".auth-warning").data([0]);R(T,M,"map_data.layers.maproulette.login"),d(n,(P,D)=>{if(P){console.error(P);return}c=D;let N=c!==void 0;T=E.selectAll(".auth-warning").data([0]),R(T,N,"map_data.layers.maproulette.loginMaproulette")}),I.userDetails(function(P,D){if(P)return;let N=H(document.createElement("div"));D.image_url&&N.append("img").attr("src",D.image_url).attr("class","icon pre-text user-icon"),N.append("a").attr("class","user-info").text(D.display_name).attr("href",I.userURL(D.display_name)).attr("target","_blank")});function R(P,D,N){if(D)P.exit().transition().duration(200).style("opacity",0).remove();else{let F=P.enter().insert("div",".tag-reference-body").attr("class","field-warning auth-warning").style("opacity",0);F.call(X("#rapid-icon-alert","inline")),F.append("span").text(e.t(N)),N==="map_data.layers.maproulette.loginMaproulette"?F.append("a").attr("target","_blank").attr("href","https://maproulette.org/dashboard").call(X("#rapid-icon-out-link","inline")).append("span").text(e.t("login")):F.append("a").attr("target","_blank").call(X("#rapid-icon-out-link","inline")).append("span").text(e.t("login")).on("click.note-login",B=>{B.preventDefault(),I.authenticate()}),F.transition().duration(200).style("opacity",1)}}}function g(A){d(n,(E,I)=>{if(E){console.error(E);return}c=I;let M=n.services.osm,P=M&&M.authenticated()&&c!==void 0,D=a?.id,N=D&&n.selectedData().has(D);if(n.systems.ui._showsMapRouletteMenu){A.selectAll(".mr-save .buttons").style("display","none");return}else A.selectAll(".mr-save .buttons").style("display","");let B=A.selectAll(".buttons").data(N?[a]:[],W=>W.key);B.exit().remove();let O=B.enter().append("div").attr("class","buttons");O.append("button").attr("class","button fixedIt-button action"),O.append("button").attr("class","button cantComplete-button action"),O.append("button").attr("class","button alreadyFixed-button action"),O.append("button").attr("class","button notAnIssue-button action"),B=B.merge(O),B.select(".fixedIt-button").attr("disabled",U(a)).text(e.t("map_data.layers.maproulette.fixed")).on("click.fixedIt",function(W,V){_(W,V,A)}),B.select(".cantComplete-button").attr("disabled",U(a)).text(e.t("map_data.layers.maproulette.cantComplete")).on("click.cantComplete",function(W,V){S(W,V,A)}),B.select(".alreadyFixed-button").attr("disabled",U(a)).text(e.t("map_data.layers.maproulette.alreadyFixed")).on("click.alreadyFixed",function(W,V){C(W,V,A)}),B.select(".notAnIssue-button").attr("disabled",U(a)).text(e.t("map_data.layers.maproulette.notAnIssue")).on("click.notAnIssue",function(W,V){k(W,V,A)});let G=O.append("div").attr("class","checkbox-section");G.append("input").attr("type","checkbox").attr("id","nearbyTaskCheckbox").property("checked",t.nearbyTaskEnabled).on("change",y),G.append("label").attr("for","nearbyTaskCheckbox").text(e.t("map_data.layers.maproulette.nearbyTask.title"));function U(W){return P&&W?.service==="maproulette"?null:!0}})}function y(A){let E=A.target.checked,I=n.services.maproulette;I&&(I.nearbyTaskEnabled=E)}function x(A){A?(H(".note-save").style("display","block"),H(".mr-save .buttons").style("display","none")):(H(".note-save").style("display","none"),H(".mr-save .buttons").style("display",""))}function b(A){n.services.osm.loadMapRouletteKey((P,D)=>{if(P){console.error(P);return}c=D.maproulette_apikey_v2});let I=a?.id,M=I&&n.selectedData().has(I),T=A.selectAll(".buttons").data(M?[a]:[],P=>P.key);T.exit().remove();let R=T.enter().append("div").attr("class","buttons");R.append("button").attr("class","button cancel-button action"),R.append("button").attr("class","button submit-button action"),T=T.merge(R),T.select(".cancel-button").text(e.t("map_data.layers.maproulette.cancel")).on("click.cancel",function(P,D){v(P,D,A)}),T.select(".submit-button").text(e.t("map_data.layers.maproulette.submit")).on("click.submit",function(P,D){w(P,D,A)})}function _(A,E,I){this.blur(),E._status=1,l="FIXED",x(!0),I.call(p)}function S(A,E,I){this.blur(),E._status=6,l="CAN'T COMPLETE",x(!0),I.call(p)}function C(A,E,I){this.blur(),E._status=5,l="ALREADY FIXED",x(!0),I.call(p)}function k(A,E,I){this.blur(),E._status=2,l="NOT AN ISSUE",x(!0),I.call(p)}function v(A,E,I){this.blur(),l="",E._status="",x(!1),I.call(p)}function w(A,E){this.blur();let M=n.services.osm._userDetails.id;t&&(E.taskStatus=E._status,E.mapRouletteApiKey=c,E.comment=H(".new-comment-input").property("value").trim(),E.taskId=E.id,E.userId=M,t.postUpdate(E,(T,R)=>{if(T){console.error(T);return}r.call("change",R),t.nearbyTaskEnabled&&t.flyToNearbyTask(E)}))}return u.error=function(A){return arguments.length?(a=A,l="",u):a},xe(u,r,"on")}function Hf(n){let e=ge("toggled","change"),t=n.services.maproulette,r=n.systems.gfx,i=n.systems.l10n,s=n.systems.map,o=n.viewport,a=85,l=45,c=35,u=10,d=4,f=H(null),h=[0,0],p=0,m="",g=!1,y,x,b,_;function S(T){m===void 0&&(m="rightclick"),g=m.includes("touch")||m.includes("pen");let P=!0,D=[i.t("map_data.layers.maproulette.fixed"),i.t("map_data.layers.maproulette.cantComplete"),i.t("map_data.layers.maproulette.alreadyFixed"),i.t("map_data.layers.maproulette.notAnIssue")],N=P?32:34;x=P?52+Math.min(120,6*Math.max.apply(Math,D.map(G=>G.length))):44,y=d*2+4*N,p=o.transform.scale;let F=T.selectAll(".maproulette-menu").data([0]),B=F.enter().append("div").attr("class","maproulette-menu").style("padding",d+"px 0");f=F.merge(B);let O=f.selectAll(".maproulette-menu-item").data(["fixed","cantComplete","alreadyFixed","notAnIssue"]).enter().append("button").attr("class",G=>`maproulette-menu-item maproulette-menu-item-${G}`).style("height",`${N}px`).on("click",(G,U)=>{_?C(U,G):M(n,(W,V)=>{if(W){console.error("Error retrieving MapRoulette API key:",W);return}_=V,C(U,G)}),S.close()});O.append("div").attr("class","icon-wrap").call(X("","operation")),O.append("span").attr("class","label").text(G=>i.t(`map_data.layers.maproulette.${G}`)),k(),s.off("move",k),s.on("move",k),e.call("toggled",this,!0)}function C(T,R){switch(T){case"fixed":v(R,b);break;case"cantComplete":w(R,b);break;case"alreadyFixed":A(R,b);break;case"notAnIssue":E(R,b);break}}function k(){if(!f||f.empty())return;if(p!==o.transform.scale){S.close();return}let T=o.project(h,!0),R=r.surface.getBoundingClientRect();if(T[0]<0||T[0]>R.width||T[1]<0||T[1]>R.height){S.close();return}let P=B(R),D=[0,0];D[0]=P?-1*(u+x):u,g?T[1]-y<a?D[1]=-T[1]+a:D[1]=-y:T[1]+y>R.height-l?D[1]=-T[1]-y+R.height-l:D[1]=0;let[N,F]=bt(T,D);f.style("left",`${N}px`).style("top",`${F}px`);function B(O){return i.isRTL()?!(T[0]-u-x<c):T[0]+u+x>O.width-c}}function v(T,R){R._status=1,I(T,R)}function w(T,R){R._status=6,I(T,R)}function A(T,R){R._status=5,I(T,R)}function E(T,R){R._status=2,I(T,R)}function I(T,R){if(!R){console.error("No task to submit");return}let D=n.services.osm._userDetails.id;if(t){R.taskStatus=R._status,R.mapRouletteApiKey=_;let N=H(".new-comment-input");N.empty()?R.comment="":R.comment=N.property("value").trim(),R.taskId=R.id,R.userId=D,t.postUpdate(R,(F,B)=>{if(F){console.error(F);return}e.call("change",B),t.nearbyTaskEnabled&&t.flyToNearbyTask(R)})}}function M(T,R){T.services.osm.loadMapRouletteKey((D,N)=>{typeof R=="function"&&(D?R(D):R(null,N.maproulette_apikey_v2))})}return S.close=function(){s.off("move",k),f.remove(),e.call("toggled",this,!1);let T=n.systems.ui;T._showsMapRouletteMenu=!1},S.anchorLoc=function(T){return arguments.length?(h=T,S):h},S.triggerType=function(T){return arguments.length?(m=T,S):m},S.error=function(T){return arguments.length?(b=T,S):b},xe(S,e,"on")}var C5=class{constructor(e){this.context=e,this.id="download_osc",this.stringID="download_osc.title";let t=e.systems.editor;this.Tooltip=de(e),this.$parent=null,this.choose=this.choose.bind(this),this.render=this.render.bind(this),this.rerender=()=>this.render(),e.on("modechange",this.rerender),t.on("stablechange",this.rerender)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.editor,i=t.systems.l10n;this.Tooltip.placement("bottom").scrollContainer(t.container().select(".map-toolbar")).title(i.t(r.hasChanges()?"download_osc.help":"download_osc.no_changes"));let s=e.selectAll("button.downloadOsc").data([0]),o=s.enter().append("button").attr("class","downloadOsc disabled bar-button").on("click",this.choose).call(this.Tooltip).call(X("#rapid-icon-download"));s=s.merge(o),s.classed("disabled",this.isDisabled())}isDisabled(){let e=this.context,t=e.systems.editor;return e.inIntro||!t.hasChanges()}choose(e){if(e&&e.preventDefault(),this.isDisabled())return;let r=this.context.systems.editor,i=r.changes(ma(r.difference())),s=new ri,o=ea.stringify(s.osmChangeJXON(i)),a="change.osc",l=document.createElement("a");l.style.display="none",document.body.appendChild(l),l.href=window.URL.createObjectURL(new Blob([o])),l.setAttribute("download",a),l.click(),window.URL.revokeObjectURL(l.href),document.body.removeChild(l)}};var A5=class{constructor(e){this.context=e,this.id="draw_modes",this.stringID="toolbar.add_feature";let t=e.systems.l10n,r=e.systems.gfx,i=e.systems.presets,s=e.systems.ui;this._keys=null,this.commands=[{id:"add-point",icon:"point",preset:i.item("point"),getTitle:()=>t.t("modes.add_point.title"),getDescription:()=>t.t("modes.add_point.description"),getKey:()=>t.t("shortcuts.command.add_point.key")},{id:"draw-line",icon:"line",preset:i.item("line"),getTitle:()=>t.t("modes.add_line.title"),getDescription:()=>t.t("modes.add_line.description"),getKey:()=>t.t("shortcuts.command.add_line.key")},{id:"draw-area",icon:"area",preset:i.item("area"),getTitle:()=>t.t("modes.add_area.title"),getDescription:()=>t.t("modes.add_area.description"),getKey:()=>t.t("shortcuts.command.add_area.key")},{id:"add-note",icon:"note",getTitle:()=>t.t("modes.add_note.title"),getDescription:()=>t.t("modes.add_note.description"),getKey:()=>t.t("shortcuts.command.add_note.key")}],this.Tooltip=de(e).placement("bottom").title(o=>o.getDescription()).shortcut(o=>o.getKey()),this.$parent=null,this.choose=this.choose.bind(this),this.render=this.render.bind(this),this.rerender=()=>this.render(),this.debouncedRender=Xt(this.rerender,500,{leading:!0,trailing:!0}),this._setupKeybinding=this._setupKeybinding.bind(this),r.on("draw",this.debouncedRender),r.scene.on("layerchange",this.rerender),e.on("modechange",this.rerender),s.on("uichange",this.rerender),t.on("localechange",this._setupKeybinding),this._setupKeybinding()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.ui;this.Tooltip.scrollContainer(t.container().select(".map-toolbar"));let i=e.selectAll(".joined").data([0]),s=i.enter().append("div").attr("class","joined").style("display","flex");i=i.merge(s);let o=this.commands.filter(c=>c.id==="add-note"?this.notesEnabled():!0),a=i.selectAll("button.add-button").data(o,c=>c.id);a.exit().remove();let l=a.enter().append("button").attr("class",c=>`${c.id} add-button bar-button`).on("click",this.choose);l.each((c,u,d)=>{H(d[u]).call(X(`#rapid-icon-${c.icon}`)).call(this.Tooltip)}),l.append("span").attr("class","label"),(a.enter().size()||a.exit().size())&&r.checkOverflow(".map-toolbar",!0),a=a.merge(l),a.classed("disabled",c=>!this.buttonEnabled(c)).classed("active",c=>t.mode?.id===c.id),a.selectAll(".label").text(c=>c.getTitle())}osmEnabled(){return this.context.scene().layers.get("osm")?.enabled}osmEditable(){return this.context.mode?.id!=="save"}notesEnabled(){return this.context.scene().layers.get("notes")?.enabled}notesEditable(){return this.context.mode?.id!=="save"}buttonEnabled(e){if(e.id==="add-note")return this.notesEnabled()&&this.notesEditable();if(e.id!=="add-note")return this.osmEnabled()&&this.osmEditable()}choose(e,t){if(e&&e.preventDefault(),!t||!this.buttonEnabled(t))return;let r=this.context,i=r.mode?.id;e&&/^draw/.test(i)||(t.id===i?r.enter("browse"):r.enter(t.id))}_setupKeybinding(){let t=this.context.keybinding();Array.isArray(this._keys)&&t.off(this._keys),this._keys=[];for(let r of this.commands){let i=r.getKey();this._keys.push(i),t.on(i,s=>this.choose(s,r))}}};function W_(n,e){let t=ge("change","done"),r=()=>{};function i(c){let u=n.container().selectAll(".shaded");u.empty()||(u.selectAll(".colorpicker-popup").size()?r():l(u,c.currentTarget))}function s(c){let u=c.target,d=u&&u.className||"";/colorpicker/i.test(d)||(c.stopPropagation(),c.preventDefault(),r())}function o(c){let u=c.length<6,d=parseInt(u?c[1]+c[1]:c[1]+c[2],16),f=parseInt(u?c[2]+c[2]:c[3]+c[4],16),h=parseInt(u?c[3]+c[3]:c[5]+c[6],16);return(d*299+f*587+h*114)/1e3}function a(c){let u=c.selectAll(".rapid-colorpicker").data(f=>[f],f=>f.id),d=u.enter().append("div").attr("class","rapid-colorpicker").on("click",i);d.append("div").attr("class","rapid-colorpicker-fill").call(X("#fas-palette")),u.merge(d).selectAll(".rapid-colorpicker-fill").style("background",f=>f.color).select(".icon").style("color",f=>o(f.color)>140.5?"#333":"#fff")}function l(c,u){let d=n.systems.l10n.isRTL(),f=u.__data__,h=u.getBoundingClientRect(),p=180,m=h.bottom+15,g=d?h.right-.3333*p:h.left-.6666*p,y=d?.3333*p-h.width+10:.6666*p+10,x=e.close;e.close=()=>{},r=()=>{_.transition().duration(200).style("opacity",0).remove(),e.close=x;let w=Xe("modal");w.on(["\u232B","\u238B"],x),H(document).call(w),H(document).on("click.colorpicker",null),r=()=>{},t.call("done")};let b=Xe("modal");b.on(["\u232B","\u238B"],r),H(document).call(b),H(document).on("click.colorpicker",s);let _=c.append("div").attr("class","colorpicker-popup").style("opacity",0).style("width",p+"px").style("top",m+"px").style("left",g+"px");_.append("div").attr("class","colorpicker-arrow").style("left",y+"px");let C=_.append("div").attr("class","colorpicker-content").selectAll(".colorpicker-colors").data([0]);C=C.enter().append("div").attr("class","colorpicker-colors").merge(C);let k=C.selectAll(".colorpicker-option").data(n.systems.rapid.colors),v=k.enter().append("div").attr("class","colorpicker-option").style("color",w=>w).on("click",(w,A)=>{t.call("change",this,f.id,A),k.classed("selected",E=>E===A)});v.append("div").attr("class","colorpicker-option-fill"),k=k.merge(v),k.classed("selected",w=>w===f.color),_.transition().style("opacity",1)}return xe(a,t,"on")}var wV=100,Wf=class extends st{constructor(e,t){super(),this.context=e,this._filterText=null,this._filterCategory=null,this._myClose=()=>!0,this.CategoryCombo=ct(e,"dataset-categories"),this.$parentModal=t,this.$wrap=null,this.$modal=null,this.show=this.show.bind(this),this.render=this.render.bind(this),this.rerender=()=>this.render(),this.renderDatasets=this.renderDatasets.bind(this),this.sortCategories=this.sortCategories.bind(this),this.sortDatasets=this.sortDatasets.bind(this),this.toggleDataset=this.toggleDataset.bind(this),this.highlight=this.highlight.bind(this),e.systems.l10n.on("localechange",this.rerender)}show(){let r=this.context.container().selectAll(".shaded");if(r.empty()||r.selectAll(".modal-catalog").size())return;let i=this.$parentModal.close;this.$parentModal.close=()=>{},this._myClose=()=>{this._filterText=null,this._filterCategory=null,this.$modal.transition().duration(200).style("top","0px").on("end",()=>this.$wrap.remove()),this.$parentModal.close=i;let c=Xe("modal");c.on(["\u232B","\u238B"],i),H(document).call(c),this.emit("done")};let s=Xe("modal");s.on(["\u232B","\u238B"],this._myClose),H(document).call(s);let o=r.selectAll(".catalog-wrap").data([0]),a=o.enter().append("div").attr("class","catalog-wrap"),l=a.append("div").attr("class","modal rapid-modal modal-catalog").style("opacity",0);l.append("button").attr("class","close").on("click",this._myClose).call(X("#rapid-icon-close")),l.append("div").attr("class","content rapid-stack"),this.$wrap=o=o.merge(a),this.$modal=o.selectAll(".modal-catalog"),this.$modal.transition().style("opacity",1),this.render()}render(){if(!this.$modal)return;let t=this.context.systems.l10n,r=this.$modal.selectAll(".content"),i=r.selectAll(".rapid-catalog-header").data([0]),s=i.enter().append("div").attr("class","modal-section rapid-catalog-header"),o=s.append("div");o.append("div").attr("class","rapid-catalog-header-icon").call(X("#rapid-icon-data","icon-30")),o.append("div").attr("class","rapid-catalog-header-text"),s.append("div").append("div").attr("class","rapid-catalog-header-about"),i=i.merge(s),i.selectAll(".rapid-catalog-header-text").text(t.t("rapid_menu.add_manage_datasets")),i.selectAll(".rapid-catalog-header-about").html(qe.parse(t.t("rapid_menu.about_the_catalog"))),i.selectAll(".rapid-catalog-header-about a").attr("target","_blank");let l=r.selectAll(".rapid-catalog-filter").data([0]),c=l.enter().append("div").attr("class","modal-section rapid-catalog-filter"),u=c.append("div").attr("class","rapid-catalog-filter-search-wrap");u.call(X("#fas-filter","inline")),u.append("input").attr("class","rapid-catalog-filter-search").call(Oe).on("input",y=>{let x=y.currentTarget,b=x&&x.value||"";this._filterText=b.trim().toLowerCase(),h.call(this.renderDatasets)});let d=u.selectAll(".rapid-catalog-filter-search").node();d&&d.focus(),c.append("div").attr("class","rapid-catalog-filter-type-wrap").append("input").attr("class","rapid-catalog-filter-type").call(Oe).call(this.CategoryCombo).on("blur change",y=>{let x=y.currentTarget,b=x&&x.value||"";this.CategoryCombo.data().some(S=>S.value===b)?this._filterCategory=b:(y.currentTarget.value="",this._filterCategory=null),h.call(this.renderDatasets)}),c.append("div").attr("class","rapid-catalog-filter-clear").append("a").attr("href","#").on("click",y=>{y.preventDefault(),y.currentTarget.blur(),r.selectAll("input").property("value",""),this._filterText=null,this._filterCategory=null,h.call(this.renderDatasets)}),c.append("div").attr("class","rapid-catalog-filter-results"),l=l.merge(c),l.selectAll(".rapid-catalog-filter-search").attr("placeholder",t.t("rapid_menu.filter_datasets")),l.selectAll(".rapid-catalog-filter-type").attr("placeholder",t.t("rapid_menu.any_type")),l.selectAll(".rapid-catalog-filter-clear > a").text(t.t("rapid_menu.clear_filters"));let h=r.selectAll(".rapid-catalog-datasets-section").data([0]),p=h.enter().append("div").attr("class","modal-section rapid-catalog-datasets-section");p.append("div").attr("class","rapid-catalog-datasets-status"),p.append("div").attr("class","rapid-catalog-datasets"),h=h.merge(p),h.call(this.renderDatasets);let m=r.selectAll(".modal-section.buttons").data([0]),g=m.enter().append("div").attr("class","modal-section buttons");g.append("button").attr("class","button ok-button action").on("click",this._myClose),m=m.merge(g),m.selectAll(".button").text(t.t("confirm.okay"))}renderDatasets(e){if(!this.$modal)return;let t=this.context,r=t.systems.l10n,i=t.systems.rapid,s=t.systems.storage,o=this.$modal.selectAll(".content"),a=s.getItem("rapid-internal-feature.previewDatasets")==="true",l=e.selectAll(".rapid-catalog-datasets-status"),c=e.selectAll(".rapid-catalog-datasets");if(!i.catalog.size){c.classed("hide",!0),l.classed("hide",!1).text(r.t("rapid_menu.no_datasets"));return}c.classed("hide",!1),l.classed("hide",!0);let u=new Set(i.categories);a||u.delete("preview");let d=Array.from(u).sort().map(C=>{let k=r.t(`rapid_menu.category.${C}`,{default:C}),v={display:k,title:C,value:C};return C==="preview"&&(v.display=`${k} <span class="rapid-catalog-dataset-beta beta"></span>`),v});this.CategoryCombo.data(d);let f=0,h=[...i.catalog.values()].filter(C=>!C.hidden).sort(this.sortDatasets);for(let C of h){let k=C.getLabel().toLowerCase(),v=C.getDescription().toLowerCase();if(C.added){C.filtered=!1,++f;continue}if(this._filterText&&!k.includes(this._filterText)&&!v.includes(this._filterText)){C.filtered=!0;continue}if(this._filterCategory&&!C.categories.has(this._filterCategory)){C.filtered=!0;continue}C.filtered=++f>wV}let p=c.selectAll(".rapid-catalog-dataset").data(h,C=>C.id);p.exit().remove();let m=p.enter().append("div").attr("class","rapid-catalog-dataset"),g=m.append("div").attr("class","rapid-catalog-dataset-label");g.append("div").attr("class","rapid-catalog-dataset-name"),g.append("div").attr("class","dataset-categories").selectAll(".dataset-category").data(C=>{let k=new Set(C.categories);return C.beta&&k.add("preview"),Array.from(k).sort(this.sortCategories)},C=>C).enter().append("div").attr("class",C=>`dataset-category dataset-category-${C}`+(C==="preview"?" beta":"")),g.append("div").attr("class","rapid-catalog-dataset-snippet");let x=g.filter(C=>C.itemUrl).append("div").attr("class","rapid-catalog-dataset-more-info").append("a").attr("class","rapid-catalog-dataset-link").attr("target","_blank").attr("href",C=>C.itemUrl);x.append("span").attr("class","rapid-catalog-dataset-link-text"),x.call(X("#rapid-icon-out-link","inline")),g.append("div").attr("class","dataset-added-text"),g.append("button").attr("class","rapid-catalog-dataset-action").on("click",this.toggleDataset),m.append("div").attr("class","rapid-catalog-dataset-thumb").append("img").attr("class","rapid-catalog-dataset-thumbnail").classed("inverted",C=>C.categories.has("esri")).attr("src",C=>C.thumbnailUrl),p=p.merge(m).order(),p.classed("added",C=>C.added).classed("hide",C=>C.filtered),p.selectAll(".rapid-catalog-dataset-name").html(C=>this.highlight(this._filterText,C.getLabel())),p.selectAll(".rapid-catalog-dataset-link-text").text(r.t("rapid_menu.more_info")),m.selectAll(".dataset-category").text(C=>{if(C==="preview")return"";let k=C==="featured"?"\u2B50 ":"",v=r.t(`rapid_menu.category.${C}`,{default:C});return k+v}),p.selectAll(".dataset-category-preview").attr("title",r.t("rapid_poweruser.beta")),p.selectAll(".rapid-catalog-dataset-snippet").html(C=>this.highlight(this._filterText,C.getDescription())),p.selectAll(".dataset-added-text").text(C=>C.added?"\u2705 "+r.t("rapid_menu.dataset_added"):""),p.selectAll(".rapid-catalog-dataset-action").classed("secondary",C=>C.added).text(C=>C.added?r.t("rapid_menu.remove"):r.t("rapid_menu.add_dataset"));let _=h.filter(C=>!C.filtered).length,S=f>wV?">":"";o.selectAll(".rapid-catalog-filter-results").text(r.t("rapid_menu.datasets_found",{n:_,gt:S}))}sortDatasets(e,t){return e.added&&!t.added?-1:t.added&&!e.added?1:e.featured&&!t.featured?-1:t.featured&&!e.featured?1:e.label.localeCompare(t.label)}sortCategories(e,t){return e==="featured"&&t!=="featured"?-1:t==="featured"&&e!=="featured"||e==="preview"&&t!=="preview"?1:t==="preview"&&e!=="preview"?-1:e.localeCompare(t)}toggleDataset(e,t){let r=this.context,i=r.systems.rapid,s=i.datasets;s.has(t.id)?i.removeDatasets(t.id):(i.enableDatasets(t.id),t.categories.has("esri")&&t.categories.has("buildings")&&s.has("msBuildings")&&i.disableDatasets("msBuildings")),r.enter("browse"),this.render()}highlight(e,t){let r=t;if(e){let s=new RegExp("("+i(e)+")","gi");r=r.replace(s,"<mark>$1</mark>")}return r;function i(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}};var Vf=class{constructor(e){this.context=e;let t=e.systems.l10n,r=e.systems.gfx.scene;this.ColorPicker=null,this.$modal=null,this.show=this.show.bind(this),this.render=this.render.bind(this),this.rerender=()=>this.render(),this.renderDatasets=this.renderDatasets.bind(this),this.changeColor=this.changeColor.bind(this),this.toggleDataset=this.toggleDataset.bind(this),this.toggleRapid=this.toggleRapid.bind(this),r.on("layerchange",this.rerender),t.on("localechange",this.rerender)}show(){let e=this.context,t=e.container();t.selectAll(".shaded").size()||(this.$modal=vr(t),this.$modal.select(".modal").attr("class","modal rapid-modal"),this.ColorPicker=W_(e,this.$modal).on("change",this.changeColor),this.$modal.select(".content").attr("class","content rapid-stack"),this.render())}render(){if(!this.$modal)return;let e=this.context,t=e.systems.l10n,r=e.systems.gfx.scene,i=t.isRTL()?"-rtl":"",s=r.layers.get("rapid")?.enabled,o=this.$modal.select(".content"),a=o.selectAll(".rapid-toggle-all").data([0]),l=a.enter().append("div").attr("class","modal-section rapid-checkbox rapid-toggle-all"),c=l.append("div").attr("class","rapid-feature-label-container");c.append("div").attr("class","rapid-feature-label"),c.append("span").attr("class","rapid-feature-hotkey");let u=l.append("div").attr("class","rapid-checkbox-inputs").append("label").attr("class","rapid-checkbox-label");u.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",this.toggleRapid),u.append("div").attr("class","rapid-checkbox-custom"),a=a.merge(l),a.selectAll(".rapid-feature-label").html(t.t("rapid_menu.toggle_all",{rapidicon:Ce(`#rapid-logo-rapid-wordmark${i}`,"logo-rapid")}));let d=Te("\u21E7"+t.t("shortcuts.command.toggle_rapid_data.key"));a.selectAll(".rapid-feature-hotkey").text("("+d+")"),a.selectAll(".rapid-feature-checkbox").property("checked",s);let f=o.selectAll(".rapid-datasets-container").data([0]),h=f.enter().append("div").attr("class","rapid-datasets-container");f=f.merge(h),f.call(this.renderDatasets);let p=o.selectAll(".rapid-manage-datasets").data([0]),m=p.enter().append("div").attr("class","modal-section rapid-checkbox rapid-manage-datasets").on("click",()=>{let b=new Wf(e,this.$modal).on("done",this.rerender);e.container().call(b.show)});m.append("div").attr("class","rapid-feature-label-container").append("div").attr("class","rapid-feature-label"),m.append("div").attr("class","rapid-checkbox-inputs").append("div").attr("class","rapid-checkbox-label").call(X("","icon-30")),p=p.merge(m),p.selectAll(".rapid-feature-label").text(t.t("rapid_menu.add_manage_datasets")),p.selectAll(".rapid-checkbox-label use").attr("xlink:href",t.isRTL()?"#rapid-icon-backward":"#rapid-icon-forward");let g=o.selectAll(".modal-section.buttons").data([0]),y=g.enter().append("div").attr("class","modal-section buttons");y.append("button").attr("class","button ok-button action").on("click",()=>this.$modal.close());let x=y.selectAll("button").node();x&&x.focus(),g=g.merge(y),g.selectAll(".button").text(t.t("confirm.okay"))}renderDatasets(e){let t=this.context,r=t.systems.l10n,i=t.systems.map,s=t.systems.rapid,o=t.systems.gfx.scene,a=t.systems.storage,l=o.layers.get("rapid")?.enabled,c=a.getItem("rapid-internal-feature.previewDatasets")==="true",u=[...s.datasets.values()].filter(_=>_.added&&(c||!_.beta)),d=e.selectAll(".rapid-checkbox-dataset").data(u,_=>_.id);d.exit().remove();let f=d.enter().append("div").attr("class","rapid-checkbox rapid-checkbox-dataset"),h=f.append("div").attr("class","rapid-feature"),p=h.append("div").attr("class","rapid-feature-label-container");p.append("div").attr("class","rapid-feature-label"),p.filter(_=>_.beta).append("div").attr("class","rapid-feature-label-beta beta");let m=h.append("div").attr("class","rapid-feature-extent-container");m.each((_,S,C)=>{let k=H(C[S]);_.extent&&_.extent.area()<1e4?k.append("a").attr("class","rapid-feature-extent-center-map").attr("href","#").on("click",v=>{v.preventDefault(),i.extent(_.extent)}):k.append("span").attr("class","rapid-feature-extent-worldwide")});let g=m.filter(_=>_.licenseUrl);g.append("div").attr("class","rapid-feature-label-divider");let y=g.append("div").attr("class","rapid-feature-license").append("a").attr("class","rapid-feature-licence-link").attr("target","_blank").attr("href",_=>_.licenseUrl);y.append("span").attr("class","rapid-feature-license-link-text"),y.call(X("#rapid-icon-out-link","inline"));let x=f.append("div").attr("class","rapid-checkbox-inputs");x.append("label").attr("class","rapid-colorpicker-label");let b=x.append("label").attr("class","rapid-checkbox-label");b.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",this.toggleDataset),b.append("div").attr("class","rapid-checkbox-custom"),d=d.merge(f),d.classed("disabled",!l),d.selectAll(".rapid-feature-label").text(_=>_.getLabel()),d.selectAll(".rapid-feature-label-beta").attr("title",r.t("rapid_poweruser.beta")),d.selectAll(".rapid-feature-description").text(_=>_.description),d.selectAll(".rapid-feature-license-link-text").text(r.t("rapid_menu.license")),d.selectAll(".rapid-feature-extent-center-map").text(r.t("rapid_menu.center_map")),d.selectAll(".rapid-feature-extent-worldwide").text(r.t("rapid_menu.worldwide")),d.selectAll(".rapid-colorpicker-label").attr("disabled",l?null:!0).call(this.ColorPicker),d.selectAll(".rapid-checkbox-label").classed("disabled",!l),d.selectAll(".rapid-feature-checkbox").property("checked",_=>_.enabled).attr("disabled",l?null:!0)}toggleRapid(){this.context.systems.gfx.scene.toggleLayers("rapid")}toggleDataset(e,t){let r=this.context,i=r.systems.rapid;r.enter("browse"),i.toggleDatasets(t.id)}changeColor(e,t){let r=this.context,i=r.systems.gfx,s=r.systems.rapid,o=i.scene,a=s.datasets.get(e);if(a){a.color=t,o.dirtyLayers(["rapid","rapid-overlay"]),i.immediateRedraw(),this.render();let l=r.mode;if(l?.id==="select"){let c=new Map(l.selectedData);r.enter("select",{selection:c})}}}};var jf=class{constructor(e){this.context=e;let t=e.systems.l10n,r=e.systems.urlhash;this.featureFlags=["previewDatasets","tagnosticRoadCombine","tagSources","showAutoFix","allowLargeEdits"],this.$modal=null,this.show=this.show.bind(this),this.render=this.render.bind(this),this.rerender=()=>this.render(),this.renderFeatures=this.renderFeatures.bind(this),this.updateFeatureFlags=this.updateFeatureFlags.bind(this),this.isFeatureEnabled=this.isFeatureEnabled.bind(this),this.toggleFeature=this.toggleFeature.bind(this),t.on("localechange",this.rerender),r.on("hashchange",this.updateFeatureFlags)}show(){let t=this.context.container();t.selectAll(".shaded").size()||(this.updateFeatureFlags(),this.$modal=vr(t),this.$modal.select(".modal").attr("class","modal rapid-modal"),this.$modal.select(".content").attr("class","content rapid-stack poweruser"),this.render())}render(){if(!this.$modal)return;let t=this.context.systems.l10n,r=this.$modal.select(".content"),i=r.selectAll(".modal-section-heading").data([0]),s=i.enter().append("div").attr("class","modal-section-heading");s.append("h3").attr("class","modal-heading");let o=s.append("div").attr("class","modal-heading-desc");o.append("span").attr("class","modal-heading-desc-text"),o.append("span").attr("class","smile").text("\u{1F60E}"),i=i.merge(s),i.selectAll(".modal-heading").html(t.t("rapid_poweruser.heading.label")),i.selectAll(".modal-heading-desc-text").text(t.t("rapid_poweruser.heading.description"));let a=r.selectAll(".rapid-features-container").data([0]),l=a.enter().append("div").attr("class","rapid-features-container");a=a.merge(l),a.call(this.renderFeatures);let c=r.selectAll(".modal-section.buttons").data([0]),u=c.enter().append("div").attr("class","modal-section buttons");u.append("button").attr("class","button ok-button action").on("click",()=>this.$modal.close());let d=u.selectAll("button").node();d&&d.focus(),c=c.merge(u),c.selectAll(".button").text(t.t("confirm.okay"))}renderFeatures(e){let r=this.context.systems.l10n,i=e.selectAll(".rapid-checkbox-feature").data(this.featureFlags,c=>c),s=i.enter().append("div").attr("class","rapid-checkbox rapid-checkbox-feature"),o=s.append("div").attr("class","rapid-feature");o.append("div").attr("class","rapid-feature-label"),o.append("div").attr("class","rapid-feature-description");let l=s.append("div").attr("class","rapid-checkbox-inputs").append("label").attr("class","rapid-checkbox-label");l.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",this.toggleFeature),l.append("div").attr("class","rapid-checkbox-custom"),i=i.merge(s),i.selectAll(".rapid-feature-label").text(c=>r.t(`rapid_poweruser.${c}.label`)),i.selectAll(".rapid-feature-description").text(c=>r.t(`rapid_poweruser.${c}.description`)),i.selectAll(".rapid-feature-checkbox").property("checked",this.isFeatureEnabled)}updateFeatureFlags(e,t){let r=!0;if(e&&t&&(r=e.get("poweruser")!==t.get("poweruser")),!r)return;let i=this.context,s=i.systems.urlhash,o=i.systems.storage;if(s.getParam("poweruser")==="true")for(let l of this.featureFlags){let c=o.getItem(`rapid-internal-feature.was.${l}`);c&&(o.setItem(`rapid-internal-feature.${l}`,c),o.removeItem(`rapid-internal-feature.was.${l}`))}else for(let l of this.featureFlags){let c=o.getItem(`rapid-internal-feature.${l}`);c&&(o.setItem(`rapid-internal-feature.was.${l}`,c),o.removeItem(`rapid-internal-feature.${l}`))}}isFeatureEnabled(e){return this.context.systems.storage.getItem(`rapid-internal-feature.${e}`)==="true"}toggleFeature(e,t){let r=this.context,i=r.systems.gfx,s=r.systems.rapid,o=r.systems.storage,a=o.getItem(`rapid-internal-feature.${t}`)==="true";if(a=!a,o.setItem(`rapid-internal-feature.${t}`,a),t==="previewDatasets"&&!a){for(let l of s.datasets.values())l.beta&&(l.added=!1,l.enabled=!1);r.enter("browse"),i.immediateRedraw()}}};var E5=class{constructor(e){this.context=e,this.id="rapid_features",this.stringID="toolbar.rapid_features";let t=e.systems.gfx.scene,r=e.systems.ui,i=e.systems.urlhash;this.RapidModal=new Vf(e),this.PowerUserModal=new jf(e),this.RapidTooltip=de(e),this.PowerUserTooltip=de(e),this.$parent=null,this.choose=this.choose.bind(this),this.render=this.render.bind(this),this.rerender=()=>this.render(),r.on("uichange",this.rerender),i.on("hashchange",this.rerender),t.on("layerchange",this.rerender),e.on("modechange",this.rerender)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.l10n,i=t.systems.urlhash,s=t.systems.ui,o=t.container(),a=i.getParam("poweruser")==="true",l=o.selectAll(".map-toolbar.narrow").size(),c=r.isRTL()?"-rtl":"";this.RapidTooltip.placement("bottom").scrollContainer(o.select(".map-toolbar")).title(r.t("shortcuts.command.toggle_rapid_data.label")).shortcut(Te("\u21E7"+r.t("shortcuts.command.toggle_rapid_data.key"))),this.PowerUserTooltip.placement("bottom").scrollContainer(o.select(".map-toolbar")).title(r.t("rapid_poweruser.heading.label"));let u=e.selectAll(".joined").data([0]),d=u.enter().append("div").attr("class","joined").style("display","flex");u=u.merge(d);let f=u.selectAll("button.rapid-features").data([this.RapidModal]),h=f.enter().append("button").attr("class","bar-button rapid-features").on("click",this.choose).call(this.RapidTooltip);h.append("svg").attr("class","logo-rapid").append("use"),f=f.merge(h).classed("layer-off",!this.isLayerEnabled()),f.selectAll(".logo-rapid use").attr("xlink:href",l?`#rapid-logo-rapid${c}`:`#rapid-logo-rapid-wordmark${c}`);let p=u.selectAll("button.rapid-poweruser-features").data(a?[this.PowerUserModal]:[]);p.exit().remove(),p.enter().append("button").attr("class","bar-button rapid-poweruser-features").on("click",this.choose).call(this.PowerUserTooltip).append("div").attr("class","beta"),(p.enter().size()||p.exit().size())&&s.checkOverflow(".map-toolbar",!0)}choose(e,t){e&&e.preventDefault(),t&&t.show()}isLayerEnabled(){return this.context.systems.gfx.scene.layers.get("rapid")?.enabled}};var T5=class{constructor(e){this.context=e,this.id="save",this.stringID="save.title",this.key=Te("\u2318S"),this._numChanges=0,this.Tooltip=de(e),this.$parent=null,this.choose=this.choose.bind(this),this.render=this.render.bind(this),this.rerender=()=>this.render();let t=e.systems.editor;e.on("modechange",this.rerender),t.on("stablechange",this.rerender),e.keybinding().on(this.key,this.choose,!0)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.editor,i=t.systems.l10n,s=r.difference().summary().size;this.Tooltip.placement("bottom").scrollContainer(t.container().select(".map-toolbar")).title(i.t(s>0?"save.help":"save.no_changes")).shortcut(this.key);let o=e.selectAll("button.save").data([0]),a=o.enter().append("button").attr("class","save disabled bar-button").on("click",this.choose).call(this.Tooltip).call(X("#rapid-icon-save"));a.append("span").attr("class","count").attr("aria-hidden","true").text("0"),o=o.merge(a),o.classed("disabled",this.isDisabled()).style("background",this.bgColor(s)),o.selectAll("span.count").text(s),this.isSaving()&&o.call(this.Tooltip.hide)}isSaving(){return this.context.mode?.id==="save"}isDisabled(){let e=this.context,t=e.systems.editor;return e.inIntro||!t.hasChanges()||this.isSaving()}choose(e){e&&e.preventDefault(),!this.isDisabled()&&this.context.enter("save")}bgColor(e){let t;return e===0?null:e<=50?(t=e/50,Xo("#fff","#ff8")(t)):(t=Math.min((e-50)/50,1),Xo("#ff8","#f88")(t))}};var k5=class{constructor(e){this.context=e,this.id="undo_redo",this.stringID="toolbar.undo_redo";let t=e.systems.editor,r=e.systems.l10n,i=e.systems.map;this.Tooltip=de(e).title(s=>{let o=s.annotation();return o?.description&&(o=o.description),o?r.t(`${s.id}.tooltip`,{action:o}):r.t(`${s.id}.nothing`)}).shortcut(s=>s.key),this.commands=[{id:"undo",key:Te("\u2318Z"),action:()=>t.undo(),annotation:()=>t.getUndoAnnotation(),getIcon:()=>r.isRTL()?"redo":"undo"},{id:"redo",key:Te("\u2318\u21E7Z"),action:()=>t.redo(),annotation:()=>t.getRedoAnnotation(),getIcon:()=>r.isRTL()?"undo":"redo"}],this.$parent=null,this.choose=this.choose.bind(this),this.render=this.render.bind(this),this.rerender=()=>this.render(),this.debouncedRender=Xt(this.rerender,500,{leading:!0,trailing:!0});for(let s of this.commands)e.keybinding().on(s.key,o=>this.choose(o,s));i.on("draw",this.debouncedRender),t.on("stablechange",this.rerender),e.on("modechange",this.rerender)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context;this.Tooltip.placement("bottom").scrollContainer(t.container().select(".map-toolbar"));let r=e.selectAll(".joined").data([0]),i=r.enter().append("div").attr("class","joined").style("display","flex");r=r.merge(i);let s=r.selectAll("button").data(this.commands,a=>a.id),o=s.enter().append("button").attr("class",a=>`disabled ${a.id}-button bar-button`).on("click",this.choose).call(this.Tooltip).call(X(""));s=s.merge(o),s.each((a,l,c)=>{let u=H(c[l]);u.classed("disabled",!t.editable()||!a.annotation());let d="#rapid-icon-"+a.getIcon();u.selectAll(".icon use").attr("href",d),u.select(".tooltip.in").empty()||u.call(this.Tooltip.updateContent)})}choose(e,t){if(e&&e.preventDefault(),!t)return;let r=this.context,i=t.annotation();r.editable()&&i&&t.action()}};var Xf=class{constructor(e){this.context=e,this.DrawModes=new A5(e),this.Rapid=new E5(e),this.UndoRedo=new k5(e),this.Save=new T5(e),this.Download=new C5(e),this.$parent=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),e.systems.urlhash.on("hashchange",this.rerender)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.l10n,i=t.systems.urlhash,s=t.systems.ui,o=["spacer",this.DrawModes,this.Rapid,"spacer",this.UndoRedo,this.Save,this.Download];e.selectAll(".map-toolbar").data([0]).enter().append("div").attr("class","map-toolbar fillD");let l=e.selectAll(".map-toolbar").selectAll(".toolbar-item").data(o,(f,h)=>f.id||`spacer${h}`),c=l.enter().append("div").attr("class",f=>{let h="toolbar-item "+(f.id||f).replace("_","-");return f.klass&&(h+=" "+f.klass),h}),u=c.filter(f=>f!=="spacer");u.append("div").attr("class","item-content"),u.append("div").attr("class","item-label"),l=l.merge(c);let d=i.getParam("download_osc")==="true";l.filter(f=>f.id==="download_osc").classed("hide",!d),l.selectAll(".item-content").each((f,h,p)=>{H(p[h]).call(f.render)}),l.selectAll(".item-label").text(f=>r.t(f.stringID)),s.checkOverflow(".map-toolbar",!0)}};function V_(n){let e=n.systems.l10n,t;function r(o){if(t.isNew())return;let a=o.selectAll(".comments-container").data([0]);a=a.enter().append("div").attr("class","comments-container").merge(a);let l=a.selectAll(".comment").data(t.comments).enter().append("div").attr("class","comment");l.append("div").attr("class",d=>`comment-avatar user-${d.uid}`).call(X("#rapid-icon-avatar","comment-avatar-icon"));let c=l.append("div").attr("class","comment-main"),u=c.append("div").attr("class","comment-metadata");u.append("div").attr("class","comment-author").each((d,f,h)=>{let p=H(h[f]),m=n.services.osm;m&&d.user&&(p=p.append("a").attr("class","comment-author-link").attr("href",m.userURL(d.user)).attr("target","_blank")),p.html(g=>g.user||e.tHtml("note.anonymous"))}),u.append("div").attr("class","comment-date").html(d=>e.t(`note.status.${d.action}`,{when:s(d.date)})),c.append("div").attr("class","comment-text").html(d=>d.html).selectAll("a").attr("rel","noopener nofollow").attr("target","_blank"),a.call(i)}function i(o){let l=n.systems.storage.getItem("preferences.privacy.thirdpartyicons")??"true",c=n.services.osm;if(l!=="true"||!c)return;let u=new Set;for(let d of t.comments)d.uid&&u.add(d.uid);for(let d of u)c.loadUser(d,(f,h)=>{!h||!h.image_url||o.selectAll(`.comment-avatar.user-${d}`).html("").append("img").attr("class","icon comment-avatar-icon").attr("src",h.image_url).attr("alt",h.display_name)})}function s(o){if(!o)return null;let a={day:"numeric",month:"short",year:"numeric"};o=o.replace(/-/g,"/");let l=new Date(o);if(isNaN(l.getTime()))return null;let c=n.systems.l10n.localeCode();return l.toLocaleDateString(c,a)}return r.note=function(o){return arguments.length?(t=o,r):t},r}function j_(n){let e=n.systems.l10n,t;function r(i){let s=i.selectAll(".note-header").data(t?[t]:[],l=>l.status+l.id);s.exit().remove();let o=s.enter().append("div").attr("class","note-header"),a=o.append("div").attr("class",l=>`note-header-icon ${l.status}`).classed("new",l=>l.id<0);a.append("div").attr("class","preset-icon-28").call(X("#rapid-icon-note","note-fill")),a.each(l=>{let c;l.id<0?c="#rapid-icon-plus":l.status==="open"?c="#rapid-icon-close":c="#rapid-icon-apply",a.append("div").attr("class","note-icon-annotation").call(X(c,"icon-annotation"))}),o.append("div").attr("class","note-header-label").text(l=>t.isNew()?e.t("note.new"):e.t("note.note")+" "+l.id+" "+(l.status==="closed"?e.t("note.closed"):""))}return r.note=function(i){return arguments.length?(t=i,r):t},r}function X_(n){let e=n.systems.l10n,t;function r(i){let s,o=n.services.osm;o&&t instanceof Qe&&!t.isNew()&&(s=o.noteReportURL(t));let a=i.selectAll(".note-report").data(s?[s]:[]);a.exit().remove(),a.enter().append("a").attr("class","note-report").attr("target","_blank").attr("href",c=>c).call(X("#rapid-icon-out-link","inline")).append("span").text(e.t("note.report"))}return r.note=function(i){return arguments.length?(t=i,r):t},r}function qf(n){let e=n.systems.l10n,t=ge("change"),r=V_(n),i=j_(n),s=new qn(n);var o,a;function l(g){var y=g.selectAll(".header").data([0]),x=y.enter().append("div").attr("class","header fillL");x.append("button").attr("class","close").on("click",function(){n.enter("browse")}).call(X("#rapid-icon-close")),x.append("h3").text(e.t("note.title"));var b=g.selectAll(".body").data([0]);b=b.enter().append("div").attr("class","body").merge(b);var _=b.selectAll(".note-editor").data([0]);_.enter().append("div").attr("class","modal-section note-editor").merge(_).call(i.note(o)).call(r.note(o)).call(c),s.stringID="inspector.view_on_osm",s.url=C?.noteURL(o);let S=g.selectAll(".sidebar-footer").data([0]);S.enter().append("div").attr("class","sidebar-footer").merge(S).call(s.render).call(X_(n).note(o));var C=n.services.osm;C&&C.on("authchange",function(){g.call(l)})}function c(g){var y=o&&o.id===n.selectedIDs()[0],x=g.selectAll(".note-save").data(y?[o]:[],function(k){return k.status+k.id});x.exit().remove();var b=x.enter().append("div").attr("class","note-save save-section cf");b.append("h4").attr("class",".note-save-header").text(function(){return o.isNew()?e.t("note.newDescription"):e.t("note.newComment")});var _=b.append("textarea").attr("class","new-comment-input").attr("placeholder",e.t("note.inputPlaceholder")).attr("maxlength",1e3).property("value",function(k){return k.newComment}).call(Oe).on("keydown.note-input",S).on("input.note-input",C).on("blur.note-input",C);!_.empty()&&a&&_.node().focus(),x=b.merge(x).call(u).call(d);function S(k){if(k.keyCode===13&&k.metaKey){var v=n.services.osm;if(v){var w=v.authenticated();w&&o.newComment&&(k.preventDefault(),H(this).on("keydown.note-input",null),window.setTimeout(function(){o.isNew()?(x.selectAll(".save-button").node().focus(),h(o)):(x.selectAll(".comment-button").node().focus(),m(o))},10))}}}function C(){var k=H(this),v=k.property("value").trim()||void 0;o=o.update({newComment:v});var w=n.services.osm;w&&w.replaceNote(o),x.call(d)}}function u(g){var y=g.selectAll(".detail-section").data([0]);y=y.enter().append("div").attr("class","detail-section").merge(y);var x=n.services.osm;if(x){var b=x.authenticated(),_=y.selectAll(".auth-warning").data(b?[]:[0]);_.exit().transition().duration(200).style("opacity",0).remove();var S=_.enter().insert("div",".tag-reference-body").attr("class","field-warning auth-warning").style("opacity",0);S.call(X("#rapid-icon-alert","inline")),S.append("span").text(e.t("note.login")),S.append("a").attr("target","_blank").call(X("#rapid-icon-out-link","inline")).append("span").text(e.t("login")).on("click.note-login",function(k){k.preventDefault(),x.authenticate()}),S.transition().duration(200).style("opacity",1);var C=y.selectAll(".note-save-prose").data(b?[0]:[]);C.exit().remove(),C=C.enter().append("p").attr("class","note-save-prose").text(e.t("note.upload_explanation")).merge(C),x.userDetails(function(k,v){if(!k){var w=H(document.createElement("div"));v.image_url&&w.append("img").attr("src",v.image_url).attr("class","icon pre-text user-icon"),w.append("a").attr("class","user-info").text(v.display_name).attr("href",x.userURL(v.display_name)).attr("target","_blank"),C.html(e.tHtml("note.upload_explanation_with_user",{user:w.html()}))}})}}function d(g){var y=n.services.osm,x=y&&y.authenticated(),b=o&&o.id===n.selectedIDs()[0],_=g.selectAll(".buttons").data(b?[o]:[],function(k){return k.status+k.id});_.exit().remove();var S=_.enter().append("div").attr("class","buttons");o.isNew()?(S.append("button").attr("class","button cancel-button secondary-action").text(e.t("confirm.cancel")),S.append("button").attr("class","button save-button action").text(e.t("note.save"))):(S.append("button").attr("class","button status-button action"),S.append("button").attr("class","button comment-button action").text(e.t("note.comment"))),_=_.merge(S),_.select(".cancel-button").on("click.cancel",f),_.select(".save-button").attr("disabled",C).on("click.save",h),_.select(".status-button").attr("disabled",x?null:!0).text(function(k){var v=k.status==="open"?"close":"open",w=k.newComment?"_comment":"";return e.t("note."+v+w)}).on("click.status",p),_.select(".comment-button").attr("disabled",C).on("click.comment",m);function C(k){return x&&k.status==="open"&&k.newComment?null:!0}}function f(g,y){this.blur();var x=n.services.osm;x&&x.removeNote(y),n.enter("browse"),t.call("change")}function h(g,y){this.blur();var x=n.services.osm;x&&x.postNoteCreate(y,function(b,_){t.call("change",_)})}function p(g,y){this.blur();var x=n.services.osm;if(x){var b=y.status==="open"?"closed":"open";x.postNoteUpdate(y,b,function(_,S){t.call("change",S)})}}function m(g,y){this.blur();var x=n.services.osm;x&&x.postNoteUpdate(y,y.status,function(b,_){t.call("change",_)})}return l.note=function(g){return arguments.length?(o=g,l):o},l.newNote=function(g){return arguments.length?(a=g,l):a},xe(l,t,"on")}var Yf=class{constructor(e){this.context=e,this.datum=null,this._keys=null,this.$parent=null,this.$inspector=null,this.AcceptTooltip=de(e).placement("bottom"),this.IgnoreTooltip=de(e).placement("bottom"),this.render=this.render.bind(this),this.renderFeatureInfo=this.renderFeatureInfo.bind(this),this.renderPropertyInfo=this.renderPropertyInfo.bind(this),this.renderNotice=this.renderNotice.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,i=t.systems.l10n.isRTL()?"-rtl":"",s=e.selectAll(".overture-inspector").data([0]),o=s.enter().append("div").attr("class","overture-inspector"),a=o.append("div").attr("class","header");a.append("h3").append("img").attr("class","wordmark-overture"),a.append("button").attr("class","overture-inspector-close").on("click",()=>t.enter("browse")).call(X("#rapid-icon-close")),o.append("div").attr("class","body"),this.$inspector=s=s.merge(o),s.selectAll("img.wordmark-overture").attr("src",this.context.assetPath+"img/omf-wordmark"+i+".svg"),s.selectAll(".logo-overture > use").attr("xlink:href",`#overture-logo-overture-wordmark${i}`),s.selectAll(".body").call(this.renderFeatureInfo).call(this.renderPropertyInfo).call(this.renderNotice)}getBrightness(e){let t=e.length<6,r=parseInt(t?e[1]+e[1]:e[1]+e[2],16),i=parseInt(t?e[2]+e[2]:e[3]+e[4],16),s=parseInt(t?e[3]+e[3]:e[5]+e[6],16);return(r*299+i*587+s*114)/1e3}renderFeatureInfo(e){let t=this.datum;if(!t)return;let i=this.context.systems.rapid,s=t.__datasetid__,o=i.datasets.get(s),a=o.color,l=e.selectAll(".feature-info").data([0]),c=l.enter().append("div").attr("class","feature-info");c.append("div").attr("class","dataset-label"),l=l.merge(c),l.style("background",a).style("color",this.getBrightness(a)>140.5?"#333":"#fff"),l.selectAll(".dataset-label").text(o.getLabel())}renderPropertyInfo(e){let t=this.datum?.geojson.properties;if(!t)return;let r=e.selectAll(".property-info").data([0]),i=r.enter().append("div").attr("class","property-info"),s=i.append("div").attr("class","property-bag");for(let[o,a]of Object.entries(t)){let l=s.append("div").attr("class","property-heading"),c=o;c.startsWith("@")&&(c=c.slice(1)),c=c.charAt(0).toUpperCase()+c.slice(1),l.text(c);let u=s.append("div").attr("class","property-entry"),d=this._getJsonStructure(a);if(d!==null)if(Object.keys(d).length!==0)if(Array.isArray(d))for(let f of d)if(f instanceof Object)for(let[h,p]of Object.entries(f))u.append("div").attr("class","property-value").text(h+":"+p);else u.append("div").attr("class","property-value").text(f);else for(let[f,h]of Object.entries(d))u.append("div").attr("class","property-value").text(f+":"+h);else u.append("div").attr("class","property-value").text(a)}r=r.merge(i)}_getJsonStructure(e){if(typeof e!="string")return null;try{return JSON.parse(e)}catch{return{}}}renderNotice(e){let t=this.context,r=t.systems.l10n,i=t.systems.rapid,s=this.datum;if(!s)return;let o=s.__datasetid__.replace("-conflated",""),a=i.datasets.get(o);if(a.tags.has("opendata")&&a.licenseUrl){let l=e.selectAll(".overture-inspector-notice").data([0]),c=l.enter().append("div").attr("class","overture-inspector-notice");l=l.merge(c),l.html(qe.parse(r.t("rapid_inspector.notice.open_data",{url:a.licenseUrl}))),l.selectAll("a").attr("target","_blank")}}};function q_(n){let e=n.systems.editor,t=n.systems.filters,r=n.systems.gfx,i=n.systems.l10n,s=n.systems.map,o=n.services.osmose,a=n.systems.presets,l=n.systems.gfx.scene,c;function u(f,h){if(!o||!f)return"";let p=o.getStrings(f.itemType);return h in p?p[h]:""}function d(f){let h=f.selectAll(".error-details").data(c?[c]:[],y=>y.key);h.exit().remove();let p=h.enter().append("div").attr("class","error-details qa-details-container");if(u(c,"detail")){let y=p.append("div").attr("class","qa-details-subsection");y.append("h4").text(i.t("QA.keepRight.detail_description")),y.append("p").attr("class","qa-details-description-text").html(x=>u(x,"detail")).selectAll("a").attr("rel","noopener").attr("target","_blank")}let m=p.append("div").attr("class","qa-details-subsection"),g=p.append("div").attr("class","qa-details-subsection");if(u(c,"fix")){let y=p.append("div").attr("class","qa-details-subsection");y.append("h4").text(i.t("QA.osmose.fix_title")),y.append("p").html(x=>u(x,"fix")).selectAll("a").attr("rel","noopener").attr("target","_blank")}if(u(c,"trap")){let y=p.append("div").attr("class","qa-details-subsection");y.append("h4").text(i.t("QA.osmose.trap_title")),y.append("p").html(x=>u(x,"trap")).selectAll("a").attr("rel","noopener").attr("target","_blank")}o&&o.loadIssueDetailAsync(c).then(y=>{c.id===y.id&&(!y.elems||y.elems.length===0||(y.detail&&(m.append("h4").text(i.t("QA.osmose.detail_title")),m.append("p").html(x=>x.detail).selectAll("a").attr("rel","noopener").attr("target","_blank")),g.append("h4").text(i.t("QA.osmose.elems_title")),g.append("ul").selectAll("li").data(y.elems).enter().append("li").append("a").attr("href","#").attr("class","error_entity_link").html(x=>x).each((x,b,_)=>{let S=_[b],C=H(S),k=S.textContent,v=e.staging.graph,w=v.hasEntity(k);if(C.on("mouseenter",()=>{Je([k],!0,n)}).on("mouseleave",()=>{Je([k],!1,n)}).on("click",A=>{A.preventDefault(),Je([k],!1,n),l.enableLayers("osm"),s.centerZoom(x.loc,20),s.selectEntityID(k)}),w){let A=i.displayName(w.tags);if(!A){let E=a.match(w,v);A=E&&!E.isFallback()&&E.name()}A&&(S.innerText=A)}}),t.forceVisible(y.elems),r.immediateRedraw()))}).catch(y=>console.error(y))}return d.issue=function(f){return arguments.length?(c=f,d):c},d}function Y_(n){let e=n.systems.l10n,t=n.services.osmose,r;function i(o){let a=e.t("inspector.unknown");if(!t||!o)return a;let l=t.getStrings(o.itemType);return"title"in l?l.title:a}function s(o){let a=16777215;t&&(a=t.getColor(r?.item));let l=o.selectAll(".qa-header").data(r?[r]:[],d=>d.key);l.exit().remove();let c=l.enter().append("div").attr("class","qa-header"),u=c.append("div").attr("class","qa-header-icon").append("svg").attr("width","20px").attr("height","27px").attr("viewbox","0 0 20 27").attr("class",d=>`qaItem ${d.service}`);u.append("polygon").attr("fill",new ce(a).toHex()).attr("stroke","#333").attr("points","16,3 4,3 1,6 1,17 4,20 7,20 10,27 13,20 16,20 19,17.033 19,6"),u.append("use").attr("class","icon-annotation").attr("width","13px").attr("height","13px").attr("transform","translate(3.5, 5)").attr("xlink:href",d=>d.icon?`#${d.icon}`:""),c.append("div").attr("class","qa-header-label").text(i)}return s.issue=function(o){return arguments.length?(r=o,s):r},s}function Kf(n){let e=n.systems.l10n,t=n.services.osmose,r=ge("change"),i=q_(n),s=Y_(n),o=new qn(n),a;function l(d){let h=d.selectAll(".header").data([0]).enter().append("div").attr("class","header fillL");h.append("button").attr("class","close").on("click",()=>n.enter("browse")).call(X("#rapid-icon-close")),h.append("h3").text(e.t("QA.osmose.title"));let p=d.selectAll(".body").data([0]);p=p.enter().append("div").attr("class","body").merge(p);let m=p.selectAll(".qa-editor").data([0]);m.enter().append("div").attr("class","modal-section qa-editor").merge(m).call(s.issue(a)).call(i.issue(a)).call(c),o.stringID="inspector.view_on_osmose",o.url=t.itemURL(a);let g=d.selectAll(".sidebar-footer").data([0]);g.enter().append("div").attr("class","sidebar-footer").merge(g).call(o.render)}function c(d){let f=a?.id,h=f&&n.selectedData().has(f),p=a&&h,m=d.selectAll(".qa-save").data(p?[a]:[],y=>y.key);m.exit().remove(),m=m.enter().append("div").attr("class","qa-save save-section cf").merge(m).call(u)}function u(d){let f=a?.id,h=f&&n.selectedData().has(f),p=d.selectAll(".buttons").data(h?[a]:[],g=>g.key);p.exit().remove();let m=p.enter().append("div").attr("class","buttons");m.append("button").attr("class","button close-button action"),m.append("button").attr("class","button ignore-button action"),p=p.merge(m),p.select(".close-button").text(e.t("QA.keepRight.close")).on("click.close",function(g,y){this.blur(),t&&(y.newStatus="done",t.postUpdate(y,(x,b)=>r.call("change",b)))}),p.select(".ignore-button").text(e.t("QA.keepRight.ignore")).on("click.ignore",function(g,y){this.blur(),t&&(y.newStatus="false",t.postUpdate(y,(x,b)=>r.call("change",b)))})}return l.error=function(d){return arguments.length?(a=d,l):a},xe(l,r,"on")}var[SV,CV]=[320,240],[AV,EV]=[45,105],Qf=class extends st{constructor(e){super(),this.context=e,this.$parent=null,this.$viewer=null,this.render=this.render.bind(this),this._buildResizer=this._buildResizer.bind(this),this._onMapResize=this._onMapResize.bind(this),e.systems.ui.on("uichange",this._onMapResize)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.l10n,i=t.systems.photos,s=r.isRTL(),o=e.selectAll(".photoviewer").data([0]),a=o.enter().append("div").attr("class","photoviewer nineslice").attr("dir","ltr").classed("hide",!0);a.append("button").attr("class","thumb-hide").on("click",()=>i.hideViewer()).append("div").call(X("#rapid-icon-close")),this.$viewer=o=o.merge(a);for(let l of["top","middle","bottom"])for(let c of["left","middle","right"]){let u=`${l}-${c}`;o.selectAll(`.${u}`).data([u]).enter().append("div").attr("class",u).on("touchstart touchdown touchend",f=>f.preventDefault());let d=o.selectAll(`.${u}`);u==="top-left"&&s?d.style("cursor","nwse-resize").on("pointerdown",this._buildResizer(u)):u==="top-middle"?d.style("cursor","ns-resize").on("pointerdown",this._buildResizer(u)):u==="top-right"&&!s?d.style("cursor","nesw-resize").on("pointerdown",this._buildResizer(u)):u==="middle-left"&&s?d.style("cursor","ew-resize").on("pointerdown",this._buildResizer(u)):u==="middle-right"&&!s?d.style("cursor","ew-resize").on("pointerdown",this._buildResizer(u)):d.style("cursor",null).on("pointerdown",null)}}_buildResizer(e){let t,r,i,s,o,a=u=>{u.preventDefault(),u.stopPropagation(),t=u.pointerId||"mouse",r=u.clientX,i=u.clientY;let d=this.$viewer.node().getBoundingClientRect();s=d.width,o=d.height,H(window).on("pointermove.resize",l).on("pointerup.resize pointercancel.resize",c)},l=u=>{if(t!==(u.pointerId||"mouse"))return;u.preventDefault(),u.stopPropagation();let f=this.context.container().selectAll(".main-content").node().getBoundingClientRect(),[h,p]=[f.width-AV,f.height-EV],[m,g]=[s,o],y=u.clientX-r,x=u.clientY-i;/left/.test(e)&&(m-=y),/right/.test(e)&&(m+=y),/top/.test(e)&&(g-=x),m=dt(m,SV,h),g=dt(g,CV,p),this.$viewer.style("width",`${m}px`).style("height",`${g}px`),this.emit("resize",[m,g])},c=u=>{t===(u.pointerId||"mouse")&&(u.preventDefault(),u.stopPropagation(),H(window).on("pointermove.resize pointerup.resize pointercancel.resize",null))};return a}_onMapResize(){let e=this.context.container().selectAll(".main-content"),t=this.$viewer;if(!e.size()||!t)return;let r=e.node().getBoundingClientRect(),i=t.node().getBoundingClientRect(),[s,o]=[r.width-AV,r.height-EV],[a,l]=[i.width,i.height];if(a===0||l===0)return;let c=dt(a,SV,s),u=dt(l,CV,o);(a!==c||l!==u)&&(t.style("width",`${c}px`).style("height",`${u}px`),this.emit("resize",[c,u]))}};var Zf=class{constructor(e){this.context=e,this._isHidden=!0,this.Spector=null,this.CaptureMenu=null,this.ResultView=null,this.$parent=null,this.$wrap=null,this.render=this.render.bind(this),this.toggle=this.toggle.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=e.selectAll(".spector").data([0]),r=t.enter().append("div").attr("class","spector");this.$wrap=t=t.merge(r).style("display",this._isHidden?"none":"block")}toggle(e){e&&e.preventDefault(),this._initSpectorUI();let t=this.$wrap,r=this.CaptureMenu;!t||!r||(this._isHidden?(this._isHidden=!1,r.display(),t.selectAll(".fpsCounterComponent").style("display","none"),t.style("display","block").style("opacity","0").transition().duration(200).style("opacity","1")):(this._isHidden=!0,t.transition().duration(200).style("opacity","0").on("end",()=>{t.style("display","none"),r.hide()})))}_initSpectorUI(){if(!this.$wrap||this.Spector||!window.SPECTOR)return;let r=this.context.systems.gfx.pixi.renderer;if(r.type!==Bt.WEBGL)return;let i=new window.SPECTOR.Spector;this.Spector=i;let s=r.context.canvas;i.spyCanvas(s);let o={rootPlaceHolder:this.$wrap.node(),canvas:s,hideLog:!0},a=new window.SPECTOR.EmbeddedFrontend.CaptureMenu(o);a.trackPageCanvases=()=>{},a.updateCanvasesList([s]),a.onPauseRequested.add(i.pause,i),a.onPlayRequested.add(i.play,i),a.onPlayNextFrameRequested.add(i.playNextFrame,i),a.onCaptureRequested.add(c=>{c&&i.captureCanvas(c.ref)},i),this.CaptureMenu=i.captureMenu=a;let l=new window.SPECTOR.EmbeddedFrontend.ResultView;i.onCapture.add(c=>{l.display(),l.addCapture(c)}),this.ResultView=i.resultView=l}};var Jf=class{constructor(e){this.context=e,this.Attribution=new cf(e),this.InfoCards=new wf(e),this.Map3dViewer=new Af(e),this.MapControls=new Ef(e),this.MapPanes=new Df(e),this.Minimap=new $f(e),this.PhotoViewer=new Qf(e),this.Spector=new Zf(e),this.$parent=null,this.render=this.render.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=e.selectAll(".over-map").data([0]),r=t.enter().append("div").attr("class","over-map");r.append("div").attr("class","select-trap").text("t"),t=t.merge(r),t.call(this.Minimap.render).call(this.Map3dViewer.render).call(this.Spector.render).call(this.MapControls.render).call(this.MapPanes.render).call(this.InfoCards.render).call(this.PhotoViewer.render).call(this.Attribution.render)}};var Rf=class{constructor(e){this.context=e,this.BugTooltip=de(e).placement("top"),this.TranslateTooltip=de(e).placement("top"),this.$parent=null,this.render=this.render.bind(this),this.reportIssue=this.reportIssue.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let r=this.context.systems.l10n,i=e.selectAll(".project-links").data([0]),s=i.enter().append("div").attr("class","project-links");s.append("button").attr("class","bugnub").attr("tabindex",-1).on("click",this.reportIssue).call(X("#rapid-icon-bug","bugnub")).call(this.BugTooltip),s.append("a").attr("target","_blank").attr("href","https://github.com/facebook/Rapid/blob/main/CONTRIBUTING.md#translations").call(X("#rapid-icon-translate","light")).call(this.TranslateTooltip),i=i.merge(s),this.BugTooltip.title(r.t("report_a_bug")),this.TranslateTooltip.title(r.t("help_translate"))}reportIssue(e){e&&e.preventDefault(),this.BugTooltip.hide();let t=new URL("https://github.com/facebook/Rapid/issues/new");t.searchParams.append("template","bug_report.yml");let r=Et(),i=`${r.browser} v${r.version}`,s=`${r.os}`,o=navigator.userAgent;t.searchParams.append("browser",i),t.searchParams.append("os",s),t.searchParams.append("useragent",o),t.searchParams.append("URL",window.location.href),t.searchParams.append("version",this.context.version),window.open(t.toString(),"_blank")}};function TV(n){let e=n.systems.l10n,t=n.systems.storage;return function(i){if(t.hasItem("sawRapidSplash"))return;t.setItem("sawRapidSplash",!0);let s=vr(i),o=e.isRTL()?"-rtl":"";s.select(".modal").attr("class","modal rapid-modal modal-splash");let a=s.select(".content");a.append("div").attr("class","modal-section").append("h3").text(e.t("rapid_splash.welcome")),a.append("div").attr("class","modal-section").append("p").html(e.t("rapid_splash.text",{rapidicon:Ce(`#rapid-logo-rapid-wordmark${o}`,"logo-rapid"),walkthrough:Ce("#rapid-logo-walkthrough","logo-walkthrough"),edit:Ce("#rapid-logo-features","logo-features")}));let l=a.append("div").attr("class","modal-actions"),c=l.append("button").attr("class","walkthrough").on("click",()=>{n.container().call(co(n,!1)),s.close()});c.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-walkthrough"),c.append("div").text(e.t("rapid_splash.walkthrough"));let u=l.append("button").attr("class","rapid-walkthrough").on("click",()=>{n.container().call(co(n,!0)),s.close()});u.append("svg").attr("class","logo logo-rapid").append("use").attr("xlink:href",`#rapid-logo-rapid-wordmark${o}`),u.append("div").text(e.t("rapid_splash.skip_to_rapid"));let d=l.append("button").attr("class","start-editing").on("click",()=>{s.close()});d.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-features"),d.append("div").text(e.t("rapid_splash.start")),s.select("button.close").attr("class","hide")}}function kV(n){let e=n.systems.l10n;return function(t){let r=vr(t),i=e.isRTL()?"-rtl":"";r.select(".modal").attr("class","modal rapid-modal");let s=r.select(".content");s.append("div").attr("class","modal-section").append("h3").html(e.t("rapid_first_edit.nice",{rapidicon:Ce(`#rapid-logo-rapid-wordmark${i}`,"logo-rapid")})),s.append("div").attr("class","modal-section").append("p").text(e.t("rapid_first_edit.text"));let o=s.append("div").attr("class","modal-actions");o.append("button").attr("class","rapid-explore").on("click",r.close).append("div").text(e.t("rapid_first_edit.exploring")),o.append("button").attr("class","rapid-login-to-osm").on("click",()=>{r.close();let c=n.services.osm;c&&c.authenticate(()=>n.container().call(TV(n)))}).append("div").text(e.t("rapid_first_edit.login_with_osm"))}}var DP=50,eh=class{constructor(e){this.context=e,this.datum=null,this._keys=null,this._keybinding=Xe("UiRapidInspector"),H(document).call(this._keybinding),this.$parent=null,this.$inspector=null,this.AcceptTooltip=de(e).placement("bottom"),this.IgnoreTooltip=de(e).placement("bottom"),this.render=this.render.bind(this),this.renderFeatureInfo=this.renderFeatureInfo.bind(this),this.renderTagInfo=this.renderTagInfo.bind(this),this.renderChoices=this.renderChoices.bind(this),this.renderChoice=this.renderChoice.bind(this),this.renderNotice=this.renderNotice.bind(this),this.acceptFeature=this.acceptFeature.bind(this),this.ignoreFeature=this.ignoreFeature.bind(this),this._setupKeybinding=this._setupKeybinding.bind(this),this.moveFeature=(r,i)=>this.acceptFeature(r,i,"move"),this.rotateFeature=(r,i)=>this.acceptFeature(r,i,"rotate"),e.systems.l10n.on("localechange",this._setupKeybinding),this._setupKeybinding()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,i=t.systems.l10n.isRTL()?"-rtl":"",s=e.selectAll(".rapid-inspector").data([0]),o=s.enter().append("div").attr("class","rapid-inspector"),a=o.append("div").attr("class","header");a.append("h3").append("svg").attr("class","logo-rapid").append("use"),a.append("button").attr("class","rapid-inspector-close").on("click",()=>t.enter("browse")).call(X("#rapid-icon-close")),o.append("div").attr("class","body"),this.$inspector=s=s.merge(o),s.selectAll(".logo-rapid > use").attr("xlink:href",`#rapid-logo-rapid-wordmark${i}`),s.selectAll(".body").call(this.renderFeatureInfo).call(this.renderTagInfo).call(this.renderChoices).call(this.renderNotice)}isAcceptFeatureDisabled(){let e=this.context,t=e.systems.rapid,r=e.systems.urlhash;return t.taskExtent||r.getParam("poweruser")==="true"?!1:t.acceptIDs.size>=DP}acceptFeature(e,t,r){let i=this.datum;if(!i)return;let s=this.context,o=s.systems.editor,a=s.systems.l10n,l=s.systems.rapid,c=s.systems.gfx.scene;if(this.isAcceptFeatureDisabled()){_f(s).duration(5e3).label(a.t("rapid_inspector.option_accept.disabled_flash",{n:DP}))();return}let d=s.services[i.__service__].graph(i.__datasetid__),f=i.__datasetid__.replace("-conflated",""),h=l.datasets.get(f),p={type:"rapid_accept_feature",description:a.t("rapid_inspector.option_accept.annotation"),entityID:i.id,dataUsed:h?.dataUsed||[f]};o.perform(Um(i.id,d)),o.commit({annotation:p,selectedIDs:[i.id]});let m=s.mode?.id||"";if(!r&&/^select/.test(m)&&(r="select-osm"),r)s.enter(r,{selection:{osm:[i.id]}});else{let g=s.behaviors.hover,y=g.lastMove,b=o.staging.graph.entity(i.id),_=c.layers.get("osm");y.target={displayObject:null,feature:null,featureID:null,layer:_,layerID:_.id,data:b,dataID:b.id},g._doHover()}this.datum=null,!s.inIntro&&window.sessionStorage.getItem("acknowledgedLogin")!=="true"&&window.sessionStorage.setItem("acknowledgedLogin","true")}ignoreFeature(e){let t=this.datum;if(!t)return;let r=this.context,i=r.systems.editor,o={type:"rapid_ignore_feature",description:r.systems.l10n.t("rapid_inspector.option_ignore.annotation"),entityID:t.id};i.perform(Om()),i.commit({annotation:o}),r.enter("browse"),this.datum=null}getBrightness(e){let t=e.length<6,r=parseInt(t?e[1]+e[1]:e[1]+e[2],16),i=parseInt(t?e[2]+e[2]:e[3]+e[4],16),s=parseInt(t?e[3]+e[3]:e[5]+e[6],16);return(r*299+i*587+s*114)/1e3}renderFeatureInfo(e){let t=this.datum;if(!t)return;let r=this.context,i=r.systems.l10n,s=r.systems.rapid,o=t.__datasetid__.replace("-conflated",""),a=s.datasets.get(o),l=a.color,c=e.selectAll(".feature-info").data([0]),u=c.enter().append("div").attr("class","feature-info");u.append("div").attr("class","dataset-label"),a.beta&&u.append("div").attr("class","dataset-beta beta"),c=c.merge(u),c.style("background",l).style("color",this.getBrightness(l)>140.5?"#333":"#fff"),c.selectAll(".dataset-label").text(a.getLabel()),c.selectAll(".dataset-beta").attr("title",i.t("rapid_poweruser.beta"))}renderTagInfo(e){let t=this.datum?.tags;if(!t)return;let i=this.context.systems.l10n,s=e.selectAll(".tag-info").data([0]),o=s.enter().append("div").attr("class","tag-info"),a=o.append("div").attr("class","tag-bag");a.append("div").attr("class","tag-heading");for(let[l,c]of Object.entries(t)){let u=a.append("div").attr("class","tag-entry");u.append("div").attr("class","tag-key").text(l),u.append("div").attr("class","tag-value").text(c)}s=s.merge(o),s.selectAll(".tag-heading").text(i.t("rapid_inspector.tags"))}renderChoices(e){let r=this.context.systems.l10n,i=[{key:"accept",iconName:"#rapid-icon-rapid-plus-circle",labelStringID:"rapid_inspector.option_accept.label",referenceStringID:"rapid_inspector.option_accept.description",tooltip:this.AcceptTooltip,onClick:this.acceptFeature},{key:"ignore",iconName:"#rapid-icon-rapid-minus-circle",labelStringID:"rapid_inspector.option_ignore.label",referenceStringID:"rapid_inspector.option_ignore.description",tooltip:this.IgnoreTooltip,onClick:this.ignoreFeature}],s=e.selectAll(".rapid-inspector-choices").data([0]),o=s.enter().append("div").attr("class","rapid-inspector-choices");o.append("p").attr("class","rapid-inspector-prompt"),o.selectAll(".rapid-inspector-choice").data(i,a=>a.key).enter().append("div").attr("class",a=>`rapid-inspector-choice rapid-inspector-choice-${a.key}`),s=s.merge(o),s.selectAll(".rapid-inspector-prompt").text(r.t("rapid_inspector.prompt")),s.selectAll(".rapid-inspector-choice").each(this.renderChoice)}renderNotice(e){let t=this.context,r=t.systems.l10n,i=t.systems.rapid,s=this.datum;if(!s)return;let o=s.__datasetid__.replace("-conflated",""),a=i.datasets.get(o);if(a.tags.has("opendata")&&a.licenseUrl){let l=e.selectAll(".rapid-inspector-notice").data([0]),c=l.enter().append("div").attr("class","rapid-inspector-notice");l=l.merge(c),l.html(qe.parse(r.t("rapid_inspector.notice.open_data",{url:a.licenseUrl}))),l.selectAll("a").attr("target","_blank")}}renderChoice(e,t,r){let i=H(r[t]),o=this.context.systems.l10n,a=e.key==="accept"&&this.isAcceptFeatureDisabled(),l=i.selectAll(".choice-wrap").data([e]),c=l.enter().append("div").attr("class","choice-wrap"),u=c.append("button").attr("class","choice-button").on("click",e.onClick).call(e.tooltip);u.append("svg").attr("class","choice-icon icon").append("use").attr("xlink:href",e.iconName),u.append("div").attr("class","choice-label"),c.append("button").attr("class","tag-reference-button").attr("tabindex","-1").on("click",m=>{m.currentTarget.blur();let g=i.selectAll(".tag-reference-body");g.classed("expanded",!g.classed("expanded"))}).call(X("#rapid-icon-inspect")),l=l.merge(c),l.selectAll("button").classed("secondary",a).classed("disabled",a),l.selectAll(".choice-label").text(o.t(e.labelStringID)),l.selectAll(".tag-reference-button").attr("title",o.t("icons.information"));let d,f;e.key==="accept"?a?(d=o.t("rapid_inspector.option_accept.disabled",{n:DP}),f=""):(d=o.t("rapid_inspector.option_accept.tooltip"),f=o.t("shortcuts.command.accept_feature.key")):e.key==="ignore"&&(d=o.t("rapid_inspector.option_ignore.tooltip"),f=o.t("shortcuts.command.ignore_feature.key")),e.tooltip.title(d).shortcut(f);let h=i.selectAll(".tag-reference-body").data([e]),p=h.enter().append("div").attr("class","tag-reference-body");h=h.merge(p),h.text(o.t(e.referenceStringID))}_setupKeybinding(){let e=this.context,t=this._keybinding,r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys);let i=r.t("shortcuts.command.accept_feature.key"),s=r.t("shortcuts.command.ignore_feature.key"),o=r.t("shortcuts.command.move.key"),a=r.t("shortcuts.command.rotate.key");this._keys=[i,s,o,a],t.on(i,this.acceptFeature),t.on(s,this.ignoreFeature),t.on(o,this.moveFeature),t.on(a,this.rotateFeature)}};function K_(n){let e=n.systems.editor,t=n.systems.l10n;return function(r){if(!e.canRestoreBackup)return;let i=vr(r,!0);i.select(".modal").attr("class","modal fillL");let s=i.select(".content");s.append("div").attr("class","modal-section").append("h3").text(t.t("restore.heading")),s.append("div").attr("class","modal-section").append("p").text(t.t("restore.description"));let o=s.append("div").attr("class","modal-actions"),a=o.append("button").attr("class","restore").on("click",()=>{e.restoreBackup(),i.remove()});a.append("svg").attr("class","logo logo-restore").append("use").attr("xlink:href","#rapid-logo-restore"),a.append("div").text(t.t("restore.restore"));let l=o.append("button").attr("class","reset").on("click",()=>{e.clearBackup(),i.remove()});l.append("svg").attr("class","logo logo-reset").append("use").attr("xlink:href","#rapid-logo-reset"),l.append("div").text(t.t("restore.reset")),a.node().focus()}}var _oe=180,voe=8,Ff=class{constructor(e){this.context=e;let t=e.systems.l10n,r=e.systems.gfx;this._isImperial=!t.isMetric(),this.$parent=null,this.$wrap=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this.toggleUnits=this.toggleUnits.bind(this),this.updateScale=this.updateScale.bind(this),this._deferredUpdateScale=mn(this.updateScale,100),r.on("draw",this._deferredUpdateScale)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=e.selectAll(".scale-wrap").data([0]),r=t.enter().append("div").attr("class","scale-wrap").on("click",this.toggleUnits);r.append("svg").attr("class","scale").append("path").attr("class","scale-path"),r.append("div").attr("class","scale-text"),this.$wrap=t=t.merge(r),this.updateScale()}updateScale(){if(!this.$wrap)return;let e=this.context,t=e.systems.l10n,r=e.viewport,i=r.dimensions[1],s=r.unproject([0,i]),o=r.unproject([_oe,i]),a=(o[1]+s[1])/2,l=this._isImperial?3.28084:1,c=Za(o[0]-s[0],a)*l,u;this._isImperial?u=[528e4,528e3,52800,5280,500,50,5,1]:u=[5e6,5e5,5e4,5e3,500,50,5,1];let d=0;for(let x of u)if(c>=x){d=Math.floor(c/x)*x;break}else d=+c.toFixed(2);let f=Gr(d/l,a),h=Math.round(r.project([s[0]+f,s[1]])[0]),p=voe,m=t.displayLength(d/l,this._isImperial),[g,y]=[h+2,p+2];this.$wrap.select(".scale").attr("width",`${g}px`).attr("height",`${y}px`).attr("viewBox",`0 0 ${g} ${y}`),this.$wrap.select(".scale-path").attr("d",`M0.5,0.5 v${p} h${h} v${-p}`),this.$wrap.select(".scale-text").text(m)}toggleUnits(){this._isImperial=!this._isImperial,this.updateScale()}};var th=class{constructor(e){this.context=e,this._detectedOS=Et().os,this._activeTab=0,this._keys=null,this._dataShortcuts=null,this.$modal=null,this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.toggle=this.toggle.bind(this),this.render=this.render.bind(this),this._setupKeybinding=this._setupKeybinding.bind(this),e.systems.l10n.on("localechange",()=>{this._setupKeybinding(),this.render()}),this._setupKeybinding()}render(){if(!this.$modal||!this._dataShortcuts)return;let e=this.context,t=e.systems.l10n,r=this.$modal.select(".content");r.selectAll(".shortcuts-heading").data([0]).enter().append("div").attr("class","shortcuts-heading modal-section").append("h3").text(t.t("shortcuts.title"));let i=r.selectAll(".shortcuts-wrapper").data([0]).enter().append("div").attr("class","shortcuts-wrapper modal-section");i.append("div").attr("class","nav-bar").selectAll(".nav-item").data(this._dataShortcuts).enter().append("a").attr("class","nav-item").attr("href","#").on("click",(h,p)=>{h.preventDefault(),this._activeTab=this._dataShortcuts.indexOf(p),this.render()}).append("span").text(h=>t.t(h.text));let c=i.append("div").attr("class","shortcuts-content").selectAll(".shortcut-tab").data(this._dataShortcuts).enter().append("div").attr("class",h=>`shortcut-tab shortcut-tab-${h.tab}`).selectAll(".shortcut-column").data(h=>h.columns).enter().append("table").attr("class","shortcut-column").selectAll(".shortcut-row").data(h=>h.rows).enter().append("tr").attr("class","shortcut-row"),u=c.filter(h=>!h.shortcuts);u.append("td").attr("class","shortcut-keys"),u.append("td").attr("class","shortcut-section").append("h3").text(h=>t.t(h.text));let d=c.filter(h=>h.shortcuts);d.append("td").attr("class","shortcut-keys").each((h,p,m)=>{let g=H(m[p]),y=h.modifiers||[];this._detectedOS==="win"&&h.text==="shortcuts.editing.commands.redo"?y=["\u2303"]:this._detectedOS!=="mac"&&h.text==="shortcuts.browsing.display_options.fullscreen"&&(y=[]);for(let S of y)g.append("kbd").attr("class","modifier").text(C=>Te.display(e,S)),g.append("span").attr("class","shortcut-separator").text("+");let x=h.shortcuts||[];this._detectedOS==="win"&&h.text==="shortcuts.editing.commands.redo"?x=["Y"]:this._detectedOS!=="mac"&&h.text==="shortcuts.browsing.display_options.fullscreen"&&(x=["F11"]);let b=new Set;for(let S of x){let C=Array.isArray(S)?S:[S];C=C.map(k=>k.includes("{")?k:Te.display(e,k.includes(".")?t.t(k):k)),C=Ge(C),C.length!==0&&(C.length===1?b.add(C[0]):b.add(C))}let _=[...b];for(let S=0;S<_.length;S++){let C=_[S],k=Array.isArray(C)?C:[C];for(let v=0;v<k.length;v++){let w=k[v];if(typeof w!="string")continue;let A=w.toLowerCase().match(/^\{(.*)\}$/);if(A){let E=A[1].replace("interaction-","").replace(/\-/g," ");g.call(X(`#rapid-${A[1]}`,"operation",E))}else g.append("kbd").attr("class","shortcut").text(w);v<k.length-1&&g.append("span").text("/")}S<_.length-1&&g.append("span").attr("class","shortcut-separator").text(t.t("shortcuts.or"))}h.gesture&&(g.append("span").attr("class","shortcut-separator").text("+"),g.append("span").attr("class","gesture").text(S=>t.t(S.gesture)))}),d.append("td").attr("class","shortcut-desc").text(h=>h.text?t.t(h.text):"\xA0");let f=r.selectAll(".shortcuts-wrapper");f.selectAll(".nav-item").classed("active",(h,p)=>p===this._activeTab),f.selectAll(".shortcut-tab").style("display",(h,p)=>p===this._activeTab?"flex":"none")}show(){let e=this.context,t=e.systems.assets,r=e.container();t.loadAssetAsync("shortcuts").then(i=>{this._dataShortcuts=i.shortcuts,!r.selectAll(".shaded").size()&&(this.$modal=vr(r),this.$modal.select(".modal").classed("modal-shortcuts",!0),this.render())}).catch(i=>{console.error(i)})}hide(){this.$modal&&(this.$modal.close(),this.$modal=null)}toggle(){let e=this.context.container();if(e.selectAll(".shaded > div:not(.modal-shortcuts)").size())return;e.selectAll(".shaded > div.modal-shortcuts").size()?this.hide():this.show()}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys),this._keys=[r.t("shortcuts.command.keyboard_shortcuts.key"),"?"],e.keybinding().on(this._keys,this.toggle)}};var woe=4,rh=240,Q_=400,nh=class{constructor(e){this.context=e,this._keys=null,this.DataEditor=ff(e),this.DetectionInspector=pf(e),this.FeatureList=new gf(e),this.Inspector=new Sf(e),this.KeepRightEditor=Cf(e),this.MapRouletteEditor=zf(e),this.MapRouletteMenu=Hf(e),this.NoteEditor=qf(e),this.OsmoseEditor=Kf(e),this.RapidInspector=new eh(e),this.OvertureInspector=new Yf(e),this.Tooltip=de(e),this.$parent=null,this.$sidebar=null,this.$resizer=null,this.$custom=null,this.$featureList=null,this.$inspector=null,this._startPointerID=null,this._startCoord=null,this._startWidth=null,this._lastCoord=null,this._lastWidth=null,this._expandWidth=Q_,this.render=this.render.bind(this),this.toggle=this.toggle.bind(this),this._hover=this._hover.bind(this),this._hoverchange=this._hoverchange.bind(this),this._pointerup=this._pointerup.bind(this),this._pointermove=this._pointermove.bind(this),this._pointerdown=this._pointerdown.bind(this),this._eventCancel=this._eventCancel.bind(this),this._setupKeybinding=this._setupKeybinding.bind(this),this.hover=mn(this._hover,200),e.behaviors.hover.on("hoverchange",this._hoverchange),e.systems.l10n.on("localechange",this._setupKeybinding),this._setupKeybinding()}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.l10n,i=t.systems.storage,s=r.textDirection(),o=i.getItem("inspector.collapsed")==="true",a=+(i.getItem("inspector.width")||Q_);this._expandWidth=Math.max(rh,a);let l=e.selectAll(".sidebar").data([s]);l.exit().remove();let c=l.enter().append("div").attr("class","sidebar").classed("collapsed",o).style("flex-basis",`${this._expandWidth}px`);this.$sidebar=l=l.merge(c);let u=e.selectAll(".resizer").data([0]),d=u.enter().append("div").attr("class","resizer").each((f,h,p)=>{p[h].addEventListener("pointerdown",this._pointerdown)});d.append("div").attr("class","resizer-handle"),this.$resizer=u=u.merge(d).call(this.Tooltip.placement(s==="rtl"?"right":"left").title(r.t("inspector.tooltip")).shortcut(r.t("shortcuts.command.toggle_inspector.key"))),l.call(this.FeatureList.render),l.call(this.Inspector.render),this.$featureList=l.select(".feature-list-wrap"),this.$inspector=l.select(".inspector-wrap")}_hoverchange(e){let t=this.context,r=t.systems.gfx,i=r.scene,s=e.target,o=s?.layer,a=s?.dataID,l=s?.data,c=t.mode?.id;c!=="select"&&c!=="select-osm"&&this.hover(l),i.clearClass("hover"),o&&a&&(o.getDataWithClass("drawing").has(a)||o.setClass("hover",a)),r.immediateRedraw()}_hover(e){let t=this.$sidebar,r=this.$inspector,i=this.$featureList;if(!t||!r||!i||this.$custom&&this.$custom.selectAll(".save-success").size())return;let s=this.context,a=s.systems.editor.staging.graph,l=e;if(this.reset(),l?.__featurehash__)this.show(this.DataEditor.datum(l));else if(l?.__fbid__)this.RapidInspector.datum=l,this.show(this.RapidInspector.render);else if(l?.overture)this.OvertureInspector.datum=l,this.show(this.OvertureInspector.render);else if(l?.type==="detection")this.show(this.DetectionInspector.datum(l));else if(l instanceof Qe&&l.service==="osm"){if(s.mode?.id==="drag-note")return;let c=s.services.osm;c&&(l=c.getNote(l.id)),this.show(this.NoteEditor.note(l))}else if(l instanceof Qe&&l.service!=="osm"){let c=s.services[l.service],u;c&&(l=c.getError(l.id),c.id==="keepRight"?u=this.KeepRightEditor:c.id==="osmose"?u=this.OsmoseEditor:c.id==="maproulette"&&(u=this.MapRouletteEditor,this.MapRouletteMenu.error(l))),u&&this.show(u.error(l))}this.$custom?this.$custom.classed("inspector-hover",!0):l instanceof me&&a.hasEntity(l.id)?(i.classed("inspector-hidden",!0),r.classed("inspector-hidden",!1).classed("inspector-hover",!0),this.Inspector.state("hover").entityIDs([l.id]).newFeature(!1),t.call(this.Inspector.render)):this.hide()}intersects(e){let t=this.$sidebar;if(!t)return!1;let r=this.context,i=t.node().getBoundingClientRect();return e.intersects(new le(r.viewport.unproject([0,i.height]),r.viewport.unproject([i.width,0])))}showInspector(e,t=!1){let r=this.$sidebar,i=this.$inspector,s=this.$featureList;!r||!i||!s||(Array.isArray(e)&&e.length?(s.classed("inspector-hidden",!0),this.reset(),i.classed("inspector-hidden",!1).classed("inspector-hover",!1),this.Inspector.state("select").entityIDs(e).newFeature(t),r.call(this.Inspector.render)):this.hide())}show(e){let t=this.$sidebar,r=this.$inspector,i=this.$featureList;!t||!r||!i||(e?(this.$custom&&(this.$custom.remove(),this.$custom=null),i.classed("inspector-hidden",!0),r.classed("inspector-hidden",!0),this.Inspector.entityIDs([]).state("hide"),this.$custom=t.append("div").attr("class","sidebar-component").call(e)):this.hide())}hide(){let e=this.$inspector,t=this.$featureList;!e||!t||(this.reset(),t.classed("inspector-hidden",!1),e.classed("inspector-hidden",!0),this.Inspector.entityIDs([]).state("hide"))}showPresetList(...e){this.Inspector.showPresetList(...e)}showEntityEditor(...e){this.Inspector.showEntityEditor(...e)}expand(e){let t=this.$sidebar;t&&t.classed("collapsed")&&this.toggle(e)}collapse(e){let t=this.$sidebar;t&&(t.classed("collapsed")||this.toggle(e))}toggle(e=!0){let t=this.$sidebar;if(!t)return;let r=this.context,i=r.systems.ui,s=r.container(),o=this._expandWidth||Q_,a=t.classed("collapsed"),l=a?0:o,c=!a,d=wr(l,c?0:o);this._startWidth=l,this._lastWidth=l,e?t.transition().tween("inspector.toggler",()=>f=>{let h=d(f);t.classed("collapsing",h<rh).style("flex-basis",`${h}px`),i.resize(),this._lastWidth=h}).on("start",()=>{s.classed("resizing",!0),t.classed("collapsing",l<rh).classed("collapsed",!1).style("flex-basis",`${l}px`)}).on("end interrupt",()=>{s.classed("resizing",!1),t.classed("collapsing",!1).classed("collapsed",c).style("flex-basis",`${o}px`),i.resize(),this._storePreferences()}):(s.classed("resizing",!1),t.classed("collapsing",!1).classed("collapsed",c).style("flex-basis",`${o}px`),i.resize(),this._storePreferences())}reset(){this.$custom&&(this.$custom.remove(),this.$custom=null),this.DataEditor.datum(null),this.DetectionInspector.datum(null),this.Inspector.entityIDs([]),this.KeepRightEditor.error(null),this.MapRouletteEditor.error(null),this.MapRouletteMenu.error(null),this.NoteEditor.note(null),this.OsmoseEditor.error(null),this.RapidInspector.datum=null}_pointerdown(e){if(this._startPointerID||"button"in e&&e.button!==0)return;let t=this.context.container(),r=this.$sidebar,i=this._expandWidth||Q_,o=r.classed("collapsed")?0:i;this._startPointerID=e.pointerId||"mouse",this._startCoord=[e.clientX,e.clientY],this._startWidth=o,this._lastCoord=[e.clientX,e.clientY],this._lastWidth=o,this.Tooltip.hide(),t.classed("resizing",!0),r.classed("collapsed",!1).classed("collapsing",o<rh).style("flex-basis",`${o}px`),window.addEventListener("pointermove",this._pointermove),window.addEventListener("pointerup",this._pointerup),window.addEventListener("pointercancel",this._pointerup),window.addEventListener("touchmove",this._eventCancel,{passive:!1})}_pointermove(e){if(this._startPointerID!==(e.pointerId||"mouse"))return;e.preventDefault();let t=this.context,r=t.systems.l10n,i=t.systems.ui,s=r.isRTL()?-1:1,o=(e.clientX-this._lastCoord[0])*s,a=this._lastWidth+o;o&&(this.$sidebar.classed("collapsing",a<rh).style("flex-basis",`${a}px`),i.resize()),this._lastCoord=[e.clientX,e.clientY],this._lastWidth=a}_pointerup(e){if(this._startPointerID!==(e.pointerId||"mouse"))return;this._startPointerID=null,window.removeEventListener("pointermove",this._pointermove),window.removeEventListener("pointerup",this._pointerup),window.removeEventListener("pointercancel",this._pointerup),window.removeEventListener("touchmove",this._eventCancel,{passive:!1});let t=this.context,r=t.systems.ui,i=this.$sidebar,s=t.container(),o=this._lastWidth,a=o<rh,l=a?this._expandWidth:o;this._expandWidth=l,s.classed("resizing",!1),i.classed("collapsing",!1).classed("collapsed",a).style("flex-basis",`${l}px`);let c=this._startCoord,u=[e.clientX??c[0],e.clientY??u[0]];Ne(c,u)<woe?this.toggle():(r.resize(),this._storePreferences())}_eventCancel(e){e&&e.preventDefault()}_storePreferences(){let e=this.$sidebar;if(!e)return;let t=e.classed("collapsed")?"true":"false",r=this._expandWidth,i=this.context.systems.storage;i.setItem("inspector.collapsed",t),i.setItem("inspector.width",r)}_setupKeybinding(){let e=this.context,t=e.keybinding(),r=e.systems.l10n;Array.isArray(this._keys)&&t.off(this._keys),this._keys=[r.t("shortcuts.command.toggle_inspector.key"),"`","\xB2","@"],e.keybinding().on(this._keys,this.toggle)}};var Bf=class{constructor(e){this.context=e,this._isLive=!0,this.$parent=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this.toggle=this.toggle.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.apiConnections,i=t.systems.l10n,s=Array.isArray(r)&&r.length===2,o=e.selectAll(".source-switch").data(s?[0]:[]);o.exit().remove();let a=o.enter().append("div").attr("class","source-switch");a.append("a").attr("href","#").attr("class","source-switch-link").on("click",this.toggle),o=o.merge(a),o.selectAll(".source-switch-link").classed("live",this._isLive).classed("chip",this._isLive).text(this._isLive?i.t("source_switch.live"):i.t("source_switch.dev"))}toggle(e){e&&e.preventDefault();let t=this.context,r=t.systems.editor,i=t.apiConnections,s=t.systems.l10n,o=t.services.osm;o&&(t.inIntro||t.mode?.id!=="save"&&(!Array.isArray(i)||i.length!==2||r.hasChanges()&&!window.confirm(s.t("source_switch.lose_changes"))||(this._isLive=!this._isLive,t.enter("browse"),r.clearBackup(),t.resetAsync().then(()=>o.switchAsync(this._isLive?i[0]:i[1])).then(this.rerender))))}};function Z_(n){let e=n.systems.assets,t=n.systems.l10n,r=n.systems.storage,i=parseInt(r.getItem("sawPrivacyVersion"),10)||0;return function(o){let a=t.isRTL()?"-rtl":"";r.setItem("sawPrivacyVersion",n.privacyVersion);let l,c=n.version.match(/(\d+\.\d+)/);c!==null?l=`v${c[1]}`:l=n.version.toString(),e.loadAssetAsync("intro_graph");let u=vr(o);u.select(".modal").attr("class","modal rapid-modal modal-splash");let d=u.select(".content");d.append("div").attr("class","modal-section").append("h2").html(t.t("splash.welcome",{rapidicon:Ce(`#rapid-logo-rapid-wordmark${a}`,"pre-text rapid"),version:l}));let f=t.t("splash.text")+`

`;i>0&&(f+=t.t("splash.privacy_update")+" "),f+=t.t("splash.privacy"),d.append("div").attr("class","modal-section").html(qe.parse(f)),d.selectAll("a").attr("target","_blank");let h=d.append("div").attr("class","modal-actions"),p=h.append("button").attr("class","walkthrough").on("click",()=>{n.container().call(co(n)),u.close()});p.append("svg").attr("class","logo logo-walkthrough").append("use").attr("xlink:href","#rapid-logo-walkthrough"),p.append("div").text(t.t("splash.walkthrough"));let m=h.append("button").attr("class","start-editing").on("click",u.close);m.append("svg").attr("class","logo logo-features").append("use").attr("xlink:href","#rapid-logo-features"),m.append("div").text(t.t("splash.start"))}}var IV=Ot(v6(),1);function MP(n){return typeof n!="string"?"":IV.default.remove(n.replace(/&/g,"and").replace(/(İ|i̇)/ig,"i").replace(/[\s\-=_!"#%'*{},.\/:;?\(\)\[\]@\\$\^*+<>«»~`’\u00a1\u00a7\u00b6\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05c0\u05c3\u05c6\u05f3\u05f4\u0609\u060a\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0830-\u083e\u085e\u0964\u0965\u0970\u0af0\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f14\u0f85\u0fd0-\u0fd4\u0fd9\u0fda\u104a-\u104f\u10fb\u1360-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u1a1e\u1a1f\u1aa0-\u1aa6\u1aa8-\u1aad\u1b5a-\u1b60\u1bfc-\u1bff\u1c3b-\u1c3f\u1c7e\u1c7f\u1cc0-\u1cc7\u1cd3\u2000-\u206f\u2cf9-\u2cfc\u2cfe\u2cff\u2d70\u2e00-\u2e7f\u3001-\u3003\u303d\u30fb\ua4fe\ua4ff\ua60d-\ua60f\ua673\ua67e\ua6f2-\ua6f7\ua874-\ua877\ua8ce\ua8cf\ua8f8-\ua8fa\ua92e\ua92f\ua95f\ua9c1-\ua9cd\ua9de\ua9df\uaa5c-\uaa5f\uaade\uaadf\uaaf0\uaaf1\uabeb\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\ufeff\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]+/g,"").toLowerCase())}function RP(n,e,t){let r=Object.assign({},n.strings),i=Object.assign({},e[n.type]),s=new RegExp(/(\{\w+\})/,"gi");if(t){if(r.community){let u=MP(r.community);r.community=t(`_communities.${u}`)}["name","description","extendedDescription"].forEach(u=>{i[u]&&(i[u]=t(`_defaults.${n.type}.${u}`)),r[u]&&(r[u]=t(`${n.id}.${u}`))})}let o={account:n.account,community:r.community,signupUrl:r.signupUrl,url:r.url};o.signupUrl||(o.signupUrl=l(r.signupUrl||i.signupUrl)),o.url||(o.url=l(r.url||i.url));let a={name:l(r.name||i.name),url:l(r.url||i.url),signupUrl:l(r.signupUrl||i.signupUrl),description:l(r.description||i.description),extendedDescription:l(r.extendedDescription||i.extendedDescription)};return a.nameHTML=c(a.url,a.name),a.urlHTML=c(a.url),a.signupUrlHTML=c(a.signupUrl),a.descriptionHTML=l(r.description||i.description,!0),a.extendedDescriptionHTML=l(r.extendedDescription||i.extendedDescription,!0),a;function l(u,d){if(!u)return;let f=u;for(let p in o){let m=`{${p}}`,g=new RegExp(m,"g");if(g.test(f)){let y=o[p];if(y)d&&(p==="signupUrl"||p==="url")&&(y=c(y)),f=f.replace(g,y);else throw new Error(`Cannot resolve token: ${m}`)}}let h=f.match(s);if(h)throw new Error(`Cannot resolve tokens: ${h}`);return d&&n.type==="reddit"&&(f=f.replace(/(\/r\/\w+\/*)/i,p=>c(a.url,p))),f}function c(u,d){if(u)return d=d||u,`<a target="_blank" href="${u}">${d}</a>`}}var ih=null;function J_(n){let e=n.systems.assets,t=n.systems.locations,r=n.systems.l10n,i=n.systems.map,s=ge("cancel"),o=2,a,l;c();function c(){return Promise.all([e.loadAssetAsync("oci_features"),e.loadAssetAsync("oci_resources"),e.loadAssetAsync("oci_defaults")]).then(p=>{if(ih)return ih;p[0]&&Array.isArray(p[0].features)&&t.mergeCustomGeoJSON(p[0]);let m=Object.values(p[1].resources);return m.length?t.mergeLocationSets(m).then(()=>(ih={resources:m,defaults:p[2].defaults},ih)):(ih={resources:[],defaults:p[2].defaults},ih)})}function u(p){if(!p)return;let m=p.trim();if(!m)return;/Z$/.test(m)||(m+="Z");let g=new Date(m);return new Date(g.toUTCString().slice(0,25))}function d(p){let m=p.append("div").attr("class","header fillL");m.append("h3").text(r.t("success.just_edited")),m.append("button").attr("class","close").on("click",()=>s.call("cancel")).call(X("#rapid-icon-close"));let g=p.append("div").attr("class","body save-success fillL"),y=g.append("div").attr("class","save-summary");y.append("h3").text(r.t("success.thank_you"+(l?"_location":""),{where:l})),y.append("p").text(r.t("success.your_changes")).append("a").attr("class","link-out").attr("target","_blank").attr("href",r.t("success.help_link_url")).call(X("#rapid-icon-out-link","inline")).append("span").text(r.t("success.help_link_text"));let x=n.services.osm;if(!x)return;let b=x.changesetURL(a.id),S=y.append("table").attr("class","summary-table").append("tr").attr("class","summary-row");S.append("td").attr("class","cell-icon summary-icon").append("a").attr("target","_blank").attr("href",b).append("svg").attr("class","logo-small").append("use").attr("xlink:href","#rapid-logo-osm");let C=S.append("td").attr("class","cell-detail summary-detail");C.append("a").attr("class","cell-detail summary-view-on-osm").attr("target","_blank").attr("href",b).text(r.t("success.view_on_osm")),C.append("div").text(r.t("success.your_changeset_id")).append("a").attr("target","_blank").attr("href",b).text(a.id),c().then(k=>{let v=i.center(),w=t.locationSetsAt(v),A=[];k.resources.forEach(E=>{let I=w[E.locationSetID];if(!I)return;let M=T=>r.t(`_community.${T}`);E.resolved=RP(E,k.defaults,M),A.push({area:I,order:E.order||0,resource:E})}),A.sort((E,I)=>E.area-I.area||I.order-E.order),g.call(f,A.map(E=>E.resource))})}function f(p,m){let g=p.append("div").attr("class","save-communityLinks");g.append("h3").text(r.t("success.like_osm"));let b=g.append("table").attr("class","community-table").selectAll(".community-row").data(m).enter().append("tr").attr("class","community-row");b.append("td").attr("class","cell-icon community-icon").append("a").attr("target","_blank").attr("href",S=>S.resolved.url).append("svg").attr("class","logo-small").append("use").attr("xlink:href",S=>`#community-${S.type}`),b.append("td").attr("class","cell-detail community-detail").each(h),g.append("div").attr("class","community-missing").text(r.t("success.missing")).append("a").attr("class","link-out").attr("target","_blank").call(X("#rapid-icon-out-link","inline")).attr("href","https://github.com/osmlab/osm-community-index/issues").append("span").text(r.t("success.tell_us"))}function h(p,m,g){let y=H(g[m]),x=p.id;y.append("div").attr("class","community-name").html(p.resolved.nameHTML),y.append("div").attr("class","community-description").html(p.resolved.descriptionHTML),(p.resolved.extendedDescriptionHTML||p.languageCodes&&p.languageCodes.length)&&y.append("div").call(N1(n,`community-more-${p.id}`).expanded(!1).checkPreference(!1).label(r.t("success.more")).content(_));let b=(p.events||[]).map(C=>(C.date=u(C.when),C)).filter(C=>{let k=C.date.getTime(),v=new Date().setHours(0,0,0,0);return!isNaN(k)&&k>=v}).sort((C,k)=>C.date<k.date?-1:C.date>k.date?1:0).slice(0,o);b.length&&y.append("div").call(N1(n,`community-events-${p.id}`).expanded(!1).checkPreference(!1).label(r.t("success.events")).content(S)).select(".hide-toggle").append("span").attr("class","badge-text").text(b.length);function _(C){let v=C.selectAll(".community-more").data([0]).enter().append("div").attr("class","community-more");if(p.resolved.extendedDescriptionHTML&&v.append("div").attr("class","community-extended-description").html(p.resolved.extendedDescriptionHTML),p.languageCodes&&p.languageCodes.length){let w=p.languageCodes.map(A=>r.languageName(A)).join(", ");v.append("div").attr("class","community-languages").text(r.t("success.languages",{languages:w}))}}function S(C){let w=C.append("div").attr("class","community-events").selectAll(".community-event").data(b).enter().append("div").attr("class","community-event");w.append("div").attr("class","community-event-name").append("a").attr("target","_blank").attr("href",A=>A.url).text(A=>{let E=A.name;return A.i18n&&A.id&&(E=r.t(`_community.${x}.events.${A.id}.name`,{default:E})),E}),w.append("div").attr("class","community-event-when").text(A=>{let E={weekday:"short",day:"numeric",month:"short",year:"numeric"};(A.date.getHours()||A.date.getMinutes())&&(E.hour="numeric",E.minute="numeric");let I=r.localeCode();return A.date.toLocaleString(I,E)}),w.append("div").attr("class","community-event-where").text(A=>{let E=A.where;return A.i18n&&A.id&&(E=r.t(`_community.${x}.events.${A.id}.where`,{default:E})),E}),w.append("div").attr("class","community-event-description").text(A=>{let E=A.description;return A.i18n&&A.id&&(E=r.t(`_community.${x}.events.${A.id}.description`,{default:E})),E})}}return d.changeset=function(p){return arguments.length?(a=p,d):a},d.location=function(p){return arguments.length?(l=p,d):l},xe(d,s,"on")}var Nf=class{constructor(e){this.context=e,this.IssuesTooltip=de(e).placement("top"),this.ResolvedTooltip=de(e).placement("top"),this.$parent=null,this.render=this.render.bind(this),this.rerender=()=>this.render(),this.click=this.click.bind(this),e.systems.validator.on("validated",this.rerender)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.l10n,i=t.systems.storage,s=t.systems.validator,o=e.selectAll(".issues-info").data([0]),a=o.enter().append("div").attr("class","issues-info");o=o.merge(a);let l=[],c=s.getIssuesBySeverity({what:i.getItem("validate-what")??"edited",where:i.getItem("validate-where")??"all"});for(let[f,h]of Object.entries(c))h.length&&l.push({id:f,count:h.length,tooltip:this.IssuesTooltip});if(i.getItem("validate-what")==="all"){let f=s.getResolvedIssues();f.length&&l.push({id:"resolved",count:f.length,tooltip:this.ResolvedTooltip})}let u=o.selectAll(".chip").data(l,f=>f.id);u.exit().remove();let d=u.enter().append("a").attr("class",f=>`chip ${f.id}-count`).attr("href","#").each((f,h,p)=>{let m=H(p[h]);m.on("click",this.click).call(f.tooltip).call(X(s.getSeverityIcon(f.id))),m.append("span").attr("class","count")});u=u.merge(d),u.each((f,h,p)=>{H(p[h]).select(".count").text(g=>g.count.toString())}),this.IssuesTooltip.title(r.t("issues.open_tooltip")),this.ResolvedTooltip.title(r.t("issues.resolved_tooltip"))}click(e){e&&e.preventDefault();let r=this.context.systems.ui;this.IssuesTooltip.hide(),this.ResolvedTooltip.hide(),r.Overmap.MapPanes.Issues.togglePane()}};var Of=class{constructor(e){this.context=e;let t=e.version,r=t.includes("-"),i=/\d+\.\d+\.\d+.*/.test(t),s=e.systems.storage,o=s.getItem("sawVersion");this.isNewUser=o===null,this.isNewVersion=!1,i&&(this.isNewVersion=o!==t&&!r,s.setItem("sawVersion",t)),this.Tooltip=de(e),this.$parent=null,this.render=this.render.bind(this)}render(e=this.$parent){if(e instanceof fe)this.$parent=e;else return;let t=this.context,r=t.systems.l10n,i=t.version,s=e.selectAll(".version-wrap").data([0]),o=s.enter().append("div").attr("class","version-wrap");o.append("a").attr("target","_blank").attr("tabindex",-1).attr("href","https://github.com/facebook/Rapid/blob/main/CHANGELOG.md").text(i),this.isNewVersion&&!this.isNewUser&&o.append("a").attr("class","badge").attr("target","_blank").attr("tabindex",-1).attr("href","https://github.com/facebook/Rapid/blob/main/CHANGELOG.md").call(X("#maki-gift")).call(this.Tooltip),s=s.merge(o),this.Tooltip.title(r.t("version.whats_new",{version:i})).placement("top").scrollContainer(t.container().select(".map-footer-wrap"))}};function ev(n){let e=n.systems.assets,t=n.systems.l10n,r=n.systems.storage;return function(s){let o=vr(s),a=t.isRTL()?"-rtl":"",l,c=n.version.match(/(\d+\.\d+)/);c!==null?l=`v${c[1]}`:l=n.version.toString(),o.select(".modal").attr("class","modal rapid-modal modal-whatsnew");let u=o.select(".content");u.append("div").attr("class","modal-section").append("h2").html(t.t("splash.welcome",{rapidicon:Ce(`#rapid-logo-rapid-wordmark${a}`,"pre-text rapid"),version:l}));let d=t.t("whats_new.text_v25")+`

`+t.t("whats_new.project_links")+`

`,f=u.append("div").attr("class","modal-section");f.append("div").attr("class","whatsnew-text").html(qe.parse(d)),f.append("div").attr("class","whatsnew-images").append("img").attr("class","whatsnew-image").attr("src",e.getFileURL("img/rapid-v25-curbs.gif"));let h=f.append("div").attr("class","rapid-checkbox whatsnew-dontshow").append("label").attr("class","rapid-checkbox-label");h.append("span").attr("class","rapid-checkbox-text").text(t.t("whats_new.dontshowagain")),h.append("input").attr("type","checkbox").attr("class","rapid-feature-checkbox").on("click",m=>{m.target.checked?r.setItem("sawWhatsNewVersion",n.whatsNewVersion):r.removeItem("sawWhatsNewVersion")}),h.append("div").attr("class","rapid-checkbox-custom"),u.selectAll("a").attr("target","_blank"),u.append("div").attr("class","modal-section buttons").append("button").attr("class","button ok-button action").text(t.t("confirm.okay")).on("click",o.close).node().focus()}}var I5=class extends Se{constructor(e){super(e),this.id="ui",this.dependencies=new Set(["assets","editor","gfx","imagery","l10n","map","storage","urlhash"]),this._mapRect=null,this._needWidth={},this._initPromise=null,this._startPromise=null,this._resizeTimeout=null,this.ApiStatus=null,this.AuthModal=null,this.Defs=null,this.EditMenu=null,this.MapRouletteMenu=null,this.Flash=null,this.Fullscreen=null,this.MapFooter=null,this.MapToolbar=null,this.Overmap=null,this.Shortcuts=null,this.Sidebar=null,this.InfoCards=null,this.Minimap=null,this.PhotoViewer=null,this.Spector=null,this.render=this.render.bind(this),this.resize=this.resize.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let a of this.dependencies)if(!this.context.systems[a])return Promise.reject(`Cannot init:  ${this.id} requires ${a}`);let e=this.context,t=e.systems.assets,r=e.systems.gfx,i=e.systems.l10n,s=e.systems.urlhash,o=Promise.all([t.initAsync(),i.initAsync(),r.initAsync(),s.initAsync()]);return this._initPromise=o.then(()=>{window.addEventListener("resize",this.resize),this._checkEnvironment(),this.ApiStatus=new lf(e),this.AuthModal=Vo(e).blocking(!0).message(i.t("loading_auth")),this.Defs=new hf(e),this.EditMenu=e_(e),this.MapRouletteMenu=Hf(e),this.Flash=_f(e),this.Fullscreen=new vf(e),this.MapFooter=new Mf(e),this.MapToolbar=new Xf(e),this.Overmap=new Jf(e),this.Shortcuts=new th(e),this.Sidebar=new nh(e),this.InfoCards=this.Overmap.InfoCards,this.Minimap=this.Overmap.Minimap,this.PhotoViewer=this.Overmap.PhotoViewer,this.Spector=this.Overmap.Spector,i.on("localechange",()=>{this._started&&this.render()});let a=e.services.osm;a&&a.on("authLoading",()=>e.container()?.call(this.AuthModal)).on("authDone",()=>this.AuthModal.close())})}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,t=e.systems.editor,r=e.systems.map,i=e.systems.storage,s=e.systems.urlhash,o=e.container();if(!o.size())return Promise.reject(new Error("No container to render to."));let a=Promise.all([t.startAsync(),r.startAsync()]);return this._startPromise=a.then(()=>{this.render(),this.resize(),e.enter("browse");let l=s.initialHashParams.get("walkthrough")==="true",c=parseInt(i.getItem("sawPrivacyVersion"),10)||0,u=parseInt(i.getItem("sawWhatsNewVersion"),10)||0;l?o.call(co(e)):t.canRestoreBackup?o.call(K_(e)):c!==e.privacyVersion?o.call(Z_(e)):u!==e.whatsNewVersion&&o.call(ev(e)),this._started=!0})}resetAsync(){let e=this.context.container();return e.size()&&e.select(".inspector-wrap *").remove(),Promise.resolve()}render(){let e=this.context,t=e.systems.l10n,r=e.systems.map,i=e.container();i.attr("lang",t.localeCode()).attr("dir",t.textDirection()).call(this.Fullscreen.render).call(this.Defs.render).call(this.Sidebar.render);let s=i.selectAll(".main-content").data([0]),o=s.enter().append("div").attr("class","main-content active");s=s.merge(o),s.call(r.render).call(this.MapToolbar.render).call(this.Overmap.render).call(this.ApiStatus.render).call(this.MapFooter.render)}resize(e){let t=this.context,r=t.systems.map,i=t.viewport,s=t.container();e&&(window.clearTimeout(this._resizeTimeout),s.classed("resizing",!0),this._resizeTimeout=window.setTimeout(()=>{s.classed("resizing",!1)},400));let o=s.selectAll(".main-content");if(!o.size())return;let a=this._copyRect(o.node().getBoundingClientRect()),l=this._mapRect||a;this._mapRect=a;let c=l.top-a.top,u=l.right-a.right,d=l.bottom-a.bottom,f=l.left-a.left,[h,p]=[f+u,c+d];(h||p)&&r.pan([h/2,p/2]);let m=[a.width,a.height],g=50;m=bt(m,[g*2,g*2]),i.dimensions=m,this.checkOverflow(".map-toolbar"),this.checkOverflow(".map-footer"),this.emit("uichange")}checkOverflow(e,t){t&&delete this._needWidth[e];let r=this.context.container().select(e);if(r.empty())return;let i=r.property("scrollWidth"),s=r.property("clientWidth"),o=this._needWidth[e]||i;i>s?(r.classed("narrow",!0),this._needWidth[e]||(this._needWidth[e]=i)):i>=o&&r.classed("narrow",!1)}togglePanes(e){let t=this.context,r=t.systems.l10n,i=t.container(),s=i.selectAll(".map-pane.shown"),o=r.isRTL()?"left":"right";s.classed("shown",!1).classed("hide",!0),i.selectAll(".map-pane-control button").classed("active",!1),e?(s.classed("shown",!1).classed("hide",!0).style(o,"-500px"),i.selectAll("."+e.attr("pane")+"-control button").classed("active",!0),e.classed("shown",!0).classed("hide",!1),s.empty()?e.style(o,"-500px").transition().duration(200).style(o,"0px"):e.style(o,"0px")):s.classed("shown",!0).classed("hide",!1).style(o,"0px").transition().duration(200).style(o,"-500px").on("end",function(){H(this).classed("shown",!1).classed("hide",!0)})}showEditMenu(e,t){this.EditMenu.close();let r=this.context,i=r.systems.gfx,s=r.viewport,o=r.mode?.operations??[];if(!o.length||!r.editable())return;let a=i.surface;a.focus&&a.focus();for(let c of o)typeof c.point=="function"&&c.point(e);this.EditMenu.anchorLoc(s.unproject(e)).triggerType(t).operations(o),H(i.overlay).call(this.EditMenu)}redrawEditMenu(){let e=this.context,t=e.systems.gfx,r=H(t.overlay);if(r.selectAll(".edit-menu").empty())return;let i=e.mode?.operations??[];i.length&&e.editable()?(this.EditMenu.operations(i),r.call(this.EditMenu)):this.EditMenu.close()}closeEditMenu(){this.EditMenu.close()}showMapRouletteMenu(e,t){this.closeMapRouletteMenu();let r=this.context,i=r.systems.gfx,s=r.viewport;this.MapRouletteMenu.anchorLoc(s.unproject(e)).triggerType(t),H(i.overlay).call(this.MapRouletteMenu),this._showsMapRouletteMenu=!0}closeMapRouletteMenu(){this.MapRouletteMenu.close()}_checkEnvironment(){let e=this.context,t=e.systems.assets,r=e.systems.urlhash,i=Et(),s=H("head"),o=s.select("link[rel~='icon']");o.size()||(o=s.append("link").attr("rel","icon").attr("type","image/svg")),/\/canary/.test(i.host)?(r.titleBase="Rapid Canary",o.attr("href",t.getFileURL("img/rapid_favicon-canary.svg"))):/(localhost|127\.0\.0\.1)/.test(i.host)&&(r.titleBase="Rapid Dev",o.attr("href",t.getFileURL("img/rapid_favicon-dev.svg")))}_copyRect(e){return{left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,x:e.x,y:e.y}}};var P5=class extends Se{constructor(e){super(e),this.id="uploader",this.dependencies=new Set(["assets","editor","l10n"]),this.changeset=null,this._origChanges=null,this._discardTags={},this._isSaving=!1,this._localGraph=null,this._remoteGraph=null,this._toCheckIDs=new Set,this._toLoadIDs=new Set,this._loadedIDs=new Set,this._conflicts=[],this._errors=[],this._initPromise=null,this._loadedSome=this._loadedSome.bind(this),this._uploadCallback=this._uploadCallback.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let r of this.dependencies)if(!this.context.systems[r])return Promise.reject(`Cannot init:  ${this.id} requires ${r}`);let e=this.context.systems.assets,t=e.initAsync();return this._initPromise=t.then(()=>e.loadAssetAsync("tagging_discarded")).then(r=>this._discardTags=r)}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this.changeset=null,Promise.resolve()}isSaving(){return this._isSaving}save(e,t){if(this._isSaving&&!e)return;let r=this.context,i=r.services.osm;if(!i)return;if(!i.authenticated()){i.authenticate(o=>{o||this.save(e,t)});return}this._isSaving||(this._isSaving=!0,this.emit("saveStarted")),this._localGraph=null,this._remoteGraph=null,this._toCheckIDs=new Set,this._toLoadIDs=new Set,this._loadedIDs=new Set,this._conflicts=[],this._errors=[];let s=r.systems.editor;this._origChanges=s.changes(ma(s.difference(),this._discardTags)),t?this._startConflictCheck():this._tryUpload()}_startConflictCheck(){let e=this.context,t=e.services.osm,r=e.systems.editor,i=r.difference().summary(),s=r.staging.graph;this._localGraph=s,this._remoteGraph=new Fr(r.base.graph,!0),this._toCheckIDs=new Set;for(let[o,a]of i)if(a.changeType==="modified"){let l=s.entity(o);this._toCheckIDs.add(o);for(let c of s.childNodes(l))c.version!==void 0&&this._toCheckIDs.add(c.id)}this._toLoadIDs=new Set(this._toCheckIDs),this._loadedIDs=new Set,t&&this._toLoadIDs.size?(this.emit("progressChanged",this._loadedIDs.size,this._toCheckIDs.size),t.loadMultiple(Array.from(this._toLoadIDs),this._loadedSome)):this._tryUpload()}_loadedSome(e,t){if(this._errors.length)return;let r=this.context.systems.l10n,i=this.context.services.osm;if(e){this._errors.push({msg:e.message||e.responseText,details:[r.t("save.status_code",{code:e.status})]}),this._didResultInErrors();return}let s=new Set;for(let o of t.data)if(this._remoteGraph.replace(o),this._loadedIDs.add(o.id),this._toLoadIDs.delete(o.id),!!o.visible){if(o.type==="way")for(let a of o.nodes)this._toCheckIDs.has(a)||(this._toCheckIDs.add(a),this._toLoadIDs.add(a),s.add(a));else if(o.type==="relation"&&o.isMultipolygon())for(let a of o.members)this._toCheckIDs.has(a.id)||(this._toCheckIDs.add(a.id),this._toLoadIDs.add(a.id),s.add(a.id))}this.emit("progressChanged",this._loadedIDs.size,this._toCheckIDs.size),i&&s.size?i.loadMultiple(Array.from(s),this._loadedSome):this._toLoadIDs.size||(this._detectConflicts(),this._tryUpload())}_detectConflicts(){let e=this.context,t=e.systems.l10n,r=e.systems.editor,i=e.services.osm;if(!i)return;let s=this._localGraph,o=this._remoteGraph;for(let u of this._toCheckIDs){let d=s.entity(u),f=o.entity(u);if(c(d,f))continue;let h=M2(u,{localGraph:s,remoteGraph:o,discardTags:this._discardTags,formatUser:a,localize:t.t,strategy:"safe"});r.perform(h);let p=h.conflicts();if(!p.length)continue;let m=M2(u,{localGraph:s,remoteGraph:o,discardTags:this._discardTags,formatUser:a,localize:t.t,strategy:"force_local"}),g=M2(u,{localGraph:s,remoteGraph:o,discardTags:this._discardTags,formatUser:a,localize:t.t,strategy:"force_remote"}),y=t.t("save.conflict."+(f.visible?"keep_local":"restore")),x=t.t("save.conflict."+(f.visible?"keep_remote":"delete"));this._conflicts.push({id:u,name:l(d),details:p,chosen:1,choices:[{id:u,text:y,action:()=>r.perform(m)},{id:u,text:x,action:()=>r.perform(g)}]})}function a(u){return'<a href="'+i.userURL(u)+'" target="_blank">'+u+"</a>"}function l(u){return t.displayName(u.tags)||t.displayType(u.id)+" "+u.id}function c(u,d){if(u.version!==d.version)return!1;if(u.type==="way")for(let f of Ur(u.nodes,d.nodes)){let h=s.hasEntity(f),p=o.hasEntity(f);if(h&&p&&h.version!==p.version)return!1}return!0}}_tryUpload(){let e=this.context,t=e.services.osm;if(t||this._errors.push({msg:"No OSM Service"}),this.changeset||this._errors.push({msg:"No OSM Changeset"}),this._conflicts.length)this._didResultInConflicts();else if(this._errors.length)this._didResultInErrors();else{let r=e.systems.editor,i=r.changes(ma(r.difference(),this._discardTags));i.modified.length||i.created.length||i.deleted.length?(this.emit("willAttemptUpload"),t.sendChangeset(this.changeset,i,this._uploadCallback)):this._didResultInNoChanges()}}_uploadCallback(e,t){if(t&&(this.changeset=t),e)if(e.status===409)this.save(!0,!0);else{let r=this.context.systems.l10n;this._errors.push({msg:e.message||e.responseText,details:[r.t("save.status_code",{code:e.status})]}),this._didResultInErrors()}else this._didResultInSuccess()}_didResultInNoChanges(){this.emit("resultNoChanges"),this._endSave()}_didResultInErrors(){this.context.systems.editor.revert(),this.emit("resultErrors",this._errors),this._endSave()}_didResultInConflicts(){this._conflicts.sort((e,t)=>t.id.localeCompare(e.id)),this.emit("resultConflicts",this.changeset,this._conflicts,this._origChanges),this._endSave()}_didResultInSuccess(){this.emit("resultSuccess",this.changeset),this._endSave()}_endSave(){this._isSaving=!1,this.emit("saveEnded")}cancelConflictResolution(){this.context.systems.editor.revert()}processResolvedConflicts(){let e=this.context.systems.editor;for(let t of this._conflicts)if(t.chosen===1){let i=e.staging.graph.hasEntity(t.id);if(i?.type==="way")for(let s of Ge(i.nodes))e.perform(Mh(s));e.perform(Mh(t.id))}this.save(!0,!1)}};var D5=class extends Se{constructor(e){super(e),this.id="urlhash",this.dependencies=new Set(["editor","l10n","map"]),this.doUpdateTitle=!0,this.titleBase="Rapid";let t=sa(window.location.hash);this._initParams=new Map(Object.entries(t)),this._currParams=new Map(this._initParams),this._currHash=null,this._prevParams=null,this._startPromise=null,this._hashchange=this._hashchange.bind(this),this._updateHash=this._updateHash.bind(this),this._updateTitle=this._updateTitle.bind(this),this.deferredUpdateHash=mn(this._updateHash,500,{leading:!1}),this.deferredUpdateTitle=mn(this._updateTitle,500,{leading:!1})}initAsync(){for(let e of this.dependencies)if(!this.context.systems[e])return Promise.reject(`Cannot init:  ${this.id} requires ${e}`);return Promise.resolve()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,t=e.systems.imagery,r=e.systems.editor,i=e.systems.l10n,s=e.systems.photos,o=e.systems.rapid,a=e.systems.map,l=e.systems.ui,c=Promise.all([t.startAsync(),r.startAsync(),i.startAsync(),a.startAsync(),s.startAsync(),o.startAsync(),l.startAsync()]);return this._startPromise=c.then(()=>{r.on("stablechange",this.deferredUpdateTitle),e.on("modechange",this.deferredUpdateTitle),window.addEventListener("hashchange",this._hashchange),this._started=!0,this.resume()})}resetAsync(){return Promise.resolve()}pause(){this._paused=!0,this._currHash=null,this.deferredUpdateHash.cancel(),this.deferredUpdateTitle.cancel()}resume(){this._paused=!1,this._currHash=null,this._updateHash(),this._hashchange(),this._updateTitle()}get initialHashParams(){return this._initParams}getParam(e){return this._currParams.get(e)}setParam(e,t){typeof e=="string"&&(t==null||t==="undefined"||t==="null"?this._currParams.delete(e):this._currParams.set(e,t),this._started&&!this._paused&&this.deferredUpdateHash())}_updateHash(){if(!this._started||this._paused)return;let e=["comment","source","hashtags","walkthrough"],t=Ir(Object.fromEntries(this._currParams),e),r="#"+ft(t,!0);r!==this._currHash&&(window.history.replaceState(null,this.titleBase,r),this._currHash=r)}_updateTitle(){if(!this._started||this._paused||!this.doUpdateTitle)return;let e=this.context,t=e.systems.editor,r=t.staging.graph,i=e.systems.l10n,s=t.difference().summary().size,o,a=e.selectedIDs().filter(u=>r.hasEntity(u));if(a.length){let u=i.displayLabel(r.entity(a[0]),r);a.length>1?o=i.t("title.labeled_and_more",{labeled:u,count:a.length-1}):o=u}let l;s&&o?l="title.format.changes_context":s&&!o?l="title.format.changes":!s&&o&&(l="title.format.context");let c;l?c=i.t(l,{changes:s,base:this.titleBase,context:o}):c=this.titleBase,document.title!==c&&(document.title=c)}_hashchange(){if(!this._started||this._paused)return;this._currHash=window.location.hash;let e=sa(this._currHash);this._prevParams?this._prevParams=this._currParams:this._prevParams=new Map,this._currParams=new Map(Object.entries(e)),this.emit("hashchange",new Map(this._currParams),new Map(this._prevParams))}};var mD={};X1(mD,{validationAlmostJunction:()=>FP,validationAmbiguousCrossingTags:()=>NP,validationCloseNodes:()=>BP,validationCrossingWays:()=>OP,validationCurbNodes:()=>WP,validationDisconnectedWay:()=>LP,validationDuplicateWaySegments:()=>UP,validationFormatting:()=>GP,validationHelpRequest:()=>$P,validationImpossibleOneway:()=>zP,validationIncompatibleSource:()=>HP,validationMismatchedGeometry:()=>jP,validationMissingRole:()=>XP,validationMissingTag:()=>qP,validationOutdatedTags:()=>YP,validationPrivateData:()=>KP,validationSuspiciousName:()=>hD,validationUnsquareWay:()=>pD,validationYShapedConnection:()=>fD});function FP(n){let e="almost_junction",t=n.systems.editor,r=n.systems.l10n,i=5,s=.75,o=i-s,a=Math.atan(s/i);function l(d){return d.type==="way"&&is[d.tags.highway]}function c(d){return d.tags.noexit==="yes"||d.tags.amenity==="parking_entrance"||d.tags.entrance&&d.tags.entrance!=="no"}let u=function(f,h){if(!l(f))return[];if(f.isDegenerate())return[];let p=t.tree,m=_(f,h),g=[];return m.forEach(A=>{g.push(new et(n,{type:e,subtype:"highway-highway",severity:"warning",message:function(){let E=t.staging.graph,I=E.hasEntity(this.entityIds[0]);if(this.entityIds[0]===this.entityIds[2])return I?r.t("issues.almost_junction.self.message",{feature:r.displayLabel(I,E)}):"";{let M=E.hasEntity(this.entityIds[2]);return I&&M?r.t("issues.almost_junction.message",{feature:r.displayLabel(I,E),feature2:r.displayLabel(M,E)}):""}},reference:x,entityIds:[f.id,A.node.id,A.wid],loc:A.node.loc,hash:JSON.stringify(A.node.loc),data:{midId:A.mid.id,edge:A.edge,cross_loc:A.cross_loc},dynamicFixes:y}))}),g;function y(){let A=t.staging.graph,E=[new Re({icon:"rapid-icon-abutment",title:r.t("issues.fix.connect_features.title"),onClick:function(){let M=r.t("issues.fix.connect_almost_junction.annotation"),[,T,R]=this.issue.entityIds,P=A.entity(this.issue.data.midId),D=A.entity(T),N=A.entity(R),F=S(D,N,A);if(F.length>0){let V=C(P,D,F);if(V){t.perform(bi([V.id,D.id],V.loc)),t.commit({annotation:M,selectedIDs:[V.id,D.id]});return}}let B=this.issue.data.edge,O=this.issue.data.cross_loc,U=[A.entity(B[0]),A.entity(B[1])].map(V=>V.loc),W=im(U,O);W.distance<s?(t.perform(bi([W.id,D.id],W.loc)),t.commit({annotation:M,selectedIDs:[W.id,D.id]})):(t.perform(Cr({loc:O,edge:B},D)),t.commit({annotation:M,selectedIDs:[D.id]}))}})],I=A.hasEntity(this.entityIds[1]);return I&&!I.hasInterestingTags()&&E.push(new Re({icon:"maki-barrier",title:r.t("issues.fix.tag_as_disconnected.title"),onClick:function(){let M=this.issue.entityIds[1],T=Object.assign({},A.entity(M).tags);T.noexit="yes",t.perform(Ft(M,T)),t.commit({annotation:r.t("issues.fix.tag_as_disconnected.annotation"),selectedIDs:[M]})}})),E}function x(A){A.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.almost_junction.highway-highway.reference"))}function b(A,E){let I=n.services.osm;if(I&&!I.isDataLoaded(A.loc)||c(A)||h.parentWays(A).length!==1)return!1;let M=0;for(let T in E.nodes)if(E.nodes[T]===A.id&&(M+=1,M>1))return!1;return!0}function _(A,E){let I=[];if(A.isClosed())return I;let M;return[0,A.nodes.length-1].forEach(R=>{let P=A.nodes[R],D=E.entity(P);if(!b(D,A))return;let N=w(A,R);N&&(M=E.childNodes(A).slice(),M[R]=M[R].move(N.cross_loc),!Rc(M,P)&&I.push(N))}),I}function S(A,E,I){return[E.nodes[0],E.nodes[E.nodes.length-1]].map(M=>I.entity(M)).filter(M=>M.id!==A.id&&ht(A.loc,M.loc)<=o)}function C(A,E,I){let M,T=1/0;return I.forEach(R=>{let P=n.viewport.project(A.loc),D=n.viewport.project(E.loc),N=n.viewport.project(R.loc),F=sr(P,D)+Math.PI,B=sr(P,N)+Math.PI,O=Math.max(F,B)-Math.min(F,B);O<T&&(M=R,T=O)}),T<=a?M:null}function k(A,E){return A[E]!==void 0&&A[E]!=="no"}function v(A,E){if(A.id===E.id)return!0;if((k(A.tags,"bridge")||k(E.tags,"bridge"))&&!(k(A.tags,"bridge")&&k(E.tags,"bridge"))||(k(A.tags,"tunnel")||k(E.tags,"tunnel"))&&!(k(A.tags,"tunnel")&&k(E.tags,"tunnel")))return!1;let I=A.tags.layer||"0",M=E.tags.layer||"0";if(I!==M)return!1;let T=A.tags.level||"0",R=E.tags.level||"0";return T===R}function w(A,E){let I=A.nodes[E],M=E===0?A.nodes[1]:A.nodes[A.nodes.length-2],T=h.entity(I),R=h.entity(M),P=T.loc[0],D=T.loc[1],N=Gr(i,D)/2,F=Gi(i)/2,B=new le([P-N,D-F],[P+N,D+F]),O=ht(R.loc,T.loc),G=i/O+1,U=at(R.loc,T.loc,G),W=p.waySegments(B,h);for(let V=0;V<W.length;V++){let j=W[V],Z=h.entity(j.wayId);if(!l(Z)||!v(A,Z))continue;let Y=j.nodes[0],K=j.nodes[1];if(Y===I||K===I)continue;let ne=h.entity(Y),ie=h.entity(K),q=da([T.loc,U],[ne.loc,ie.loc]);if(q)return{mid:R,node:T,wid:Z.id,edge:[ne.id,ie.id],cross_loc:q}}return null}};return u.type=e,u}function BP(n){let e="close_nodes",t=n.systems.editor,r=n.systems.l10n,i=.2;function s(a){return a!==void 0&&a!=="no"}let o=function(a,l){if(a.type==="node")return c(a);if(a.type==="way")return f(a);return[];function c(y){let x=l.parentWays(y);return x.length?h(y,x):m(y)}function u(y){let x=y.tags;if(s(x.boundary))return"boundary";if(s(x.indoor))return"indoor";if(s(x.building)||s(x["building:part"]))return"building";if(Ns[x.highway])return"path";let b=l.parentRelations(y);for(let _ of b){if(_.tags.type==="boundary")return"boundary";if(_.isMultipolygon()){if(s(_.tags.indoor))return"indoor";if(s(_.tags.building)||s(_.tags["building:part"]))return"building"}}return"other"}function d(y){if(y.nodes.length<=2||y.isClosed()&&y.nodes.length<=4)return!1;let x=y.extent(l).bbox();return!(ht([x.minX,x.minY],[x.maxX,x.maxY])<1.5)}function f(y){if(!d(y))return[];let x=[],b=l.childNodes(y);for(let _=0;_<b.length-1;_++){let S=b[_],C=b[_+1],k=g(S,C,y);k&&x.push(k)}return x}function h(y,x){let b=[];function _(S,C,k){let v=g(S,C,k);v&&b.push(v)}for(let S of x){if(!d(S))continue;let C=S.nodes.length-1;for(let k=0;k<S.nodes.length;k++)k!==0&&S.nodes[k-1]===y.id&&_(y,l.entity(S.nodes[k]),S),k!==C&&S.nodes[k+1]===y.id&&_(l.entity(S.nodes[k]),y,S)}return b}function p(y){if(!d(y))return 0;let x=u(y);return x==="boundary"?0:x==="indoor"?.01:x==="building"?.05:x==="path"?.1:.2}function m(y){let x=[],b=y.loc[0],_=y.loc[1],S=Gr(i,_)/2,C=Gi(i)/2,k=new le([b-S,_-C],[b+S,_+C]),v=t.tree.intersects(k,l);for(let E of v)if(E.id!==y.id&&!(E.type!=="node"||E.geometry(l)!=="point")&&(E.loc===y.loc||ht(y.loc,E.loc)<i)){if("memorial:type"in y.tags&&"memorial:type"in E.tags&&y.tags["memorial:type"]==="stolperstein"&&E.tags["memorial:type"]==="stolperstein"||"memorial"in y.tags&&"memorial"in E.tags&&y.tags.memorial==="stolperstein"&&E.tags.memorial==="stolperstein")continue;let I={layer:!0,level:!0,"addr:housenumber":!0,"addr:unit":!0},M=!1;for(var w in I){let T=y.tags[w]||"0",R=E.tags[w]||"0";if(T!==R){M=!0;break}}if(M)continue;x.push(new et(n,{type:e,subtype:"detached",severity:"warning",message:function(){let T=t.staging.graph,R=T.hasEntity(this.entityIds[0]),P=T.hasEntity(this.entityIds[1]);return R&&P?r.t("issues.close_nodes.detached.message",{feature:r.displayLabel(R,T),feature2:r.displayLabel(P,T)}):""},reference:A,entityIds:[y.id,E.id],dynamicFixes:function(){return[new Re({icon:"rapid-operation-disconnect",title:r.t("issues.fix.move_points_apart.title")}),new Re({icon:"rapid-icon-layers",title:r.t("issues.fix.use_different_layers_or_levels.title")})]}}))}return x;function A(E){E.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.close_nodes.detached.reference"))}}function g(y,x,b){if(y.id===x.id||y.hasInterestingTags()&&x.hasInterestingTags())return null;if(y.loc!==x.loc){let C=l.parentWays(y),k=new Set(l.parentWays(x)),w=C.filter(I=>k.has(I)).map(I=>p(I)),A=Math.min(...w);if(ht(y.loc,x.loc)>A)return null}let _=C=>k=>{let v=C[0],w=C[1];return v&&w&&k.hasEntity(v)&&k.hasEntity(w)?bi(C)(k):k};return new et(n,{type:e,subtype:"vertices",severity:"warning",message:function(){let C=t.staging.graph,k=C.hasEntity(this.entityIds[0]);return k?r.t("issues.close_nodes.message",{way:r.displayLabel(k,C)}):""},reference:S,entityIds:[b.id,y.id,x.id],loc:y.loc,autoArgs:[_([y.id,x.id]),r.t("issues.fix.merge_close_vertices.annotation")],dynamicFixes:function(){return[new Re({icon:"rapid-icon-plus",title:r.t("issues.fix.merge_points.title"),onClick:function(){let C=this.issue.entityIds;t.perform(bi([C[1],C[2]])),t.commit({annotation:r.t("issues.fix.merge_close_vertices.annotation"),selectedIDs:[C[1],C[2]]})}}),new Re({icon:"rapid-operation-disconnect",title:r.t("issues.fix.move_points_apart.title")})]}});function S(C){C.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.close_nodes.reference"))}}};return o.type=e,o}function NP(n){let e="ambiguous_crossing",t=n.systems.editor,r=n.systems.l10n,i=n.systems.presets,s=function(c,u){return c.type!=="way"||c.isDegenerate()?[]:a(c,u)};function o(l){return c=>{let u=c.entity(l),d=i.match(u,c),f=d.replacement,h=f&&i.item(f);return h?c=ti(l,d,h,!0)(c):c=Gs(l)(c),c}}function a(l,c){let u=l.id,d=i.match(l,c),f=o(u),h=f(c),p=new Fn(c,h);if(!p.changes.size)return[];let m=h.hasEntity(u);if(!m)return[];let g=new Map,y=new Map,x=k(m.tags),b=x.type!=="not a crossing";v(x);let _=ia(l.tags,m.tags);y.set(u,{name:d.name(),tagDiff:_});let S=_.length>0;for(let M of p.changes.values()){let T=M?.base,R=M?.head;if(!T||!R||T.type!=="node")continue;b&&(v(k(T.tags)),v(k(R.tags)));let P=i.match(T,c),D=ia(T.tags,R.tags);y.set(T.id,{name:P.name(),tagDiff:D})}v(k({}));let C=!0;if(y.size>1){for(let M of y.values())if(M.tagDiff?.length&&M.tagDiff.some(T=>T.type==="-")){C=!1;break}}return[new et(n,{type:e,subtype:"crossing_conflict",severity:"warning",entityIds:[...y.keys()],data:{isParentCrossing:b,isParentChanged:S,isTagUpgrade:C,updates:y,choices:g},autoArgs:[f,r.t("issues.ambiguous_crossing.annotation.changed")],message:E,reference:I,dynamicFixes:w})];function k(M){let T=M["crossing:markings"]??"",R=M.crossing??"",P=M.highway==="crossing"||M.path==="crossing"||M.footway==="crossing"||M.cycleway==="crossing"||M.bridleway==="crossing"||M.pedestrian==="crossing",D,N;return T!==""&&T!=="yes"&&T!=="no"?(D=T,N={"crossing:markings":T}):T==="yes"?(D="marked",N={"crossing:markings":"yes"}):T==="no"?(D="unmarked",N={"crossing:markings":"no"}):R!==""?(D=R,N={crossing:R}):P?(D="unspecified",N=null):(D="not a crossing",N={footway:null,path:null,cycleway:null,bridleway:null,pedestrian:null,crossing:null,"crossing:markings":null,"crossing:signals":null}),{type:D,tags:N}}function v(M){let T=M.type,R=M.tags;if(T==="unspecified")return;let P=g.get(T);return P?T!=="not a crossing"&&(P.setTags=Object.assign(P.setTags,R)):(P={setTags:R},g.set(T,P)),P}function w(){let M=this,T=M.entityIds[0],R=M.data.choices,P=M.data.isTagUpgrade?"update_type":"choose_type",D=[];for(let[O,G]of R){if(O==="not a crossing")continue;let U=r.t(`issues.ambiguous_crossing.fix.${P}`,{type:O}),W=A(U,T,G.setTags);D.push(W)}let N=R.get("not a crossing"),F=r.t("issues.ambiguous_crossing.fix.remove_all"),B=A(F,T,N.setTags);return D.push(B),D}function A(M,T,R){return new Re({title:M,onClick:()=>{let D=t.staging.graph.hasEntity(T);if(D){if(R){let N=Object.assign({},D.tags);for(let[F,B]of Object.entries(R))B?N[F]=B:delete N[F];t.perform(Ft(D.id,N))}t.perform(f),t.commit({annotation:r.t("issues.ambiguous_crossing.annotation.changed"),selectedIDs:[D.id]})}}})}function E(){let T=this.data;return T.isParentCrossing&&!T.isParentChanged&&T.isTagUpgrade?r.t("issues.ambiguous_crossing.message.candidate"):T.isTagUpgrade?r.t("issues.ambiguous_crossing.message.update"):r.t("issues.ambiguous_crossing.message.conflict")}function I(M){let T=this,R=[];for(let[N,F]of T.data.updates)R.push({entityID:N,name:F.name,tagDiff:F.tagDiff||[]});let P=M.selectAll(".issue-reference").data([0]).enter();P.append("div").attr("class","issue-reference").text(r.t("issues.ambiguous_crossing.reference.line1")),P.append("div").attr("class","issue-reference").text(r.t("issues.ambiguous_crossing.reference.line2")),P.append("strong").text(r.t("issues.suggested"));let D=P.selectAll(".suggested-update").data(R,N=>N.entityID).enter().append("div").attr("class","suggested-update");D.append("strong").text(N=>`${N.entityID[0]==="w"?r.t("modes.add_line.title"):r.t("modes.add_point.title")} ${N.entityID} - ${N.name}:`),D.each((N,F,B)=>{let O=H(B[F]);N.tagDiff.length?O.append("table").attr("class","tagDiff-table").selectAll(".tagDiff-row").data(G=>G.tagDiff).enter().append("tr").attr("class","tagDiff-row").append("td").attr("class",G=>`tagDiff-cell tagDiff-cell-${G.type==="+"?"add":"remove"}`).text(G=>G.display):O.append("div").attr("class","tagDiff-message").text(G=>G.entityID===u&&!T.data.isParentCrossing?r.t("issues.ambiguous_crossing.not_a_crossing"):r.t("issues.ambiguous_crossing.no_changes"))})}}return s.type=e,s}function OP(n){let e="crossing_ways",t=n.systems.editor,r=n.systems.l10n;function i(v){return v!==void 0&&v!=="no"}function s(v){return i(v.indoor)||i(v.level)||v.highway==="corridor"}let o=new Set(["aeroway","highway","railway","waterway"]),a=new Set(["highway","railway","waterway"]),l=new Set(["demolished","dismantled","proposed","razed"]),c=new Set(["motorway","motorway_link","trunk","trunk_link","primary","primary_link","secondary","secondary_link"]),u=new Set(["path","footway","cycleway","bridleway","pedestrian"]);function d(v){for(let w of u)if(v.highway===w&&v[w]==="crossing")return!0;return!1}let f=function(w,A){let E=n.systems.editor.tree,I=[];for(let M of h(w,A))for(let T of x(M,A,E))I.push(b(T,A));return I};function h(v,w){if(m(v,w)){if(v.type==="way")return new Set([v]);if(v.type==="relation"&&v.tags.type==="multipolygon"){let A=new Set;for(let E of v.members)if(E.type==="way"&&(!E.role||E.role==="outer"||E.role==="inner")){let I=w.hasEntity(E.id);I&&A.add(I)}return A}else return new Set}else return new Set}function p(v,w){if(m(v,w)===null){let A=w.parentRelations(v);for(let E of A)if(m(E,w)!==null)return E}return v}function m(v,w){let A=v.geometry(w);if(A!=="line"&&A!=="area")return null;let E=v.tags;return VD[E.aeroway]?"aeroway":i(E.building)&&!l.has(E.building)?"building":i(E.highway)&&is[E.highway]?"highway":A!=="line"?null:i(E.railway)&&k6[E.railway]?"railway":i(E.waterway)&&Q1[E.waterway]?"waterway":null}function g(v,w,A,E){let I=v.level||"0",M=A.level||"0";if(s(v)&&s(A)&&I!==M)return!0;let T=v.layer||"0",R=A.layer||"0";if(w==="highway"&&E==="highway"&&T!==R)return!0;let P=o.has(w)&&i(v.bridge),D=o.has(E)&&i(A.bridge);if(P&&!D||!P&&D||P&&D&&T!==R)return!0;let N=a.has(w)&&i(v.tunnel),F=a.has(E)&&i(A.tunnel);return!!(N&&!F||!N&&F||N&&F&&T!==R||w==="waterway"&&E==="highway"&&A.man_made==="pier"||E==="waterway"&&w==="highway"&&v.man_made==="pier"||(w==="building"||E==="building")&&T!==R)}function y(v,w,A){let E=m(v,A),I=m(w,A),M=[E,I].sort().join("-"),T=v.geometry(A),R=w.geometry(A),P=T==="line"&&R==="line";if(M==="aeroway-aeroway")return{};if(M==="aeroway-highway"){let D=v.tags.highway==="service"||w.tags.highway==="service",N=Ns[v.tags.highway]||Ns[w.tags.highway];return D||N?{}:{aeroway:"aircraft_crossing"}}else{if(M==="aeroway-railway")return{aeroway:"aircraft_crossing",railway:"level_crossing"};if(M==="aeroway-waterway")return null;if(M==="highway-highway"){let D=Ns[v.tags.highway],N=Ns[w.tags.highway];return(D||N)&&D!==N?!P||(D?w:v).tags.highway==="track"?{}:{highway:"crossing"}:{}}else if(M==="highway-railway"){if(!P)return{};let D=v.tags.railway==="tram"||w.tags.railway==="tram";return Ns[v.tags.highway]||Ns[w.tags.highway]?D?{railway:"tram_crossing"}:{railway:"crossing"}:D?{railway:"tram_level_crossing"}:{railway:"level_crossing"}}else{if(M==="highway-waterway")return i(v.tags.tunnel)&&i(w.tags.tunnel)||i(v.tags.bridge)&&i(w.tags.bridge)||c.has(v.tags.highway)||c.has(w.tags.highway)?null:P?{ford:"yes"}:{};if(M==="railway-railway")return{};if(M==="railway-waterway")return null;if(M==="waterway-waterway")return{}}}return null}function x(v,w,A){if(v.type!=="way")return[];let E=p(v,w),I=E.tags,M=m(E,w);if(M===null)return[];let T=new Set,R=[],P=w.childNodes(v);for(let D=0;D<P.length-1;D++){let N=P[D],F=P[D+1],B=new le([Math.min(N.loc[0],F.loc[0]),Math.min(N.loc[1],F.loc[1])],[Math.max(N.loc[0],F.loc[0]),Math.max(N.loc[1],F.loc[1])]),O=A.waySegments(B,w);for(let G of O){if(G.wayId===v.id||T.has(G.wayId))continue;let U=w.hasEntity(G.wayId);if(!U)continue;let W=p(U,w),V=m(W,w),j=W.tags;if(V===null||g(I,M,j,V))continue;let Z=G.nodes[0],Y=G.nodes[1];if(Z===N.id||Z===F.id||Y===N.id||Y===F.id)continue;let K=w.hasEntity(Z),ne=w.hasEntity(Y);if(!K||!ne)continue;let ie=[N.loc,F.loc],q=[K.loc,ne.loc],se=da(ie,q);if(se&&(R.push({wayInfos:[{way:v,featureType:M,edge:[N.id,F.id]},{way:U,featureType:V,edge:[K.id,ne.id]}],crossPoint:se}),M==="building"||V==="building")){T.add(U.id);break}}}return R}function b(v,w){v.wayInfos.sort((te,Q)=>{let _e=te.featureType,je=Q.featureType;return _e===je?r.displayLabel(te.way,w)>r.displayLabel(Q.way,w):_e==="waterway"?!0:je==="waterway"?!1:_e<je});let A=v.wayInfos.map(te=>p(te.way,w)),[E,I]=A,M=E.tags,T=I.tags,R=v.wayInfos[0].featureType,P=v.wayInfos[1].featureType,D=[v.wayInfos[0].edge,v.wayInfos[1].edge],N=[R,P],F=y(E,I,w),B=s(M)&&s(T),O=o.has(R)&&i(M.bridge),G=o.has(P)&&i(T.bridge),U=O&&G,W=a.has(R)&&i(M.tunnel),V=a.has(P)&&i(T.tunnel),j=W&&V,Z=(M.highway==="service"||T.highway==="service")&&F?.highway==="crossing",Y=null;F?.highway==="crossing"&&(d(M)?Y=E.id:d(T)&&(Y=I.id));let K=[R,P].sort().join("-"),ne=K;B?ne="indoor-indoor":j?ne="tunnel-tunnel":U&&(ne="bridge-bridge"),F&&(B||j||U)&&(ne+="_connectable");let ie=""+v.crossPoint[0].toFixed(4)+","+v.crossPoint[1].toFixed(4),q=null;return Z?q=S(v.crossPoint,D,null,{}):F&&!F.ford&&(q=S(v.crossPoint,D,Y,F)),new et(n,{type:e,subtype:K,severity:"warning",message:function(){let te=t.staging.graph,Q=te.hasEntity(this.entityIds[0]),_e=te.hasEntity(this.entityIds[1]);return Q&&_e?r.t("issues.crossing_ways.message",{feature:r.displayLabel(Q,te),feature2:r.displayLabel(_e,te)}):""},reference:se,entityIds:[E.id,I.id],data:{edges:D,featureTypes:N,crossingWayID:Y,connectionTags:F},hash:ie,loc:v.crossPoint,autoArgs:q,dynamicFixes:function(){let te=t.staging.graph,Q=n.selectedIDs();if(n.mode?.id!=="select-osm"||Q.length!==1)return[];let _e=this.entityIds[0]===Q[0]?0:1,je=this.data.featureTypes[_e],Dt=this.data.featureTypes[_e===0?1:0],xt=[];if(Z&&xt.push(C({})),F&&xt.push(C(F)),B)xt.push(new Re({icon:"rapid-icon-layers",title:r.t("issues.fix.use_different_levels.title")}));else if(j||U||R==="building"||P==="building")xt.push(k("higher")),xt.push(k("lower"));else if(te.geometry(this.entityIds[0])==="line"&&te.geometry(this.entityIds[1])==="line"){o.has(je)&&je!=="waterway"&&xt.push(_("add_a_bridge","temaki-bridge","bridge"));let nr=Dt==="waterway"&&je!=="waterway";a.has(je)&&!nr&&xt.push(_("add_a_tunnel","temaki-tunnel","tunnel"))}return xt.push(new Re({icon:"rapid-operation-move",title:r.t("issues.fix.reposition_features.title")})),xt}});function se(te){te.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t(`issues.crossing_ways.${ne}.reference`))}}function _(v,w,A){return new Re({icon:w,title:r.t(`issues.fix.${v}.title`),onClick:function(){if(n.mode?.id!=="select-osm")return;let E=n.selectedIDs();if(E.length!==1)return;let I=E[0];if(!t.staging.graph.hasEntity(I))return;let T=[I],R,P,D;this.issue.entityIds[0]===I?(R=this.issue.data.edges[0],P=this.issue.data.edges[1],D=this.issue.entityIds[1]):(R=this.issue.data.edges[1],P=this.issue.data.edges[0],D=this.issue.entityIds[0]);let N=this.issue.loc,F=n.viewport,B=O=>{let G=[O.entity(R[0]),O.entity(R[1])],U=O.hasEntity(D),W=U&&U.tags.width&&parseFloat(U.tags.width);W||(W=U&&U.impliedLineWidthMeters()),W?m(U,O)==="railway"&&(W*=2):W=8;let V=sr(F.project(G[0].loc),F.project(G[1].loc))+Math.PI,j=sr(F.project(O.entity(P[0]).loc),F.project(O.entity(P[1]).loc))+Math.PI,Z=Math.max(V,j)-Math.min(V,j);Z>Math.PI&&(Z-=Math.PI),W=W/2/Math.sin(Z)*2,W+=4,W=Math.min(Math.max(W,4),50);function Y(Ye){return[Za(Ye[0],Ye[1]),a2(Ye[1])]}function K(Ye){let mt=Gi(Ye[1]);return[Gr(Ye[0],mt),mt]}let ne=Y(G[0].loc),ie=Y(G[1].loc),q=sr(ne,ie),se=Y(N),te=Ne(ne,ie)/ht(G[0].loc,G[1].loc);function Q(Ye,mt){let Yr=mt*te;return K([se[0]+Math.cos(Ye)*Yr,se[1]+Math.sin(Ye)*Yr])}let _e=function(Ye){return Q(q,Ye)},je=function(Ye){return Q(q+Math.PI,Ye)},Dt=.55;function xt(Ye,mt,Yr){let di,_c=W/2,ja=ht(N,mt.loc);if(ja-_c>Dt){let na=Yr(_c);di=Le(),O=Cr({loc:na,edge:Ye},di)(O)}else{let na=0;if(mt.parentIntersectionWays(O).forEach(function(Pn){Pn.nodes.forEach(function(rs){rs===mt.id&&(mt.id===Pn.first()&&mt.id!==Pn.last()||mt.id===Pn.last()&&mt.id!==Pn.first()?na+=1:na+=2)})}),na>=3){let Pn=ja-Dt;if(Pn>Dt){let rs=Yr(Pn);di=Le(),O=Cr({loc:rs,edge:Ye},di)(O)}}}di||(di=mt);let Bi=$s([di.id]).limitWays(T);return O=Bi(O),Bi.getCreatedWayIDs().length&&T.push(Bi.getCreatedWayIDs()[0]),di}let nr=xt(R,G[1],_e),on=xt([G[0].id,nr.id],G[0],je),rn=T.map(Ye=>O.entity(Ye)).find(Ye=>Ye.nodes.includes(nr.id)&&Ye.nodes.includes(on.id)),fr=Object.assign({},rn.tags);if(A==="bridge")fr.bridge="yes",fr.layer="1";else{let Ye=m(rn,O);fr.tunnel=Ye==="waterway"?"culvert":"yes",fr.layer="-1"}return O=Ft(rn.id,fr)(O),O};t.perform(B),t.commit({annotation:r.t(`issues.fix.${v}.annotation`),selectedIDs:[I]}),n.enter("select-osm",{selection:{osm:T}})}})}function S(v,w,A,E){return[M=>{let T=Le({loc:v,tags:E});M=M.replace(T);let R=[T.id],P=.75;for(let D of w){let N=M.hasEntity(D[0]),F=M.hasEntity(D[1]);if(!N||!F)continue;let B=!1,O=[N,F],G=im([N.loc,F.loc],v);if(G&&G.distance<P){let U=O[G.index];(!U.hasInterestingTags()||U.isCrossing())&&(B=!0,R.push(U.id))}B||(M=Cr({loc:v,edge:D},T)(M))}return R.length>1&&(M=bi(R,v)(M)),A&&(M=Gs(A)(M)),M},r.t("issues.fix.connect_crossing_features.annotation")]}function C(v){let w="connect_features",A="rapid-icon-connect";return v.ford?w="connect_using_ford":v.highway==="crossing"&&(w="connect_using_crossing",A="temaki-pedestrian"),new Re({icon:A,title:r.t(`issues.fix.${w}.title`),onClick:function(){let E=this.issue.loc,I=this.issue.data.edges,M=this.issue.data.crossingWayID,T=S(E,I,M,v);t.perform(T[0]),t.commit({annotation:T[1],selectedIDs:this.issue.entityIds})}})}function k(v){return new Re({icon:"rapid-icon-"+(v==="higher"?"up":"down"),title:r.t(`issues.fix.tag_this_as_${v}.title`),onClick:function(){if(n.mode?.id!=="select-osm")return;let w=n.selectedIDs();if(w.length!==1)return;let A=w[0];if(!this.issue.entityIds.some(R=>R===A))return;let I=t.staging.graph.hasEntity(A);if(!I)return;let M=Object.assign({},I.tags),T=M.layer&&Number(M.layer);T&&!isNaN(T)?v==="higher"?T+=1:T-=1:v==="higher"?T=1:T=-1,M.layer=T.toString(),t.perform(Ft(I.id,M)),t.commit({annotation:r.t("operations.change_tags.annotation"),selectedIDs:[A]})}})}return f.type=e,f}function LP(n){let e="disconnected_way",t=n.systems.editor,r=n.systems.l10n,i=n.systems.map;function s(a){return is[a.tags.highway]}let o=function(l,c){let u=h(l);if(!u)return[];return[new et(n,{type:e,subtype:"highway",severity:"warning",message:function(){let x=t.staging.graph,b=this.entityIds.length&&x.hasEntity(this.entityIds[0]),_=b&&r.displayLabel(b,x);return r.t("issues.disconnected_way.routable.message",{count:this.entityIds.length,highway:_})},reference:f,entityIds:Array.from(u).map(x=>x.id),dynamicFixes:d})];function d(){let x=t.staging.graph,b=this.entityIds.length===1&&x.hasEntity(this.entityIds[0]),_=[];if(b){if(b.type==="way"&&!b.isClosed()){let S=y(b.first(),"start");S&&_.push(S);let C=y(b.last(),"end");C&&_.push(C)}_.length||_.push(new Re({title:r.t("issues.fix.connect_feature.title")})),_.push(new Re({icon:"rapid-operation-delete",title:r.t("issues.fix.delete_feature.title"),entityIds:[b.id],onClick:function(){let S=this.issue.entityIds[0],C=Ji(n,[S]);C.disabled()||C()}}))}else _.push(new Re({title:r.t("issues.fix.connect_features.title")}));return _}function f(x){x.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.disconnected_way.routable.reference"))}function h(x){let b=new Set,_=[];function S(C){for(let k of c.parentWays(C))!b.has(k)&&g(k,!1)&&(b.add(k),_.push(k))}if(x.type==="way"&&g(x,!0))b.add(x),_.push(x);else if(x.type==="node"&&m(x))b.add(x),S(x);else return null;for(;_.length;){let C=_.pop();for(let k of c.childNodes(C)){if(p(k))return null;m(k)&&b.add(k),S(k)}}return b}function p(x){let b=n.services.osm;return!!(b&&!b.isDataLoaded(x.loc)||x.tags.entrance&&x.tags.entrance!=="no"||x.tags.amenity==="parking_entrance")}function m(x){return x.tags.highway==="elevator"}function g(x,b){return s(x)||x.tags.route==="ferry"?!0:c.parentRelations(x).some(_=>!!(_.tags.type==="route"&&_.tags.route==="ferry"||_.isMultipolygon()&&s(_)&&(!b||_.memberById(x.id).role!=="inner")))}function y(x,b){let _=c.hasEntity(x);if(!_||_.tags.noexit==="yes")return null;let S=r.isRTL(),C=b==="start"&&!S||b==="end"&&S;return new Re({icon:"rapid-operation-continue"+(C?"-left":""),title:r.t(`issues.fix.continue_from_${b}.title`),entityIds:[x],onClick:function(){let k=t.staging.graph,v=this.issue.entityIds[0],w=k.hasEntity(v),A=this.entityIds[0],E=k.hasEntity(A);!w||!E||((!n.editable()||!i.trimmedExtent().contains(new le(E.loc)))&&i.fitEntitiesEase(E),n.enter("draw-line",{continueWayID:w.id,continueNodeID:E.id}))}})}};return o.type=e,o}function UP(n){let e="duplicate_way_segments",t=n.systems.editor,r=n.systems.l10n,i=function(s,o){if(s.type==="way")return u(s);return[];function a(f){return f==="highway"||f==="railway"||f==="waterway"}function l(f){return f.isArea()?!1:Object.keys(f.tags).some(a)}function c(f,h,p){let m=o.childNodes(p),g=m.findIndex(x=>x.id===f.id),y=m.findIndex(x=>x.id===h.id);return Math.abs(g-y)===1}function u(f){let h=[];if(!l(f))return h;let p=o.childNodes(f);for(let m=0;m<p.length-1;m++){let g=p[m],y=p[m+1],x=d(g,y,f);x&&h.push(x)}return h}function d(f,h,p){if(f.id===h.id)return null;if(f.loc!==h.loc){let g=o.parentWays(f),y=new Set(o.parentWays(h));if(g.filter(S=>y.has(S)).filter(S=>l(S)).filter(S=>c(f,h,S)).length<=1)return null}return new et(n,{type:e,subtype:"vertices",severity:"warning",message:function(){let g=t.staging.graph,y=g.hasEntity(this.entityIds[0]);return y?r.t("issues.duplicate_way_segments.message",{way:r.displayLabel(y,g)}):""},reference:m,entityIds:[p.id,f.id,h.id],loc:f.loc,dynamicFixes:()=>[new Re({icon:"rapid-icon-plus",title:r.t("issues.fix.merge_points.title")}),new Re({icon:"rapid-operation-delete",title:r.t("issues.fix.remove_way_segments.title")}),new Re({icon:"rapid-operation-disconnect",title:r.t("issues.fix.move_way_segments_apart.title")})]});function m(g){g.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.duplicate_way_segments.reference"))}}};return i.type=e,i}function GP(n){let e="invalid_format",t=n.systems.editor,r=n.systems.l10n,i=function(s){let o=[];function a(c){return!c||/^[^\(\)\\,":;<>@\[\]]+@[^\(\)\\,":;<>@\[\]\.]+(?:\.[a-z0-9-]+)*$/i.test(c)}function l(c){c.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.invalid_format.email.reference"))}if(s.tags.email){let c=s.tags.email.split(";").map(u=>u.trim()).filter(u=>!a(u));c.length&&o.push(new et(n,{type:e,subtype:"email",severity:"warning",message:function(){let u=t.staging.graph,d=u.hasEntity(this.entityIds[0]);return d?r.t("issues.invalid_format.email.message",{n:c.length,feature:r.displayLabel(d,u),email:c.join(", ")}):""},reference:l,entityIds:[s.id],hash:c.join()}))}return o};return i.type=e,i}function $P(n){let e="help_request",t=n.systems.editor,r=n.systems.l10n,i=function(o){if(!o.tags.fixme)return[];if(o.version===void 0)return[];if(o.v!==void 0){let l=t.base.graph.hasEntity(o.id);if(!l||!l.tags.fixme)return[]}return[new et(n,{type:e,subtype:"fixme_tag",severity:"warning",message:function(){let l=t.staging.graph,c=l.hasEntity(this.entityIds[0]);return c?r.t("issues.fixme_tag.message",{feature:r.displayLabel(c,l,!0)}):""},dynamicFixes:()=>[new Re({title:r.t("issues.fix.address_the_concern.title")})],reference:a,entityIds:[o.id]})];function a(l){l.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.fixme_tag.reference"))}};return i.type=e,i}function zP(n){let e="impossible_oneway",t=n.systems.editor,r=n.systems.l10n,i=function(a,l){if(a.type!=="way"||a.geometry(l)!=="line")return[];if(a.isClosed())return[];if(!d(a))return[];if(!a.isOneWay())return[];if(a.tags.oneway==="alternating"||a.tags.oneway==="reversible"||a.tags.intermittent==="yes")return[];let c=p(a,a.first()),u=p(a,a.last());return c.concat(u);function d(m){return m.geometry(l)!=="line"?null:is[m.tags.highway]?"highway":Q1[m.tags.waterway]?"waterway":null}function f(m,g){return m.nodes.indexOf(g)!==m.nodes.lastIndexOf(g)}function h(m,g,y){let x=d(m);if(x==="highway"){if(g.tags.entrance&&g.tags.entrance!=="no"||g.tags.amenity==="parking_entrance")return!0}else if(x==="waterway"){if(y){if(g.tags.natural==="spring")return!0}else if(g.tags.manhole==="drain")return!0}return l.parentWays(g).some(b=>b.id===m.id?!1:x==="highway"?b.geometry(l)==="area"&&is[b.tags.highway]||b.tags.route==="ferry"?!0:l.parentRelations(b).some(_=>_.tags.type==="route"&&_.tags.route==="ferry"?!0:_.isMultipolygon()&&is[_.tags.highway]):x==="waterway"&&(b.tags.natural==="water"||b.tags.natural==="coastline"))}function p(m,g){let y=g===m.first()&&m.tags.oneway!=="-1",x=!y,b=d(m);if(f(m,g))return[];let _=n.services.osm;if(!_)return[];let S=l.hasEntity(g);if(!S||!_.isDataLoaded(S.loc))return[];if(h(m,S,y))return[];let C=l.parentWays(S).filter(I=>I.id===m.id?!1:d(I)===b);if(b==="waterway"&&C.length===0)return[];let k=C.filter(I=>I.isOneWay());if(k.length<C.length)return[];for(let I of k){if(f(I,g))return[];let M=I.tags.oneway==="-1"?I.last():I.first(),T=I.tags.oneway==="-1"?I.first():I.last();if(y&&g!==M||x&&g!==T)return[]}let v=y?"start":"end",w,A;return b==="waterway"?(w=`${b}.connected.${v}`,A=`${b}.connected`):(w=`${b}.${v}`,A=`${b}.${v}`),[new et(n,{type:e,subtype:b,severity:"warning",message:function(){let I=t.staging.graph,M=I.hasEntity(this.entityIds[0]);return M?r.t(`issues.impossible_oneway.${w}.message`,{feature:r.displayLabel(M,I)}):""},reference:E(A),entityIds:[m.id,S.id],dynamicFixes:function(){let I=t.staging.graph,M=[];if(k.length&&M.push(new Re({icon:"rapid-operation-reverse",title:r.t("issues.fix.reverse_feature.title"),entityIds:[m.id],onClick:function(){let T=this.issue.entityIds[0];t.perform(ns(T)),t.commit({annotation:r.t("operations.reverse.annotation.line",{n:1}),selectedIDs:[T]})}})),S.tags.noexit!=="yes"){let T=r.isRTL(),R=y&&!T||!y&&T;M.push(new Re({icon:"rapid-operation-continue"+(R?"-left":""),title:r.t("issues.fix.continue_from_"+(y?"start":"end")+".title"),onClick:function(){let P=this.issue.entityIds[0],D=this.issue.entityIds[1],N=I.entity(P),F=I.entity(D);s(N,F,n)}}))}return M},loc:S.loc})];function E(I){return function(T){T.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t(`issues.impossible_oneway.${I}.reference`))}}}};function s(o,a,l){let c=l.systems.map;(!l.editable()||!c.trimmedExtent().contains(new le(a.loc)))&&c.fitEntitiesEase(a),l.enter("draw-line",{continueWayID:o.id,continueNodeID:a.id})}return i.type=e,i}function HP(n){let e="incompatible_source",t=n.systems.editor,r=n.systems.l10n,i=[{id:"amap",regex:/(amap|autonavi|mapabc|高德)/i},{id:"baidu",regex:/(baidu|mapbar|百度)/i},{id:"google",regex:/google/i,exceptRegex:/((books|drive)\.google|google\s?(books|drive|plus))|(esri\/google)/i}],s=function(a){let l=a.tags?.source&&a.tags.source.split(";");if(!l)return[];let c=a.id;return l.map(d=>{let f=i.find(h=>!(!h.regex.test(d)||h.exceptRegex&&h.exceptRegex.test(d)));return f?new et(n,{type:e,severity:"warning",message:()=>{let h=t.staging.graph,p=h.hasEntity(c);return p?r.t("issues.incompatible_source.feature.message",{feature:r.displayLabel(p,h,!0),value:d}):""},reference:u(f.id),entityIds:[c],hash:d,dynamicFixes:()=>[new Re({title:r.t("issues.fix.remove_proprietary_data.title")})]}):null}).filter(Boolean);function u(d){return function(h){h.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t(`issues.incompatible_source.reference.${d}`))}}};return s.type=e,s}function WP(n){let e="curb_nodes",t=n.systems.editor,r=n.systems.l10n,i=function(y,x){return y.type!=="way"||y.isDegenerate()?[]:o(y,x)},s=g=>g.highway==="footway"&&g.footway==="crossing"||g.highway==="cycleway"&&g.cycleway==="crossing",o=(g,y)=>{let x=[],b=g.id;if(!a(g)||!s(g.tags))return x;let _=y.entity(g.nodes[0]),S=y.entity(g.nodes[g.nodes.length-1]),C=c(_,y),k=c(S,y);return(!C||!k)&&x.push(new et(n,{type:e,subtype:"missing_curb_nodes",severity:"suggestion",message:()=>g?r.t("issues.curb_nodes.message",{feature:r.displayLabel(g,y)}):"Way not found",reference:l,entityIds:[b],data:{crossingWayID:b},dynamicFixes:()=>["unspecified","flush","lowered","raised"].map(v=>{let w={barrier:"kerb",kerb:v},A=m(w);return new Re({icon:A,title:r.t("issues.curb_nodes.fix.add_curb_nodes",{type:v}),onClick:()=>{u(b,w),t.commit({annotation:r.t("issues.curb_nodes.annotation.added_curb_nodes",{type:v}),selectedIDs:[b]})}})})})),x};function a(g){let y=["highway","cycleway"];return g.isArea()?!1:y.some(x=>g.tags[x])}function l(g){let y=g.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference");y.append("span").text(r.t("issues.curb_nodes.reference.text")),y.append("br"),y.append("a").attr("href",r.t("issues.curb_nodes.reference.link_url")).attr("target","_blank").attr("title",r.t("issues.curb_nodes.reference.link_alt_text")).call(X("#rapid-icon-out-link","inline")).append("span").text(r.t("issues.curb_nodes.reference.link_text"))}function c(g,y){return g.tags&&g.tags.barrier==="kerb"}function u(g,y){let x=t.staging.graph,b=x.hasEntity(g);if(!b){console.error("Way not found:",g);return}let _=x.entity(b.nodes.at(0)),S=x.entity(b.nodes.at(-1)),C=x.parentWays(_).filter(A=>A.id!==g),k=x.parentWays(S).filter(A=>A.id!==g),v=C.some(A=>h(A)),w=k.some(A=>h(A));!C.length||v?f(_,y,x):d(_,b,x,y),!k.length||w?f(S,y,x):d(S,b,x,y)}function d(g,y,x,b){if(c(g,x))return;let _=y.nodes.indexOf(g.id),S=x.entity(y.nodes[_+1]||y.nodes[_-1]),C=p(g,S,1),k=x.parentWays(g),v=null;for(let I of k)if(I.id!==y.id&&!s(I.tags)){v=I.tags;break}let w=Le({loc:[C.lon,C.lat],tags:b,visible:!0});t.perform(Cr({loc:w.loc,edge:[g.id,S.id]},w));let A=$s([w.id]);t.perform(A);let E=A.getCreatedWayIDs();if(E.length>0)for(let I of E)t.perform(Ft(I,v));else console.error("No new ways created after split")}function f(g,y,x){let b={...g.tags,barrier:"kerb",kerb:y.kerb};t.perform(Ft(g.id,b))}function h(g){return g.tags.footway==="traffic_island"}function p(g,y,x,b=!1){if(!g||!y||!g.loc||!y.loc)return null;let _=a2(g.loc[1]),S=Za(g.loc[0],g.loc[1]),C=a2(y.loc[1]),v=Za(y.loc[0],y.loc[1])-S,w=C-_,A=Math.sqrt(v*v+w*w);if(A===0)return null;let E=x/A,I=b?-1:1,M=S+v*E*I,T=_+w*E*I;return{lon:Gr(M,Gi(T)),lat:Gi(T)}}function m(g){let y="default-icon";return g.barrier==="kerb"&&g.kerb==="flush"?y="temaki-kerb-flush":g.barrier==="kerb"&&g.kerb==="raised"?y="temaki-kerb-raised":g.barrier==="kerb"&&g.kerb==="lowered"?y="temaki-kerb-lowered":g.barrier==="kerb"&&g.kerb==="unspecified"&&(y="temaki-kerb-unspecified"),y}return i.type=e,i}var VP=Ot(_2(),1);function jP(n){let e="mismatched_geometry",t=n.systems.editor,r=n.systems.l10n,i=n.systems.presets;function s(p){if(p.type!=="way"||p.isClosed())return null;let m=p.tagSuggestingArea();if(!m)return null;let g=i.matchTags(m,"line"),y=i.matchTags(m,"area");if(g&&y){if(g===y)return null;let x=Object.keys(m)[0];if(g.tags[x]==="*"||y.tags[x==="*"]||g.isFallback()&&y.isFallback()&&!(0,VP.default)(m,{area:"yes"}))return null}return m}function o(p,m){if(p.nodes.length<3)return null;var g=m.childNodes(p),y,x=ht(g[0].loc,g[g.length-1].loc);if(x<.75&&(y=g.slice(),y.pop(),y.push(y[0]),!Rc(y,y[0].id)))return function(){let _=t.staging.graph.entity(this.issue.entityIds[0]);t.perform(bi([_.nodes[0],_.nodes[_.nodes.length-1]],g[0].loc)),t.commit({annotation:r.t("issues.fix.connect_endpoints.annotation"),selectedIDs:[_.id]})};if(y=g.slice(),y.push(y[0]),!Rc(y,y[0].id))return function(){let b=this.issue.entityIds[0],S=t.staging.graph.entity(b),C=S.nodes[0],k=S.nodes.length;t.perform(ls(b,C,k)),t.commit({annotation:r.t("issues.fix.connect_endpoints.annotation"),selectedIDs:[b]})}}function a(p){var m=s(p);if(!m)return null;return new et(n,{type:e,subtype:"area_as_line",severity:"warning",message:function(){let x=t.staging.graph.hasEntity(this.entityIds[0]);return x?r.t("issues.tag_suggests_area.message",{feature:r.displayLabel(x,"area",!0),tag:zD({tags:m})}):""},reference:g,entityIds:[p.id],hash:JSON.stringify(m),dynamicFixes:function(){let y=t.staging.graph;var x=[],b=y.entity(this.entityIds[0]),_=o(b,y);return x.push(new Re({title:r.t("issues.fix.connect_endpoints.title"),onClick:_})),x.push(new Re({icon:"rapid-operation-delete",title:r.t("issues.fix.remove_tag.title"),onClick:function(){let S=this.issue.entityIds[0],k=t.staging.graph.entity(S),v=Object.assign({},k.tags);for(var w in m)delete v[w];t.perform(Ft(S,v)),t.commit({annotation:r.t("issues.fix.remove_tag.annotation"),selectedIDs:[S]})}})),x}});function g(y){y.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.tag_suggests_area.reference"))}}function l(p,m){if(p.type!=="node"||Object.keys(p.tags).length===0||p.isOnAddressLine(m))return null;var g=p.geometry(m),y=qa(p.tags);return g==="point"&&!y.point&&y.vertex?new et(n,{type:e,subtype:"vertex_as_point",severity:"warning",message:function(){let b=t.staging.graph.hasEntity(this.entityIds[0]);return b?r.t("issues.vertex_as_point.message",{feature:r.displayLabel(b,"vertex",!0)}):""},reference:function(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.vertex_as_point.reference"))},entityIds:[p.id]}):g==="vertex"&&!y.vertex&&y.point?new et(n,{type:e,subtype:"point_as_vertex",severity:"warning",message:function(){let b=t.staging.graph.hasEntity(this.entityIds[0]);return b?r.t("issues.point_as_vertex.message",{feature:r.displayLabel(b,"point",!0)}):""},reference:function(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.point_as_vertex.reference"))},entityIds:[p.id],dynamicFixes:d}):null}function c(p,m){if(!p.hasInterestingTags()||p.type!=="node"&&p.type!=="way"||p.type==="node"&&p.isOnAddressLine(m))return null;var g=p.geometry(m),y=p.extent(m).center(),x=p.type==="way"?["point","vertex"]:["line","area"];g==="area"&&x.unshift("line");var b=i.match(p,m),_=x.find(v=>{var w=i.matchTags(p.tags,v,y);if(!b||!w||b===w||(0,VP.default)(b.tags,w.tags)||w.isFallback())return!1;var A=Object.keys(w.tags)[0];return A==="building"||w.tags[A]==="*"?!1:b.isFallback()||b.tags[A]==="*"});if(!_)return null;var S=_+"_as_"+g;_==="vertex"&&(_="point"),g==="vertex"&&(g="point");var C=_+"_as_"+g,k;return _==="point"?k=d:g==="area"&&_==="line"&&(k=u),new et(n,{type:e,subtype:S,severity:"warning",message:function(){let w=t.staging.graph.hasEntity(this.entityIds[0]);return w?r.t("issues."+C+".message",{feature:r.displayLabel(w,_,!0)}):""},reference:function(w){w.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.mismatched_geometry.reference"))},entityIds:[p.id],dynamicFixes:k})}function u(){let p=null,m=this.entityIds[0],y=t.staging.graph.entity(m),x=Object.assign({},y.tags);return delete x.area,Xa(x)||(p=function(){let b=this.issue.entityIds[0],S=t.staging.graph.entity(b),C=Object.assign({},S.tags);C.area&&delete C.area,t.perform(Ft(b,C)),t.commit({annotation:r.t("issues.fix.convert_to_line.annotation"),selectedIDs:[b]})}),[new Re({icon:"rapid-icon-line",title:r.t("issues.fix.convert_to_line.title"),onClick:p})]}function d(){let p=null,m=this.entityIds[0];return n.hasHiddenConnections(m)||(p=function(){let g=this.issue.entityIds[0],y=x2(g,n.viewport);t.perform(y),t.commit({annotation:r.t("operations.extract.annotation",{n:1}),selectedIDs:[g]}),n.enter("select-osm",{selection:{osm:[y.getExtractedNodeID()]}})}),[new Re({icon:"rapid-operation-extract",title:r.t("issues.fix.extract_point.title"),onClick:p})]}function f(p,m){if(p.type!=="relation"||!p.isMultipolygon()||p.isDegenerate()||!p.isComplete(m))return[];var g=xi(p.members,m),y=[];for(var x in g){var b=g[x];if(b.nodes){var _=b.nodes[0],S=b.nodes[b.nodes.length-1];if(_!==S){var C=new et(n,{type:e,subtype:"unclosed_multipolygon_part",severity:"warning",message:function(){let v=t.staging.graph,w=v.hasEntity(this.entityIds[0]);return w?r.t("issues.unclosed_multipolygon_part.message",{feature:r.displayLabel(w,v,!0)}):""},reference:k,loc:b.nodes[0].loc,entityIds:[p.id],hash:b.map(function(v){return v.id}).join()});y.push(C)}}}return y;function k(v){v.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.unclosed_multipolygon_part.reference"))}}var h=function(m,g){var y=l(m,g);if(y)return[y];var x=a(m);if(x)return[x];var b=c(m,g);return b?[b]:f(m,g)};return h.type=e,h}function XP(n){let e="missing_role",t=n.systems.editor,r=n.systems.l10n,i=function(c,u){let d=[];if(c.type==="way")for(let f of u.parentRelations(c)){if(!f.isMultipolygon())continue;let h=f.memberById(c.id);h&&s(h)&&d.push(o(c,f,h))}else if(c.type==="relation"&&c.isMultipolygon())for(let f of c.indexedMembers()){let h=u.hasEntity(f.id);h&&s(f)&&d.push(o(h,c,f))}return d};function s(l){return!l.role||!l.role.trim().length}function o(l,c,u){return new et(n,{type:e,severity:"warning",message:function(){let f=t.staging.graph,h=f.hasEntity(this.entityIds[1]),p=f.hasEntity(this.entityIds[0]);return h&&p?r.t("issues.missing_role.message",{member:r.displayLabel(h,f),relation:r.displayLabel(p,f)}):""},reference:d,entityIds:[c.id,l.id],data:{member:u},hash:u.index.toString(),dynamicFixes:function(){return[a("inner"),a("outer"),new Re({icon:"rapid-operation-delete",title:r.t("issues.fix.remove_from_relation.title"),onClick:()=>{let f=this.issue.entityIds[0];t.perform(il(f,this.issue.data.member.index)),t.commit({annotation:r.t("operations.delete_member.annotation",{n:1}),selectedIDs:[f]})}})]}});function d(f){f.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.missing_role.multipolygon.reference"))}}function a(l){return new Re({title:r.t(`issues.fix.set_as_${l}.title`),onClick:()=>{let c=this.issue.data.member,u={id:this.issue.entityIds[1],type:c.type,role:l};t.perform(nl(this.issue.entityIds[0],u,c.index)),t.commit({annotation:r.t("operations.change_role.annotation",{n:1}),selectedIDs:[u.id]})}})}return i.type=e,i}function qP(n){let e="missing_tag",t=n.systems.editor,r=n.systems.l10n,i=n.systems.ui;function s(c,u){let d=["description","name","note","start_date"],f=Object.keys(c.tags).filter(h=>h==="area"||!Yn(h)?!1:!d.some(p=>h===p||h.indexOf(p+":")===0));return c.type==="relation"&&f.length===1&&c.tags.type==="multipolygon"?m2(c,u):f.length>0}function o(c){return c.type==="way"&&c.tags.highway==="road"}function a(c){return c.type==="relation"&&!c.tags.type}let l=function(u,d){let f=n.services.osm,h=u.type==="node"&&f&&!f.isDataLoaded(u.loc),p;if(!h&&u.geometry(d)!=="vertex"&&!u.hasParentRelations(d)&&(Object.keys(u.tags).length===0?p="any":s(u,d)?a(u)&&(p="relation_type"):p="descriptive"),!p&&o(u)&&(p="highway_classification"),!p)return[];let m=p==="highway_classification"?"unknown_road":`missing_tag.${p}`,g=p==="highway_classification"?"unknown_road":"missing_tag",x=(u.version===void 0||u.v!==void 0)&&p!=="highway_classification"?"error":"warning";return[new et(n,{type:e,subtype:p,severity:x,message:function(){let _=t.staging.graph,S=_.hasEntity(this.entityIds[0]);return S?r.t(`issues.${m}.message`,{feature:r.displayLabel(S,_)}):""},reference:b,entityIds:[u.id],dynamicFixes:function(){let _=[],S=p==="highway_classification"?"select_road_type":"select_preset";_.push(new Re({icon:"rapid-icon-search",title:r.t(`issues.fix.${S}.title`),onClick:function(){i.Sidebar.showPresetList()}}));let C=this.entityIds[0],v=Ji(n,[C]).disabled(),w;return v||(w=function(){let A=this.issue.entityIds[0],E=Ji(n,[A]);E.disabled()||E()}),_.push(new Re({icon:"rapid-operation-delete",title:r.t("issues.fix.delete_feature.title"),disabledReason:v?r.t(`operations.delete.${v}`,{n:1}):void 0,onClick:w})),_}})];function b(_){_.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t(`issues.${g}.reference`))}};return l.type=e,l}var Soe=new Set(["path","footway","cycleway","bridleway","pedestrian"]);function YP(n){let e="outdated_tags",t=n.systems.assets,r=n.systems.editor,i=n.systems.l10n,s=n.systems.presets,o=!0,a;t.loadAssetAsync("tagging_deprecated").then(f=>a=f).catch(()=>{}).finally(()=>o=!1);function l(f){for(let h of Soe)if(f.highway===h&&f[h]==="crossing")return!0;return!1}function c(f,h){if(!f.hasInterestingTags())return[];let p=s.match(f,h);if(!p)return[];if(/crossing/.test(p.id)){if(f.type==="way")return[];if(f.type==="node"){let T=n.services.osm;if(T&&!T.isDataLoaded(f.loc))return[];if(h.parentWays(f).some(D=>l(D.tags)))return[]}}let m=Object.assign({},f.tags),g="deprecated_tags";if(p.replacement){let T=s.item(p.replacement);h=ti(f.id,p,T,!0)(h),f=h.entity(f.id),p=T}if(a){let T=f.deprecatedTags(a);for(let R of T)h=Hm(f.id,R.old,R.replace)(h),f=h.entity(f.id)}let y=Object.assign({},f.tags);if(p.tags!==p.addTags)for(let[T,R]of Object.entries(p.addTags))y[T]||(R==="*"?y[T]="yes":y[T]=R);let x=n.services.nsi,b=!1,_;if(x&&(b=x.status==="loading",!b)){let T=f.extent(h).center();_=x.upgradeTags(y,T),_&&(y=_.newTags,g="noncanonical_brand")}let S=[];S.provisional=o||b;let C=ia(m,y);if(!C.length)return S;let k=C.every(T=>T.type==="+"),v="";_?v="noncanonical_brand.":g==="deprecated_tags"&&k&&(g="incomplete_tags",v="incomplete.");let w=null;return g!=="noncanonical_brand"&&(w=[A,i.t("issues.fix.upgrade_tags.annotation")]),S.push(new et(n,{type:e,subtype:g,severity:"warning",message:I,reference:M,entityIds:[f.id],hash:uh(JSON.stringify(C)),autoArgs:w,dynamicFixes:()=>{let T=[new Re({title:i.t("issues.fix.upgrade_tags.title"),onClick:()=>{r.perform(A),r.commit({annotation:i.t("issues.fix.upgrade_tags.annotation"),selectedIDs:[f.id]})}})],R=_?.matched;return R&&T.push(new Re({title:i.t("issues.fix.tag_as_not.title",{name:R.displayName}),onClick:()=>{r.perform(E),r.commit({annotation:i.t("issues.fix.tag_as_not.annotation"),selectedIDs:[f.id]})}})),T}})),S;function A(T){let R=T.hasEntity(f.id);if(!R)return T;let P=Object.assign({},R.tags);for(let D of C)D.type==="-"?delete P[D.key]:D.type==="+"&&(P[D.key]=D.newVal);return Ft(R.id,P)(T)}function E(T){let R=T.hasEntity(f.id);if(!R)return T;let P=_?.matched;if(!P)return T;let D=Object.assign({},R.tags),N=P.mainTag,F=`not:${N}`,B=P.tags[N];if(D[F]=B,D[N]===B){let O=P.mainTag.replace("wikidata","wikipedia");delete D[N],delete D[O]}return Ft(R.id,D)(T)}function I(){let T=r.staging.graph,R=T.hasEntity(f.id);if(!R)return"";let P=`issues.outdated_tags.${v}message`;return g==="noncanonical_brand"&&k&&(P+="_incomplete"),i.t(P,{feature:i.displayLabel(R,T,!0)})}function M(T){let R=T.selectAll(".issue-reference").data([0]).enter();R.append("div").attr("class","issue-reference").text(i.t(`issues.outdated_tags.${v}reference`)),R.append("strong").text(i.t("issues.suggested")),R.append("table").attr("class","tagDiff-table").selectAll(".tagDiff-row").data(C).enter().append("tr").attr("class","tagDiff-row").append("td").attr("class",P=>`tagDiff-cell tagDiff-cell-${P.type==="+"?"add":"remove"}`).text(P=>P.display)}}function u(f,h){let p,m;if(f.type==="relation")m=m2(f,h),p=f;else if(f.type==="way")p=g2(f,h),m=f;else return[];if(!p||!m)return[];return[new et(n,{type:e,subtype:"old_multipolygon",severity:"warning",message:y,reference:x,entityIds:[m.id,p.id],autoArgs:[g,i.t("issues.fix.move_tags.annotation")],dynamicFixes:()=>[new Re({title:i.t("issues.fix.move_tags.title"),onClick:()=>{r.perform(g),r.commit({annotation:i.t("issues.fix.move_tags.annotation"),selectedIDs:[f.id]})}})]})];function g(b){let _=b.hasEntity(p.id),S=b.hasEntity(m.id);return!_||!S?b:(_=_.mergeTags(S.tags),b=b.replace(_),Ft(S.id,{})(b))}function y(){let b=r.staging.graph,_=b.hasEntity(p.id);return _?i.t("issues.old_multipolygon.message",{multipolygon:i.displayLabel(_,b,!0)}):""}function x(b){b.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(i.t("issues.old_multipolygon.reference"))}}let d=function(h,p){let m=u(h,p);return m.length||(m=c(h,p)),m};return d.type=e,d}function KP(n){let e="private_data",t=n.systems.editor,r=n.systems.l10n,i=new Set(["detached","farm","house","houseboat","residential","semidetached_house","static_caravan"]),s=new Set(["amenity","craft","historic","leisure","office","shop","tourism"]),o=new Set(["contact:email","contact:fax","contact:phone","email","fax","phone"]),a=function(c){let u=c.tags;if(!u.building||!i.has(u.building))return[];let d={};for(let[y,x]of Object.entries(u)){if(s.has(y))return[];o.has(y)||(d[y]=x)}let f=ia(u,d);if(!f.length)return[];let h=f.length===1?"remove_tag":"remove_tags";return[new et(n,{type:e,severity:"warning",message:m,reference:g,entityIds:[c.id],dynamicFixes:()=>[new Re({icon:"rapid-operation-delete",title:r.t(`issues.fix.${h}.title`),onClick:()=>{t.perform(p),t.commit({annotation:r.t("issues.fix.upgrade_tags.annotation"),selectedIDs:[c.id]})}})]})];function p(y){let x=y.hasEntity(c.id);if(!x)return y;let b=Object.assign({},x.tags);for(let _ of f)_.type==="-"?delete b[_.key]:_.type==="+"&&(b[_.key]=_.newVal);return Ft(x.id,b)(y)}function m(){let y=t.staging.graph,x=y.hasEntity(this.entityIds[0]);return x?r.t("issues.private_data.contact.message",{feature:r.displayLabel(x,y)}):""}function g(y){let x=y.selectAll(".issue-reference").data([0]).enter();x.append("div").attr("class","issue-reference").text(r.t("issues.private_data.reference")),x.append("strong").text(r.t("issues.suggested")),x.append("table").attr("class","tagDiff-table").selectAll(".tagDiff-row").data(f).enter().append("tr").attr("class","tagDiff-row").append("td").attr("class",b=>`tagDiff-cell tagDiff-cell-${b.type==="+"?"add":"remove"}`).text(b=>b.display)}};return a.type=e,a}var dD={};X1(dD,{operationCircularize:()=>QP,operationContinue:()=>ZP,operationCopy:()=>eD,operationCycleHighwayTag:()=>JP,operationDelete:()=>Ji,operationDisconnect:()=>tD,operationDowngrade:()=>rD,operationExtract:()=>nD,operationMerge:()=>iD,operationMove:()=>M5,operationOrthogonalize:()=>sD,operationPaste:()=>R5,operationReflectLong:()=>aD,operationReflectShort:()=>oD,operationReverse:()=>lD,operationRotate:()=>F5,operationSplit:()=>cD,operationStraighten:()=>uD});function QP(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=n.systems.storage,o=n.viewport,a=e.map(p=>r.hasEntity(p)).filter(Boolean),l=a.every(p=>p.isNew()),c=Mt(a,r),u=a.map(f).filter(Boolean),d=Ht(e,r).map(p=>p.loc);function f(p){return p.type!=="way"||new Set(p.nodes).size<=1?null:ym(p.id,n.viewport)}let h=function(){if(!u.length)return;let p=(g,y)=>{for(let x of u)x.disabled(g)||(g=x(g,y));return g};p.transitionable=!0;let m=h.annotation();t.performAsync(p).then(()=>t.commit({annotation:m,selectedIDs:e}))};return h.available=function(){return u.length&&e.length===u.length},h.disabled=function(){if(!u.length)return"";let p=t.staging.graph,m=u.map(x=>x.disabled(p)).filter(Boolean);if(m.length===u.length)return new Set(m).size>1?"multiple_blockers":m[0];if(!l&&g())return"too_large";if(!l&&y())return"not_downloaded";if(e.some(n.hasHiddenConnections))return"connected_to_hidden";return!1;function g(){return!(s.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&c.percentContainedIn(o.visibleExtent())<.8}function y(){if(n.inIntro)return!1;let x=n.services.osm;if(x){let b=d.filter(_=>!x.isDataLoaded(_));if(b.length)return b.forEach(_=>n.loadTileAtLoc(_)),!0}return!1}},h.tooltip=function(){let p=h.disabled();return p?i.t(`operations.circularize.${p}`,{n:e.length}):i.t("operations.circularize.description",{n:e.length})},h.annotation=function(){return i.t("operations.circularize.annotation.feature",{n:u.length})},h.id="circularize",h.keys=[i.t("shortcuts.command.circularize.key")],h.title=i.t("operations.circularize.title"),h.behavior=new Pt(n,h),h}function ZP(n,e){let t=n.systems.editor.staging.graph,r=n.systems.filters,i=n.systems.l10n,s=e.map(d=>t.hasEntity(d)).filter(Boolean),o=Object.assign({line:[],vertex:[]},hr(s,d=>d.geometry(t))),a=o.vertex.length===1&&o.vertex[0],l=c();function c(){return a?t.parentWays(a).filter(d=>d.geometry(t)==="line"&&!d.isClosed()&&d.affix(a.id)&&(o.line.length===0||o.line[0]===d)):[]}let u=function(){l.length&&n.enter("draw-line",{continueWayID:l[0].id,continueNodeID:a.id})};return u.relatedEntityIds=function(){return l.length?[l[0].id]:[]},u.available=function(){let d=n.systems.editor.staging.graph;return o.vertex.length===1&&o.line.length<=1&&!r.hasHiddenConnections(a,d)},u.disabled=function(){return l.length===0?"not_eligible":l.length>1?"multiple":!1},u.tooltip=function(){let d=u.disabled();return d?i.t(`operations.continue.${d}`):i.t("operations.continue.description")},u.annotation=function(){return i.t("operations.continue.annotation.line")},u.id="continue",u.keys=[i.t("shortcuts.command.continue_line.key")],u.title=i.t("operations.continue.title"),u.behavior=new Pt(n,u),u}var PV=[],Coe=[/^highway\/(motorway|trunk|primary|secondary|tertiary|unclassified|residential|living_street|service|track)/,/^line$/],DV=["highway/residential","highway/service","highway/service/driveway","highway/track","highway/unclassified","highway/tertiary","line"],Aoe=[/^highway\/footway\/(crossing|sidewalk)/,/^highway\/footway$/],MV=["highway/footway/crossing2/dashes","highway/footway/crossing2/dots","highway/footway/crossing2/ladder","highway/footway/crossing2/ladder:skewed","highway/footway/crossing2/lines","highway/footway/crossing2/surface","highway/footway/crossing2/unmarked","highway/footway/crossing2/zebra","highway/footway/crossing2/other"],Eoe=[/^highway\/crossing/],RV=["highway/crossing2/dashes","highway/crossing2/dots","highway/crossing2/ladder","highway/crossing2/ladder:skewed","highway/crossing2/lines","highway/crossing2/surface","highway/crossing2/unmarked","highway/crossing2/zebra","highway/crossing2/other"];function JP(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=n.systems.presets,o=[],a=null,l=null;for(let d of e){let f=r.hasEntity(d);if(!f)continue;let h=f.geometry(r),p=s.match(f,r),m=h==="line"&&Coe.some(x=>x.test(p.id)),g=h==="line"&&Aoe.some(x=>x.test(p.id)),y=h==="vertex"&&Eoe.some(x=>x.test(p.id));if(m){if(o.push(f),!a)a=DV,l=i.t("operations.cycle_highway_tag.highway_annotation");else if(a!==DV){o=[],a=null,l="";break}}if(g){if(o.push(f),!a)a=MV,l=i.t("operations.cycle_highway_tag.crosswalk_annotation");else if(a!==MV){o=[],a=null,l="";break}}if(y){if(o.push(f),!a)a=RV,l=i.t("operations.cycle_highway_tag.crosswalk_annotation");else if(a!==RV){o=[],a=null,l="";break}}}let c=Kr(e,PV);c||(PV=e.slice());let u=function(){if(!o.length||!a)return;let d=t.staging.graph,f=s.match(o[0],d),h=f?a.indexOf(f.id):-1,p=a[(h+1)%a.length],m=s.item(p);t.beginTransaction();for(let y of o){d=t.staging.graph;let x=s.match(y,d),b=ti(y.id,x,m,!0);t.perform(b)}let g={annotation:l,selectedIDs:e};c&&t.getUndoAnnotation()===l?t.commitAppend(g):t.commit(g),t.endTransaction(),n.enter("select-osm",{selection:{osm:e}})};return u.available=function(){return o.length>0&&a},u.disabled=function(){return!1},u.tooltip=function(){return i.t("operations.cycle_highway_tag.description")},u.annotation=function(){return l},u.id="cycle_highway_tag",u.keys=["\u21E7"+i.t("shortcuts.command.cycle_highway_tag.key")],u.title=i.t("operations.cycle_highway_tag.title"),u.behavior=new Pt(n,u),u}function eD(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=n.systems.storage,o=n.viewport,a=e.map(h=>r.hasEntity(h)).filter(h=>h&&(h.hasInterestingTags()||h.geometry(r)!=="vertex")),l=a.every(h=>h.isNew()),c=Mt(a,r),u,d=function(){let h=t.staging.graph,p=Object.assign({relation:[],way:[],node:[]},hr(a,"type")),m=[],g={},y,x;for(x=0;x<p.relation.length;x++)y=p.relation[x],!g[y.id]&&y.isComplete(h)&&(m.push(y.id),g=f(y.id,h,g));for(x=0;x<p.way.length;x++)y=p.way[x],g[y.id]||(m.push(y.id),g=f(y.id,h,g));for(x=0;x<p.node.length;x++)y=p.node[x],g[y.id]||m.push(y.id);n.copyIDs=m,u&&(m.length!==1||h.entity(m[0]).type!=="node")?n.copyLoc=n.viewport.unproject(u):n.copyLoc=null};function f(h,p,m){let g=p.entity(h),y;m=m||{},g.type==="relation"?y=g.members.map(x=>x.id):g.type==="way"?y=g.nodes:y=[];for(let x=0;x<y.length;x++)m[y[x]]||(m[y[x]]=!0,m=f(y[x],p,m));return m}return d.available=function(){return a.length>0},d.disabled=function(){if(!l&&h())return"too_large";return!1;function h(){return!(s.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&c.percentContainedIn(o.visibleExtent())<.8}},d.availableForKeypress=function(){let h=window.getSelection&&window.getSelection();return!h||!h.toString()},d.tooltip=function(){let h=d.disabled();return h?i.t(`operations.copy.${h}`,{n:e.length}):i.t("operations.copy.description",{n:e.length})},d.annotation=function(){return i.t("operations.copy.annotation",{n:e.length})},d.point=function(h){return u=h,d},d.id="copy",d.keys=[Te("\u2318C")],d.title=i.t("operations.copy.title"),d.behavior=new Pt(n,d),d}function tD(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=n.systems.storage,o=n.viewport,a=e.map(_=>r.hasEntity(_)).filter(Boolean),l=a.every(_=>_.isNew()),c=[],u=[],d=[],f=[];for(let _ of a)_.type==="way"?u.push(_.id):_.geometry(r)==="vertex"?c.push(_.id):d.push(_.id);let h,p="",m="features",g=[],y=[];if(c.length>0)g=c,c.forEach(_=>{let S=Eh(_);if(u.length>0){let C=u.filter(k=>r.entity(k).nodes.indexOf(_)!==-1);S.limitWays(C)}f.push(S),y=y.concat(r.parentWays(r.entity(_)).map(C=>C.id))}),y=Ge(y).filter(_=>u.indexOf(_)===-1),p+=f.length===1?"single_point.":"multiple_points.",u.length===1?p+="single_way."+r.geometry(u[0]):p+=u.length===0?"no_ways":"multiple_ways";else if(u.length>0){let _=u.map(A=>r.entity(A)),S=Ht(u,r);h=S.map(A=>A.loc);let C=[],k=[],v=[],w=[];S.forEach(A=>{let E=Eh(A.id).limitWays(u);if(E.disabled(r)!=="not_connected"){let I=0;for(let M in _)if(_[M].nodes.indexOf(A.id)!==-1&&(I+=1),I>1)break;I>1?(C.push(E),k.push(A)):(v.push(E),w.push(A))}}),p+="no_points.",p+=u.length===1?"single_way.":"multiple_ways.",C.length?(f=C,g=k.map(A=>A.id),p+="conjoined",m="from_each_other"):(f=v,g=w.map(A=>A.id),u.length===1?p+=r.geometry(u[0]):p+="separate")}let x=Mt(g,r),b=function(){let _=S=>{for(let C of f)C.disabled(S)||(S=C(S));return S};t.perform(_),t.commit({annotation:b.annotation(),selectedIDs:e})};return b.relatedEntityIds=function(){return c.length?y:g},b.available=function(){if(f.length===0||d.length!==0)return!1;let _=t.staging.graph;return!(c.length!==0&&u.length!==0&&!u.every(function(S){return c.some(C=>_.entity(S).nodes.indexOf(C)!==-1)}))},b.disabled=function(){let _=t.staging.graph,S;for(let v of f)if(S=v.disabled(_),S)return S;if(!l&&C())return"too_large."+((c.length?c:u).length===1?"single":"multiple");if(!l&&h&&k())return"not_downloaded";if(e.some(n.hasHiddenConnections))return"connected_to_hidden";return!1;function C(){return!(s.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&x.percentContainedIn(o.visibleExtent())<.8}function k(){if(n.inIntro)return!1;let v=n.services.osm;if(v){let w=h.filter(A=>!v.isDataLoaded(A));if(w.length)return w.forEach(A=>n.loadTileAtLoc(A)),!0}return!1}},b.tooltip=function(){let _=b.disabled();return _?i.t(`operations.disconnect.${_}`):i.t(`operations.disconnect.description.${p}`)},b.annotation=function(){return i.t(`operations.disconnect.annotation.${m}`)},b.id="disconnect",b.keys=[i.t("shortcuts.command.disconnect.key")],b.title=i.t("operations.disconnect.title"),b.behavior=new Pt(n,b),b}function rD(n,e){let t=n.systems.editor,r=n.systems.l10n,i=n.systems.presets,s=0,o=a(e);function a(f){let h;s=0;for(let p of f){let m=l(p);m&&(s+=1,h&&m!==h?h!=="generic"&&m!=="generic"?h="building_address":h="generic":h=m)}return h}function l(f){let h=t.staging.graph,p=h.entity(f),m=i.match(p,h);if(!m||m.isFallback())return null;if(p.type==="node"&&m.id!=="address"&&Object.keys(p.tags).some(function(y){return y.match(/^addr:.{1,}/)}))return"address";let g=p.geometry(h);return g==="area"&&p.tags.building&&!m.tags.building?"building":g==="vertex"&&Object.keys(p.tags).length?"generic":null}let c=/architect|building|height|layer|nycdoitt:bin|source|type|wheelchair|roof/i,u=["source"],d=function(){let f=p=>{for(let m of e){let g=l(m);if(!g)continue;let y=Object.assign({},p.entity(m).tags);for(let x in y)g==="address"&&u.indexOf(x)!==-1||g==="building"&&c.test(x)||g!=="generic"&&(x.match(/^addr:.{1,}/)||x.match(/^source:.{1,}/))||delete y[x];p=Ft(m,y)(p)}return p},h=d.annotation();t.perform(f),t.commit({annotation:h,selectedIDs:e}),n.enter("select-osm",{selection:{osm:e}})};return d.available=function(){return o},d.disabled=function(){let f=t.staging.graph;if(e.some(h))return"has_wikidata_tag";return!1;function h(p){let m=f.entity(p);return m.tags.wikidata&&m.tags.wikidata.trim().length>0}},d.tooltip=function(){let f=d.disabled();return f?r.t(`operations.downgrade.${f}`,{n:s}):r.t(`operations.downgrade.description.${o}`)},d.annotation=function(){let f;return o==="building_address"?f="generic":f=o,r.t(`operations.downgrade.annotation.${f}`,{n:s})},d.id="downgrade",d.keys=[Te("\u232B")],d.title=r.t("operations.downgrade.title"),d.behavior=new Pt(n,d),d}function nD(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=n.systems.presets,o=n.systems.storage,a=n.viewport,l=e.map(m=>r.hasEntity(m)).filter(Boolean),c=l.every(m=>m.isNew()),u=Mt(l,r),d=Ge(l.map(m=>m.geometry(r))),f=d.length===1?d[0]:"feature",h=l.map(m=>!m.hasInterestingTags()||m.type==="node"&&r.parentWays(m).length===0||m.type!=="node"&&!s.match(m,r).geometry.includes("point")?null:x2(m.id,n.viewport)).filter(Boolean),p=function(){if(!h.length)return;let m=[],g=x=>{for(let b of h)x=b(x),m.push(b.getExtractedNodeID());return x},y=p.annotation();t.beginTransaction(),t.perform(g),t.commit({annotation:y,selectedIDs:e}),t.endTransaction(),n.enter("select-osm",{selection:{osm:m}})};return p.available=function(){return h.length&&e.length===h.length},p.disabled=function(){let m=t.staging.graph;if(!c&&g())return"too_large";if(e.some(y=>m.geometry(y)==="vertex"&&n.hasHiddenConnections(y)))return"connected_to_hidden";return!1;function g(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&u.percentContainedIn(a.visibleExtent())<.8}},p.tooltip=function(){let m=p.disabled();return m?i.t(`operations.extract.${m}`,{n:e.length}):i.t(`operations.extract.description.${f}`,{n:e.length})},p.annotation=function(){return i.t("operations.extract.annotation",{n:e.length})},p.id="extract",p.keys=[i.t("shortcuts.command.extract.key")],p.title=i.t("operations.extract.title"),p.behavior=new Pt(n,p),p}function iD(n,e){let t=n.systems.editor,r=n.systems.l10n,i=n.systems.presets,s=n.systems.storage,o=a();function a(){let c=t.staging.graph,d={tagnosticRoadCombine:s.getItem("rapid-internal-feature.tagnosticRoadCombine")==="true"},f=xm(e,d);if(!f.disabled(c))return f;let h=bm(e);if(!h.disabled(c))return h;let p=Fm(e);if(!p.disabled(c))return p;let m=bi(e);return m.disabled(c)?f.disabled(c)!=="not_eligible"?f:h.disabled(c)!=="not_eligible"?h:p.disabled(c)!=="not_eligible"?p:m:m}let l=function(){if(l.disabled())return;let c=l.annotation();t.perform(o),t.commit({annotation:c,selectedIDs:e});let u=t.staging.graph,d=e.filter(f=>u.hasEntity(f));if(d.length>1){let f=d.filter(h=>u.entity(h).hasInterestingTags());f.length&&(d=f)}n.enter("select-osm",{selection:{osm:d}})};return l.available=function(){return e.length>=2},l.disabled=function(){let c=t.staging.graph,u=o.disabled(c);if(u)return u;let d=n.services.osm;return d&&o.resultingWayNodesLength&&o.resultingWayNodesLength(c)>d.maxWayNodes?"too_many_vertices":!1},l.tooltip=function(){let c=l.disabled();if(c){if(c==="conflicting_relations")return r.t("operations.merge.conflicting_relations");if(c==="restriction"||c==="connectivity"){let u=i.item("type/"+c);return r.t("operations.merge.damage_relation",{relation:u.name()})}else return r.t(`operations.merge.${c}`)}else return r.t("operations.merge.description")},l.annotation=function(){return r.t("operations.merge.annotation",{n:e.length})},l.id="merge",l.keys=[r.t("shortcuts.command.merge.key")],l.title=r.t("operations.merge.title"),l.behavior=new Pt(n,l),l}function M5(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=n.systems.storage,o=n.viewport,a=e.map(h=>r.hasEntity(h)).filter(Boolean),l=a.every(h=>h.isNew()),u=Ht(e,r).map(h=>h.loc),d=Mt(a,r),f=function(){n.enter("move",{selection:{osm:e}})};return f.available=function(){return a.length>0},f.disabled=function(){let h=t.staging.graph;if(!l&&p())return"too_large";if(!l&&m())return"not_downloaded";if(e.some(n.hasHiddenConnections))return"connected_to_hidden";if(a.some(g))return"incomplete_relation";return!1;function p(){return!(s.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&d.percentContainedIn(o.visibleExtent())<.8}function m(){if(n.inIntro)return!1;let y=n.services.osm;if(y){let x=u.filter(b=>!y.isDataLoaded(b));if(x.length)return x.forEach(b=>n.loadTileAtLoc(b)),!0}return!1}function g(y){return y.type==="relation"&&!y.isComplete(h)}},f.tooltip=function(){let h=f.disabled();return h?i.t(`operations.move.${h}`,{n:e.length}):i.t("operations.move.description",{n:e.length})},f.annotation=function(){let h=t.staging.graph;return e.length===1?i.t("operations.move.annotation."+h.geometry(e[0])):i.t("operations.move.annotation.feature",{n:e.length})},f.id="move",f.keys=[i.t("shortcuts.command.move.key")],f.title=i.t("operations.move.title"),f.behavior=new Pt(n,f),f.mouseOnly=!0,f}function sD(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=n.systems.storage,o=n.viewport,a=e.map(m=>r.hasEntity(m)).filter(Boolean),l=a.every(m=>m.isNew()),c=Mt(a,r),u,d=a.map(h).filter(Boolean),f=Ht(e,r).map(m=>m.loc);function h(m){let g=t.staging.graph,y=m.geometry(g);if(m.type==="way"&&new Set(m.nodes).size>2)return u&&u!=="feature"?null:(u="feature",al(m.id,n.viewport));if(y==="vertex"){if(u&&u!=="corner")return null;u="corner";let x=g.parentWays(m);if(x.length===1){let b=x[0];if(b.nodes.indexOf(m.id)!==-1)return al(b.id,n.viewport,m.id)}}return null}let p=function(){if(!d.length)return;let m=(y,x)=>{for(let b of d)b.disabled(y)||(y=b(y,x));return y};m.transitionable=!0;let g=p.annotation();t.performAsync(m).then(()=>t.commit({annotation:g,selectedIDs:e}))};return p.available=function(){return d.length&&e.length===d.length},p.disabled=function(){if(!d.length)return"";let m=t.staging.graph,g=d.map(b=>b.disabled(m)).filter(Boolean);if(g.length===d.length)return new Set(g).size>1?"multiple_blockers":g[0];if(!l&&y())return"too_large";if(!l&&x())return"not_downloaded";if(e.some(n.hasHiddenConnections))return"connected_to_hidden";return!1;function y(){return!(s.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&c.percentContainedIn(o.visibleExtent())<.8}function x(){if(n.inIntro)return!1;let b=n.services.osm;if(b){let _=f.filter(S=>!b.isDataLoaded(S));if(_.length)return _.forEach(S=>n.loadTileAtLoc(S)),!0}return!1}},p.tooltip=function(){let m=p.disabled();return m?i.t(`operations.orthogonalize.${m}`,{n:e.length}):i.t(`operations.orthogonalize.description.${u}`,{n:e.length})},p.annotation=function(){return i.t("operations.orthogonalize.annotation."+u,{n:d.length})},p.id="orthogonalize",p.keys=[i.t("shortcuts.command.orthogonalize.key")],p.title=i.t("operations.orthogonalize.title"),p.behavior=new Pt(n,p),p}function R5(n){let e=n.systems.editor,t=n.systems.l10n,r=n.systems.map,i=function(){let s=n.copyGraph,o=n.copyIDs;if(!o.length||!n.scene().layers.get("osm")?.enabled)return;let l=y2(o,s);e.beginTransaction(),e.perform(l);let c=e.staging.graph,u=l.copies(),d=new Set;for(let b of Object.values(u))d.add(b.id);let f=new le,h=[];for(let[b,_]of Object.entries(u)){let S=s.entity(b);f=f.extend(S.extent(s)),c.parentWays(_).some(v=>d.has(v.id))||h.push(_.id)}let p=n.viewport,m=n.copyLoc,g=m&&p.project(m)||p.project(f.center()),y=Me(r.mouse(),g),x=t.t("operations.paste.annotation",{n:h.length});e.perform(Ao(h,y,p)),e.commit({annotation:x,selectedIDs:h}),e.endTransaction(),n.enter("move",{selection:{osm:h}})};return i.available=function(){return n.mode?.id==="browse"},i.disabled=function(){return!n.copyIDs.length},i.tooltip=function(){let s=n.copyGraph,o=n.copyIDs;return o.length?t.t("operations.paste.description",{feature:t.displayLabel(s.entity(o[0]),s),n:o.length}):t.t("operations.paste.nothing_copied")},i.annotation=function(){let s=n.copyIDs;return t.t("operations.paste.annotation",{n:s.length})},i.id="paste",i.keys=[Te("\u2318V")],i.title=t.t("operations.paste.title"),i}function oD(n,e){return FV(n,e,"short")}function aD(n,e){return FV(n,e,"long")}function FV(n,e,t="long"){let r=n.systems.editor,i=r.staging.graph,s=n.systems.l10n,o=n.systems.storage,a=n.viewport,l=e.map(p=>i.hasEntity(p)).filter(Boolean),c=l.every(p=>p.isNew()),u=Mt(l,i),d=Ht(e,i),f=d.map(p=>p.loc),h=function(){let p=h.annotation(),m=zm(e,n.viewport).useLongAxis(t==="long");r.performAsync(m).then(()=>r.commit({annotation:p,selectedIDs:e}))};return h.available=function(){return d.length>=3},h.disabled=function(){let p=r.staging.graph;if(!c&&m())return"too_large";if(!c&&g())return"not_downloaded";if(e.some(n.hasHiddenConnections))return"connected_to_hidden";if(l.some(y))return"incomplete_relation";return!1;function m(){return!(o.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&u.percentContainedIn(a.visibleExtent())<.8}function g(){if(n.inIntro)return!1;let x=n.services.osm;if(x){let b=f.filter(_=>!x.isDataLoaded(_));if(b.length)return b.forEach(_=>n.loadTileAtLoc(_)),!0}return!1}function y(x){return x.type==="relation"&&!x.isComplete(p)}},h.tooltip=function(){let p=h.disabled();return p?s.t(`operations.reflect.${p}`,{n:e.length}):s.t(`operations.reflect.description.${t}`,{n:e.length})},h.annotation=function(){return s.t(`operations.reflect.annotation.${t}.feature`,{n:e.length})},h.id=`reflect-${t}`,h.keys=[s.t(`shortcuts.command.reflect_${t}.key`)],h.title=s.t(`operations.reflect.title.${t}`),h.behavior=new Pt(n,h),h}function lD(n,e){let t=n.systems.editor,r=n.systems.l10n,i=e.map(o).filter(Boolean),s=a();function o(c){let u=t.staging.graph,d=u.hasEntity(c);if(!d)return null;let f=d.geometry(u);if(d.type!=="node"&&f!=="line")return null;let h=ns(c);return h.disabled(u)?null:h}function a(){let c=t.staging.graph,u=i.filter(d=>c.hasEntity(d.entityID())?.type==="node").length;return u===0?"line":u===i.length?"point":"feature"}let l=function(){if(!i.length)return;let c=function(d){for(let f of i)d=f(d);return d},u=l.annotation();t.perform(c),t.commit({annotation:u,selectedIDs:e})};return l.available=function(){return i.length>0},l.disabled=function(){return!1},l.tooltip=function(){return r.t(`operations.reverse.description.${s}`)},l.annotation=function(){return r.t(`operations.reverse.annotation.${s}`,{n:i.length})},l.id="reverse",l.keys=[r.t("shortcuts.command.reverse.key")],l.title=r.t("operations.reverse.title"),l.behavior=new Pt(n,l),l}function F5(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=n.systems.storage,o=n.viewport,a=e.map(h=>r.hasEntity(h)).filter(Boolean),l=a.every(h=>h.isNew()),c=Mt(a,r),u=Ht(e,r),d=u.map(h=>h.loc),f=function(){n.enter("rotate",{selection:{osm:e}})};return f.available=function(){return u.length>=2},f.disabled=function(){let h=t.staging.graph;if(!l&&p())return"too_large";if(!l&&m())return"not_downloaded";if(e.some(n.hasHiddenConnections))return"connected_to_hidden";if(a.some(g))return"incomplete_relation";return!1;function p(){return!(s.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&c.percentContainedIn(o.visibleExtent())<.8}function m(){if(n.inIntro)return!1;let y=n.services.osm;if(y){let x=d.filter(b=>!y.isDataLoaded(b));if(x.length)return x.forEach(b=>n.loadTileAtLoc(b)),!0}return!1}function g(y){return y.type==="relation"&&!y.isComplete(h)}},f.tooltip=function(){let h=f.disabled();return h?i.t(`operations.rotate.${h}`,{n:e.length}):i.t("operations.rotate.description",{n:e.length})},f.annotation=function(){let h=t.staging.graph;return e.length===1?i.t("operations.rotate.annotation."+h.geometry(e[0])):i.t("operations.rotate.annotation.feature",{n:e.length})},f.id="rotate",f.keys=[i.t("shortcuts.command.rotate.key")],f.title=i.t("operations.rotate.title"),f.behavior=new Pt(n,f),f.mouseOnly=!0,f}function cD(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=e.map(y=>r.hasEntity(y)).filter(Boolean),o=s.filter(y=>y.type==="node"&&y.geometry(r)==="vertex"),a=o.map(y=>y.id),l=a.length===1?"single":"multiple",c=s.filter(y=>y.type==="way"),u=c.map(y=>y.id),d=o.length>0&&o.length+c.length===e.length,f=$s(a),h="feature",p=[],m="single";if(d){u.length&&f.limitWays(u),p=f.ways(r);let y=new Set;for(let x of p)y.add(x.geometry(r));y.size===1&&(h=Array.from(y)[0]),m=p.length===1?"single":"multiple"}let g=function(){let y=g.annotation(),x=t.perform(f);t.commit({annotation:y,selectedIDs:e});let b=a.slice();for(let[_,S]of x.changes){let C=S.head;C&&C.type==="way"&&b.push(_)}n.enter("select-osm",{selection:{osm:b}})};return g.relatedEntityIds=function(){return p.map(y=>y.id)},g.available=function(){return d},g.disabled=function(){let y=t.staging.graph,x=f.disabled(y);return x||(e.some(n.hasHiddenConnections)?"connected_to_hidden":!1)},g.tooltip=function(){let y=g.disabled();return y?i.t(`operations.split.${y}`):i.t(`operations.split.description.${h}.${m}.${l}_node`)},g.annotation=function(){return i.t(`operations.split.annotation.${h}`,{n:p.length})},g.id="split",g.keys=[i.t("shortcuts.command.split.key")],g.title=i.t("operations.split.title"),g.behavior=new Pt(n,g),g}function uD(n,e){let t=n.systems.editor,r=t.staging.graph,i=n.systems.l10n,s=n.systems.storage,o=n.viewport,a=e.map(b=>r.hasEntity(b)).filter(Boolean),l=a.every(b=>b.isNew()),c=a.filter(b=>b.type==="way"),u=c.map(b=>b.id),d=a.filter(b=>b.type==="node"),f=d.map(b=>b.id),h=Ht(e,r).map(b=>b.loc),p=Mt(e,r),m,g=y();function y(){let b=t.staging.graph;if(c.length===0&&d.length>2)return m="point",Gm(f,n.viewport);if(c.length>0&&(d.length===0||d.length===2)){let _=[],S=[];for(let k of a)if(k.type==="way"){if(k.type==="way"&&k.isClosed())return null;_.push(k.first()),S.push(k.last())}if(_=_.filter(k=>_.indexOf(k)===_.lastIndexOf(k)),S=S.filter(k=>S.indexOf(k)===S.lastIndexOf(k)),an(_,S).length+an(S,_).length!==2)return null;let C=Ht(u,b).map(k=>k.id);return C.length<=2||f.length===2&&(C.indexOf(f[0])===-1||C.indexOf(f[1])===-1)?null:(f.length&&(p=Mt(f,b)),m="line",$m(e,n.viewport))}return null}let x=function(){if(!g)return;let b=x.annotation();t.performAsync(g).then(()=>t.commit({annotation:b,selectedIDs:e}))};return x.available=function(){return!!g},x.disabled=function(){let b=t.staging.graph,_=g.disabled(b);if(_)return _;if(!l&&S())return"too_large";if(!l&&C())return"not_downloaded";if(e.some(n.hasHiddenConnections))return"connected_to_hidden";return!1;function S(){return!(s.getItem("rapid-internal-feature.allowLargeEdits")==="true")&&p.percentContainedIn(o.visibleExtent())<.8}function C(){if(n.inIntro)return!1;let k=n.services.osm;if(k){let v=h.filter(w=>!k.isDataLoaded(w));if(v.length)return v.forEach(w=>n.loadTileAtLoc(w)),!0}return!1}},x.tooltip=function(){let b=x.disabled();return b?i.t(`operations.straighten.${b}`,{n:c.length||d.length}):i.t(`operations.straighten.description.${m}`+(c.length===1?"":"s"))},x.annotation=function(){return i.t(`operations.straighten.annotation.${m}`,{n:c.length||d.length})},x.id="straighten",x.keys=[i.t("shortcuts.command.straighten.key")],x.title=i.t("operations.straighten.title"),x.behavior=new Pt(n,x),x}function fD(n){let e="y_shaped_connection",t=n.systems.l10n,r=12,i=5,s=new Set(["residential","service","track","unclassified","tertiary","secondary","primary","living_street","cycleway","trunk","motorway","road","raceway"]);function o(u,d){return d.parentWays(u).filter(h=>s.has(h.tags.highway))}function a(u,d){let f=!Ji(d,[u.id]).disabled(),h;return f?h=new Re({icon:"rapid-operation-delete",title:t.t("issues.fix.delete_node_around_conn.title"),entityIds:[u.id],onClick:function(){let p=this.entityIds[0],m=Ji(d,[p]);m.disabled()||m()}}):h=new Re({icon:"rapid-operation-move",title:t.t("issues.fix.move_node_around_conn.title"),entityIds:[u.id]}),new et(d,{type:e,severity:"warning",message:()=>t.t("issues.y_shaped_connection.message"),reference:p=>{p.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(t.t("issues.y_shaped_connection.reference"))},entityIds:[u.id],fixes:[h]})}function l(u,d,f,h){if(f<=0||f>=d.nodes.length-1)return!1;let p=d.nodes[f],m=u.entity(p);if(o(m,u).length<2)return!1;let y=d.nodes[h],x=u.entity(y);if(ht(m.loc,x.loc)>r)return!1;let _=f<h?f-1:f+1,S=d.nodes[_],C=u.entity(S),k=n.viewport.project(C.loc),v=n.viewport.project(m.loc),w=n.viewport.project(x.loc),A=0,E=0,I=0;return _<h?(A=sr(k,v),E=sr(v,w),I=Math.abs(E-A)/Math.PI*180):(A=sr(w,v),E=sr(v,k),I=Math.abs(E-A)/Math.PI*180),I>i}let c=function(u,d){if(u.type!=="node")return[];let f=o(u,d);if(f.length!==1||!f[0].id.startsWith("w-"))return[];let h=[],p=f[0],m=p.nodes.indexOf(u.id);return m<=0||(l(d,p,m-1,m)||l(d,p,m+1,m))&&h.push(a(u,n)),h};return c.type=e,c}function hD(n){let e="suspicious_name",t=n.systems.editor,r=n.systems.l10n,i=n.systems.presets,s=["aerialway","aeroway","amenity","building","craft","highway","leisure","railway","man_made","office","shop","tourism","waterway"],o=!1;function a(h){let p=n.services.nsi;return p&&(o=p.status==="loading",!o)?p.isGenericName(h):!1}function l(h,p){for(let m of s){let g=p[m];if(g&&(g=g.toLowerCase(),m===h||g===h||m.replace(/\_/g," ")===h||g.replace(/\_/g," ")===h))return!0}return!1}function c(h,p){return h=h.toLowerCase(),l(h,p)||a(p)}function u(h,p,m,g){return new et(n,{type:e,subtype:"generic_name",severity:"warning",message:function(){let x=t.staging.graph,b=x.hasEntity(this.entityIds[0]);if(!b)return"";let _=i.match(b,x),S=g&&r.languageName(g);return r.t("issues.generic_name.message"+(S?"_language":""),{feature:_.name(),name:m,language:S})},reference:y,entityIds:[h],hash:`${p}=${m}`,dynamicFixes:function(){return[new Re({icon:"rapid-operation-delete",title:r.t("issues.fix.remove_the_name.title"),onClick:function(){let x=t.staging.graph,b=this.issue.entityIds[0],_=x.entity(b),S=Object.assign({},_.tags);delete S[p],t.perform(Ft(b,S)),t.commit({annotation:r.t("issues.fix.remove_generic_name.annotation"),selectedIDs:[b]})}})]}});function y(x){x.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.generic_name.reference"))}}function d(h,p,m,g){return new et(n,{type:e,subtype:"not_name",severity:"warning",message:function(){let x=t.staging.graph,b=x.hasEntity(this.entityIds[0]);if(!b)return"";let _=i.match(b,x),S=g&&r.languageName(g);return r.t("issues.incorrect_name.message"+(S?"_language":""),{feature:_.name(),name:m,language:S})},reference:y,entityIds:[h],hash:`${p}=${m}`,dynamicFixes:function(){return[new Re({icon:"rapid-operation-delete",title:r.t("issues.fix.remove_the_name.title"),onClick:function(){let x=t.staging.graph,b=this.issue.entityIds[0],_=x.entity(b),S=Object.assign({},_.tags);delete S[p],t.perform(Ft(b,S)),t.commit({annotation:r.t("issues.fix.remove_mistaken_name.annotation"),selectedIDs:[b]})}})]}});function y(x){x.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.generic_name.reference"))}}let f=function(p){let m=p.tags;if(!!m.wikidata||!!m["brand:wikidata"]||!!m["operator:wikidata"])return[];let y=[],x=new Set((m["not:name"]??"").split(";").map(b=>b.trim()).filter(Boolean));for(let[b,_]of Object.entries(m)){if(!_)continue;let S=b.match(/^name(?:(?::)([a-zA-Z_-]+))?$/);if(!S)continue;let C=S.length>=2?S[1]:null;x.has(_)&&y.push(d(p.id,b,_,C)),c(_,m)&&(y.provisional=o,y.push(u(p.id,b,_,C)))}return y};return f.type=e,f}function pD(n){let e="unsquare_way",t=n.systems.editor,r=n.systems.l10n,i=5,s=.05,o=10;function a(c,u){return c.type!=="way"||c.geometry(u)!=="area"?!1:c.tags.building&&c.tags.building!=="no"}let l=function(u,d){if(!a(u,d))return[];if(u.tags.nonsquare==="yes")return[];let f=u.isClosed();if(!f)return[];let h=d.childNodes(u).slice();if(h.length>o+1)return[];let p=n.services.osm;if(!p||h.some(C=>!p.isDataLoaded(C.loc)))return[];if(h.some(C=>d.parentWays(C).some(k=>k.id===u.id?!1:a(k,d)?!0:d.parentRelations(k).some(v=>v.isMultipolygon()&&v.tags.building&&v.tags.building!=="no"))))return[];let y=n.systems.storage.getItem("validate-square-degrees"),x=isNaN(y)?i:parseFloat(y),b=h.map(C=>n.viewport.project(C.loc));if(!R2(b,f,s,x,!0))return[];let _;if(!u.tags.wikidata){let C=al(u.id,n.viewport,void 0,x),k=r.t("operations.orthogonalize.annotation.feature",{n:1});_=[C,k]}return[new et(n,{type:e,subtype:"building",severity:"warning",message:function(){let C=t.staging.graph,k=C.hasEntity(this.entityIds[0]);return k?r.t("issues.unsquare_way.message",{feature:r.displayLabel(k,C)}):""},reference:S,entityIds:[u.id],hash:x,autoArgs:_,dynamicFixes:function(){return[new Re({icon:"rapid-operation-orthogonalize",title:r.t("issues.fix.square_feature.title"),onClick:function(){let C=this.issue.entityIds[0],k=al(C,n.viewport,void 0,x),v=r.t("operations.orthogonalize.annotation.feature",{n:1});t.performAsync(k).then(()=>t.commit({annotation:v,selectedIDs:[C]}))}})]}})];function S(C){C.selectAll(".issue-reference").data([0]).enter().append("div").attr("class","issue-reference").text(r.t("issues.unsquare_way.buildings.reference"))}};return l.type=e,l}var Toe=5e3,B5=class extends Se{constructor(e){super(e),this.id="validator",this.dependencies=new Set(["editor","storage","map","urlhash"]),this._rules=new Map,this._base=new z1("base"),this._head=new z1("head"),this._disabledRuleIDs=new Set,this._ignoredIssueIDs=new Set,this._resolvedIssueIDs=new Set,this._completeDiff=new Map,this._deferredRIC=new Map,this._deferredST=new Set,this._errorOverrides=[],this._warningOverrides=[],this._disableOverrides=[],this._initPromise=null,this._validationPromise=null,this.validateAsync=this.validateAsync.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;for(let o of this.dependencies)if(!this.context.systems[o])return Promise.reject(`Cannot init:  ${this.id} requires ${o}`);let e=this.context;Object.values(mD).forEach(o=>{if(typeof o!="function")return;let a=o(e);this._rules.set(a.type,a)});let t=e.systems.editor,r=e.systems.storage,i=e.systems.urlhash,s=Promise.all([t.initAsync(),r.initAsync(),i.initAsync()]);return this._initPromise=s.then(()=>{this._errorOverrides=this._parseHashParam(i.initialHashParams.get("validationError")),this._warningOverrides=this._parseHashParam(i.initialHashParams.get("validationWarning")),this._disableOverrides=this._parseHashParam(i.initialHashParams.get("validationDisable"));let o=r.getItem("validate-disabledRules");if(o){let a=o.split(",").map(l=>l.trim()).filter(Boolean);this._disabledRuleIDs=new Set(a)}t.on("stablechange",()=>this.validateAsync()).on("merge",a=>this._validateBaseEntitiesAsync(a))})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){this._base.queue=[],this._head.queue=[];for(let[e,t]of this._deferredRIC)window.cancelIdleCallback(e),t();this._deferredRIC.clear();for(let e of this._deferredST)window.clearTimeout(e);return this._deferredST.clear(),this._ignoredIssueIDs.clear(),this._resolvedIssueIDs.clear(),this._base=new z1("base"),this._head=new z1("head"),this._completeDiff=new Map,Promise.resolve()}_parseHashParam(e=""){let t=[],r=e.split(",").map(s=>s.trim()).filter(Boolean);for(let s of r){let o=s.split("/",2),a=o[0],l=o[1]??"*";!a||!l||t.push({type:i(a),subtype:i(l)})}return t;function i(s){let o=s.replace(/[-\/\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${o}$`)}}resetIgnoredIssues(){this._ignoredIssueIDs.clear(),this.emit("validated")}revalidateUnsquare(){let e=this._rules.get("unsquare_way");if(typeof e!="function")return;let t=r=>{if(!r.graph)return;r.uncacheIssuesOfType("unsquare_way");let s=this.context.systems.editor.tree.intersects(new le([-180,-90],[180,90]),r.graph).filter(o=>o.type==="way"&&o.tags.building&&o.tags.building!=="no");for(let o of s){let a=e(o,r.graph);a.length&&r.cacheIssues(a)}};t(this._head),t(this._base),this.emit("validated")}getIssues(e){let t=Object.assign({what:"all",where:"all",includeIgnored:!1,includeDisabledRules:!1},e),r=this.context,i=r.viewport.visibleExtent(),s=r.systems.editor.staging.graph,o=new Set,a=[],l=c=>{if(!c||o.has(c.id)||this._resolvedIssueIDs.has(c.id)||t.includeDisabledRules==="only"&&!this._disabledRuleIDs.has(c.type)||!t.includeDisabledRules&&this._disabledRuleIDs.has(c.type)||t.includeIgnored==="only"&&!this._ignoredIssueIDs.has(c.id)||!t.includeIgnored&&this._ignoredIssueIDs.has(c.id)||(c.entityIds||[]).some(u=>!s.hasEntity(u)))return!1;if(t.where==="visible"){let u=c.extent(s);if(!i.intersects(u))return!1}return!0};if(this._head.issues.size)for(let c of this._head.issues.values()){let u=(c.entityIds||[]).some(d=>this._completeDiff.has(d));t.what==="edited"&&!u||l(c)&&(o.add(c.id),a.push(c))}if(this._base.issues.size&&t.what==="all")for(let c of this._base.issues.values())l(c)&&(o.add(c.id),a.push(c));return a}getResolvedIssues(){return Array.from(this._resolvedIssueIDs).map(e=>this._base.issues.get(e)).filter(Boolean)}focusIssue(e){let t=this.context,r=t.systems.map,i=e.entityIds??[],s=i[0];s&&(e.loc?r.centerZoomEase(e.loc,19):i.length&&r.fitEntitiesEase(i),window.setTimeout(()=>{t.enter("select-osm",{selection:{osm:[s]}}),this.emit("focusedIssue",e)},250))}getIssuesBySeverity(e){let t=hr(this.getIssues(e),"severity");return{error:t.error??[],warning:t.warning??[],suggestion:t.suggestion??[]}}getSeverityIcon(e){return{error:"#rapid-icon-error",warning:"#fas-triangle-exclamation",suggestion:"#fas-circle-arrow-up",resolved:"#rapid-icon-apply"}[e]||"#fas-triangle-exclamation"}getSharedEntityIssues(e,t){let r=["missing_tag","missing_role","outdated_tags","mismatched_geometry","crossing_ways","almost_junction","disconnected_way","impossible_oneway"],i=this.getIssues(t),s=new Set(e);return i.filter(o=>(o.entityIds??[]).some(a=>s.has(a))).sort((o,a)=>{if(o.type===a.type)return o.id<a.id?-1:1;let l=r.indexOf(o.type),c=r.indexOf(a.type);return l!==-1&&c!==-1?l-c:l===-1&&c===-1?o.type<a.type?-1:1:l!==-1?-1:1})}getEntityIssues(e,t){return this.getSharedEntityIssues([e],t)}getRuleKeys(){return[...this._rules.keys()]}isRuleEnabled(e){return!this._disabledRuleIDs.has(e)}toggleRule(e){this._disabledRuleIDs.has(e)?this._disabledRuleIDs.delete(e):this._disabledRuleIDs.add(e),this.context.systems.storage.setItem("validate-disabledRules",[...this._disabledRuleIDs].join(",")),this.validateAsync()}disableRules(e=[]){this._disabledRuleIDs=new Set(e),this.context.systems.storage.setItem("validate-disabledRules",[...this._disabledRuleIDs].join(",")),this.validateAsync()}ignoreIssue(e){this._ignoredIssueIDs.add(e),this.emit("validated")}validateAsync(){let t=this.context.systems.editor;if(this._completeDiff=t.difference().complete(),t.canRestoreBackup)return Promise.resolve();if(this._validationPromise)return this._validationPromise;let r=t.base.graph,i=t.stable.graph,s=this._head.graph??r;if(i===r)return this._head=new z1("head"),this._head.graph=i,this._resolvedIssueIDs.clear(),this.emit("validated"),Promise.resolve();if(i===s)return this.emit("validated"),Promise.resolve();this._head.graph=i;let a=[...new Fn(s,i).complete().keys()];return a=this._head.withAllRelatedEntities(a),a.size?(this._validationPromise=this._validateEntitiesAsync(this._head,a).then(()=>this._updateResolvedIssues(a)).then(()=>this.emit("validated")).catch(l=>console.error(l)).then(()=>{this._validationPromise=null;let l=t.stable.graph,c=this._head.graph;l!==c&&this.validateAsync()}),this._validationPromise):(this.emit("validated"),Promise.resolve())}_validateBaseEntitiesAsync(e){let r=this.context.systems.editor;return e?(this._base.graph||(this._base.graph=r.base.graph),e=this._base.withAllRelatedEntities(e),this._validateEntitiesAsync(this._base,e).then(()=>this._updateResolvedIssues(e)).then(()=>this.emit("validated")).catch(i=>console.error(i))):Promise.resolve()}_validateEntity(e,t){let r=s=>{let o=s.type,a=s.subtype??"";for(let l of this._errorOverrides)if(l.type.test(o)&&l.subtype.test(a))return s.severity="error",!0;for(let l of this._warningOverrides)if(l.type.test(o)&&l.subtype.test(a))return s.severity="warning",!0;for(let l of this._disableOverrides)if(l.type.test(o)&&l.subtype.test(a))return!1;return!0},i={issues:[],provisional:!1};for(let[s,o]of this._rules){if(typeof o!="function"){console.error(`no such validation rule = ${s}`);continue}let a=o(e,t);a.provisional&&(i.provisional=!0),a=a.filter(r),i.issues=i.issues.concat(a)}return i}_updateResolvedIssues(e=[]){for(let t of e){let r=this._base.entityIssueIDs.get(t)??[];for(let i of r)(this._base.issues.get(i)?.entityIds||[]).some(a=>this._completeDiff.has(a))&&!this._head.issues.has(i)?this._resolvedIssueIDs.add(i):this._resolvedIssueIDs.delete(i)}}_validateEntitiesAsync(e,t){let r=Array.from(t).map(i=>e.queuedEntityIDs.has(i)?null:(e.queuedEntityIDs.add(i),e.uncacheEntityID(i),()=>{e.queuedEntityIDs.delete(i);let s=e.graph;if(!s)return;let o=s.hasEntity(i);if(!o)return;let a=this._validateEntity(o,s);a.provisional&&e.provisionalEntityIDs.add(i),e.cacheIssues(a.issues)})).filter(Boolean);return e.queue=e.queue.concat(ch(r,50)),e.queuePromise||(e.queuePromise=this._processQueue(e).then(()=>this._revalidateProvisionalEntities(e)).catch(i=>console.error(i)).finally(()=>e.queuePromise=null)),e.queuePromise}_revalidateProvisionalEntities(e){if(!e.provisionalEntityIDs.size)return;let t=window.setTimeout(()=>{this._deferredST.delete(t),e.provisionalEntityIDs.size&&this._validateEntitiesAsync(e,e.provisionalEntityIDs)},Toe);this._deferredST.add(t)}_processQueue(e){if(!e.queue.length)return Promise.resolve();let t=e.queue.pop();return new Promise((r,i)=>{let s=window.requestIdleCallback(()=>{this._deferredRIC.delete(s),t.forEach(o=>o()),r()});this._deferredRIC.set(s,i)}).then(()=>{e.queue.length%100===0&&this.emit("validated")}).then(()=>this._processQueue(e))}},z1=class{constructor(e){this.which=e,this.graph=null,this.queue=[],this.queuePromise=null,this.queuedEntityIDs=new Set,this.provisionalEntityIDs=new Set,this.issues=new Map,this.entityIssueIDs=new Map,this.recheckRBush=new Tt,this.recheckBoxes=new Map}cacheIssue(e){if(this.issues.has(e.id)&&this.uncacheIssue(e),e.type==="disconnected_way"||e.type==="impossible_oneway"){let t=e.extent(this.graph),r=Object.assign({issueID:e.id},t.bbox());this.recheckRBush.insert(r),this.recheckBoxes.set(e.id,r)}for(let t of e.entityIds??[]){let r=this.entityIssueIDs.get(t);r||(r=new Set,this.entityIssueIDs.set(t,r)),r.add(e.id)}this.issues.set(e.id,e)}uncacheIssue(e){let t=this.recheckBoxes.get(e.id);t&&(this.recheckRBush.remove(t),this.recheckBoxes.delete(e.id));for(let r of e.entityIds??[]){let i=this.entityIssueIDs.get(r);i&&(i.delete(e.id),i.size||this.entityIssueIDs.delete(r))}this.issues.delete(e.id)}cacheIssues(e=[]){for(let t of e)this.cacheIssue(t)}uncacheIssues(e=[]){for(let t of e)this.uncacheIssue(t)}uncacheIssuesOfType(e){let r=[...this.issues.values()].filter(i=>i.type===e);this.uncacheIssues(r)}uncacheEntityID(e){let t=this.entityIssueIDs.get(e)??[];for(let r of t){let i=this.issues.get(r);i&&this.uncacheIssue(i)}this.entityIssueIDs.delete(e),this.provisionalEntityIDs.delete(e)}withAllRelatedEntities(e=[]){let t=this.graph,r=new Set(e);if(!t||!r.size)return r;let i=new Set;for(let s of e){let o=t.hasEntity(s);if(!o)continue;let a=this.entityIssueIDs.get(s)??[];for(let l of a)i.add(l);if(o.type==="way"||o.type==="node"){let l=o.extent(t),c=this.recheckRBush.search(l.bbox())??[];for(let d of c)i.add(d.issueID);let u=o.type==="way"?t.childNodes(o):o.type==="node"?[o]:[];for(let d of u)for(let f of t.parentWays(d))r.add(f.id)}}for(let s of i){let a=this.issues.get(s)?.entityIds??[];for(let l of a)r.add(l)}return r}};var Xr={available:new Map};Xr.available.set("assets",ap);Xr.available.set("editor",up);Xr.available.set("filters",dp);Xr.available.set("gfx",Cp);Xr.available.set("imagery",Ip);Xr.available.set("l10n",Pp);Xr.available.set("locations",Lp);Xr.available.set("map",$p);Xr.available.set("map3d",Up);Xr.available.set("photos",zp);Xr.available.set("presets",Yp);Xr.available.set("rapid",Qp);Xr.available.set("storage",Zp);Xr.available.set("styles",e5);Xr.available.set("ui",I5);Xr.available.set("uploader",P5);Xr.available.set("urlhash",D5);Xr.available.set("validator",B5);var tr=class extends st{constructor(e){super(),this.context=e,this.id="",this._active=!1,this._selectedData=new Map,this.operations=[]}enter(){return this._active=!0,!0}exit(){this._active=!1}get active(){return this._active}get selectedData(){return this._selectedData}get selectedIDs(){return Array.from(this._selectedData.keys())}};var BV=!1,N5=class extends tr{constructor(e){super(e),this.id="add-note",this._click=this._click.bind(this),this._cancel=this._cancel.bind(this)}enter(){BV&&console.log("AddNoteMode: entering"),this._active=!0;let e=this.context;return e.enableBehaviors(["hover","draw","mapInteraction"]),e.behaviors.draw.on("click",this._click).on("cancel",this._cancel).on("finish",this._cancel),!0}exit(){if(!this._active)return;this._active=!1,BV&&console.log("AddNoteMode: exiting"),this.context.behaviors.draw.off("click",this._click).off("cancel",this._cancel).off("finish",this._cancel)}_click(e){let t=this.context,r=t.services.osm,i=t.viewport,s=e.coord.map,o=i.unproject(s);if(!r)return;let a=new Qe(r,null,null,{loc:o,status:"open",comments:[]});r.replaceNote(a);let l=new Map().set(a.id,a);t.enter("select",{selection:l})}_cancel(){this.context.enter("browse")}};var NV=!1,O5=class extends tr{constructor(e){super(e),this.id="add-point",this.defaultTags={},this._click=this._click.bind(this),this._cancel=this._cancel.bind(this)}enter(){NV&&console.log("AddPointMode: entering"),this._active=!0;let e=this.context;return e.systems.gfx.events.setCursor("crosshair"),e.enableBehaviors(["hover","draw","mapInteraction"]),e.behaviors.draw.on("click",this._click).on("cancel",this._cancel).on("finish",this._cancel),!0}exit(){if(!this._active)return;this._active=!1,NV&&console.log("AddPointMode: exiting");let e=this.context;e.systems.gfx.events.setCursor("grab"),e.behaviors.draw.off("click",this._click).off("cancel",this._cancel).off("finish",this._cancel)}_click(e){let t=this.context,i=t.systems.editor.staging.graph,s=t.systems.locations,o=t.viewport,a=e.coord.map,l=o.unproject(a);if(s.blocksAt(l).length)return;let c=e?.target?.data,u=e?.target?.choice,d=c&&i.hasEntity(c.id);if(d?.type==="node"){this._clickNode(d.loc,d);return}if(d?.type==="way"){let f=Ar(i.childNodes(d),a,o);if(f&&f.distance<6){let p=[d.nodes[f.index-1],d.nodes[f.index]];this._clickWay(f.loc,p);return}}this._clickNothing(l)}_clickNothing(e){let t=this.context,r=t.systems.editor,i=t.systems.l10n,s=Le({loc:e,tags:this.defaultTags});r.perform(Yt(s)),r.commit({annotation:i.t("operations.add.annotation.point"),selectedIDs:[s.id]}),t.enter("select-osm",{selection:{osm:[s.id]},newFeature:!0})}_clickWay(e,t){let r=this.context,i=r.systems.editor,s=r.systems.l10n,o=Le({tags:this.defaultTags});i.perform(Cr({loc:e,edge:t},o)),i.commit({annotation:s.t("operations.add.annotation.vertex"),selectedIDs:[o.id]}),r.enter("select-osm",{selection:{osm:[o.id]},newFeature:!0})}_clickNode(e,t){let r=this.context,i=r.systems.editor,s=r.systems.l10n;if(Object.keys(this.defaultTags).length===0){r.enter("select-osm",{selection:{osm:[t.id]},newFeature:!1});return}let o=Object.assign({},t.tags);for(let a in this.defaultTags)o[a]=this.defaultTags[a];i.perform(Ft(t.id,o)),i.commit({annotation:s.t("operations.add.annotation.point"),selectedIDs:[t.id]}),r.enter("select-osm",{selection:{osm:[t.id]},newFeature:!1})}_cancel(){this.context.enter("browse")}};var OV=!1,L5=class extends tr{constructor(e){super(e),this.context=e,this.id="browse",this._hover=this._hover.bind(this)}enter(){OV&&console.log("BrowseMode: entering");let e=this.context;this._active=!0,this.operations=[R5(e)],e.enableBehaviors(["hover","select","drag","paste","lasso","mapInteraction"]),e.behaviors.hover.on("hoverchange",this._hover);let t=e.systems.ui.Sidebar;return t.$custom&&t.$custom.selectAll(".save-success").size()||t.hide(),document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),!0}exit(){this._active&&(this._active=!1,this.operations=[],OV&&console.log("BrowseMode: exiting"),this.context.behaviors.hover.off("hoverchange",this._hover))}_hover(e){let t=this.context,i=t.systems.editor.staging.graph,s=t.systems.gfx.events,a=e.target?.data;switch((a&&i.hasEntity(a.id))?.geometry(i)??"unknown"){case"area":s.setCursor("areaCursor");break;case"line":s.setCursor("lineCursor");break;case"point":s.setCursor("pointCursor");break;case"vertex":s.setCursor("vertexCursor");break;default:s.setCursor("grab");break}}};var U5=class extends tr{constructor(e){super(e),this.id="drag-node",this.dragNode=null,this._reselectIDs=[],this._wasMidpoint=!1,this._startLoc=null,this._clickLoc=null,this._move=this._move.bind(this),this._end=this._end.bind(this),this._cancel=this._cancel.bind(this),this._nudge=this._nudge.bind(this)}enter(e={}){let t=this.context,r=t.systems.editor,i=t.systems.filters,s=t.systems.l10n,o=t.systems.gfx.scene,a=t.systems.ui;this._reselectIDs=e.reselectIDs??[];let l=e.midpoint,c=e.nodeID,u=r.staging.graph,d;if(l){if(!u.hasEntity(l.edge[0])||!u.hasEntity(l.edge[1]))return;if(d=Le(),r.perform(Cr(l,d)),u=r.staging.graph,d=u.hasEntity(d.id),!d){r.revert();return}this._wasMidpoint=!0}else c&&(d=u.hasEntity(c),this._wasMidpoint=!1);if(!d)return;if(!this._wasMidpoint&&i.hasHiddenConnections(d,u))return a.Flash.duration(4e3).iconName("#rapid-icon-no").label(s.t("modes.drag_node.connected_to_hidden"))(),!1;this._active=!0,this.dragNode=d,this._startLoc=d.loc,this._selectedData.set(d.id,d);let f=o.layers.get("osm");f.setClass("drawing",this.dragNode.id);for(let p of u.parentWays(this.dragNode))f.setClass("drawing",p.id);let h=t.behaviors.drag.lastDown.coord.map;return this._clickLoc=t.viewport.unproject(h),t.enableBehaviors(["hover","drag","mapNudge"]),t.behaviors.mapNudge.allow(),t.behaviors.drag.on("move",this._move).on("end",this._end).on("cancel",this._cancel),t.behaviors.mapNudge.on("nudge",this._nudge),!0}exit(){if(!this._active)return;this._active=!1,this.dragNode=null,this._reselectIDs=[],this._wasMidpoint=!1,this._startLoc=null,this._clickLoc=null,this._selectedData.clear();let e=this.context;e.systems.gfx.scene.layers.get("osm").clearClass("drawing"),e.behaviors.drag.off("move",this._move).off("end",this._end).off("cancel",this._cancel),e.behaviors.mapNudge.off("nudge",this._nudge)}_refreshEntities(){let r=this.context.systems.editor.staging.graph;if(this._selectedData.clear(),this.dragNode=this.dragNode&&r.hasEntity(this.dragNode.id),!this.dragNode){this._cancel();return}this._selectedData.set(this.dragNode.id,this.dragNode)}_move(e){if(!this.dragNode)return;let t=this.context,r=t.systems.editor,i=r.staging.graph,s=t.systems.locations,o=t.viewport,a=e.coord.map,l=e?.target?.data,c=e?.target?.choice,u=l&&i.hasEntity(l.id),d;if(u?.type==="node"&&this._canSnapToNode(u))d=u.loc;else if(u?.type==="way"){let f=Ar(i.childNodes(u),a,o,this.dragNode.id);f&&f.distance<6&&(d=f.loc)}if(!d){let f=o.project(this._clickLoc),h=o.project(this._startLoc),p=Me(h,f),m=bt(a,p);d=o.unproject(m)}if(s.blocksAt(d).length){this._cancel();return}r.perform(Wi(this.dragNode.id,d)),this._refreshEntities()}_nudge(e){if(!this.dragNode)return;let t=this.context,r=t.systems.editor,i=t.systems.locations,s=t.viewport,o=t.viewport.transform;o.r&&(e=lr(e,-o.r,[0,0]));let a=s.project(this.dragNode.loc),l=Me(a,e),c=s.unproject(l);if(i.blocksAt(c).length){this._cancel();return}r.perform(Wi(this.dragNode.id,c)),this._refreshEntities()}_end(e){if(!this.dragNode)return;let t=this.context,r=t.systems.editor,i=t.systems.l10n,s=t.viewport,o=e.coord.map,a=r.staging.graph,l=e?.target?.data,c=e?.target?.choice,u=l&&a.hasEntity(l.id),d;if(u?.type==="node"&&this._canSnapToNode(u))r.perform(Pc([u.id,this.dragNode.id])),d=this._connectAnnotation(u);else if(u?.type==="way"){let f=Ar(a.childNodes(u),o,s,this.dragNode.id);if(f&&f.distance<6){let p=[u.nodes[f.index-1],u.nodes[f.index]];r.perform(Cr({loc:f.loc,edge:p},this.dragNode)),d=this._connectAnnotation(u)}else d=this._moveAnnotation()}else this._wasMidpoint?d=i.t("operations.add.annotation.vertex"):d=this._moveAnnotation();r.commit({annotation:d,selectedIDs:[this.dragNode.id]}),this._reselectIDs.length?t.enter("select-osm",{selection:{osm:this._reselectIDs}}):t.enter("select-osm",{selection:{osm:[this.dragNode.id]}})}_moveAnnotation(){if(!this.dragNode)return;let e=this.context,r=e.systems.editor.staging.graph,i=e.systems.l10n,s=this.dragNode.geometry(r);return i.t(`operations.move.annotation.${s}`)}_connectAnnotation(e){if(!this.dragNode||!e)return;let t=this.context,i=t.systems.editor.staging.graph,s=t.systems.l10n,o=this.dragNode.geometry(i),a=e.geometry(i);if(o==="vertex"&&a==="vertex"){let l=i.parentWays(this.dragNode),c=i.parentWays(e),u=bn(l,c);if(u.length!==0)return u[0].areAdjacent(this.dragNode.id,e.id)?s.t("operations.connect.annotation.from_vertex.to_adjacent_vertex"):s.t("operations.connect.annotation.from_vertex.to_sibling_vertex")}return s.t(`operations.connect.annotation.from_${o}.to_${a}`)}_canSnapToNode(e){if(!this.dragNode)return!1;let t=this.context,i=t.systems.editor.staging.graph,s=t.systems.presets;return this.dragNode.geometry(i)!=="vertex"||e.geometry(i)==="vertex"||s.allowsVertex(e,i)}_cancel(){this.context.systems.editor.revert(),this.context.enter("browse")}};var G5=class extends tr{constructor(e){super(e),this.id="drag-note",this.dragNote=null,this._startLoc=null,this._clickLoc=null,this._move=this._move.bind(this),this._end=this._end.bind(this),this._cancel=this._cancel.bind(this),this._nudge=this._nudge.bind(this)}enter(e={}){let t=this.context,r=t.services.osm;if(!r)return;let i=e.noteID,s=r.getNote(i);if(!s)return;this._active=!0,this.dragNote=s,this._startLoc=s.loc,this._selectedData.set(this.dragNote.id,this.dragNote);let o=t.behaviors.drag.lastDown.coord.map;return this._clickLoc=t.viewport.unproject(o),t.enableBehaviors(["drag","mapNudge"]),t.behaviors.mapNudge.allow(),t.behaviors.drag.on("move",this._move).on("end",this._end).on("cancel",this._cancel),t.behaviors.mapNudge.on("nudge",this._nudge),!0}exit(){if(!this._active)return;this._active=!1,this.dragNote=null,this._startLoc=null,this._clickLoc=null,this._selectedData.clear();let e=this.context;e.behaviors.drag.off("move",this._move).off("end",this._end).off("cancel",this._cancel),e.behaviors.mapNudge.off("nudge",this._nudge)}_move(e){if(!this.dragNote)return;let t=this.context,r=t.systems.locations,i=t.systems.gfx,s=t.services.osm,o=t.viewport,a=e.coord.map,l=o.project(this._clickLoc),c=o.project(this._startLoc),u=Me(c,l),d=bt(a,u),f=o.unproject(d);if(r.blocksAt(f).length){this._cancel();return}this.dragNote=this.dragNote.update({loc:f}),s.replaceNote(this.dragNote),this._selectedData.set(this.dragNote.id,this.dragNote),i.immediateRedraw()}_nudge(e){if(!this.dragNote)return;let t=this.context,r=t.services.osm,i=t.systems.locations,s=t.viewport,o=t.viewport.transform;o.r&&(e=lr(e,-o.r,[0,0]));let a=s.project(this.dragNote.loc),l=Me(a,e),c=s.unproject(l);if(i.blocksAt(c).length){this._cancel();return}this.dragNote=this.dragNote.move(c),r.replaceNote(this.dragNote),this._selectedData.set(this.dragNote.id,this.dragNote)}_end(e){if(this.dragNote){let t=new Map().set(this.dragNote.id,this.dragNote);this.context.enter("select",{selection:t})}else this.context.enter("browse")}_cancel(){this.context.enter("browse")}};var go=!1,$5=class extends tr{constructor(e){super(e),this.id="draw-area",this.defaultTags={},this.drawWayID=null,this.drawNodeID=null,this.firstNodeID=null,this.lastNodeID=null,this._editIndex=null,this._lastPoint=null,this._snapshots=new Map,this._cancel=this._cancel.bind(this),this._click=this._click.bind(this),this._finish=this._finish.bind(this),this._hover=this._hover.bind(this),this._move=this._move.bind(this),this._nudge=this._nudge.bind(this),this._restoreSnapshot=this._restoreSnapshot.bind(this)}enter(){go&&console.log("DrawAreaMode: entering");let e=this.context,t=e.systems.editor;return this._active=!0,this.defaultTags={area:"yes"},this.drawWayID=null,this.drawNodeID=null,this.lastNodeID=null,this.firstNodeID=null,this._lastPoint=null,this._selectedData.clear(),e.systems.gfx.events.setCursor("crosshair"),e.enableBehaviors(["hover","draw","mapInteraction","mapNudge"]),e.behaviors.hover.on("hoverchange",this._hover),e.behaviors.draw.on("move",this._move).on("click",this._click).on("finish",this._finish).on("cancel",this._cancel),e.behaviors.mapNudge.on("nudge",this._nudge),t.on("historyjump",this._restoreSnapshot),e.behaviors.mapInteraction.doubleClickEnabled=!1,t.setCheckpoint("beginDraw"),this._editIndex=t.index,!0}exit(){if(!this._active)return;this._active=!1,go&&console.log("DrawAreaMode: exiting");let e=this.context,t=e.systems.editor,r=e.systems.gfx,i=r.scene.layers.get("osm");r.events.setCursor("grab"),e.behaviors.hover.off("hoverchange",this._hover),e.behaviors.draw.off("move",this._move).off("click",this._click).off("finish",this._finish).off("cancel",this._cancel),e.behaviors.mapNudge.off("nudge",this._nudge),t.off("historyjump",this._restoreSnapshot),t.beginTransaction(),t.revert();let o=t.stable.graph,a=this.drawWayID&&o.hasEntity(this.drawWayID);if(!a||a.isDegenerate())if(go&&console.log("DrawAreaMode: draw way invalid, rolling back"),t.index>this._editIndex)for(;t.index!==this._editIndex;)t.undo();else t.index<this._editIndex&&t.restoreCheckpoint("beginDraw");this.drawWayID=null,this.drawNodeID=null,this.lastNodeID=null,this.firstNodeID=null,this._editIndex=null,this._lastPoint=null,this._selectedData.clear(),i.clearClass("drawing"),window.setTimeout(()=>{e.behaviors.mapInteraction.doubleClickEnabled=!0},1e3),t.endTransaction()}_refreshEntities(){let e=this.context,t=e.systems.editor,i=e.systems.gfx.scene.layers.get("osm");i.clearClass("drawing"),this._selectedData.clear();let s=t.staging.graph,o=this.drawWayID&&s.hasEntity(this.drawWayID),a=this.drawWayID&&s.hasEntity(this.drawNodeID),l=this.lastNodeID&&s.hasEntity(this.lastNodeID),c=this.firstNodeID&&s.hasEntity(this.firstNodeID);if(!o||!l||!c){this._cancel();return}a&&(i.setClass("drawing",a.id),e.behaviors.mapNudge.allow()),i.setClass("drawing",o.id),this._selectedData.set(o.id,o)}_getAnnotation(){let e=this.context,r=e.systems.editor.staging.graph,i=e.systems.l10n,o=(this.drawWayID&&r.hasEntity(this.drawWayID))?.nodes?.length||0;if(o<4)return;let a=o>4?"continue":"start";return i.t(`operations.${a}.annotation.area`)}_move(e){if(!this.drawWayID)return;let t=this.context,r=t.systems.editor,i=t.viewport,s=e.coord.map,o=i.unproject(s),a=this._lastPoint?Ne(s,this._lastPoint):0;this._lastPoint=s;let l=r.staging.graph,c=this.drawNodeID&&l.hasEntity(this.drawNodeID);if(r.beginTransaction(),!c)if(a>1)c=this._addDrawNode(),l=r.staging.graph;else{r.endTransaction();return}let u=e?.target?.data,d=e?.target?.choice,f=u&&l.hasEntity(u.id);if(f?.type==="node")o=f.loc;else if(f?.type==="way"){let h=Ar(l.childNodes(f),s,i,c.id);h&&h.distance<6&&(o=h.loc)}r.perform(Wi(c.id,o)),this._refreshEntities(),r.endTransaction()}_nudge(e){let t=this.context,r=t.systems.editor,i=r.staging.graph,s=t.systems.locations,o=t.viewport,a=t.viewport.transform;a.r&&(e=lr(e,-a.r,[0,0]));let l=this.drawNodeID&&i.hasEntity(this.drawNodeID);if(!l)return;let c=o.project(l.loc),u=Me(c,e),d=o.unproject(u);if(s.blocksAt(d).length){this._cancel();return}r.perform(Wi(l.id,d)),this._refreshEntities()}_click(e){let t=this.context,r=t.systems.editor,i=t.systems.locations,s=t.viewport,o=e.coord.map,a=s.unproject(o);if(i.blocksAt(a).length)return;t.systems.gfx.events.setCursor("crosshair");let c=r.staging.graph,u=this.drawNodeID&&c.hasEntity(this.drawNodeID);r.beginTransaction(),this.drawWayID&&!u&&(u=this._addDrawNode(),c=r.staging.graph);let d=e?.target?.data,f=e?.target?.choice,h=d&&c.hasEntity(d.id),p,m;if(h?.type==="node")a=h.loc,p=h;else if(h?.type==="way"){let g=Ar(c.childNodes(h),o,s,this.drawNodeID);g&&g.distance<6&&(a=g.loc,m=[h.nodes[g.index-1],h.nodes[g.index]])}p?this._clickNode(a,p):m?this._clickWay(a,m):this._clickLoc(a)}_clickLoc(e){let i=this.context.systems.editor,s=i.staging.graph,o=this.drawWayID&&s.hasEntity(this.drawWayID),a=this.drawNodeID&&s.hasEntity(this.drawNodeID),l=this.lastNodeID&&s.hasEntity(this.lastNodeID),c=this.firstNodeID&&s.hasEntity(this.firstNodeID);if(o){if(He(e,l.loc,1e-6)||He(e,c.loc,1e-6)){this._finish();return}go&&console.log(`DrawAreaMode: _clickLoc, extending area to ${e}`);let u=this._getAnnotation();u&&(i.commit({annotation:u,selectedIDs:[o.id]}),this._takeSnapshot(c.id,a.id)),this.lastNodeID=a.id,this._addDrawNode(e)}else go&&console.log(`DrawAreaMode: _clickLoc, starting area at ${e}`),c=Le({loc:e}),a=Le({loc:e}),o=Rt({tags:this.defaultTags,nodes:[c.id,a.id,c.id]}),this.firstNodeID=c.id,this.lastNodeID=c.id,this.drawNodeID=a.id,this.drawWayID=o.id,i.perform(Yt(c),Yt(a),Yt(o));this._refreshEntities(),i.endTransaction()}_clickWay(e,t){let s=this.context.systems.editor,o={loc:e,edge:t},a=s.staging.graph,l=this.drawWayID&&a.hasEntity(this.drawWayID),c=this.drawNodeID&&a.hasEntity(this.drawNodeID),u=this.lastNodeID&&a.hasEntity(this.lastNodeID),d=this.firstNodeID&&a.hasEntity(this.firstNodeID);if(l){if(He(e,u.loc,1e-6)||He(e,d.loc,1e-6)){this._finish();return}go&&console.log(`DrawAreaMode: _clickWay, extending area to edge ${t}`),s.perform(Wi(c.id,e),Cr(o,c));let f=this._getAnnotation();f&&(s.commit({annotation:f,selectedIDs:[l.id]}),this._takeSnapshot(d.id,c.id)),this.lastNodeID=c.id,this._addDrawNode(e)}else go&&console.log(`DrawAreaMode: _clickWay, starting area at edge ${t}`),d=Le({loc:e}),c=Le({loc:e}),l=Rt({tags:this.defaultTags,nodes:[d.id,c.id,d.id]}),this.firstNodeID=d.id,this.lastNodeID=d.id,this.drawNodeID=c.id,this.drawWayID=l.id,s.perform(Yt(d),Yt(c),Yt(l),Cr(o,d));this._refreshEntities(),s.endTransaction()}_clickNode(e,t){let s=this.context.systems.editor,o=s.staging.graph,a=this.drawWayID&&o.hasEntity(this.drawWayID),l=this.drawNodeID&&o.hasEntity(this.drawNodeID),c=this.lastNodeID&&o.hasEntity(this.lastNodeID),u=this.firstNodeID&&o.hasEntity(this.firstNodeID);if(a){if(t.id===c.id||t.id===u.id||He(e,c.loc,1e-6)||He(e,u.loc,1e-6)){this._finish();return}go&&console.log(`DrawAreaMode: _clickNode, extending area to ${t.id}`),s.perform(this._actionRemoveDrawNode(a,l),ls(a.id,t.id));let d=this._getAnnotation();d&&(s.commit({annotation:d,selectedIDs:[a.id]}),this._takeSnapshot(u.id,t.id)),this.lastNodeID=t.id,s.perform(Yt(l),ls(a.id,l.id))}else go&&console.log(`DrawAreaMode: _clickNode, starting line at ${t.id}`),l=Le({loc:e}),a=Rt({tags:this.defaultTags,nodes:[t.id,l.id,t.id]}),this.firstNodeID=t.id,this.lastNodeID=t.id,this.drawNodeID=l.id,this.drawWayID=a.id,s.perform(Yt(l),Yt(a));this._refreshEntities(),s.endTransaction()}_actionRemoveDrawNode(e,t){return r=>r.replace(r.entity(e.id).removeNode(t.id)).remove(t)}_addDrawNode(e){let t=this.context,r=t.systems.editor,i=t.systems.map,s=Le({loc:e??i.mouseLoc()});return this.drawNodeID=s.id,r.perform(Yt(s),ls(this.drawWayID,s.id)),s}_finish(){let e=this.context,r=e.systems.editor.staging.graph,i=this.drawWayID&&r.hasEntity(this.drawWayID);i?(go&&console.log(`DrawAreaMode: _finish, drawWay.id = ${i.id}`),e.enter("select-osm",{selection:{osm:[i.id]},newFeature:!0})):e.enter("browse")}_cancel(){go&&console.log("DrawAreaMode: _cancel"),this.drawWayID=null,this.context.enter("browse")}_takeSnapshot(e,t){let s=this.context.systems.editor.stable.graph,o={drawWayID:this.drawWayID,firstNodeID:e,lastNodeID:t};this._snapshots.set(s,o)}_restoreSnapshot(){let e=this.context,t=e.systems.editor,r=t.stable.graph,i=this._snapshots.get(r);if(i&&i.drawWayID===this.drawWayID)this.firstNodeID=i.firstNodeID,this.lastNodeID=i.lastNodeID,this.drawNodeID=null,this._refreshEntities();else{let o=(t.stable.selectedIDs??[]).filter(a=>r.hasEntity(a));o.length?e.enter("select-osm",{selection:{osm:o}}):e.enter("browse")}}_hover(e){let t=this.context,i=t.systems.editor.staging.graph,s=t.systems.gfx.events,a=e.target?.data;switch((a&&i.hasEntity(a.id))?.geometry(i)??"unknown"){case"line":s.setCursor("connectLineCursor");break;case"vertex":s.setCursor("connectVertexCursor");break;default:s.setCursor("crosshair")}}};var Rs=!1,z5=class extends tr{constructor(e){super(e),this.id="draw-line",this.defaultTags={},this.drawWayID=null,this.drawNodeID=null,this.firstNodeID=null,this.lastNodeID=null,this._insertIndex=void 0,this._editIndex=null,this._lastPoint=null,this._snapshots=new Map,this._cancel=this._cancel.bind(this),this._click=this._click.bind(this),this._finish=this._finish.bind(this),this._hover=this._hover.bind(this),this._move=this._move.bind(this),this._nudge=this._nudge.bind(this),this._restoreSnapshot=this._restoreSnapshot.bind(this)}enter(e={}){let t=this.context,r=t.systems.editor,i=r.staging.graph,s=e.continueNodeID,o=e.continueWayID,a=s&&i.hasEntity(s),l=o&&i.hasEntity(o);if(a||l){if(!(a instanceof Le)||!(l instanceof Rt))return!1;Rs&&console.log(`DrawLineMode: entering, continuing line ${l.id}`)}else Rs&&console.log("DrawLineMode: entering");if(this._active=!0,this.drawWayID=null,this.drawNodeID=null,this.lastNodeID=null,this.firstNodeID=null,this._insertIndex=void 0,this._lastPoint=null,this._selectedData.clear(),t.systems.gfx.events.setCursor("crosshair"),t.enableBehaviors(["hover","draw","mapInteraction","mapNudge"]),t.behaviors.hover.on("hoverchange",this._hover),t.behaviors.draw.on("move",this._move).on("click",this._click).on("finish",this._finish).on("cancel",this._cancel),t.behaviors.mapNudge.on("nudge",this._nudge),r.on("historyjump",this._restoreSnapshot),t.behaviors.mapInteraction.doubleClickEnabled=!1,r.setCheckpoint("beginDraw"),this._editIndex=r.index,a&&l){let u=l.affix(a.id)==="prefix",d=u?l.last():l.first();this._insertIndex=u?0:void 0,this.drawWayID=o,this.lastNodeID=s,this.firstNodeID=d,this._addDrawNode(),this._refreshEntities()}return!0}exit(){if(!this._active)return;this._active=!1,Rs&&console.log("DrawLineMode: exiting");let e=this.context,t=e.systems.editor,r=e.systems.gfx,i=r.scene.layers.get("osm");r.events.setCursor("grab"),e.behaviors.hover.off("hoverchange",this._hover),e.behaviors.draw.off("move",this._move).off("click",this._click).off("finish",this._finish).off("cancel",this._cancel),e.behaviors.mapNudge.off("nudge",this._nudge),t.off("historyjump",this._restoreSnapshot),t.beginTransaction(),t.revert();let o=t.stable.graph,a=this.drawWayID&&o.hasEntity(this.drawWayID);if(!a||a.isDegenerate())if(Rs&&console.log("DrawLineMode: draw way invalid, rolling back"),t.index>this._editIndex)for(;t.index!==this._editIndex;)t.undo();else t.index<this._editIndex&&t.restoreCheckpoint("beginDraw");this.drawWayID=null,this.drawNodeID=null,this.lastNodeID=null,this.firstNodeID=null,this._insertIndex=void 0,this._editIndex=null,this._lastPoint=null,this._selectedData.clear(),i.clearClass("drawing"),window.setTimeout(()=>{e.behaviors.mapInteraction.doubleClickEnabled=!0},1e3),t.endTransaction()}_refreshEntities(){let e=this.context,t=e.systems.editor,i=e.systems.gfx.scene.layers.get("osm");i.clearClass("drawing"),this._selectedData.clear();let s=t.staging.graph,o=this.drawWayID&&s.hasEntity(this.drawWayID),a=this.drawWayID&&s.hasEntity(this.drawNodeID),l=this.lastNodeID&&s.hasEntity(this.lastNodeID),c=this.firstNodeID&&s.hasEntity(this.firstNodeID);if(!o||!l||!c){this._cancel();return}a&&(i.setClass("drawing",a.id),e.behaviors.mapNudge.allow()),i.setClass("drawing",o.id),this._selectedData.set(o.id,o)}_getAnnotation(){let e=this.context,r=e.systems.editor.staging.graph,i=e.systems.l10n,o=(this.drawWayID&&r.hasEntity(this.drawWayID))?.nodes?.length||0;if(o<2)return;let a=o>2?"continue":"start";return i.t(`operations.${a}.annotation.line`)}_move(e){if(!this.drawWayID)return;let t=this.context,r=t.systems.editor,i=t.viewport,s=e.coord.map,o=i.unproject(s),a=this._lastPoint?Ne(s,this._lastPoint):0;this._lastPoint=s;let l=r.staging.graph,c=this.drawNodeID&&l.hasEntity(this.drawNodeID);if(r.beginTransaction(),!c)if(a>1)c=this._addDrawNode(),l=r.staging.graph;else{r.endTransaction();return}let u=e?.target?.data,d=e?.target?.choice,f=u&&l.hasEntity(u.id);if(f?.type==="node")o=f.loc;else if(f?.type==="way"){let h=Ar(l.childNodes(f),s,i,c.id);h&&h.distance<6&&(o=h.loc)}r.perform(Wi(c.id,o)),this._refreshEntities(),r.endTransaction()}_nudge(e){let t=this.context,r=t.systems.editor,i=r.staging.graph,s=t.systems.locations,o=t.viewport,a=t.viewport.transform;a.r&&(e=lr(e,-a.r,[0,0]));let l=this.drawNodeID&&i.hasEntity(this.drawNodeID);if(!l)return;let c=o.project(l.loc),u=Me(c,e),d=o.unproject(u);if(s.blocksAt(d).length){this._cancel();return}r.perform(Wi(l.id,d)),this._refreshEntities()}_click(e){let t=this.context,r=t.systems.editor,i=t.systems.locations,s=t.viewport,o=e.coord.map,a=s.unproject(o);if(i.blocksAt(a).length)return;t.systems.gfx.events.setCursor("crosshair");let c=r.staging.graph,u=this.drawNodeID&&c.hasEntity(this.drawNodeID);r.beginTransaction(),this.drawWayID&&!u&&(u=this._addDrawNode(),c=r.staging.graph);let d=e?.target?.data,f=e?.target?.choice,h=d&&c.hasEntity(d.id),p,m;if(h?.type==="node")a=h.loc,p=h;else if(h?.type==="way"){let g=Ar(c.childNodes(h),o,s,this.drawNodeID);g&&g.distance<6&&(a=g.loc,m=[h.nodes[g.index-1],h.nodes[g.index]])}p?this._clickNode(a,p):m?this._clickWay(a,m):this._clickLoc(a)}_clickLoc(e){let i=this.context.systems.editor,s=i.staging.graph,o=this.drawWayID&&s.hasEntity(this.drawWayID),a=this.drawNodeID&&s.hasEntity(this.drawNodeID),l=this.lastNodeID&&s.hasEntity(this.lastNodeID),c=this.firstNodeID&&s.hasEntity(this.firstNodeID);if(o){if(He(e,l.loc,1e-6)||He(e,c.loc,1e-6)){this._finish();return}Rs&&console.log(`DrawLineMode: _clickLoc, extending line to ${e}`);let u=this._getAnnotation();u&&(i.commit({annotation:u,selectedIDs:[o.id]}),this._takeSnapshot(c.id,a.id)),this.lastNodeID=a.id,this._addDrawNode(e)}else Rs&&console.log(`DrawLineMode: _clickLoc, starting line at ${e}`),c=Le({loc:e}),a=Le({loc:e}),o=Rt({tags:this.defaultTags,nodes:[c.id,a.id]}),this.firstNodeID=c.id,this.lastNodeID=c.id,this.drawNodeID=a.id,this.drawWayID=o.id,i.perform(Yt(c),Yt(a),Yt(o));this._refreshEntities(),i.endTransaction()}_clickWay(e,t){let s=this.context.systems.editor,o={loc:e,edge:t},a=s.staging.graph,l=this.drawWayID&&a.hasEntity(this.drawWayID),c=this.drawNodeID&&a.hasEntity(this.drawNodeID),u=this.lastNodeID&&a.hasEntity(this.lastNodeID),d=this.firstNodeID&&a.hasEntity(this.firstNodeID);if(l){if(He(e,u.loc,1e-6)||He(e,d.loc,1e-6)){this._finish();return}Rs&&console.log(`DrawLineMode: _clickWay, extending line to edge ${t}`),s.perform(Wi(c.id,e),Cr(o,c));let f=this._getAnnotation();f&&(s.commit({annotation:f,selectedIDs:[l.id]}),this._takeSnapshot(d.id,c.id)),this.lastNodeID=c.id,this._addDrawNode(e)}else Rs&&console.log(`DrawLineMode: _clickWay, starting line at edge ${t}`),d=Le({loc:e}),c=Le({loc:e}),l=Rt({tags:this.defaultTags,nodes:[d.id,c.id]}),this.firstNodeID=d.id,this.lastNodeID=d.id,this.drawNodeID=c.id,this.drawWayID=l.id,s.perform(Yt(d),Yt(c),Yt(l),Cr(o,d));this._refreshEntities(),s.endTransaction()}_clickNode(e,t){let s=this.context.systems.editor,o=s.staging.graph,a=this.drawWayID&&o.hasEntity(this.drawWayID),l=this.drawNodeID&&o.hasEntity(this.drawNodeID),c=this.lastNodeID&&o.hasEntity(this.lastNodeID),u=this.firstNodeID&&o.hasEntity(this.firstNodeID);if(a){if(t.id===c.id||He(e,c.loc,1e-6)){this._finish();return}Rs&&console.log(`DrawLineMode: _clickNode, extending line to ${t.id}`),s.perform(this._actionRemoveDrawNode(a,l),ls(a.id,t.id,this._insertIndex));let d=this._getAnnotation();if(d&&(s.commit({annotation:d,selectedIDs:[a.id]}),this._takeSnapshot(u.id,t.id)),t.id===u.id||He(e,u.loc,1e-6)){this._finish();return}else this.lastNodeID=t.id,s.perform(Yt(l),ls(a.id,l.id,this._insertIndex))}else Rs&&console.log(`DrawLineMode: _clickNode, starting line at ${t.id}`),l=Le({loc:e}),a=Rt({tags:this.defaultTags,nodes:[t.id,l.id]}),this.firstNodeID=t.id,this.lastNodeID=t.id,this.drawNodeID=l.id,this.drawWayID=a.id,s.perform(Yt(l),Yt(a));this._refreshEntities(),s.endTransaction()}_actionRemoveDrawNode(e,t){return r=>r.replace(r.entity(e.id).removeNode(t.id)).remove(t)}_addDrawNode(e){let t=this.context,r=t.systems.editor,i=t.systems.map,s=Le({loc:e??i.mouseLoc()});return this.drawNodeID=s.id,r.perform(Yt(s),ls(this.drawWayID,s.id,this._insertIndex)),s}_finish(){let e=this.context,r=e.systems.editor.staging.graph,i=this.drawWayID&&r.hasEntity(this.drawWayID);if(i){Rs&&console.log(`DrawLineMode: _finish, drawWay.id = ${i.id}`);let s=Object.keys(i.tags).length===0;e.enter("select-osm",{selection:{osm:[i.id]},newFeature:s})}else e.enter("browse")}_cancel(){Rs&&console.log("DrawLineMode: _cancel"),this.drawWayID=null,this.context.enter("browse")}_takeSnapshot(e,t){let s=this.context.systems.editor.stable.graph,o={drawWayID:this.drawWayID,insertIndex:this._insertIndex,firstNodeID:e,lastNodeID:t};this._snapshots.set(s,o)}_restoreSnapshot(){let e=this.context,t=e.systems.editor,r=t.stable.graph,i=this._snapshots.get(r);if(i&&i.drawWayID===this.drawWayID)this._insertIndex=i.insertIndex,this.firstNodeID=i.firstNodeID,this.lastNodeID=i.lastNodeID,this.drawNodeID=null,this._refreshEntities();else{let o=(t.stable.selectedIDs??[]).filter(a=>r.hasEntity(a));o.length?e.enter("select-osm",{selection:{osm:o}}):e.enter("browse")}}_hover(e){let t=this.context,i=t.systems.editor.staging.graph,s=t.systems.gfx.events,a=e.target?.data;switch((a&&i.hasEntity(a.id))?.geometry(i)??"unknown"){case"line":s.setCursor("connectLineCursor");break;case"vertex":s.setCursor("connectVertexCursor");break;default:s.setCursor("crosshair")}}};var H5=class extends tr{constructor(e){super(e),this.id="move",this._entityIDs=[],this._startLoc=null,this._movementCache=null,this._cancel=this._cancel.bind(this),this._finish=this._finish.bind(this),this._keydown=this._keydown.bind(this),this._pointermove=this._pointermove.bind(this)}enter(e={}){let t=this.context,r=t.systems.editor,i=t.systems.gfx,s=r.staging.graph,o=t.systems.filters,a=t.systems.locations,l=t.systems.map,c=i.events,d=(e.selection??{}).osm??[];this._selectedData=new Map;for(let f of d){let h=s.hasEntity(f);h&&(h.type==="node"&&a.blocksAt(h.loc).length||this._selectedData.set(f,h))}return this._selectedData.size?(this._entityIDs=[...this._selectedData.keys()],this._active=!0,o.forceVisible(this._entityIDs),t.enableBehaviors(["mapInteraction","mapNudge"]),t.behaviors.mapNudge.allow(),this._startLoc=l.mouseLoc(),this._movementCache={},c.on("click",this._finish).on("keydown",this._keydown).on("pointercancel",this._cancel).on("pointermove",this._pointermove),!0):!1}exit(){if(!this._active)return;this._active=!1,this._startLoc=null,this._movementCache=null;let e=this.context,t=e.systems.editor,r=e.systems.filters,i=e.systems.l10n,s=e.systems.gfx.events;if(r.forceVisible([]),s.off("click",this._finish).off("keydown",this._keydown).off("pointercancel",this._cancel).off("pointermove",this._pointermove),t.hasWorkInProgress){let o=t.staging.graph,a=this._entityIDs.length===1?i.t("operations.move.annotation."+o.geometry(this._entityIDs[0])):i.t("operations.move.annotation.feature",{n:this._entityIDs.length});t.commit({annotation:a,selectedIDs:this._entityIDs})}}_keydown(e){["Enter"].includes(e.key)?(e.preventDefault(),this._finish()):["Backspace","Delete","Del","Escape","Esc"].includes(e.key)?(e.preventDefault(),this._cancel()):["r","R"].includes(e.key)&&(e.preventDefault(),this.context.enter("rotate",{selection:{osm:this._entityIDs}}))}_pointermove(){let e=this.context,t=e.systems.editor,r=e.systems.locations,s=e.systems.map.mouseLoc();if(r.blocksAt(s).length){this._cancel();return}let o=e.viewport.project(this._startLoc),a=e.viewport.project(s),l=Me(a,o);t.revert(),t.perform(Ao(this._entityIDs,l,e.viewport,this._movementCache));let c=t.staging.graph;this._selectedData.clear();for(let u of this._entityIDs)this._selectedData.set(u,c.entity(u))}_finish(){this.context.enter("select-osm",{selection:{osm:this._entityIDs}})}_cancel(){let e=this.context;e.systems.editor.revert(),e.enter("select-osm",{selection:{osm:this._entityIDs}})}};var W5=class extends tr{constructor(e){super(e),this.id="rotate",this._entityIDs=[],this._lastPoint=null,this._pivotLoc=null,this._cancel=this._cancel.bind(this),this._finish=this._finish.bind(this),this._keydown=this._keydown.bind(this),this._pointermove=this._pointermove.bind(this)}enter(e={}){let t=this.context,i=t.systems.editor.staging.graph,s=t.systems.filters,o=t.systems.locations,a=t.systems.gfx.events,c=(e.selection??{}).osm??[];this._selectedData=new Map;for(let u of c){let d=i.hasEntity(u);d&&(d.type==="node"&&o.blocksAt(d.loc).length||this._selectedData.set(u,d))}return this._selectedData.size?(this._entityIDs=[...this._selectedData.keys()],this._active=!0,s.forceVisible(this._entityIDs),t.enableBehaviors(["mapInteraction"]),this._lastPoint=null,this._pivotLoc=this._calcPivotLoc(),a.on("click",this._finish).on("keydown",this._keydown).on("pointercancel",this._cancel).on("pointermove",this._pointermove),!0):!1}exit(){if(!this._active)return;this._active=!1;let e=this.context,t=e.systems.editor,r=e.systems.filters,i=e.systems.l10n,s=e.systems.gfx.events;if(this._lastPoint=null,this._pivotLoc=null,r.forceVisible([]),s.off("click",this._finish).off("keydown",this._keydown).off("pointercancel",this._cancel).off("pointermove",this._pointermove),t.hasWorkInProgress){let o=t.staging.graph,a=this._entityIDs.length===1?i.t("operations.rotate.annotation."+o.geometry(this._entityIDs[0])):i.t("operations.rotate.annotation.feature",{n:this._entityIDs.length});t.commit({annotation:a,selectedIDs:this._entityIDs})}}_keydown(e){["Enter"].includes(e.key)?(e.preventDefault(),this._finish()):["Backspace","Delete","Del","Escape","Esc"].includes(e.key)?(e.preventDefault(),this._cancel()):["m","M"].includes(e.key)&&(e.preventDefault(),this.context.enter("move",{selection:{osm:this._entityIDs}}))}_pointermove(){let e=this.context,t=e.systems.editor,i=e.systems.gfx.events.coord.map;if(this._lastPoint){let o=e.viewport.project(this._pivotLoc),[a,l]=Me(i,this._lastPoint),[c,u]=[i[0]>o[0]?1:-1,i[1]>o[1]?-1:1],h=(u*a+c*l)*Mn*.3;t.perform(F2(this._entityIDs,o,h,e.viewport))}this._lastPoint=i.slice(),this._selectedData.clear();let s=t.staging.graph;for(let o of this._entityIDs)this._selectedData.set(o,s.entity(o))}_calcPivotLoc(){let e=this.context,t=e.viewport,r=e.systems.editor.staging.graph,s=Ht(this._entityIDs,r).map(a=>t.project(a.loc)),o;return s.length===1?o=s[0]:s.length===2?o=at(s[0],s[1],.5):pi(s).length===2?o=at(s[0],s[1],.5):o=hi(pi(s)),t.unproject(o)}_finish(){this.context.enter("select-osm",{selection:{osm:this._entityIDs}})}_cancel(){let e=this.context;e.systems.editor.revert(),e.enter("select-osm",{selection:{osm:this._entityIDs}})}};var LV=!1,V5=class extends tr{constructor(e){super(e),this.id="save",this._keybinding=Xe("SaveMode"),this._cancel=this._cancel.bind(this),this._hideLoading=this._hideLoading.bind(this),this._keybindingOff=this._keybindingOff.bind(this),this._keybindingOn=this._keybindingOn.bind(this),this._prepareForSuccess=this._prepareForSuccess.bind(this),this._progressChanged=this._progressChanged.bind(this),this._resultConflicts=this._resultConflicts.bind(this),this._resultErrors=this._resultErrors.bind(this),this._resultNoChanges=this._resultNoChanges.bind(this),this._resultSuccess=this._resultSuccess.bind(this),this._saveEnded=this._saveEnded.bind(this),this._saveStarted=this._saveStarted.bind(this),this._showLoading=this._showLoading.bind(this),this._location=null,this._uiConflicts=null,this._uiLoading=null,this._uiSuccess=null,this._wasSuccessfulSave=!1}enter(){let e=this.context,t=e.services.osm,r=e.systems.uploader,i=e.systems.ui.Sidebar;return t?(LV&&console.log("SaveMode: entering"),i.expand(),this._active=!0,this._wasSuccessfulSave=!1,this._uiCommit=Yb(e).on("cancel",this._cancel),t.authenticated()?i.show(this._uiCommit):t.authenticate(s=>{s?this._cancel():i.show(this._uiCommit)}),e.container().selectAll(".main-content").classed("active",!1).classed("inactive",!0),this._keybindingOn(),e.enableBehaviors(["mapInteraction"]),r.on("progressChanged",this._progressChanged).on("resultConflicts",this._resultConflicts).on("resultErrors",this._resultErrors).on("resultNoChanges",this._resultNoChanges).on("resultSuccess",this._resultSuccess).on("saveEnded",this._saveEnded).on("saveStarted",this._saveStarted).on("willAttemptUpload",this._prepareForSuccess),!0):!1}exit(){if(!this._active)return;this._active=!1,LV&&console.log("SaveMode: exiting");let e=this.context,t=e.systems.uploader,r=e.systems.ui.Sidebar;this._uiCommit.on("cancel",null),this._uiCommit=null,t.off("progressChanged",this._progressChanged).off("resultConflicts",this._resultConflicts).off("resultErrors",this._resultErrors).off("resultNoChanges",this._resultNoChanges).off("resultSuccess",this._resultSuccess).off("saveEnded",this._saveEnded).off("saveStarted",this._saveStarted).off("willAttemptUpload",this._prepareForSuccess),this._keybindingOff(),this._hideLoading(),e.container().selectAll(".main-content").classed("active",!0).classed("inactive",!1),this._wasSuccessfulSave||r.hide()}_cancel(){this.context.enter("browse")}_progressChanged(e,t){let r=this.context,i=r.systems.l10n,o=r.container().select(".loading-modal .modal-section").selectAll(".progress").data([0]);o.enter().append("div").attr("class","progress").merge(o).text(i.t("save.conflict_progress",{num:e,total:t}))}_resultConflicts(e,t){let r=this.context,i=r.systems.uploader,s=r.container().select(".sidebar").append("div").attr("class","sidebar-component"),o=r.container().selectAll(".main-content");o.classed("active",!0).classed("inactive",!1),this._uiConflicts=Kb(r).conflictList(e).origChanges(t).on("cancel",()=>{o.classed("active",!1).classed("inactive",!0),s.remove(),this._keybindingOn(),i.cancelConflictResolution()}).on("save",()=>{o.classed("active",!1).classed("inactive",!0),s.remove(),i.processResolvedConflicts()}),s.call(this._uiConflicts)}_resultErrors(e){let t=this.context,r=t.systems.l10n;this._keybindingOn();let i=gc(t,t.container());i.select(".modal-section.header").append("h3").text(r.t("save.error")),this._addErrors(i,e),i.okButton()}_addErrors(e,t){let i=this.context.systems.l10n,o=e.select(".modal-section.message-text").selectAll(".error-container").data(t),a=o.enter().append("div").attr("class","error-container");a.append("a").attr("class","error-description").attr("href","#").classed("hide-toggle",!0).text(c=>c.msg||i.t("save.unknown_error_details")).on("click",function(c){c.preventDefault();let u=H(this),d=H(this.nextElementSibling),f=u.classed("expanded");d.style("display",f?"none":"block"),u.classed("expanded",!f)}),a.append("div").attr("class","error-detail-container").style("display","none").append("ul").attr("class","error-detail-list").selectAll("li").data(c=>c.details||[]).enter().append("li").attr("class","error-detail-item").text(c=>c),o.exit().remove()}_resultNoChanges(){let e=this.context;e.resetAsync().then(()=>e.enter("browse"))}_resultSuccess(e){let t=this.context,r=t.systems.ui.Sidebar,i=this._uiSuccess.changeset(e).location(this._location).on("cancel",()=>r.hide());this._wasSuccessfulSave=!0,r.show(i),window.setTimeout(()=>{t.resetAsync().then(()=>t.enter("browse"))},2500)}_saveStarted(){this._keybindingOff(),this._showLoading()}_saveEnded(){this._keybindingOn(),this._hideLoading()}_showLoading(){if(this._saveLoading)return;let e=this.context,t=e.systems.l10n;this._saveLoading=Vo(e).blocking(!0).message(t.t("save.uploading")),e.container().call(this._saveLoading)}_hideLoading(){this._saveLoading&&(this._saveLoading.close(),this._saveLoading=null)}_keybindingOn(){H(document).call(this._keybinding.on("\u238B",this._cancel,!0))}_keybindingOff(){H(document).call(this._keybinding.unbind)}_prepareForSuccess(){this._uiSuccess=J_(this.context),this._location=null;let e=this.context,t=e.systems.l10n,r=e.viewport.centerLoc(),i=e.services.nominatim;i&&i.reverse(r,(s,o)=>{if(s||!o||!o.address)return;let a=o.address,l=a?.town??a?.city??a?.county??"",c=a?.state??a?.country??"",u=l&&c?t.t("success.thank_you_where.separator"):"";this._location=t.t("success.thank_you_where.format",{place:l,separator:u,region:c})})}};var UV=!1,j5=class extends tr{constructor(e){super(e),this.id="select",this.extent=null}enter(e={}){let t=e.selection;if(!(t instanceof Map)||!t.size)return!1;let[[r,i]]=t.entries();UV&&console.log(`SelectMode: entering, selected ${r}`),this._selectedData=t,this._active=!0;let s=this.context,o=s.systems.gfx,a=s.systems.photos,l=o.scene,c=s.systems.ui.Sidebar;s.enableBehaviors(["hover","select","drag","mapInteraction","lasso","paste"]),this.extent=new le;for(let d of t.values()){let f;if(d.loc)f=new le(d.loc);else if(d.__featurehash__){let h=Iv(d);f=new le(h[0],h[1])}else if(d.__fbid__){let h=s.services[d.__service__];if(!h)continue;let p=h.graph(d.__datasetid__);if(!p)continue;f=d.extent(p)}f&&(this.extent=this.extent.extend(f))}l.clearClass("select");for(let d of t.values()){let f=null;if(d instanceof Qe){let h=d.service;f=h==="osm"?"notes":h,f==="osm"&&(f="notes")}else d.__fbid__||d.overture?f="rapid":d.__featurehash__?f="custom-data":d.type==="detection"&&(d.service==="mapillary"&&d.object_type==="point"?f="mapillary-detections":d.service==="mapillary"&&d.object_type==="traffic_sign"&&(f="mapillary-signs"));f&&l.setClass("select",f,r)}c.reset();let u=null;if(i instanceof Qe&&i.service==="osm")u=qf(s).note(i),u.on("change",()=>{o.immediateRedraw();let f=s.services.osm?.getNote(r);f instanceof Qe&&(c.show(u.note(f)),this._selectedData.set(r,f))});else if(i instanceof Qe&&i.service==="keepRight")u=Cf(s).error(i),u.on("change",()=>{o.immediateRedraw();let f=s.services.keepRight?.getError(r);f instanceof Qe&&(c.show(u.error(f)),this._selectedData.set(r,f))});else if(i instanceof Qe&&i.service==="osmose")u=Kf(s).error(i),u.on("change",()=>{o.immediateRedraw();let f=s.services.osmose?.getError(r);f instanceof Qe&&(c.show(u.error(f)),this._selectedData.set(r,f))});else if(i instanceof Qe&&i.service==="maproulette")u=zf(s).error(i),this.context.systems.ui.MapRouletteMenu.error(i),u.on("change",()=>{o.immediateRedraw();let h=s.services.maproulette?.getError(r);h instanceof Qe&&(c.show(u.error(h)),this._selectedData.set(r,h))});else if(i.type==="detection"){u=pf(s).datum(i);let d=i.service,f=i.object_type==="traffic_sign"?"signs":"detections",h=`${d}-${f}`;a.selectDetection(h,i.id)}else i.__featurehash__?u=ff(s).datum(i):i.overture?(c.OvertureInspector.datum=i,u=c.OvertureInspector.render):i.__fbid__&&(c.RapidInspector.datum=i,u=c.RapidInspector.render);return u&&c.show(u),!0}exit(){if(!this._active)return;this._active=!1;let e=this.context,t=e.systems.photos,r=e.systems.gfx.scene,i=e.systems.ui.Sidebar;this.extent=null,UV&&console.log("SelectMode: exiting"),this._selectedData.clear(),r.clearClass("select"),i.hide(),t.selectDetection(null)}};var X5=class extends tr{constructor(e){super(e),this.id="select-osm",this.keybinding=null,this.extent=null,this._newFeature=!1,this._focusedParentID=null,this._singularDatum=null,this._lastSelectedIDs=[],this._keydown=this._keydown.bind(this),this._hover=this._hover.bind(this),this._merge=this._merge.bind(this),this._firstVertex=this._firstVertex.bind(this),this._focusNextParent=this._focusNextParent.bind(this),this._lastVertex=this._lastVertex.bind(this),this._nextVertex=this._nextVertex.bind(this),this._previousVertex=this._previousVertex.bind(this)}enter(e={}){let t=this.context,r=t.systems.editor,i=r.staging.graph,s=t.systems.filters,o=t.behaviors.hover,a=t.systems.locations,l=t.systems.gfx,c=l.scene,u=t.systems.ui,d=t.systems.urlhash,f=l.events,p=(e.selection??{}).osm??[];this._newFeature=e.newFeature,this._selectedData=new Map,this._singularDatum=null,this._lastSelectedIDs=[],this._focusedParentID=e.focusedParentID;for(let m of p){let g=i.hasEntity(m);g&&(g.type==="node"&&a.blocksAt(g.loc).length||(this._selectedData.set(m,g),p.length===1&&(this._singularDatum=g)))}if(!this._selectedData.size)return!1;p=[...this._selectedData.keys()],this._active=!0,t.enableBehaviors(["hover","select","drag","mapInteraction","lasso","paste"]),u.closeEditMenu(),this.extent=Mt(p,i),c.clearClass("select");for(let m of p)c.setClass("select","osm",m);return d.setParam("id",p.join(",")),s.forceVisible(p),this._setupOperations(p),this.keybinding=Xe("select"),this.keybinding.on(["[","pgup"],this._previousVertex).on(["]","pgdown"],this._nextVertex).on(["{",Te("\u2318["),"home"],this._firstVertex).on(["}",Te("\u2318]"),"end"],this._lastVertex).on(["\\","pause"],this._focusNextParent),H(document).call(this.keybinding),f.on("keydown",this._keydown),r.on("merge",this._merge),o.on("hoverchange",this._hover),u.Sidebar.showInspector(p,this._newFeature),!0}exit(){if(!this._active)return;this._active=!1;let e=this.context,t=e.systems.editor,r=e.systems.filters,i=e.behaviors.hover,s=e.systems.l10n,o=e.systems.gfx,a=o.scene,l=e.systems.ui,c=e.systems.urlhash,u=o.events,d=t.staging.graph,f=d.hasEntity(this._singularDatum?.id);f?.type==="relation"&&Object.keys(f.tags).length===0&&d.parentRelations(f).length===0&&(f.members.length===0||f.members.length===1&&!f.members[0].role)&&(t.perform($r(f.id,!0)),t.commit({annotation:s.t("operations.delete.annotation.relation"),selectedIDs:[f.id]})),this.extent=null,this._newFeature=!1,this._singularDatum=null,this._selectedData.clear(),this._lastSelectedIDs=[];for(let h of this.operations)h.behavior&&h.behavior.disable();this.operations=[],a.clearClass("select"),l.closeEditMenu(),l.Sidebar.hide(),c.setParam("id",null),r.forceVisible([]),this.keybinding&&(H(document).call(this.keybinding.unbind),this.keybinding=null),t.off("merge",this._merge),u.off("keydown",this._keydown),i.off("hoverchange",this._hover)}_keydown(e){let t=this.context,r=t.systems.editor,i=r.staging.graph,s=t.systems.ui,o=t.viewport;if((document.activeElement?.tagName??"BODY")!=="BODY"||!t.editable())return;if((e.altKey||e.metaKey||e.ctrlKey)&&e.key==="ArrowUp"){e.preventDefault(),this._selectParentWays();return}else if((e.altKey||e.metaKey||e.ctrlKey)&&e.key==="ArrowDown"){e.preventDefault(),this._selectChildNodes();return}let l=[...this._selectedData.keys()],c=Kr(l,this._lastSelectedIDs);c||(this._lastSelectedIDs=l.slice());let u,d;if(e.shiftKey&&["ArrowLeft","ArrowRight"].includes(e.key)){e.preventDefault();let f=2*Mn,h;if(e.key==="ArrowLeft"?h=-f:e.key==="ArrowRight"&&(h=f),h){let m=Ht(l,i).map(y=>o.project(y.loc)),g;if(m.length<2)return;m.length===2?g=at(m[0],m[1],.5):pi(m).length===2?g=at(m[0],m[1],.5):g=hi(pi(m)),u=F5(t,l),d=F2(l,g,h,o)}}else if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)){e.preventDefault();let f=3,h;if(e.key==="ArrowLeft"?h=[-f,0]:e.key==="ArrowRight"?h=[f,0]:e.key==="ArrowUp"?h=[0,-f]:e.key==="ArrowDown"&&(h=[0,f]),h){let p=o.transform;p.r&&(h=lr(h,-p.r,[0,0])),u=M5(t,l),d=Ao(l,h,o)}}if(u&&d){if(!u.available())return;if(u.disabled()){s.Flash.duration(4e3).iconName(`#rapid-operation-${u.id}`).iconClass("operation disabled").label(u.tooltip)();return}let f=u.annotation(),h={annotation:f,selectedIDs:l};r.perform(d),c&&r.getUndoAnnotation()===f?r.commitAppend(h):r.commit(h);let p=r.staging.graph;this._selectedData.clear();for(let m of l)this._selectedData.set(m,p.entity(m));this._setupOperations(l)}}_merge(e){if(!(e instanceof Set))return;let t=[...this._selectedData.keys()],r=!1;for(let i of t)if(e.has(i)){r=!0;break}r&&this._setupOperations(t)}_setupOperations(e){let t=this.context,r=t.systems.ui;for(let i of this.operations)i.behavior&&i.behavior.disable();if(Array.isArray(e)&&e.length){let i={copy:1,downgrade:2,delete:3};this.operations=Object.values(dD).map(s=>s(t,e)).filter(s=>s.available()).sort((s,o)=>{let a=i[s.id]||0,l=i[o.id]||0;return a-l});for(let s of this.operations)s.behavior&&s.behavior.enable()}r.redrawEditMenu()}_chooseParentWay(e){if(!e)return null;let i=this.context.systems.editor.staging.graph;if(e.type==="way")this._focusedParentID=e.id;else{let s=i.parentWays(e).map(o=>o.id);s.length?s.includes(this._focusedParentID)||(this._focusedParentID=s[0]):this._focusedParentID=null}return i.hasEntity(this._focusedParentID)}_firstVertex(e){e.preventDefault();let t=this._chooseParentWay(this._singularDatum);if(!t)return;let r=this.context,s=r.systems.editor.staging.graph,o=r.systems.map,a=s.entity(t.first());r.enter("select-osm",{selection:{osm:[a.id]}}),o.centerEase(a.loc)}_lastVertex(e){e.preventDefault();let t=this._chooseParentWay(this._singularDatum);if(!t)return;let r=this.context,s=r.systems.editor.staging.graph,o=r.systems.map,a=s.entity(t.last());r.enter("select-osm",{selection:{osm:[a.id]}}),o.centerEase(a.loc)}_previousVertex(e){e.preventDefault();let t=this._singularDatum;if(t?.type!=="node")return;let r=this._chooseParentWay(this._singularDatum);if(!r)return;let i=r.nodes.indexOf(t.id),s=-1;if(i>0?s=i-1:r.isClosed()&&(s=r.nodes.length-2),s!==-1){let o=this.context,l=o.systems.editor.staging.graph,c=o.systems.map,u=l.entity(r.nodes[s]);o.enter("select-osm",{selection:{osm:[u.id]}}),c.centerEase(u.loc)}}_nextVertex(e){e.preventDefault();let t=this._singularDatum;if(t?.type!=="node")return;let r=this._chooseParentWay(this._singularDatum);if(!r)return;let i=r.nodes.indexOf(t.id),s=-1;if(i<r.nodes.length-1?s=i+1:r.isClosed()&&(s=0),s!==-1){let o=this.context,l=o.systems.editor.staging.graph,c=o.systems.map,u=l.entity(r.nodes[s]);o.enter("select-osm",{selection:{osm:[u.id]}}),c.centerEase(u.loc)}}_focusNextParent(e){e.preventDefault();let t=this._singularDatum;if(t?.type!=="node")return;let o=this.context.systems.editor.staging.graph.parentWays(t).map(a=>a.id);if(o.length){let l=o.indexOf(this._focusedParentID)+1;l>=o.length&&(l=0),this._focusedParentID=o[l]}}_selectParentWays(){let e=this.context,r=e.systems.editor.staging.graph,i=new Set;for(let s of this._selectedData.values())if(s.type==="node")for(let o of r.parentWays(s))i.add(o.id);i.size&&e.enter("select-osm",{selection:{osm:[...i]},focusedParentID:this._focusedParentID})}_selectChildNodes(){let e=this.context,t=new Set;for(let r of this._selectedData.values())if(r.type==="way")for(let i of r.nodes)t.add(i);t.size&&e.enter("select-osm",{selection:{osm:[...t]},focusedParentID:this._focusedParentID})}_hover(e){let t=this.context,i=t.systems.editor.staging.graph,s=t.systems.gfx.events,a=e.target?.data;switch((a&&i.hasEntity(a.id))?.geometry(i)??"unknown"){case"area":s.setCursor("areaCursor");break;case"line":s.setCursor("lineCursor");break;case"point":s.setCursor("pointCursor");break;case"unknown":s.setCursor("selectSplitCursor");break;case"vertex":s.setCursor("vertexCursor");break;default:s.setCursor("grab");break}}};var ui={available:new Map};ui.available.set("add-note",N5);ui.available.set("add-point",O5);ui.available.set("browse",L5);ui.available.set("drag-node",U5);ui.available.set("drag-note",G5);ui.available.set("draw-area",$5);ui.available.set("draw-line",z5);ui.available.set("move",H5);ui.available.set("rotate",W5);ui.available.set("save",V5);ui.available.set("select",j5);ui.available.set("select-osm",X5);var koe="bdf6c800b3ae453b9db239e03d7c1727",GV="https://openstreetmap.maps.arcgis.com/sharing/rest/content",Ioe="https://openstreetmap.maps.arcgis.com/home",Poe=14,q5=class extends Se{constructor(e){super(e),this.id="esri",this.context=e,this._tiler=new or().zoomRange(Poe),this._datasets={},this._initPromise=null,this._datasetsPromise=null}initAsync(){return this._initPromise?this._initPromise:this._initPromise=this.resetAsync().then(()=>this._loadDatasetsAsync())}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of Object.values(this._datasets))e.cache.inflight&&Object.values(e.cache.inflight).forEach(t=>this._abortRequest(t)),e.graph=new Fr,e.tree=new zi(e.graph),e.cache={inflight:{},loaded:{},seen:{}},e.lastv=null;return Promise.resolve()}getAvailableDatasets(){return Object.values(this._datasets).map(e=>{let t=new Set(["esri"]);for(let i of e.groupCategories)t.add(i.toLowerCase().replace("/categories/",""));let r=new Hi(this.context,{id:e.id,conflated:!1,service:"esri",categories:t,dataUsed:["esri",this.getDataUsed(e.title)],label:e.title,description:e.snippet,itemUrl:`${Ioe}/item.html?id=${e.id}`,licenseUrl:"https://wiki.openstreetmap.org/wiki/Esri/ArcGIS_Datasets#License",thumbnailUrl:`${GV}/items/${e.id}/info/${e.thumbnail}?w=400`});return e.extent&&(r.extent=new le(e.extent[0],e.extent[1])),t.has("buildings")&&(r.conflated=!0,r.service="mapwithai"),r})}getData(e){let t=this._datasets[e];if(!t||!t.tree||!t.graph)return[];let r=this.context.viewport.visibleExtent();return t.tree.intersects(r,t.graph)}graph(e){return this._datasets[e]?.graph}getDataUsed(e){return e.startsWith("Google Buildings for")?"Google Open Buildings":e}loadTiles(e){if(this._paused)return;let t=this._datasets[e];if(!t)throw new Error(`Unknown datasetID: ${e}`);if(!t.layer){this._loadDatasetLayerAsync(t).then(()=>this.loadTiles(e));return}let r=t.cache,i=this.context.systems.locations,s=this.context.viewport;if(t.lastv===s.v)return;t.lastv=s.v;let o=this._tiler.getTiles(s).tiles;for(let a of Object.keys(r.inflight))o.find(c=>c.id===a)||(this._abortRequest(r.inflight[a]),delete r.inflight[a]);for(let a of o){if(r.loaded[a.id]||r.inflight[a.id])continue;if(a.wgs84Extent.polygon().slice(0,4).every(u=>i.blocksAt(u).length)){r.loaded[a.id]=!0;continue}this._loadTilePage(t,a,0)}}_loadDatasetsAsync(){return this._datasetsPromise?this._datasetsPromise:this._datasetsPromise=new Promise((e,t)=>{let r=i=>{fetch(this._searchURL(i)).then(Ae).then(s=>{for(let o of s.results??[])this._parseDataset(o);s.nextStart>0?r(s.nextStart):e(this._datasets)}).catch(s=>{t(s)})};r(1)})}_parseDataset(e){if(this._datasets[e.id])return;this._datasets[e.id]=e,e.graph=new Fr,e.tree=new zi(e.graph),e.cache={inflight:{},loaded:{},seen:{}},e.lastv=null,e.layer=null;let t=H(document.createElement("div"));t.html(e.licenseInfo),t.selectAll("*").attr("style",null).attr("size",null),e.license_html=t.html()}_loadDatasetLayerAsync(e){return!e||!e.url?Promise.reject("No dataset"):e.layer?Promise.resolve(e.layer):fetch(this._layerURL(e.url)).then(Ae).then(t=>{if(!t.layers||!t.layers.length)throw new Error(`Missing layer info for datasetID: ${e.id}`);e.layer=t.layers[0];let r={};for(let i of e.layer.fields)i.type==="esriFieldTypeOID"&&(e.layer.idfield=i.name),i.editable&&(r[i.name]=i.alias);return e.layer.tagmap=r,e.layer}).catch(t=>{t.name!=="AbortError"&&console.error(t)})}_abortRequest(e){e.abort()}_searchURL(e){let t={f:"json",sortField:"title",sortOrder:"asc",num:100,start:e};return`${GV}/groups/${koe}/search?`+ft(t)}_layerURL(e){return`${e}/layers?f=json`}_tileURL(e,t,r){r=r||0;let i=e.layer.id,s=e.layer.maxRecordCount||2e3,o=s*r,a={f:"geojson",outfields:"*",outSR:4326,geometryType:"esriGeometryEnvelope",geometry:t.toParam(),resultOffset:o,resultRecordCount:s};return`${e.url}/${i}/query?`+ft(a)}_loadTilePage(e,t,r){let i=e.cache;if(i.loaded[t.id])return;let s=new AbortController,o=this._tileURL(e,t.wgs84Extent,r);fetch(o,{signal:s.signal}).then(Ae).then(a=>{if(!a)throw new Error("no geojson");return this._parseTile(e,t,a,(l,c)=>{if(l)throw new Error(l);e.graph.rebase(c,[e.graph],!0),e.tree.rebase(c,!0)}),a.properties?.exceededTransferLimit}).then(a=>{a?this._loadTilePage(e,t,++r):(i.loaded[t.id]=!0,delete i.inflight[t.id],this.context.systems.gfx.deferredRedraw(),this.emit("loadedData"))}).catch(a=>{a.name!=="AbortError"&&console.error(a)}),i.inflight[t.id]=s}_parseTile(e,t,r,i){if(!r)return i({message:"No GeoJSON",status:-1});let s=[];for(let o of r.features??[]){let a=this._parseFeature(o,e);a&&s.push.apply(s,a)}i(null,s)}_parseFeature(e,t){let r=e.geometry,i=e.properties;if(!r||!i)return null;let s=i[t.layer.idfield]||i.OBJECTID||i.FID||i.id;if(!s||t.cache.seen[s])return null;t.cache.seen[s]=!0;let a={__fbid__:`${t.id}-${s}`,__service__:"esri",__datasetid__:t.id},l=[],c=new Map;if(r.type==="Point")return[new Le({loc:r.coordinates,tags:d(i)},a)];if(r.type==="LineString"){let h=u(r.coordinates);if(h.length<2)return null;let p=new Rt({nodes:h,tags:d(i)},a);return l.push(p),l}else if(r.type==="Polygon"){let h=[];for(let p of r.coordinates??[]){let m=u(p);if(m.length<3)continue;let g=m[0],y=m[m.length-1];g!==y&&m.push(g);let x=new Rt({nodes:m});h.push(x)}if(h.length===1)l.push(h[0].update(Object.assign({tags:d(i)},a)));else{let p=h.map((y,x)=>(l.push(y),{id:y.id,role:x===0?"outer":"inner",type:"way"})),m=Object.assign(d(i),{type:"multipolygon"}),g=new mr({members:p,tags:m},a);l.push(g)}return l}function u(h){let p=[];for(let m of h){let g=m.toString(),y=c.get(g);y||(y=new Le({loc:m}),l.push(y),c.set(g,y)),p.push(y.id)}return p}function d(h){let p={};for(let g of Object.keys(h)){let y=f(t.layer.tagmap[g]),x=f(h[g]);y&&x&&(p[y]=x)}let m=`${t.name}`;return m.startsWith("Google_Buildings_for")&&(m="Google_Open_Buildings"),p.source=`esri/${m}`,p}function f(h){return h?h.toString().trim():null}}};var Doe="https://kartaview.org",Moe="https://api.openstreetcam.org",$V=1e3,Roe=14,Y5=class extends Se{constructor(e){super(e),this.id="kartaview",this.autoStart=!1,this._imgZoom=Gf().extent([[0,0],[320,240]]).translateExtent([[0,0],[320,240]]).scaleExtent([1,15]),this._hires=!1,this._cache={},this._startPromise=null,this._tiler=new or().zoomRange(Roe).skipNullIsland(!0),this._lastv=null,this._zoomPan=this._zoomPan.bind(this)}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,t=e.systems.ui,i=e.container().select(".photoviewer .middle-middle").selectAll(".osc-wrapper").data([0]).enter().append("div").attr("class","photo-wrapper osc-wrapper").classed("hide",!0).call(this._imgZoom.on("zoom",this._zoomPan)).on("dblclick.zoom",null),s=i.append("div").attr("class","photo-footer");s.append("div").attr("class","photo-options"),s.append("div").attr("class","photo-attribution");let o=i.append("div").attr("class","photo-controls-wrap").append("div").attr("class","photo-controls");return o.append("button").on("click.back",()=>this._step(-1)).call(X("#fas-backward-step")),o.append("button").on("click.rotate-ccw",()=>this._rotate(-90)).call(X("#fas-arrow-rotate-left")),o.append("button").on("click.rotate-cw",()=>this._rotate(90)).call(X("#fas-arrow-rotate-right")),o.append("button").on("click.forward",()=>this._step(1)).call(X("#fas-forward-step")),i.append("div").attr("class","osc-image-wrap"),t.PhotoViewer.on("resize",a=>{this._imgZoom=Gf().extent([[0,0],a]).translateExtent([[0,0],a]).scaleExtent([1,15]).on("zoom",this._zoomPan)}),this._started=!0,this._startPromise=Promise.resolve()}resetAsync(){if(this._cache.inflight)for(let e of this._cache.inflight.values())e.controller.abort();return this._cache={inflight:new Map,loaded:new Set,nextPage:new Map,images:new Map,sequences:new Map,rbush:new Tt},this._lastv=null,Promise.resolve()}getImages(){let e=this.context.viewport.visibleExtent();return this._cache.rbush.search(e.bbox()).map(t=>t.data)}getSequences(){let e=this.context.viewport.visibleExtent(),t=new Set;for(let i of this._cache.rbush.search(e.bbox()))i.data.sequenceID&&t.add(i.data.sequenceID);let r=[];for(let i of t){let s=this._cache.sequences.get(i);if(!s)continue;let o=s?.images??[];if(!o.length)continue;let a=o.find(l=>l);r.push({type:"LineString",properties:{type:"sequence",id:i,v:s.v,isPano:a.isPano,captured_at:a.captured_at,captured_by:a.captured_by},coordinates:o.map(l=>l.loc).filter(Boolean)})}return r}loadTiles(){let e=this.context.viewport;if(this._lastv===e.v)return;this._lastv=e.v;let t=this._tiler.getTiles(e).tiles;for(let[r,i]of this._cache.inflight)t.find(o=>r.indexOf(o.id)===0)||i.controller.abort();for(let r of t)this._loadNextTilePageAsync(r)}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.osc-wrapper.hide").size()&&(e.selectAll(".photo-wrapper:not(.osc-wrapper)").classed("hide",!0),e.selectAll(".photo-wrapper.osc-wrapper").classed("hide",!1))}hideViewer(){let e=this.context;e.systems.photos.selectPhoto(null),e.container().select(".photoviewer").classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),this.emit("imageChanged")}selectImageAsync(e){if(!e)return this._updatePhotoFooter(null),Promise.resolve();let t=this.context,r=this._cache;return this.startAsync().then(()=>this._loadImageAsync(e)).then(i=>{let s=t.container().select(".photoviewer .osc-wrapper"),o=s.selectAll(".osc-image-wrap");s.transition().duration(100).call(this._imgZoom.transform,mo),o.selectAll(".osc-image").remove();let l=r.sequences.get(i.sequenceID)?.rotation??0;return o.append("img").attr("class","osc-image").attr("src",this._hires?i.imageHighUrl:i.imageMedUrl).style("transform",`rotate(${l}deg)`),this._updatePhotoFooter(i.id),i})}_updatePhotoFooter(e){let t=this.context,r=t.systems.l10n,i=t.systems.photos,s=t.container().select(".photoviewer .osc-wrapper"),a=s.selectAll(".photo-options").selectAll(".hires").data([0]),l=a.enter().append("label").attr("for","osc-hires-input").attr("class","hires");l.append("input").attr("type","checkbox").attr("id","osc-hires-input").on("click",f=>{f.stopPropagation(),this._hires=!this._hires,this.selectImageAsync(i.currPhotoID)}),l.append("span"),a=a.merge(l),a.selectAll("#osc-hires-input").property("checked",this._hires),a.selectAll("span").text(r.t("photos.hires"));let c=s.selectAll(".photo-attribution").html("&nbsp;"),u=this._cache.images.get(e);if(!u)return;u.captured_by&&(c.append("span").attr("class","captured_by").text(u.captured_by),c.append("span").text("|")),u.captured_at&&(c.append("span").attr("class","captured_at").text(d(u.captured_at)),c.append("span").text("|")),c.append("a").attr("class","image-link").attr("target","_blank").attr("href",`https://kartaview.org/details/${u.sequenceID}/${u.sequenceIndex}/track-info`).text("kartaview.org");function d(f){if(!f)return null;let h={day:"numeric",month:"short",year:"numeric"},p=new Date(f);if(isNaN(p.getTime()))return null;let m=t.systems.l10n.localeCode();return p.toLocaleDateString(m,h)}}_maxPageAtZoom(e){return e<15?2:e<16?5:e<17?10:e<18?20:e<19?40:80}_loadNextTilePageAsync(e){let t=this.context,r=this._cache,i=e.wgs84Extent.bbox(),s=t.viewport.transform.zoom,o=this._maxPageAtZoom(s),a=r.nextPage.get(e.id)??1;if(a>o)return Promise.resolve();let l=`${e.id},${a}`;if(r.loaded.has(l)||r.inflight.has(l))return Promise.resolve();let c=ft({ipp:$V,page:a,bbTopLeft:[i.maxY,i.minX].join(","),bbBottomRight:[i.minY,i.maxX].join(",")},!0),u=new AbortController,d=`${Doe}/1.0/list/nearby-photos/`,f={method:"POST",signal:u.signal,body:c,headers:{"Content-Type":"application/x-www-form-urlencoded"}},h=fetch(d,f).then(Ae).then(p=>{r.loaded.add(l);let m=p?.currentPageItems||[];if(!m.length)return;for(let y of m){let x=y.id.toString(),b=y.sequence_id.toString(),_=this._cacheImage(r,{id:x,sequenceID:b,loc:[+y.lng,+y.lat],ca:parseFloat(y.heading??y.headers),isPano:y.field_of_view==="360",captured_by:y.username,captured_at:y.shot_date??y.date_added,sequenceIndex:parseInt(y.sequence_index,10)}),S=r.sequences.get(b);S||(S={type:"sequence",id:b,rotation:0,images:[],v:0},r.sequences.set(b,S)),S.images[_.sequenceIndex]=_,S.v++}t.systems.gfx.deferredRedraw(),this.emit("loadedData"),m.length===$V?(r.nextPage.set(e.id,a+1),this._loadNextTilePageAsync(e)):r.nextPage.set(e.id,1/0)}).catch(p=>{p.name!=="AbortError"&&p instanceof Error&&console.error(p)}).finally(()=>{r.inflight.delete(l)});return r.inflight.set(l,{promise:h,controller:u}),h}_loadImageAsync(e){let t=this.context,r=this._cache,i=r.images.get(e);if(i?.imageLowUrl)return Promise.resolve(i);let s=`${Moe}/2.0/photo/${e}`;return fetch(s).then(Ae).then(o=>{let a=o?.result?.data;if(!a)throw new Error(`Image ${e} not found`);let l=a.sequenceId.toString(),c=this._cacheImage(r,{id:e,sequenceID:l,loc:[+a.lng,+a.lat],ca:parseFloat(a.heading??a.headers),isPano:a.fieldOfView==="360",captured_at:a.shotDate??a.dateAdded,sequenceIndex:parseInt(a.sequenceIndex,10),imageLowUrl:a.imageThUrl,imageMedUrl:a.imageLthUrl,imageHighUrl:a.imageProcUrl}),u=r.sequences.get(l);return u||(u={type:"sequence",id:l,rotation:0,images:[],v:0},r.sequences.set(l,u)),u.images[c.sequenceIndex]=c,u.v++,t.systems.gfx.deferredRedraw(),this.emit("loadedData"),c}).catch(o=>{o instanceof Error&&console.error(o)})}_zoomPan(e){let t=e.transform,i=this.context.container().select(".photoviewer .osc-image-wrap");i.size()&&fa(i.node(),t.x,t.y,t.k)}_rotate(e){let t=this.context,r=t.systems.photos,i=this._cache.images.get(r.currPhotoID);if(!i)return;let s=this._cache.sequences.get(i.sequenceID);if(!s)return;let o=s.rotation||0;o+=e,o>180&&(o-=360),o<-180&&(o+=360),s.rotation=o;let a=t.container().select(".photoviewer .osc-wrapper");a.transition().duration(100).call(this._imgZoom.transform,mo),a.selectAll(".osc-image").transition().duration(100).style("transform",`rotate(${o}deg)`)}_step(e){let r=this.context.systems.photos,i=this._cache.images.get(r.currPhotoID);if(!i)return;let s=this._cache.sequences.get(i.sequenceID);if(!s)return;let o=i.sequenceIndex+e,a=s.images[o];a&&(r.selectPhoto("kartaview",a.id),this.emit("imageChanged"))}_cacheImage(e,t){let r=e.images.get(t.id);if(!r){r={type:"photo",service:"kartaview",id:t.id,loc:t.loc},e.images.set(r.id,r);let[s,o]=t.loc;e.rbush.insert({minX:s,minY:o,maxX:s,maxY:o,data:r})}let i=!isNaN(t.ca)&&isFinite(t.ca);return t.sequenceID&&(r.sequenceID=t.sequenceID),t.sequenceIndex&&(r.sequenceIndex=t.sequenceIndex),t.captured_at&&(r.captured_at=t.captured_at),t.captured_by&&(r.captured_by=t.captured_by),i&&(r.ca=t.ca),t.isPano&&(r.isPano=t.isPano),t.imageLowUrl&&(r.imageLowUrl=t.imageLowUrl),t.imageMedUrl&&(r.imageMedUrl=t.imageMedUrl),t.imageHighUrl&&(r.imageHighUrl=t.imageHighUrl),r}};var gD="https://www.keepright.at",Foe=14,Boe=[30,40,50,60,70,90,100,110,120,130,150,160,170,180,190,191,192,193,194,195,196,197,198,200,201,202,203,204,205,206,207,208,210,220,230,231,232,270,280,281,282,283,284,285,290,291,292,293,294,295,296,297,298,300,310,311,312,313,320,350,360,370,380,390,400,401,402,410,411,412,413],gn=new Map;["20","40","210","270","310","320","350"].forEach(n=>gn.set(n,16777113));["60","70","90","100","110","150","220","380"].forEach(n=>gn.set(n,5627136));["360","370","410"].forEach(n=>gn.set(n,16751035));gn.set("50",16777113);gn.set("120",13382485);gn.set("130",16755251);gn.set("160",12281344);gn.set("170",16776960);gn.set("180",11193582);gn.set("190",16724787);gn.set("200",16629615);gn.set("230",12281344);gn.set("280",6244256);gn.set("290",11193582);gn.set("300",39168);gn.set("390",39168);gn.set("400",13382485);var K5=class extends Se{constructor(e){super(e),this.id="keepRight",this.autoStart=!1,this._krData={errorTypes:{},localizeStrings:{}},this._cache=null,this._tiler=new or().zoomRange(Foe).skipNullIsland(!0),this._lastv=null}initAsync(){return this.resetAsync()}startAsync(){return this.context.systems.assets.loadAssetAsync("qa_data").then(t=>{this._krData=t.keepRight,this._started=!0})}resetAsync(){return this._cache&&Object.values(this._cache.inflightTile).forEach(e=>this._abortRequest(e)),this._cache={data:{},loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rbush:new Tt},this._lastv=null,Promise.resolve()}getData(){let e=this.context.viewport.visibleExtent();return this._cache.rbush.search(e.bbox()).map(t=>t.data)}loadTiles(){let e={format:"geojson",ch:Boe},t=this.context.viewport;if(this._lastv===t.v)return;this._lastv=t.v;let r=this._tiler.getTiles(t).tiles;this._abortUnwantedRequests(this._cache,r);for(let i of r){if(this._cache.loadedTile[i.id]||this._cache.inflightTile[i.id])continue;let[s,o,a,l]=i.wgs84Extent.rectangle(),c=Object.assign({},e,{left:s,bottom:l,right:a,top:o}),u=`${gD}/export.php?`+ft(c),d=new AbortController;this._cache.inflightTile[i.id]=d,fetch(u,{signal:d.signal}).then(Ae).then(f=>{if(delete this._cache.inflightTile[i.id],this._cache.loadedTile[i.id]=!0,!f||!f.features||!f.features.length)throw new Error("No Data");for(let p of f.features){let{properties:{error_type:m,error_id:g,comment:y=null,object_id:x,object_type:b,schema:_,title:S}}=p,{geometry:{coordinates:C},properties:{description:k=""}}=p,v=this._krData.errorTypes[m],w=(Math.floor(m/10)*10).toString(),A=v?m:w,E=this._krData.errorTypes[A];switch(A){case"170":k=`This feature has a FIXME tag: ${k}`;break;case"292":case"293":k=k.replace("A turn-","This turn-");break;case"294":case"295":case"296":case"297":case"298":k=`This turn-restriction~${k}`;break;case"300":k="This highway is missing a maxspeed tag";break;case"411":case"412":case"413":k=`This feature~${k}`;break}C=this._preventCoincident(this._cache.rbush,C);let I=new Qe(this,m,g,{loc:C,comment:y,description:k,whichType:A,parentIssueType:w,severity:E.severity||"error",objectId:x,objectType:b,schema:_,title:S});I.replacements=this._tokenReplacements(I),this._cache.data[g]=I,this._cache.rbush.insert(this._encodeIssueRBush(I))}this.context.systems.gfx.deferredRedraw(),this.emit("loadedData")}).catch(()=>{delete this._cache.inflightTile[i.id],this._cache.loadedTile[i.id]=!0})}}postUpdate(e,t){if(this._cache.inflightPost[e.id])return t({message:"Error update already inflight",status:-2},e);let r={schema:e.schema,id:e.id};e.newStatus&&(r.st=e.newStatus),e.newComment!==void 0&&(r.co=e.newComment);let i=`${gD}/comment.php?`+ft(r),s=new AbortController;this._cache.inflightPost[e.id]=s,fetch(i,{signal:s.signal}).then(Ae).finally(()=>{delete this._cache.inflightPost[e.id],e.newStatus==="ignore"?this.removeItem(e):e.newStatus==="ignore_t"?(this.removeItem(e),this._cache.closed[`${e.schema}:${e.id}`]=!0):e=this.replaceItem(e.update({comment:e.newComment,newComment:void 0,newState:void 0})),t&&t(null,e)})}getError(e){return this._cache.data[e]}getColor(e){return gn.get(e)??16777215}replaceItem(e){return!(e instanceof Qe)||!e.id?null:(this._cache.data[e.id]=e,this._updateRBush(this._encodeIssueRBush(e),!0),e)}removeItem(e){!(e instanceof Qe)||!e.id||(delete this._cache.data[e.id],this._updateRBush(this._encodeIssueRBush(e),!1))}issueURL(e){return`${gD}/report_map.php?schema=${e.schema}&error=${e.id}`}getClosedIDs(){return Object.keys(this._cache.closed).sort()}_abortRequest(e){e&&e.abort()}_abortUnwantedRequests(e,t){Object.keys(e.inflightTile).forEach(r=>{t.find(s=>r===s.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])})}_encodeIssueRBush(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRBush(e,t){this._cache.rbush.remove(e,(r,i)=>r.data.id===i.data.id),t&&this._cache.rbush.insert(e)}_preventCoincident(e,t){for(let r=0;;r++){t=Me(t,[0,r*1e-5]);let i={minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]};if(!e.collides(i))return t}}_tokenReplacements(e){if(!(e instanceof Qe))return;let t=this.context.systems.l10n,r=new RegExp(/<\/[a-z][\s\S]*>/),i={},s=this._krData.errorTypes[e.whichType];if(!s){console.log("No Template: ",e.whichType),console.log("  ",e.description);return}if(!s.regex)return;let o=new RegExp(s.regex,"i"),a=o.exec(e.description);if(!a){console.log("Unmatched: ",e.whichType),console.log("  ",e.description),console.log("  ",o);return}for(let l=1;l<a.length;l++){let c=a[l],u;if(u="IDs"in s?s.IDs[l-1]:"",u&&c)c=this._parseError(c,u);else if(r.test(c))c="\\"+c+"\\";else{let d=c.toLowerCase();this._krData.localizeStrings[d]&&(c=t.t("QA.keepRight.error_parts."+this._krData.localizeStrings[d]))}i["var"+l]=c}return i}_parseError(e,t){let r=this.context.systems.l10n,i=e.toLowerCase();switch(this._krData.localizeStrings[i]&&(e=r.t("QA.keepRight.error_parts."+this._krData.localizeStrings[i])),t){case"this":e=s(e);break;case"url":e=a(e);break;case"n":case"w":case"r":e=o(t+e);break;case"20":e=f(e);break;case"211":e=l(e);break;case"231":e=c(e);break;case"294":e=u(e);break;case"370":e=d(e);break}return e;function s(h){return`<a class="error_object_link">${h}</a>`}function o(h){return`<a class="error_entity_link">${h}</a>`}function a(h){return`<a class="kr_external_link" target="_blank" href="${h}">${h}</a>`}function l(h){let p=[],m=h.split(", ");for(let g of m){let y=o("n"+g.slice(1));p.push(y)}return p.join(", ")}function c(h){let p=[],m=h.split("),");for(let g of m){let y=g.match(/\#(\d+)\((.+)\)?/);y!==null&&y.length>2&&p.push(o("w"+y[1])+" "+r.t("QA.keepRight.errorTypes.231.layer",{layer:y[2]}))}return p.join(", ")}function u(h){let p=[],m=h.split(",");for(let g of m){let y=g.split(" "),x=`"${y[0]}"`,b=y[1].slice(0,1),_=y[2].slice(1);_=o(b+_),p.push(`${x} ${y[1]} ${_}`)}return p.join(", ")}function d(h){if(!h)return"";let p=h.match(/\(including the name (\'.+\')\)/);return p?.length?r.t("QA.keepRight.errorTypes.370.including_the_name",{name:p[1]}):""}function f(h){let p=[],m=h.split(",");for(let g of m){let y=o("n"+g.slice(1));p.push(y)}return p.join(", ")}}};function ra(n,e){this.x=n,this.y=e}ra.prototype={clone(){return new ra(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){let e=n.x-this.x,t=n.y-this.y;return e*e+t*t},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){let e=n[0]*this.x+n[1]*this.y,t=n[2]*this.x+n[3]*this.y;return this.x=e,this.y=t,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){let n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){let e=Math.cos(n),t=Math.sin(n),r=e*this.x-t*this.y,i=t*this.x+e*this.y;return this.x=r,this.y=i,this},_rotateAround(n,e){let t=Math.cos(n),r=Math.sin(n),i=e.x+t*(this.x-e.x)-r*(this.y-e.y),s=e.y+r*(this.x-e.x)+t*(this.y-e.y);return this.x=i,this.y=s,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ra};ra.convert=function(n){if(n instanceof ra)return n;if(Array.isArray(n))return new ra(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new ra(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var tv=class{constructor(e,t,r,i,s){this.properties={},this.extent=r,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=s,e.readFields(Noe,this,t)}loadGeometry(){let e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,r=[],i,s=1,o=0,a=0,l=0;for(;e.pos<t;){if(o<=0){let c=e.readVarint();s=c&7,o=c>>3}if(o--,s===1||s===2)a+=e.readSVarint(),l+=e.readSVarint(),s===1&&(i&&r.push(i),i=[]),i&&i.push(new ra(a,l));else if(s===7)i&&i.push(i[0].clone());else throw new Error(`unknown command ${s}`)}return i&&r.push(i),r}bbox(){let e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,r=1,i=0,s=0,o=0,a=1/0,l=-1/0,c=1/0,u=-1/0;for(;e.pos<t;){if(i<=0){let d=e.readVarint();r=d&7,i=d>>3}if(i--,r===1||r===2)s+=e.readSVarint(),o+=e.readSVarint(),s<a&&(a=s),s>l&&(l=s),o<c&&(c=o),o>u&&(u=o);else if(r!==7)throw new Error(`unknown command ${r}`)}return[a,c,l,u]}toGeoJSON(e,t,r){let i=this.extent*Math.pow(2,r),s=this.extent*e,o=this.extent*t,a=this.loadGeometry();function l(f){return[(f.x+s)*360/i-180,360/Math.PI*Math.atan(Math.exp((1-(f.y+o)*2/i)*Math.PI))-90]}function c(f){return f.map(l)}let u;if(this.type===1){let f=[];for(let p of a)f.push(p[0]);let h=c(f);u=f.length===1?{type:"Point",coordinates:h[0]}:{type:"MultiPoint",coordinates:h}}else if(this.type===2){let f=a.map(c);u=f.length===1?{type:"LineString",coordinates:f[0]}:{type:"MultiLineString",coordinates:f}}else if(this.type===3){let f=Loe(a),h=[];for(let p of f)h.push(p.map(c));u=h.length===1?{type:"Polygon",coordinates:h[0]}:{type:"MultiPolygon",coordinates:h}}else throw new Error("unknown feature type");let d={type:"Feature",geometry:u,properties:this.properties};return this.id!=null&&(d.id=this.id),d}};tv.types=["Unknown","Point","LineString","Polygon"];function Noe(n,e,t){n===1?e.id=t.readVarint():n===2?Ooe(t,e):n===3?e.type=t.readVarint():n===4&&(e._geometry=t.pos)}function Ooe(n,e){let t=n.readVarint()+n.pos;for(;n.pos<t;){let r=e._keys[n.readVarint()],i=e._values[n.readVarint()];e.properties[r]=i}}function Loe(n){let e=n.length;if(e<=1)return[n];let t=[],r,i;for(let s=0;s<e;s++){let o=Uoe(n[s]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(r&&t.push(r),r=[n[s]]):r&&r.push(n[s]))}return r&&t.push(r),t}function Uoe(n){let e=0;for(let t=0,r=n.length,i=r-1,s,o;t<r;i=t++)s=n[t],o=n[i],e+=(o.x-s.x)*(s.y+o.y);return e}var yD=class{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Goe,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let t=this._pbf.readVarint()+this._pbf.pos;return new tv(this._pbf,t,this.extent,this._keys,this._values)}};function Goe(n,e,t){n===15?e.version=t.readVarint():n===1?e.name=t.readString():n===5?e.extent=t.readVarint():n===2?e._features.push(t.pos):n===3?e._keys.push(t.readString()):n===4&&e._values.push($oe(t))}function $oe(n){let e=null,t=n.readVarint()+n.pos;for(;n.pos<t;){let r=n.readVarint()>>3;e=r===1?n.readString():r===2?n.readFloat():r===3?n.readDouble():r===4?n.readVarint64():r===5?n.readVarint():r===6?n.readSVarint():r===7?n.readBoolean():null}return e}var H1=class{constructor(e,t){this.layers=e.readFields(zoe,{},t)}};function zoe(n,e,t){if(n===3){let r=new yD(t,t.readVarint()+t.pos);r.length&&(e[r.name]=r)}}var zV=23283064365386963e-26,Hoe=12,HV=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),xD=0,rv=1,Q5=2,nv=5,xc=class{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,r=this.length){for(;this.pos<r;){let i=this.readVarint(),s=i>>3,o=this.pos;this.type=i&7,e(s,t,this),this.pos===o&&this.skip(i)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){let e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){let e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readSFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readFloat(){let e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){let e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){let t=this.buf,r,i;return i=t[this.pos++],r=i&127,i<128||(i=t[this.pos++],r|=(i&127)<<7,i<128)||(i=t[this.pos++],r|=(i&127)<<14,i<128)||(i=t[this.pos++],r|=(i&127)<<21,i<128)?r:(i=t[this.pos],r|=(i&15)<<28,Woe(r,e,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){let e=this.readVarint();return e%2===1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){let e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=Hoe&&HV?HV.decode(this.buf.subarray(t,e)):nae(this.buf,t,e)}readBytes(){let e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){let r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===Q5?this.readVarint()+this.pos:this.pos+1}skip(e){let t=e&7;if(t===xD)for(;this.buf[this.pos++]>127;);else if(t===Q5)this.pos=this.readVarint()+this.pos;else if(t===nv)this.pos+=4;else if(t===rv)this.pos+=8;else throw new Error(`Unimplemented type: ${t}`)}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){let r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*zV),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*zV),!0),this.pos+=8}writeVarint(e){if(e=+e||0,e>268435455||e<0){Voe(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))}writeSVarint(e){this.writeVarint(e<0?-e*2-1:e*2)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(e.length*4),this.pos++;let t=this.pos;this.pos=iae(this.buf,e,this.pos);let r=this.pos-t;r>=128&&WV(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){let t=e.length;this.writeVarint(t),this.realloc(t);for(let r=0;r<t;r++)this.buf[this.pos++]=e[r]}writeRawMessage(e,t){this.pos++;let r=this.pos;e(t,this);let i=this.pos-r;i>=128&&WV(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i}writeMessage(e,t,r){this.writeTag(e,Q5),this.writeRawMessage(t,r)}writePackedVarint(e,t){t.length&&this.writeMessage(e,qoe,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,Yoe,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,Zoe,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,Koe,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,Qoe,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,Joe,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,eae,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,tae,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,rae,t)}writeBytesField(e,t){this.writeTag(e,Q5),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,nv),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,nv),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,rv),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,rv),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,xD),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,xD),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,Q5),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,nv),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,rv),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function Woe(n,e,t){let r=t.buf,i,s;if(s=r[t.pos++],i=(s&112)>>4,s<128||(s=r[t.pos++],i|=(s&127)<<3,s<128)||(s=r[t.pos++],i|=(s&127)<<10,s<128)||(s=r[t.pos++],i|=(s&127)<<17,s<128)||(s=r[t.pos++],i|=(s&127)<<24,s<128)||(s=r[t.pos++],i|=(s&1)<<31,s<128))return sh(n,i,e);throw new Error("Expected varint not more than 10 bytes")}function sh(n,e,t){return t?e*4294967296+(n>>>0):(e>>>0)*4294967296+(n>>>0)}function Voe(n,e){let t,r;if(n>=0?(t=n%4294967296|0,r=n/4294967296|0):(t=~(-n%4294967296),r=~(-n/4294967296),t^4294967295?t=t+1|0:(t=0,r=r+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),joe(t,r,e),Xoe(r,e)}function joe(n,e,t){t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos]=n&127}function Xoe(n,e){let t=(n&7)<<4;e.buf[e.pos++]|=t|((n>>>=3)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127)))))}function WV(n,e,t){let r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(r);for(let i=t.pos-1;i>=n;i--)t.buf[i+r]=t.buf[i]}function qoe(n,e){for(let t=0;t<n.length;t++)e.writeVarint(n[t])}function Yoe(n,e){for(let t=0;t<n.length;t++)e.writeSVarint(n[t])}function Koe(n,e){for(let t=0;t<n.length;t++)e.writeFloat(n[t])}function Qoe(n,e){for(let t=0;t<n.length;t++)e.writeDouble(n[t])}function Zoe(n,e){for(let t=0;t<n.length;t++)e.writeBoolean(n[t])}function Joe(n,e){for(let t=0;t<n.length;t++)e.writeFixed32(n[t])}function eae(n,e){for(let t=0;t<n.length;t++)e.writeSFixed32(n[t])}function tae(n,e){for(let t=0;t<n.length;t++)e.writeFixed64(n[t])}function rae(n,e){for(let t=0;t<n.length;t++)e.writeSFixed64(n[t])}function nae(n,e,t){let r="",i=e;for(;i<t;){let s=n[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a>t)break;let l,c,u;a===1?s<128&&(o=s):a===2?(l=n[i+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=n[i+1],c=n[i+2],(l&192)===128&&(c&192)===128&&(o=(s&15)<<12|(l&63)<<6|c&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=n[i+1],c=n[i+2],u=n[i+3],(l&192)===128&&(c&192)===128&&(u&192)===128&&(o=(s&15)<<18|(l&63)<<12|(c&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),i+=a}return r}function iae(n,e,t){for(let r=0,i,s;r<e.length;r++){if(i=e.charCodeAt(r),i>55295&&i<57344)if(s)if(i<56320){n[t++]=239,n[t++]=191,n[t++]=189,s=i;continue}else i=s-55296<<10|i-56320|65536,s=null;else{i>56319||r+1===e.length?(n[t++]=239,n[t++]=191,n[t++]=189):s=i;continue}else s&&(n[t++]=239,n[t++]=191,n[t++]=189,s=null);i<128?n[t++]=i:(i<2048?n[t++]=i>>6|192:(i<65536?n[t++]=i>>12|224:(n[t++]=i>>18|240,n[t++]=i>>12&63|128),n[t++]=i>>6&63|128),n[t++]=i&63|128)}return t}var W1="MLY|3376030635833192|f13ab0bdf6b2f7b99e0d8bd5868e1d88",bD="https://graph.mapillary.com/",_D="https://tiles.mapillary.com/maps/vtp",sae=`${_D}/mly1_public/2/{z}/{x}/{y}?access_token=${W1}`,oae=`${_D}/mly_map_feature_point/2/{z}/{x}/{y}?access_token=${W1}`,aae=`${_D}/mly_map_feature_traffic_sign/2/{z}/{x}/{y}?access_token=${W1}`,lae=14,Z5=class extends Se{constructor(e){super(e),this.id="mapillary",this.autoStart=!1,this._loadPromise=null,this._startPromise=null,this._showing=null,this._selectedImageID=null,this._cache={},this._viewer=null,this._viewerFilter=["all"],this._keydown=this._keydown.bind(this),this._tiler=new or().zoomRange(lae).skipNullIsland(!0),this.navigateForward=this.navigateForward.bind(this),this.navigateBackward=this.navigateBackward.bind(this)}_keydown(e){let t=this.context.systems.photos;if(!this.viewerShowing||t.currPhotoLayerID!=="mapillary")return;let r=document.activeElement?.tagName??"BODY",i=document.activeElement?.className.startsWith("mapillary");r!=="BODY"&&!i||(e.key==="ArrowLeft"||e.key==="ArrowDown"?this.navigateBackward():(e.key==="ArrowUp"||e.key==="ArrowRight")&&this.navigateForward())}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,t=e.systems.gfx.events,i=e.container().select(".photoviewer .middle-middle").selectAll(".mly-wrapper").data([0]).enter().append("div").attr("class","photo-wrapper mly-wrapper").attr("id","rapideditor-mly").classed("hide",!0).append("div").attr("class","photo-footer");return i.append("div").attr("class","photo-options"),i.append("div").attr("class","photo-attribution"),t.on("keydown",this._keydown),this._startPromise=this._loadAssetsAsync().then(()=>this._initViewer()).then(()=>this._started=!0).catch(s=>{s instanceof Error&&console.error(s),this._startPromise=null})}resetAsync(){if(this._cache?.inflight)for(let e of this._cache.inflight.values())e.controller.abort();return this._cache={images:{lastv:null,data:new Map,rbush:new Tt},detections:{lastv:null,data:new Map,rbush:new Tt},signs:{lastv:null},sequences:{data:new Map},segmentations:{data:new Map},inflight:new Map,loaded:new Set},Promise.resolve()}imageURL(e){let t=this.context.scene(),r=t.layers.get("mapillary-detections"),i=t.layers.get("mapillary-signs"),s="";return r?.enabled&&(s+="&mapFeature=all"),i?.enabled&&(s+="&trafficSign=all"),`https://www.mapillary.com/app/?pKey=${e}&focus=photo${s}`}getImage(e){return this._cache.images.data.get(e)}getSequence(e){return this._cache.sequences.data.get(e)}getDetection(e){return this._cache.detections.data.get(e)}getData(e){if(!["images","signs","detections"].includes(e))return[];let t=this.context.viewport.visibleExtent();if(e==="images")return this._cache.images.rbush.search(t.bbox()).map(r=>r.data);{let r=e==="signs"?"traffic_sign":"point";return this._cache.detections.rbush.search(t.bbox()).map(i=>i.data).filter(i=>i.object_type===r)}}getSequences(){let e=this.context.viewport.visibleExtent(),t=new Map;for(let r of this._cache.images.rbush.search(e.bbox())){let i=r.data.sequenceID;if(!i)continue;let s=this._cache.sequences.data.get(i);s&&(t.has(i)||t.set(i,s))}return[...t.values()]}getDetectionPresetID(e){return{"construction--barrier--temporary":"highway/construction","construction--flat--crosswalk-plain":"highway/footway","construction--flat--driveway":"amenity/parking/street-side","marking--discrete--arrow--left":"traffic_sign","marking--discrete--arrow--right":"traffic_sign","marking--discrete--arrow--split-left-or-straight":"traffic_sign","marking--discrete--arrow--split-right-or-straight":"traffic_sign","marking--discrete--arrow--straight":"traffic_sign","marking--discrete--crosswalk-zebra":"highway/footway","marking--discrete--give-way-row":"highway/give_way","marking--discrete--give-way-single":"highway/give_way","marking--discrete--other-marking":"traffic_sign","marking--discrete--stop-line":"highway/stop","marking--discrete--symbol--bicycle":"cycleway/asl","marking--discrete--text":"tourism/information","object--banner":"advertising","object--bench":"amenity/bench","object--bike-rack":"amenity/bicycle_parking","object--catch-basin":"man_made/manhole/drain","object--cctv-camera":"man_made/surveillance/camera","object--fire-hydrant":"emergency/fire_hydrant","object--junction-box":"man_made/street_cabinet","object--mailbox":"amenity/letter_box","object--manhole":"man_made/manhole","object--parking-meter":"amenity/parking/street-side","object--phone-booth":"amenity/telephone","object--sign--advertisement":"advertising/billboard","object--sign--information":"tourism/information/board","object--sign--store":"advertising","object--street-light":"highway/street_lamp","object--support--pole":"man_made/mast","object--support--traffic-sign-frame":"man_made/mast","object--support--utility-pole":"man_made/utility_pole","object--traffic-cone":"highway/construction","object--traffic-light--cyclists":"cycleway/asl","object--traffic-light--general-horizontal":"highway/traffic_signals","object--traffic-light--general-single":"highway/traffic_signals","object--traffic-light--general-upright":"highway/traffic_signals","object--traffic-light--other":"highway/traffic_signals","object--traffic-light--pedestrians":"highway/traffic_signals","object--trash-can":"amenity/waste_basket","object--water-valve":"man_made/water_tap"}[e]}loadTiles(e){if(!["images","signs","detections"].includes(e))return;let t=this.context.viewport;if(this._cache[e].lastv===t.v)return;this._cache[e].lastv=t.v;let r=this._tiler.getTiles(t).tiles;for(let i of this._cache.inflight.values()){if(!i.tileID)continue;r.find(o=>o.id===i.tileID)||i.controller.abort()}for(let i of r)this._loadTileAsync(e,i)}filterViewer(){let e=this.context.systems.photos,t=e.showsPanoramic,r=e.showsFlat,i=e.fromDate,s=e.toDate,o=["all"];return t||o.push(["!=","cameraType","spherical"]),!r&&t&&o.push(["==","pano",!0]),i&&o.push([">=","capturedAt",new Date(i).getTime()]),s&&o.push([">=","capturedAt",new Date(s).getTime()]),this._viewer&&this._viewer.setFilter(o),this._viewerFilter=o,o}navigateForward(){let e=window.mapillary.NavigationDirection.Next;this._navigate(e)}navigateBackward(){let e=window.mapillary.NavigationDirection.Prev;this._navigate(e)}_navigate(e){this._viewer.moveDir(e).catch(t=>{})}get viewerShowing(){return this._showing}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.mly-wrapper.hide").size()&&this._viewer&&(e.selectAll(".photo-wrapper:not(.mly-wrapper)").classed("hide",!0),e.selectAll(".photo-wrapper.mly-wrapper").classed("hide",!1),this._showing=!0,this._viewer.resize())}hideViewer(){let e=this.context;e.systems.photos.selectPhoto(null),this._viewer&&this._viewer.getComponent("sequence").stop(),e.container().select(".photoviewer").classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),this._showing=!1,this._selectedImageID=null,this.emit("imageChanged")}selectImageAsync(e){if(this._clearSegmentations(),!e)return this._updatePhotoFooter(null),Promise.resolve();if(this._selectedImageID===e){let t=this._cache.images.data.get(e);return this._shouldShowSegmentations()?this._loadImageSegmentationsAsync(t).then(r=>this._showSegmentations(r)).catch(r=>console.error("mly3",r)).then(()=>Promise.resolve(t)):Promise.resolve(t)}else return this.startAsync().then(()=>this._viewer.moveTo(e)).then(t=>{let r=this._cache.images,i=this._cacheImage(r,{id:t.id.toString(),loc:[t.originalLngLat.lng,t.originalLngLat.lat],sequenceID:t.sequenceId.toString(),captured_at:t.capturedAt,captured_by:t.creatorUsername,ca:t.originalCompassAngle});return this._selectedImageID=e,this._updatePhotoFooter(e),Promise.resolve(i)}).catch(t=>{t.name!=="CancelMapillaryError"&&console.error("mly3",t)})}selectDetectionAsync(e){return this._clearSegmentations(),e?this.startAsync().then(()=>this._loadDetectionAsync(e)).then(t=>this._shouldShowSegmentations()?this._loadDetectionSegmentationsAsync(t).catch(r=>console.error("mly3",r)).then(()=>Promise.resolve(t)):Promise.resolve(t)).catch(t=>console.error("mly3",t)):Promise.resolve()}_updatePhotoFooter(e){let t=this.context,i=t.container().select(".photoviewer .mly-wrapper").selectAll(".photo-attribution").html("&nbsp;"),s=this._cache.images.data.get(e);if(!s)return;s.captured_by&&(i.append("span").attr("class","captured_by").text(s.captured_by),i.append("span").text("|")),s.captured_at&&(i.append("span").attr("class","captured_at").text(o(s.captured_at)),i.append("span").text("|")),i.append("a").attr("class","image-link").attr("target","_blank").attr("href",this.imageURL(e)).text("mapillary.com");function o(a){if(!a)return null;let l={day:"numeric",month:"short",year:"numeric"},c=new Date(a);if(isNaN(c.getTime()))return null;let u=t.systems.l10n.localeCode();return c.toLocaleDateString(u,l)}}_shouldShowSegmentations(){let e=this.context.scene();return["mapillary-detections","mapillary-signs"].some(r=>{let i=e.layers.get(r);return i&&i.enabled})}_clearSegmentations(){this._viewer&&this._viewer.getComponent("tag").removeAll()}_showSegmentations(e){if(!this._viewer)return;this._clearSegmentations();let t=this._viewer.getComponent("tag");for(let r of e){let i=this._cache.segmentations.data.get(r);if(!i)continue;let s=this._makeTag(i);s&&t.add([s])}}_makeTag(e){let t=e.value.split("--");if(!t.length)return;let r,i=379747;return this.context.systems.photos.currDetectionID===e.detectionID&&(i=16776960,r=t[1],(r==="flat"||r==="discrete"||r==="sign")&&(r=t[2]),r=r.replace(/-/g," "),r=r.charAt(0).toUpperCase()+r.slice(1)),new window.mapillary.OutlineTag(e.id,e.geometry,{text:r,textColor:i,lineColor:i,lineWidth:3,fillColor:i,fillOpacity:.4})}_loadTileAsync(e,t){if(!["images","signs","detections"].includes(e))return Promise.resolve();let r={images:sae,signs:aae,detections:oae}[e];r=r.replace("{x}",t.xyz[0]).replace("{y}",t.xyz[1]).replace("{z}",t.xyz[2]);let i=this._cache;if(i.loaded.has(r))return Promise.resolve();let s=i.inflight.get(r);if(s)return s.promise;s={tileID:t.id,controller:new AbortController};let o=fetch(r,{signal:s.controller.signal}).then(Ae).then(a=>{if(i.loaded.add(r),!a)throw new Error("No Data");this._processTile(a,t),this.context.systems.gfx.deferredRedraw(),e==="images"?this.emit("loadedImages"):e==="signs"?this.emit("loadedSigns"):e==="detections"&&this.emit("loadedDetections")}).catch(a=>{a.name!=="AbortError"&&(a instanceof Error&&console.error(a),i.loaded.add(r))}).finally(()=>{i.inflight.delete(r)});return s.promise=o,i.inflight.set(r,s),o}_processTile(e,t){let r=new H1(new xc(e));if(r.layers.hasOwnProperty("image")){let i=this._cache.images,s=r.layers.image;for(let o=0;o<s.length;o++){let a=s.feature(o).toGeoJSON(t.xyz[0],t.xyz[1],t.xyz[2]);a&&this._cacheImage(i,{id:a.properties.id.toString(),loc:a.geometry.coordinates,sequenceID:a.properties.sequence_id.toString(),captured_at:a.properties.captured_at,ca:a.properties.compass_angle,isPano:a.properties.is_pano})}}if(r.layers.hasOwnProperty("sequence")){let i=this._cache.sequences,s=r.layers.sequence;for(let o=0;o<s.length;o++){let a=s.feature(o).toGeoJSON(t.xyz[0],t.xyz[1],t.xyz[2]);if(!a)continue;let l=a.properties.id.toString(),c=i.data.get(l);c||(c={type:"FeatureCollection",service:"mapillary",id:l,v:0,features:[]},i.data.set(l,c)),c.features.push(a),c.v++}}for(let i of["point","traffic_sign"]){if(!r.layers.hasOwnProperty(i))continue;let s=this._cache.detections,o=r.layers[i];for(let a=0;a<o.length;a++){let l=o.feature(a).toGeoJSON(t.xyz[0],t.xyz[1],t.xyz[2]);l&&this._cacheDetection(s,{id:l.properties.id.toString(),loc:l.geometry.coordinates,first_seen_at:l.properties.first_seen_at,last_seen_at:l.properties.last_seen_at,value:l.properties.value,object_type:i})}}}_loadDetectionAsync(e){let t=this._cache.detections.data.get(e);if(Array.isArray(t?.images))return Promise.resolve(t);let i=`${bD}/${e}?access_token=${W1}&fields=id,geometry,aligned_direction,first_seen_at,last_seen_at,object_value,object_type,images`;return fetch(i).then(Ae).then(s=>{if(!s)throw new Error("No Data");let o=s.object_type==="trafficsign"?"traffic_sign":"point",a=this._cache.detections,l=this._cacheDetection(a,{id:s.id.toString(),loc:s.geometry?.coordinates,images:s.images?.data,first_seen_at:s.first_seen_at,last_seen_at:s.last_seen_at,value:s.object_value,aligned_direction:s.aligned_direction,object_type:o});return this.context.systems.gfx.immediateRedraw(),l}).catch(s=>{s instanceof Error&&console.error(s)})}_loadImageSegmentationsAsync(e){if(e.segmentationIDs)return Promise.resolve(e.segmentationIDs);let t=e.id,i=`${bD}/${t}/detections?access_token=${W1}&fields=id,created_at,geometry,image,value`;return fetch(i).then(Ae).then(s=>{if(!s)throw new Error("No Data");let o=this._cache.segmentations;e.segmentationIDs=new Set;for(let a of s.data||[]){let l=a.id.toString();this._cacheSegmentation(o,{id:l,imageID:t,geometry:a.geometry,created_at:a.created_at,value:a.value})&&e.segmentationIDs.add(l)}return e.segmentationIDs}).catch(s=>{s instanceof Error&&console.error(s)})}_loadDetectionSegmentationsAsync(e){if(e.segmentationIDs)return Promise.resolve(e.segmentationIDs);let t=e.id,i=`${bD}/${t}/detections?access_token=${W1}&fields=id,created_at,geometry,image,value`;return fetch(i).then(Ae).then(s=>{if(!s)throw new Error("No Data");let o=this._cache.segmentations;e.segmentationIDs=new Set;for(let a of s.data||[]){let l=a.id.toString();this._cacheSegmentation(o,{id:l,detectionID:t,imageID:a.image.id.toString(),geometry:a.geometry,created_at:a.created_at,value:a.value})&&e.segmentationIDs.add(l)}return e.segmentationIDs}).catch(s=>{s instanceof Error&&console.error(s)})}_loadAssetsAsync(){return this._loadPromise?this._loadPromise:this._loadPromise=new Promise((e,t)=>{let r=this.context.systems.assets,i=0,s=()=>{++i===2&&e()},o=H("head");o.selectAll("#rapideditor-mapillary-css").data([0]).enter().append("link").attr("id","rapideditor-mapillary-css").attr("rel","stylesheet").attr("crossorigin","anonymous").attr("href",r.getAssetURL("mapillary_css")).on("load",s).on("error",t),o.selectAll("#rapideditor-mapillary-js").data([0]).enter().append("script").attr("id","rapideditor-mapillary-js").attr("crossorigin","anonymous").attr("src",r.getAssetURL("mapillary_js")).on("load",s).on("error",t)})}_initViewer(){let e=window.mapillary;if(!e)throw new Error("mapillary not loaded");if(!e.isSupported())throw new Error("mapillary not supported");let t=this.context,r=t.systems.photos,i=t.systems.ui,s={accessToken:W1,component:{attribution:!1,cover:!1,keyboard:!1,tag:!0,bearing:{size:e.ComponentSize.Automatic},zoom:{size:e.ComponentSize.Automatic}},container:"rapideditor-mly"},o=u=>{let d=u.image.id.toString();r.currPhotoID!==d&&r.selectPhoto("mapillary",d),this.emit("imageChanged")},a=u=>{this.emit("bearingChanged",u.bearing)},l=()=>{this._viewer.getFieldOfView().then(u=>{this.emit("fovChanged",u)})},c=u=>{let d=r.currPhotoID,f=this._cache.images.data.get(d);f&&this._shouldShowSegmentations()&&this._loadImageSegmentationsAsync(f).then(h=>this._showSegmentations(h)).catch(h=>console.error("mly3",h))};this._viewer=new e.Viewer(s),this._viewer.on("image",o),this._viewer.on("bearing",a),this._viewer.on("fov",l),this._viewer.on("moveend",c),this._viewerFilter&&this._viewer.setFilter(this._viewerFilter),i.PhotoViewer.on("resize",()=>{this._viewer&&this._viewer.resize()})}_cacheImage(e,t){let r=e.data.get(t.id);if(!r){r={type:"photo",service:"mapillary",id:t.id,loc:t.loc},e.data.set(r.id,r);let[s,o]=t.loc;e.rbush.insert({minX:s,minY:o,maxX:s,maxY:o,data:r})}let i=!isNaN(t.ca)&&isFinite(t.ca);return t.sequenceID&&(r.sequenceID=t.sequenceID),t.captured_at&&(r.captured_at=t.captured_at),t.captured_by&&(r.captured_by=t.captured_by),i&&(r.ca=t.ca),t.isPano&&(r.isPano=t.isPano),r}_cacheDetection(e,t){let r=e.data.get(t.id);if(r||(r={type:"detection",service:"mapillary",id:t.id,object_type:t.object_type},e.data.set(r.id,r)),!r.loc&&t.loc){let s=this._preventCoincident(e.rbush,t.loc);r.loc=s;let[o,a]=s;e.rbush.insert({minX:o,minY:a,maxX:o,maxY:a,data:r})}let i=!isNaN(t.aligned_direction)&&isFinite(t.aligned_direction);if(t.images&&(r.images=t.images),t.first_seen_at&&(r.first_seen_at=t.first_seen_at),t.last_seen_at&&(r.last_seen_at=t.last_seen_at),t.value&&(r.value=t.value),i&&(r.aligned_direction=t.aligned_direction),!r.bestImageID&&r.loc&&r.images){let s=1/0,o=null;for(let a of r.images){let l=ht(r.loc,a.geometry.coordinates);l<s&&(s=l,o=a.id)}r.bestImageID=o}return r}_cacheSegmentation(e,t){let r=this.getDetectionPresetID(t.value),i=/^(regulatory|information|warning|complementary)/.test(t.value);if(!r&&!i)return null;let s=e.data.get(t.id);if(!s){let o=window.atob(t.geometry),a=new Uint8Array(o.length);for(let h=0;h<o.length;h++)a[h]=o.charCodeAt(h);let c=new H1(new xc(a.buffer)).layers["mpy-or"],d=c.feature(0).loadGeometry().map(h=>h.map(p=>[p.x/c.extent,p.y/c.extent])),f=new window.mapillary.PolygonGeometry(d[0]);s={id:t.id,imageID:t.imageID,geometry:f,value:t.value},e.data.set(s.id,s)}return t.created_at&&(s.created_at=t.created_at),t.detectionID&&(s.detectionID=t.detectionID),s}_preventCoincident(e,t){for(let r=0;;r++){t=Me(t,[0,r*1e-5]);let i={minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]};if(!e.collides(i))return t}}};var cae=14,bc="https://maproulette.org/api/v2",J5=class extends Se{constructor(e){super(e),this.id="maproulette",this.autoStart=!1,this._initPromise=null,this._challengeIDs=new Set,this._cache=null,this._tiler=new or().zoomRange(cae).skipNullIsland(!0),this._hashchange=this._hashchange.bind(this),this._mapRouletteChanged=this._mapRouletteChanged.bind(this)}initAsync(){if(this._initPromise)return this._initPromise;let e=this.context,t=e.systems.gfx,r=e.systems.urlhash,i=Promise.all([t.initAsync(),r.initAsync()]);return this._initPromise=i.then(()=>this.resetAsync()).then(()=>{t.scene.on("layerchange",this._mapRouletteChanged),r.on("hashchange",this._hashchange)})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){if(this._cache)for(let e of this._cache.inflight)e.abort();return this._cache={lastv:null,tasks:new Map,challenges:new Map,tileRequest:new Map,challengeRequest:new Map,inflight:new Map,closed:[],rbush:new Tt},Promise.resolve()}get challengeIDs(){return[...this._challengeIDs].join(",")}set challengeIDs(e=""){let r=e.toString().split(",").map(s=>s.trim().toLowerCase()).filter(Boolean);this._challengeIDs.clear();for(let s of r){let o=+s;!isNaN(o)&&isFinite(o)&&this._challengeIDs.add(s)}this.context.systems.gfx.immediateRedraw(),this._mapRouletteChanged()}getData(){let e=this.context.viewport.visibleExtent();return this._cache.rbush.search(e.bbox()).map(t=>t.data).filter(t=>this._challengeIDs.size?this._challengeIDs.has(t.parentId):t.isVisible)}getTask(e){return this._cache.tasks.get(e)}getChallenge(e){return this._cache.challenges.get(e)}loadTiles(){if(this._paused)return;let e=this._cache,t=this.context.viewport;if(e.lastv===t.v)return;e.lastv=t.v;let r=this._tiler.getTiles(t).tiles;this._abortUnwantedRequests(r);for(let i of r)this.loadTile(i)}loadTile(e){let t=this._cache;if(t.tileRequest.has(e.id))return;let i=e.wgs84Extent.rectangle().join("/"),s=`${bc}/tasks/box/${i}`,o=new AbortController;t.inflight.set(s,o),t.tileRequest.set(e.id,{status:"inflight",controller:o,url:s}),fetch(s,{signal:o.signal}).then(Ae).then(a=>{t.tileRequest.set(e.id,{status:"loaded"});for(let l of a??[]){let c=l.id.toString(),u=l.parentId.toString();if(t.tasks.has(c))continue;let d=t.challenges.get(u);d?l.isVisible=d.isVisible:(t.challengeRequest.set(u,{}),l.isVisible=!1),l.id=c,l.parentId=u,l.loc=this._preventCoincident(t.rbush,[l.point.lng,l.point.lat]);let f=new Qe(this,null,c,l);t.tasks.set(c,f),t.rbush.insert(this._encodeIssueRBush(f))}this.loadChallenges()}).catch(a=>{a.name==="AbortError"?t.tileRequest.delete(e.id):(console.error(a),t.tileRequest.set(e.id,{status:"error"}))}).finally(()=>{t.inflight.delete(s)})}loadChallenges(){if(this._paused)return;let e=this._cache;for(let[t,r]of e.challengeRequest){if(r.status)return;let i=`${bc}/challenge/${t}`,s=new AbortController;e.inflight.set(i,s),e.challengeRequest.set(t,{status:"inflight",controller:s,url:i}),fetch(i,{signal:s.signal}).then(Ae).then(o=>{e.challengeRequest.set(t,{status:"loaded"}),o.isVisible=o.enabled&&!o.deleted;for(let l of e.tasks.values())l.parentId===t&&(l.isVisible=o.isVisible);e.challenges.set(t,o),this.context.systems.gfx.deferredRedraw(),this.emit("loadedData")}).catch(o=>{o.name==="AbortError"?e.challengeRequest.delete(t):(console.error(o),e.challengeRequest.set(t,{status:"error"}))}).finally(()=>{e.inflight.delete(i)})}}loadTaskDetailAsync(e){if(e.description!==void 0)return Promise.resolve(e);let t=`${bc}/challenge/${e.parentId}`,r=i=>(e.instruction=qe.parse(i.instruction)||"",e.description=qe.parse(i.description)||"",e);return fetch(t).then(Ae).then(r)}postUpdate(e,t){let r=this._cache,i=`${bc}/task/${e.id}/comment`;if(e.comment&&!r.inflight.has(i)){let a=new AbortController;r.inflight.set(i,a),fetch(i,{method:"POST",headers:{"Content-Type":"application/json",apiKey:e.mapRouletteApiKey},body:JSON.stringify({actionId:2,comment:e.comment}),signal:a.signal}).then(Ae).catch(l=>{l.name!=="AbortError"&&console.error(l)}).finally(()=>{r.inflight.delete(i)})}let s=`${bc}/task/${e.id}/${e.taskStatus}`,o=`${bc}/task/${e.id}/release`;if(!r.inflight.has(s)&&!r.inflight.has(o)){let a=new AbortController,l=new AbortController;r.inflight.set(s,a),r.inflight.set(o,l),fetch(s,{method:"PUT",headers:{"Content-Type":"application/json",apiKey:e.mapRouletteApiKey},signal:a.signal}).then(Ae).then(()=>fetch(o,{signal:l.signal,headers:{apiKey:e.mapRouletteApiKey}})).then(Ae).then(()=>{e.taskStatus===1&&this._cache.closed.push({taskID:e.id,challengeID:e.parentId}),this.removeTask(e),this.context.enter("browse"),t&&t(null,e)}).catch(c=>{c.name!=="AbortError"&&(console.error(c),t&&t(c.message))}).finally(()=>{r.inflight.delete(s),r.inflight.delete(o)})}}getError(e){return this._cache.tasks.get(e)}replaceTask(e){if(!(!(e instanceof Qe)||!e.id))return this._cache.tasks.set(e.id,e),this._updateRBush(this._encodeIssueRBush(e),!0),e}removeTask(e){!(e instanceof Qe)||!e.id||(this._cache.tasks.delete(e.id),this._updateRBush(this._encodeIssueRBush(e),!1))}getClosed(){return this._cache.closed}flyToNearbyTask(e){if(!this.nearbyTaskEnabled)return;let t=e.parentId,r=e.id;!t||!r||this.filterNearbyTasks(t,r)}getChallengeDetails(e){let t=this._cache.challenges.get(e);if(t)return Promise.resolve(t);{let r=`${bc}/challenge/${e}`;return fetch(r).then(Ae)}}filterNearbyTasks(e,t,r){let i=`${bc}/challenge/${e}/tasksNearby/${t}?excludeSelfLocked=true&limit=1`;t&&fetch(i).then(Ae).then(s=>{if(s.length>0){let o=s[0];return o.parentId=o.parent.toString(),this.getChallengeDetails(e).then(a=>{o.title=a.name,o.parentName=a.name;let l=new Qe(this,null,o.id.toString(),o),[c,u]=l.location.coordinates,d=this.context.systems.map;d&&(d.centerZoomEase([c,u],r),this.selectAndDisplayTask(l))})}}).catch(s=>{console.error("Error fetching nearby tasks for challenge:",e,s)})}selectAndDisplayTask(e){let t=this.context.services.maproulette;if(t){if(!(e instanceof Qe))return;t.currentTask=e;let r=new Map;r.set(e.id,e),this.context.enter("select",{selection:r})}}itemURL(e){return`https://maproulette.org/challenge/${e.parentId}/task/${e.id}`}_abortUnwantedRequests(e){let t=this._cache;for(let[r,i]of t.tileRequest){if(i.status!=="inflight")continue;e.find(o=>o.id===r)||(i.controller.abort(),t.inflight.delete(i.url))}}_encodeIssueRBush(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRBush(e,t){this._cache.rbush.remove(e,(r,i)=>r.data.id===i.data.id),t&&this._cache.rbush.insert(e)}_preventCoincident(e,t){for(let r=0;;r++){t=Me(t,[0,r*1e-5]);let i={minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]};if(!e.collides(i))return t}}_hashchange(e,t){let r=this.context.systems.gfx.scene,i=e.get("maproulette")||"",s=t.get("maproulette")||"";if(i!==s){let o=!1;this._challengeIDs.clear();let a=i.split(",").map(l=>l.trim().toLowerCase()).filter(Boolean);for(let l of a){if(l==="true"){o=!0;continue}let c=+l;!isNaN(c)&&isFinite(c)&&(o=!0,this._challengeIDs.add(l))}o?r.enableLayers("maproulette"):r.disableLayers("maproulette")}}_mapRouletteChanged(){let e=this.context,t=e.systems.urlhash;if(e.systems.gfx.scene.layers.get("maproulette")?.enabled){let s=this.challengeIDs;s?t.setParam("maproulette",s):t.setParam("maproulette","true")}else t.setParam("maproulette",null)}};var uae="https://mapwith.ai/maps/ml_roads",dae=16,e6=class extends Se{constructor(e){super(e),this.id="mapwithai",this._tiler=new or().zoomRange(dae),this._datasets={},this._deferred=new Set,this._parseNode=this._parseNode.bind(this),this._parseWay=this._parseWay.bind(this)}initAsync(){return this.resetAsync().then(()=>{let e="rapid_intro_graph",t=new Fr,r=new zi(t),s={id:e,graph:t,tree:r,cache:{inflight:{},loaded:new Set,seen:new Set,seenFirstNodeID:new Set,splitWays:new Map},lastv:null};this._datasets[e]=s})}startAsync(){return this._started=!0,Promise.resolve()}getAvailableDatasets(){let e=this.context,t=new Hi(e,{id:"fbRoads",conflated:!0,service:"mapwithai",categories:new Set(["meta","roads","featured"]),dataUsed:["mapwithai","Facebook Roads"],itemUrl:"https://github.com/facebookmicrosites/Open-Mapping-At-Facebook",licenseUrl:"https://rapideditor.org/doc/license/MapWithAILicense.pdf",labelStringID:"rapid_menu.fbRoads.label",descriptionStringID:"rapid_menu.fbRoads.description"}),r=new Hi(e,{id:"msBuildings",conflated:!0,service:"mapwithai",categories:new Set(["microsoft","buildings","featured"]),dataUsed:["mapwithai","Microsoft Buildings"],itemUrl:"https://github.com/microsoft/GlobalMLBuildingFootprints",licenseUrl:"https://github.com/microsoft/USBuildingFootprints/blob/master/LICENSE-DATA",labelStringID:"rapid_menu.msBuildings.label",descriptionStringID:"rapid_menu.msBuildings.description"}),i=new Hi(e,{id:"omdFootways",conflated:!0,service:"mapwithai",categories:new Set(["meta","footways","featured"]),tags:new Set(["opendata"]),overlay:{url:"https://external.xx.fbcdn.net/maps/vtp/rapid_overlay_footways/2/{z}/{x}/{y}/",minZoom:1,maxZoom:15},dataUsed:["mapwithai","Open Footways"],itemUrl:"https://github.com/facebookmicrosites/Open-Mapping-At-Facebook/wiki/Footways-FAQ",licenseUrl:"https://github.com/facebookmicrosites/Open-Mapping-At-Facebook/wiki/Footways-FAQ#attribution-and-license",labelStringID:"rapid_menu.omdFootways.label",descriptionStringID:"rapid_menu.omdFootways.description"}),s=new Hi(e,{id:"rapid_intro_graph",hidden:!0,conflated:!1,service:"mapwithai",categories:new Set(["meta","roads"]),color:"#da26d3",dataUsed:[],label:"Rapid Walkthrough"});return[t,r,i,s]}resetAsync(){for(let e of this._deferred)window.cancelIdleCallback(e),this._deferred.delete(e);for(let e of Object.values(this._datasets))e.cache.inflight&&Object.values(e.cache.inflight).forEach(t=>this._abortRequest(t)),e.lastv=null,e.graph=new Fr,e.tree=new zi(e.graph),e.cache={inflight:{},loaded:new Set,seen:new Set,seenFirstNodeID:new Set,splitWays:new Map};return Promise.resolve()}getData(e){let t=this._datasets[e];if(!t||!t.tree||!t.graph)return[];let r=this.context.viewport.visibleExtent();return t.tree.intersects(r,t.graph)}loadTiles(e){if(this._paused)return;let t=this._datasets[e],r,i,s;t?(r=t.graph,i=t.tree,s=t.cache):(r=new Fr,i=new zi(r),s={inflight:{},loaded:new Set,seen:new Set,seenFirstNodeID:new Set,splitWays:new Map},t={id:e,graph:r,tree:i,cache:s,lastv:null},this._datasets[e]=t);let o=this.context.systems.locations,a=this.context.viewport;if(t.lastv===a.v)return;t.lastv=a.v;let l=this._tiler.getTiles(a).tiles;for(let c of Object.keys(s.inflight))l.find(d=>d.id===c)||(this._abortRequest(s.inflight[c]),delete s.inflight[c]);for(let c of l){if(s.loaded.has(c.id)||s.inflight[c.id])continue;if(c.wgs84Extent.polygon().slice(0,4).every(p=>o.blocksAt(p).length)){s.loaded.add(c.id);continue}let f=this._tileURL(t,c.wgs84Extent),h=new AbortController;fetch(f,{signal:h.signal}).then(Ae).then(p=>{delete s.inflight[c.id],p&&this._parseXML(t,p,c,(m,g)=>{if(m)return;r.rebase(g,[r],!0),i.rebase(g,!0),s.loaded.add(c.id),this.context.systems.gfx.deferredRedraw(),this.emit("loadedData")})}).catch(p=>{p.name!=="AbortError"&&console.error(p)}),s.inflight[c.id]=h}}graph(e){return this._datasets[e]?.graph}merge(e,t){let r=this._datasets[e];!r||!r.tree||!r.graph||(r.graph.rebase(t,[r.graph],!1),r.tree.rebase(t,!1))}_abortRequest(e){e.abort()}_tileURL(e,t){let r=/-conflated$/.test(e.id),i=e.id.replace("-conflated",""),s={conflate_with_osm:r,theme:"ml_road_vector",collaborator:"fbid",token:"ASZUVdYpCkd3M6ZrzjXdQzHulqRMnxdlkeBJWEKOeTUoY_Gwm9fuEd2YObLrClgDB_xfavizBsh0oDfTWTF7Zb4C",hash:"ASYM8LPNy8k1XoJiI7A"};i==="fbRoads"?s.result_type="road_vector_xml":i==="omdFootways"?(s.result_type="extended_osc",s.sources="ML2OSM_META_FOOTWAYS"):i==="msBuildings"?(s.result_type="road_building_vector_xml",s.building_source="microsoft"):(s.result_type="osm_xml",s.sources=`esri_building.${i}`),s.bbox=t.toParam();let o=this.context.systems.rapid.taskExtent;return o&&(s.crop_bbox=o.toParam()),(sa(window.location.hash).fb_ml_road_url||uae)+"?"+u(s,!0);function u(d,f){function h(p){return encodeURIComponent(p).replace(/(%2F|%3A|%2C|%7B|%7D)/g,decodeURIComponent)}return Object.keys(d).map(p=>encodeURIComponent(p)+"="+(f?h(d[p]):encodeURIComponent(d[p]))).join("&")}}_getLoc(e){let t=e.lon?.value,r=e.lat?.value;return[parseFloat(t),parseFloat(r)]}_getNodes(e){return Array.from(e.getElementsByTagName("nd")).map(r=>"n"+r.attributes.ref.value)}_getTags(e){let t=Array.from(e.getElementsByTagName("tag")),r={};for(let i of t){let s=i.attributes,o=(s.k.value??"").trim(),a=(s.v.value??"").trim();o&&a&&(r[o]=a)}return r}_getVisible(e){return!e.visible||e.visible.value!=="false"}_parseNode(e,t){let r=e.attributes;return new Le({id:t,visible:this._getVisible(r),loc:this._getLoc(r),tags:this._getTags(e)})}_parseWay(e,t){let r=e.attributes;return new Rt({id:t,visible:this._getVisible(r),tags:this._getTags(e),nodes:this._getNodes(e)})}_parseXML(e,t,r,i){if(!t||!t.childNodes)return i({message:"No XML",status:-1});let o=t.childNodes[0].childNodes,a=window.requestIdleCallback(()=>{this._deferred.delete(a);let l=[];for(let c of o){let u=this._parseEntity(e,r,c);u&&l.push(u)}l=l.concat(this._connectSplitWays(e)),i(null,l)});this._deferred.add(a)}_parseEntity(e,t,r){let i=e.cache,s=r.nodeName;if(!["node","way"].includes(s))return null;let o,a;if(o=me.id.fromOSM(s,r.attributes.id.value),s==="node"){if(i.seen.has(o))return null;a=this._parseNode(r,o),i.seen.add(o)}else if(s==="way")if(r.attributes.orig_id){let c=me.id.fromOSM(s,r.attributes.orig_id.value);a=this._parseWay(r,o);let u=i.splitWays.get(c);return u||(u=new Set,i.splitWays.set(c,u)),u.add(a),null}else{if(i.seen.has(o))return null;if(a=this._parseWay(r,o),i.seen.add(o),/^msBuildings/.test(e.id)){let c=a.nodes[0];if(i.seenFirstNodeID.has(c))return null;i.seenFirstNodeID.add(c)}}else return null;let l={__fbid__:o,__service__:"mapwithai",__datasetid__:e.id};return Object.assign(a,l)}_connectSplitWays(e){let t=e.graph,r=e.cache,i=[];for(let[s,o]of r.splitWays){let a=t.hasEntity(s);for(let l of o){if(!a||!a.nodes.length){a=l.update({id:s}),o.delete(l);continue}let c=[];for(let m of l.nodes)c.push(a.nodes.indexOf(m));if(c.every(m=>m!==-1)){o.delete(l);continue}else if(c.every(m=>m===-1))continue;let u=!1,d=!1,f;for(let m of c)if(m!==-1)if(f===void 0)d=!0,f=m;else{d=!1,u=m<f;break}d&&(c.at(0)===0&&(u=!0),c.at(-1)!==0&&(u=!0)),u&&(l.nodes.reverse(),c.reverse());let h=[],p=0;for(let m=0;m<c.length;m++){let g=c[m];if(g===-1)h.push(l.nodes[m]);else for(;p<=g;)h.push(a.nodes[p]),p++}for(;p<a.nodes.length;)h.push(a.nodes[p]),p++;o.delete(l),a=a.update({nodes:h})}if(a){let l={__fbid__:a.id,__service__:"mapwithai",__datasetid__:e.id};i.push(Object.assign(a,l))}}return i}};var t6=class extends Se{constructor(e){super(e),this.id="nominatim",this.apibase="https://nominatim.openstreetmap.org/",this._inflight={},this._nominatimCache=new Tt,this.countryCode=this.countryCode.bind(this),this.reverse=this.reverse.bind(this),this.search=this.search.bind(this)}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},this._nominatimCache=new Tt,Promise.resolve()}countryCode(e,t){this.reverse(e,(r,i)=>r?t(r):i.address?t(null,i.address.country_code):t("Unable to geocode",null))}reverse(e,t){let r=this._nominatimCache.search({minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]});if(r.length>0){t&&t(null,r[0].data);return}let i={zoom:13,format:"json",addressdetails:1,lat:e[1],lon:e[0]},s=this.apibase+"reverse?"+ft(i);if(this._inflight[s])return;let o=new AbortController;this._inflight[s]=o;let a=this.context.systems.l10n,l={signal:o.signal,headers:{"Accept-Language":a.localeCodes().join(",")}};fetch(s,l).then(Ae).then(c=>{if(delete this._inflight[s],c?.error)throw new Error(c.error);let u=new le(e).padByMeters(200);this._nominatimCache.insert(Object.assign(u.bbox(),{data:c})),t&&t(null,c)}).catch(c=>{delete this._inflight[s],c.name!=="AbortError"&&t&&t(c.message)})}search(e,t){let r=encodeURIComponent(e),i=this.apibase+`search?q=${r}&limit=10&format=json`;if(this._inflight[i])return;let s=new AbortController;this._inflight[i]=s;let o=this.context.systems.l10n,a={signal:s.signal,headers:{"Accept-Language":o.localeCodes().join(",")}};fetch(i,a).then(Ae).then(l=>{if(delete this._inflight[i],l?.error)throw new Error(l.error);t&&t(null,l)}).catch(l=>{delete this._inflight[i],l.name!=="AbortError"&&t&&t(l.message)})}};var YV=Ot(kp(),1);var VV=Ot(v6(),1);function V1(n){return typeof n!="string"?"":VV.default.remove(n.replace(/&/g,"and").replace(/(İ|i̇)/ig,"i").replace(/[\s\-=_!"#%'*{},.\/:;?\(\)\[\]@\\$\^*+<>«»~`’\u00a1\u00a7\u00b6\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05c0\u05c3\u05c6\u05f3\u05f4\u0609\u060a\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0830-\u083e\u085e\u0964\u0965\u0970\u0af0\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f14\u0f85\u0fd0-\u0fd4\u0fd9\u0fda\u104a-\u104f\u10fb\u1360-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u1a1e\u1a1f\u1aa0-\u1aa6\u1aa8-\u1aad\u1b5a-\u1b60\u1bfc-\u1bff\u1c3b-\u1c3f\u1c7e\u1c7f\u1cc0-\u1cc7\u1cd3\u2000-\u206f\u2cf9-\u2cfc\u2cfe\u2cff\u2d70\u2e00-\u2e7f\u3001-\u3003\u303d\u30fb\ua4fe\ua4ff\ua60d-\ua60f\ua673\ua67e\ua6f2-\ua6f7\ua874-\ua877\ua8ce\ua8cf\ua8f8-\ua8fa\ua92e\ua92f\ua95f\ua9c1-\ua9cd\ua9de\ua9df\uaa5c-\uaa5f\uaade\uaadf\uaaf0\uaaf1\uabeb\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\ufeff\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]+/g,"").toLowerCase())}var jV={matchGroups:{adult_gaming_centre:["amenity/casino","amenity/gambling","leisure/adult_gaming_centre"],bar:["amenity/bar","amenity/pub","amenity/restaurant"],beauty:["shop/beauty","shop/hairdresser_supply"],bed:["shop/bed","shop/furniture"],beverages:["shop/alcohol","shop/beer","shop/beverages","shop/kiosk","shop/wine"],camping:["tourism/camp_site","tourism/caravan_site"],car_parts:["shop/car_parts","shop/car_repair","shop/tires","shop/tyres"],clinic:["amenity/clinic","amenity/doctors","healthcare/clinic","healthcare/laboratory","healthcare/physiotherapist","healthcare/sample_collection","healthcare/dialysis"],convenience:["shop/beauty","shop/chemist","shop/convenience","shop/cosmetics","shop/grocery","shop/kiosk","shop/newsagent","shop/perfumery"],coworking:["amenity/coworking_space","office/coworking","office/coworking_space"],dentist:["amenity/dentist","amenity/doctors","healthcare/dentist"],electronics:["office/telecommunication","shop/appliance","shop/computer","shop/electronics","shop/hifi","shop/kiosk","shop/mobile","shop/mobile_phone","shop/telecommunication","shop/video_games"],estate_agents:["office/estate_agent","shop/estate_agent","office/mortgage","office/financial"],fabric:["shop/fabric","shop/haberdashery","shop/sewing"],fashion:["shop/accessories","shop/bag","shop/boutique","shop/clothes","shop/department_store","shop/fashion","shop/fashion_accessories","shop/sports","shop/shoes"],financial:["amenity/bank","office/accountant","office/financial","office/financial_advisor","office/tax_advisor","shop/tax"],fitness:["leisure/fitness_centre","leisure/fitness_center","leisure/sports_centre","leisure/sports_center"],food:["amenity/cafe","amenity/fast_food","amenity/ice_cream","amenity/restaurant","shop/bakery","shop/candy","shop/chocolate","shop/coffee","shop/confectionary","shop/confectionery","shop/deli","shop/food","shop/kiosk","shop/ice_cream","shop/pastry","shop/tea"],fuel:["amenity/fuel","shop/gas","shop/convenience;gas","shop/gas;convenience"],gift:["shop/gift","shop/card","shop/cards","shop/kiosk","shop/stationery"],glass:["craft/window_construction","craft/glaziery","shop/car_repair"],hardware:["shop/bathroom_furnishing","shop/carpet","shop/diy","shop/doityourself","shop/doors","shop/electrical","shop/flooring","shop/hardware","shop/hardware_store","shop/power_tools","shop/tool_hire","shop/tools","shop/trade"],health_food:["shop/health","shop/health_food","shop/herbalist","shop/nutrition_supplements"],hobby:["shop/electronics","shop/hobby","shop/books","shop/games","shop/collector","shop/toys","shop/model","shop/video_games","shop/anime"],hospital:["amenity/doctors","amenity/hospital","healthcare/hospital"],houseware:["shop/houseware","shop/interior_decoration"],water_rescue:["amenity/lifeboat_station","emergency/lifeboat_station","emergency/marine_rescue","emergency/water_rescue"],locksmith:["craft/key_cutter","craft/locksmith","shop/locksmith"],lodging:["tourism/guest_house","tourism/hotel","tourism/motel"],money_transfer:["amenity/money_transfer","shop/money_transfer"],music:["shop/music","shop/musical_instrument"],office_supplies:["shop/office_supplies","shop/stationary","shop/stationery"],outdoor:["shop/clothes","shop/outdoor","shop/sports"],parcel_locker:["amenity/parcel_locker","amenity/vending_machine"],pharmacy:["amenity/doctors","amenity/pharmacy","healthcare/pharmacy","shop/chemist"],playground:["amenity/theme_park","leisure/amusement_arcade","leisure/playground"],rental:["amenity/bicycle_rental","amenity/boat_rental","amenity/car_rental","amenity/truck_rental","amenity/vehicle_rental","shop/kiosk","shop/plant_hire","shop/rental","shop/tool_hire"],school:["amenity/childcare","amenity/college","amenity/kindergarten","amenity/language_school","amenity/prep_school","amenity/school","amenity/university"],storage:["shop/storage_units","shop/storage_rental"],substation:["power/station","power/substation","power/sub_station"],supermarket:["shop/food","shop/frozen_food","shop/greengrocer","shop/grocery","shop/supermarket","shop/wholesale"],thrift:["shop/charity","shop/clothes","shop/second_hand"],tobacco:["shop/e-cigarette","shop/tobacco"],variety_store:["shop/variety_store","shop/discount","shop/convenience"],vending:["amenity/vending_machine","shop/kiosk","shop/vending_machine"],weight_loss:["amenity/clinic","amenity/doctors","amenity/weight_clinic","healthcare/counselling","leisure/fitness_centre","office/therapist","shop/beauty","shop/diet","shop/food","shop/health_food","shop/herbalist","shop/nutrition","shop/nutrition_supplements","shop/weight_loss"],wholesale:["shop/wholesale","shop/supermarket","shop/department_store"]}};var XV={genericWords:["^(barn|bazaa?r|bench|bou?tique|building|casa|church)$","^(baseball|basketball|football|soccer|softball|tennis(halle)?)\\s?(field|court)?$","^(club|green|out|ware)\\s?house$","^(driveway|el \xE1rbol|fountain|generic|golf|government|graveyard)$","^(fixme|n\\s?\\/?\\s?a|name|no\\s?name|none|null|temporary|test|unknown)$","^(hofladen|librairie|magazine?|maison|toko)$","^(mobile home|skate)?\\s?park$","^(obuwie|pond|pool|sale|shops?|sklep|stores?)$","^\\?+$","^private$","^tattoo( studio)?$","^windmill$","^\u0446\u0435\u0440\u043A\u043E\u0432\u043D\u0430\u044F( \u043B\u0430\u0432\u043A\u0430)?$"]};var qV={trees:{brands:{emoji:"\u{1F354}",mainTag:"brand:wikidata",sourceTags:["brand","name"],nameTags:{primary:"^(name|name:\\w+)$",alternate:"^(brand|brand:\\w+|operator|operator:\\w+|\\w+_name|\\w+_name:\\w+)$"}},flags:{emoji:"\u{1F6A9}",mainTag:"flag:wikidata",nameTags:{primary:"^(flag:name|flag:name:\\w+)$",alternate:"^(country|country:\\w+|flag|flag:\\w+|subject|subject:\\w+)$"}},operators:{emoji:"\u{1F4BC}",mainTag:"operator:wikidata",sourceTags:["operator"],nameTags:{primary:"^(name|name:\\w+|operator|operator:\\w+)$",alternate:"^(brand|brand:\\w+|\\w+_name|\\w+_name:\\w+)$"}},transit:{emoji:"\u{1F687}",mainTag:"network:wikidata",sourceTags:["network"],nameTags:{primary:"^network$",alternate:"^(operator|operator:\\w+|network:\\w+|\\w+_name|\\w+_name:\\w+)$"}}}};var vD=jV.matchGroups,mae=qV.trees,r6=class{constructor(){this.matchIndex=void 0,this.genericWords=new Map,(XV.genericWords||[]).forEach(e=>this.genericWords.set(e,new RegExp(e,"i"))),this.itemLocation=void 0,this.locationSets=void 0,this.locationIndex=void 0,this.warnings=[]}buildMatchIndex(e){let t=this;if(t.matchIndex)return;t.matchIndex=new Map;let r=new Map;Object.keys(e).forEach(o=>{let a=e[o],l=o.split("/",3),c=l[0],u=l[1],d=l[2],f=`${u}/${d}`,h=mae[c],p=t.matchIndex.get(f);p||(p={primary:new Map,alternate:new Map,excludeGeneric:new Map,excludeNamed:new Map},t.matchIndex.set(f,p));let g=(a.properties||{}).exclude||{};(g.generic||[]).forEach(w=>p.excludeGeneric.set(w,new RegExp(w,"i"))),(g.named||[]).forEach(w=>p.excludeNamed.set(w,new RegExp(w,"i")));let y=[...p.excludeGeneric.values(),...p.excludeNamed.values()],x=a.items;if(!Array.isArray(x)||!x.length)return;let b=new RegExp(h.nameTags.primary,"i"),_=new RegExp(h.nameTags.alternate,"i"),S=/:(colou?r|type|forward|backward|left|right|etymology|pronunciation|wikipedia)$/i,C=s(c,u,d),k=new Set([`${u}/yes`,"building/yes"]),v=new Set;Object.values(vD).forEach(w=>{w.some(E=>E===f)&&w.forEach(E=>{if(E===f)return;v.add(E);let I=E.split("/",2)[0];k.add(`${I}/yes`)})}),x.forEach(w=>{if(!w.id)return;Array.isArray(w.matchTags)&&w.matchTags.length&&(w.matchTags=w.matchTags.filter(I=>!v.has(I)&&I!==f&&!k.has(I)),w.matchTags.length||delete w.matchTags);let A=[`${f}`].concat(w.matchTags||[]);C||(A=A.concat(Array.from(k))),Object.keys(w.tags).forEach(I=>{if(S.test(I))return;let M=w.tags[I];!M||y.some(T=>T.test(M))||(b.test(I)?A.forEach(T=>i("primary",c,T,V1(M),w.id)):_.test(I)&&A.forEach(T=>i("alternate",c,T,V1(M),w.id)))});let E=new Set;(w.matchNames||[]).forEach(I=>{let M=V1(I);A.forEach(T=>{let R=t.matchIndex.get(T),P=R&&R.primary.get(M),D=R&&R.alternate.get(M),N=P&&P.has(w.id),F=D&&D.has(w.id);!N&&!F&&(i("alternate",c,T,M,w.id),E.add(I))})}),E.size?w.matchNames=Array.from(E):delete w.matchNames})});function i(o,a,l,c,u){if(!c){t.warnings.push(`Warning: skipping empty ${o} name for item ${a}/${l}: ${u}`);return}let d=t.matchIndex.get(l);d||(d={primary:new Map,alternate:new Map,excludeGeneric:new Map,excludeNamed:new Map},t.matchIndex.set(l,d));let f=d[o].get(c);if(f||(f=new Set,d[o].set(c,f)),f.add(u),!/yes$/.test(l)){let h=`${l}/${c}`,p=r.get(h);if(p&&p!==a){let m=Array.from(f);t.warnings.push(`Duplicate cache key "${h}" in trees "${a}" and "${p}", check items: ${m}`);return}r.set(h,a)}}function s(o,a,l){return o==="flags"||o==="transit"||a==="landuse"||l==="atm"||l==="bicycle_parking"||l==="car_sharing"||l==="caravan_site"||l==="charging_station"||l==="dog_park"||l==="parking"||l==="phone"||l==="playground"||l==="post_box"||l==="public_bookcase"||l==="recycling"||l==="vending_machine"}}buildLocationIndex(e,t){let r=this;if(r.locationIndex)return;r.itemLocation=new Map,r.locationSets=new Map,Object.keys(e).forEach(s=>{let o=e[s].items;!Array.isArray(o)||!o.length||o.forEach(a=>{if(r.itemLocation.has(a.id))return;let l;try{l=t.resolveLocationSet(a.locationSet)}catch(u){console.warn(`buildLocationIndex: ${u.message}`)}if(!l||!l.id||(r.itemLocation.set(a.id,l.id),r.locationSets.has(l.id)))return;let c=i(l.feature);if(c.id=l.id,c.properties.id=l.id,!c.geometry.coordinates.length||!c.properties.area){console.warn(`buildLocationIndex: locationSet ${l.id} for ${a.id} resolves to an empty feature:`),console.warn(JSON.stringify(c));return}r.locationSets.set(l.id,c)})}),r.locationIndex=(0,YV.default)({type:"FeatureCollection",features:[...r.locationSets.values()]});function i(s){return JSON.parse(JSON.stringify(s))}}match(e,t,r,i){let s=this;if(!s.matchIndex)throw new Error("match:  matchIndex not built.");let o;Array.isArray(i)&&s.locationIndex&&(o=s.locationIndex([i[0],i[1],i[0],i[1]],!0));let a=V1(r),l=new Set,c=[];if(u("primary"),u("alternate"),c.length)return c;return u("exclude"),c.length?c:null;function u(f){let h=`${e}/${t}`,p=d(f,h);if(!p){for(let m in vD){let g=vD[m];if(g.some(x=>x===h))for(let x=0;x<g.length;x++){let b=g[x];if(b!==h&&(p=d(f,b),p))return}}if(f==="exclude"){let m=[...s.genericWords.values()].find(g=>g.test(r));if(m){c.push({match:"excludeGeneric",pattern:String(m)});return}}}}function d(f,h){let p=s.matchIndex.get(h);if(!p)return;if(f==="exclude"){let S=[...p.excludeNamed.values()].find(C=>C.test(r));if(S){c.push({match:"excludeNamed",pattern:String(S),kv:h});return}if(S=[...p.excludeGeneric.values()].find(C=>C.test(r)),S){c.push({match:"excludeGeneric",pattern:String(S),kv:h});return}return}let m=p[f].get(a);if(!m||!m.size)return;let g=Array.from(m).map(S=>{let C=1/0;if(s.itemLocation&&s.locationSets){let k=s.locationSets.get(s.itemLocation.get(S));C=k&&k.properties.area||1/0}return{match:f,itemID:S,area:C,kv:h,nsimple:a}}),y=_;if(o&&(g=g.filter(x),y=b),!g.length)return;return g.sort(y).forEach(S=>{l.has(S.itemID)||(l.add(S.itemID),c.push(S))}),!0;function x(S){return s.itemLocation?o.find(C=>C.id===s.itemLocation.get(S.itemID)):!0}function b(S,C){return S.area-C.area}function _(S,C){return C.area-S.area}}}getWarnings(){return this.warnings}};var gae={"building/commercial":!0,"building/government":!0,"building/hotel":!0,"building/retail":!0,"building/office":!0,"building/supermarket":!0,"building/yes":!0},yae=/:(colou?r|type|forward|backward|left|right|etymology|pronunciation|wikipedia)$/i,xae=/(coop|express|wireless|factory|outlet)/i,n6=class extends Se{constructor(e){super(e),this.id="nsi",this.status="loading",this._nsi={}}initAsync(){return this.context.systems.presets.initAsync().then(()=>this._loadNsiPresetsAsync()).then(()=>this._loadNsiDataAsync()).then(()=>this.status="ok").catch(t=>{console.error(t),this.status="failed"})}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}isGenericName(e){let t=e.name;if(!t)return!1;let r={primary:new Set([t]),alternate:new Set},i=this._gatherKVs(e);if(!i.primary.size&&!i.alternate.size)return!1;let s=this._gatherTuples(i,r);for(let o of s){let a=this._nsi.matcher.match(o.k,o.v,o.n);if(a?.length&&a[0].match==="excludeGeneric")return!0}return!1}upgradeTags(e,t){let r=Object.assign({},e),i=!1;for(let u of Object.keys(r)){let d=u.match(/^(\w+:)?wikidata$/);if(d){let f=d[1]||"",h=r[u],p=this._nsi.replacements[h];if(p?.wikidata!==void 0&&(i=!0,p.wikidata?r[u]=p.wikidata:delete r[u]),p?.wikipedia!==void 0){i=!0;let m=`${f}wikipedia`;p.wikipedia?r[m]=p.wikipedia:delete r[m]}}}let s=e.type==="route_master",o=this._gatherKVs(e);if(!o.primary.size&&!o.alternate.size)return i?{newTags:r,matched:null}:null;let a=this._gatherNames(e),l=this._nsi.qids.get(e.wikidata)||this._nsi.qids.get(e.wikipedia);if(l&&a.primary.add(l),!a.primary.size&&!a.alternate.size)return i?{newTags:r,matched:null}:null;let c=this._gatherTuples(o,a);for(let u of c){let d=this._nsi.matcher.match(u.k,u.v,u.n,t);if(!d||!d.length)continue;if(d[0].match!=="primary"&&d[0].match!=="alternate")break;let f,h;for(let w of d){if(f=w.itemID,this._nsi.dissolved[f]||(h=this._nsi.ids.get(f),!h))continue;let A=h.mainTag,E=h.tags[A],I=r[`not:${A}`];if(!E||E===I||r.office&&!h.tags.office){h=null;continue}else break}if(!h)continue;h=JSON.parse(JSON.stringify(h));let p=h.tkv,m=p.split("/",3),g=m[1],y=m[2],b=this._nsi.data[p].properties||{},_=h.preserveTags||b.preserveTags||[];["building","emergency","internet_access","opening_hours","takeaway"].forEach(w=>{g!==w&&_.push(`^${w}$`)});let S=_.map(w=>new RegExp(w,"i")),C={};for(let w of Object.keys(r))S.some(A=>A.test(w))&&(C[w]=r[w]);this._nsi.kvt.forEach((w,A)=>{r[A]==="yes"&&delete r[A]}),l&&(delete r.wikipedia,delete r.wikidata),Object.assign(r,h.tags,C),s&&(r.route_master=r.route,delete r.route);let k=e.name,v=r.name;if(v&&k&&v!==k&&!r.branch){let w=this._gatherNames(r);if(!new Set([...w.primary,...w.alternate]).has(k)){let I=k.split(/[\s\-\/,.]/);for(let M=I.length;M>0;M--){let T=I.slice(0,M).join(" "),R=I.slice(M).join(" "),P=this._nsi.matcher.match(g,y,T,t);if(!(!P||!P.length)&&P.some(D=>D.itemID===f)){if(R)if(xae.test(R))r.name=k;else{let D=this._nsi.matcher.match(g,y,R,t);if(D&&D.length){if(D[0].match==="primary"||D[0].match==="alternate")return null}else r.branch=R}break}}}}return{newTags:r,matched:h}}return i?{newTags:r,matched:null}:null}_loadNsiPresetsAsync(){let e=this.context.systems.assets;return Promise.all([e.loadAssetAsync("nsi_presets"),e.loadAssetAsync("nsi_features")]).then(t=>{Object.values(t[0].presets).forEach(i=>i.suggestion=!0),this.context.systems.presets.merge({presets:t[0].presets,featureCollection:t[1]})})}_loadNsiDataAsync(){let e=this.context.systems.assets;return Promise.all([e.loadAssetAsync("nsi_data"),e.loadAssetAsync("nsi_dissolved"),e.loadAssetAsync("nsi_replacements"),e.loadAssetAsync("nsi_trees")]).then(t=>{this._nsi={data:t[0].nsi,dissolved:t[1].dissolved,replacements:t[2].replacements,trees:t[3].trees,kvt:new Map,qids:new Map,ids:new Map};let r=this._nsi.matcher=new r6;r.buildMatchIndex(this._nsi.data),r.itemLocation=new Map,r.locationSets=new Map;let i=this.context.systems.locations;for(let s of Object.values(this._nsi.data))for(let o of s.items??[]){if(r.itemLocation.has(o.id))continue;let a=i.locationSetID(o.locationSet);if(r.itemLocation.set(o.id,a),r.locationSets.has(a))continue;let l={id:a,properties:{id:a,area:1}};r.locationSets.set(a,l)}r.locationIndex=s=>{let o=i.locationSetsAt([s[0],s[1]]),a=[];for(let[l,c]of Object.entries(o)){let u=r.locationSets.get(l);u&&(u.properties.area=c,a.push(u))}return a},Object.keys(this._nsi.data).forEach(s=>{let o=this._nsi.data[s],[a,l,c]=s.split("/",3),u=this._nsi.kvt.get(l);u||(u=new Map,this._nsi.kvt.set(l,u)),u.set(c,a);let f=this._nsi.trees[a].mainTag;(o.items||[]).forEach(p=>{p.tkv=s,p.mainTag=f,this._nsi.ids.set(p.id,p);let m=p.tags[f],g=p.tags[f.replace("wikidata","wikipedia")];m&&this._nsi.qids.set(m,m),g&&m&&this._nsi.qids.set(g,m)})})})}_gatherKVs(e){let t=new Set,r=new Set;for(let[o,a]of Object.entries(e)){if(!o||!a)continue;o==="route_master"&&(o="route");let l=this._nsi.kvt.get(o);l&&(l.get(a)?t.add(`${o}/${a}`):a==="yes"&&r.add(`${o}/${a}`))}let s=this.context.systems.presets.matchTags(e,"area");return gae[s.id]&&r.add("building/yes"),{primary:t,alternate:r}}_identifyTree(e){let t,r;for(let[i,s]of Object.entries(e)){if(!i||!s)continue;i==="route_master"&&(i="route");let o=this._nsi.kvt.get(i);if(o)if(s==="yes")t="unknown";else{r=o.get(s);break}}return r||t||null}_gatherNames(e){let t={primary:new Set,alternate:new Set},r=new Set,i=new Set,s=!1,o=!1,a,l=this._identifyTree(e);if(!l)return t;if(l==="transit"?a={primary:/^network$/i,alternate:/^(operator|operator:\w+|network:\w+|\w+_name|\w+_name:\w+)$/i}:l==="flags"?a={primary:/^(flag:name|flag:name:\w+)$/i,alternate:/^(flag|flag:\w+|subject|subject:\w+)$/i}:l==="brands"?(o=!0,a={primary:/^(name|name:\w+)$/i,alternate:/^(brand|brand:\w+|operator|operator:\w+|\w+_name|\w+_name:\w+)/i}):l==="operators"?(o=!0,a={primary:/^(name|name:\w+|operator|operator:\w+)$/i,alternate:/^(brand|brand:\w+|\w+_name|\w+_name:\w+)/i}):(o=!0,a={primary:/^(name|name:\w+)$/i,alternate:/^(brand|brand:\w+|network|network:\w+|operator|operator:\w+|\w+_name|\w+_name:\w+)/i}),e.name&&o){let u=e.name.split(/[\s\-\/,.]/);for(let d=u.length;d>0;d--){let f=u.slice(0,d).join(" ");r.add(f)}}for(let[u,d]of Object.entries(e))!u||!d||(c(u,"primary")?/;/.test(d)?s=!0:(r.add(d),i.delete(d)):!r.has(d)&&c(u,"alternate")&&(/;/.test(d)?s=!0:i.add(d)));if(e.man_made==="flagpole"&&!r.size&&!i.size&&e.country){let u=e.country;/;/.test(u)?s=!0:i.add(u)}if(s)return t;return{primary:r,alternate:i};function c(u,d){return u==="old_name"?!1:a[d].test(u)&&!yae.test(u)}}_gatherTuples(e,t){let r=[];for(let i of["primary","alternate"]){let s=Array.from(t[i]).sort((o,a)=>a.length-o.length);for(let o of s)for(let a of["primary","alternate"])for(let l of e[a]){let[c,u]=l.split("/",2);r.push({k:c,v:u,n:o})}}return r}};function ZV(n){var e={},t=null;try{t=window.localStorage}catch{var r=new Map;t={isMocked:!0,hasItem:c=>r.has(c),getItem:c=>r.get(c),setItem:(c,u)=>r.set(c,u),removeItem:c=>r.delete(c),clear:()=>r.clear()}}function i(l,c){var u=n.url+l;if(arguments.length===1){var d=t.getItem(u)||"";return d.replace(/"/g,"")}else if(arguments.length===2)return c?t.setItem(u,c):t.removeItem(u)}e.authenticated=function(){return!!i("oauth2_access_token")},e.logout=function(){return i("oauth2_access_token",""),i("oauth_token",""),i("oauth_token_secret",""),i("oauth_request_token_secret",""),e},e.authenticate=function(l){if(e.authenticated()){l(null,e);return}e.logout(),s(function(c,u){c?l(c):QV(function(d){o(d,u,l)})})},e.authenticateAsync=function(){return e.authenticated()?Promise.resolve(e):(e.logout(),new Promise((l,c)=>{var u=(d,f)=>{d?c(d):l(f)};s((d,f)=>{d?u(d):QV(h=>o(h,f,u))})}))};function s(l){if(n.singlepage){l(null,void 0);return}var c=550,u=610,d=[["width",c],["height",u],["left",window.screen.width/2-c/2],["top",window.screen.height/2-u/2]].map(function(p){return p.join("=")}).join(","),f=window.open("about:blank","oauth_window",d);if(f)l(null,f);else{var h=new Error("Popup was blocked");h.status="popup-blocked",l(h)}}function o(l,c,u){var d=bae(),f=n.url+"/oauth2/authorize?"+KV({client_id:n.client_id,redirect_uri:n.redirect_uri,response_type:"code",scope:n.scope,state:d,code_challenge:l.code_challenge,code_challenge_method:l.code_challenge_method,locale:n.locale||""});if(n.singlepage){if(t.isMocked){var h=new Error("localStorage unavailable, but required in singlepage mode");h.status="pkce-localstorage-unavailable",u(h);return}var p=wD(window.location.search.slice(1));p.code?e.bootstrapToken(p.code,u):(i("oauth2_state",d),i("oauth2_pkce_code_verifier",l.code_verifier),window.location=f)}else e.popupWindow=c,c.location=f;window.authComplete=function(g){var y=wD(g.split("?")[1]);if(y.state!==d){var x=new Error("Invalid state");x.status="invalid-state",u(x);return}a(y.code,l.code_verifier,m),delete window.authComplete};function m(g,y){if(n.done(),g){u(g);return}var x=JSON.parse(y.response);i("oauth2_access_token",x.access_token),u(null,e)}}function a(l,c,u){var d=n.url+"/oauth2/token?"+KV({client_id:n.client_id,redirect_uri:n.redirect_uri,grant_type:"authorization_code",code:l,code_verifier:c});e.rawxhr("POST",d,null,null,null,u),n.loading()}return e.bringPopupWindowToFront=function(){var l=!1;try{e.popupWindow&&!e.popupWindow.closed&&(e.popupWindow.focus(),l=!0)}catch{}return l},e.bootstrapToken=function(l,c){var u=i("oauth2_state");i("oauth2_state","");var d=wD(window.location.search.slice(1));if(d.state!==u){var f=new Error("Invalid state");f.status="invalid-state",c(f);return}var h=i("oauth2_pkce_code_verifier");i("oauth2_pkce_code_verifier",""),a(l,h,p);function p(m,g){if(n.done(),m){c(m);return}var y=JSON.parse(g.response);i("oauth2_access_token",y.access_token),c(null,e)}},e.fetch=function(l,c){if(e.authenticated())return u();return n.auto?e.authenticateAsync().then(u):Promise.reject(new Error("not authenticated"));function u(){return c=c||{},c.headers||(c.headers={"Content-Type":"application/x-www-form-urlencoded"}),c.headers.Authorization="Bearer "+i("oauth2_access_token"),fetch(l,c)}},e.xhr=function(l,c){if(e.authenticated())return u();if(n.auto){e.authenticate(u);return}else{c("not authenticated",null);return}function u(){var f=l.prefix!==!1?n.apiUrl+l.path:l.path;return e.rawxhr(l.method,f,i("oauth2_access_token"),l.content,l.headers,d)}function d(f,h){f?c(f):h.responseXML?c(f,h.responseXML):c(f,h.response)}},e.rawxhr=function(l,c,u,d,f,h){f=f||{"Content-Type":"application/x-www-form-urlencoded"},u&&(f.Authorization="Bearer "+u);var p=new XMLHttpRequest;p.onreadystatechange=function(){p.readyState===4&&p.status!==0&&(/^20\d$/.test(p.status)?h(null,p):h(p,null))},p.onerror=function(g){h(g,null)},p.open(l,c,!0);for(var m in f)p.setRequestHeader(m,f[m]);return p.send(d),p},e.preauth=function(l){return l&&l.access_token&&i("oauth2_access_token",l.access_token),e},e.options=function(l){return arguments.length?(n=l,n.apiUrl=n.apiUrl||"https://api.openstreetmap.org",n.url=n.url||"https://www.openstreetmap.org",n.auto=n.auto||!1,n.singlepage=n.singlepage||!1,n.loading=n.loading||function(){},n.done=n.done||function(){},e.preauth(n)):n},e.options(n),e}function KV(n){return Object.keys(n).filter(function(e){return n[e]!==void 0}).sort().map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&")}function wD(n){for(var e=0;e<n.length&&(n[e]==="?"||n[e]==="#");)e++;return n=n.slice(e),n.split("&").reduce(function(t,r){var i=r.split("=");return i.length===2&&(t[i[0]]=decodeURIComponent(i[1])),t},{})}function JV(){return window&&window.crypto&&window.crypto.getRandomValues&&window.crypto.subtle&&window.crypto.subtle.digest}function QV(n){var e;if(JV()){var t=window.crypto.getRandomValues(new Uint8Array(32));e=SD(t.buffer);var r=Uint8Array.from(Array.from(e).map(function(o){return o.charCodeAt(0)}));window.crypto.subtle.digest("SHA-256",r).then(function(o){var a=SD(o);n({code_challenge:a,code_verifier:e,code_challenge_method:"S256"})})}else{var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";e="";for(var s=0;s<64;s++)e+=i[Math.floor(Math.random()*i.length)];n({code_verifier:e,code_challenge:e,code_challenge_method:"plain"})}}function bae(){var n;if(JV()){var e=window.crypto.getRandomValues(new Uint8Array(32));n=SD(e.buffer)}else{var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";n="";for(var r=0;r<64;r++)n+=t[Math.floor(Math.random()*t.length)]}return n}function SD(n){return btoa(String.fromCharCode.apply(null,new Uint8Array(n))).replace(/\//g,"_").replace(/\+/g,"-").replace(/[=]/g,"")}var i6=class extends Se{constructor(e){super(e),this.id="osm",this._maxWayNodes=2e3,this._imageryBlocklists=[/.*\.google(apis)?\..*\/(vt|kh)[\?\/].*([xyz]=.*){3}.*/],this._wwwroot="https://www.openstreetmap.org",this._apiroot="https://api.openstreetmap.org",this._tileCache={},this._noteCache={},this._userCache={},this._changeset={},this._tiler=new or,this._deferred=new Set,this._connectionID=0,this._tileZoom=16,this._noteZoom=12,this._apiStatus=null,this._rateLimit=null,this._userChangesets=null,this._userDetails=null,this._authLoading=this._authLoading.bind(this),this._authDone=this._authDone.bind(this),this._parseCapabilitiesJSON=this._parseCapabilitiesJSON.bind(this),this._parseCapabilitiesXML=this._parseCapabilitiesXML.bind(this),this._parseNodeJSON=this._parseNodeJSON.bind(this),this._parseNodeXML=this._parseNodeXML.bind(this),this._parseNoteXML=this._parseNoteXML.bind(this),this._parseRelationJSON=this._parseRelationJSON.bind(this),this._parseRelationXML=this._parseRelationXML.bind(this),this._parseUserXML=this._parseUserXML.bind(this),this._parseWayJSON=this._parseWayJSON.bind(this),this._parseWayXML=this._parseWayXML.bind(this),this.reloadApiStatus=this.reloadApiStatus.bind(this),this.throttledReloadApiStatus=mn(this.reloadApiStatus,500);let t,r=window.location.origin;if(/^https:\/\/(mapwith\.ai|rapideditor\.org)/i.test(r))t=`${r}/rapid/land.html`;else if(/^https?:\/\/127.0.0.1:8080/i.test(r))t=`${r}/dist/land.html`;else{let i=window.location.pathname,s=i.split("/");s.at(-1).includes(".")&&(s.pop(),i=s.join("/")||"/"),i.charAt(i.length-1)!=="/"&&(i+="/"),t=`${r}${i}land.html`}this._oauth=ZV({url:this._wwwroot,apiUrl:this._apiroot,client_id:"O3g0mOUuA2WY5Fs826j5tP260qR3DDX7cIIE2R2WWSc",client_secret:"b4aeHD1cNeapPPQTrvpPoExqQRjybit6JBlNnxh62uE",scope:"read_prefs write_prefs write_api read_gpx write_notes",redirect_uri:t,loading:this._authLoading,done:this._authDone})}initAsync(){return this.resetAsync()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._deferred)window.cancelIdleCallback(e),this._deferred.delete(e);return this._connectionID++,this._apiStatus=null,this._rateLimit=null,this._userChangesets=null,this._userDetails=null,this._tileCache.inflight&&Object.values(this._tileCache.inflight).forEach(this._abortRequest),this._noteCache.inflight&&Object.values(this._noteCache.inflight).forEach(this._abortRequest),this._noteCache.inflightPost&&Object.values(this._noteCache.inflightPost).forEach(this._abortRequest),this._changeset.inflight&&this._abortRequest(this._changeset.inflight),this._tileCache={lastv:null,toLoad:new Set,loaded:new Set,inflight:{},seen:new Set,rbush:new Tt},this._noteCache={lastv:null,toLoad:new Set,loaded:new Set,inflight:{},inflightPost:{},note:{},closed:{},rbush:new Tt},this._userCache={toLoad:new Set,user:{}},this._changeset={},Promise.resolve()}switchAsync(e){this._wwwroot=e.url,this._apiroot=e.apiUrl;let t=Ir(this._oauth.options(),"access_token");return this._oauth.options(Object.assign(t,e)),this.resetAsync().then(()=>{this.emit("authchange")})}get connectionID(){return this._connectionID}get wwwroot(){return this._wwwroot}get imageryBlocklists(){return this._imageryBlocklists}get maxWayNodes(){return this._maxWayNodes}changesetURL(e){return`${this._wwwroot}/changeset/${e}`}changesetsURL(e,t){let r=Math.max(0,Math.ceil(Math.log(t)/Math.LN2));return this._wwwroot+"/history#map="+Math.floor(t)+"/"+e[1].toFixed(r)+"/"+e[0].toFixed(r)}entityURL(e){let t=e.osmId();return`${this._wwwroot}/${e.type}/${t}`}historyURL(e){let t=e.osmId();return`${this._wwwroot}/${e.type}/${t}/history`}userURL(e){return`${this._wwwroot}/user/${e}`}noteURL(e){return`${this._wwwroot}/note/${e.id}`}noteReportURL(e){return`${this._wwwroot}/reports/new?reportable_type=Note&reportable_id=${e.id}`}loadFromAPI(e,t,r){r=Object.assign({skipSeen:!0},r);let i=this._connectionID,s=(c,u)=>{if(this._connectionID!==i){t&&t({message:"Connection Switched",status:-1});return}if(this.authenticated()&&(c?.status===400||c?.status===401||c?.status===403)){this.logout(),this.loadFromAPI(e,t,r);return}else if(c?c.status===509||c.status===429?c.response.text().then(f=>{let h=10,p=f.match(/ (\d+) seconds/);p&&(h=parseInt(p[1],10)),this.setRateLimit(h)}).then(()=>this.throttledReloadApiStatus()):this._apiStatus!=="error"&&this.throttledReloadApiStatus():(this._rateLimit&&(this._rateLimit=null,this.throttledReloadApiStatus()),this._apiStatus==="error"&&this.throttledReloadApiStatus()),t)return c?t(c):e.includes(".json")?this._parseJSON(u,t,r):this._parseXML(u,t,r)},o=this._apiroot+e,a=new AbortController;return(this.authenticated()?this._oauth.fetch:window.fetch)(o,{signal:a.signal}).then(Ae).then(c=>s(null,c)).catch(c=>{if(c.name!=="AbortError"&&c.name==="FetchError"){s(c);return}}),a}loadEntity(e,t){let r=me.id.type(e),i=me.id.toOSM(e),s={skipSeen:!1},o=r!=="node"?"/full":"";this.loadFromAPI(`/api/0.6/${r}/${i}${o}.json`,t,s)}loadEntityVersion(e,t,r){let i=me.id.type(e),s=me.id.toOSM(e),o={skipSeen:!1};this.loadFromAPI(`/api/0.6/${i}/${s}/${t}.json`,r,o)}loadEntityRelations(e,t){let r=me.id.type(e),i=me.id.toOSM(e),s={skipSeen:!1};this.loadFromAPI(`/api/0.6/${r}/${i}/relations.json`,t,s)}loadMultiple(e,t){let r=hr(Ge(e),me.id.type),i={skipSeen:!1};for(let[s,o]of Object.entries(r)){let a=s+"s",l=o.map(c=>me.id.toOSM(c));for(let c of ch(l,150))this.loadFromAPI(`/api/0.6/${a}.json?${a}=`+c.join(),t,i)}}createChangeset(e,t){if(this._changeset.inflight)return t({message:"Changeset already inflight",status:-2});if(!this.authenticated())return t({message:"Not Authenticated",status:-3});let r=(l,c)=>{if(this._changeset.inflight=null,l)return t(l,e);this._changeset.openChangesetID=c,e=e.update({id:c}),t(null,e)};if(this._changeset.openChangesetID)return r(null,this._changeset.openChangesetID);let i=this._wrapcb(r),s=this._apiroot+"/api/0.6/changeset/create",o=new AbortController,a={method:"PUT",headers:{"Content-Type":"text/xml"},body:ea.stringify(e.asJXON()),signal:o.signal};this._oauth.fetch(s,a).then(Ae).then(l=>i(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){i(l);return}}),this._changeset.inflight=o}uploadChangeset(e,t,r){if(this._changeset.inflight)return r({message:"Changeset already inflight",status:-2});if(this.authenticated()){if(e.id!==this._changeset.openChangesetID)return r({message:"Changeset ID mismatch",status:-4})}else return r({message:"Not Authenticated",status:-3});let i=u=>{this._changeset.inflight=null,r(u,e)},s=this._wrapcb(i),o=this._apiroot+`/api/0.6/changeset/${e.id}/upload`,a=new AbortController,l={method:"POST",headers:{"Content-Type":"text/xml"},body:ea.stringify(e.osmChangeJXON(t)),signal:a.signal};this.context.systems.editor.clearBackup(),this._oauth.fetch(o,l).then(Ae).then(u=>s(null,u)).catch(u=>{if(this._changeset.inflight=null,u.name!=="AbortError"&&u.name==="FetchError"){s(u);return}}),this._changeset.inflight=a}closeChangeset(e,t){if(this._changeset.inflight)return t({message:"Changeset already inflight",status:-2});if(this.authenticated()){if(e.id!==this._changeset.openChangesetID)return t({message:"Changeset ID mismatch",status:-4})}else return t({message:"Not Authenticated",status:-3});let r=l=>{this._changeset.inflight=null,this._changeset.openChangesetID=null,t(l,e)},i=this._wrapcb(r),s=this._apiroot+`/api/0.6/changeset/${e.id}/close`,o=new AbortController,a={method:"PUT",headers:{"Content-Type":"text/xml"},signal:o.signal};this._oauth.fetch(s,a).then(Ae).then(l=>i(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){i(l);return}}),this._changeset.inflight=o}sendChangeset(e,t,r){let i=this._connectionID;this.createChangeset(e,(s,o)=>{if(e=o,s)return r(s,e);this.uploadChangeset(e,t,(a,l)=>{if(e=l,a)return r(a,e);window.setTimeout(()=>{this._changeset.openChangesetID=null,r(null,e)},2500),this.connectionID===i&&this.closeChangeset(e,()=>{})})})}loadUsers(e,t){let r=[],i=[];for(let a of Ge(e))this._userCache.user[a]?(this._userCache.toLoad.delete(a),i.push(this._userCache.user[a])):r.push(a);if((i.length||!this.authenticated())&&(t(null,i),!this.authenticated()))return;let s=(a,l)=>{if(a)return t(a);t(null,l.data)},o={skipSeen:!0};for(let a of ch(r,150))this.loadFromAPI("/api/0.6/users.json?users="+a.join(),s,o)}loadUser(e,t){if(this._userCache.user[e]||!this.authenticated())return this._userCache.toLoad.delete(e),t(null,this._userCache.user[e]);let r=(s,o)=>{if(s)return t(s);t(null,o.data[0])},i={skipSeen:!0};this.loadFromAPI(`/api/0.6/user/${e}.json`,r,i)}_parseUserPreferencesXML(e,t){let r={},i=e.getElementsByTagName("preference");for(let s=0;s<i.length;s++){let o=i[s],a=o.getAttribute("k"),l=o.getAttribute("v");a&&l&&(r[a]=l)}t(null,{data:r})}loadMapRouletteKey(e){if(!this.authenticated())return e(null,{});this._oauth.xhr({method:"GET",path:"/api/0.6/user/preferences"},(t,r)=>{if(t)return console.error("Error in loadUserPreferences:",t),e(t);this._parseUserPreferencesXML(r,(i,s)=>i?e(i):e(null,s.data))})}userDetails(e){if(this._userDetails)return e(null,this._userDetails);let t=(i,s)=>{if(i)return e(i);this._userDetails=s.data[0],e(null,this._userDetails)},r={skipSeen:!1};this.loadFromAPI("/api/0.6/user/details.json",t,r)}userChangesets(e){if(this._userChangesets)return e(null,this._userChangesets);let t=(s,o)=>s?e(s):(this._userChangesets=o.data,e(null,this._userChangesets)),r={skipSeen:!1},i=(s,o)=>{if(s)return e(s);this.loadFromAPI(`/api/0.6/changesets.json?user=${o.id}`,t,r)};this.userDetails(i)}status(e){let t=(s,o)=>{if(s?.message==="Connection Switched"){this._apiStatus=null,this.status(e);return}else{if(s)return e(s,"error");if(this._rateLimit)return e(null,"ratelimit");{let a=this._parseCapabilitiesJSON(o);return e(null,a)}}},r=this._apiroot+"/api/capabilities.json",i=this._wrapcb(t);fetch(r).then(Ae).then(s=>i(null,s)).catch(s=>i(s))}reloadApiStatus(){this.status((e,t)=>{t!==this._apiStatus&&(this._apiStatus=t,this.emit("apistatuschange",e,t))})}loadTiles(e){if(this._paused||this.getRateLimit())return;let t=this._tileCache,r=this.context.viewport;if(t.lastv===r.v)return;t.lastv=r.v;let i=this._tiler.zoomRange(this._tileZoom).getTiles(r).tiles,s=this._hasInflightRequests(t);this._abortUnwantedRequests(t,i),s&&!this._hasInflightRequests(t)&&this.emit("loaded");for(let o of i)this.loadTile(o,e)}setRateLimit(e=10){return isNaN(e)||!isFinite(e)||e<=0?this._rateLimit:this._rateLimit&&this._rateLimit.remaining>=e?this._rateLimit:(this._tileCache.toLoad.clear(),this._noteCache.toLoad.clear(),Object.values(this._tileCache.inflight).forEach(this._abortRequest),Object.values(this._noteCache.inflight).forEach(this._abortRequest),this._rateLimit={start:Math.floor(Date.now()/1e3),duration:e,remaining:e,elapsed:0})}getRateLimit(){if(!this._rateLimit)return null;let e=Math.floor(Date.now()/1e3),t=this._rateLimit.start??e,r=this._rateLimit.duration??10,i=e-t;i<-5&&(this._rateLimit.start=e,i=0);let s=r-i;return s>0?(this._rateLimit.remaining=s,this._rateLimit.elapsed=i,this._rateLimit):(this._rateLimit=null,null)}loadTile(e,t){if(this._paused||this.getRateLimit())return;let r=this._tileCache;if(r.loaded.has(e.id)||r.inflight[e.id])return;let i=this.context.systems.locations;if(e.wgs84Extent.polygon().slice(0,4).every(u=>i.blocksAt(u).length)){r.loaded.add(e.id);return}this._hasInflightRequests(r)||this.emit("loading");let a=(u,d)=>{if(delete r.inflight[e.id],!u){r.toLoad.delete(e.id),r.loaded.add(e.id);let f=e.wgs84Extent.bbox();f.id=e.id,r.rbush.insert(f)}t&&t(u,Object.assign({},d,{tile:e})),this._hasInflightRequests(r)||this.emit("loaded")},l="/api/0.6/map.json?bbox=",c={skipSeen:!0};r.inflight[e.id]=this.loadFromAPI(l+e.wgs84Extent.toParam(),a,c)}isDataLoaded(e){let t={minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]};return this._tileCache.rbush.collides(t)}loadTileAtLoc(e,t){if(this._paused||this.getRateLimit())return;let r=this._tileCache;if(r.toLoad.size>50)return;let i=gi(this._tileZoom+1),s=new Rn({k:i}).project(e),o=new Rn({k:i,x:-s[0],y:-s[1]}),a=this._tiler.zoomRange(this._tileZoom).getTiles(o).tiles;for(let l of a)r.toLoad.has(l.id)||r.loaded.has(l.id)||r.inflight[l.id]||(r.toLoad.add(l.id),this.loadTile(l,t))}loadNotes(e){if(this._paused||this.getRateLimit())return;e=Object.assign({limit:1e4,closed:7},e);let t=this._noteCache,r=this,i="/api/0.6/notes?limit="+e.limit+"&closed="+e.closed+"&bbox=",s=mn(()=>{let l=[...r._userCache.toLoad.values()];l.length&&r.loadUsers(l,function(){})},750),o=this.context.viewport;if(t.lastv===o.v)return;t.lastv=o.v;let a=this._tiler.zoomRange(this._noteZoom).getTiles(o).tiles;this._abortUnwantedRequests(t,a);for(let l of a){if(t.loaded.has(l.id)||t.inflight[l.id])continue;let c=this.context.systems.locations;if(l.wgs84Extent.polygon().slice(0,4).every(h=>c.blocksAt(h).length)){t.loaded.add(l.id);continue}let f={skipSeen:!1};t.inflight[l.id]=this.loadFromAPI(i+l.wgs84Extent.toParam(),function(h){delete r._noteCache.inflight[l.id],h||r._noteCache.loaded.add(l.id),r.context.systems.gfx.deferredRedraw(),r.emit("loadedNotes")},f)}}loadNote(e,t){let r={skipSeen:!1},i=(s,o)=>{t&&(t(s,{data:o}),this.context.systems.gfx.deferredRedraw(),this.emit("loadedNotes"))};this.loadFromAPI(`/api/0.6/notes/${e}`,i,r)}postNoteCreate(e,t){if(this._noteCache.inflightPost[e.id])return t({message:"Note update already inflight",status:-2},e);if(!this.authenticated())return t({message:"Not Authenticated",status:-3},e);if(!e.loc[0]||!e.loc[1]||!e.newComment)return;let r=(l,c)=>{if(delete this._noteCache.inflightPost[e.id],l)return t(l);this.removeNote(e);let u={skipSeen:!1};return this._parseXML(c,(d,f)=>d?t(d):(this.context.systems.gfx.deferredRedraw(),this.emit("loadedNotes"),t(null,f.data[0])),u)},i=this._wrapcb(r),s=this._apiroot+"/api/0.6/notes?"+ft({lon:e.loc[0],lat:e.loc[1],text:e.newComment}),o=new AbortController,a={method:"POST",signal:o.signal};this._oauth.fetch(s,a).then(Ae).then(l=>i(null,l)).catch(l=>{if(this._changeset.inflight=null,l.name!=="AbortError"&&l.name==="FetchError"){i(l);return}}),this._noteCache.inflightPost[e.id]=o}postNoteUpdate(e,t,r){if(!this.authenticated())return r({message:"Not Authenticated",status:-3},e);if(this._noteCache.inflightPost[e.id])return r({message:"Note update already inflight",status:-2},e);let i;if(e.status!=="closed"&&t==="closed")i="close";else if(e.status!=="open"&&t==="open")i="reopen";else if(i="comment",!e.newComment)return;let s=(u,d)=>{if(delete this._noteCache.inflightPost[e.id],u)return r(u);this.removeNote(e),i==="close"?this._noteCache.closed[e.id]=!0:i==="reopen"&&delete this._noteCache.closed[e.id];let f={skipSeen:!1};return this._parseXML(d,(h,p)=>h?r(h):(this.context.systems.gfx.deferredRedraw(),this.emit("loadedNotes"),r(null,p.data[0])),f)},o=this._wrapcb(s),a=this._apiroot+`/api/0.6/notes/${e.id}/${i}`;e.newComment&&(a+="?"+ft({text:e.newComment}));let l=new AbortController,c={method:"POST",signal:l.signal};this._oauth.fetch(a,c).then(Ae).then(u=>o(null,u)).catch(u=>{if(this._changeset.inflight=null,u.name!=="AbortError"&&u.name==="FetchError"){o(u);return}}),this._noteCache.inflightPost[e.id]=l}caches(e){function t(r){let i={};for(let[s,o]of Object.entries(r))if(s==="rbush")i.rbush=new Tt().fromJSON(o.toJSON());else if(s==="toLoad"||s==="loaded"||s==="seen")i[s]=new Set(o);else if(s==="note"){i.note={};for(let a of Object.keys(o))i.note[a]=r.note[a].update({})}else i[s]=JSON.parse(JSON.stringify(o));return i}return e===void 0?{tile:t(this._tileCache),note:t(this._noteCache),user:t(this._userCache)}:e==="get"?{tile:this._tileCache,note:this._noteCache,user:this._userCache}:(e.tile&&(this._tileCache=e.tile,this._tileCache.inflight={}),e.note&&(this._noteCache=e.note,this._noteCache.inflight={},this._noteCache.inflightPost={}),e.user&&(this._userCache=e.user),this)}logout(){return this._rateLimit=null,this._userChangesets=null,this._userDetails=null,this._oauth.logout(),this.emit("authchange"),this}authenticated(){return this._oauth.authenticated()}authenticate(e){let t=this._connectionID;this._rateLimit=null,this._userChangesets=null,this._userDetails=null;let r=(s,o)=>{if(s){e&&e(s);return}if(this._connectionID!==t){e&&e({message:"Connection Switched",status:-1});return}this.reloadApiStatus(),this.userChangesets(function(){}),this.emit("authchange"),e&&e(s,o)},i=this.context.systems.l10n.localeCode();this._oauth.options({...this._oauth.options(),locale:i}),this._oauth.authenticate(r),this._oauth.bringPopupWindowToFront()}getNotes(){let e=this.context.viewport.visibleExtent();return this._noteCache.rbush.search(e.bbox()).map(t=>t.data)}getNote(e){return this._noteCache.note[e]}removeNote(e){!(e instanceof Qe)||!e.id||(delete this._noteCache.note[e.id],this._updateRBush(this._encodeNoteRBush(e),!1))}replaceNote(e){if(!(!(e instanceof Qe)||!e.id))return this._noteCache.note[e.id]=e,this._updateRBush(this._encodeNoteRBush(e),!0),e}getClosedIDs(){return Object.keys(this._noteCache.closed).sort()}_authLoading(){this.emit("authLoading")}_authDone(){this.emit("authDone")}_abortRequest(e){e&&e.abort()}_hasInflightRequests(e){return Object.keys(e.inflight).length}_abortUnwantedRequests(e,t){for(let r of Object.keys(e.inflight))e.toLoad.has(r)||t.find(i=>i.id===r)||(this._abortRequest(e.inflight[r]),delete e.inflight[r])}_getLoc(e){let t=e.lon?.value,r=e.lat?.value;return[parseFloat(t),parseFloat(r)]}_getNodes(e){return Array.from(e.getElementsByTagName("nd")).map(r=>"n"+r.attributes.ref.value)}_getNodesJSON(e){return(e.nodes??[]).map(t=>"n"+t)}_getTags(e){let t=Array.from(e.getElementsByTagName("tag")),r={};for(let i of t){let s=i.attributes,o=(s.k.value??"").trim(),a=(s.v.value??"").trim();o&&(r[o]=a)}return r}_getMembers(e){return Array.from(e.getElementsByTagName("member")).map(r=>{let i=r.attributes;return{id:i.type.value[0]+i.ref.value,type:i.type.value,role:i.role.value}})}_getMembersJSON(e){return(e.members??[]).map(t=>({id:t.type[0]+t.ref,type:t.type,role:t.role}))}_parseComments(e){let t=[];for(let r of e)if(r.nodeName==="comment"){let i={};for(let s of r.childNodes){let o=s.nodeName;if(o!=="#text"&&(i[o]=s.textContent,o==="uid")){let a=s.textContent;a&&!this._userCache.user[a]&&this._userCache.toLoad.add(a)}}Object.keys(i).length&&t.push(i)}return t}_encodeNoteRBush(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_parseJSON(e,t,r){if(r=Object.assign({skipSeen:!0},r),!e)return t({message:"No JSON",status:-1});let i=e;typeof i!="object"&&(i=JSON.parse(e));let s=i.elements??[],o=(i.user?[i.user]:i.users)??[],a=i?.changesets||[];if(!s||!o||!a)return t({message:"No JSON",status:-1});if(s.some(c=>c.type==="error"))return t({message:"Partial JSON",status:-1});let l=window.requestIdleCallback(()=>{this._deferred.delete(l);let c={data:[],seenIDs:new Set};for(let u of s){let d;if(u.type==="node"?d=this._parseNodeJSON:u.type==="way"?d=this._parseWayJSON:u.type==="relation"&&(d=this._parseRelationJSON),!d)continue;let f=me.id.fromOSM(u.type,u.id);if(c.seenIDs.add(f),r.skipSeen){if(this._tileCache.seen.has(f))continue;this._tileCache.seen.add(f)}let h=d(u,f);h&&c.data.push(h)}for(let u of o){let d=u.id?.toString();if(!d||(this._userCache.toLoad.delete(d),c.seenIDs.add(d),r.skipSeen&&this._userCache.user[d]))continue;let f={id:d,display_name:u.display_name,account_created:u.account_created,image_url:u.img?.href,changesets_count:u.changesets?.count?.toString()??"0",active_blocks:u.blocks?.received?.active?.toString()??"0"};this._userCache.user[d]=f,c.data.push(f)}for(let u of a)u?.tags?.comment&&c.data.push(u);t(null,c)});this._deferred.add(l)}_parseXML(e,t,r){if(r=Object.assign({skipSeen:!0},r),!e||!e.childNodes)return t({message:"No XML",status:-1});let i=e.childNodes[0],s=Array.from(i.childNodes);if(s.some(a=>a.nodename==="error"))return t({message:"Partial XML",status:-1});let o=window.requestIdleCallback(()=>{this._deferred.delete(o);let a={data:[],seenIDs:new Set};for(let l of s){let c;if(l.nodeName==="node"?c=this._parseNodeXML:l.nodeName==="way"?c=this._parseWayXML:l.nodeName==="relation"?c=this._parseRelationXML:l.nodeName==="note"?c=this._parseNoteXML:l.nodeName==="user"&&(c=this._parseUserXML),!c)continue;let u;if(l.nodeName==="user"){if(u=l.attributes.id.value,a.seenIDs.add(u),r.skipSeen&&this._userCache.user[u]){this._userCache.toLoad.delete(u);continue}}else if(l.nodeName==="note")u=l.getElementsByTagName("id")[0].textContent,a.seenIDs.add(u);else if(u=me.id.fromOSM(l.nodeName,l.attributes.id.value),a.seenIDs.add(u),r.skipSeen){if(this._tileCache.seen.has(u))continue;this._tileCache.seen.add(u)}let d=c(l,u);d&&a.data.push(d)}t(null,a)});this._deferred.add(o)}_parseNodeJSON(e,t){return new Le({id:t,visible:typeof e.visible=="boolean"?e.visible:!0,version:e.version?.toString(),changeset:e.changeset?.toString(),timestamp:e.timestamp,user:e.user,uid:e.uid?.toString(),loc:[parseFloat(e.lon),parseFloat(e.lat)],tags:e.tags})}_parseWayJSON(e,t){return new Rt({id:t,visible:typeof e.visible=="boolean"?e.visible:!0,version:e.version?.toString(),changeset:e.changeset?.toString(),timestamp:e.timestamp,user:e.user,uid:e.uid?.toString(),tags:e.tags,nodes:this._getNodesJSON(e)})}_parseRelationJSON(e,t){return new mr({id:t,visible:typeof e.visible=="boolean"?e.visible:!0,version:e.version?.toString(),changeset:e.changeset?.toString(),timestamp:e.timestamp,user:e.user,uid:e.uid?.toString(),tags:e.tags,members:this._getMembersJSON(e)})}_parseNodeXML(e,t){let r=e.attributes;return new Le({id:t,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:r.changeset?.value,timestamp:r.timestamp?.value,user:r.user?.value,uid:r.uid?.value,loc:this._getLoc(r),tags:this._getTags(e)})}_parseWayXML(e,t){let r=e.attributes;return new Rt({id:t,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:r.changeset?.value,timestamp:r.timestamp?.value,user:r.user?.value,uid:r.uid?.value,tags:this._getTags(e),nodes:this._getNodes(e)})}_parseRelationXML(e,t){let r=e.attributes;return new mr({id:t,visible:!r.visible||r.visible.value!=="false",version:r.version.value,changeset:r.changeset?.value,timestamp:r.timestamp?.value,user:r.user?.value,uid:r.uid?.value,tags:this._getTags(e),members:this._getMembers(e)})}_parseNoteXML(e,t){let r=e.attributes,i=e.childNodes,s={};s.id=t,s.loc=this._getLoc(r);let o=!1,a=1e-5;do{o&&(s.loc=bt(s.loc,[a,a]));let u=new le(s.loc).bbox();o=this._noteCache.rbush.search(u).length}while(o);for(let u of i){let d=u.nodeName;d!=="#text"&&(d==="comments"?s[d]=this._parseComments(u.childNodes):s[d]=u.textContent)}let l=new Qe(this,null,s.id,s),c=this._encodeNoteRBush(l);return this._noteCache.note[l.id]=l,this._noteCache.rbush.insert(c),l}_parseUserXML(e,t){let r=e.attributes,i={id:t,display_name:r.display_name?.value,account_created:r.account_created?.value,changesets_count:"0",active_blocks:"0"},s=e.getElementsByTagName("img");s&&s[0]&&s[0].getAttribute("href")&&(i.image_url=s[0].getAttribute("href"));let o=e.getElementsByTagName("changesets");o&&o[0]&&o[0].getAttribute("count")&&(i.changesets_count=o[0].getAttribute("count"));let a=e.getElementsByTagName("blocks");if(a&&a[0]){let l=a[0].getElementsByTagName("received");l&&l[0]&&l[0].getAttribute("active")&&(i.active_blocks=l[0].getAttribute("active"))}return this._userCache.user[t]=i,this._userCache.toLoad.delete(t),i}_parseCapabilitiesJSON(e){let t=[];for(let s of e.policy.imagery.blacklist){let o=s.regex;if(o)try{t.push(new RegExp(o))}catch{}}t.length&&(this._imageryBlocklists=t);let r=e.api.waynodes.maximum;return r&&isFinite(r)&&(this._maxWayNodes=r),e.api.status.api}_parseCapabilitiesXML(e){let t=[];for(let o of e.getElementsByTagName("blacklist")){let a=o.getAttribute("regex");if(a)try{t.push(new RegExp(a))}catch{}}t.length&&(this._imageryBlocklists=t);let r=e.getElementsByTagName("waynodes"),i=r.length&&parseInt(r[0].getAttribute("maximum"),10);return i&&isFinite(i)&&(this._maxWayNodes=i),e.getElementsByTagName("status")[0].getAttribute("api")}_updateRBush(e,t){this._noteCache.rbush.remove(e,(r,i)=>r.data.id===i.data.id),t&&this._noteCache.rbush.insert(e)}_wrapcb(e){let t=this._connectionID;return(r,i)=>r?((r.status===400||r.status===401||r.status===403)&&this.logout(),e.call(this,r)):this._connectionID!==t?e.call(this,{message:"Connection Switched",status:-1}):e.call(this,r,i)}};var _ae=14,iv="https://osmose.openstreetmap.fr/api/0.3",s6=class extends Se{constructor(e){super(e),this.id="osmose",this.autoStart=!1,this._startPromise=null,this._osmoseColors=new Map,this._osmoseStrings=new Map,this._osmoseData={icons:{},types:[]},this._cache=null,this._tiler=new or().zoomRange(_ae).skipNullIsland(!0),this._lastv=null}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context.systems.assets;return this._startPromise=e.loadAssetAsync("qa_data").then(t=>{this._osmoseData.icons=t.osmose.icons,this._osmoseData.types=Object.keys(t.osmose.icons).map(r=>r.split("-")[0]).reduce((r,i)=>r.indexOf(i)!==-1?r:[...r,i],[])}).then(()=>this._loadStringsAsync()).then(()=>this._started=!0).catch(t=>{t instanceof Error&&console.error(t),this._startPromise=null})}resetAsync(){return this._cache&&Object.values(this._cache.inflightTile).forEach(e=>this._abortRequest(e)),this._cache={issues:new Map,loadedTile:{},inflightTile:{},inflightPost:{},closed:{},rbush:new Tt},this._lastv=null,Promise.resolve()}getData(){let e=this.context.viewport.visibleExtent();return this._cache.rbush.search(e.bbox()).map(t=>t.data)}loadTiles(){let e=this.context.viewport;if(this._lastv===e.v)return;this._lastv=e.v;let t=this._tiler.getTiles(e).tiles;this._abortUnwantedRequests(this._cache,t);for(let r of t){if(this._cache.loadedTile[r.id]||this._cache.inflightTile[r.id])continue;let[i,s,o]=r.xyz,a={item:this._osmoseData.types},l=`${iv}/issues/${o}/${i}/${s}.json?`+ft(a),c=new AbortController;this._cache.inflightTile[r.id]=c,fetch(l,{signal:c.signal}).then(Ae).then(u=>{this._cache.loadedTile[r.id]=!0;for(let f of u.features??[]){let{item:h,class:p,uuid:m}=f.properties,g=`${h}-${p}`;if(g in this._osmoseData.icons){let y=this._preventCoincident(this._cache.rbush,f.geometry.coordinates),x=new Qe(this,g,m,{loc:y,item:h});(h===8300||h===8360)&&(x.elems=[]),this._cache.issues.set(x.id,x),this._cache.rbush.insert(this._encodeIssueRBush(x))}}this.context.systems.gfx.deferredRedraw(),this.emit("loadedData")}).catch(u=>{u.name!=="AbortError"&&(this._cache.loadedTile[r.id]=!0)}).finally(()=>{delete this._cache.inflightTile[r.id]})}}loadIssueDetailAsync(e){if(e.elems!==void 0)return Promise.resolve(e);let t=this.context.systems.l10n.localeCode(),r=`${iv}/issue/${e.id}?langs=${t}`,i=s=>{e.elems=s.elems.map(o=>o.type.substring(0,1)+o.id),e.detail=s.subtitle?qe.parse(s.subtitle.auto):"",this.replaceItem(e)};return fetch(r).then(Ae).then(i).then(()=>e)}getStrings(e,t){return t=t||this.context.systems.l10n.localeCode(),(this._osmoseStrings.get(t)??{})[e]??{}}getColor(e){return this._osmoseColors.get(e)??16777215}getIcon(e){return this._osmoseData.icons[e]}postUpdate(e,t){if(this._cache.inflightPost[e.id])return t({message:"Issue update already inflight",status:-2},e);let r=`${iv}/issue/${e.id}/${e.newStatus}`,i=new AbortController,s=()=>{delete this._cache.inflightPost[e.id],this.removeItem(e),e.newStatus==="done"&&(e.item in this._cache.closed||(this._cache.closed[e.item]=0),this._cache.closed[e.item]+=1),t&&t(null,e)};this._cache.inflightPost[e.id]=i,fetch(r,{signal:i.signal}).then(s).catch(o=>{delete this._cache.inflightPost[e.id],t&&t(o.message)})}getError(e){return this._cache.issues.get(e)}replaceItem(e){if(!(!(e instanceof Qe)||!e.id))return this._cache.issues.set(e.id,e),this._updateRBush(this._encodeIssueRBush(e),!0),e}removeItem(e){!(e instanceof Qe)||!e.id||(this._cache.isseus.delete(e.id),this._updateRBush(this._encodeIssueRBush(e),!1))}getClosedCounts(){return this._cache.closed}itemURL(e){return`https://osmose.openstreetmap.fr/en/error/${e.id}`}_abortRequest(e){e&&e.abort()}_abortUnwantedRequests(e,t){Object.keys(e.inflightTile).forEach(r=>{t.find(s=>r===s.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])})}_encodeIssueRBush(e){return{minX:e.loc[0],minY:e.loc[1],maxX:e.loc[0],maxY:e.loc[1],data:e}}_updateRBush(e,t){this._cache.rbush.remove(e,(r,i)=>r.data.id===i.data.id),t&&this._cache.rbush.insert(e)}_preventCoincident(e,t){for(let r=0;;r++){t=Me(t,[0,r*1e-5]);let i={minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]};if(!e.collides(i))return t}}_loadStringsAsync(){let e=Object.keys(this._osmoseData.icons),t={},r=this.context.systems.l10n.localeCode();this._osmoseStrings.set(r,t);let i=e.map(s=>{let o=u=>{let[d={items:[]}]=u.categories,[f={class:[]}]=d.items,[h=null]=f.class;if(!h){console.log(`Osmose strings request (${s}) had unexpected data`);return}let p=f.item;this._osmoseColors.set(p,new ce(f.color).toNumber());let{title:m,detail:g,fix:y,trap:x}=h,b={};m&&(b.title=m.auto.charAt(0).toUpperCase()+m.auto.slice(1)),g&&(b.detail=qe.parse(g.auto)),x&&(b.trap=qe.parse(x.auto)),y&&(b.fix=qe.parse(y.auto)),t[s]=b},[a,l]=s.split("-"),c=`${iv}/items/${a}/class/${l}?langs=${r}`;return fetch(c).then(Ae).then(o)}).filter(Boolean);return Promise.all(i)}};var o6=class extends Se{constructor(e){super(e),this.id="osmwikibase",this.apibase="https://wiki.openstreetmap.org/w/api.php",this._inflight={},this._cache={},this._localeIDs={en:!1},this.claimToValue=this.claimToValue.bind(this),this.monolingualClaimToValueObj=this.monolingualClaimToValueObj.bind(this),this.toSitelink=this.toSitelink.bind(this),this.getEntity=this.getEntity.bind(this),this.getDocs=this.getDocs.bind(this),this._request=this._request.bind(this),this._debouncedRequest=Xt(this._request,500,{leading:!1})}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._debouncedRequest.cancel(),Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},Promise.resolve()}claimToValue(e,t,r){if(!e.claims[t])return;let i=this._localeIDs[r],s,o;for(let l of e.claims[t]){!s&&l.rank==="preferred"&&(s=l);let c=l.qualifiers?.P26&&l.qualifiers.P26[0].datavalue.value.id;i&&c===i&&(o=l)}let a=o??s;if(a){let l=a.mainsnak.datavalue;return l.type==="wikibase-entityid"?l.value.id:l.value}else return}monolingualClaimToValueObj(e,t){if(e?.claims[t])return e.claims[t].reduce(function(r,i){var s=i.mainsnak.datavalue.value;return r[s.language]=s.text,r},{})}toSitelink(e,t){return(t?`Tag:${e}=${t}`:`Key:${e}`).replace(/_/g," ").trim()}getEntity(e,t){let r=e.debounce?this._debouncedRequest:this._request,i=e.key==="type"&&e.value?`Relation:${e.value}`.replace(/_/g," ").trim():!1,s=e.key?this.toSitelink(e.key):!1,o=e.key&&e.value?this.toSitelink(e.key,e.value):!1,a=[],l={},c;if(e.langCodes)for(let f of e.langCodes)this._localeIDs[f]===void 0&&(c=`Locale:${f}`.replace(/_/g," ").trim(),a.push(c));if(i&&(this._cache[i]?l.rtype=this._cache[i]:a.push(i)),s&&(this._cache[s]?l.key=this._cache[s]:a.push(s)),o&&(this._cache[o]?l.tag=this._cache[o]:a.push(o)),!a.length)return t(null,l);let u={action:"wbgetentities",sites:"wiki",titles:a.join("|"),languages:e.langCodes.join("|"),languagefallback:1,origin:"*",format:"json"},d=this.apibase+"?"+ft(u);r(d,(f,h)=>{if(f)t(f);else if(!h.success||h.error)t(h.error.messages.map(p=>p.html["*"]).join("<br>"));else{let p=!1;for(let m of Object.values(h.entities))if(m.missing!==""){let g=m.sitelinks.wiki.title;g===i?(this._cache[i]=m,l.rtype=m):g===s?(this._cache[s]=m,l.key=m):g===o?(this._cache[o]=m,l.tag=m):g===c?p=m.id:console.log(`Unexpected title ${g}`)}c&&this.addLocale(e.langCodes[0],p),t(null,l)}})}getDocs(e,t){let r=this.context.systems.l10n.localeCodes().map(i=>i.toLowerCase());e.langCodes=r,this.getEntity(e,(i,s)=>{if(i){t(i);return}let o=s.rtype||s.tag||s.key;if(!o){t("No entity");return}let a;for(let h of r)if(o.descriptions[h]?.language===h){a=o.descriptions[h];break}!a&&Object.values(o.descriptions).length&&(a=Object.values(o.descriptions)[0]);let l={title:o.title,description:a?.value??"",descriptionLocaleCode:a?.language??"",editURL:`https://wiki.openstreetmap.org/wiki/${o.title}`};if(o.claims){let h,p=this.claimToValue(o,"P4",r[0]);p?h="https://commons.wikimedia.org/w/index.php":(p=this.claimToValue(o,"P28",r[0]),p&&(h="https://wiki.openstreetmap.org/w/index.php")),h&&p&&(l.imageURL=h+"?"+ft({title:`Special:Redirect/file/${p}`,width:400}))}let c=this.monolingualClaimToValueObj(s.rtype,"P31"),u=this.monolingualClaimToValueObj(s.tag,"P31"),d=this.monolingualClaimToValueObj(s.key,"P31");for(let h of[c,u,d]){for(let p of r){let g=r[0].split("-")[0]!=="en"&&p.split("-")[0]==="en"?"inspector.wiki_en_reference":"inspector.wiki_reference",y=f(h,p,g);if(y){l.wiki=y;break}}if(l.wiki)break}t(null,l);function f(h,p,m){if(h&&h[p])return{title:h[p],text:m,url:`https://wiki.openstreetmap.org/wiki/${h[p]}`}}})}addLocale(e,t){this._localeIDs[e]=t}_request(e,t){if(this._inflight[e])return;let r=new AbortController;this._inflight[e]=r,fetch(e,{signal:r.signal}).then(Ae).then(i=>{delete this._inflight[e],t&&t(null,i)}).catch(i=>{delete this._inflight[e],i.name!=="AbortError"&&t&&t(i.message)})}};var CD="https://overturemaps-tiles-us-west-2-beta.s3.us-west-2.amazonaws.com/",vae="pmtiles_catalog.json",a6=class extends Se{constructor(e){super(e),this.id="overture",this.pmTilesCatalog={},this.latestRelease="",this._initPromise=null}_loadS3CatalogAsync(){return fetch(CD+vae).then(Ae).then(e=>{this.pmTilesCatalog=e;let t=this.pmTilesCatalog.releases.map(r=>r.release_id);t.sort((r,i)=>new Date(i)-new Date(r)),this.latestRelease=this.pmTilesCatalog.releases.find(r=>r.release_id===t[0])}).catch(e=>{console.error("Error fetching or parsing the PMTiles Catalog: ",e)})}initAsync(){if(this._initPromise)return this._initPromise;let e=this.context.services.vectortile;return this._initPromise=e.initAsync().then(()=>this._loadS3CatalogAsync())}startAsync(){return this._started=!0,this.context.services.vectortile.startAsync()}getAvailableDatasets(){return[new Hi(this.context,{id:"overture-places",conflated:!1,service:"overture",categories:new Set(["overture","places","featured"]),color:"#00ffff",dataUsed:["overture","Overture Places"],itemUrl:"https://docs.overturemaps.org/guides/places/",licenseUrl:"https://docs.overturemaps.org/attribution/#places",labelStringID:"rapid_menu.overture.places.label",descriptionStringID:"rapid_menu.overture.places.description"})]}loadTiles(e){let t=this.context.services.vectortile;if(e.includes("places")){let r=this.latestRelease.files.find(s=>s.theme==="places"),i=CD+r.href;t.loadTiles(i)}}getData(e){let t=this.context.services.vectortile;if(e.includes("places")){let r=this.latestRelease.files.find(s=>s.theme==="places"),i=CD+r.href;return t.getData(i)}else return[]}};var ej=16.5,l6=class extends Se{constructor(e){super(e),this.id="streetside",this.autoStart=!1,this._loadPromise=null,this._startPromise=null,this._hires=!1,this._resolution=512,this._currScene=0,this._cache={},this._viewer=null,this._nextSequenceID=0,this._waitingForPhotoID=null,this._sceneOptions={type:"cubemap",cubeMap:[],showFullscreenCtrl:!1,autoLoad:!0,compass:!0,friction:1,minHfov:10,maxHfov:90,hfov:45,yaw:0},this._keydown=this._keydown.bind(this),this._setupCanvas=this._setupCanvas.bind(this),this._tiler=new or().zoomRange(ej).skipNullIsland(!0),this._lastv=null}_keydown(e){let t=this.context.systems.photos;!this.viewerShowing||t.currPhotoLayerID!=="streetside"||(document.activeElement?.tagName??"BODY")!=="BODY"||(e.key==="ArrowLeft"||e.key==="ArrowDown"?this._step(-1):(e.key==="ArrowUp"||e.key==="ArrowRight")&&this._step(1))}initAsync(){return this.resetAsync()}startAsync(){if(this._startPromise)return this._startPromise;let e=this.context,t=e.systems.gfx.events,r=e.systems.ui,i=e.container().select(".photoviewer .middle-middle").selectAll(".ms-wrapper").data([0]),s=i.enter().append("div").attr("class","photo-wrapper ms-wrapper").classed("hide",!0);s.append("div").attr("id","rapideditor-viewer-streetside");let o=s.append("div").attr("class","photo-footer");o.append("div").attr("class","photo-options"),o.append("div").attr("class","photo-attribution");let a=s.append("div").attr("class","photo-controls-wrap").append("div").attr("class","photo-controls");return a.append("button").on("click.back",()=>this._step(-1)).call(X("#fas-backward-step")),a.append("button").on("click.forward",()=>this._step(1)).call(X("#fas-forward-step")),i=i.merge(s).call(this._setupCanvas),r.PhotoViewer.on("resize",()=>{this._viewer&&this._viewer.resize()}),t.on("keydown",this._keydown),this._startPromise=this._loadAssetsAsync().then(()=>this._started=!0).catch(l=>{l instanceof Error&&console.error(l),this._startPromise=null})}resetAsync(){if(this._cache.inflight)for(let e of this._cache.inflight.values())e.controller.abort();return this._cache={rbush:new Tt,inflight:new Map,loaded:new Set,bubbles:new Map,sequences:new Map,unattachedBubbles:new Set,bubbleHasSequences:new Map,metadataPromise:null},this.lastv=null,Promise.resolve()}getImages(){let e=this.context.viewport.visibleExtent();return this._cache.rbush.search(e.bbox()).map(t=>t.data)}getSequences(){let e=this._cache,t=this.context.viewport.visibleExtent(),r=new Map;for(let i of e.rbush.search(t.bbox())){let s=i.data.id,o=e.bubbleHasSequences.get(s)??[];for(let a of o)r.has(a)||r.set(a,e.sequences.get(a))}return[...r.values()]}loadTiles(){let e=this.context.viewport;if(this._lastv===e.v)return;this._lastv=e.v;let r=this._tiler.zoomRange(ej).margin(2).getTiles(e).tiles;for(let[i,s]of this._cache.inflight)r.find(a=>a.id===i)||s.controller.abort();for(let i of r){let s=i.id;this._cache.loaded.has(s)||this._cache.inflight.has(s)||this._loadTileAsync(i)}}get viewerShowing(){return this._showing}showViewer(){let e=this.context.container().select(".photoviewer").classed("hide",!1);e.selectAll(".photo-wrapper.ms-wrapper.hide").size()&&(e.selectAll(".photo-wrapper:not(.ms-wrapper)").classed("hide",!0),this._showing=!0,e.selectAll(".photo-wrapper.ms-wrapper").classed("hide",!1))}hideViewer(){let e=this.context;e.systems.photos.selectPhoto(null),e.container().select(".photoviewer").classed("hide",!0).selectAll(".photo-wrapper").classed("hide",!0),this._showing=!1,this.emit("imageChanged")}selectImageAsync(e){if(!e)return this._updatePhotoFooter(null),Promise.resolve();let t=this._cache.bubbles.get(e);if(this.context.container().select(".photoviewer .ms-wrapper").selectAll(".pnlm-load-box").style("display","block").style("transform","translate(-50%, -50%)"),e&&!t&&(this._waitingForPhotoID=e),!t)return Promise.resolve();this._sceneOptions.northOffset=t.ca,this._updatePhotoFooter(e);let s="https://ecn.t0.tiles.virtualearth.net/tiles/",a=parseInt(e,10).toString(4),l=16-a.length;for(let p=0;p<l;p++)a="0"+a;let c=s+"hs"+a,u="?g=13305&n=z",d=["01","02","03","10","11","12"],f=this._getQuadKeys(),h=d.map(p=>f.map(m=>{let g=this._qkToXY(m);return{face:p,url:c+p+m+u,x:g[0],y:g[1]}}));return this._loadFacesAsync(h).then(()=>{if(!this._viewer)this._initViewer();else{this._currScene++;let p=this._currScene.toString();this._viewer.addScene(p,this._sceneOptions).loadScene(p),this._currScene>2&&(p=(this._currScene-1).toString(),this._viewer.removeScene(p))}return t})}_updatePhotoFooter(e){let t=this.context,r=t.systems.l10n,i=t.systems.photos,s=t.container().select(".photoviewer .ms-wrapper"),a=s.selectAll(".photo-options").selectAll(".hires").data([0]),l=a.enter().append("label").attr("for","ms-hires-input").attr("class","hires");l.append("input").attr("type","checkbox").attr("id","ms-hires-input").on("click",f=>{f.stopPropagation(),this._hires=!this._hires,this._resolution=this._hires?1024:512,s.call(this._setupCanvas);let h={yaw:this._viewer.getYaw(),pitch:this._viewer.getPitch(),hfov:this._viewer.getHfov()};this._sceneOptions=Object.assign(this._sceneOptions,h),this.selectImageAsync(i.currPhotoID)}),l.append("span"),a=a.merge(l),a.selectAll("#ms-hires-input").property("checked",this._hires),a.selectAll("span").text(r.t("photos.hires"));let c=s.selectAll(".photo-attribution").html("&nbsp;"),u=this._cache.bubbles.get(e);if(!u)return;u.captured_by&&(c.append("span").attr("class","captured_by").text(u.captured_by),c.append("span").text("|")),u.captured_at&&(c.append("span").attr("class","captured_at").text(d(u.captured_at)),c.append("span").text("|")),c.append("a").attr("class","image-link").attr("target","_blank").attr("href",`https://www.bing.com/maps?cp=${u.loc[1]}~${u.loc[0]}&lvl=17&dir=${u.ca}&style=x&v=2&sV=1`).text("bing.com");function d(f){if(!f)return null;let h={day:"numeric",month:"short",year:"numeric"},p=new Date(f);if(isNaN(p.getTime()))return null;let m=t.systems.l10n.localeCode();return p.toLocaleDateString(m,h)}}_loadAssetsAsync(){return this._loadPromise?this._loadPromise:this._loadPromise=new Promise((e,t)=>{let r=this.context.systems.assets,i=0,s=()=>{++i===2&&e()},o=H("head");o.selectAll("#rapideditor-pannellum-css").data([0]).enter().append("link").attr("id","rapideditor-pannellum-css").attr("rel","stylesheet").attr("crossorigin","anonymous").attr("href",r.getAssetURL("pannellum_css")).on("load",s).on("error",t),o.selectAll("#rapideditor-pannellum-js").data([0]).enter().append("script").attr("id","rapideditor-pannellum-js").attr("crossorigin","anonymous").attr("src",r.getAssetURL("pannellum_js")).on("load",s).on("error",t)})}_initViewer(){if(!window.pannellum)throw new Error("pannellum not loaded");if(this._viewer)return;this._currScene++;let e=this._currScene.toString(),t={default:{firstScene:e},scenes:{}};t.scenes[e]=this._sceneOptions;let r=()=>{this.emit("imageChanged")},i=()=>{this.emit("fovChanged",this._viewer.getHfov())};this._viewer=window.pannellum.viewer("rapideditor-viewer-streetside",t),this._viewer.on("load",r),this._viewer.on("zoomchange",i),this.context.container().select("#rapideditor-viewer-streetside").on("pointerdown.streetside",()=>{H(window).on("pointermove.streetside",()=>{this.emit("bearingChanged",this._viewer.getYaw())})}).on("pointerup.streetside pointercancel.streetside",()=>{H(window).on("pointermove.streetside",null)})}_step(e){let r=this.context.systems.photos,i=r.currPhotoID,s=this._cache.bubbles.get(i);if(!s)return;let o=e===1?s.ne:s.pr,a=this._viewer.getYaw();this._sceneOptions.yaw=a;let l=s.ca+a,c=s.loc,u=35,d=[c[0]+Gr(u/5,c[1]),c[1]],f=[c[0]+Gr(u/2,c[1]),c[1]+Gi(u)],h=[c[0]-Gr(u/2,c[1]),c[1]+Gi(u)],p=[c[0]-Gr(u/5,c[1]),c[1]],m=[d,f,h,p,d],g=(e===1?l:l+180)*(Math.PI/180);m=_o(m,-g,c);let y=new le;for(let _ of m)y.extendSelf(_);let x=1/0;this._cache.rbush.search(y.bbox()).forEach(_=>{if(_.data.id===s.id||!c2(_.data.loc,m))return;let S=Ne(_.data.loc,s.loc),C=s.ca-_.data.ca;Math.min(Math.abs(C),360-Math.abs(C))>20&&(S+=5),S<x&&(o=_.data.id,x=S)});let b=this._cache.bubbles.get(o);b&&(r.selectPhoto("streetside",b.id),this.emit("imageChanged"))}_localeDateString(e){if(!e)return null;let t={day:"numeric",month:"short",year:"numeric"},r=new Date(e);if(isNaN(r.getTime()))return null;let i=this.context.systems.l10n.localeCode();return r.toLocaleString(i,t)}_loadedBubbleData(e){let t=this._cache;t.loaded.add(e.tile.id);let r=e.data;if(!r)return;if(r.error)throw new Error(r.error);r.shift();let i=null,s=r.map(a=>{let c=a.id.toString();if(this._waitingForPhotoID===c&&(i=c,this._waitingForPhotoID=null),t.bubbles.has(c))return null;let u=[a.lo,a.la],d={type:"photo",service:"streetside",loc:u,id:c,ca:a.he,captured_at:a.cd,captured_by:"microsoft",pr:a.pr?.toString(),ne:a.ne?.toString(),isPano:!0};return t.bubbles.set(c,d),t.unattachedBubbles.add(c),{minX:u[0],minY:u[1],maxX:u[0],maxY:u[1],data:d}}).filter(Boolean);if(this._cache.rbush.load(s),this._connectSequences(),i){let a=this.context.systems.photos;a.selectPhoto(),a.selectPhoto("streetside",i)}this.context.systems.gfx.deferredRedraw(),this.emit("loadedData")}_connectSequences(){let e=this._cache,t=new Set,r=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),i=Array.from(e.unattachedBubbles).sort(r.compare),s=(o,a)=>{t.add(o),e.unattachedBubbles.delete(a);let l=e.bubbleHasSequences.get(a);l||(l=[],e.bubbleHasSequences.set(a,l)),l.push(o)};for(let o of i){let a=e.unattachedBubbles.has(o),l=e.bubbles.get(o);if(!l||!a)continue;let c=l.ne,u=c&&e.bubbles.get(c),d=l.pr,f=d&&e.bubbles.get(d);if(c&&u){let h,p,m=u&&e.bubbleHasSequences.get(c)||[];for(h of m){p=e.sequences.get(h);let g=p.bubbleIDs.at(0),y=p.bubbleIDs.at(-1);if(c===y){p.bubbleIDs.push(o),s(h,o);break}else if(c===g){p.bubbleIDs.unshift(o),s(h,o);break}}}if(d&&f){let h,p,m=f&&e.bubbleHasSequences.get(d)||[];for(h of m){p=e.sequences.get(h);let g=p.bubbleIDs.at(0),y=p.bubbleIDs.at(-1);if(d===y){p.bubbleIDs.push(o),s(h,o);break}else if(d===g){p.bubbleIDs.unshift(o),s(h,o);break}}}if(e.unattachedBubbles.has(o)){let p=`s${this._nextSequenceID++}`,m={type:"sequence",service:"streetside",id:p,v:0,bubbleIDs:[o],isPano:!0};e.sequences.set(p,m),s(p,o),d&&f&&(m.bubbleIDs.unshift(d),s(p,d)),c&&u&&(m.bubbleIDs.push(c),s(p,c))}}for(let o of t){let a=e.sequences.get(o),l=a.bubbleIDs.map(c=>e.bubbles.get(c));a.v++,a.captured_at=l[0].captured_at,a.captured_by=l[0].captured_by,a.coordinates=l.map(c=>c.loc)}}_fetchMetadataAsync(e){if(this._cache.metadataPromise)return this._cache.metadataPromise;let[t,r]=e.wgs84Extent.center(),o=`https://dev.virtualearth.net/REST/v1/Imagery/MetaData/Streetside/${r},${t}?key=AoG8TaQvkPo6o8SlpRVmBs7WJwO_NDQklVRcAfpn7P8oiEMYWNY59XHSJU81sP1Y`;this._cache.metadataPromise=fetch(o).then(Ae).then(a=>{if(!a)throw new Error("no data");return a})}_loadTileAsync(e){let t=this._cache.inflight.get(e.id);if(t)return t.promise;let[r,i,s,o]=e.wgs84Extent.rectangle(),u="https://t.ssl.ak.tiles.virtualearth.net/tiles/cmd/StreetSideBubbleMetaData?"+ft({north:o,south:i,east:s,west:r,count:2e3,key:"AuftgJsO0Xs8Ts4M1xZUQJQXJNsvmh3IV8DkNieCiy3tCwCUMq76-WpkrBtNAuEm"}),d=new AbortController,f=fetch(u,{signal:d.signal}).then(Ae).then(h=>{this._loadedBubbleData({data:JSON.parse(h),tile:e})}).catch(h=>{h.name!=="AbortError"&&h instanceof Error&&console.error(h)}).finally(()=>{this._cache.inflight.delete(e.id)});return this._cache.inflight.set(e.id,{promise:f,controller:d}),f}_loadImageAsync(e){return new Promise(t=>{let r=e.face,i=document.getElementById(`rapideditor-canvas${r}`),s=i.getContext("2d"),o=new Image;o.onload=()=>{s.drawImage(o,e.x,e.y),t({imgInfo:e,status:"ok"})},o.onerror=()=>{s.clearRect(0,0,i.width,i.height),t({imgInfo:e,status:"error"})},o.setAttribute("crossorigin",""),o.src=e.url})}_loadFaceAsync(e){return Promise.all(e.map(t=>this._loadImageAsync(t))).then(t=>{let r=t[0].imgInfo.face,i=document.getElementById(`rapideditor-canvas${r}`),s={"01":0,"02":1,"03":2,10:3,11:4,12:5};return this._sceneOptions.cubeMap[s[r]]=i.toDataURL("image/jpeg",1),{status:`face ${r} ok`}})}_loadFacesAsync(e){return Promise.all(e.map(t=>this._loadFaceAsync(t))).then(()=>({status:"this._loadFacesAsync done"}))}_setupCanvas(e){e.selectAll("#rapideditor-stitcher-canvases").remove(),e.selectAll("#rapideditor-stitcher-canvases").data([0]).enter().append("div").attr("id","rapideditor-stitcher-canvases").attr("display","none").selectAll("canvas").data(["canvas01","canvas02","canvas03","canvas10","canvas11","canvas12"]).enter().append("canvas").attr("id",t=>`rapideditor-${t}`).attr("width",this._resolution).attr("height",this._resolution)}_qkToXY(e){let t=0,r=0,i=256;for(let s=e.length;s>0;s--){let o=e[s-1];t+=+(o==="1"||o==="3")*i,r+=+(o==="2"||o==="3")*i,i*=2}return[t,r]}_getQuadKeys(){let e=this._resolution/256,t;return e===16?t=["0000","0001","0010","0011","0100","0101","0110","0111","1000","1001","1010","1011","1100","1101","1110","1111","0002","0003","0012","0013","0102","0103","0112","0113","1002","1003","1012","1013","1102","1103","1112","1113","0020","0021","0030","0031","0120","0121","0130","0131","1020","1021","1030","1031","1120","1121","1130","1131","0022","0023","0032","0033","0122","0123","0132","0133","1022","1023","1032","1033","1122","1123","1132","1133","0200","0201","0210","0211","0300","0301","0310","0311","1200","1201","1210","1211","1300","1301","1310","1311","0202","0203","0212","0213","0302","0303","0312","0313","1202","1203","1212","1213","1302","1303","1312","1313","0220","0221","0230","0231","0320","0321","0330","0331","1220","1221","1230","1231","1320","1321","1330","1331","0222","0223","0232","0233","0322","0323","0332","0333","1222","1223","1232","1233","1322","1323","1332","1333","2000","2001","2010","2011","2100","2101","2110","2111","3000","3001","3010","3011","3100","3101","3110","3111","2002","2003","2012","2013","2102","2103","2112","2113","3002","3003","3012","3013","3102","3103","3112","3113","2020","2021","2030","2031","2120","2121","2130","2131","3020","3021","3030","3031","3120","3121","3130","3131","2022","2023","2032","2033","2122","2123","2132","2133","3022","3023","3032","3033","3122","3123","3132","3133","2200","2201","2210","2211","2300","2301","2310","2311","3200","3201","3210","3211","3300","3301","3310","3311","2202","2203","2212","2213","2302","2303","2312","2313","3202","3203","3212","3213","3302","3303","3312","3313","2220","2221","2230","2231","2320","2321","2330","2331","3220","3221","3230","3231","3320","3321","3330","3331","2222","2223","2232","2233","2322","2323","2332","2333","3222","3223","3232","3233","3322","3323","3332","3333"]:e===8?t=["000","001","010","011","100","101","110","111","002","003","012","013","102","103","112","113","020","021","030","031","120","121","130","131","022","023","032","033","122","123","132","133","200","201","210","211","300","301","310","311","202","203","212","213","302","303","312","313","220","221","230","231","320","321","330","331","222","223","232","233","322","323","332","333"]:e===4?t=["00","01","10","11","02","03","12","13","20","21","30","31","22","23","32","33"]:t=["0","1","2","3"],t}};var c6="https://taginfo.openstreetmap.org/api/4/",wae={point:"count_nodes",vertex:"count_nodes",area:"count_ways",line:"count_ways"},Sae={point:"count_node_members",vertex:"count_node_members",area:"count_way_members",line:"count_way_members",relation:"count_relation_members"},Cae={point:"nodes",vertex:"nodes",area:"ways",line:"ways"},Aae={point:"count_node_members_fraction",vertex:"count_node_members_fraction",area:"count_way_members_fraction",line:"count_way_members_fraction",relation:"count_relation_members_fraction"},u6=class extends Se{constructor(e){super(e),this.id="taginfo",this._startPromise=null,this._inflight={},this._cache={},this._popularKeys={postal_code:!0,full_name:!0,loc_name:!0,reg_name:!0,short_name:!0,sorting_name:!0,artist_name:!0,nat_name:!0,long_name:!0,"bridge:name":!0},this.keys=this.keys.bind(this),this.multikeys=this.multikeys.bind(this),this.values=this.values.bind(this),this.roles=this.roles.bind(this),this.docs=this.docs.bind(this),this._request=this._request.bind(this),this._debouncedRequest=Xt(this._request,300,{leading:!1})}initAsync(){return Promise.resolve()}startAsync(){if(this._startPromise)return this._startPromise;let t={rp:100,sortname:"values_all",sortorder:"desc",page:1,debounce:!1,lang:this.context.systems.l10n.languageCode()};return this._startPromise=new Promise((r,i)=>{this.keys(t,(s,o)=>{if(s)this._startPromise=null,i();else{for(let a of o)a.value!=="opening_hours"&&(this._popularKeys[a.value]=!0);this._started=!0,r()}})})}resetAsync(){return this._debouncedRequest.cancel(),Object.values(this._inflight).forEach(e=>e.abort()),this._inflight={},Promise.resolve()}keys(e,t){let r=this.context.systems.l10n.languageCode(),i=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e)),e=Object.assign({rp:10,sortname:"count_all",sortorder:"desc",page:1,lang:r},e);let s=c6+"keys/all?"+ft(e);i(s,e,!1,t,(o,a)=>{if(o)t(o);else{let l=this._filterKeys(e.filter),c=a.data.filter(l).sort(this._sortKeys).map(this._valKey);this._cache[s]=c,t(null,c)}})}multikeys(e,t){let r=this.context.systems.l10n.languageCode(),i=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e)),e=Object.assign({rp:25,sortname:"count_all",sortorder:"desc",page:1,lang:r},e);let s=e.query,o=c6+"keys/all?"+ft(e);i(o,e,!0,t,(a,l)=>{if(a)t(a);else{let c=this._filterMultikeys(s),u=l.data.filter(c).map(this._valKey);this._cache[o]=u,t(null,u)}})}values(e,t){let r=e.key;if(r&&this._popularKeys[r]){t(null,[]);return}let i=this.context.systems.l10n.languageCode(),s=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(this._setFilter(e))),e=Object.assign({rp:25,sortname:"count_all",sortorder:"desc",page:1,lang:i},e);let o=c6+"key/values?"+ft(e);s(o,e,!1,t,(a,l)=>{if(a)t(a);else{let u=/network|taxon|genus|species|brand|grape_constiety|royal_cypher|listed_status|booth|rating|stars|:output|_hours|_times|_ref|manufacturer|country|target|brewery/.test(e.key),d=this._filterValues(u),f=l.data.filter(d).map(this._valKeyDescription);this._cache[o]=f,t(null,f)}})}roles(e,t){let r=this.context.systems.l10n.languageCode(),i=e.debounce?this._debouncedRequest:this._request,s=e.geometry;e=this._clean(this._setSortMembers(e)),e=Object.assign({rp:25,sortname:"count_all_members",sortorder:"desc",page:1,lang:r},e);let o=c6+"relation/roles?"+ft(e);i(o,e,!0,t,(a,l)=>{if(a)t(a);else{let c=this._filterRoles(s),u=l.data.filter(c).map(this._roleKey);this._cache[o]=u,t(null,u)}})}docs(e,t){let r=e.debounce?this._debouncedRequest:this._request;e=this._clean(this._setSort(e));let i="key/wiki_pages?";e.value?i="tag/wiki_pages?":e.rtype&&(i="relation/wiki_pages?");let s=c6+i+ft(e);r(s,e,!0,t,(o,a)=>{o?t(o):(this._cache[s]=a.data,t(null,a.data))})}_sets(e,t,r){return e.geometry&&r[e.geometry]&&(e[t]=r[e.geometry]),e}_setFilter(e){return this._sets(e,"filter",Cae)}_setSort(e){return this._sets(e,"sortname",wae)}_setSortMembers(e){return this._sets(e,"sortname",Sae)}_clean(e){return Ir(e,["geometry","debounce"])}_filterKeys(e){let t=e?"count_"+e:"count_all";return r=>parseFloat(r[t])>2500||r.in_wiki}_filterMultikeys(e){return t=>{let r=new RegExp("^"+e+"(.*)$"),i=t.key.match(r)||[];return i.length===2&&i[1].indexOf(":")===-1}}_filterValues(e){return t=>t.value.match(/[;,]/)!==null||!e&&t.value.match(/[A-Z*]/)!==null?!1:parseFloat(t.fraction)>0}_filterRoles(e){return t=>t.role===""||t.role.match(/[A-Z*;,]/)!==null?!1:parseFloat(t[Aae[e]])>0}_valKey(e){return{value:e.key,title:e.key}}_valKeyDescription(e){let t={value:e.value,title:e.description||e.value};return e.count&&(t.count=e.count),t}_roleKey(e){return{value:e.role,title:e.role}}_sortKeys(e,t){return e.key.indexOf(":")===-1&&t.key.indexOf(":")!==-1?-1:e.key.indexOf(":")!==-1&&t.key.indexOf(":")===-1?1:0}_request(e,t,r,i,s){if(this._inflight[e]||this._checkCache(e,t,r,i))return;let o=new AbortController;this._inflight[e]=o,fetch(e,{signal:o.signal}).then(Ae).then(a=>{delete this._inflight[e],s&&s(null,a)}).catch(a=>{delete this._inflight[e],a.name!=="AbortError"&&s&&s(a.message)})}_checkCache(e,t,r,i){let s=t.rp??25,o=t.query??"",a=e;do{let l=this._cache[a];if(l&&(e===a||l.length<s))return i(null,l),!0;if(r||!o.length)return!1;o=o.slice(0,-1),a=e.replace(/&query=(.*?)&/,`&query=${o}&`)}while(o.length>=0);return!1}};var FD=Ot(_p(),1);var ts=Uint8Array,oh=Uint16Array,Eae=Int32Array,tj=new ts([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),rj=new ts([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Tae=new ts([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),nj=function(n,e){for(var t=new oh(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new Eae(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return{b:t,r:i}},ij=nj(tj,2),sj=ij.b,kae=ij.r;sj[28]=258,kae[258]=28;var oj=nj(rj,0),Iae=oj.b,bRt=oj.r,TD=new oh(32768);for($t=0;$t<32768;++$t)Va=($t&43690)>>1|($t&21845)<<1,Va=(Va&52428)>>2|(Va&13107)<<2,Va=(Va&61680)>>4|(Va&3855)<<4,TD[$t]=((Va&65280)>>8|(Va&255)<<8)>>1;var Va,$t,d6=function(n,e,t){for(var r=n.length,i=0,s=new oh(e);i<r;++i)n[i]&&++s[n[i]-1];var o=new oh(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(t){a=new oh(1<<e);var l=15-e;for(i=0;i<r;++i)if(n[i])for(var c=i<<4|n[i],u=e-n[i],d=o[n[i]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)a[TD[d]>>l]=c}else for(a=new oh(r),i=0;i<r;++i)n[i]&&(a[i]=TD[o[n[i]-1]++]>>15-n[i]);return a},f6=new ts(288);for($t=0;$t<144;++$t)f6[$t]=8;var $t;for($t=144;$t<256;++$t)f6[$t]=9;var $t;for($t=256;$t<280;++$t)f6[$t]=7;var $t;for($t=280;$t<288;++$t)f6[$t]=8;var $t,aj=new ts(32);for($t=0;$t<32;++$t)aj[$t]=5;var $t;var Pae=d6(f6,9,1);var Dae=d6(aj,5,1),AD=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},yo=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},ED=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},Mae=function(n){return(n+7)/8|0},Rae=function(n,e,t){return(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length),new ts(n.subarray(e,t))};var Fae=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],es=function(n,e,t){var r=new Error(e||Fae[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,es),!t)throw r;return r},kD=function(n,e,t,r){var i=n.length,s=r?r.length:0;if(!i||e.f&&!e.l)return t||new ts(0);var o=!t,a=o||e.i!=2,l=e.i;o&&(t=new ts(i*3));var c=function(ie){var q=t.length;if(ie>q){var se=new ts(Math.max(q*2,ie));se.set(t),t=se}},u=e.f||0,d=e.p||0,f=e.b||0,h=e.l,p=e.d,m=e.m,g=e.n,y=i*8;do{if(!h){u=yo(n,d,1);var x=yo(n,d+1,3);if(d+=3,x)if(x==1)h=Pae,p=Dae,m=9,g=5;else if(x==2){var C=yo(n,d,31)+257,k=yo(n,d+10,15)+4,v=C+yo(n,d+5,31)+1;d+=14;for(var w=new ts(v),A=new ts(19),E=0;E<k;++E)A[Tae[E]]=yo(n,d+E*3,7);d+=k*3;for(var I=AD(A),M=(1<<I)-1,T=d6(A,I,1),E=0;E<v;){var R=T[yo(n,d,M)];d+=R&15;var b=R>>4;if(b<16)w[E++]=b;else{var P=0,D=0;for(b==16?(D=3+yo(n,d,3),d+=2,P=w[E-1]):b==17?(D=3+yo(n,d,7),d+=3):b==18&&(D=11+yo(n,d,127),d+=7);D--;)w[E++]=P}}var N=w.subarray(0,C),F=w.subarray(C);m=AD(N),g=AD(F),h=d6(N,m,1),p=d6(F,g,1)}else es(1);else{var b=Mae(d)+4,_=n[b-4]|n[b-3]<<8,S=b+_;if(S>i){l&&es(0);break}a&&c(f+_),t.set(n.subarray(b,S),f),e.b=f+=_,e.p=d=S*8,e.f=u;continue}if(d>y){l&&es(0);break}}a&&c(f+131072);for(var B=(1<<m)-1,O=(1<<g)-1,G=d;;G=d){var P=h[ED(n,d)&B],U=P>>4;if(d+=P&15,d>y){l&&es(0);break}if(P||es(2),U<256)t[f++]=U;else if(U==256){G=d,h=null;break}else{var W=U-254;if(U>264){var E=U-257,V=tj[E];W=yo(n,d,(1<<V)-1)+sj[E],d+=V}var j=p[ED(n,d)&O],Z=j>>4;j||es(3),d+=j&15;var F=Iae[Z];if(Z>3){var V=rj[Z];F+=ED(n,d)&(1<<V)-1,d+=V}if(d>y){l&&es(0);break}a&&c(f+131072);var Y=f+W;if(f<F){var K=s-F,ne=Math.min(F,Y);for(K+f<0&&es(3);f<ne;++f)t[f]=r[K+f]}for(;f<Y;++f)t[f]=t[f-F]}}e.l=h,e.p=G,e.b=f,e.f=u,h&&(u=1,e.m=m,e.d=p,e.n=g)}while(!u);return f!=t.length&&o?Rae(t,0,f):t.subarray(0,f)};var Bae=new ts(0);var Nae=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&es(6,"invalid gzip data");var e=n[3],t=10;e&4&&(t+=(n[10]|n[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!n[t++]);return t+(e&2)},Oae=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0};var Lae=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&es(6,"invalid zlib data"),(n[1]>>5&1)==+!e&&es(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function Uae(n,e){return kD(n,{i:2},e&&e.out,e&&e.dictionary)}function Gae(n,e){var t=Nae(n);return t+8>n.length&&es(6,"invalid gzip data"),kD(n.subarray(t,-8),{i:2},e&&e.out||new ts(Oae(n)),e&&e.dictionary)}function $ae(n,e){return kD(n.subarray(Lae(n,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function lj(n,e){return n[0]==31&&n[1]==139&&n[2]==8?Gae(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?Uae(n,e):$ae(n,e)}var zae=typeof TextDecoder<"u"&&new TextDecoder,Hae=0;try{zae.decode(Bae,{stream:!0}),Hae=1}catch{}var Wae=Object.defineProperty,h6=Math.pow,rr=(n,e)=>Wae(n,"name",{value:e,configurable:!0}),yn=(n,e,t)=>new Promise((r,i)=>{var s=l=>{try{a(t.next(l))}catch(c){i(c)}},o=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(n,e)).next())}),wRt=rr((n,e)=>{let t=!1,r="",i=L.GridLayer.extend({createTile:rr((s,o)=>{let a=document.createElement("img"),l=new AbortController,c=l.signal;return a.cancel=()=>{l.abort()},t||(n.getHeader().then(u=>{u.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):u.tileType===2?r="image/png":u.tileType===3?r="image/jpeg":u.tileType===4?r="image/webp":u.tileType===5&&(r="image/avif")}),t=!0),n.getZxy(s.z,s.x,s.y,c).then(u=>{if(u){let d=new Blob([u.data],{type:r}),f=window.URL.createObjectURL(d);a.src=f,a.cancel=void 0,o(void 0,a)}}).catch(u=>{if(u.name!=="AbortError")throw u}),a},"createTile"),_removeTile:rr(function(s){let o=this._tiles[s];o&&(o.el.cancel&&o.el.cancel(),o.el.width=0,o.el.height=0,o.el.deleted=!0,L.DomUtil.remove(o.el),delete this._tiles[s],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(s)}))},"_removeTile")});return new i(e)},"leafletRasterLayer"),Vae=rr(n=>(e,t)=>{if(t instanceof AbortController)return n(e,t);let r=new AbortController;return n(e,r).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:rr(()=>r.abort(),"cancel")}},"v3compat"),jae=class{constructor(e){this.tilev4=rr((t,r)=>yn(this,null,function*(){if(t.type==="json"){let h=t.url.substr(10),p=this.tiles.get(h);if(p||(p=new sv(h),this.tiles.set(h,p)),this.metadata)return{data:yield p.getTileJson(t.url)};let m=yield p.getHeader();return{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:m.minZoom,maxzoom:m.maxZoom,bounds:[m.minLon,m.minLat,m.maxLon,m.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=t.url.match(i);if(!s)throw new Error("Invalid PMTiles protocol URL");let o=s[1],a=this.tiles.get(o);a||(a=new sv(o),this.tiles.set(o,a));let l=s[2],c=s[3],u=s[4],d=yield a.getHeader(),f=yield a?.getZxy(+l,+c,+u,r.signal);if(f)return{data:new Uint8Array(f.data),cacheControl:f.cacheControl,expires:f.expires};if(d.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=Vae(this.tilev4),this.tiles=new Map,this.metadata=e?.metadata||!1,this.errorOnMissingTile=e?.errorOnMissingTile||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};rr(jae,"Protocol");function cj(n,e){return(e>>>0)*4294967296+(n>>>0)}rr(cj,"toNum");function uj(n,e){let t=e.buf,r=t[e.pos++],i=(r&112)>>4;if(r<128||(r=t[e.pos++],i|=(r&127)<<3,r<128)||(r=t[e.pos++],i|=(r&127)<<10,r<128)||(r=t[e.pos++],i|=(r&127)<<17,r<128)||(r=t[e.pos++],i|=(r&127)<<24,r<128)||(r=t[e.pos++],i|=(r&1)<<31,r<128))return cj(n,i);throw new Error("Expected varint not more than 10 bytes")}rr(uj,"readVarintRemainder");function ah(n){let e=n.buf,t=e[n.pos++],r=t&127;return t<128||(t=e[n.pos++],r|=(t&127)<<7,t<128)||(t=e[n.pos++],r|=(t&127)<<14,t<128)||(t=e[n.pos++],r|=(t&127)<<21,t<128)?r:(t=e[n.pos],r|=(t&15)<<28,uj(r,n))}rr(ah,"readVarint");function PD(n,e,t,r){if(r===0){t===1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);let i=e[0];e[0]=e[1],e[1]=i}}rr(PD,"rotate");function dj(n,e){let t=h6(2,n),r=e,i=e,s=e,o=[0,0],a=1;for(;a<t;)r=1&s/2,i=1&(s^r),PD(a,o,r,i),o[0]+=a*r,o[1]+=a*i,s=s/4,a*=2;return[n,o[0],o[1]]}rr(dj,"idOnLevel");var Xae=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function fj(n,e,t){if(n>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>h6(2,n)-1||t>h6(2,n)-1)throw new Error("tile x/y outside zoom level bounds");let r=Xae[n],i=h6(2,n),s=0,o=0,a=0,l=[e,t],c=i/2;for(;c>0;)s=(l[0]&c)>0?1:0,o=(l[1]&c)>0?1:0,a+=c*c*(3*s^o),PD(c,l,s,o),c=c/2;return r+a}rr(fj,"zxyToTileId");function qae(n){let e=0,t=0;for(let r=0;r<27;r++){let i=(1<<r)*(1<<r);if(e+i>n)return dj(r,n-e);e+=i}throw new Error("Tile zoom level exceeds max safe number limit (26)")}rr(qae,"tileIdToZxy");var Yae=(n=>(n[n.Unknown=0]="Unknown",n[n.None=1]="None",n[n.Gzip=2]="Gzip",n[n.Brotli=3]="Brotli",n[n.Zstd=4]="Zstd",n))(Yae||{});function ov(n,e){return yn(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return lj(new Uint8Array(n));let t=new Response(n).body;if(!t)throw new Error("Failed to read response stream");let r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw new Error("Compression method not supported")})}rr(ov,"defaultDecompress");var Kae=(n=>(n[n.Unknown=0]="Unknown",n[n.Mvt=1]="Mvt",n[n.Png=2]="Png",n[n.Jpeg=3]="Jpeg",n[n.Webp=4]="Webp",n[n.Avif=5]="Avif",n))(Kae||{});function hj(n){return n===1?".mvt":n===2?".png":n===3?".jpg":n===4?".webp":n===5?".avif":""}rr(hj,"tileTypeExt");var Qae=127;function pj(n,e){let t=0,r=n.length-1;for(;t<=r;){let i=r+t>>1,s=e-n[i].tileId;if(s>0)t=i+1;else if(s<0)r=i-1;else return n[i]}return r>=0&&(n[r].runLength===0||e-n[r].tileId<n[r].runLength)?n[r]:null}rr(pj,"findTile");var Zae=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return yn(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};rr(Zae,"FileSource");var mj=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let r="";"navigator"in globalThis&&(r=globalThis.navigator.userAgent||"");let i=r.indexOf("Windows")>-1,s=/Chrome|Chromium|Edg|OPR|Brave/.test(r);this.chromeWindowsNoCache=!1,i&&s&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,r,i){return yn(this,null,function*(){let s,o;r?o=r:(s=new AbortController,o=s.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${e}-${e+t-1}`);let l;this.mustReload?l="reload":this.chromeWindowsNoCache&&(l="no-store");let c=yield fetch(this.url,{signal:o,cache:l,headers:a});if(e===0&&c.status===416){let f=c.headers.get("Content-Range");if(!f||!f.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let h=+f.substr(8);c=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${h-1}`}})}let u=c.headers.get("Etag");if(u!=null&&u.startsWith("W/")&&(u=null),c.status===416||i&&u&&u!==i)throw this.mustReload=!0,new ID(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(c.status>=300)throw new Error(`Bad response code: ${c.status}`);let d=c.headers.get("Content-Length");if(c.status===200&&(!d||+d>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:u||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}})}};rr(mj,"FetchSource");var Jae=mj;function Fs(n,e){let t=n.getUint32(e+4,!0),r=n.getUint32(e+0,!0);return t*h6(2,32)+r}rr(Fs,"getUint64");function gj(n,e){let t=new DataView(n),r=t.getUint8(7);if(r>3)throw new Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:Fs(t,8),rootDirectoryLength:Fs(t,16),jsonMetadataOffset:Fs(t,24),jsonMetadataLength:Fs(t,32),leafDirectoryOffset:Fs(t,40),leafDirectoryLength:Fs(t,48),tileDataOffset:Fs(t,56),tileDataLength:Fs(t,64),numAddressedTiles:Fs(t,72),numTileEntries:Fs(t,80),numTileContents:Fs(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}rr(gj,"bytesToHeader");function DD(n){let e={buf:new Uint8Array(n),pos:0},t=ah(e),r=[],i=0;for(let s=0;s<t;s++){let o=ah(e);r.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<t;s++)r[s].runLength=ah(e);for(let s=0;s<t;s++)r[s].length=ah(e);for(let s=0;s<t;s++){let o=ah(e);o===0&&s>0?r[s].offset=r[s-1].offset+r[s-1].length:r[s].offset=o-1}return r}rr(DD,"deserializeIndex");var yj=class extends Error{};rr(yj,"EtagMismatch");var ID=yj;function MD(n,e){return yn(this,null,function*(){let t=yield n.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let r=t.data.slice(0,Qae),i=gj(r,t.etag),s=t.data.slice(i.rootDirectoryOffset,i.rootDirectoryOffset+i.rootDirectoryLength),o=`${n.getKey()}|${i.etag||""}|${i.rootDirectoryOffset}|${i.rootDirectoryLength}`,a=DD(yield e(s,i.internalCompression));return[i,[o,a.length,a]]})}rr(MD,"getHeaderAndRoot");function RD(n,e,t,r,i){return yn(this,null,function*(){let s=yield n.getBytes(t,r,void 0,i.etag),o=yield e(s.data,i.internalCompression),a=DD(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}rr(RD,"getDirectory");var ele=class{constructor(e=100,t=!0,r=ov){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return yn(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,r.data;let i=yield MD(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,r,i){return yn(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${r}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,o.data;let a=yield RD(e,this.decompress,t,r,i);return this.cache.set(s,{lastUsed:this.counter++,data:a}),this.prune(),a})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,i)=>{r.lastUsed<e&&(e=r.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return yn(this,null,function*(){this.cache.delete(e.getKey())})}};rr(ele,"ResolvedValueCache");var xj=class{constructor(e=100,t=!0,r=ov){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return yn(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,yield r.data;let i=new Promise((s,o)=>{MD(e,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),s(a[0]),this.prune()}).catch(a=>{o(a)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,r,i){return yn(this,null,function*(){let s=`${e.getKey()}|${i.etag||""}|${t}|${r}`,o=this.cache.get(s);if(o)return o.lastUsed=this.counter++,yield o.data;let a=new Promise((l,c)=>{RD(e,this.decompress,t,r,i).then(u=>{l(u),this.prune()}).catch(u=>{c(u)})});return this.cache.set(s,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,i)=>{r.lastUsed<e&&(e=r.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return yn(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let r=new Promise((i,s)=>{this.getHeader(e).then(o=>{i(),this.invalidations.delete(t)}).catch(o=>{s(o)})});this.invalidations.set(t,r)})}};rr(xj,"SharedPromiseCache");var tle=xj,bj=class{constructor(e,t,r){typeof e=="string"?this.source=new Jae(e):this.source=e,r?this.decompress=r:this.decompress=ov,t?this.cache=t:this.cache=new tle}getHeader(){return yn(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,r,i){return yn(this,null,function*(){let s=fj(e,t,r),o=yield this.cache.getHeader(this.source);if(e<o.minZoom||e>o.maxZoom)return;let a=o.rootDirectoryOffset,l=o.rootDirectoryLength;for(let c=0;c<=3;c++){let u=yield this.cache.getDirectory(this.source,a,l,o),d=pj(u,s);if(d){if(d.runLength>0){let f=yield this.source.getBytes(o.tileDataOffset+d.offset,d.length,i,o.etag);return{data:yield this.decompress(f.data,o.tileCompression),cacheControl:f.cacheControl,expires:f.expires}}a=o.leafDirectoryOffset+d.offset,l=d.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,r,i){return yn(this,null,function*(){try{return yield this.getZxyAttempt(e,t,r,i)}catch(s){if(s instanceof ID)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,r,i);throw s}})}getMetadataAttempt(){return yn(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),r=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(r))})}getMetadata(){return yn(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof ID)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return yn(this,null,function*(){let t=yield this.getHeader(),r=yield this.getMetadata(),i=hj(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};rr(bj,"PMTiles");var sv=bj;var wj=Ot(vj(),1);var p6=class extends Se{constructor(e){super(e),this.id="vectortile",this._sources=new Map,this._tiler=new or().tileSize(512).margin(1),this._nextID=0}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){for(let e of this._sources.values()){for(let t of e.inflight.values())t.abort();e.inflight.clear(),e.loaded.clear(),e.readyPromise=null;for(let t of e.zoomCache.values())t.features.clear(),t.boxes.clear(),t.toMerge.clear(),t.didMerge.clear(),t.rbush.clear();e.zoomCache.clear(),e.lastv=null}return this._sources.clear(),Promise.resolve()}getNextID(){return(this._nextID++).toString()}getData(e){let t=this._sources.get(e);if(!t)return[];let i=this.context.viewport,s=i.visibleExtent().bbox(),o=i.transform.scale,a=Math.round(l2(o,512)),l;for(let c=0;c<12;c++){if(l=t.zoomCache.get(a+c),l)return l.rbush.search(s).map(u=>u.data);if(l=t.zoomCache.get(a-c),l)return l.rbush.search(s).map(u=>u.data)}return[]}loadTiles(e){this._getSourceAsync(e).then(t=>{let r=t.header;if(r&&(this._tiler.zoomRange(r.minZoom,r.maxZoom),r.tileType!==1))throw new Error(`Unsupported tileType ${r.tileType}. Only Type 1 (MVT) is supported`);let i=this.context.viewport;if(t.lastv===i.v)return;t.lastv=i.v;let s=this._tiler.getTiles(i).tiles;for(let[a,l]of t.inflight)s.find(u=>u.id===a)||l.abort();let o=s.map(a=>this._loadTileAsync(t,a));return Promise.all(o).then(()=>this._processMergeQueue(t))})}_getSourceAsync(e){if(!e)return Promise.reject(new Error("No template"));let t=this._sources.get(e);if(!t){let r=new URL(e),i=r.hostname,s=r.pathname.split("/").at(-1);t={id:uh(e).toString(),displayName:i,template:e,inflight:new Map,loaded:new Map,zoomCache:new Map,lastv:null},this._sources.set(e,t),s&&/\.pmtiles$/.test(s)?(t.displayName=s,t.pmtiles=new sv(e),t.readyPromise=t.pmtiles.getHeader().then(o=>t.header=o).then(()=>Promise.resolve(t))):t.readyPromise=Promise.resolve(t)}return t.readyPromise}_getZoomCache(e,t){let r=e.zoomCache.get(t);return r||(r={features:new Map,boxes:new Map,toMerge:new Map,didMerge:new Set,rbush:new Tt},e.zoomCache.set(t,r)),r}_loadTileAsync(e,t){let r=t.id;if(e.loaded.has(r)||e.inflight.has(r))return;let i=new AbortController;e.inflight.set(r,i);let[s,o,a]=t.xyz,l;if(e.pmtiles)l=e.pmtiles.getZxy(a,s,o,i.signal).then(c=>c?.data);else{let c=e.template.replace("{x}",s).replace("{y}",o).replace(/\{[t-]y\}/,Math.pow(2,a)-o-1).replace(/\{z(oom)?\}/,a).replace(/\{switch:([^}]+)\}/,function(u,d){let f=d.split(",");return f[(s+o)%f.length]});l=fetch(c,{signal:i.signal}).then(Ae)}return l.then(c=>{e.loaded.set(r,t),this._parseTileBuffer(e,t,c)}).catch(c=>{c.name!=="AbortError"&&c instanceof Error&&console.error(c)}).finally(()=>{e.inflight.delete(r)})}_parseTileBuffer(e,t,r){if(!r)return;let[i,s,o]=t.xyz,a=t.id,l=t.wgs84Extent,c=`${i-1},${s},${o}-${a}`,u=`${a}-${i+1},${s},${o}`,d=`${i},${s-1},${o}-${a}`,f=`${a}-${i},${s+1},${o}`,h=new H1(new xc(r)),p=this._getZoomCache(e,o),m=[];for(let[g,y]of Object.entries(h.layers)){if(!y)continue;let x=0,b=y.extent;for(let _=0;_<y.length;_++){let S=y.feature(_),[C,k,v,w]=S.bbox();if(C>b||k>b||v<x||w<x)continue;for(let[I,M]of Object.entries(S.properties))S.properties[I]=M.toString();let A=uh((0,wj.default)(S.properties)).toString();S.id||(S.id=A);let E=S.toGeoJSON(i,s,o);for(let I of this._toSingleFeatures(E)){let M=this._calcExtent(I);if(!isFinite(M.min[0]))continue;let T=this.getNextID();I.id=T,I.__featurehash__=T,I.geometry.type==="Polygon"&&(M.min[0]<l.min[0]&&this._queueMerge(p,T,A,c),M.max[0]>l.max[0]&&this._queueMerge(p,T,A,u),M.min[1]<l.min[1]&&this._queueMerge(p,T,A,f),M.max[1]>l.max[1]&&this._queueMerge(p,T,A,d)),m.push({id:T,extent:M,layerID:g,prophash:A,geojson:(0,FD.default)(I,!0),v:0})}}}m.length&&(this._cacheFeatures(p,m),this.context.systems.gfx.deferredRedraw(),this.emit("loadedData"))}_queueMerge(e,t,r,i){if(e.didMerge.has(i))return;let s=e.toMerge.get(i);s||(s=new Map,e.toMerge.set(i,s));let o=s.get(r);o||(o=new Set,s.set(r,o)),o.add(t)}_processMergeQueue(e){for(let t of e.zoomCache.values())for(let[r,i]of t.toMerge){let[s,o]=r.split("-"),a=e.loaded.get(s),l=e.loaded.get(o);if(!(!a||!l)){t.didMerge.add(r);for(let[c,u]of i)this._mergePolygons(t,c,u,a,l),i.delete(c);t.toMerge.delete(r)}}}_cacheFeatures(e,t){let r=[];for(let i of t){e.features.set(i.id,i);let s=i.extent.bbox();s.data=i,e.boxes.set(i.id,s),r.push(s)}e.rbush.load(r)}_uncacheFeatureIDs(e,t){for(let r of t){let i=e.boxes.get(r);i&&(e.boxes.delete(r),e.rbush.remove(i)),e.features.delete(r)}}_mergePolygons(e,t,r,i,s){let o=Array.from(r).map(P=>e.features.get(P)).filter(Boolean);if(!o.length)return;let[a,l,c]=i.xyz,[u,d,f]=s.xyz,h=i.id,p=s.id,m=i.wgs84Extent,g=s.wgs84Extent,y=d===l+1,x=u===a+1,b=`${a-1},${l},${c}-${h}`,_=`${h}-${a+1},${l},${c}`,S=`${a},${l-1},${c}-${h}`,C=`${h}-${a},${l+1},${c}`,k=`${u-1},${d},${f}-${p}`,v=`${p}-${u+1},${d},${f}`,w=`${u},${d-1},${f}-${p}`,A=`${p}-${u},${d+1},${f}`,E=o[0];this._uncacheFeatureIDs(e,r);let I=o.map(P=>P.geojson.geometry.coordinates),M=Mb(...I);if(!M||!M.length)throw new Error("Failed to merge");let T={type:"Feature",geometry:{type:"MultiPolygon",coordinates:M},properties:Object.assign({},E.geojson.properties)},R=[];for(let P of this._toSingleFeatures(T)){let D=this._calcExtent(P);if(!isFinite(D.min[0]))continue;this._dedupePoints(P);let N=this.getNextID();P.id=N,P.__featurehash__=N,D.min[0]<m.min[0]&&this._queueMerge(e,N,t,b),y&&D.max[0]>m.max[0]&&this._queueMerge(e,N,t,_),x&&D.min[1]<m.min[1]&&this._queueMerge(e,N,t,C),D.max[1]>m.max[1]&&this._queueMerge(e,N,t,S),y&&D.min[0]<g.min[0]&&this._queueMerge(e,N,t,k),D.max[0]>g.max[0]&&this._queueMerge(e,N,t,v),D.min[1]<g.min[1]&&this._queueMerge(e,N,t,A),x&&D.max[1]>g.max[1]&&this._queueMerge(e,N,t,w),R.push({id:N,extent:D,layerID:E.layerID,prophash:t,geojson:(0,FD.default)(P,!0),v:0})}R.length&&(this._cacheFeatures(e,R),this.context.systems.gfx.deferredRedraw())}_calcExtent(e){let t=new le,r=e?.geometry;if(!e||!r)return t;let i=r.type,s=r.coordinates,o=/^Multi/.test(i)?s:[s];if(/Polygon$/.test(i))for(let a of o){let l=a[0];for(let c of l)t.extendSelf(c)}else if(/LineString$/.test(i))for(let a of o)for(let l of a)t.extendSelf(l);else if(/Point$/.test(i))for(let a of o)t.extendSelf(a);return t}_dedupePoints(e){let t=e?.geometry;if(!e||!t||t.type!=="Polygon")return;let r=5e-6,i=t.coordinates;for(let s=0;s<i.length;s++){let o=i[s],a=[],l=null;for(let c=0;c<o.length;c++){let u=o[c];c===0||c===o.length-1?a.push(u):He(u,l,r)||a.push(u),l=u}i[s]=a}}_toSingleFeatures(e){let t=[],r=e?.geometry;if(!e||!r)return t;let i=r.type,s=r.coordinates,o=/^Multi/.test(i)?s:[s];for(let a of o)t.push({type:"Feature",id:e.id??void 0,geometry:{type:i.replace("Multi",""),coordinates:a},properties:Object.assign({},e.properties)});return t}};var BD="https://www.wikidata.org/w/api.php?",m6=class extends Se{constructor(e){super(e),this.id="wikidata",this._cache=new Map}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return this._cache.clear(),Promise.resolve()}itemsForSearchQuery(e,t){if(!e){t&&t("No query",{});return}let r=this.languagesToQuery()[0],i=BD+ft({action:"wbsearchentities",format:"json",formatversion:2,search:e,type:"item",language:r,uselang:r,limit:10,origin:"*"});fetch(i).then(Ae).then(s=>{if(s&&s.error)throw new Error(s.error);t&&t(null,s.search||{})}).catch(s=>{t&&t(s.message,{})})}itemsByTitle(e,t,r){if(!t){r&&r("No title",{});return}e=e||"en";let i=BD+ft({action:"wbgetentities",format:"json",formatversion:2,sites:e.replace(/-/g,"_")+"wiki",titles:t,languages:"en",origin:"*"});fetch(i).then(Ae).then(s=>{if(s&&s.error)throw new Error(s.error);r&&r(null,s.entities||{})}).catch(s=>{r&&r(s.message,{})})}languagesToQuery(){return this.context.systems.l10n.localeCodes().map(t=>t.toLowerCase()).filter(t=>t!=="en-us")}entityByQID(e,t){if(!e){t("No qid",{});return}if(this._cache.has(e)){t&&t(null,this._cache.get(e));return}let r=this.languagesToQuery(),i=BD+ft({action:"wbgetentities",format:"json",formatversion:2,ids:e,props:"labels|descriptions|claims|sitelinks",sitefilter:r.map(s=>`${s}wiki`).join("|"),languages:r.join("|"),languagefallback:1,origin:"*"});fetch(i).then(Ae).then(s=>{if(s&&s.error)throw new Error(s.error);this._cache.set(e,s.entities[e]),t&&t(null,s.entities[e]||{})}).catch(s=>{t&&t(s.message,{})})}getDocs(e,t){let r=this.languagesToQuery();this.entityByQID(e.qid,function(i,s){if(i||!s){t(i||"No entity");return}let o;for(let l of r)if(s.descriptions[l]&&s.descriptions[l].language===l){o=s.descriptions[l];break}!o&&Object.values(s.descriptions).length&&(o=Object.values(s.descriptions)[0]);let a={title:s.id,description:o?.value??"",descriptionLocaleCode:o?.language??"",editURL:`https://www.wikidata.org/wiki/${s.id}`};if(s.claims){let l="https://commons.wikimedia.org/w/index.php?";for(let c of["P154","P18"]){let u=s.claims[c];if(u&&Object.keys(u).length){let d=u[Object.keys(u)[0]].mainsnak.datavalue.value;if(d){a.imageURL=l+ft({title:`Special:Redirect/file/${d}`,width:400});break}}}}if(s.sitelinks){let c=this.context.systems.l10n.languageCode().toLowerCase()==="en";for(let u of r){let d=`${u}wiki`;if(s.sitelinks[d]){let f=s.sitelinks[d].title,h="inspector.wiki_reference";!c&&u==="en"&&(h="inspector.wiki_en_reference"),a.wiki={title:f,text:h,url:`https://${u}.wikipedia.org/wiki/`+f.replace(/ /g,"_")};break}}}t(null,a)})}};var ND="https://en.wikipedia.org/w/api.php?",g6=class extends Se{constructor(e){super(e),this.id="wikipedia"}initAsync(){return Promise.resolve()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){return Promise.resolve()}search(e,t,r){if(!t){r&&r("No Query",[]);return}e=e||"en";let i=ND.replace("en",e)+ft({action:"query",list:"search",srlimit:"10",srinfo:"suggestion",format:"json",origin:"*",srsearch:t});fetch(i).then(Ae).then(s=>{if(s&&s.error)throw new Error(s.error);if(!s||!s.query||!s.query.search)throw new Error("No Results");if(r){let o=s.query.search.map(a=>a.title);r(null,o)}}).catch(s=>{r&&r(s,[])})}suggestions(e,t,r){if(!t){r&&r("",[]);return}e=e||"en";let i=ND.replace("en",e)+ft({action:"opensearch",namespace:0,suggest:"",format:"json",origin:"*",search:t});fetch(i).then(Ae).then(s=>{if(s&&s.error)throw new Error(s.error);if(!s||s.length<2)throw new Error("No Results");r&&r(null,s[1]||[])}).catch(s=>{r&&r(s.message,[])})}translations(e,t,r){if(!t){r&&r("No Title");return}e=e||"en";let i=ND.replace("en",e)+ft({action:"query",prop:"langlinks",format:"json",origin:"*",lllimit:500,titles:t});fetch(i).then(Ae).then(s=>{if(s&&s.error)throw new Error(s.error);if(!s||!s.query||!s.query.pages)throw new Error("No Results");if(r){let o=s.query.pages[Object.keys(s.query.pages)[0]],a={};o&&o.langlinks&&o.langlinks.forEach(function(l){a[l.lang]=l["*"]}),r(null,a)}}).catch(s=>{r&&r(s.message)})}};var rle=16.5,nle="https://geoscribble.osmz.ru/geojson",av=class extends Se{constructor(e){super(e),this.id="geoScribble",this.autoStart=!1,this._nextID=0,this._cache={},this._tiler=new or().zoomRange(rle).skipNullIsland(!0)}initAsync(){return this.resetAsync()}startAsync(){return this._started=!0,Promise.resolve()}resetAsync(){if(this._cache.inflight)for(let e of this._cache.inflight.values())e.controller.abort();return this._nextID=0,this._cache={shapes:{},loadedTile:{},inflightTile:{},rbush:new Tt},Promise.resolve()}getData(){let e=this.context.viewport.visibleExtent();return this._cache.rbush.search(e.bbox()).map(t=>t.data)}getNextID(){return(this._nextID++).toString()}loadTiles(){let e=this._cache,t=this.context.viewport,r=this._tiler.getTiles(t).tiles;this._abortUnwantedRequests(e,r);for(let i of r){if(e.loadedTile[i.id]||e.inflightTile[i.id])continue;let s=i.wgs84Extent.rectangle().join(","),o=nle+"?"+ft({bbox:s}),a=new AbortController;e.inflightTile[i.id]=a,fetch(o,{signal:a.signal}).then(Ae).then(l=>{e.loadedTile[i.id]=!0,e.shapes=l;for(let u of l.features){let d=this.getNextID();u.id=d,u.__featurehash__=d,u.v=0;let f=cm(u).bbox();f.data=u,e.rbush.insert(f)}this.context.systems.gfx.deferredRedraw(),this.emit("loadedData")}).catch(l=>{l.name!=="AbortError"&&(e.loadedTile[i.id]=!0)}).finally(()=>{delete e.inflightTile[i.id]})}}_abortRequest(e){for(let t of Object.values(e))t.abort()}_abortUnwantedRequests(e,t){Object.keys(e.inflightTile).forEach(r=>{t.find(s=>r===s.id)||(this._abortRequest(e.inflightTile[r]),delete e.inflightTile[r])})}};var qr={available:new Map};qr.available.set("esri",q5);qr.available.set("geoScribble",av);qr.available.set("kartaview",Y5);qr.available.set("keepRight",K5);qr.available.set("mapillary",Z5);qr.available.set("maproulette",J5);qr.available.set("mapwithai",e6);qr.available.set("nominatim",t6);qr.available.set("nsi",n6);qr.available.set("osm",i6);qr.available.set("osmose",s6);qr.available.set("osmwikibase",o6);qr.available.set("overture",a6);qr.available.set("streetside",l6);qr.available.set("taginfo",u6);qr.available.set("vectortile",p6);qr.available.set("wikidata",m6);qr.available.set("wikipedia",g6);function Sj(){var n=["building","highway","railway","waterway","aeroway","aerialway","piste:type","boundary","power","amenity","natural","landuse","leisure","military","place","man_made","route","roller_coaster","attraction","building:part","indoor"],e=Object.keys(oa),t=["oneway","bridge","tunnel","embankment","cutting","barrier","surface","tracktype","footway","crossing","service","sport","public_transport","location","parking","golf","type","leisure","man_made","indoor"],r=function(s){return s.tags},i=function(s){s.each(function(a){var l=this.className;l.baseVal!==void 0&&(l=l.baseVal);var c=r(a),u=i.getClassesString(c,l);u!==l&&H(this).attr("class",u)})};return i.getClassesString=function(s,o){var a,l,c,u,d,f,h;/\bstroke\b/.test(o)&&s.barrier&&s.barrier!=="no"&&(h="line");var p=o.trim().split(/\s+/).filter(function(y){return y.length&&!/^tag-/.test(y)}).map(function(y){return(y==="line"||y==="area")&&h||y});for(c=0;c<n.length;c++)if(d=n[c],f=s[d],!(!f||f==="no")){d==="piste:type"?d="piste":d==="building:part"&&(d="building_part"),a=d,e.indexOf(f)!==-1?(l=f,p.push("tag-"+d)):(p.push("tag-"+d),p.push("tag-"+d+"-"+f));break}if(!a){for(c=0;c<e.length;c++)for(u=0;u<n.length;u++)if(d=e[c]+":"+n[u],f=s[d],!(!f||f==="no")){l=e[c];break}}if(!l)for(c=0;c<e.length&&(d=e[c],f=s[d],!(!(!f||f==="no")&&(f==="yes"||a&&a===f?l=d:!a&&n.indexOf(f)!==-1&&(l=d,a=f,p.push("tag-"+f)),l)));c++);for(l&&(p.push("tag-status"),p.push("tag-status-"+l)),c=0;c<t.length;c++)d=t[c],f=s[d],!(!f||f==="no"||d===a)&&(p.push("tag-"+d),p.push("tag-"+d+"-"+f));if(a==="highway"&&!Ns[s.highway]||a==="aeroway"){var m=s.highway==="track"?"unpaved":"paved";for(d in s)f=s[d],d in Cc&&(m=Cc[d][f]?"paved":"unpaved"),d in gv&&gv[d][f]&&(m="semipaved");p.push("tag-"+m)}var g=s.wikidata||s["flag:wikidata"]||s["brand:wikidata"]||s["network:wikidata"]||s["operator:wikidata"];return g&&p.push("tag-wikidata"),p.join(" ").trim()},i.tags=function(s){return arguments.length?(r=s,i):r},i}function Cj(n){let e=n.systems.colors,t=n.systems.gfx,r=n.systems.l10n;e.off("colorsloaded",s),e.on("colorsloaded",s);let i=[];function s(){let d=Object.keys(e.getAllColorSchemes());for(let f=0;f<d.length;f++){let h={},p=d[f];h.title=p,h.value=r.t(`preferences.color_selection.${p}`),i.push(h)}return i}let o=Ke(n,"preferences-color-selection").label(r.tHtml("preferences.color_selection.title")).disclosureContent(u),a=ct(n,"color-selection"),l=null,c=!1;function u(d){d.selectAll(".preferences-color-selection-list").data([0]).enter().append("div").attr("class","layer-list preferences-color-selection-list").call(de(n).title(r.tHtml("preferences.color_selection.tooltip"))).append("div").append("input").attr("class","color-select").attr("placeholder",r.t("preferences.color_selection.placeholder")).call(Oe).call(a).on("blur change",g=>{let y=g.currentTarget,x=y&&y.value||"";if(a.data().some(_=>_.value===x)){l=x;let _=m(l);e.currentColorScheme!==_&&(e.setColorScheme(_),t.scene.dirtyScene(),t.deferredRedraw())}else g.currentTarget.value="",l=null}),a.data(i),p();function p(){d.selectAll(".preferences-color-selection-item").classed("active",c==="true").select("input").property("checked",c==="true")}function m(g){for(let y=0;y<i.length;y++){let x=i[y];if(x.value===g)return x.title}}}return o}function Aj(n){let e=n.systems.colors,t=n.systems.l10n,r=n.systems.gfx,i=r.scene.groups.get("basemap"),s=[{title:"default",value:t.t("preferences.colorblind_options.default")}],o=new sc,a=new sc,l=new sc,c={Protanopia:o,Deuteranopia:a,Tritanopia:l},u=e.protanopiaMatrix,d=e.deuteranopiaMatrix,f=e.tritanopiaMatrix;o.matrix=u,a.matrix=d,l.matrix=f;function h(){let x=Object.keys(c);for(let b=0;b<x.length;b++){let _={},S=x[b].toLowerCase();_.title=S,_.value=t.t(`preferences.colorblind_options.${S}`),s.push(_)}return s}h();let p=Ke(n,"preferences-colorblind-mode-options").label(t.tHtml("preferences.colorblind_options.title")).disclosureContent(y),m=ct(n,"colorblind-mode-options"),g=!1;function y(x){x.selectAll(".preferences-colorblind-mode-options-list").data([0]).enter().append("div").attr("class","layer-list preferences-colorblind-mode-options-list").call(de(n).title(t.tHtml("preferences.colorblind_options.tooltip"))).append("div").append("input").attr("class","color-select").attr("placeholder",t.t("preferences.colorblind_options.placeholder")).call(Oe).call(m).on("blur change",C=>{let v=C.currentTarget.value;if(v in c&&v!=="Default"){let w=c[v];i.filters=[w]}else i.filters=[];r.immediateRedraw()}),m.data(s),S();function S(){x.selectAll(".preferences-colorblind-mode-options-item").classed("active",g==="true").select("input").property("checked",g==="true")}}return p}var ile=15,lv=class extends st{constructor(){super(),this.version="2.5.0",this.privacyVersion=20201202,this.whatsNewVersion=20241222,this.buildID="",this.buildSHA="",this.buildDate="",this.maxCharsForTagKey=255,this.maxCharsForTagValue=255,this.maxCharsForRelationRole=255,this.assetOrigin=null,this.assetPath=null,this.assetMap=null,this.viewport=new Rn,this.systems={},this.modes={},this._currMode=null,this.behaviors={},this.services={},this._initPromise=null,this._resetPromise=null,this.lastPointerType="mouse",this._keybinding=Xe("context"),H(document).call(this._keybinding),this._preauth=null,this._apiConnections=null,this._prelocale=null,this._copyGraph=null,this._copyIDs=[],this._copyLoc=null,this._debugFlags={tile:!1,label:!1,imagery:!1,target:!1,downloaded:!1},this.$container=H(null),this._embed=null,this.inIntro=!1}initAsync(){if(this._initPromise)return this._initPromise;for(let[a,l]of Xr.available)this.systems[a]=new l(this);let e=this.systems.assets;this.assetOrigin&&(e.origin=this.assetOrigin),this.assetPath&&(e.filePath=this.assetPath),this.assetMap&&(e.fileReplacements=this.assetMap);let t=this.systems.l10n;this._prelocale&&(t.preferredLocaleCodes=this._prelocale);let r=this.systems.filters;this.hasHiddenConnections=a=>{let c=this.systems.editor.staging.graph,u=c.entity(a);return r.hasHiddenConnections(u,c)};let i=this.systems.gfx;this.deferredRedraw=i.deferredRedraw,this.immediateRedraw=i.immediateRedraw,this.scene=()=>i.scene,this.editable=()=>{let a=this._currMode;return!(!a||a.id==="save")};for(let[a,l]of ui.available)this.modes[a]=new l(this);for(let[a,l]of io.available)this.behaviors[a]=new l(this);if(!window.mocha)for(let[a,l]of qr.available)this.services[a]=new l(this);let s=Object.values(this.systems),o=Object.values(this.services);return this._initPromise=Promise.resolve().then(()=>Promise.all(s.map(a=>a.initAsync()))).then(()=>Promise.all(o.map(a=>a.initAsync()))).then(()=>{let a=this.services.osm;return a&&this._preauth?a.switchAsync(this._preauth):Promise.resolve()}).then(()=>Promise.all(s.map(a=>a.autoStart?a.startAsync():Promise.resolve()))).then(()=>Promise.all(o.map(a=>a.autoStart?a.startAsync():Promise.resolve())))}resetAsync(){if(this._resetPromise)return this._resetPromise;let e=Object.values(this.systems),t=Object.values(this.services);return this._resetPromise=Promise.resolve().then(()=>Promise.all(e.map(r=>r.resetAsync()))).then(()=>Promise.all(t.map(r=>r.resetAsync()))).finally(()=>this._resetPromise=null)}keybinding(){return this._keybinding}get preauth(){return this._preauth}set preauth(e){this._preauth=Object.assign({},e)}get apiConnections(){return this._apiConnections}set apiConnections(e){this._apiConnections=e}get locale(){return this._prelocale}set locale(e){this._prelocale=e}_afterLoad(e,t){return(r,i)=>{let s=this.services.osm;if(r){(r.status===400||r.status===401||r.status===403)&&s?.logout(),typeof t=="function"&&t(r);return}else if(s?.connectionID!==e){typeof t=="function"&&t({message:"Connection Switched",status:-1});return}else{this.systems.editor.merge(i.data,i.seenIDs),typeof t=="function"&&t(r,i);return}}}loadTiles(e){let t=this.services.osm;if(!(!t||this.viewport.transform.zoom<ile)&&this.editable()){let i=t.connectionID;t.loadTiles(this._afterLoad(i,e))}}loadTileAtLoc(e,t){let r=this.services.osm;if(r&&this.editable()){let i=r.connectionID;r.loadTileAtLoc(e,this._afterLoad(i,t))}}loadEntity(e,t){let r=this.services.osm;if(!r)return;let i=r.connectionID;r.loadEntity(e,this._afterLoad(i,t)),r.loadEntityRelations(e,this._afterLoad(i,t))}_cleanOsmString(e,t){return e==null?e="":e=e.toString(),e=e.trim(),e.normalize&&(e=e.normalize("NFC")),C6(e,t)}cleanTagKey(e){return this._cleanOsmString(e,this.maxCharsForTagKey)}cleanTagValue(e){return this._cleanOsmString(e,this.maxCharsForTagValue)}cleanRelationRole(e){return this._cleanOsmString(e,this.maxCharsForRelationRole)}get mode(){return this._currMode}enter(e,t){let r=this._currMode,i;return typeof e=="string"?i=this.modes[e]:i=e,i||(console.error(`context.enter: no such mode: ${e}`),i=this.modes.browse),r&&(r.exit(),this.$container.classed(`mode-${r.id}`,!1)),this._currMode=i,this._currMode.enter(t)||(this._currMode=this.modes.browse,this._currMode.enter()),this.$container.classed(`mode-${this._currMode.id}`,!0),this.emit("modechange",this._currMode),this._currMode}selectedData(){return this._currMode?this._currMode.selectedData||new Map:new Map}selectedIDs(){return this._currMode?this._currMode.selectedIDs||[]:[]}selectedNoteID(){return console.error("deprecated: do not call context.selectedNoteID anymore"),null}selectedErrorID(){return console.error("deprecated: do not call context.selectedErrorID anymore"),null}enableBehaviors(e){e instanceof Set||(e=new Set([].concat(e)));for(let[t,r]of Object.entries(this.behaviors))e.has(t)?r.enabled||r.enable():r.enabled&&r.disable()}get copyGraph(){return this._copyGraph}set copyGraph(e){this._copyGraph=e}get copyIDs(){return this._copyIDs}set copyIDs(e){this._copyIDs=e,this._copyGraph=this.systems.editor.staging.graph}get copyLoc(){return this._copyLoc}set copyLoc(e){this._copyLoc=e}debugFlags(){return this._debugFlags}getDebug(e){return e&&this._debugFlags[e]}setDebug(e,t=!0){this._debugFlags[e]=t,this.systems.gfx?.immediateRedraw()}container(e){return e===void 0?this.$container:(this.$container=e,this.$container.classed("ideditor",!0),this)}get containerNode(){return this.$container.node()}set containerNode(e){this.container(H(e))}embed(e){return e===void 0?this._embed:(this._embed=e,this)}};window.requestIdleCallback=window.requestIdleCallback||function(n){var e=Date.now();return window.requestAnimationFrame(function(){n({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})})};window.cancelIdleCallback=window.cancelIdleCallback||function(n){window.cancelAnimationFrame(n)};window.Rapid=OD;window.Rapid.isDebug=!1;})();
